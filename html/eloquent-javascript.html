<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=2></a><b>Eloquent&#160;JavaScript</b><br/>
<b>3rd&#160;edition</b><br/>
Marijn&#160;Haverbeke<br/>
<hr/>
<a name=3></a>Copyright&#160;©&#160;2018&#160;by&#160;Marijn&#160;Haverbeke<br/>
This&#160;work&#160;is&#160;licensed&#160;under&#160;a&#160;Creative&#160;Commons&#160;attribution-noncommercial<br/>license&#160;(<a href="http://creativecommons.org/licenses/by-nc/3.0/">http://creativecommons.org/licenses/by-nc/3.0/</a>).&#160;All&#160;code&#160;in&#160;the<br/>book&#160;may&#160;also&#160;be&#160;considered&#160;licensed&#160;under&#160;an&#160;MIT&#160;license&#160;<a href="http://opensource.org/licenses/MIT">(http://opensource.<br/>org/licenses/MIT).</a><br/>
The&#160;illustrations&#160;are&#160;contributed&#160;by&#160;various&#160;artists:&#160;Cover&#160;and&#160;chapter&#160;illus-<br/>
trations&#160;by&#160;Madalina&#160;Tantareanu.&#160;Pixel&#160;art&#160;in&#160;Chapters&#160;7&#160;and&#160;16&#160;by&#160;Antonio<br/>Perdomo&#160;Pastor.&#160;Regular&#160;expression&#160;diagrams&#160;in&#160;Chapter&#160;9&#160;generated&#160;with<br/><a href="http://regexper.com">regexper.com&#160;</a>by&#160;Jeff&#160;Avallone.&#160;Village&#160;photograph&#160;in&#160;Chapter&#160;11&#160;by&#160;Fabrice<br/>Creuzot.&#160;Game&#160;concept&#160;for&#160;Chapter&#160;15&#160;by&#160;<a href="http://lessmilk.com">Thomas&#160;Palef</a>.<br/>
The&#160;third&#160;edition&#160;of&#160;Eloquent&#160;JavaScript&#160;was&#160;made&#160;possible&#160;by&#160;<a href="https://eloquentjavascript.net/backers3.html">325&#160;financial</a><br/>
<a href="https://eloquentjavascript.net/backers3.html">backers.</a><br/>
You&#160;can&#160;buy&#160;a&#160;print&#160;version&#160;of&#160;this&#160;book,&#160;with&#160;an&#160;extra&#160;bonus&#160;chapter&#160;included,<br/>printed&#160;by&#160;No&#160;Starch&#160;Press&#160;at&#160;<a href="http://a-fwd.com/com=marijhaver-20&asin-com=1593279507">http://a-fwd.com/com=marijhaver-20&amp;asin-<br/>com=1593279507</a>.<br/>
i<br/>
<hr/>
<a name=4></a><b>Contents</b><br/>
<a href="eloquent-javascripts.html#13">Introduction</a><br/>
1<br/>
<a href="eloquent-javascripts.html#14">On&#160;programming&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
2<br/>
<a href="eloquent-javascripts.html#15">Why&#160;language&#160;matters&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
3<br/>
<a href="eloquent-javascripts.html#18">What&#160;is&#160;JavaScript?&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
6<br/>
<a href="eloquent-javascripts.html#19">Code,&#160;and&#160;what&#160;to&#160;do&#160;with&#160;it&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
7<br/>
<a href="eloquent-javascripts.html#20">Overview&#160;of&#160;this&#160;book&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
8<br/>
<a href="eloquent-javascripts.html#20">Typographic&#160;conventions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
8<br/>
<a href="eloquent-javascripts.html#22">1&#160;Values,&#160;Types,&#160;and&#160;Operators</a><br/>
10<br/>
<a href="eloquent-javascripts.html#22">Values&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
10<br/>
<a href="eloquent-javascripts.html#23">Numbers&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
11<br/>
<a href="eloquent-javascripts.html#25">Strings&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
13<br/>
<a href="eloquent-javascripts.html#27">Unary&#160;operators&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
15<br/>
<a href="eloquent-javascripts.html#28">Boolean&#160;values&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
16<br/>
<a href="eloquent-javascripts.html#30">Empty&#160;values&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
18<br/>
<a href="eloquent-javascripts.html#30">Automatic&#160;type&#160;conversion&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
18<br/>
<a href="eloquent-javascripts.html#32">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
20<br/>
<a href="eloquent-javascripts.html#34">2&#160;Program&#160;Structure</a><br/>
22<br/>
<a href="eloquent-javascripts.html#34">Expressions&#160;and&#160;statements&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
22<br/>
<a href="eloquent-javascripts.html#35">Bindings&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
23<br/>
<a href="eloquent-javascripts.html#37">Binding&#160;names&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
25<br/>
<a href="eloquent-javascripts.html#37">The&#160;environment&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
25<br/>
<a href="eloquent-javascripts.html#38">Functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
26<br/>
<a href="eloquent-javascripts.html#38">The&#160;console.log&#160;function&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
26<br/>
<a href="eloquent-javascripts.html#39">Return&#160;values&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
27<br/>
<a href="eloquent-javascripts.html#39">Control&#160;flow&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
27<br/>
<a href="eloquent-javascripts.html#40">Conditional&#160;execution&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
28<br/>
<a href="eloquent-javascripts.html#42">while&#160;and&#160;do&#160;loops&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
30<br/>
<a href="eloquent-javascripts.html#43">Indenting&#160;Code&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
31<br/>
<a href="eloquent-javascripts.html#44">for&#160;loops&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
32<br/>
<a href="eloquent-javascripts.html#45">Breaking&#160;Out&#160;of&#160;a&#160;Loop&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
33<br/>
ii<br/>
<hr/>
<a name=5></a><a href="eloquent-javascripts.html#46">Updating&#160;bindings&#160;succinctly&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
34<br/>
<a href="eloquent-javascripts.html#46">Dispatching&#160;on&#160;a&#160;value&#160;with&#160;switch&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
34<br/>
<a href="eloquent-javascripts.html#47">Capitalization&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
35<br/>
<a href="eloquent-javascripts.html#48">Comments&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
36<br/>
<a href="eloquent-javascripts.html#49">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
37<br/>
<a href="eloquent-javascripts.html#49">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
37<br/>
<a href="eloquent-javascripts.html#51">3&#160;Functions</a><br/>
39<br/>
<a href="eloquent-javascripts.html#51">Defining&#160;a&#160;function&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
39<br/>
<a href="eloquent-javascripts.html#52">Bindings&#160;and&#160;scopes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
40<br/>
<a href="eloquent-javascripts.html#54">Functions&#160;as&#160;values&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
42<br/>
<a href="eloquent-javascripts.html#55">Declaration&#160;notation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
43<br/>
<a href="eloquent-javascripts.html#56">Arrow&#160;functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
44<br/>
<a href="eloquent-javascripts.html#57">The&#160;call&#160;stack&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
45<br/>
<a href="eloquent-javascripts.html#58">Optional&#160;Arguments&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
46<br/>
<a href="eloquent-javascripts.html#59">Closure&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
47<br/>
<a href="eloquent-javascripts.html#61">Recursion&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
49<br/>
<a href="eloquent-javascripts.html#63">Growing&#160;functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
51<br/>
<a href="eloquent-javascripts.html#66">Functions&#160;and&#160;side&#160;effects&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
54<br/>
<a href="eloquent-javascripts.html#67">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
55<br/>
<a href="eloquent-javascripts.html#67">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
55<br/>
<a href="eloquent-javascripts.html#69">4&#160;Data&#160;Structures:&#160;Objects&#160;and&#160;Arrays</a><br/>
57<br/>
<a href="eloquent-javascripts.html#69">The&#160;weresquirrel&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
57<br/>
<a href="eloquent-javascripts.html#70">Data&#160;sets&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
58<br/>
<a href="eloquent-javascripts.html#71">Properties&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
59<br/>
<a href="eloquent-javascripts.html#72">Methods&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
60<br/>
<a href="eloquent-javascripts.html#73">Objects&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
61<br/>
<a href="eloquent-javascripts.html#75">Mutability&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
63<br/>
<a href="eloquent-javascripts.html#76">The&#160;lycanthrope’s&#160;log&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
64<br/>
<a href="eloquent-javascripts.html#78">Computing&#160;correlation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
66<br/>
<a href="eloquent-javascripts.html#80">Array&#160;loops&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
68<br/>
<a href="eloquent-javascripts.html#80">The&#160;final&#160;analysis&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
68<br/>
<a href="eloquent-javascripts.html#82">Further&#160;arrayology&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
70<br/>
<a href="eloquent-javascripts.html#84">Strings&#160;and&#160;their&#160;properties&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
72<br/>
<a href="eloquent-javascripts.html#86">Rest&#160;parameters&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
74<br/>
<a href="eloquent-javascripts.html#87">The&#160;Math&#160;object&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
75<br/>
<a href="eloquent-javascripts.html#88">Destructuring&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
76<br/>
<a href="eloquent-javascripts.html#89">JSON&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
77<br/>
<a href="eloquent-javascripts.html#90">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
78<br/>
iii<br/>
<hr/>
<a name=6></a><a href="eloquent-javascripts.html#91">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
79<br/>
<a href="eloquent-javascripts.html#94">5&#160;Higher-Order&#160;Functions</a><br/>
82<br/>
<a href="eloquent-javascripts.html#95">Abstraction&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
83<br/>
<a href="eloquent-javascripts.html#95">Abstracting&#160;repetition&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
83<br/>
<a href="eloquent-javascripts.html#97">Higher-order&#160;functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
85<br/>
<a href="eloquent-javascripts.html#98">Script&#160;data&#160;set&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
86<br/>
<a href="eloquent-javascripts.html#99">Filtering&#160;arrays&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
87<br/>
<a href="eloquent-javascripts.html#100">Transforming&#160;with&#160;map&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
88<br/>
<a href="eloquent-javascripts.html#100">Summarizing&#160;with&#160;reduce&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
88<br/>
<a href="eloquent-javascripts.html#102">Composability&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
90<br/>
<a href="eloquent-javascripts.html#103">Strings&#160;and&#160;character&#160;codes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
91<br/>
<a href="eloquent-javascripts.html#105">Recognizing&#160;text&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
93<br/>
<a href="eloquent-javascripts.html#107">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
95<br/>
<a href="eloquent-javascripts.html#107">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
95<br/>
<a href="eloquent-javascripts.html#109">6&#160;The&#160;Secret&#160;Life&#160;of&#160;Objects</a><br/>
97<br/>
<a href="eloquent-javascripts.html#109">Encapsulation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
97<br/>
<a href="eloquent-javascripts.html#110">Methods&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
98<br/>
<a href="eloquent-javascripts.html#111">Prototypes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.<br/>
99<br/>
<a href="eloquent-javascripts.html#113">Classes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;101<br/><a href="eloquent-javascripts.html#114">Class&#160;notation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;102<br/><a href="eloquent-javascripts.html#115">Overriding&#160;derived&#160;properties&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;103<br/><a href="eloquent-javascripts.html#116">Maps&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;104<br/><a href="eloquent-javascripts.html#118">Polymorphism&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;106<br/><a href="eloquent-javascripts.html#119">Symbols&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;107<br/><a href="eloquent-javascripts.html#120">The&#160;iterator&#160;interface&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;108<br/><a href="eloquent-javascripts.html#122">Getters,&#160;setters,&#160;and&#160;statics&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;110<br/><a href="eloquent-javascripts.html#124">Inheritance&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;112<br/><a href="eloquent-javascripts.html#125">The&#160;instanceof&#160;operator&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;113<br/><a href="eloquent-javascripts.html#126">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;114<br/><a href="eloquent-javascripts.html#127">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;115<br/>
<a href="eloquent-javascripts.html#129">7&#160;Project:&#160;A&#160;Robot</a><br/>
117<br/>
<a href="eloquent-javascripts.html#129">Meadowfield&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;117<br/><a href="eloquent-javascripts.html#131">The&#160;task&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;119<br/><a href="eloquent-javascripts.html#133">Persistent&#160;data&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;121<br/><a href="eloquent-javascripts.html#134">Simulation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;122<br/><a href="eloquent-javascripts.html#136">The&#160;mail&#160;truck’s&#160;route&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;124<br/><a href="eloquent-javascripts.html#136">Pathfinding&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;124<br/>
iv<br/>
<hr/>
<a name=7></a><a href="eloquent-javascripts.html#138">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;126<br/>
<a href="eloquent-javascripts.html#140">8&#160;Bugs&#160;and&#160;Errors</a><br/>
128<br/>
<a href="eloquent-javascripts.html#140">Language&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;128<br/><a href="eloquent-javascripts.html#141">Strict&#160;mode&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;129<br/><a href="eloquent-javascripts.html#142">Types&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;130<br/><a href="eloquent-javascripts.html#143">Testing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;131<br/><a href="eloquent-javascripts.html#144">Debugging&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;132<br/><a href="eloquent-javascripts.html#146">Error&#160;propagation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;134<br/><a href="eloquent-javascripts.html#147">Exceptions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;135<br/><a href="eloquent-javascripts.html#148">Cleaning&#160;up&#160;after&#160;exceptions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;136<br/><a href="eloquent-javascripts.html#150">Selective&#160;catching&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;138<br/><a href="eloquent-javascripts.html#152">Assertions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;140<br/><a href="eloquent-javascripts.html#153">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;141<br/><a href="eloquent-javascripts.html#154">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;142<br/>
<a href="eloquent-javascripts.html#155">9&#160;Regular&#160;Expressions</a><br/>
143<br/>
<a href="eloquent-javascripts.html#155">Creating&#160;a&#160;regular&#160;expression&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;143<br/><a href="eloquent-javascripts.html#156">Testing&#160;for&#160;matches&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;144<br/><a href="eloquent-javascripts.html#156">Sets&#160;of&#160;characters&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;144<br/><a href="eloquent-javascripts.html#158">Repeating&#160;parts&#160;of&#160;a&#160;pattern&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;146<br/><a href="eloquent-javascripts.html#159">Grouping&#160;subexpressions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;147<br/><a href="eloquent-javascripts.html#159">Matches&#160;and&#160;groups&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;147<br/><a href="eloquent-javascripts.html#160">The&#160;Date&#160;class&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;148<br/><a href="eloquent-javascripts.html#162">Word&#160;and&#160;string&#160;boundaries&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;150<br/><a href="eloquent-javascripts.html#162">Choice&#160;patterns&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;150<br/><a href="eloquent-javascripts.html#163">The&#160;mechanics&#160;of&#160;matching&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;151<br/><a href="eloquent-javascripts.html#164">Backtracking&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;152<br/><a href="eloquent-javascripts.html#166">The&#160;replace&#160;method&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;154<br/><a href="eloquent-javascripts.html#167">Greed&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;155<br/><a href="eloquent-javascripts.html#169">Dynamically&#160;creating&#160;RegExp&#160;objects&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;157<br/><a href="eloquent-javascripts.html#169">The&#160;search&#160;method&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;157<br/><a href="eloquent-javascripts.html#170">The&#160;lastIndex&#160;property&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;158<br/><a href="eloquent-javascripts.html#172">Parsing&#160;an&#160;INI&#160;file&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;160<br/><a href="eloquent-javascripts.html#174">International&#160;characters&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;162<br/><a href="eloquent-javascripts.html#175">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;163<br/><a href="eloquent-javascripts.html#177">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;165<br/>
<a href="eloquent-javascripts.html#179">10&#160;Modules</a><br/>
167<br/>
<a href="eloquent-javascripts.html#179">Modules&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;167<br/>
v<br/>
<hr/>
<a name=8></a><a href="eloquent-javascripts.html#180">Packages&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;168<br/><a href="eloquent-javascripts.html#181">Improvised&#160;modules&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;169<br/><a href="eloquent-javascripts.html#182">Evaluating&#160;data&#160;as&#160;code&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;170<br/><a href="eloquent-javascripts.html#183">CommonJS&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;171<br/><a href="eloquent-javascripts.html#185">ECMAScript&#160;modules&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;173<br/><a href="eloquent-javascripts.html#187">Building&#160;and&#160;bundling&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;175<br/><a href="eloquent-javascripts.html#188">Module&#160;design&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;176<br/><a href="eloquent-javascripts.html#190">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;178<br/><a href="eloquent-javascripts.html#190">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;178<br/>
<a href="eloquent-javascripts.html#192">11&#160;Asynchronous&#160;Programming</a><br/>
180<br/>
<a href="eloquent-javascripts.html#192">Asynchronicity&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;180<br/><a href="eloquent-javascripts.html#194">Crow&#160;tech&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;182<br/><a href="eloquent-javascripts.html#195">Callbacks&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;183<br/><a href="eloquent-javascripts.html#197">Promises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;185<br/><a href="eloquent-javascripts.html#198">Failure&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;186<br/><a href="eloquent-javascripts.html#200">Networks&#160;are&#160;hard&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;188<br/><a href="eloquent-javascripts.html#202">Collections&#160;of&#160;promises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;190<br/><a href="eloquent-javascripts.html#203">Network&#160;flooding&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;191<br/><a href="eloquent-javascripts.html#204">Message&#160;routing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;192<br/><a href="eloquent-javascripts.html#206">Async&#160;functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;194<br/><a href="eloquent-javascripts.html#208">Generators&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;196<br/><a href="eloquent-javascripts.html#209">The&#160;event&#160;loop&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;197<br/><a href="eloquent-javascripts.html#211">Asynchronous&#160;bugs&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;199<br/><a href="eloquent-javascripts.html#212">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;200<br/><a href="eloquent-javascripts.html#213">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;201<br/>
<a href="eloquent-javascripts.html#214">12&#160;Project:&#160;A&#160;Programming&#160;Language</a><br/>
202<br/>
<a href="eloquent-javascripts.html#214">Parsing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;202<br/><a href="eloquent-javascripts.html#219">The&#160;evaluator&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;207<br/><a href="eloquent-javascripts.html#220">Special&#160;forms&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;208<br/><a href="eloquent-javascripts.html#222">The&#160;environment&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;210<br/><a href="eloquent-javascripts.html#223">Functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;211<br/><a href="eloquent-javascripts.html#224">Compilation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;212<br/><a href="eloquent-javascripts.html#225">Cheating&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;213<br/><a href="eloquent-javascripts.html#226">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;214<br/>
<a href="eloquent-javascripts.html#228">13&#160;JavaScript&#160;and&#160;the&#160;Browser</a><br/>
216<br/>
<a href="eloquent-javascripts.html#228">Networks&#160;and&#160;the&#160;Internet&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;216<br/><a href="eloquent-javascripts.html#230">The&#160;Web&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;218<br/>
vi<br/>
<hr/>
<a name=9></a><a href="eloquent-javascripts.html#230">HTML&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;218<br/><a href="eloquent-javascripts.html#233">HTML&#160;and&#160;JavaScript&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;221<br/><a href="eloquent-javascripts.html#234">In&#160;the&#160;sandbox&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;222<br/><a href="eloquent-javascripts.html#234">Compatibility&#160;and&#160;the&#160;browser&#160;wars&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;222<br/>
<a href="eloquent-javascripts.html#236">14&#160;The&#160;Document&#160;Object&#160;Model</a><br/>
224<br/>
<a href="eloquent-javascripts.html#236">Document&#160;structure&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;224<br/><a href="eloquent-javascripts.html#237">Trees&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;225<br/><a href="eloquent-javascripts.html#238">The&#160;standard&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;226<br/><a href="eloquent-javascripts.html#239">Moving&#160;through&#160;the&#160;tree&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;227<br/><a href="eloquent-javascripts.html#240">Finding&#160;elements&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;228<br/><a href="eloquent-javascripts.html#241">Changing&#160;the&#160;document&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;229<br/><a href="eloquent-javascripts.html#242">Creating&#160;nodes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;230<br/><a href="eloquent-javascripts.html#244">Attributes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;232<br/><a href="eloquent-javascripts.html#245">Layout&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;233<br/><a href="eloquent-javascripts.html#247">Styling&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;235<br/><a href="eloquent-javascripts.html#248">Cascading&#160;styles&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;236<br/><a href="eloquent-javascripts.html#249">Query&#160;selectors&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;237<br/><a href="eloquent-javascripts.html#250">Positioning&#160;and&#160;animating&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;238<br/><a href="eloquent-javascripts.html#253">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;241<br/><a href="eloquent-javascripts.html#253">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;241<br/>
<a href="eloquent-javascripts.html#255">15&#160;Handling&#160;Events</a><br/>
243<br/>
<a href="eloquent-javascripts.html#255">Event&#160;handlers&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;243<br/><a href="eloquent-javascripts.html#256">Events&#160;and&#160;DOM&#160;nodes&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;244<br/><a href="eloquent-javascripts.html#257">Event&#160;objects&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;245<br/><a href="eloquent-javascripts.html#257">Propagation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;245<br/><a href="eloquent-javascripts.html#259">Default&#160;actions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;247<br/><a href="eloquent-javascripts.html#259">Key&#160;events&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;247<br/><a href="eloquent-javascripts.html#261">Pointer&#160;events&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;249<br/><a href="eloquent-javascripts.html#265">Scroll&#160;events&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;253<br/><a href="eloquent-javascripts.html#266">Focus&#160;events&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;254<br/><a href="eloquent-javascripts.html#267">Load&#160;event&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;255<br/><a href="eloquent-javascripts.html#267">Events&#160;and&#160;the&#160;event&#160;loop&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;255<br/><a href="eloquent-javascripts.html#269">Timers&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;257<br/><a href="eloquent-javascripts.html#269">Debouncing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;257<br/><a href="eloquent-javascripts.html#271">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;259<br/><a href="eloquent-javascripts.html#271">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;259<br/>
vii<br/>
<hr/>
<a name=10></a><a href="eloquent-javascripts.html#273">16&#160;Project:&#160;A&#160;Platform&#160;Game</a><br/>
261<br/>
<a href="eloquent-javascripts.html#273">The&#160;game&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;261<br/><a href="eloquent-javascripts.html#274">The&#160;technology&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;262<br/><a href="eloquent-javascripts.html#274">Levels&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;262<br/><a href="eloquent-javascripts.html#275">Reading&#160;a&#160;level&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;263<br/><a href="eloquent-javascripts.html#277">Actors&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;265<br/><a href="eloquent-javascripts.html#280">Encapsulation&#160;as&#160;a&#160;burden&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;268<br/><a href="eloquent-javascripts.html#281">Drawing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;269<br/><a href="eloquent-javascripts.html#286">Motion&#160;and&#160;collision&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;274<br/><a href="eloquent-javascripts.html#289">Actor&#160;updates&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;277<br/><a href="eloquent-javascripts.html#291">Tracking&#160;keys&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;279<br/><a href="eloquent-javascripts.html#292">Running&#160;the&#160;game&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;280<br/><a href="eloquent-javascripts.html#294">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;282<br/>
<a href="eloquent-javascripts.html#296">17&#160;Drawing&#160;on&#160;Canvas</a><br/>
284<br/>
<a href="eloquent-javascripts.html#296">SVG&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;284<br/><a href="eloquent-javascripts.html#297">The&#160;canvas&#160;element&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;285<br/><a href="eloquent-javascripts.html#298">Lines&#160;and&#160;surfaces&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;286<br/><a href="eloquent-javascripts.html#299">Paths&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;287<br/><a href="eloquent-javascripts.html#301">Curves&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;289<br/><a href="eloquent-javascripts.html#303">Drawing&#160;a&#160;pie&#160;chart&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;291<br/><a href="eloquent-javascripts.html#304">Text&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;292<br/><a href="eloquent-javascripts.html#305">Images&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;293<br/><a href="eloquent-javascripts.html#307">Transformation&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;295<br/><a href="eloquent-javascripts.html#309">Storing&#160;and&#160;clearing&#160;transformations&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;297<br/><a href="eloquent-javascripts.html#311">Back&#160;to&#160;the&#160;game&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;299<br/><a href="eloquent-javascripts.html#316">Choosing&#160;a&#160;graphics&#160;interface&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;304<br/><a href="eloquent-javascripts.html#317">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;305<br/><a href="eloquent-javascripts.html#318">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;306<br/>
<a href="eloquent-javascripts.html#320">18&#160;HTTP&#160;and&#160;Forms</a><br/>
308<br/>
<a href="eloquent-javascripts.html#320">The&#160;protocol&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;308<br/><a href="eloquent-javascripts.html#322">Browsers&#160;and&#160;HTTP&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;310<br/><a href="eloquent-javascripts.html#324">Fetch&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;312<br/><a href="eloquent-javascripts.html#325">HTTP&#160;sandboxing&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;313<br/><a href="eloquent-javascripts.html#326">Appreciating&#160;HTTP&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;314<br/><a href="eloquent-javascripts.html#326">Security&#160;and&#160;HTTPS&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;314<br/><a href="eloquent-javascripts.html#327">Form&#160;fields&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;315<br/><a href="eloquent-javascripts.html#329">Focus&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;317<br/><a href="eloquent-javascripts.html#330">Disabled&#160;fields&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;318<br/>
viii<br/>
<hr/>
<a name=11></a><a href="eloquent-javascripts.html#330">The&#160;form&#160;as&#160;a&#160;whole&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;318<br/><a href="eloquent-javascripts.html#332">Text&#160;fields&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;320<br/><a href="eloquent-javascripts.html#333">Checkboxes&#160;and&#160;radio&#160;buttons&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;321<br/><a href="eloquent-javascripts.html#334">Select&#160;fields&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;322<br/><a href="eloquent-javascripts.html#335">File&#160;fields&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;323<br/><a href="eloquent-javascripts.html#337">Storing&#160;data&#160;client-side&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;325<br/><a href="eloquent-javascripts.html#339">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;327<br/><a href="eloquent-javascripts.html#340">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;328<br/>
<a href="eloquent-javascripts.html#342">19&#160;Project:&#160;A&#160;Pixel&#160;Art&#160;Editor</a><br/>
330<br/>
<a href="eloquent-javascripts.html#342">Components&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;330<br/><a href="eloquent-javascripts.html#344">The&#160;state&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;332<br/><a href="eloquent-javascripts.html#345">DOM&#160;building&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;333<br/><a href="eloquent-javascripts.html#346">The&#160;canvas&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;334<br/><a href="eloquent-javascripts.html#349">The&#160;application&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;337<br/><a href="eloquent-javascripts.html#351">Drawing&#160;tools&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;339<br/><a href="eloquent-javascripts.html#354">Saving&#160;and&#160;loading&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;342<br/><a href="eloquent-javascripts.html#357">Undo&#160;history&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;345<br/><a href="eloquent-javascripts.html#358">Let’s&#160;draw&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;346<br/><a href="eloquent-javascripts.html#359">Why&#160;is&#160;this&#160;so&#160;hard?&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;347<br/><a href="eloquent-javascripts.html#360">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;348<br/>
<a href="eloquent-javascripts.html#362">20&#160;Node.js</a><br/>
350<br/>
<a href="eloquent-javascripts.html#362">Background&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;350<br/><a href="eloquent-javascripts.html#363">The&#160;node&#160;command&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;351<br/><a href="eloquent-javascripts.html#364">Modules&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;352<br/><a href="eloquent-javascripts.html#365">Installing&#160;with&#160;NPM&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;353<br/><a href="eloquent-javascripts.html#367">The&#160;file&#160;system&#160;module&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;355<br/><a href="eloquent-javascripts.html#369">The&#160;HTTP&#160;module&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;357<br/><a href="eloquent-javascripts.html#371">Streams&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;359<br/><a href="eloquent-javascripts.html#373">A&#160;file&#160;server&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;361<br/><a href="eloquent-javascripts.html#378">Summary&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;366<br/><a href="eloquent-javascripts.html#379">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;367<br/>
<a href="eloquent-javascripts.html#381">21&#160;Project:&#160;Skill-Sharing&#160;Website</a><br/>
369<br/>
<a href="eloquent-javascripts.html#381">Design&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;369<br/><a href="eloquent-javascripts.html#382">Long&#160;polling&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;370<br/><a href="eloquent-javascripts.html#383">HTTP&#160;interface&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;371<br/><a href="eloquent-javascripts.html#385">The&#160;server&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;373<br/><a href="eloquent-javascripts.html#392">The&#160;client&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;380<br/>
ix<br/>
<hr/>
<a name=12></a><a href="eloquent-javascripts.html#399">Exercises&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;387<br/>
<a href="eloquent-javascripts.html#400">Exercise&#160;Hints</a><br/>
388<br/>
<a href="eloquent-javascripts.html#400">Program&#160;Structure&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;388<br/><a href="eloquent-javascripts.html#401">Functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;389<br/><a href="eloquent-javascripts.html#402">Data&#160;Structures:&#160;Objects&#160;and&#160;Arrays&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;390<br/><a href="eloquent-javascripts.html#404">Higher-Order&#160;Functions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;392<br/><a href="eloquent-javascripts.html#405">The&#160;Secret&#160;Life&#160;of&#160;Objects&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;393<br/><a href="eloquent-javascripts.html#406">Project:&#160;A&#160;Robot&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;394<br/><a href="eloquent-javascripts.html#407">Bugs&#160;and&#160;Errors&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;395<br/><a href="eloquent-javascripts.html#407">Regular&#160;Expressions&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;395<br/><a href="eloquent-javascripts.html#408">Modules&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;396<br/><a href="eloquent-javascripts.html#410">Asynchronous&#160;Programming&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;398<br/><a href="eloquent-javascripts.html#411">Project:&#160;A&#160;Programming&#160;Language&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;399<br/><a href="eloquent-javascripts.html#412">The&#160;Document&#160;Object&#160;Model&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;400<br/><a href="eloquent-javascripts.html#412">Handling&#160;Events&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;400<br/><a href="eloquent-javascripts.html#414">Project:&#160;A&#160;Platform&#160;Game&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;402<br/><a href="eloquent-javascripts.html#414">Drawing&#160;on&#160;Canvas&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;402<br/><a href="eloquent-javascripts.html#416">HTTP&#160;and&#160;Forms&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;404<br/><a href="eloquent-javascripts.html#418">Project:&#160;A&#160;Pixel&#160;Art&#160;Editor&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;406<br/><a href="eloquent-javascripts.html#420">Node.js&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;408<br/><a href="eloquent-javascripts.html#421">Project:&#160;Skill-Sharing&#160;Website&#160;</a>.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;.&#160;409<br/>
x<br/>
<hr/>
<a name=13></a><i>“We&#160;think&#160;we&#160;are&#160;creating&#160;the&#160;system&#160;for&#160;our&#160;own&#160;purposes.&#160;We</i><br/>
<i>believe&#160;we&#160;are&#160;making&#160;it&#160;in&#160;our&#160;own&#160;image...&#160;But&#160;the&#160;computer&#160;is<br/>not&#160;really&#160;like&#160;us.&#160;It&#160;is&#160;a&#160;projection&#160;of&#160;a&#160;very&#160;slim&#160;part&#160;of&#160;ourselves:<br/>that&#160;portion&#160;devoted&#160;to&#160;logic,&#160;order,&#160;rule,&#160;and&#160;clarity.”</i><br/>
—Ellen&#160;Ullman,&#160;Close&#160;to&#160;the&#160;Machine:&#160;Technophilia&#160;and&#160;its<br/>
Discontents<br/>
<b>Introduction</b><br/>
This&#160;is&#160;a&#160;book&#160;about&#160;instructing&#160;computers.&#160;Computers&#160;are&#160;about&#160;as&#160;common<br/>as&#160;screwdrivers&#160;today,&#160;but&#160;they&#160;are&#160;quite&#160;a&#160;bit&#160;more&#160;complex,&#160;and&#160;making&#160;them<br/>do&#160;what&#160;you&#160;want&#160;them&#160;to&#160;do&#160;isn’t&#160;always&#160;easy.<br/>
If&#160;the&#160;task&#160;you&#160;have&#160;for&#160;your&#160;computer&#160;is&#160;a&#160;common,&#160;well-understood&#160;one,<br/>
such&#160;as&#160;showing&#160;you&#160;your&#160;email&#160;or&#160;acting&#160;like&#160;a&#160;calculator,&#160;you&#160;can&#160;open&#160;the<br/>appropriate&#160;application&#160;and&#160;get&#160;to&#160;work.&#160;But&#160;for&#160;unique&#160;or&#160;open-ended&#160;tasks,<br/>there&#160;probably&#160;is&#160;no&#160;application.<br/>
That&#160;is&#160;where&#160;programming&#160;may&#160;come&#160;in.&#160;<i>Programming&#160;</i>is&#160;the&#160;act&#160;of&#160;con-<br/>
structing&#160;a&#160;<i>program</i>—a&#160;set&#160;of&#160;precise&#160;instructions&#160;telling&#160;a&#160;computer&#160;what&#160;to&#160;do.<br/>Because&#160;computers&#160;are&#160;dumb,&#160;pedantic&#160;beasts,&#160;programming&#160;is&#160;fundamentally<br/>tedious&#160;and&#160;frustrating.<br/>
Fortunately,&#160;if&#160;you&#160;can&#160;get&#160;over&#160;that&#160;fact,&#160;and&#160;maybe&#160;even&#160;enjoy&#160;the&#160;rigor<br/>
of&#160;thinking&#160;in&#160;terms&#160;that&#160;dumb&#160;machines&#160;can&#160;deal&#160;with,&#160;programming&#160;can&#160;be<br/>rewarding.&#160;It&#160;allows&#160;you&#160;to&#160;do&#160;things&#160;in&#160;seconds&#160;that&#160;would&#160;take&#160;<i>forever&#160;</i>by<br/>hand.&#160;It&#160;is&#160;a&#160;way&#160;to&#160;make&#160;your&#160;computer&#160;tool&#160;do&#160;things&#160;that&#160;it&#160;couldn’t&#160;do<br/>before.&#160;And&#160;it&#160;provides&#160;a&#160;wonderful&#160;exercise&#160;in&#160;abstract&#160;thinking.<br/>
Most&#160;programming&#160;is&#160;done&#160;with&#160;programming&#160;languages.&#160;A&#160;<i>programming</i><br/>
<i>language&#160;</i>is&#160;an&#160;artificially&#160;constructed&#160;language&#160;used&#160;to&#160;instruct&#160;computers.&#160;It<br/>is&#160;interesting&#160;that&#160;the&#160;most&#160;effective&#160;way&#160;we’ve&#160;found&#160;to&#160;communicate&#160;with&#160;a<br/>computer&#160;borrows&#160;so&#160;heavily&#160;from&#160;the&#160;way&#160;we&#160;communicate&#160;with&#160;each&#160;other.<br/>Like&#160;human&#160;languages,&#160;computer&#160;languages&#160;allow&#160;words&#160;and&#160;phrases&#160;to&#160;be<br/>combined&#160;in&#160;new&#160;ways,&#160;making&#160;it&#160;possible&#160;to&#160;express&#160;ever&#160;new&#160;concepts.<br/>
At&#160;one&#160;point&#160;language-based&#160;interfaces,&#160;such&#160;as&#160;the&#160;BASIC&#160;and&#160;DOS&#160;prompts<br/>
of&#160;the&#160;1980s&#160;and&#160;1990s,&#160;were&#160;the&#160;main&#160;method&#160;of&#160;interacting&#160;with&#160;computers.<br/>They&#160;have&#160;largely&#160;been&#160;replaced&#160;with&#160;visual&#160;interfaces,&#160;which&#160;are&#160;easier&#160;to&#160;learn<br/>but&#160;offer&#160;less&#160;freedom.&#160;Computer&#160;languages&#160;are&#160;still&#160;there,&#160;if&#160;you&#160;know&#160;where<br/>to&#160;look.&#160;One&#160;such&#160;language,&#160;JavaScript,&#160;is&#160;built&#160;into&#160;every&#160;modern&#160;web&#160;browser<br/>and&#160;is&#160;thus&#160;available&#160;on&#160;almost&#160;every&#160;device.<br/>
This&#160;book&#160;will&#160;try&#160;to&#160;make&#160;you&#160;familiar&#160;enough&#160;with&#160;this&#160;language&#160;to&#160;do<br/>
useful&#160;and&#160;amusing&#160;things&#160;with&#160;it.<br/>
1<br/>
<hr/>
<a name=14></a><b>On&#160;programming</b><br/>
Besides&#160;explaining&#160;JavaScript,&#160;I&#160;will&#160;introduce&#160;the&#160;basic&#160;principles&#160;of&#160;program-<br/>ming.&#160;Programming,&#160;it&#160;turns&#160;out,&#160;is&#160;hard.&#160;The&#160;fundamental&#160;rules&#160;are&#160;simple<br/>and&#160;clear,&#160;but&#160;programs&#160;built&#160;on&#160;top&#160;of&#160;these&#160;rules&#160;tend&#160;to&#160;become&#160;complex<br/>enough&#160;to&#160;introduce&#160;their&#160;own&#160;rules&#160;and&#160;complexity.&#160;You’re&#160;building&#160;your&#160;own<br/>maze,&#160;in&#160;a&#160;way,&#160;and&#160;you&#160;might&#160;just&#160;get&#160;lost&#160;in&#160;it.<br/>
There&#160;will&#160;be&#160;times&#160;when&#160;reading&#160;this&#160;book&#160;feels&#160;terribly&#160;frustrating.&#160;If&#160;you<br/>
are&#160;new&#160;to&#160;programming,&#160;there&#160;will&#160;be&#160;a&#160;lot&#160;of&#160;new&#160;material&#160;to&#160;digest.&#160;Much&#160;of<br/>this&#160;material&#160;will&#160;then&#160;be&#160;<i>combined&#160;</i>in&#160;ways&#160;that&#160;require&#160;you&#160;to&#160;make&#160;additional<br/>connections.<br/>
It&#160;is&#160;up&#160;to&#160;you&#160;to&#160;make&#160;the&#160;necessary&#160;effort.&#160;When&#160;you&#160;are&#160;struggling&#160;to&#160;follow<br/>
the&#160;book,&#160;do&#160;not&#160;jump&#160;to&#160;any&#160;conclusions&#160;about&#160;your&#160;own&#160;capabilities.&#160;You&#160;are<br/>fine—you&#160;just&#160;need&#160;to&#160;keep&#160;at&#160;it.&#160;Take&#160;a&#160;break,&#160;reread&#160;some&#160;material,&#160;and&#160;make<br/>sure&#160;you&#160;read&#160;and&#160;understand&#160;the&#160;example&#160;programs&#160;and&#160;exercises.&#160;Learning&#160;is<br/>hard&#160;work,&#160;but&#160;everything&#160;you&#160;learn&#160;is&#160;yours&#160;and&#160;will&#160;make&#160;subsequent&#160;learning<br/>easier.<br/>
When&#160;action&#160;grows&#160;unprofitable,&#160;gather&#160;information;&#160;when&#160;infor-<br/>mation&#160;grows&#160;unprofitable,&#160;sleep.<br/>
—Ursula&#160;K.&#160;Le&#160;Guin,&#160;The&#160;Left&#160;Hand&#160;of&#160;Darkness<br/>
A&#160;program&#160;is&#160;many&#160;things.&#160;It&#160;is&#160;a&#160;piece&#160;of&#160;text&#160;typed&#160;by&#160;a&#160;programmer,<br/>
it&#160;is&#160;the&#160;directing&#160;force&#160;that&#160;makes&#160;the&#160;computer&#160;do&#160;what&#160;it&#160;does,&#160;it&#160;is&#160;data<br/>in&#160;the&#160;computer’s&#160;memory,&#160;yet&#160;it&#160;controls&#160;the&#160;actions&#160;performed&#160;on&#160;this&#160;same<br/>memory.&#160;Analogies&#160;that&#160;try&#160;to&#160;compare&#160;programs&#160;to&#160;objects&#160;we&#160;are&#160;familiar<br/>with&#160;tend&#160;to&#160;fall&#160;short.&#160;A&#160;superficially&#160;fitting&#160;one&#160;is&#160;that&#160;of&#160;a&#160;machine—lots&#160;of<br/>separate&#160;parts&#160;tend&#160;to&#160;be&#160;involved,&#160;and&#160;to&#160;make&#160;the&#160;whole&#160;thing&#160;tick,&#160;we&#160;have<br/>to&#160;consider&#160;the&#160;ways&#160;in&#160;which&#160;these&#160;parts&#160;interconnect&#160;and&#160;contribute&#160;to&#160;the<br/>operation&#160;of&#160;the&#160;whole.<br/>
A&#160;computer&#160;is&#160;a&#160;physical&#160;machine&#160;that&#160;acts&#160;as&#160;a&#160;host&#160;for&#160;these&#160;immaterial<br/>
machines.&#160;Computers&#160;themselves&#160;can&#160;do&#160;only&#160;stupidly&#160;straightforward&#160;things.<br/>The&#160;reason&#160;they&#160;are&#160;so&#160;useful&#160;is&#160;that&#160;they&#160;do&#160;these&#160;things&#160;at&#160;an&#160;incredibly<br/>high&#160;speed.&#160;A&#160;program&#160;can&#160;ingeniously&#160;combine&#160;an&#160;enormous&#160;number&#160;of&#160;these<br/>simple&#160;actions&#160;to&#160;do&#160;very&#160;complicated&#160;things.<br/>
A&#160;program&#160;is&#160;a&#160;building&#160;of&#160;thought.&#160;It&#160;is&#160;costless&#160;to&#160;build,&#160;it&#160;is&#160;weightless,<br/>
and&#160;it&#160;grows&#160;easily&#160;under&#160;our&#160;typing&#160;hands.<br/>
But&#160;without&#160;care,&#160;a&#160;program’s&#160;size&#160;and&#160;complexity&#160;will&#160;grow&#160;out&#160;of&#160;control,<br/>
confusing&#160;even&#160;the&#160;person&#160;who&#160;created&#160;it.&#160;Keeping&#160;programs&#160;under&#160;control&#160;is<br/>the&#160;main&#160;problem&#160;of&#160;programming.&#160;When&#160;a&#160;program&#160;works,&#160;it&#160;is&#160;beautiful.&#160;The<br/>
2<br/>
<hr/>
<a name=15></a>art&#160;of&#160;programming&#160;is&#160;the&#160;skill&#160;of&#160;controlling&#160;complexity.&#160;The&#160;great&#160;program<br/>is&#160;subdued—made&#160;simple&#160;in&#160;its&#160;complexity.<br/>
Some&#160;programmers&#160;believe&#160;that&#160;this&#160;complexity&#160;is&#160;best&#160;managed&#160;by&#160;using<br/>
only&#160;a&#160;small&#160;set&#160;of&#160;well-understood&#160;techniques&#160;in&#160;their&#160;programs.&#160;They&#160;have<br/>composed&#160;strict&#160;rules&#160;(“best&#160;practices”)&#160;prescribing&#160;the&#160;form&#160;programs&#160;should<br/>have&#160;and&#160;carefully&#160;stay&#160;within&#160;their&#160;safe&#160;little&#160;zone.<br/>
This&#160;is&#160;not&#160;only&#160;boring,&#160;it&#160;is&#160;ineffective.&#160;New&#160;problems&#160;often&#160;require&#160;new<br/>
solutions.&#160;The&#160;field&#160;of&#160;programming&#160;is&#160;young&#160;and&#160;still&#160;developing&#160;rapidly,&#160;and<br/>it&#160;is&#160;varied&#160;enough&#160;to&#160;have&#160;room&#160;for&#160;wildly&#160;different&#160;approaches.&#160;There&#160;are<br/>many&#160;terrible&#160;mistakes&#160;to&#160;make&#160;in&#160;program&#160;design,&#160;and&#160;you&#160;should&#160;go&#160;ahead<br/>and&#160;make&#160;them&#160;so&#160;that&#160;you&#160;understand&#160;them.&#160;A&#160;sense&#160;of&#160;what&#160;a&#160;good&#160;program<br/>looks&#160;like&#160;is&#160;developed&#160;in&#160;practice,&#160;not&#160;learned&#160;from&#160;a&#160;list&#160;of&#160;rules.<br/>
<b>Why&#160;language&#160;matters</b><br/>
In&#160;the&#160;beginning,&#160;at&#160;the&#160;birth&#160;of&#160;computing,&#160;there&#160;were&#160;no&#160;programming&#160;lan-<br/>guages.&#160;Programs&#160;looked&#160;something&#160;like&#160;this:<br/>
00110001&#160;00000000&#160;00000000<br/>00110001&#160;00000001&#160;00000001<br/>00110011&#160;00000001&#160;00000010<br/>01010001&#160;00001011&#160;00000010<br/>00100010&#160;00000010&#160;00001000<br/>01000011&#160;00000001&#160;00000000<br/>01000001&#160;00000001&#160;00000001<br/>00010000&#160;00000010&#160;00000000<br/>01100010&#160;00000000&#160;00000000<br/>
That&#160;is&#160;a&#160;program&#160;to&#160;add&#160;the&#160;numbers&#160;from&#160;1&#160;to&#160;10&#160;together&#160;and&#160;print&#160;out<br/>
the&#160;result:&#160;1&#160;+&#160;2&#160;+&#160;...&#160;+&#160;10&#160;=&#160;55.&#160;It&#160;could&#160;run&#160;on&#160;a&#160;simple,&#160;hypothetical<br/>machine.&#160;To&#160;program&#160;early&#160;computers,&#160;it&#160;was&#160;necessary&#160;to&#160;set&#160;large&#160;arrays&#160;of<br/>switches&#160;in&#160;the&#160;right&#160;position&#160;or&#160;punch&#160;holes&#160;in&#160;strips&#160;of&#160;cardboard&#160;and&#160;feed<br/>them&#160;to&#160;the&#160;computer.&#160;You&#160;can&#160;probably&#160;imagine&#160;how&#160;tedious&#160;and&#160;error-prone<br/>this&#160;procedure&#160;was.&#160;Even&#160;writing&#160;simple&#160;programs&#160;required&#160;much&#160;cleverness<br/>and&#160;discipline.&#160;Complex&#160;ones&#160;were&#160;nearly&#160;inconceivable.<br/>
Of&#160;course,&#160;manually&#160;entering&#160;these&#160;arcane&#160;patterns&#160;of&#160;bits&#160;(the&#160;ones&#160;and<br/>
zeros)&#160;did&#160;give&#160;the&#160;programmer&#160;a&#160;profound&#160;sense&#160;of&#160;being&#160;a&#160;mighty&#160;wizard.<br/>And&#160;that&#160;has&#160;to&#160;be&#160;worth&#160;something&#160;in&#160;terms&#160;of&#160;job&#160;satisfaction.<br/>
Each&#160;line&#160;of&#160;the&#160;previous&#160;program&#160;contains&#160;a&#160;single&#160;instruction.&#160;It&#160;could&#160;be<br/>
written&#160;in&#160;English&#160;like&#160;this:<br/>
3<br/>
<hr/>
<a name=16></a>1.&#160;Store&#160;the&#160;number&#160;0&#160;in&#160;memory&#160;location&#160;0.<br/>
2.&#160;Store&#160;the&#160;number&#160;1&#160;in&#160;memory&#160;location&#160;1.<br/>
3.&#160;Store&#160;the&#160;value&#160;of&#160;memory&#160;location&#160;1&#160;in&#160;memory&#160;location&#160;2.<br/>
4.&#160;Subtract&#160;the&#160;number&#160;11&#160;from&#160;the&#160;value&#160;in&#160;memory&#160;location&#160;2.<br/>
5.&#160;If&#160;the&#160;value&#160;in&#160;memory&#160;location&#160;2&#160;is&#160;the&#160;number&#160;0,&#160;continue&#160;with&#160;instruc-<br/>
tion&#160;9.<br/>
6.&#160;Add&#160;the&#160;value&#160;of&#160;memory&#160;location&#160;1&#160;to&#160;memory&#160;location&#160;0.<br/>
7.&#160;Add&#160;the&#160;number&#160;1&#160;to&#160;the&#160;value&#160;of&#160;memory&#160;location&#160;1.<br/>
8.&#160;Continue&#160;with&#160;instruction&#160;3.<br/>
9.&#160;Output&#160;the&#160;value&#160;of&#160;memory&#160;location&#160;0.<br/>
Although&#160;that&#160;is&#160;already&#160;more&#160;readable&#160;than&#160;the&#160;soup&#160;of&#160;bits,&#160;it&#160;is&#160;still&#160;rather<br/>
obscure.&#160;Using&#160;names&#160;instead&#160;of&#160;numbers&#160;for&#160;the&#160;instructions&#160;and&#160;memory<br/>locations&#160;helps.<br/>
Set&#160;“total”&#160;to&#160;0.<br/>Set&#160;“count”&#160;to&#160;1.<br/>
[loop]<br/>
Set&#160;“compare”&#160;to&#160;“count”.<br/>Subtract&#160;11&#160;from&#160;“compare”.<br/>If&#160;“compare”&#160;is&#160;zero,&#160;continue&#160;at&#160;[end].<br/>Add&#160;“count”&#160;to&#160;“total”.<br/>Add&#160;1&#160;to&#160;“count”.<br/>Continue&#160;at&#160;[loop].<br/>
[end]<br/>
Output&#160;“total”.<br/>
Can&#160;you&#160;see&#160;how&#160;the&#160;program&#160;works&#160;at&#160;this&#160;point?&#160;The&#160;first&#160;two&#160;lines&#160;give<br/>
two&#160;memory&#160;locations&#160;their&#160;starting&#160;values:&#160;total&#160;will&#160;be&#160;used&#160;to&#160;build&#160;up&#160;the<br/>result&#160;of&#160;the&#160;computation,&#160;and&#160;count&#160;will&#160;keep&#160;track&#160;of&#160;the&#160;number&#160;that&#160;we&#160;are<br/>currently&#160;looking&#160;at.&#160;The&#160;lines&#160;using&#160;compare&#160;are&#160;probably&#160;the&#160;weirdest&#160;ones.<br/>The&#160;program&#160;wants&#160;to&#160;see&#160;whether&#160;count&#160;is&#160;equal&#160;to&#160;11&#160;to&#160;decide&#160;whether&#160;it<br/>can&#160;stop&#160;running.&#160;Because&#160;our&#160;hypothetical&#160;machine&#160;is&#160;rather&#160;primitive,&#160;it&#160;can<br/>only&#160;test&#160;whether&#160;a&#160;number&#160;is&#160;zero&#160;and&#160;make&#160;a&#160;decision&#160;based&#160;on&#160;that.&#160;So&#160;it<br/>uses&#160;the&#160;memory&#160;location&#160;labeled&#160;compare&#160;to&#160;compute&#160;the&#160;value&#160;of&#160;count&#160;-&#160;11<br/>and&#160;makes&#160;a&#160;decision&#160;based&#160;on&#160;that&#160;value.&#160;The&#160;next&#160;two&#160;lines&#160;add&#160;the&#160;value<br/>
4<br/>
<hr/>
<a name=17></a>of&#160;count&#160;to&#160;the&#160;result&#160;and&#160;increment&#160;count&#160;by&#160;1&#160;every&#160;time&#160;the&#160;program&#160;has<br/>decided&#160;that&#160;count&#160;is&#160;not&#160;11&#160;yet.<br/>
Here&#160;is&#160;the&#160;same&#160;program&#160;in&#160;JavaScript:<br/>
let&#160;total&#160;=&#160;0,&#160;count&#160;=&#160;1;<br/>while&#160;(count&#160;&lt;=&#160;10)&#160;{<br/>
total&#160;+=&#160;count;<br/>count&#160;+=&#160;1;<br/>
}<br/>console.log(total);<br/>//&#160;→&#160;55<br/>
This&#160;version&#160;gives&#160;us&#160;a&#160;few&#160;more&#160;improvements.&#160;Most&#160;important,&#160;there&#160;is<br/>
no&#160;need&#160;to&#160;specify&#160;the&#160;way&#160;we&#160;want&#160;the&#160;program&#160;to&#160;jump&#160;back&#160;and&#160;forth<br/>anymore.&#160;The&#160;while&#160;construct&#160;takes&#160;care&#160;of&#160;that.&#160;It&#160;continues&#160;executing&#160;the<br/>block&#160;(wrapped&#160;in&#160;braces)&#160;below&#160;it&#160;as&#160;long&#160;as&#160;the&#160;condition&#160;it&#160;was&#160;given&#160;holds.<br/>That&#160;condition&#160;is&#160;count&#160;&lt;=&#160;10,&#160;which&#160;means&#160;“<i>count&#160;</i>is&#160;less&#160;than&#160;or&#160;equal&#160;to&#160;10”.<br/>We&#160;no&#160;longer&#160;have&#160;to&#160;create&#160;a&#160;temporary&#160;value&#160;and&#160;compare&#160;that&#160;to&#160;zero,&#160;which<br/>was&#160;just&#160;an&#160;uninteresting&#160;detail.&#160;Part&#160;of&#160;the&#160;power&#160;of&#160;programming&#160;languages<br/>is&#160;that&#160;they&#160;can&#160;take&#160;care&#160;of&#160;uninteresting&#160;details&#160;for&#160;us.<br/>
At&#160;the&#160;end&#160;of&#160;the&#160;program,&#160;after&#160;the&#160;while&#160;construct&#160;has&#160;finished,&#160;the&#160;console<br/>
.log&#160;operation&#160;is&#160;used&#160;to&#160;write&#160;out&#160;the&#160;result.<br/>
Finally,&#160;here&#160;is&#160;what&#160;the&#160;program&#160;could&#160;look&#160;like&#160;if&#160;we&#160;happened&#160;to&#160;have<br/>
the&#160;convenient&#160;operations&#160;range&#160;and&#160;sum&#160;available,&#160;which&#160;respectively&#160;create&#160;a<br/>collection&#160;of&#160;numbers&#160;within&#160;a&#160;range&#160;and&#160;compute&#160;the&#160;sum&#160;of&#160;a&#160;collection&#160;of<br/>numbers:<br/>
console.log(sum(range(1,&#160;10)));<br/>//&#160;→&#160;55<br/>
The&#160;moral&#160;of&#160;this&#160;story&#160;is&#160;that&#160;the&#160;same&#160;program&#160;can&#160;be&#160;expressed&#160;in&#160;both<br/>
long&#160;and&#160;short,&#160;unreadable&#160;and&#160;readable&#160;ways.&#160;The&#160;first&#160;version&#160;of&#160;the&#160;program<br/>was&#160;extremely&#160;obscure,&#160;whereas&#160;this&#160;last&#160;one&#160;is&#160;almost&#160;English:&#160;log&#160;the&#160;sum&#160;of<br/>the&#160;range&#160;of&#160;numbers&#160;from&#160;1&#160;to&#160;10.&#160;(We&#160;will&#160;see&#160;in&#160;<a href="eloquent-javascripts.html#69">later&#160;chapters&#160;</a>how&#160;to&#160;define<br/>operations&#160;like&#160;sum&#160;and&#160;range.)<br/>
A&#160;good&#160;programming&#160;language&#160;helps&#160;the&#160;programmer&#160;by&#160;allowing&#160;them&#160;to<br/>
talk&#160;about&#160;the&#160;actions&#160;that&#160;the&#160;computer&#160;has&#160;to&#160;perform&#160;on&#160;a&#160;higher&#160;level.<br/>It&#160;helps&#160;omit&#160;details,&#160;provides&#160;convenient&#160;building&#160;blocks&#160;(such&#160;as&#160;while&#160;and<br/>console.log),&#160;allows&#160;you&#160;to&#160;define&#160;your&#160;own&#160;building&#160;blocks&#160;(such&#160;as&#160;sum&#160;and<br/>range),&#160;and&#160;makes&#160;those&#160;blocks&#160;easy&#160;to&#160;compose.<br/>
5<br/>
<hr/>
<a name=18></a><b>What&#160;is&#160;JavaScript?</b><br/>
JavaScript&#160;was&#160;introduced&#160;in&#160;1995&#160;as&#160;a&#160;way&#160;to&#160;add&#160;programs&#160;to&#160;web&#160;pages&#160;in&#160;the<br/>Netscape&#160;Navigator&#160;browser.&#160;The&#160;language&#160;has&#160;since&#160;been&#160;adopted&#160;by&#160;all&#160;other<br/>major&#160;graphical&#160;web&#160;browsers.&#160;It&#160;has&#160;made&#160;modern&#160;web&#160;applications&#160;possible—<br/>applications&#160;with&#160;which&#160;you&#160;can&#160;interact&#160;directly&#160;without&#160;doing&#160;a&#160;page&#160;reload<br/>for&#160;every&#160;action.&#160;JavaScript&#160;is&#160;also&#160;used&#160;in&#160;more&#160;traditional&#160;websites&#160;to&#160;provide<br/>various&#160;forms&#160;of&#160;interactivity&#160;and&#160;cleverness.<br/>
It&#160;is&#160;important&#160;to&#160;note&#160;that&#160;JavaScript&#160;has&#160;almost&#160;nothing&#160;to&#160;do&#160;with&#160;the<br/>
programming&#160;language&#160;named&#160;Java.&#160;The&#160;similar&#160;name&#160;was&#160;inspired&#160;by&#160;mar-<br/>keting&#160;considerations&#160;rather&#160;than&#160;good&#160;judgment.&#160;When&#160;JavaScript&#160;was&#160;being<br/>introduced,&#160;the&#160;Java&#160;language&#160;was&#160;being&#160;heavily&#160;marketed&#160;and&#160;was&#160;gaining<br/>popularity.&#160;Someone&#160;thought&#160;it&#160;was&#160;a&#160;good&#160;idea&#160;to&#160;try&#160;to&#160;ride&#160;along&#160;on&#160;this<br/>success.&#160;Now&#160;we&#160;are&#160;stuck&#160;with&#160;the&#160;name.<br/>
After&#160;its&#160;adoption&#160;outside&#160;of&#160;Netscape,&#160;a&#160;standard&#160;document&#160;was&#160;written<br/>
to&#160;describe&#160;the&#160;way&#160;the&#160;JavaScript&#160;language&#160;should&#160;work&#160;so&#160;that&#160;the&#160;various<br/>pieces&#160;of&#160;software&#160;that&#160;claimed&#160;to&#160;support&#160;JavaScript&#160;were&#160;actually&#160;talking<br/>about&#160;the&#160;same&#160;language.&#160;This&#160;is&#160;called&#160;the&#160;ECMAScript&#160;standard,&#160;after&#160;the<br/>Ecma&#160;International&#160;organization&#160;that&#160;did&#160;the&#160;standardization.&#160;In&#160;practice,&#160;the<br/>terms&#160;ECMAScript&#160;and&#160;JavaScript&#160;can&#160;be&#160;used&#160;interchangeably—they&#160;are&#160;two<br/>names&#160;for&#160;the&#160;same&#160;language.<br/>
There&#160;are&#160;those&#160;who&#160;will&#160;say&#160;<i>terrible&#160;</i>things&#160;about&#160;JavaScript.&#160;Many&#160;of&#160;these<br/>
things&#160;are&#160;true.&#160;When&#160;I&#160;was&#160;required&#160;to&#160;write&#160;something&#160;in&#160;JavaScript&#160;for&#160;the<br/>first&#160;time,&#160;I&#160;quickly&#160;came&#160;to&#160;despise&#160;it.&#160;It&#160;would&#160;accept&#160;almost&#160;anything&#160;I&#160;typed<br/>but&#160;interpret&#160;it&#160;in&#160;a&#160;way&#160;that&#160;was&#160;completely&#160;different&#160;from&#160;what&#160;I&#160;meant.&#160;This<br/>had&#160;a&#160;lot&#160;to&#160;do&#160;with&#160;the&#160;fact&#160;that&#160;I&#160;did&#160;not&#160;have&#160;a&#160;clue&#160;what&#160;I&#160;was&#160;doing,&#160;of<br/>course,&#160;but&#160;there&#160;is&#160;a&#160;real&#160;issue&#160;here:&#160;JavaScript&#160;is&#160;ridiculously&#160;liberal&#160;in&#160;what<br/>it&#160;allows.&#160;The&#160;idea&#160;behind&#160;this&#160;design&#160;was&#160;that&#160;it&#160;would&#160;make&#160;programming&#160;in<br/>JavaScript&#160;easier&#160;for&#160;beginners.&#160;In&#160;actuality,&#160;it&#160;mostly&#160;makes&#160;finding&#160;problems<br/>in&#160;your&#160;programs&#160;harder&#160;because&#160;the&#160;system&#160;will&#160;not&#160;point&#160;them&#160;out&#160;to&#160;you.<br/>
This&#160;flexibility&#160;also&#160;has&#160;its&#160;advantages,&#160;though.&#160;It&#160;leaves&#160;space&#160;for&#160;a&#160;lot&#160;of<br/>
techniques&#160;that&#160;are&#160;impossible&#160;in&#160;more&#160;rigid&#160;languages,&#160;and&#160;as&#160;you&#160;will&#160;see<br/>(for&#160;example&#160;in&#160;<a href="eloquent-javascripts.html#179">Chapter&#160;10),&#160;</a>it&#160;can&#160;be&#160;used&#160;to&#160;overcome&#160;some&#160;of&#160;JavaScript’s<br/>shortcomings.&#160;After&#160;learning&#160;the&#160;language&#160;properly&#160;and&#160;working&#160;with&#160;it&#160;for&#160;a<br/>while,&#160;I&#160;have&#160;learned&#160;to&#160;actually&#160;<i>like&#160;</i>JavaScript.<br/>
There&#160;have&#160;been&#160;several&#160;versions&#160;of&#160;JavaScript.&#160;ECMAScript&#160;version&#160;3&#160;was<br/>
the&#160;widely&#160;supported&#160;version&#160;in&#160;the&#160;time&#160;of&#160;JavaScript’s&#160;ascent&#160;to&#160;dominance,<br/>roughly&#160;between&#160;2000&#160;and&#160;2010.&#160;During&#160;this&#160;time,&#160;work&#160;was&#160;underway&#160;on<br/>an&#160;ambitious&#160;version&#160;4,&#160;which&#160;planned&#160;a&#160;number&#160;of&#160;radical&#160;improvements&#160;and<br/>extensions&#160;to&#160;the&#160;language.&#160;Changing&#160;a&#160;living,&#160;widely&#160;used&#160;language&#160;in&#160;such&#160;a<br/>
6<br/>
<hr/>
<a name=19></a>radical&#160;way&#160;turned&#160;out&#160;to&#160;be&#160;politically&#160;difficult,&#160;and&#160;work&#160;on&#160;the&#160;version&#160;4&#160;was<br/>abandoned&#160;in&#160;2008,&#160;leading&#160;to&#160;a&#160;much&#160;less&#160;ambitious&#160;version&#160;5,&#160;which&#160;made<br/>only&#160;some&#160;uncontroversial&#160;improvements,&#160;coming&#160;out&#160;in&#160;2009.&#160;Then&#160;in&#160;2015<br/>version&#160;6&#160;came&#160;out,&#160;a&#160;major&#160;update&#160;that&#160;included&#160;some&#160;of&#160;the&#160;ideas&#160;planned<br/>for&#160;version&#160;4.&#160;Since&#160;then&#160;we’ve&#160;had&#160;new,&#160;small&#160;updates&#160;every&#160;year.<br/>
The&#160;fact&#160;that&#160;the&#160;language&#160;is&#160;evolving&#160;means&#160;that&#160;browsers&#160;have&#160;to&#160;constantly<br/>
keep&#160;up,&#160;and&#160;if&#160;you’re&#160;using&#160;an&#160;older&#160;browser,&#160;it&#160;may&#160;not&#160;support&#160;every&#160;feature.<br/>The&#160;language&#160;designers&#160;are&#160;careful&#160;to&#160;not&#160;make&#160;any&#160;changes&#160;that&#160;could&#160;break<br/>existing&#160;programs,&#160;so&#160;new&#160;browsers&#160;can&#160;still&#160;run&#160;old&#160;programs.&#160;In&#160;this&#160;book,<br/>I’m&#160;using&#160;the&#160;2017&#160;version&#160;of&#160;JavaScript.<br/>
Web&#160;browsers&#160;are&#160;not&#160;the&#160;only&#160;platforms&#160;on&#160;which&#160;JavaScript&#160;is&#160;used.&#160;Some<br/>
databases,&#160;such&#160;as&#160;MongoDB&#160;and&#160;CouchDB,&#160;use&#160;JavaScript&#160;as&#160;their&#160;scripting<br/>and&#160;query&#160;language.&#160;Several&#160;platforms&#160;for&#160;desktop&#160;and&#160;server&#160;programming,<br/>most&#160;notably&#160;the&#160;Node.js&#160;project&#160;(the&#160;subject&#160;of&#160;<a href="eloquent-javascripts.html#362">Chapter&#160;20</a>),&#160;provide&#160;an&#160;envi-<br/>ronment&#160;for&#160;programming&#160;JavaScript&#160;outside&#160;of&#160;the&#160;browser.<br/>
<b>Code,&#160;and&#160;what&#160;to&#160;do&#160;with&#160;it</b><br/>
<i>Code&#160;</i>is&#160;the&#160;text&#160;that&#160;makes&#160;up&#160;programs.&#160;Most&#160;chapters&#160;in&#160;this&#160;book&#160;contain<br/>quite&#160;a&#160;lot&#160;of&#160;code.&#160;I&#160;believe&#160;reading&#160;code&#160;and&#160;writing&#160;code&#160;are&#160;indispensable<br/>parts&#160;of&#160;learning&#160;to&#160;program.&#160;Try&#160;to&#160;not&#160;just&#160;glance&#160;over&#160;the&#160;examples—read<br/>them&#160;attentively&#160;and&#160;understand&#160;them.&#160;This&#160;may&#160;be&#160;slow&#160;and&#160;confusing&#160;at<br/>first,&#160;but&#160;I&#160;promise&#160;that&#160;you’ll&#160;quickly&#160;get&#160;the&#160;hang&#160;of&#160;it.&#160;The&#160;same&#160;goes&#160;for<br/>the&#160;exercises.&#160;Don’t&#160;assume&#160;you&#160;understand&#160;them&#160;until&#160;you’ve&#160;actually&#160;written<br/>a&#160;working&#160;solution.<br/>
I&#160;recommend&#160;you&#160;try&#160;your&#160;solutions&#160;to&#160;exercises&#160;in&#160;an&#160;actual&#160;JavaScript<br/>
interpreter.&#160;That&#160;way,&#160;you’ll&#160;get&#160;immediate&#160;feedback&#160;on&#160;whether&#160;what&#160;you&#160;are<br/>doing&#160;is&#160;working,&#160;and,&#160;I&#160;hope,&#160;you’ll&#160;be&#160;tempted&#160;to&#160;experiment&#160;and&#160;go&#160;beyond<br/>the&#160;exercises.<br/>
The&#160;easiest&#160;way&#160;to&#160;run&#160;the&#160;example&#160;code&#160;in&#160;the&#160;book,&#160;and&#160;to&#160;experiment&#160;with<br/>
it,&#160;is&#160;to&#160;look&#160;it&#160;up&#160;in&#160;the&#160;online&#160;version&#160;of&#160;the&#160;book&#160;at&#160;<a href="https://eloquentjavascript.net/"><i>https://eloquentjavascript.net</i></a>.<br/>There,&#160;you&#160;can&#160;click&#160;any&#160;code&#160;example&#160;to&#160;edit&#160;and&#160;run&#160;it&#160;and&#160;to&#160;see&#160;the&#160;output<br/>it&#160;produces.&#160;To&#160;work&#160;on&#160;the&#160;exercises,&#160;go&#160;to&#160;<a href="https://eloquentjavascript.net/code"><i>https://eloquentjavascript.net/<br/>code</i>,&#160;</a>which&#160;provides&#160;starting&#160;code&#160;for&#160;each&#160;coding&#160;exercise&#160;and&#160;allows&#160;you&#160;to<br/>look&#160;at&#160;the&#160;solutions.<br/>
If&#160;you&#160;want&#160;to&#160;run&#160;the&#160;programs&#160;defined&#160;in&#160;this&#160;book&#160;outside&#160;of&#160;the&#160;book’s<br/>
website,&#160;some&#160;care&#160;will&#160;be&#160;required.&#160;Many&#160;examples&#160;stand&#160;on&#160;their&#160;own&#160;and<br/>should&#160;work&#160;in&#160;any&#160;JavaScript&#160;environment.&#160;But&#160;code&#160;in&#160;later&#160;chapters&#160;is<br/>often&#160;written&#160;for&#160;a&#160;specific&#160;environment&#160;(the&#160;browser&#160;or&#160;Node.js)&#160;and&#160;can&#160;run<br/>
7<br/>
<hr/>
<a name=20></a>only&#160;there.&#160;In&#160;addition,&#160;many&#160;chapters&#160;define&#160;bigger&#160;programs,&#160;and&#160;the&#160;pieces<br/>of&#160;code&#160;that&#160;appear&#160;in&#160;them&#160;depend&#160;on&#160;each&#160;other&#160;or&#160;on&#160;external&#160;files.&#160;The<br/><a href="https://eloquentjavascript.net/code">sandbox&#160;</a>on&#160;the&#160;website&#160;provides&#160;links&#160;to&#160;Zip&#160;files&#160;containing&#160;all&#160;the&#160;scripts&#160;and<br/>data&#160;files&#160;necessary&#160;to&#160;run&#160;the&#160;code&#160;for&#160;a&#160;given&#160;chapter.<br/>
<b>Overview&#160;of&#160;this&#160;book</b><br/>
This&#160;book&#160;contains&#160;roughly&#160;three&#160;parts.&#160;The&#160;first&#160;12&#160;chapters&#160;discuss&#160;the<br/>JavaScript&#160;language.&#160;The&#160;next&#160;seven&#160;chapters&#160;are&#160;about&#160;web&#160;browsers&#160;and&#160;the<br/>way&#160;JavaScript&#160;is&#160;used&#160;to&#160;program&#160;them.&#160;Finally,&#160;two&#160;chapters&#160;are&#160;devoted&#160;to<br/>Node.js,&#160;another&#160;environment&#160;to&#160;program&#160;JavaScript&#160;in.<br/>
Throughout&#160;the&#160;book,&#160;there&#160;are&#160;five&#160;<i>project&#160;chapters</i>,&#160;which&#160;describe&#160;larger<br/>
example&#160;programs&#160;to&#160;give&#160;you&#160;a&#160;taste&#160;of&#160;actual&#160;programming.&#160;In&#160;order&#160;of<br/>appearance,&#160;we&#160;will&#160;work&#160;through&#160;building&#160;a&#160;<a href="eloquent-javascripts.html#129">delivery&#160;robot,&#160;</a>a&#160;<a href="eloquent-javascripts.html#214">programming<br/>language,&#160;</a>a&#160;<a href="eloquent-javascripts.html#273">platform&#160;game</a>,&#160;a&#160;<a href="eloquent-javascripts.html#342">pixel&#160;paint&#160;program,&#160;</a>and&#160;a&#160;<a href="eloquent-javascripts.html#381">dynamic&#160;website.</a><br/>
The&#160;language&#160;part&#160;of&#160;the&#160;book&#160;starts&#160;with&#160;four&#160;chapters&#160;that&#160;introduce&#160;the<br/>
basic&#160;structure&#160;of&#160;the&#160;JavaScript&#160;language.&#160;They&#160;introduce&#160;<a href="eloquent-javascripts.html#34">control&#160;structures<br/></a>(such&#160;as&#160;the&#160;while&#160;word&#160;you&#160;saw&#160;in&#160;this&#160;introduction),&#160;<a href="eloquent-javascripts.html#51">functions&#160;</a>(writing&#160;your<br/>own&#160;building&#160;blocks),&#160;and&#160;<a href="eloquent-javascripts.html#69">data&#160;structures</a>.&#160;After&#160;these,&#160;you&#160;will&#160;be&#160;able&#160;to&#160;write<br/>basic&#160;programs.&#160;Next,&#160;Chapters&#160;<a href="eloquent-javascripts.html#94">5&#160;</a>and&#160;<a href="eloquent-javascripts.html#109">6&#160;</a>introduce&#160;techniques&#160;to&#160;use&#160;functions<br/>and&#160;objects&#160;to&#160;write&#160;more&#160;<i>abstract&#160;</i>code&#160;and&#160;keep&#160;complexity&#160;under&#160;control.<br/>
After&#160;a&#160;<a href="eloquent-javascripts.html#129">first&#160;project&#160;chapter</a>,&#160;the&#160;language&#160;part&#160;of&#160;the&#160;book&#160;continues&#160;with<br/>
chapters&#160;on&#160;<a href="eloquent-javascripts.html#140">error&#160;handling&#160;and&#160;bug&#160;fixing</a>,&#160;<a href="eloquent-javascripts.html#155">regular&#160;expressions&#160;</a>(an&#160;important<br/>tool&#160;for&#160;working&#160;with&#160;text),&#160;<a href="eloquent-javascripts.html#179">modularity&#160;</a>(another&#160;defense&#160;against&#160;complexity),<br/>and&#160;<a href="eloquent-javascripts.html#192">asynchronous&#160;programming&#160;</a>(dealing&#160;with&#160;events&#160;that&#160;take&#160;time).&#160;The<br/><a href="eloquent-javascripts.html#214">second&#160;project&#160;chapter&#160;</a>concludes&#160;the&#160;first&#160;part&#160;of&#160;the&#160;book.<br/>
The&#160;second&#160;part,&#160;Chapters&#160;<a href="eloquent-javascripts.html#228">13&#160;</a>to&#160;<a href="eloquent-javascripts.html#342">19</a>,&#160;describes&#160;the&#160;tools&#160;that&#160;browser&#160;JavaScript<br/>
has&#160;access&#160;to.&#160;You’ll&#160;learn&#160;to&#160;display&#160;things&#160;on&#160;the&#160;screen&#160;(Chapters&#160;<a href="eloquent-javascripts.html#236">14&#160;</a>and<br/><a href="eloquent-javascripts.html#296">17),&#160;</a>respond&#160;to&#160;user&#160;input&#160;<a href="eloquent-javascripts.html#255">(Chapter&#160;15),&#160;</a>and&#160;communicate&#160;over&#160;the&#160;network<br/><a href="eloquent-javascripts.html#320">(Chapter&#160;18</a>).&#160;There&#160;are&#160;again&#160;two&#160;project&#160;chapters&#160;in&#160;this&#160;part.<br/>
After&#160;that,&#160;<a href="eloquent-javascripts.html#362">Chapter&#160;20&#160;</a>describes&#160;Node.js,&#160;and&#160;<a href="eloquent-javascripts.html#381">Chapter&#160;21&#160;</a>builds&#160;a&#160;small<br/>
website&#160;using&#160;that&#160;tool.<br/>
<b>Typographic&#160;conventions</b><br/>
In&#160;this&#160;book,&#160;text&#160;written&#160;in&#160;a&#160;monospaced&#160;font&#160;will&#160;represent&#160;elements&#160;of<br/>programs—sometimes&#160;they&#160;are&#160;self-sufficient&#160;fragments,&#160;and&#160;sometimes&#160;they<br/>just&#160;refer&#160;to&#160;part&#160;of&#160;a&#160;nearby&#160;program.&#160;Programs&#160;(of&#160;which&#160;you&#160;have&#160;already<br/>seen&#160;a&#160;few)&#160;are&#160;written&#160;as&#160;follows:<br/>
8<br/>
<hr/>
<a name=21></a>function&#160;factorial(n)&#160;{<br/>
if&#160;(n&#160;==&#160;0)&#160;{<br/>
return&#160;1;<br/>
}&#160;else&#160;{<br/>
return&#160;factorial(n&#160;-&#160;1)&#160;*&#160;n;<br/>
}<br/>
}<br/>
Sometimes,&#160;to&#160;show&#160;the&#160;output&#160;that&#160;a&#160;program&#160;produces,&#160;the&#160;expected&#160;out-<br/>
put&#160;is&#160;written&#160;after&#160;it,&#160;with&#160;two&#160;slashes&#160;and&#160;an&#160;arrow&#160;in&#160;front.<br/>
console.log(factorial(8));<br/>//&#160;→&#160;40320<br/>
Good&#160;luck!<br/>
9<br/>
<hr/>
<a name=22></a><i>“Below&#160;the&#160;surface&#160;of&#160;the&#160;machine,&#160;the&#160;program&#160;moves.&#160;Without</i><br/>
<i>effort,&#160;it&#160;expands&#160;and&#160;contracts.&#160;In&#160;great&#160;harmony,&#160;electrons&#160;scatter<br/>and&#160;regroup.&#160;The&#160;forms&#160;on&#160;the&#160;monitor&#160;are&#160;but&#160;ripples&#160;on&#160;the&#160;water.<br/>The&#160;essence&#160;stays&#160;invisibly&#160;below.”</i><br/>
—Master&#160;Yuan-Ma,&#160;The&#160;Book&#160;of&#160;Programming<br/>
<b>Chapter&#160;1<br/>Values,&#160;Types,&#160;and&#160;Operators</b><br/>
Inside&#160;the&#160;computer’s&#160;world,&#160;there&#160;is&#160;only&#160;data.&#160;You&#160;can&#160;read&#160;data,&#160;modify<br/>data,&#160;create&#160;new&#160;data—but&#160;that&#160;which&#160;isn’t&#160;data&#160;cannot&#160;be&#160;mentioned.&#160;All<br/>this&#160;data&#160;is&#160;stored&#160;as&#160;long&#160;sequences&#160;of&#160;bits&#160;and&#160;is&#160;thus&#160;fundamentally&#160;alike.<br/>
<i>Bits&#160;</i>are&#160;any&#160;kind&#160;of&#160;two-valued&#160;things,&#160;usually&#160;described&#160;as&#160;zeros&#160;and&#160;ones.<br/>
Inside&#160;the&#160;computer,&#160;they&#160;take&#160;forms&#160;such&#160;as&#160;a&#160;high&#160;or&#160;low&#160;electrical&#160;charge,<br/>a&#160;strong&#160;or&#160;weak&#160;signal,&#160;or&#160;a&#160;shiny&#160;or&#160;dull&#160;spot&#160;on&#160;the&#160;surface&#160;of&#160;a&#160;CD.&#160;Any<br/>piece&#160;of&#160;discrete&#160;information&#160;can&#160;be&#160;reduced&#160;to&#160;a&#160;sequence&#160;of&#160;zeros&#160;and&#160;ones<br/>and&#160;thus&#160;represented&#160;in&#160;bits.<br/>
For&#160;example,&#160;we&#160;can&#160;express&#160;the&#160;number&#160;13&#160;in&#160;bits.&#160;It&#160;works&#160;the&#160;same&#160;way<br/>
as&#160;a&#160;decimal&#160;number,&#160;but&#160;instead&#160;of&#160;10&#160;different&#160;digits,&#160;you&#160;have&#160;only&#160;2,&#160;and<br/>the&#160;weight&#160;of&#160;each&#160;increases&#160;by&#160;a&#160;factor&#160;of&#160;2&#160;from&#160;right&#160;to&#160;left.&#160;Here&#160;are&#160;the<br/>bits&#160;that&#160;make&#160;up&#160;the&#160;number&#160;13,&#160;with&#160;the&#160;weights&#160;of&#160;the&#160;digits&#160;shown&#160;below<br/>them:<br/>
0<br/>
0<br/>
0<br/>
0<br/>
1<br/>
1<br/>
0<br/>
1<br/>
128<br/>
64<br/>
32<br/>
16<br/>
8<br/>
4<br/>
2<br/>
1<br/>
So&#160;that’s&#160;the&#160;binary&#160;number&#160;00001101.&#160;Its&#160;non-zero&#160;digits&#160;stand&#160;for&#160;8,&#160;4,&#160;and<br/>
1,&#160;and&#160;add&#160;up&#160;to&#160;13.<br/>
<b>Values</b><br/>
Imagine&#160;a&#160;sea&#160;of&#160;bits—an&#160;ocean&#160;of&#160;them.&#160;A&#160;typical&#160;modern&#160;computer&#160;has&#160;more<br/>than&#160;30&#160;billion&#160;bits&#160;in&#160;its&#160;volatile&#160;data&#160;storage&#160;(working&#160;memory).&#160;Nonvolatile<br/>storage&#160;(the&#160;hard&#160;disk&#160;or&#160;equivalent)&#160;tends&#160;to&#160;have&#160;yet&#160;a&#160;few&#160;orders&#160;of&#160;magnitude<br/>more.<br/>
To&#160;be&#160;able&#160;to&#160;work&#160;with&#160;such&#160;quantities&#160;of&#160;bits&#160;without&#160;getting&#160;lost,&#160;we&#160;must<br/>
separate&#160;them&#160;into&#160;chunks&#160;that&#160;represent&#160;pieces&#160;of&#160;information.&#160;In&#160;a&#160;JavaScript<br/>environment,&#160;those&#160;chunks&#160;are&#160;called&#160;<i>values</i>.&#160;Though&#160;all&#160;values&#160;are&#160;made&#160;of&#160;bits,<br/>they&#160;play&#160;different&#160;roles.&#160;Every&#160;value&#160;has&#160;a&#160;type&#160;that&#160;determines&#160;its&#160;role.&#160;Some<br/>
10<br/>
<hr/>
<a name=23></a>values&#160;are&#160;numbers,&#160;some&#160;values&#160;are&#160;pieces&#160;of&#160;text,&#160;some&#160;values&#160;are&#160;functions,<br/>and&#160;so&#160;on.<br/>
To&#160;create&#160;a&#160;value,&#160;you&#160;must&#160;merely&#160;invoke&#160;its&#160;name.&#160;This&#160;is&#160;convenient.&#160;You<br/>
don’t&#160;have&#160;to&#160;gather&#160;building&#160;material&#160;for&#160;your&#160;values&#160;or&#160;pay&#160;for&#160;them.&#160;You<br/>just&#160;call&#160;for&#160;one,&#160;and&#160;<i>whoosh</i>,&#160;you&#160;have&#160;it.&#160;They&#160;are&#160;not&#160;really&#160;created&#160;from<br/>thin&#160;air,&#160;of&#160;course.&#160;Every&#160;value&#160;has&#160;to&#160;be&#160;stored&#160;somewhere,&#160;and&#160;if&#160;you&#160;want&#160;to<br/>use&#160;a&#160;gigantic&#160;amount&#160;of&#160;them&#160;at&#160;the&#160;same&#160;time,&#160;you&#160;might&#160;run&#160;out&#160;of&#160;memory.<br/>Fortunately,&#160;this&#160;is&#160;a&#160;problem&#160;only&#160;if&#160;you&#160;need&#160;them&#160;all&#160;simultaneously.&#160;As<br/>soon&#160;as&#160;you&#160;no&#160;longer&#160;use&#160;a&#160;value,&#160;it&#160;will&#160;dissipate,&#160;leaving&#160;behind&#160;its&#160;bits&#160;to<br/>be&#160;recycled&#160;as&#160;building&#160;material&#160;for&#160;the&#160;next&#160;generation&#160;of&#160;values.<br/>
This&#160;chapter&#160;introduces&#160;the&#160;atomic&#160;elements&#160;of&#160;JavaScript&#160;programs,&#160;that&#160;is,<br/>
the&#160;simple&#160;value&#160;types&#160;and&#160;the&#160;operators&#160;that&#160;can&#160;act&#160;on&#160;such&#160;values.<br/>
<b>Numbers</b><br/>
Values&#160;of&#160;the&#160;<i>number&#160;</i>type&#160;are,&#160;unsurprisingly,&#160;numeric&#160;values.&#160;In&#160;a&#160;JavaScript<br/>program,&#160;they&#160;are&#160;written&#160;as&#160;follows:<br/>
13<br/>
Use&#160;that&#160;in&#160;a&#160;program,&#160;and&#160;it&#160;will&#160;cause&#160;the&#160;bit&#160;pattern&#160;for&#160;the&#160;number&#160;13<br/>
to&#160;come&#160;into&#160;existence&#160;inside&#160;the&#160;computer’s&#160;memory.<br/>
JavaScript&#160;uses&#160;a&#160;fixed&#160;number&#160;of&#160;bits,&#160;64&#160;of&#160;them,&#160;to&#160;store&#160;a&#160;single&#160;number<br/>
value.&#160;There&#160;are&#160;only&#160;so&#160;many&#160;patterns&#160;you&#160;can&#160;make&#160;with&#160;64&#160;bits,&#160;which&#160;means<br/>that&#160;the&#160;number&#160;of&#160;different&#160;numbers&#160;that&#160;can&#160;be&#160;represented&#160;is&#160;limited.&#160;With<br/><i>N&#160;</i>decimal&#160;digits,&#160;you&#160;can&#160;represent&#160;10N&#160;numbers.&#160;Similarly,&#160;given&#160;64&#160;binary<br/>digits,&#160;you&#160;can&#160;represent&#160;264&#160;different&#160;numbers,&#160;which&#160;is&#160;about&#160;18&#160;quintillion<br/>(an&#160;18&#160;with&#160;18&#160;zeros&#160;after&#160;it).&#160;That’s&#160;a&#160;lot.<br/>
Computer&#160;memory&#160;used&#160;to&#160;be&#160;much&#160;smaller,&#160;and&#160;people&#160;tended&#160;to&#160;use&#160;groups<br/>
of&#160;8&#160;or&#160;16&#160;bits&#160;to&#160;represent&#160;their&#160;numbers.&#160;It&#160;was&#160;easy&#160;to&#160;accidentally&#160;<i>overflow<br/></i>such&#160;small&#160;numbers—to&#160;end&#160;up&#160;with&#160;a&#160;number&#160;that&#160;did&#160;not&#160;fit&#160;into&#160;the&#160;given<br/>number&#160;of&#160;bits.&#160;Today,&#160;even&#160;computers&#160;that&#160;fit&#160;in&#160;your&#160;pocket&#160;have&#160;plenty&#160;of<br/>memory,&#160;so&#160;you&#160;are&#160;free&#160;to&#160;use&#160;64-bit&#160;chunks,&#160;and&#160;you&#160;need&#160;to&#160;worry&#160;about<br/>overflow&#160;only&#160;when&#160;dealing&#160;with&#160;truly&#160;astronomical&#160;numbers.<br/>
Not&#160;all&#160;whole&#160;numbers&#160;less&#160;than&#160;18&#160;quintillion&#160;fit&#160;in&#160;a&#160;JavaScript&#160;number,<br/>
though.&#160;Those&#160;bits&#160;also&#160;store&#160;negative&#160;numbers,&#160;so&#160;one&#160;bit&#160;indicates&#160;the&#160;sign&#160;of<br/>the&#160;number.&#160;A&#160;bigger&#160;issue&#160;is&#160;that&#160;nonwhole&#160;numbers&#160;must&#160;also&#160;be&#160;represented.<br/>To&#160;do&#160;this,&#160;some&#160;of&#160;the&#160;bits&#160;are&#160;used&#160;to&#160;store&#160;the&#160;position&#160;of&#160;the&#160;decimal&#160;point.<br/>The&#160;actual&#160;maximum&#160;whole&#160;number&#160;that&#160;can&#160;be&#160;stored&#160;is&#160;more&#160;in&#160;the&#160;range&#160;of<br/>
11<br/>
<hr/>
<a name=24></a>9&#160;quadrillion&#160;(15&#160;zeros)—which&#160;is&#160;still&#160;pleasantly&#160;huge.<br/>
Fractional&#160;numbers&#160;are&#160;written&#160;by&#160;using&#160;a&#160;dot.<br/>
9.81<br/>
For&#160;very&#160;big&#160;or&#160;very&#160;small&#160;numbers,&#160;you&#160;may&#160;also&#160;use&#160;scientific&#160;notation&#160;by<br/>
adding&#160;an&#160;<i>e&#160;</i>(for&#160;<i>exponent</i>),&#160;followed&#160;by&#160;the&#160;exponent&#160;of&#160;the&#160;number.<br/>
2.998e8<br/>
That&#160;is&#160;2.998&#160;×&#160;108&#160;=&#160;299,800,000.<br/>Calculations&#160;with&#160;whole&#160;numbers&#160;(also&#160;called&#160;<i>integers</i>)&#160;smaller&#160;than&#160;the<br/>
aforementioned&#160;9&#160;quadrillion&#160;are&#160;guaranteed&#160;to&#160;always&#160;be&#160;precise.&#160;Unfortu-<br/>nately,&#160;calculations&#160;with&#160;fractional&#160;numbers&#160;are&#160;generally&#160;not.&#160;Just&#160;as&#160;<i>π&#160;</i>(pi)<br/>cannot&#160;be&#160;precisely&#160;expressed&#160;by&#160;a&#160;finite&#160;number&#160;of&#160;decimal&#160;digits,&#160;many&#160;num-<br/>bers&#160;lose&#160;some&#160;precision&#160;when&#160;only&#160;64&#160;bits&#160;are&#160;available&#160;to&#160;store&#160;them.&#160;This<br/>is&#160;a&#160;shame,&#160;but&#160;it&#160;causes&#160;practical&#160;problems&#160;only&#160;in&#160;specific&#160;situations.&#160;The<br/>important&#160;thing&#160;is&#160;to&#160;be&#160;aware&#160;of&#160;it&#160;and&#160;treat&#160;fractional&#160;digital&#160;numbers&#160;as<br/>approximations,&#160;not&#160;as&#160;precise&#160;values.<br/>
<b>Arithmetic</b><br/>
The&#160;main&#160;thing&#160;to&#160;do&#160;with&#160;numbers&#160;is&#160;arithmetic.&#160;Arithmetic&#160;operations&#160;such<br/>as&#160;addition&#160;or&#160;multiplication&#160;take&#160;two&#160;number&#160;values&#160;and&#160;produce&#160;a&#160;new&#160;number<br/>from&#160;them.&#160;Here&#160;is&#160;what&#160;they&#160;look&#160;like&#160;in&#160;JavaScript:<br/>
100&#160;+&#160;4&#160;*&#160;11<br/>
The&#160;+&#160;and&#160;*&#160;symbols&#160;are&#160;called&#160;<i>operators</i>.&#160;The&#160;first&#160;stands&#160;for&#160;addition,&#160;and<br/>
the&#160;second&#160;stands&#160;for&#160;multiplication.&#160;Putting&#160;an&#160;operator&#160;between&#160;two&#160;values<br/>will&#160;apply&#160;it&#160;to&#160;those&#160;values&#160;and&#160;produce&#160;a&#160;new&#160;value.<br/>
But&#160;does&#160;the&#160;example&#160;mean&#160;“add&#160;4&#160;and&#160;100,&#160;and&#160;multiply&#160;the&#160;result&#160;by&#160;11,”<br/>
or&#160;is&#160;the&#160;multiplication&#160;done&#160;before&#160;the&#160;adding?&#160;As&#160;you&#160;might&#160;have&#160;guessed,<br/>the&#160;multiplication&#160;happens&#160;first.&#160;But&#160;as&#160;in&#160;mathematics,&#160;you&#160;can&#160;change&#160;this<br/>by&#160;wrapping&#160;the&#160;addition&#160;in&#160;parentheses.<br/>
(100&#160;+&#160;4)&#160;*&#160;11<br/>
For&#160;subtraction,&#160;there&#160;is&#160;the&#160;-&#160;operator,&#160;and&#160;division&#160;can&#160;be&#160;done&#160;with&#160;the&#160;/<br/>
operator.<br/>
12<br/>
<hr/>
<a name=25></a>When&#160;operators&#160;appear&#160;together&#160;without&#160;parentheses,&#160;the&#160;order&#160;in&#160;which<br/>
they&#160;are&#160;applied&#160;is&#160;determined&#160;by&#160;the&#160;<i>precedence&#160;</i>of&#160;the&#160;operators.&#160;The&#160;example<br/>shows&#160;that&#160;multiplication&#160;comes&#160;before&#160;addition.&#160;The&#160;/&#160;operator&#160;has&#160;the&#160;same<br/>precedence&#160;as&#160;*.&#160;Likewise&#160;for&#160;+&#160;and&#160;-.&#160;When&#160;multiple&#160;operators&#160;with&#160;the&#160;same<br/>precedence&#160;appear&#160;next&#160;to&#160;each&#160;other,&#160;as&#160;in&#160;1&#160;-&#160;2&#160;+&#160;1,&#160;they&#160;are&#160;applied&#160;left&#160;to<br/>right:&#160;(1&#160;-&#160;2)+&#160;1.<br/>
These&#160;rules&#160;of&#160;precedence&#160;are&#160;not&#160;something&#160;you&#160;should&#160;worry&#160;about.&#160;When<br/>
in&#160;doubt,&#160;just&#160;add&#160;parentheses.<br/>
There&#160;is&#160;one&#160;more&#160;arithmetic&#160;operator,&#160;which&#160;you&#160;might&#160;not&#160;immediately<br/>
recognize.&#160;The&#160;%&#160;symbol&#160;is&#160;used&#160;to&#160;represent&#160;the&#160;<i>remainder&#160;</i>operation.&#160;X&#160;%&#160;Y<br/>is&#160;the&#160;remainder&#160;of&#160;dividing&#160;X&#160;by&#160;Y.&#160;For&#160;example,&#160;314&#160;%&#160;100&#160;produces&#160;14,&#160;and<br/>144&#160;%&#160;12&#160;gives&#160;0.&#160;The&#160;remainder&#160;operator’s&#160;precedence&#160;is&#160;the&#160;same&#160;as&#160;that&#160;of<br/>multiplication&#160;and&#160;division.&#160;You’ll&#160;also&#160;often&#160;see&#160;this&#160;operator&#160;referred&#160;to&#160;as<br/><i>modulo</i>.<br/>
<b>Special&#160;numbers</b><br/>
There&#160;are&#160;three&#160;special&#160;values&#160;in&#160;JavaScript&#160;that&#160;are&#160;considered&#160;numbers&#160;but<br/>don’t&#160;behave&#160;like&#160;normal&#160;numbers.<br/>
The&#160;first&#160;two&#160;are&#160;Infinity&#160;and&#160;-Infinity,&#160;which&#160;represent&#160;the&#160;positive&#160;and<br/>
negative&#160;infinities.&#160;Infinity&#160;-&#160;1&#160;is&#160;still&#160;Infinity,&#160;and&#160;so&#160;on.&#160;Don’t&#160;put&#160;too<br/>much&#160;trust&#160;in&#160;infinity-based&#160;computation,&#160;though.&#160;It&#160;isn’t&#160;mathematically<br/>sound,&#160;and&#160;it&#160;will&#160;quickly&#160;lead&#160;to&#160;the&#160;next&#160;special&#160;number:&#160;NaN.<br/>
NaN&#160;stands&#160;for&#160;“not&#160;a&#160;number”,&#160;even&#160;though&#160;it&#160;<i>is&#160;</i>a&#160;value&#160;of&#160;the&#160;number&#160;type.<br/>
You’ll&#160;get&#160;this&#160;result&#160;when&#160;you,&#160;for&#160;example,&#160;try&#160;to&#160;calculate&#160;0&#160;/&#160;0&#160;(zero&#160;divided<br/>by&#160;zero),&#160;Infinity&#160;-&#160;Infinity,&#160;or&#160;any&#160;number&#160;of&#160;other&#160;numeric&#160;operations&#160;that<br/>don’t&#160;yield&#160;a&#160;meaningful&#160;result.<br/>
<b>Strings</b><br/>
The&#160;next&#160;basic&#160;data&#160;type&#160;is&#160;the&#160;<i>string</i>.&#160;Strings&#160;are&#160;used&#160;to&#160;represent&#160;text.&#160;They<br/>are&#160;written&#160;by&#160;enclosing&#160;their&#160;content&#160;in&#160;quotes.<br/>
`Down&#160;on&#160;the&#160;sea`<br/>&#34;Lie&#160;on&#160;the&#160;ocean&#34;<br/>'Float&#160;on&#160;the&#160;ocean'<br/>
You&#160;can&#160;use&#160;single&#160;quotes,&#160;double&#160;quotes,&#160;or&#160;backticks&#160;to&#160;mark&#160;strings,&#160;as<br/>
long&#160;as&#160;the&#160;quotes&#160;at&#160;the&#160;start&#160;and&#160;the&#160;end&#160;of&#160;the&#160;string&#160;match.<br/>
13<br/>
<hr/>
<a name=26></a>Almost&#160;anything&#160;can&#160;be&#160;put&#160;between&#160;quotes,&#160;and&#160;JavaScript&#160;will&#160;make&#160;a<br/>
string&#160;value&#160;out&#160;of&#160;it.&#160;But&#160;a&#160;few&#160;characters&#160;are&#160;more&#160;difficult.&#160;You&#160;can&#160;imagine<br/>how&#160;putting&#160;quotes&#160;between&#160;quotes&#160;might&#160;be&#160;hard.&#160;<i>Newlines&#160;</i>(the&#160;characters<br/>you&#160;get&#160;when&#160;you&#160;press&#160;enter)&#160;can&#160;be&#160;included&#160;without&#160;escaping&#160;only&#160;when<br/>the&#160;string&#160;is&#160;quoted&#160;with&#160;backticks&#160;(\‘).<br/>
To&#160;make&#160;it&#160;possible&#160;to&#160;include&#160;such&#160;characters&#160;in&#160;a&#160;string,&#160;the&#160;following<br/>
notation&#160;is&#160;used:&#160;whenever&#160;a&#160;backslash&#160;(\)&#160;is&#160;found&#160;inside&#160;quoted&#160;text,&#160;it<br/>indicates&#160;that&#160;the&#160;character&#160;after&#160;it&#160;has&#160;a&#160;special&#160;meaning.&#160;This&#160;is&#160;called<br/><i>escaping&#160;</i>the&#160;character.&#160;A&#160;quote&#160;that&#160;is&#160;preceded&#160;by&#160;a&#160;backslash&#160;will&#160;not&#160;end<br/>the&#160;string&#160;but&#160;be&#160;part&#160;of&#160;it.&#160;When&#160;an&#160;n&#160;character&#160;occurs&#160;after&#160;a&#160;backslash,&#160;it&#160;is<br/>interpreted&#160;as&#160;a&#160;newline.&#160;Similarly,&#160;a&#160;t&#160;after&#160;a&#160;backslash&#160;means&#160;a&#160;tab&#160;character.<br/>Take&#160;the&#160;following&#160;string:<br/>
&#34;This&#160;is&#160;the&#160;first&#160;line\nAnd&#160;this&#160;is&#160;the&#160;second&#34;<br/>
The&#160;actual&#160;text&#160;contained&#160;is&#160;this:<br/>
This&#160;is&#160;the&#160;first&#160;line<br/>And&#160;this&#160;is&#160;the&#160;second<br/>
There&#160;are,&#160;of&#160;course,&#160;situations&#160;where&#160;you&#160;want&#160;a&#160;backslash&#160;in&#160;a&#160;string&#160;to<br/>
be&#160;just&#160;a&#160;backslash,&#160;not&#160;a&#160;special&#160;code.&#160;If&#160;two&#160;backslashes&#160;follow&#160;each&#160;other,<br/>they&#160;will&#160;collapse&#160;together,&#160;and&#160;only&#160;one&#160;will&#160;be&#160;left&#160;in&#160;the&#160;resulting&#160;string<br/>value.&#160;This&#160;is&#160;how&#160;the&#160;string&#160;“<i>A&#160;newline&#160;character&#160;is&#160;written&#160;like&#160;</i>&#34;<i>\n</i>&#34;<i>.</i>”&#160;can<br/>be&#160;expressed:<br/>
&#34;A&#160;newline&#160;character&#160;is&#160;written&#160;like&#160;\&#34;\\n\&#34;.&#34;<br/>
Strings,&#160;too,&#160;have&#160;to&#160;be&#160;modeled&#160;as&#160;a&#160;series&#160;of&#160;bits&#160;to&#160;be&#160;able&#160;to&#160;exist&#160;inside<br/>
the&#160;computer.&#160;The&#160;way&#160;JavaScript&#160;does&#160;this&#160;is&#160;based&#160;on&#160;the&#160;<i>Unicode&#160;</i>standard.<br/>This&#160;standard&#160;assigns&#160;a&#160;number&#160;to&#160;virtually&#160;every&#160;character&#160;you&#160;would&#160;ever<br/>need,&#160;including&#160;characters&#160;from&#160;Greek,&#160;Arabic,&#160;Japanese,&#160;Armenian,&#160;and&#160;so<br/>on.&#160;If&#160;we&#160;have&#160;a&#160;number&#160;for&#160;every&#160;character,&#160;a&#160;string&#160;can&#160;be&#160;described&#160;by&#160;a<br/>sequence&#160;of&#160;numbers.<br/>
And&#160;that’s&#160;what&#160;JavaScript&#160;does.&#160;But&#160;there’s&#160;a&#160;complication:&#160;JavaScript’s<br/>
representation&#160;uses&#160;16&#160;bits&#160;per&#160;string&#160;element,&#160;which&#160;can&#160;describe&#160;up&#160;to&#160;216<br/>different&#160;characters.&#160;But&#160;Unicode&#160;defines&#160;more&#160;characters&#160;than&#160;that—about<br/>twice&#160;as&#160;many,&#160;at&#160;this&#160;point.&#160;So&#160;some&#160;characters,&#160;such&#160;as&#160;many&#160;emoji,&#160;take<br/>up&#160;two&#160;“character&#160;positions”&#160;in&#160;JavaScript&#160;strings.&#160;We’ll&#160;come&#160;back&#160;to&#160;this&#160;in<br/>
14<br/>
<hr/>
<a name=27></a><a href="eloquent-javascripts.html#104">Chapter&#160;5</a>.<br/>
Strings&#160;cannot&#160;be&#160;divided,&#160;multiplied,&#160;or&#160;subtracted,&#160;but&#160;the&#160;+&#160;operator&#160;<i>can</i><br/>
be&#160;used&#160;on&#160;them.&#160;It&#160;does&#160;not&#160;add,&#160;but&#160;it&#160;<i>concatenates</i>—it&#160;glues&#160;two&#160;strings<br/>together.&#160;The&#160;following&#160;line&#160;will&#160;produce&#160;the&#160;string&#160;&#34;concatenate&#34;:<br/>
&#34;con&#34;&#160;+&#160;&#34;cat&#34;&#160;+&#160;&#34;e&#34;&#160;+&#160;&#34;nate&#34;<br/>
String&#160;values&#160;have&#160;a&#160;number&#160;of&#160;associated&#160;functions&#160;(<i>methods</i>)&#160;that&#160;can&#160;be<br/>
used&#160;to&#160;perform&#160;other&#160;operations&#160;on&#160;them.&#160;I’ll&#160;say&#160;more&#160;about&#160;these&#160;in&#160;<a href="eloquent-javascripts.html#71">Chapter<br/>4</a>.<br/>
Strings&#160;written&#160;with&#160;single&#160;or&#160;double&#160;quotes&#160;behave&#160;very&#160;much&#160;the&#160;same—<br/>
the&#160;only&#160;difference&#160;is&#160;in&#160;which&#160;type&#160;of&#160;quote&#160;you&#160;need&#160;to&#160;escape&#160;inside&#160;of&#160;them.<br/>Backtick-quoted&#160;strings,&#160;usually&#160;called&#160;<i>template&#160;literals</i>,&#160;can&#160;do&#160;a&#160;few&#160;more<br/>tricks.&#160;Apart&#160;from&#160;being&#160;able&#160;to&#160;span&#160;lines,&#160;they&#160;can&#160;also&#160;embed&#160;other&#160;values.<br/>
`half&#160;of&#160;100&#160;is&#160;${100&#160;/&#160;2}`<br/>
When&#160;you&#160;write&#160;something&#160;inside&#160;${}&#160;in&#160;a&#160;template&#160;literal,&#160;its&#160;result&#160;will&#160;be<br/>
computed,&#160;converted&#160;to&#160;a&#160;string,&#160;and&#160;included&#160;at&#160;that&#160;position.&#160;The&#160;example<br/>produces&#160;“<i>half&#160;of&#160;100&#160;is&#160;50</i>”.<br/>
<b>Unary&#160;operators</b><br/>
Not&#160;all&#160;operators&#160;are&#160;symbols.&#160;Some&#160;are&#160;written&#160;as&#160;words.&#160;One&#160;example&#160;is&#160;the<br/>typeof&#160;operator,&#160;which&#160;produces&#160;a&#160;string&#160;value&#160;naming&#160;the&#160;type&#160;of&#160;the&#160;value<br/>you&#160;give&#160;it.<br/>
console.log(typeof&#160;4.5)<br/>//&#160;→&#160;number<br/>console.log(typeof&#160;&#34;x&#34;)<br/>//&#160;→&#160;string<br/>
We&#160;will&#160;use&#160;console.log&#160;in&#160;example&#160;code&#160;to&#160;indicate&#160;that&#160;we&#160;want&#160;to&#160;see&#160;the<br/>
result&#160;of&#160;evaluating&#160;something.&#160;More&#160;about&#160;that&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#34">next&#160;chapter.</a><br/>
The&#160;other&#160;operators&#160;shown&#160;all&#160;operated&#160;on&#160;two&#160;values,&#160;but&#160;typeof&#160;takes&#160;only<br/>
one.&#160;Operators&#160;that&#160;use&#160;two&#160;values&#160;are&#160;called&#160;<i>binary&#160;</i>operators,&#160;while&#160;those&#160;that<br/>take&#160;one&#160;are&#160;called&#160;<i>unary&#160;</i>operators.&#160;The&#160;minus&#160;operator&#160;can&#160;be&#160;used&#160;both&#160;as<br/>a&#160;binary&#160;operator&#160;and&#160;as&#160;a&#160;unary&#160;operator.<br/>
console.log(-&#160;(10&#160;-&#160;2))<br/>
15<br/>
<hr/>
<a name=28></a>//&#160;→&#160;-8<br/>
<b>Boolean&#160;values</b><br/>
It&#160;is&#160;often&#160;useful&#160;to&#160;have&#160;a&#160;value&#160;that&#160;distinguishes&#160;between&#160;only&#160;two&#160;possibili-<br/>ties,&#160;like&#160;“yes”&#160;and&#160;“no”&#160;or&#160;“on”&#160;and&#160;“off”.&#160;For&#160;this&#160;purpose,&#160;JavaScript&#160;has&#160;a<br/><i>Boolean&#160;</i>type,&#160;which&#160;has&#160;just&#160;two&#160;values,&#160;true&#160;and&#160;false,&#160;which&#160;are&#160;written&#160;as<br/>those&#160;words.<br/>
<b>Comparison</b><br/>
Here&#160;is&#160;one&#160;way&#160;to&#160;produce&#160;Boolean&#160;values:<br/>
console.log(3&#160;&gt;&#160;2)<br/>//&#160;→&#160;true<br/>console.log(3&#160;&lt;&#160;2)<br/>//&#160;→&#160;false<br/>
The&#160;&gt;&#160;and&#160;&lt;&#160;signs&#160;are&#160;the&#160;traditional&#160;symbols&#160;for&#160;“is&#160;greater&#160;than”&#160;and&#160;“is<br/>
less&#160;than”,&#160;respectively.&#160;They&#160;are&#160;binary&#160;operators.&#160;Applying&#160;them&#160;results&#160;in<br/>a&#160;Boolean&#160;value&#160;that&#160;indicates&#160;whether&#160;they&#160;hold&#160;true&#160;in&#160;this&#160;case.<br/>
Strings&#160;can&#160;be&#160;compared&#160;in&#160;the&#160;same&#160;way.<br/>
console.log(&#34;Aardvark&#34;&#160;&lt;&#160;&#34;Zoroaster&#34;)<br/>//&#160;→&#160;true<br/>
The&#160;way&#160;strings&#160;are&#160;ordered&#160;is&#160;roughly&#160;alphabetic&#160;but&#160;not&#160;really&#160;what&#160;you’d<br/>
expect&#160;to&#160;see&#160;in&#160;a&#160;dictionary:&#160;uppercase&#160;letters&#160;are&#160;always&#160;“less”&#160;than&#160;lowercase<br/>ones,&#160;so&#160;&#34;Z&#34;&#160;&lt;&#160;&#34;a&#34;,&#160;and&#160;nonalphabetic&#160;characters&#160;(!,&#160;-,&#160;and&#160;so&#160;on)&#160;are&#160;also<br/>included&#160;in&#160;the&#160;ordering.&#160;When&#160;comparing&#160;strings,&#160;JavaScript&#160;goes&#160;over&#160;the<br/>characters&#160;from&#160;left&#160;to&#160;right,&#160;comparing&#160;the&#160;Unicode&#160;codes&#160;one&#160;by&#160;one.<br/>
Other&#160;similar&#160;operators&#160;are&#160;&gt;=&#160;(greater&#160;than&#160;or&#160;equal&#160;to),&#160;&lt;=&#160;(less&#160;than&#160;or<br/>
equal&#160;to),&#160;==&#160;(equal&#160;to),&#160;and&#160;!=&#160;(not&#160;equal&#160;to).<br/>
console.log(&#34;Itchy&#34;&#160;!=&#160;&#34;Scratchy&#34;)<br/>//&#160;→&#160;true<br/>console.log(&#34;Apple&#34;&#160;==&#160;&#34;Orange&#34;)<br/>//&#160;→&#160;false<br/>
16<br/>
<hr/>
<a name=29></a>There&#160;is&#160;only&#160;one&#160;value&#160;in&#160;JavaScript&#160;that&#160;is&#160;not&#160;equal&#160;to&#160;itself,&#160;and&#160;that&#160;is<br/>
NaN&#160;(“not&#160;a&#160;number”).<br/>
console.log(NaN&#160;==&#160;NaN)<br/>//&#160;→&#160;false<br/>
NaN&#160;is&#160;supposed&#160;to&#160;denote&#160;the&#160;result&#160;of&#160;a&#160;nonsensical&#160;computation,&#160;and&#160;as<br/>
such,&#160;it&#160;isn’t&#160;equal&#160;to&#160;the&#160;result&#160;of&#160;any&#160;<i>other&#160;</i>nonsensical&#160;computations.<br/>
<b>Logical&#160;operators</b><br/>
There&#160;are&#160;also&#160;some&#160;operations&#160;that&#160;can&#160;be&#160;applied&#160;to&#160;Boolean&#160;values&#160;them-<br/>selves.&#160;JavaScript&#160;supports&#160;three&#160;logical&#160;operators:&#160;<i>and</i>,&#160;<i>or</i>,&#160;and&#160;<i>not</i>.&#160;These<br/>can&#160;be&#160;used&#160;to&#160;“reason”&#160;about&#160;Booleans.<br/>
The&#160;&amp;&amp;&#160;operator&#160;represents&#160;logical&#160;<i>and</i>.&#160;It&#160;is&#160;a&#160;binary&#160;operator,&#160;and&#160;its&#160;result<br/>
is&#160;true&#160;only&#160;if&#160;both&#160;the&#160;values&#160;given&#160;to&#160;it&#160;are&#160;true.<br/>
console.log(true&#160;&amp;&amp;&#160;false)<br/>//&#160;→&#160;false<br/>console.log(true&#160;&amp;&amp;&#160;true)<br/>//&#160;→&#160;true<br/>
The&#160;||&#160;operator&#160;denotes&#160;logical&#160;<i>or</i>.&#160;It&#160;produces&#160;true&#160;if&#160;either&#160;of&#160;the&#160;values<br/>
given&#160;to&#160;it&#160;is&#160;true.<br/>
console.log(false&#160;||&#160;true)<br/>//&#160;→&#160;true<br/>console.log(false&#160;||&#160;false)<br/>//&#160;→&#160;false<br/>
<i>Not&#160;</i>is&#160;written&#160;as&#160;an&#160;exclamation&#160;mark&#160;(!).&#160;It&#160;is&#160;a&#160;unary&#160;operator&#160;that&#160;flips<br/>
the&#160;value&#160;given&#160;to&#160;it—!true&#160;produces&#160;false,&#160;and&#160;!false&#160;gives&#160;true.<br/>
When&#160;mixing&#160;these&#160;Boolean&#160;operators&#160;with&#160;arithmetic&#160;and&#160;other&#160;operators,<br/>
it&#160;is&#160;not&#160;always&#160;obvious&#160;when&#160;parentheses&#160;are&#160;needed.&#160;In&#160;practice,&#160;you&#160;can<br/>usually&#160;get&#160;by&#160;with&#160;knowing&#160;that&#160;of&#160;the&#160;operators&#160;we&#160;have&#160;seen&#160;so&#160;far,&#160;||&#160;has<br/>the&#160;lowest&#160;precedence,&#160;then&#160;comes&#160;&amp;&amp;,&#160;then&#160;the&#160;comparison&#160;operators&#160;(&gt;,&#160;==,<br/>and&#160;so&#160;on),&#160;and&#160;then&#160;the&#160;rest.&#160;This&#160;order&#160;has&#160;been&#160;chosen&#160;such&#160;that,&#160;in&#160;typical<br/>expressions&#160;like&#160;the&#160;following&#160;one,&#160;as&#160;few&#160;parentheses&#160;as&#160;possible&#160;are&#160;necessary:<br/>
1&#160;+&#160;1&#160;==&#160;2&#160;&amp;&amp;&#160;10&#160;*&#160;10&#160;&gt;&#160;50<br/>
17<br/>
<hr/>
<a name=30></a>The&#160;last&#160;logical&#160;operator&#160;I&#160;will&#160;discuss&#160;is&#160;not&#160;unary,&#160;not&#160;binary,&#160;but&#160;<i>ternary</i>,<br/>
operating&#160;on&#160;three&#160;values.&#160;It&#160;is&#160;written&#160;with&#160;a&#160;question&#160;mark&#160;and&#160;a&#160;colon,&#160;like<br/>this:<br/>
console.log(true&#160;?&#160;1&#160;:&#160;2);<br/>//&#160;→&#160;1<br/>console.log(false&#160;?&#160;1&#160;:&#160;2);<br/>//&#160;→&#160;2<br/>
This&#160;one&#160;is&#160;called&#160;the&#160;<i>conditional&#160;</i>operator&#160;(or&#160;sometimes&#160;just&#160;the&#160;<i>ternary</i><br/>
operator&#160;since&#160;it&#160;is&#160;the&#160;only&#160;such&#160;operator&#160;in&#160;the&#160;language).&#160;The&#160;value&#160;on&#160;the<br/>left&#160;of&#160;the&#160;question&#160;mark&#160;“picks”&#160;which&#160;of&#160;the&#160;other&#160;two&#160;values&#160;will&#160;come&#160;out.<br/>When&#160;it&#160;is&#160;true,&#160;it&#160;chooses&#160;the&#160;middle&#160;value,&#160;and&#160;when&#160;it&#160;is&#160;false,&#160;it&#160;chooses&#160;the<br/>value&#160;on&#160;the&#160;right.<br/>
<b>Empty&#160;values</b><br/>
There&#160;are&#160;two&#160;special&#160;values,&#160;written&#160;null&#160;and&#160;undefined,&#160;that&#160;are&#160;used&#160;to<br/>denote&#160;the&#160;absence&#160;of&#160;a&#160;<i>meaningful&#160;</i>value.&#160;They&#160;are&#160;themselves&#160;values,&#160;but<br/>they&#160;carry&#160;no&#160;information.<br/>
Many&#160;operations&#160;in&#160;the&#160;language&#160;that&#160;don’t&#160;produce&#160;a&#160;meaningful&#160;value<br/>
(you’ll&#160;see&#160;some&#160;later)&#160;yield&#160;undefined&#160;simply&#160;because&#160;they&#160;have&#160;to&#160;yield&#160;<i>some<br/></i>value.<br/>
The&#160;difference&#160;in&#160;meaning&#160;between&#160;undefined&#160;and&#160;null&#160;is&#160;an&#160;accident&#160;of<br/>
JavaScript’s&#160;design,&#160;and&#160;it&#160;doesn’t&#160;matter&#160;most&#160;of&#160;the&#160;time.&#160;In&#160;cases&#160;where<br/>you&#160;actually&#160;have&#160;to&#160;concern&#160;yourself&#160;with&#160;these&#160;values,&#160;I&#160;recommend&#160;treating<br/>them&#160;as&#160;mostly&#160;interchangeable.<br/>
<b>Automatic&#160;type&#160;conversion</b><br/>
In&#160;the&#160;Introduction,&#160;I&#160;mentioned&#160;that&#160;JavaScript&#160;goes&#160;out&#160;of&#160;its&#160;way&#160;to&#160;accept<br/>almost&#160;any&#160;program&#160;you&#160;give&#160;it,&#160;even&#160;programs&#160;that&#160;do&#160;odd&#160;things.&#160;This&#160;is<br/>nicely&#160;demonstrated&#160;by&#160;the&#160;following&#160;expressions:<br/>
console.log(8&#160;*&#160;null)<br/>//&#160;→&#160;0<br/>console.log(&#34;5&#34;&#160;-&#160;1)<br/>//&#160;→&#160;4<br/>console.log(&#34;5&#34;&#160;+&#160;1)<br/>//&#160;→&#160;51<br/>console.log(&#34;five&#34;&#160;*&#160;2)<br/>
18<br/>
<hr/>
<a name=31></a>//&#160;→&#160;NaN<br/>console.log(false&#160;==&#160;0)<br/>//&#160;→&#160;true<br/>
When&#160;an&#160;operator&#160;is&#160;applied&#160;to&#160;the&#160;“wrong”&#160;type&#160;of&#160;value,&#160;JavaScript&#160;will<br/>
quietly&#160;convert&#160;that&#160;value&#160;to&#160;the&#160;type&#160;it&#160;needs,&#160;using&#160;a&#160;set&#160;of&#160;rules&#160;that&#160;often<br/>aren’t&#160;what&#160;you&#160;want&#160;or&#160;expect.&#160;This&#160;is&#160;called&#160;<i>type&#160;coercion</i>.&#160;The&#160;null&#160;in&#160;the<br/>first&#160;expression&#160;becomes&#160;0,&#160;and&#160;the&#160;&#34;5&#34;&#160;in&#160;the&#160;second&#160;expression&#160;becomes&#160;5<br/>(from&#160;string&#160;to&#160;number).&#160;Yet&#160;in&#160;the&#160;third&#160;expression,&#160;+&#160;tries&#160;string&#160;concate-<br/>nation&#160;before&#160;numeric&#160;addition,&#160;so&#160;the&#160;1&#160;is&#160;converted&#160;to&#160;&#34;1&#34;&#160;(from&#160;number&#160;to<br/>string).<br/>
When&#160;something&#160;that&#160;doesn’t&#160;map&#160;to&#160;a&#160;number&#160;in&#160;an&#160;obvious&#160;way&#160;(such&#160;as<br/>
&#34;five&#34;&#160;or&#160;undefined)&#160;is&#160;converted&#160;to&#160;a&#160;number,&#160;you&#160;get&#160;the&#160;value&#160;NaN.&#160;Further<br/>arithmetic&#160;operations&#160;on&#160;NaN&#160;keep&#160;producing&#160;NaN,&#160;so&#160;if&#160;you&#160;find&#160;yourself&#160;getting<br/>one&#160;of&#160;those&#160;in&#160;an&#160;unexpected&#160;place,&#160;look&#160;for&#160;accidental&#160;type&#160;conversions.<br/>
When&#160;comparing&#160;values&#160;of&#160;the&#160;same&#160;type&#160;using&#160;==,&#160;the&#160;outcome&#160;is&#160;easy&#160;to<br/>
predict:&#160;you&#160;should&#160;get&#160;true&#160;when&#160;both&#160;values&#160;are&#160;the&#160;same,&#160;except&#160;in&#160;the&#160;case<br/>of&#160;NaN.&#160;But&#160;when&#160;the&#160;types&#160;differ,&#160;JavaScript&#160;uses&#160;a&#160;complicated&#160;and&#160;confusing<br/>set&#160;of&#160;rules&#160;to&#160;determine&#160;what&#160;to&#160;do.&#160;In&#160;most&#160;cases,&#160;it&#160;just&#160;tries&#160;to&#160;convert<br/>one&#160;of&#160;the&#160;values&#160;to&#160;the&#160;other&#160;value’s&#160;type.&#160;However,&#160;when&#160;null&#160;or&#160;undefined<br/>occurs&#160;on&#160;either&#160;side&#160;of&#160;the&#160;operator,&#160;it&#160;produces&#160;true&#160;only&#160;if&#160;both&#160;sides&#160;are&#160;one<br/>of&#160;null&#160;or&#160;undefined.<br/>
console.log(null&#160;==&#160;undefined);<br/>//&#160;→&#160;true<br/>console.log(null&#160;==&#160;0);<br/>//&#160;→&#160;false<br/>
That&#160;behavior&#160;is&#160;often&#160;useful.&#160;When&#160;you&#160;want&#160;to&#160;test&#160;whether&#160;a&#160;value&#160;has&#160;a<br/>
real&#160;value&#160;instead&#160;of&#160;null&#160;or&#160;undefined,&#160;you&#160;can&#160;compare&#160;it&#160;to&#160;null&#160;with&#160;the<br/>==&#160;(or&#160;!=)&#160;operator.<br/>
But&#160;what&#160;if&#160;you&#160;want&#160;to&#160;test&#160;whether&#160;something&#160;refers&#160;to&#160;the&#160;precise&#160;value<br/>
false?&#160;Expressions&#160;like&#160;0&#160;==&#160;false&#160;and&#160;&#34;&#34;&#160;==&#160;false&#160;are&#160;also&#160;true&#160;because<br/>of&#160;automatic&#160;type&#160;conversion.&#160;When&#160;you&#160;do&#160;<i>not&#160;</i>want&#160;any&#160;type&#160;conversions<br/>to&#160;happen,&#160;there&#160;are&#160;two&#160;additional&#160;operators:&#160;===&#160;and&#160;!==.&#160;The&#160;first&#160;tests<br/>whether&#160;a&#160;value&#160;is&#160;<i>precisely&#160;</i>equal&#160;to&#160;the&#160;other,&#160;and&#160;the&#160;second&#160;tests&#160;whether&#160;it<br/>is&#160;not&#160;precisely&#160;equal.&#160;So&#160;&#34;&#34;&#160;===&#160;false&#160;is&#160;false&#160;as&#160;expected.<br/>
I&#160;recommend&#160;using&#160;the&#160;three-character&#160;comparison&#160;operators&#160;defensively&#160;to<br/>
prevent&#160;unexpected&#160;type&#160;conversions&#160;from&#160;tripping&#160;you&#160;up.&#160;But&#160;when&#160;you’re<br/>certain&#160;the&#160;types&#160;on&#160;both&#160;sides&#160;will&#160;be&#160;the&#160;same,&#160;there&#160;is&#160;no&#160;problem&#160;with&#160;using<br/>
19<br/>
<hr/>
<a name=32></a>the&#160;shorter&#160;operators.<br/>
<b>Short-circuiting&#160;of&#160;logical&#160;operators</b><br/>
The&#160;logical&#160;operators&#160;&amp;&amp;&#160;and&#160;||&#160;handle&#160;values&#160;of&#160;different&#160;types&#160;in&#160;a&#160;peculiar<br/>way.&#160;They&#160;will&#160;convert&#160;the&#160;value&#160;on&#160;their&#160;left&#160;side&#160;to&#160;Boolean&#160;type&#160;in&#160;order<br/>to&#160;decide&#160;what&#160;to&#160;do,&#160;but&#160;depending&#160;on&#160;the&#160;operator&#160;and&#160;the&#160;result&#160;of&#160;that<br/>conversion,&#160;they&#160;will&#160;return&#160;either&#160;the&#160;<i>original&#160;</i>left-hand&#160;value&#160;or&#160;the&#160;right-<br/>hand&#160;value.<br/>
The&#160;||&#160;operator,&#160;for&#160;example,&#160;will&#160;return&#160;the&#160;value&#160;to&#160;its&#160;left&#160;when&#160;that&#160;can<br/>
be&#160;converted&#160;to&#160;true&#160;and&#160;will&#160;return&#160;the&#160;value&#160;on&#160;its&#160;right&#160;otherwise.&#160;This&#160;has<br/>the&#160;expected&#160;effect&#160;when&#160;the&#160;values&#160;are&#160;Boolean&#160;and&#160;does&#160;something&#160;analogous<br/>for&#160;values&#160;of&#160;other&#160;types.<br/>
console.log(null&#160;||&#160;&#34;user&#34;)<br/>//&#160;→&#160;user<br/>console.log(&#34;Agnes&#34;&#160;||&#160;&#34;user&#34;)<br/>//&#160;→&#160;Agnes<br/>
We&#160;can&#160;use&#160;this&#160;functionality&#160;as&#160;a&#160;way&#160;to&#160;fall&#160;back&#160;on&#160;a&#160;default&#160;value.&#160;If&#160;you<br/>
have&#160;a&#160;value&#160;that&#160;might&#160;be&#160;empty,&#160;you&#160;can&#160;put&#160;||&#160;after&#160;it&#160;with&#160;a&#160;replacement<br/>value.&#160;If&#160;the&#160;initial&#160;value&#160;can&#160;be&#160;converted&#160;to&#160;false,&#160;you’ll&#160;get&#160;the&#160;replacement<br/>instead.&#160;The&#160;rules&#160;for&#160;converting&#160;strings&#160;and&#160;numbers&#160;to&#160;Boolean&#160;values&#160;state<br/>that&#160;0,&#160;NaN,&#160;and&#160;the&#160;empty&#160;string&#160;(&#34;&#34;)&#160;count&#160;as&#160;false,&#160;while&#160;all&#160;the&#160;other&#160;values<br/>count&#160;as&#160;true.&#160;So&#160;0&#160;||&#160;-1&#160;produces&#160;-1,&#160;and&#160;&#34;&#34;&#160;||&#160;&#34;!?&#34;&#160;yields&#160;&#34;!?&#34;.<br/>
The&#160;&amp;&amp;&#160;operator&#160;works&#160;similarly&#160;but&#160;the&#160;other&#160;way&#160;around.&#160;When&#160;the&#160;value<br/>
to&#160;its&#160;left&#160;is&#160;something&#160;that&#160;converts&#160;to&#160;false,&#160;it&#160;returns&#160;that&#160;value,&#160;and&#160;otherwise<br/>it&#160;returns&#160;the&#160;value&#160;on&#160;its&#160;right.<br/>
Another&#160;important&#160;property&#160;of&#160;these&#160;two&#160;operators&#160;is&#160;that&#160;the&#160;part&#160;to&#160;their<br/>
right&#160;is&#160;evaluated&#160;only&#160;when&#160;necessary.&#160;In&#160;the&#160;case&#160;of&#160;true&#160;||&#160;X,&#160;no&#160;matter<br/>what&#160;X&#160;is—even&#160;if&#160;it’s&#160;a&#160;piece&#160;of&#160;program&#160;that&#160;does&#160;something&#160;<i>terrible</i>—the<br/>result&#160;will&#160;be&#160;true,&#160;and&#160;X&#160;is&#160;never&#160;evaluated.&#160;The&#160;same&#160;goes&#160;for&#160;false&#160;&amp;&amp;&#160;X,<br/>which&#160;is&#160;false&#160;and&#160;will&#160;ignore&#160;X.&#160;This&#160;is&#160;called&#160;<i>short-circuit&#160;evaluation</i>.<br/>
The&#160;conditional&#160;operator&#160;works&#160;in&#160;a&#160;similar&#160;way.&#160;Of&#160;the&#160;second&#160;and&#160;third<br/>
values,&#160;only&#160;the&#160;one&#160;that&#160;is&#160;selected&#160;is&#160;evaluated.<br/>
<b>Summary</b><br/>
We&#160;looked&#160;at&#160;four&#160;types&#160;of&#160;JavaScript&#160;values&#160;in&#160;this&#160;chapter:&#160;numbers,&#160;strings,<br/>Booleans,&#160;and&#160;undefined&#160;values.<br/>
20<br/>
<hr/>
<a name=33></a>Such&#160;values&#160;are&#160;created&#160;by&#160;typing&#160;in&#160;their&#160;name&#160;(true,&#160;null)&#160;or&#160;value&#160;(13<br/>
,&#160;&#34;abc&#34;).&#160;You&#160;can&#160;combine&#160;and&#160;transform&#160;values&#160;with&#160;operators.&#160;We&#160;saw<br/>binary&#160;operators&#160;for&#160;arithmetic&#160;(+,&#160;-,&#160;*,&#160;/,&#160;and&#160;%),&#160;string&#160;concatenation&#160;(+),<br/>comparison&#160;(==,&#160;!=,&#160;===,&#160;!==,&#160;&lt;,&#160;&gt;,&#160;&lt;=,&#160;&gt;=),&#160;and&#160;logic&#160;(&amp;&amp;,&#160;||),&#160;as&#160;well&#160;as&#160;several<br/>unary&#160;operators&#160;(-&#160;to&#160;negate&#160;a&#160;number,&#160;!&#160;to&#160;negate&#160;logically,&#160;and&#160;typeof&#160;to<br/>find&#160;a&#160;value’s&#160;type)&#160;and&#160;a&#160;ternary&#160;operator&#160;(?:)&#160;to&#160;pick&#160;one&#160;of&#160;two&#160;values&#160;based<br/>on&#160;a&#160;third&#160;value.<br/>
This&#160;gives&#160;you&#160;enough&#160;information&#160;to&#160;use&#160;JavaScript&#160;as&#160;a&#160;pocket&#160;calculator<br/>
but&#160;not&#160;much&#160;more.&#160;The&#160;<a href="eloquent-javascripts.html#34">next&#160;chapter&#160;</a>will&#160;start&#160;tying&#160;these&#160;expressions&#160;together<br/>into&#160;basic&#160;programs.<br/>
21<br/>
<hr/>
<a name=34></a><i>“And&#160;my&#160;heart&#160;glows&#160;bright&#160;red&#160;under&#160;my&#160;filmy,&#160;translucent&#160;skin&#160;and</i><br/>
<i>they&#160;have&#160;to&#160;administer&#160;10cc&#160;of&#160;JavaScript&#160;to&#160;get&#160;me&#160;to&#160;come&#160;back.<br/>(I&#160;respond&#160;well&#160;to&#160;toxins&#160;in&#160;the&#160;blood.)&#160;Man,&#160;that&#160;stuff&#160;will&#160;kick&#160;the<br/>peaches&#160;right&#160;out&#160;your&#160;gills!”</i><br/>
—_why,&#160;Why’s&#160;(Poignant)&#160;Guide&#160;to&#160;Ruby<br/>
<b>Chapter&#160;2<br/>Program&#160;Structure</b><br/>
In&#160;this&#160;chapter,&#160;we&#160;will&#160;start&#160;to&#160;do&#160;things&#160;that&#160;can&#160;actually&#160;be&#160;called&#160;<i>program-<br/>ming</i>.&#160;We&#160;will&#160;expand&#160;our&#160;command&#160;of&#160;the&#160;JavaScript&#160;language&#160;beyond&#160;the<br/>nouns&#160;and&#160;sentence&#160;fragments&#160;we’ve&#160;seen&#160;so&#160;far,&#160;to&#160;the&#160;point&#160;where&#160;we&#160;can<br/>express&#160;meaningful&#160;prose.<br/>
<b>Expressions&#160;and&#160;statements</b><br/>
In&#160;<a href="eloquent-javascripts.html#22">Chapter&#160;1,&#160;</a>we&#160;made&#160;values&#160;and&#160;applied&#160;operators&#160;to&#160;them&#160;to&#160;get&#160;new&#160;values.<br/>Creating&#160;values&#160;like&#160;this&#160;is&#160;the&#160;main&#160;substance&#160;of&#160;any&#160;JavaScript&#160;program.&#160;But<br/>that&#160;substance&#160;has&#160;to&#160;be&#160;framed&#160;in&#160;a&#160;larger&#160;structure&#160;to&#160;be&#160;useful.&#160;So&#160;that’s<br/>what&#160;we’ll&#160;cover&#160;next.<br/>
A&#160;fragment&#160;of&#160;code&#160;that&#160;produces&#160;a&#160;value&#160;is&#160;called&#160;an&#160;<i>expression</i>.&#160;Every&#160;value<br/>
that&#160;is&#160;written&#160;literally&#160;(such&#160;as&#160;22&#160;or&#160;&#34;psychoanalysis&#34;)&#160;is&#160;an&#160;expression.&#160;An<br/>expression&#160;between&#160;parentheses&#160;is&#160;also&#160;an&#160;expression,&#160;as&#160;is&#160;a&#160;binary&#160;operator<br/>applied&#160;to&#160;two&#160;expressions&#160;or&#160;a&#160;unary&#160;operator&#160;applied&#160;to&#160;one.<br/>
This&#160;shows&#160;part&#160;of&#160;the&#160;beauty&#160;of&#160;a&#160;language-based&#160;interface.&#160;Expressions<br/>
can&#160;contain&#160;other&#160;expressions&#160;in&#160;a&#160;way&#160;similar&#160;to&#160;how&#160;subsentences&#160;in&#160;human<br/>languages&#160;are&#160;nested—a&#160;subsentence&#160;can&#160;contain&#160;its&#160;own&#160;subsentences,&#160;and<br/>so&#160;on.&#160;This&#160;allows&#160;us&#160;to&#160;build&#160;expressions&#160;that&#160;describe&#160;arbitrarily&#160;complex<br/>computations.<br/>
If&#160;an&#160;expression&#160;corresponds&#160;to&#160;a&#160;sentence&#160;fragment,&#160;a&#160;JavaScript&#160;<i>statement</i><br/>
corresponds&#160;to&#160;a&#160;full&#160;sentence.&#160;A&#160;program&#160;is&#160;a&#160;list&#160;of&#160;statements.<br/>
The&#160;simplest&#160;kind&#160;of&#160;statement&#160;is&#160;an&#160;expression&#160;with&#160;a&#160;semicolon&#160;after&#160;it.<br/>
This&#160;is&#160;a&#160;program:<br/>
1;<br/>!false;<br/>
It&#160;is&#160;a&#160;useless&#160;program,&#160;though.&#160;An&#160;expression&#160;can&#160;be&#160;content&#160;to&#160;just&#160;produce<br/>
a&#160;value,&#160;which&#160;can&#160;then&#160;be&#160;used&#160;by&#160;the&#160;enclosing&#160;code.&#160;A&#160;statement&#160;stands&#160;on<br/>
22<br/>
<hr/>
<a name=35></a>its&#160;own,&#160;so&#160;it&#160;amounts&#160;to&#160;something&#160;only&#160;if&#160;it&#160;affects&#160;the&#160;world.&#160;It&#160;could&#160;display<br/>something&#160;on&#160;the&#160;screen—that&#160;counts&#160;as&#160;changing&#160;the&#160;world—or&#160;it&#160;could&#160;change<br/>the&#160;internal&#160;state&#160;of&#160;the&#160;machine&#160;in&#160;a&#160;way&#160;that&#160;will&#160;affect&#160;the&#160;statements&#160;that<br/>come&#160;after&#160;it.&#160;These&#160;changes&#160;are&#160;called&#160;<i>side&#160;effects</i>.&#160;The&#160;statements&#160;in&#160;the<br/>previous&#160;example&#160;just&#160;produce&#160;the&#160;values&#160;1&#160;and&#160;true&#160;and&#160;then&#160;immediately<br/>throw&#160;them&#160;away.&#160;This&#160;leaves&#160;no&#160;impression&#160;on&#160;the&#160;world&#160;at&#160;all.&#160;When&#160;you<br/>run&#160;this&#160;program,&#160;nothing&#160;observable&#160;happens.<br/>
In&#160;some&#160;cases,&#160;JavaScript&#160;allows&#160;you&#160;to&#160;omit&#160;the&#160;semicolon&#160;at&#160;the&#160;end&#160;of&#160;a<br/>
statement.&#160;In&#160;other&#160;cases,&#160;it&#160;has&#160;to&#160;be&#160;there,&#160;or&#160;the&#160;next&#160;line&#160;will&#160;be&#160;treated<br/>as&#160;part&#160;of&#160;the&#160;same&#160;statement.&#160;The&#160;rules&#160;for&#160;when&#160;it&#160;can&#160;be&#160;safely&#160;omitted<br/>are&#160;somewhat&#160;complex&#160;and&#160;error-prone.&#160;So&#160;in&#160;this&#160;book,&#160;every&#160;statement&#160;that<br/>needs&#160;a&#160;semicolon&#160;will&#160;always&#160;get&#160;one.&#160;I&#160;recommend&#160;you&#160;do&#160;the&#160;same,&#160;at&#160;least<br/>until&#160;you’ve&#160;learned&#160;more&#160;about&#160;the&#160;subtleties&#160;of&#160;missing&#160;semicolons.<br/>
<b>Bindings</b><br/>
How&#160;does&#160;a&#160;program&#160;keep&#160;an&#160;internal&#160;state?&#160;How&#160;does&#160;it&#160;remember&#160;things?<br/>We&#160;have&#160;seen&#160;how&#160;to&#160;produce&#160;new&#160;values&#160;from&#160;old&#160;values,&#160;but&#160;this&#160;does&#160;not<br/>change&#160;the&#160;old&#160;values,&#160;and&#160;the&#160;new&#160;value&#160;has&#160;to&#160;be&#160;immediately&#160;used&#160;or&#160;it&#160;will<br/>dissipate&#160;again.&#160;To&#160;catch&#160;and&#160;hold&#160;values,&#160;JavaScript&#160;provides&#160;a&#160;thing&#160;called&#160;a<br/><i>binding</i>,&#160;or&#160;<i>variable</i>:<br/>
let&#160;caught&#160;=&#160;5&#160;*&#160;5;<br/>
That’s&#160;a&#160;second&#160;kind&#160;of&#160;statement.&#160;The&#160;special&#160;word&#160;(<i>keyword</i>)&#160;let&#160;indicates<br/>
that&#160;this&#160;sentence&#160;is&#160;going&#160;to&#160;define&#160;a&#160;binding.&#160;It&#160;is&#160;followed&#160;by&#160;the&#160;name&#160;of<br/>the&#160;binding&#160;and,&#160;if&#160;we&#160;want&#160;to&#160;immediately&#160;give&#160;it&#160;a&#160;value,&#160;by&#160;an&#160;=&#160;operator<br/>and&#160;an&#160;expression.<br/>
The&#160;previous&#160;statement&#160;creates&#160;a&#160;binding&#160;called&#160;caught&#160;and&#160;uses&#160;it&#160;to&#160;grab<br/>
hold&#160;of&#160;the&#160;number&#160;that&#160;is&#160;produced&#160;by&#160;multiplying&#160;5&#160;by&#160;5.<br/>
After&#160;a&#160;binding&#160;has&#160;been&#160;defined,&#160;its&#160;name&#160;can&#160;be&#160;used&#160;as&#160;an&#160;expression.&#160;The<br/>
value&#160;of&#160;such&#160;an&#160;expression&#160;is&#160;the&#160;value&#160;the&#160;binding&#160;currently&#160;holds.&#160;Here’s&#160;an<br/>example:<br/>
let&#160;ten&#160;=&#160;10;<br/>console.log(ten&#160;*&#160;ten);<br/>//&#160;→&#160;100<br/>
When&#160;a&#160;binding&#160;points&#160;at&#160;a&#160;value,&#160;that&#160;does&#160;not&#160;mean&#160;it&#160;is&#160;tied&#160;to&#160;that<br/>
23<br/>
<hr/>
<a name=36></a>value&#160;forever.&#160;The&#160;=&#160;operator&#160;can&#160;be&#160;used&#160;at&#160;any&#160;time&#160;on&#160;existing&#160;bindings&#160;to<br/>disconnect&#160;them&#160;from&#160;their&#160;current&#160;value&#160;and&#160;have&#160;them&#160;point&#160;to&#160;a&#160;new&#160;one.<br/>
let&#160;mood&#160;=&#160;&#34;light&#34;;<br/>console.log(mood);<br/>//&#160;→&#160;light<br/>mood&#160;=&#160;&#34;dark&#34;;<br/>console.log(mood);<br/>//&#160;→&#160;dark<br/>
You&#160;should&#160;imagine&#160;bindings&#160;as&#160;tentacles,&#160;rather&#160;than&#160;boxes.&#160;They&#160;do&#160;not<br/>
<i>contain&#160;</i>values;&#160;they&#160;<i>grasp&#160;</i>them—two&#160;bindings&#160;can&#160;refer&#160;to&#160;the&#160;same&#160;value.<br/>A&#160;program&#160;can&#160;access&#160;only&#160;the&#160;values&#160;that&#160;it&#160;still&#160;has&#160;a&#160;reference&#160;to.&#160;When<br/>you&#160;need&#160;to&#160;remember&#160;something,&#160;you&#160;grow&#160;a&#160;tentacle&#160;to&#160;hold&#160;on&#160;to&#160;it&#160;or&#160;you<br/>reattach&#160;one&#160;of&#160;your&#160;existing&#160;tentacles&#160;to&#160;it.<br/>
Let’s&#160;look&#160;at&#160;another&#160;example.&#160;To&#160;remember&#160;the&#160;number&#160;of&#160;dollars&#160;that<br/>
Luigi&#160;still&#160;owes&#160;you,&#160;you&#160;create&#160;a&#160;binding.&#160;And&#160;then&#160;when&#160;he&#160;pays&#160;back&#160;$35,<br/>you&#160;give&#160;this&#160;binding&#160;a&#160;new&#160;value.<br/>
let&#160;luigisDebt&#160;=&#160;140;<br/>luigisDebt&#160;=&#160;luigisDebt&#160;-&#160;35;<br/>console.log(luigisDebt);<br/>//&#160;→&#160;105<br/>
When&#160;you&#160;define&#160;a&#160;binding&#160;without&#160;giving&#160;it&#160;a&#160;value,&#160;the&#160;tentacle&#160;has&#160;nothing<br/>
to&#160;grasp,&#160;so&#160;it&#160;ends&#160;in&#160;thin&#160;air.&#160;If&#160;you&#160;ask&#160;for&#160;the&#160;value&#160;of&#160;an&#160;empty&#160;binding,<br/>you’ll&#160;get&#160;the&#160;value&#160;undefined.<br/>
A&#160;single&#160;let&#160;statement&#160;may&#160;define&#160;multiple&#160;bindings.&#160;The&#160;definitions&#160;must<br/>
be&#160;separated&#160;by&#160;commas.<br/>
let&#160;one&#160;=&#160;1,&#160;two&#160;=&#160;2;<br/>console.log(one&#160;+&#160;two);<br/>//&#160;→&#160;3<br/>
The&#160;words&#160;var&#160;and&#160;const&#160;can&#160;also&#160;be&#160;used&#160;to&#160;create&#160;bindings,&#160;in&#160;a&#160;way&#160;similar<br/>
to&#160;let.<br/>
var&#160;name&#160;=&#160;&#34;Ayda&#34;;<br/>const&#160;greeting&#160;=&#160;&#34;Hello&#160;&#34;;<br/>console.log(greeting&#160;+&#160;name);<br/>//&#160;→&#160;Hello&#160;Ayda<br/>
24<br/>
<hr/>
<a name=37></a>The&#160;first,&#160;var&#160;(short&#160;for&#160;“variable”),&#160;is&#160;the&#160;way&#160;bindings&#160;were&#160;declared&#160;in<br/>
pre-2015&#160;JavaScript.&#160;I’ll&#160;get&#160;back&#160;to&#160;the&#160;precise&#160;way&#160;it&#160;differs&#160;from&#160;let&#160;in&#160;the<br/><a href="eloquent-javascripts.html#51">next&#160;chapter.&#160;</a>For&#160;now,&#160;remember&#160;that&#160;it&#160;mostly&#160;does&#160;the&#160;same&#160;thing,&#160;but&#160;we’ll<br/>rarely&#160;use&#160;it&#160;in&#160;this&#160;book&#160;because&#160;it&#160;has&#160;some&#160;confusing&#160;properties.<br/>
The&#160;word&#160;const&#160;stands&#160;for&#160;<i>constant</i>.&#160;It&#160;defines&#160;a&#160;constant&#160;binding,&#160;which<br/>
points&#160;at&#160;the&#160;same&#160;value&#160;for&#160;as&#160;long&#160;as&#160;it&#160;lives.&#160;This&#160;is&#160;useful&#160;for&#160;bindings&#160;that<br/>give&#160;a&#160;name&#160;to&#160;a&#160;value&#160;so&#160;that&#160;you&#160;can&#160;easily&#160;refer&#160;to&#160;it&#160;later.<br/>
<b>Binding&#160;names</b><br/>
Binding&#160;names&#160;can&#160;be&#160;any&#160;word.&#160;Digits&#160;can&#160;be&#160;part&#160;of&#160;binding&#160;names—catch22<br/>
is&#160;a&#160;valid&#160;name,&#160;for&#160;example—but&#160;the&#160;name&#160;must&#160;not&#160;start&#160;with&#160;a&#160;digit.&#160;A<br/>
binding&#160;name&#160;may&#160;include&#160;dollar&#160;signs&#160;($)&#160;or&#160;underscores&#160;(_)&#160;but&#160;no&#160;other<br/>punctuation&#160;or&#160;special&#160;characters.<br/>
Words&#160;with&#160;a&#160;special&#160;meaning,&#160;such&#160;as&#160;let,&#160;are&#160;<i>keywords</i>,&#160;and&#160;they&#160;may&#160;not<br/>
be&#160;used&#160;as&#160;binding&#160;names.&#160;There&#160;are&#160;also&#160;a&#160;number&#160;of&#160;words&#160;that&#160;are&#160;“reserved<br/>for&#160;use”&#160;in&#160;future&#160;versions&#160;of&#160;JavaScript,&#160;which&#160;also&#160;can’t&#160;be&#160;used&#160;as&#160;binding<br/>names.&#160;The&#160;full&#160;list&#160;of&#160;keywords&#160;and&#160;reserved&#160;words&#160;is&#160;rather&#160;long.<br/>
break&#160;case&#160;catch&#160;class&#160;const&#160;continue&#160;debugger&#160;default<br/>delete&#160;do&#160;else&#160;enum&#160;export&#160;extends&#160;false&#160;finally&#160;for<br/>function&#160;if&#160;implements&#160;import&#160;interface&#160;in&#160;instanceof&#160;let<br/>new&#160;package&#160;private&#160;protected&#160;public&#160;return&#160;static&#160;super<br/>switch&#160;this&#160;throw&#160;true&#160;try&#160;typeof&#160;var&#160;void&#160;while&#160;with&#160;yield<br/>
Don’t&#160;worry&#160;about&#160;memorizing&#160;this&#160;list.&#160;When&#160;creating&#160;a&#160;binding&#160;produces<br/>
an&#160;unexpected&#160;syntax&#160;error,&#160;see&#160;whether&#160;you’re&#160;trying&#160;to&#160;define&#160;a&#160;reserved&#160;word.<br/>
<b>The&#160;environment</b><br/>
The&#160;collection&#160;of&#160;bindings&#160;and&#160;their&#160;values&#160;that&#160;exist&#160;at&#160;a&#160;given&#160;time&#160;is&#160;called<br/>the&#160;<i>environment</i>.&#160;When&#160;a&#160;program&#160;starts&#160;up,&#160;this&#160;environment&#160;is&#160;not&#160;empty.&#160;It<br/>always&#160;contains&#160;bindings&#160;that&#160;are&#160;part&#160;of&#160;the&#160;language&#160;standard,&#160;and&#160;most&#160;of&#160;the<br/>time,&#160;it&#160;also&#160;has&#160;bindings&#160;that&#160;provide&#160;ways&#160;to&#160;interact&#160;with&#160;the&#160;surrounding<br/>system.&#160;For&#160;example,&#160;in&#160;a&#160;browser,&#160;there&#160;are&#160;functions&#160;to&#160;interact&#160;with&#160;the<br/>currently&#160;loaded&#160;website&#160;and&#160;to&#160;read&#160;mouse&#160;and&#160;keyboard&#160;input.<br/>
25<br/>
<hr/>
<a name=38></a><img src="eloquent-javascript-38_1.png"/><br/>
<b>Functions</b><br/>
A&#160;lot&#160;of&#160;the&#160;values&#160;provided&#160;in&#160;the&#160;default&#160;environment&#160;have&#160;the&#160;type&#160;<i>function</i>.<br/>A&#160;function&#160;is&#160;a&#160;piece&#160;of&#160;program&#160;wrapped&#160;in&#160;a&#160;value.&#160;Such&#160;values&#160;can&#160;be&#160;<i>applied<br/></i>in&#160;order&#160;to&#160;run&#160;the&#160;wrapped&#160;program.&#160;For&#160;example,&#160;in&#160;a&#160;browser&#160;environment,<br/>the&#160;binding&#160;prompt&#160;holds&#160;a&#160;function&#160;that&#160;shows&#160;a&#160;little&#160;dialog&#160;box&#160;asking&#160;for<br/>user&#160;input.&#160;It&#160;is&#160;used&#160;like&#160;this:<br/>
prompt(&#34;Enter&#160;passcode&#34;);<br/>
Executing&#160;a&#160;function&#160;is&#160;called&#160;<i>invoking</i>,&#160;<i>calling</i>,&#160;or&#160;<i>applying&#160;</i>it.&#160;You&#160;can<br/>
call&#160;a&#160;function&#160;by&#160;putting&#160;parentheses&#160;after&#160;an&#160;expression&#160;that&#160;produces&#160;a<br/>function&#160;value.&#160;Usually&#160;you’ll&#160;directly&#160;use&#160;the&#160;name&#160;of&#160;the&#160;binding&#160;that&#160;holds<br/>the&#160;function.&#160;The&#160;values&#160;between&#160;the&#160;parentheses&#160;are&#160;given&#160;to&#160;the&#160;program<br/>inside&#160;the&#160;function.&#160;In&#160;the&#160;example,&#160;the&#160;prompt&#160;function&#160;uses&#160;the&#160;string&#160;that<br/>we&#160;give&#160;it&#160;as&#160;the&#160;text&#160;to&#160;show&#160;in&#160;the&#160;dialog&#160;box.&#160;Values&#160;given&#160;to&#160;functions&#160;are<br/>called&#160;<i>arguments</i>.&#160;Different&#160;functions&#160;might&#160;need&#160;a&#160;different&#160;number&#160;or&#160;different<br/>types&#160;of&#160;arguments.<br/>
The&#160;prompt&#160;function&#160;isn’t&#160;used&#160;much&#160;in&#160;modern&#160;web&#160;programming,&#160;mostly<br/>
because&#160;you&#160;have&#160;no&#160;control&#160;over&#160;the&#160;way&#160;the&#160;resulting&#160;dialog&#160;looks,&#160;but&#160;can<br/>be&#160;helpful&#160;in&#160;toy&#160;programs&#160;and&#160;experiments.<br/>
<b>The&#160;console.log&#160;function</b><br/>
In&#160;the&#160;examples,&#160;I&#160;used&#160;console.log&#160;to&#160;output&#160;values.&#160;Most&#160;JavaScript&#160;sys-<br/>tems&#160;(including&#160;all&#160;modern&#160;web&#160;browsers&#160;and&#160;Node.js)&#160;provide&#160;a&#160;console.log<br/>function&#160;that&#160;writes&#160;out&#160;its&#160;arguments&#160;to&#160;<i>some&#160;</i>text&#160;output&#160;device.&#160;In&#160;browsers,<br/>the&#160;output&#160;lands&#160;in&#160;the&#160;JavaScript&#160;console.&#160;This&#160;part&#160;of&#160;the&#160;browser&#160;interface<br/>is&#160;hidden&#160;by&#160;default,&#160;but&#160;most&#160;browsers&#160;open&#160;it&#160;when&#160;you&#160;press&#160;F12&#160;or,&#160;on&#160;a<br/>Mac,&#160;command-option-I.&#160;If&#160;that&#160;does&#160;not&#160;work,&#160;search&#160;through&#160;the&#160;menus<br/>for&#160;an&#160;item&#160;named&#160;Developer&#160;Tools&#160;or&#160;similar.<br/>
Though&#160;binding&#160;names&#160;cannot&#160;contain&#160;period&#160;characters,&#160;console.log&#160;does<br/>
have&#160;one.&#160;This&#160;is&#160;because&#160;console.log&#160;isn’t&#160;a&#160;simple&#160;binding.&#160;It&#160;is&#160;actually&#160;an<br/>
26<br/>
<hr/>
<a name=39></a>expression&#160;that&#160;retrieves&#160;the&#160;log&#160;property&#160;from&#160;the&#160;value&#160;held&#160;by&#160;the&#160;console<br/>binding.&#160;We’ll&#160;find&#160;out&#160;exactly&#160;what&#160;this&#160;means&#160;in&#160;<a href="eloquent-javascripts.html#70">Chapter&#160;4</a>.<br/>
<b>Return&#160;values</b><br/>
Showing&#160;a&#160;dialog&#160;box&#160;or&#160;writing&#160;text&#160;to&#160;the&#160;screen&#160;is&#160;a&#160;<i>side&#160;effect</i>.&#160;A&#160;lot&#160;of<br/>functions&#160;are&#160;useful&#160;because&#160;of&#160;the&#160;side&#160;effects&#160;they&#160;produce.&#160;Functions&#160;may<br/>also&#160;produce&#160;values,&#160;in&#160;which&#160;case&#160;they&#160;don’t&#160;need&#160;to&#160;have&#160;a&#160;side&#160;effect&#160;to<br/>be&#160;useful.&#160;For&#160;example,&#160;the&#160;function&#160;Math.max&#160;takes&#160;any&#160;amount&#160;of&#160;number<br/>arguments&#160;and&#160;gives&#160;back&#160;the&#160;greatest.<br/>
console.log(Math.max(2,&#160;4));<br/>//&#160;→&#160;4<br/>
When&#160;a&#160;function&#160;produces&#160;a&#160;value,&#160;it&#160;is&#160;said&#160;to&#160;<i>return&#160;</i>that&#160;value.&#160;Anything<br/>
that&#160;produces&#160;a&#160;value&#160;is&#160;an&#160;expression&#160;in&#160;JavaScript,&#160;which&#160;means&#160;function<br/>calls&#160;can&#160;be&#160;used&#160;within&#160;larger&#160;expressions.&#160;Here&#160;a&#160;call&#160;to&#160;Math.min,&#160;which&#160;is<br/>the&#160;opposite&#160;of&#160;Math.max,&#160;is&#160;used&#160;as&#160;part&#160;of&#160;a&#160;plus&#160;expression:<br/>
console.log(Math.min(2,&#160;4)&#160;+&#160;100);<br/>//&#160;→&#160;102<br/>
The&#160;<a href="eloquent-javascripts.html#51">next&#160;chapter&#160;</a>explains&#160;how&#160;to&#160;write&#160;your&#160;own&#160;functions.<br/>
<b>Control&#160;flow</b><br/>
When&#160;your&#160;program&#160;contains&#160;more&#160;than&#160;one&#160;statement,&#160;the&#160;statements&#160;are<br/>executed&#160;as&#160;if&#160;they&#160;are&#160;a&#160;story,&#160;from&#160;top&#160;to&#160;bottom.&#160;This&#160;example&#160;program<br/>has&#160;two&#160;statements.&#160;The&#160;first&#160;one&#160;asks&#160;the&#160;user&#160;for&#160;a&#160;number,&#160;and&#160;the&#160;second,<br/>which&#160;is&#160;executed&#160;after&#160;the&#160;first,&#160;shows&#160;the&#160;square&#160;of&#160;that&#160;number.<br/>
let&#160;theNumber&#160;=&#160;Number(prompt(&#34;Pick&#160;a&#160;number&#34;));<br/>console.log(&#34;Your&#160;number&#160;is&#160;the&#160;square&#160;root&#160;of&#160;&#34;&#160;+<br/>
theNumber&#160;*&#160;theNumber);<br/>
The&#160;function&#160;Number&#160;converts&#160;a&#160;value&#160;to&#160;a&#160;number.&#160;We&#160;need&#160;that&#160;conversion<br/>
because&#160;the&#160;result&#160;of&#160;prompt&#160;is&#160;a&#160;string&#160;value,&#160;and&#160;we&#160;want&#160;a&#160;number.&#160;There<br/>are&#160;similar&#160;functions&#160;called&#160;String&#160;and&#160;Boolean&#160;that&#160;convert&#160;values&#160;to&#160;those<br/>types.<br/>
27<br/>
<hr/>
<a name=40></a>Here&#160;is&#160;the&#160;rather&#160;trivial&#160;schematic&#160;representation&#160;of&#160;straight-line&#160;control<br/>
flow:<br/>
<b>Conditional&#160;execution</b><br/>
Not&#160;all&#160;programs&#160;are&#160;straight&#160;roads.&#160;We&#160;may,&#160;for&#160;example,&#160;want&#160;to&#160;create<br/>a&#160;branching&#160;road,&#160;where&#160;the&#160;program&#160;takes&#160;the&#160;proper&#160;branch&#160;based&#160;on&#160;the<br/>situation&#160;at&#160;hand.&#160;This&#160;is&#160;called&#160;<i>conditional&#160;execution</i>.<br/>
Conditional&#160;execution&#160;is&#160;created&#160;with&#160;the&#160;if&#160;keyword&#160;in&#160;JavaScript.&#160;In&#160;the<br/>
simple&#160;case,&#160;we&#160;want&#160;some&#160;code&#160;to&#160;be&#160;executed&#160;if,&#160;and&#160;only&#160;if,&#160;a&#160;certain&#160;condition<br/>holds.&#160;We&#160;might,&#160;for&#160;example,&#160;want&#160;to&#160;show&#160;the&#160;square&#160;of&#160;the&#160;input&#160;only&#160;if&#160;the<br/>input&#160;is&#160;actually&#160;a&#160;number.<br/>
let&#160;theNumber&#160;=&#160;Number(prompt(&#34;Pick&#160;a&#160;number&#34;));<br/>if&#160;(!Number.isNaN(theNumber))&#160;{<br/>
console.log(&#34;Your&#160;number&#160;is&#160;the&#160;square&#160;root&#160;of&#160;&#34;&#160;+<br/>
theNumber&#160;*&#160;theNumber);<br/>
}<br/>
With&#160;this&#160;modification,&#160;if&#160;you&#160;enter&#160;“parrot”,&#160;no&#160;output&#160;is&#160;shown.<br/>The&#160;if&#160;keyword&#160;executes&#160;or&#160;skips&#160;a&#160;statement&#160;depending&#160;on&#160;the&#160;value&#160;of<br/>
a&#160;Boolean&#160;expression.&#160;The&#160;deciding&#160;expression&#160;is&#160;written&#160;after&#160;the&#160;keyword,<br/>between&#160;parentheses,&#160;followed&#160;by&#160;the&#160;statement&#160;to&#160;execute.<br/>
The&#160;Number.isNaN&#160;function&#160;is&#160;a&#160;standard&#160;JavaScript&#160;function&#160;that&#160;returns<br/>
true&#160;only&#160;if&#160;the&#160;argument&#160;it&#160;is&#160;given&#160;is&#160;NaN.&#160;The&#160;Number&#160;function&#160;happens&#160;to<br/>return&#160;NaN&#160;when&#160;you&#160;give&#160;it&#160;a&#160;string&#160;that&#160;doesn’t&#160;represent&#160;a&#160;valid&#160;number.<br/>Thus,&#160;the&#160;condition&#160;translates&#160;to&#160;“unless&#160;theNumber&#160;is&#160;not-a-number,&#160;do&#160;this”.<br/>
The&#160;statement&#160;after&#160;the&#160;if&#160;is&#160;wrapped&#160;in&#160;braces&#160;({&#160;and&#160;})&#160;in&#160;this&#160;example.<br/>
The&#160;braces&#160;can&#160;be&#160;used&#160;to&#160;group&#160;any&#160;number&#160;of&#160;statements&#160;into&#160;a&#160;single&#160;state-<br/>ment,&#160;called&#160;a&#160;<i>block</i>.&#160;You&#160;could&#160;also&#160;have&#160;omitted&#160;them&#160;in&#160;this&#160;case,&#160;since&#160;they<br/>hold&#160;only&#160;a&#160;single&#160;statement,&#160;but&#160;to&#160;avoid&#160;having&#160;to&#160;think&#160;about&#160;whether&#160;they<br/>are&#160;needed,&#160;most&#160;JavaScript&#160;programmers&#160;use&#160;them&#160;in&#160;every&#160;wrapped&#160;state-<br/>ment&#160;like&#160;this.&#160;We’ll&#160;mostly&#160;follow&#160;that&#160;convention&#160;in&#160;this&#160;book,&#160;except&#160;for&#160;the<br/>occasional&#160;one-liner.<br/>
28<br/>
<hr/>
<a name=41></a>if&#160;(1&#160;+&#160;1&#160;==&#160;2)&#160;console.log(&#34;It's&#160;true&#34;);<br/>//&#160;→&#160;It's&#160;true<br/>
You&#160;often&#160;won’t&#160;just&#160;have&#160;code&#160;that&#160;executes&#160;when&#160;a&#160;condition&#160;holds&#160;true,<br/>
but&#160;also&#160;code&#160;that&#160;handles&#160;the&#160;other&#160;case.&#160;This&#160;alternate&#160;path&#160;is&#160;represented<br/>by&#160;the&#160;second&#160;arrow&#160;in&#160;the&#160;diagram.&#160;You&#160;can&#160;use&#160;the&#160;else&#160;keyword,&#160;together<br/>with&#160;if,&#160;to&#160;create&#160;two&#160;separate,&#160;alternative&#160;execution&#160;paths.<br/>
let&#160;theNumber&#160;=&#160;Number(prompt(&#34;Pick&#160;a&#160;number&#34;));<br/>if&#160;(!Number.isNaN(theNumber))&#160;{<br/>
console.log(&#34;Your&#160;number&#160;is&#160;the&#160;square&#160;root&#160;of&#160;&#34;&#160;+<br/>
theNumber&#160;*&#160;theNumber);<br/>
}&#160;else&#160;{<br/>
console.log(&#34;Hey.&#160;Why&#160;didn't&#160;you&#160;give&#160;me&#160;a&#160;number?&#34;);<br/>
}<br/>
If&#160;you&#160;have&#160;more&#160;than&#160;two&#160;paths&#160;to&#160;choose&#160;from,&#160;you&#160;can&#160;“chain”&#160;multiple<br/>
if/else&#160;pairs&#160;together.&#160;Here’s&#160;an&#160;example:<br/>
let&#160;num&#160;=&#160;Number(prompt(&#34;Pick&#160;a&#160;number&#34;));<br/>
if&#160;(num&#160;&lt;&#160;10)&#160;{<br/>
console.log(&#34;Small&#34;);<br/>
}&#160;else&#160;if&#160;(num&#160;&lt;&#160;100)&#160;{<br/>
console.log(&#34;Medium&#34;);<br/>
}&#160;else&#160;{<br/>
console.log(&#34;Large&#34;);<br/>
}<br/>
The&#160;program&#160;will&#160;first&#160;check&#160;whether&#160;num&#160;is&#160;less&#160;than&#160;10.&#160;If&#160;it&#160;is,&#160;it&#160;chooses<br/>
that&#160;branch,&#160;shows&#160;&#34;Small&#34;,&#160;and&#160;is&#160;done.&#160;If&#160;it&#160;isn’t,&#160;it&#160;takes&#160;the&#160;else&#160;branch,<br/>which&#160;itself&#160;contains&#160;a&#160;second&#160;if.&#160;If&#160;the&#160;second&#160;condition&#160;(&lt;&#160;100)&#160;holds,&#160;that<br/>means&#160;the&#160;number&#160;is&#160;between&#160;10&#160;and&#160;100,&#160;and&#160;&#34;Medium&#34;&#160;is&#160;shown.&#160;If&#160;it&#160;doesn’t,<br/>the&#160;second&#160;and&#160;last&#160;else&#160;branch&#160;is&#160;chosen.<br/>
The&#160;schema&#160;for&#160;this&#160;program&#160;looks&#160;something&#160;like&#160;this:<br/>
29<br/>
<hr/>
<a name=42></a><b>while&#160;and&#160;do&#160;loops</b><br/>
Consider&#160;a&#160;program&#160;that&#160;outputs&#160;all&#160;even&#160;numbers&#160;from&#160;0&#160;to&#160;12.&#160;One&#160;way&#160;to<br/>write&#160;this&#160;is&#160;as&#160;follows:<br/>
console.log(0);<br/>console.log(2);<br/>console.log(4);<br/>console.log(6);<br/>console.log(8);<br/>console.log(10);<br/>console.log(12);<br/>
That&#160;works,&#160;but&#160;the&#160;idea&#160;of&#160;writing&#160;a&#160;program&#160;is&#160;to&#160;make&#160;something&#160;<i>less</i><br/>
work,&#160;not&#160;more.&#160;If&#160;we&#160;needed&#160;all&#160;even&#160;numbers&#160;less&#160;than&#160;1,000,&#160;this&#160;approach<br/>would&#160;be&#160;unworkable.&#160;What&#160;we&#160;need&#160;is&#160;a&#160;way&#160;to&#160;run&#160;a&#160;piece&#160;of&#160;code&#160;multiple<br/>times.&#160;This&#160;form&#160;of&#160;control&#160;flow&#160;is&#160;called&#160;a&#160;<i>loop</i>.<br/>
Looping&#160;control&#160;flow&#160;allows&#160;us&#160;to&#160;go&#160;back&#160;to&#160;some&#160;point&#160;in&#160;the&#160;program&#160;where<br/>
we&#160;were&#160;before&#160;and&#160;repeat&#160;it&#160;with&#160;our&#160;current&#160;program&#160;state.&#160;If&#160;we&#160;combine<br/>this&#160;with&#160;a&#160;binding&#160;that&#160;counts,&#160;we&#160;can&#160;do&#160;something&#160;like&#160;this:<br/>
let&#160;number&#160;=&#160;0;<br/>while&#160;(number&#160;&lt;=&#160;12)&#160;{<br/>
console.log(number);<br/>number&#160;=&#160;number&#160;+&#160;2;<br/>
}<br/>//&#160;→&#160;0<br/>//&#160;→&#160;2<br/>//&#160;…<br/>
etcetera<br/>
A&#160;statement&#160;starting&#160;with&#160;the&#160;keyword&#160;while&#160;creates&#160;a&#160;loop.&#160;The&#160;word&#160;while<br/>
is&#160;followed&#160;by&#160;an&#160;expression&#160;in&#160;parentheses&#160;and&#160;then&#160;a&#160;statement,&#160;much&#160;like&#160;if.<br/>The&#160;loop&#160;keeps&#160;entering&#160;that&#160;statement&#160;as&#160;long&#160;as&#160;the&#160;expression&#160;produces&#160;a<br/>value&#160;that&#160;gives&#160;true&#160;when&#160;converted&#160;to&#160;Boolean.<br/>
The&#160;number&#160;binding&#160;demonstrates&#160;the&#160;way&#160;a&#160;binding&#160;can&#160;track&#160;the&#160;progress<br/>
of&#160;a&#160;program.&#160;Every&#160;time&#160;the&#160;loop&#160;repeats,&#160;number&#160;gets&#160;a&#160;value&#160;that&#160;is&#160;2&#160;more<br/>than&#160;its&#160;previous&#160;value.&#160;At&#160;the&#160;beginning&#160;of&#160;every&#160;repetition,&#160;it&#160;is&#160;compared<br/>
30<br/>
<hr/>
<a name=43></a>with&#160;the&#160;number&#160;12&#160;to&#160;decide&#160;whether&#160;the&#160;program’s&#160;work&#160;is&#160;finished.<br/>
As&#160;an&#160;example&#160;that&#160;actually&#160;does&#160;something&#160;useful,&#160;we&#160;can&#160;now&#160;write&#160;a<br/>
program&#160;that&#160;calculates&#160;and&#160;shows&#160;the&#160;value&#160;of&#160;210&#160;(2&#160;to&#160;the&#160;10th&#160;power).&#160;We<br/>use&#160;two&#160;bindings:&#160;one&#160;to&#160;keep&#160;track&#160;of&#160;our&#160;result&#160;and&#160;one&#160;to&#160;count&#160;how&#160;often<br/>we&#160;have&#160;multiplied&#160;this&#160;result&#160;by&#160;2.&#160;The&#160;loop&#160;tests&#160;whether&#160;the&#160;second&#160;binding<br/>has&#160;reached&#160;10&#160;yet&#160;and,&#160;if&#160;not,&#160;updates&#160;both&#160;bindings.<br/>
let&#160;result&#160;=&#160;1;<br/>let&#160;counter&#160;=&#160;0;<br/>while&#160;(counter&#160;&lt;&#160;10)&#160;{<br/>
result&#160;=&#160;result&#160;*&#160;2;<br/>counter&#160;=&#160;counter&#160;+&#160;1;<br/>
}<br/>console.log(result);<br/>//&#160;→&#160;1024<br/>
The&#160;counter&#160;could&#160;also&#160;have&#160;started&#160;at&#160;1&#160;and&#160;checked&#160;for&#160;&lt;=&#160;10,&#160;but&#160;for<br/>
reasons&#160;that&#160;will&#160;become&#160;apparent&#160;in&#160;<a href="eloquent-javascripts.html#70">Chapter&#160;4,&#160;</a>it&#160;is&#160;a&#160;good&#160;idea&#160;to&#160;get&#160;used<br/>to&#160;counting&#160;from&#160;0.<br/>
A&#160;do&#160;loop&#160;is&#160;a&#160;control&#160;structure&#160;similar&#160;to&#160;a&#160;while&#160;loop.&#160;It&#160;differs&#160;only&#160;on&#160;one<br/>
point:&#160;a&#160;do&#160;loop&#160;always&#160;executes&#160;its&#160;body&#160;at&#160;least&#160;once,&#160;and&#160;it&#160;starts&#160;testing<br/>whether&#160;it&#160;should&#160;stop&#160;only&#160;after&#160;that&#160;first&#160;execution.&#160;To&#160;reflect&#160;this,&#160;the&#160;test<br/>appears&#160;after&#160;the&#160;body&#160;of&#160;the&#160;loop.<br/>
let&#160;yourName;<br/>do&#160;{<br/>
yourName&#160;=&#160;prompt(&#34;Who&#160;are&#160;you?&#34;);<br/>
}&#160;while&#160;(!yourName);<br/>console.log(yourName);<br/>
This&#160;program&#160;will&#160;force&#160;you&#160;to&#160;enter&#160;a&#160;name.&#160;It&#160;will&#160;ask&#160;again&#160;and&#160;again&#160;until<br/>
it&#160;gets&#160;something&#160;that&#160;is&#160;not&#160;an&#160;empty&#160;string.&#160;Applying&#160;the&#160;!&#160;operator&#160;will<br/>convert&#160;a&#160;value&#160;to&#160;Boolean&#160;type&#160;before&#160;negating&#160;it,&#160;and&#160;all&#160;strings&#160;except&#160;&#34;&#34;<br/>convert&#160;to&#160;true.&#160;This&#160;means&#160;the&#160;loop&#160;continues&#160;going&#160;round&#160;until&#160;you&#160;provide<br/>a&#160;non-empty&#160;name.<br/>
<b>Indenting&#160;Code</b><br/>
In&#160;the&#160;examples,&#160;I’ve&#160;been&#160;adding&#160;spaces&#160;in&#160;front&#160;of&#160;statements&#160;that&#160;are&#160;part<br/>of&#160;some&#160;larger&#160;statement.&#160;These&#160;spaces&#160;are&#160;not&#160;required—the&#160;computer&#160;will<br/>accept&#160;the&#160;program&#160;just&#160;fine&#160;without&#160;them.&#160;In&#160;fact,&#160;even&#160;the&#160;line&#160;breaks&#160;in<br/>
31<br/>
<hr/>
<a name=44></a>programs&#160;are&#160;optional.&#160;You&#160;could&#160;write&#160;a&#160;program&#160;as&#160;a&#160;single&#160;long&#160;line&#160;if&#160;you<br/>felt&#160;like&#160;it.<br/>
The&#160;role&#160;of&#160;this&#160;indentation&#160;inside&#160;blocks&#160;is&#160;to&#160;make&#160;the&#160;structure&#160;of&#160;the<br/>
code&#160;stand&#160;out.&#160;In&#160;code&#160;where&#160;new&#160;blocks&#160;are&#160;opened&#160;inside&#160;other&#160;blocks,<br/>it&#160;can&#160;become&#160;hard&#160;to&#160;see&#160;where&#160;one&#160;block&#160;ends&#160;and&#160;another&#160;begins.&#160;With<br/>proper&#160;indentation,&#160;the&#160;visual&#160;shape&#160;of&#160;a&#160;program&#160;corresponds&#160;to&#160;the&#160;shape&#160;of<br/>the&#160;blocks&#160;inside&#160;it.&#160;I&#160;like&#160;to&#160;use&#160;two&#160;spaces&#160;for&#160;every&#160;open&#160;block,&#160;but&#160;tastes<br/>differ—some&#160;people&#160;use&#160;four&#160;spaces,&#160;and&#160;some&#160;people&#160;use&#160;tab&#160;characters.&#160;The<br/>important&#160;thing&#160;is&#160;that&#160;each&#160;new&#160;block&#160;adds&#160;the&#160;same&#160;amount&#160;of&#160;space.<br/>
if&#160;(false&#160;!=&#160;true)&#160;{<br/>
console.log(&#34;That&#160;makes&#160;sense.&#34;);<br/>if&#160;(1&#160;&lt;&#160;2)&#160;{<br/>
console.log(&#34;No&#160;surprise&#160;there.&#34;);<br/>
}<br/>
}<br/>
Most&#160;code&#160;editor&#160;programs&#160;will&#160;help&#160;by&#160;automatically&#160;indenting&#160;new&#160;lines<br/>
the&#160;proper&#160;amount.<br/>
<b>for&#160;loops</b><br/>
Many&#160;loops&#160;follow&#160;the&#160;pattern&#160;shown&#160;in&#160;the&#160;while&#160;examples.&#160;First&#160;a&#160;“counter”<br/>binding&#160;is&#160;created&#160;to&#160;track&#160;the&#160;progress&#160;of&#160;the&#160;loop.&#160;Then&#160;comes&#160;a&#160;while&#160;loop,<br/>usually&#160;with&#160;a&#160;test&#160;expression&#160;that&#160;checks&#160;whether&#160;the&#160;counter&#160;has&#160;reached<br/>its&#160;end&#160;value.&#160;At&#160;the&#160;end&#160;of&#160;the&#160;loop&#160;body,&#160;the&#160;counter&#160;is&#160;updated&#160;to&#160;track<br/>progress.<br/>
Because&#160;this&#160;pattern&#160;is&#160;so&#160;common,&#160;JavaScript&#160;and&#160;similar&#160;languages&#160;provide<br/>
a&#160;slightly&#160;shorter&#160;and&#160;more&#160;comprehensive&#160;form,&#160;the&#160;for&#160;loop.<br/>
for&#160;(let&#160;number&#160;=&#160;0;&#160;number&#160;&lt;=&#160;12;&#160;number&#160;=&#160;number&#160;+&#160;2)&#160;{<br/>
console.log(number);<br/>
}<br/>//&#160;→&#160;0<br/>//&#160;→&#160;2<br/>//&#160;…<br/>
etcetera<br/>
This&#160;program&#160;is&#160;exactly&#160;equivalent&#160;to&#160;the&#160;<a href="eloquent-javascripts.html#41">earlier&#160;</a>even-number-printing&#160;exam-<br/>
ple.&#160;The&#160;only&#160;change&#160;is&#160;that&#160;all&#160;the&#160;statements&#160;that&#160;are&#160;related&#160;to&#160;the&#160;“state”<br/>of&#160;the&#160;loop&#160;are&#160;grouped&#160;together&#160;after&#160;for.<br/>
32<br/>
<hr/>
<a name=45></a>The&#160;parentheses&#160;after&#160;a&#160;for&#160;keyword&#160;must&#160;contain&#160;two&#160;semicolons.&#160;The&#160;part<br/>
before&#160;the&#160;first&#160;semicolon&#160;<i>initializes&#160;</i>the&#160;loop,&#160;usually&#160;by&#160;defining&#160;a&#160;binding.<br/>The&#160;second&#160;part&#160;is&#160;the&#160;expression&#160;that&#160;<i>checks&#160;</i>whether&#160;the&#160;loop&#160;must&#160;continue.<br/>The&#160;final&#160;part&#160;<i>updates&#160;</i>the&#160;state&#160;of&#160;the&#160;loop&#160;after&#160;every&#160;iteration.&#160;In&#160;most&#160;cases,<br/>this&#160;is&#160;shorter&#160;and&#160;clearer&#160;than&#160;a&#160;while&#160;construct.<br/>
This&#160;is&#160;the&#160;code&#160;that&#160;computes&#160;210&#160;using&#160;for&#160;instead&#160;of&#160;while:<br/>
let&#160;result&#160;=&#160;1;<br/>for&#160;(let&#160;counter&#160;=&#160;0;&#160;counter&#160;&lt;&#160;10;&#160;counter&#160;=&#160;counter&#160;+&#160;1)&#160;{<br/>
result&#160;=&#160;result&#160;*&#160;2;<br/>
}<br/>console.log(result);<br/>//&#160;→&#160;1024<br/>
<b>Breaking&#160;Out&#160;of&#160;a&#160;Loop</b><br/>
Having&#160;the&#160;looping&#160;condition&#160;produce&#160;false&#160;is&#160;not&#160;the&#160;only&#160;way&#160;a&#160;loop&#160;can&#160;fin-<br/>ish.&#160;There&#160;is&#160;a&#160;special&#160;statement&#160;called&#160;break&#160;that&#160;has&#160;the&#160;effect&#160;of&#160;immediately<br/>jumping&#160;out&#160;of&#160;the&#160;enclosing&#160;loop.<br/>
This&#160;program&#160;illustrates&#160;the&#160;break&#160;statement.&#160;It&#160;finds&#160;the&#160;first&#160;number&#160;that<br/>
is&#160;both&#160;greater&#160;than&#160;or&#160;equal&#160;to&#160;20&#160;and&#160;divisible&#160;by&#160;7.<br/>
for&#160;(let&#160;current&#160;=&#160;20;&#160;;&#160;current&#160;=&#160;current&#160;+&#160;1)&#160;{<br/>
if&#160;(current&#160;%&#160;7&#160;==&#160;0)&#160;{<br/>
console.log(current);<br/>break;<br/>
}<br/>
}<br/>//&#160;→&#160;21<br/>
Using&#160;the&#160;remainder&#160;(%)&#160;operator&#160;is&#160;an&#160;easy&#160;way&#160;to&#160;test&#160;whether&#160;a&#160;number<br/>
is&#160;divisible&#160;by&#160;another&#160;number.&#160;If&#160;it&#160;is,&#160;the&#160;remainder&#160;of&#160;their&#160;division&#160;is&#160;zero.<br/>
The&#160;for&#160;construct&#160;in&#160;the&#160;example&#160;does&#160;not&#160;have&#160;a&#160;part&#160;that&#160;checks&#160;for&#160;the<br/>
end&#160;of&#160;the&#160;loop.&#160;This&#160;means&#160;that&#160;the&#160;loop&#160;will&#160;never&#160;stop&#160;unless&#160;the&#160;break<br/>statement&#160;inside&#160;is&#160;executed.<br/>
If&#160;you&#160;were&#160;to&#160;remove&#160;that&#160;break&#160;statement&#160;or&#160;you&#160;accidentally&#160;write&#160;an<br/>
end&#160;condition&#160;that&#160;always&#160;produces&#160;true,&#160;your&#160;program&#160;would&#160;get&#160;stuck&#160;in&#160;an<br/><i>infinite&#160;loop</i>.&#160;A&#160;program&#160;stuck&#160;in&#160;an&#160;infinite&#160;loop&#160;will&#160;never&#160;finish&#160;running,<br/>which&#160;is&#160;usually&#160;a&#160;bad&#160;thing.<br/>
33<br/>
<hr/>
<a name=46></a>The&#160;continue&#160;keyword&#160;is&#160;similar&#160;to&#160;break,&#160;in&#160;that&#160;it&#160;influences&#160;the&#160;progress<br/>
of&#160;a&#160;loop.&#160;When&#160;continue&#160;is&#160;encountered&#160;in&#160;a&#160;loop&#160;body,&#160;control&#160;jumps&#160;out&#160;of<br/>the&#160;body&#160;and&#160;continues&#160;with&#160;the&#160;loop’s&#160;next&#160;iteration.<br/>
<b>Updating&#160;bindings&#160;succinctly</b><br/>
Especially&#160;when&#160;looping,&#160;a&#160;program&#160;often&#160;needs&#160;to&#160;“update”&#160;a&#160;binding&#160;to&#160;hold<br/>a&#160;value&#160;based&#160;on&#160;that&#160;binding’s&#160;previous&#160;value.<br/>
counter&#160;=&#160;counter&#160;+&#160;1;<br/>
JavaScript&#160;provides&#160;a&#160;shortcut&#160;for&#160;this.<br/>
counter&#160;+=&#160;1;<br/>
Similar&#160;shortcuts&#160;work&#160;for&#160;many&#160;other&#160;operators,&#160;such&#160;as&#160;result&#160;*=&#160;2&#160;to<br/>
double&#160;result&#160;or&#160;counter&#160;-=&#160;1&#160;to&#160;count&#160;downward.<br/>
This&#160;allows&#160;us&#160;to&#160;shorten&#160;our&#160;counting&#160;example&#160;a&#160;little&#160;more.<br/>
for&#160;(let&#160;number&#160;=&#160;0;&#160;number&#160;&lt;=&#160;12;&#160;number&#160;+=&#160;2)&#160;{<br/>
console.log(number);<br/>
}<br/>
For&#160;counter&#160;+=&#160;1&#160;and&#160;counter&#160;-=&#160;1,&#160;there&#160;are&#160;even&#160;shorter&#160;equivalents:<br/>
counter++&#160;and&#160;counter--.<br/>
<b>Dispatching&#160;on&#160;a&#160;value&#160;with&#160;switch</b><br/>
It&#160;is&#160;not&#160;uncommon&#160;for&#160;code&#160;to&#160;look&#160;like&#160;this:<br/>
if&#160;(x&#160;==&#160;&#34;value1&#34;)&#160;action1();<br/>else&#160;if&#160;(x&#160;==&#160;&#34;value2&#34;)&#160;action2();<br/>else&#160;if&#160;(x&#160;==&#160;&#34;value3&#34;)&#160;action3();<br/>else&#160;defaultAction();<br/>
There&#160;is&#160;a&#160;construct&#160;called&#160;switch&#160;that&#160;is&#160;intended&#160;to&#160;express&#160;such&#160;a&#160;“dis-<br/>
patch”&#160;in&#160;a&#160;more&#160;direct&#160;way.&#160;Unfortunately,&#160;the&#160;syntax&#160;JavaScript&#160;uses&#160;for<br/>this&#160;(which&#160;it&#160;inherited&#160;from&#160;the&#160;C/Java&#160;line&#160;of&#160;programming&#160;languages)&#160;is<br/>somewhat&#160;awkward—a&#160;chain&#160;of&#160;if&#160;statements&#160;may&#160;look&#160;better.&#160;Here&#160;is&#160;an<br/>example:<br/>
34<br/>
<hr/>
<a name=47></a>switch&#160;(prompt(&#34;What&#160;is&#160;the&#160;weather&#160;like?&#34;))&#160;{<br/>
case&#160;&#34;rainy&#34;:<br/>
console.log(&#34;Remember&#160;to&#160;bring&#160;an&#160;umbrella.&#34;);<br/>break;<br/>
case&#160;&#34;sunny&#34;:<br/>
console.log(&#34;Dress&#160;lightly.&#34;);<br/>
case&#160;&#34;cloudy&#34;:<br/>
console.log(&#34;Go&#160;outside.&#34;);<br/>break;<br/>
default:<br/>
console.log(&#34;Unknown&#160;weather&#160;type!&#34;);<br/>break;<br/>
}<br/>
You&#160;may&#160;put&#160;any&#160;number&#160;of&#160;case&#160;labels&#160;inside&#160;the&#160;block&#160;opened&#160;by&#160;switch.<br/>
The&#160;program&#160;will&#160;start&#160;executing&#160;at&#160;the&#160;label&#160;that&#160;corresponds&#160;to&#160;the&#160;value<br/>that&#160;switch&#160;was&#160;given,&#160;or&#160;at&#160;default&#160;if&#160;no&#160;matching&#160;value&#160;is&#160;found.&#160;It&#160;will<br/>continue&#160;executing,&#160;even&#160;across&#160;other&#160;labels,&#160;until&#160;it&#160;reaches&#160;a&#160;break&#160;statement.<br/>In&#160;some&#160;cases,&#160;such&#160;as&#160;the&#160;&#34;sunny&#34;&#160;case&#160;in&#160;the&#160;example,&#160;this&#160;can&#160;be&#160;used&#160;to<br/>share&#160;some&#160;code&#160;between&#160;cases&#160;(it&#160;recommends&#160;going&#160;outside&#160;for&#160;both&#160;sunny<br/>and&#160;cloudy&#160;weather).&#160;But&#160;be&#160;careful—it&#160;is&#160;easy&#160;to&#160;forget&#160;such&#160;a&#160;break,&#160;which<br/>will&#160;cause&#160;the&#160;program&#160;to&#160;execute&#160;code&#160;you&#160;do&#160;not&#160;want&#160;executed.<br/>
<b>Capitalization</b><br/>
Binding&#160;names&#160;may&#160;not&#160;contain&#160;spaces,&#160;yet&#160;it&#160;is&#160;often&#160;helpful&#160;to&#160;use&#160;multiple<br/>words&#160;to&#160;clearly&#160;describe&#160;what&#160;the&#160;binding&#160;represents.&#160;These&#160;are&#160;pretty&#160;much<br/>your&#160;choices&#160;for&#160;writing&#160;a&#160;binding&#160;name&#160;with&#160;several&#160;words&#160;in&#160;it:<br/>
fuzzylittleturtle<br/>fuzzy_little_turtle<br/>FuzzyLittleTurtle<br/>fuzzyLittleTurtle<br/>
The&#160;first&#160;style&#160;can&#160;be&#160;hard&#160;to&#160;read.&#160;I&#160;rather&#160;like&#160;the&#160;look&#160;of&#160;the&#160;underscores,<br/>
though&#160;that&#160;style&#160;is&#160;a&#160;little&#160;painful&#160;to&#160;type.&#160;The&#160;standard&#160;JavaScript&#160;functions,<br/>and&#160;most&#160;JavaScript&#160;programmers,&#160;follow&#160;the&#160;bottom&#160;style—they&#160;capitalize<br/>every&#160;word&#160;except&#160;the&#160;first.&#160;It&#160;is&#160;not&#160;hard&#160;to&#160;get&#160;used&#160;to&#160;little&#160;things&#160;like&#160;that,<br/>and&#160;code&#160;with&#160;mixed&#160;naming&#160;styles&#160;can&#160;be&#160;jarring&#160;to&#160;read,&#160;so&#160;we&#160;follow&#160;this<br/>convention.<br/>
In&#160;a&#160;few&#160;cases,&#160;such&#160;as&#160;the&#160;Number&#160;function,&#160;the&#160;first&#160;letter&#160;of&#160;a&#160;binding&#160;is<br/>
35<br/>
<hr/>
<a name=48></a>also&#160;capitalized.&#160;This&#160;was&#160;done&#160;to&#160;mark&#160;this&#160;function&#160;as&#160;a&#160;constructor.&#160;What<br/>a&#160;constructor&#160;is&#160;will&#160;become&#160;clear&#160;in&#160;<a href="eloquent-javascripts.html#113">Chapter&#160;6</a>.&#160;For&#160;now,&#160;the&#160;important&#160;thing<br/>is&#160;not&#160;to&#160;be&#160;bothered&#160;by&#160;this&#160;apparent&#160;lack&#160;of&#160;consistency.<br/>
<b>Comments</b><br/>
Often,&#160;raw&#160;code&#160;does&#160;not&#160;convey&#160;all&#160;the&#160;information&#160;you&#160;want&#160;a&#160;program&#160;to<br/>convey&#160;to&#160;human&#160;readers,&#160;or&#160;it&#160;conveys&#160;it&#160;in&#160;such&#160;a&#160;cryptic&#160;way&#160;that&#160;people<br/>might&#160;not&#160;understand&#160;it.&#160;At&#160;other&#160;times,&#160;you&#160;might&#160;just&#160;want&#160;to&#160;include&#160;some<br/>related&#160;thoughts&#160;as&#160;part&#160;of&#160;your&#160;program.&#160;This&#160;is&#160;what&#160;<i>comments&#160;</i>are&#160;for.<br/>
A&#160;comment&#160;is&#160;a&#160;piece&#160;of&#160;text&#160;that&#160;is&#160;part&#160;of&#160;a&#160;program&#160;but&#160;is&#160;completely<br/>
ignored&#160;by&#160;the&#160;computer.&#160;JavaScript&#160;has&#160;two&#160;ways&#160;of&#160;writing&#160;comments.&#160;To<br/>write&#160;a&#160;single-line&#160;comment,&#160;you&#160;can&#160;use&#160;two&#160;slash&#160;characters&#160;(//)&#160;and&#160;then<br/>the&#160;comment&#160;text&#160;after&#160;it.<br/>
let&#160;accountBalance&#160;=&#160;calculateBalance(account);<br/>//&#160;It's&#160;a&#160;green&#160;hollow&#160;where&#160;a&#160;river&#160;sings<br/>accountBalance.adjust();<br/>//&#160;Madly&#160;catching&#160;white&#160;tatters&#160;in&#160;the&#160;grass.<br/>let&#160;report&#160;=&#160;new&#160;Report();<br/>//&#160;Where&#160;the&#160;sun&#160;on&#160;the&#160;proud&#160;mountain&#160;rings:<br/>addToReport(accountBalance,&#160;report);<br/>//&#160;It's&#160;a&#160;little&#160;valley,&#160;foaming&#160;like&#160;light&#160;in&#160;a&#160;glass.<br/>
A&#160;//&#160;comment&#160;goes&#160;only&#160;to&#160;the&#160;end&#160;of&#160;the&#160;line.&#160;A&#160;section&#160;of&#160;text&#160;between<br/>
/*&#160;and&#160;*/&#160;will&#160;be&#160;ignored&#160;in&#160;its&#160;entirety,&#160;regardless&#160;of&#160;whether&#160;it&#160;contains&#160;line<br/>breaks.&#160;This&#160;is&#160;useful&#160;for&#160;adding&#160;blocks&#160;of&#160;information&#160;about&#160;a&#160;file&#160;or&#160;a&#160;chunk<br/>of&#160;program.<br/>
/*<br/>
I&#160;first&#160;found&#160;this&#160;number&#160;scrawled&#160;on&#160;the&#160;back&#160;of&#160;an&#160;old&#160;notebook.<br/>Since&#160;then,&#160;it&#160;has&#160;often&#160;dropped&#160;by,&#160;showing&#160;up&#160;in&#160;phone&#160;numbers<br/>and&#160;the&#160;serial&#160;numbers&#160;of&#160;products&#160;that&#160;I've&#160;bought.&#160;It&#160;obviously<br/>likes&#160;me,&#160;so&#160;I've&#160;decided&#160;to&#160;keep&#160;it.<br/>
*/<br/>const&#160;myNumber&#160;=&#160;11213;<br/>
36<br/>
<hr/>
<a name=49></a><b>Summary</b><br/>
You&#160;now&#160;know&#160;that&#160;a&#160;program&#160;is&#160;built&#160;out&#160;of&#160;statements,&#160;which&#160;themselves<br/>sometimes&#160;contain&#160;more&#160;statements.&#160;Statements&#160;tend&#160;to&#160;contain&#160;expressions,<br/>which&#160;themselves&#160;can&#160;be&#160;built&#160;out&#160;of&#160;smaller&#160;expressions.<br/>
Putting&#160;statements&#160;after&#160;one&#160;another&#160;gives&#160;you&#160;a&#160;program&#160;that&#160;is&#160;executed<br/>
from&#160;top&#160;to&#160;bottom.&#160;You&#160;can&#160;introduce&#160;disturbances&#160;in&#160;the&#160;flow&#160;of&#160;control<br/>by&#160;using&#160;conditional&#160;(if,&#160;else,&#160;and&#160;switch)&#160;and&#160;looping&#160;(while,&#160;do,&#160;and&#160;for)<br/>statements.<br/>
Bindings&#160;can&#160;be&#160;used&#160;to&#160;file&#160;pieces&#160;of&#160;data&#160;under&#160;a&#160;name,&#160;and&#160;they&#160;are&#160;useful<br/>
for&#160;tracking&#160;state&#160;in&#160;your&#160;program.&#160;The&#160;environment&#160;is&#160;the&#160;set&#160;of&#160;bindings<br/>that&#160;are&#160;defined.&#160;JavaScript&#160;systems&#160;always&#160;put&#160;a&#160;number&#160;of&#160;useful&#160;standard<br/>bindings&#160;into&#160;your&#160;environment.<br/>
Functions&#160;are&#160;special&#160;values&#160;that&#160;encapsulate&#160;a&#160;piece&#160;of&#160;program.&#160;You&#160;can<br/>
invoke&#160;them&#160;by&#160;writing&#160;functionName(argument1,&#160;argument2).&#160;Such&#160;a&#160;function<br/>call&#160;is&#160;an&#160;expression&#160;and&#160;may&#160;produce&#160;a&#160;value.<br/>
<b>Exercises</b><br/>
If&#160;you&#160;are&#160;unsure&#160;how&#160;to&#160;test&#160;your&#160;solutions&#160;to&#160;the&#160;exercises,&#160;refer&#160;to&#160;the&#160;<a href="eloquent-javascripts.html#13">Intro-<br/>duction</a>.<br/>
Each&#160;exercise&#160;starts&#160;with&#160;a&#160;problem&#160;description.&#160;Read&#160;this&#160;description&#160;and<br/>
try&#160;to&#160;solve&#160;the&#160;exercise.&#160;If&#160;you&#160;run&#160;into&#160;problems,&#160;consider&#160;reading&#160;the&#160;hints<br/>at&#160;the&#160;<a href="eloquent-javascripts.html#400">end&#160;of&#160;the&#160;book.&#160;</a>Full&#160;solutions&#160;to&#160;the&#160;exercises&#160;are&#160;not&#160;included&#160;in&#160;this<br/>book,&#160;but&#160;you&#160;can&#160;find&#160;them&#160;online&#160;at&#160;<a href="https://eloquentjavascript.net/code#2"><i>https://eloquentjavascript.net/code</i></a>.&#160;If<br/>you&#160;want&#160;to&#160;learn&#160;something&#160;from&#160;the&#160;exercises,&#160;I&#160;recommend&#160;looking&#160;at&#160;the<br/>solutions&#160;only&#160;after&#160;you’ve&#160;solved&#160;the&#160;exercise,&#160;or&#160;at&#160;least&#160;after&#160;you’ve&#160;attacked<br/>it&#160;long&#160;and&#160;hard&#160;enough&#160;to&#160;have&#160;a&#160;slight&#160;headache.<br/>
<b>Looping&#160;a&#160;triangle</b><br/>
Write&#160;a&#160;loop&#160;that&#160;makes&#160;seven&#160;calls&#160;to&#160;console.log&#160;to&#160;output&#160;the&#160;following<br/>triangle:<br/>
#<br/>##<br/>###<br/>####<br/>#####<br/>######<br/>#######<br/>
37<br/>
<hr/>
<a name=50></a>It&#160;may&#160;be&#160;useful&#160;to&#160;know&#160;that&#160;you&#160;can&#160;find&#160;the&#160;length&#160;of&#160;a&#160;string&#160;by&#160;writing<br/>
.length&#160;after&#160;it.<br/>
let&#160;abc&#160;=&#160;&#34;abc&#34;;<br/>console.log(abc.length);<br/>//&#160;→&#160;3<br/>
<b>FizzBuzz</b><br/>
Write&#160;a&#160;program&#160;that&#160;uses&#160;console.log&#160;to&#160;print&#160;all&#160;the&#160;numbers&#160;from&#160;1&#160;to&#160;100,<br/>with&#160;two&#160;exceptions.&#160;For&#160;numbers&#160;divisible&#160;by&#160;3,&#160;print&#160;&#34;Fizz&#34;&#160;instead&#160;of&#160;the<br/>number,&#160;and&#160;for&#160;numbers&#160;divisible&#160;by&#160;5&#160;(and&#160;not&#160;3),&#160;print&#160;&#34;Buzz&#34;&#160;instead.<br/>
When&#160;you&#160;have&#160;that&#160;working,&#160;modify&#160;your&#160;program&#160;to&#160;print&#160;&#34;FizzBuzz&#34;&#160;for<br/>
numbers&#160;that&#160;are&#160;divisible&#160;by&#160;both&#160;3&#160;and&#160;5&#160;(and&#160;still&#160;print&#160;&#34;Fizz&#34;&#160;or&#160;&#34;Buzz&#34;<br/>for&#160;numbers&#160;divisible&#160;by&#160;only&#160;one&#160;of&#160;those).<br/>
(This&#160;is&#160;actually&#160;an&#160;interview&#160;question&#160;that&#160;has&#160;been&#160;claimed&#160;to&#160;weed&#160;out<br/>
a&#160;significant&#160;percentage&#160;of&#160;programmer&#160;candidates.&#160;So&#160;if&#160;you&#160;solved&#160;it,&#160;your<br/>labor&#160;market&#160;value&#160;just&#160;went&#160;up.)<br/>
<b>Chessboard</b><br/>
Write&#160;a&#160;program&#160;that&#160;creates&#160;a&#160;string&#160;that&#160;represents&#160;an&#160;8×8&#160;grid,&#160;using&#160;newline<br/>characters&#160;to&#160;separate&#160;lines.&#160;At&#160;each&#160;position&#160;of&#160;the&#160;grid&#160;there&#160;is&#160;either&#160;a&#160;space<br/>or&#160;a&#160;&#34;#&#34;&#160;character.&#160;The&#160;characters&#160;should&#160;form&#160;a&#160;chessboard.<br/>
Passing&#160;this&#160;string&#160;to&#160;console.log&#160;should&#160;show&#160;something&#160;like&#160;this:<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
#&#160;#&#160;#&#160;#<br/>
When&#160;you&#160;have&#160;a&#160;program&#160;that&#160;generates&#160;this&#160;pattern,&#160;define&#160;a&#160;binding&#160;size<br/>
=&#160;8&#160;and&#160;change&#160;the&#160;program&#160;so&#160;that&#160;it&#160;works&#160;for&#160;any&#160;size,&#160;outputting&#160;a&#160;grid<br/>
of&#160;the&#160;given&#160;width&#160;and&#160;height.<br/>
38<br/>
<hr/>
<a name=51></a><i>“People&#160;think&#160;that&#160;computer&#160;science&#160;is&#160;the&#160;art&#160;of&#160;geniuses&#160;but&#160;the</i><br/>
<i>actual&#160;reality&#160;is&#160;the&#160;opposite,&#160;just&#160;many&#160;people&#160;doing&#160;things&#160;that<br/>build&#160;on&#160;each&#160;other,&#160;like&#160;a&#160;wall&#160;of&#160;mini&#160;stones.”</i><br/>
—Donald&#160;Knuth<br/>
<b>Chapter&#160;3<br/>Functions</b><br/>
Functions&#160;are&#160;the&#160;bread&#160;and&#160;butter&#160;of&#160;JavaScript&#160;programming.&#160;The&#160;concept<br/>of&#160;wrapping&#160;a&#160;piece&#160;of&#160;program&#160;in&#160;a&#160;value&#160;has&#160;many&#160;uses.&#160;It&#160;gives&#160;us&#160;a&#160;way<br/>to&#160;structure&#160;larger&#160;programs,&#160;to&#160;reduce&#160;repetition,&#160;to&#160;associate&#160;names&#160;with<br/>subprograms,&#160;and&#160;to&#160;isolate&#160;these&#160;subprograms&#160;from&#160;each&#160;other.<br/>
The&#160;most&#160;obvious&#160;application&#160;of&#160;functions&#160;is&#160;defining&#160;new&#160;vocabulary.&#160;Cre-<br/>
ating&#160;new&#160;words&#160;in&#160;prose&#160;is&#160;usually&#160;bad&#160;style.&#160;But&#160;in&#160;programming,&#160;it&#160;is<br/>indispensable.<br/>
Typical&#160;adult&#160;English&#160;speakers&#160;have&#160;some&#160;20,000&#160;words&#160;in&#160;their&#160;vocabulary.<br/>
Few&#160;programming&#160;languages&#160;come&#160;with&#160;20,000&#160;commands&#160;built&#160;in.&#160;And&#160;the<br/>vocabulary&#160;that&#160;<i>is&#160;</i>available&#160;tends&#160;to&#160;be&#160;more&#160;precisely&#160;defined,&#160;and&#160;thus&#160;less<br/>flexible,&#160;than&#160;in&#160;human&#160;language.&#160;Therefore,&#160;we&#160;usually&#160;<i>have&#160;</i>to&#160;introduce&#160;new<br/>concepts&#160;to&#160;avoid&#160;repeating&#160;ourselves&#160;too&#160;much.<br/>
<b>Defining&#160;a&#160;function</b><br/>
A&#160;function&#160;definition&#160;is&#160;a&#160;regular&#160;binding&#160;where&#160;the&#160;value&#160;of&#160;the&#160;binding&#160;is<br/>a&#160;function.&#160;For&#160;example,&#160;this&#160;code&#160;defines&#160;square&#160;to&#160;refer&#160;to&#160;a&#160;function&#160;that<br/>produces&#160;the&#160;square&#160;of&#160;a&#160;given&#160;number:<br/>
const&#160;square&#160;=&#160;function(x)&#160;{<br/>
return&#160;x&#160;*&#160;x;<br/>
};<br/>
console.log(square(12));<br/>//&#160;→&#160;144<br/>
A&#160;function&#160;is&#160;created&#160;with&#160;an&#160;expression&#160;that&#160;starts&#160;with&#160;the&#160;keyword&#160;function<br/>
.&#160;Functions&#160;have&#160;a&#160;set&#160;of&#160;<i>parameters&#160;</i>(in&#160;this&#160;case,&#160;only&#160;x)&#160;and&#160;a&#160;<i>body</i>,&#160;which<br/>contains&#160;the&#160;statements&#160;that&#160;are&#160;to&#160;be&#160;executed&#160;when&#160;the&#160;function&#160;is&#160;called.<br/>The&#160;function&#160;body&#160;of&#160;a&#160;function&#160;created&#160;this&#160;way&#160;must&#160;always&#160;be&#160;wrapped&#160;in<br/>braces,&#160;even&#160;when&#160;it&#160;consists&#160;of&#160;only&#160;a&#160;single&#160;statement.<br/>
39<br/>
<hr/>
<a name=52></a>A&#160;function&#160;can&#160;have&#160;multiple&#160;parameters&#160;or&#160;no&#160;parameters&#160;at&#160;all.&#160;In&#160;the<br/>
following&#160;example,&#160;makeNoise&#160;does&#160;not&#160;list&#160;any&#160;parameter&#160;names,&#160;whereas&#160;power<br/>lists&#160;two:<br/>
const&#160;makeNoise&#160;=&#160;function()&#160;{<br/>
console.log(&#34;Pling!&#34;);<br/>
};<br/>
makeNoise();<br/>//&#160;→&#160;Pling!<br/>
const&#160;power&#160;=&#160;function(base,&#160;exponent)&#160;{<br/>
let&#160;result&#160;=&#160;1;<br/>for&#160;(let&#160;count&#160;=&#160;0;&#160;count&#160;&lt;&#160;exponent;&#160;count++)&#160;{<br/>
result&#160;*=&#160;base;<br/>
}<br/>return&#160;result;<br/>
};<br/>
console.log(power(2,&#160;10));<br/>//&#160;→&#160;1024<br/>
Some&#160;functions&#160;produce&#160;a&#160;value,&#160;such&#160;as&#160;power&#160;and&#160;square,&#160;and&#160;some&#160;don’t,<br/>
such&#160;as&#160;makeNoise,&#160;whose&#160;only&#160;result&#160;is&#160;a&#160;side&#160;effect.&#160;A&#160;return&#160;statement<br/>determines&#160;the&#160;value&#160;the&#160;function&#160;returns.&#160;When&#160;control&#160;comes&#160;across&#160;such<br/>a&#160;statement,&#160;it&#160;immediately&#160;jumps&#160;out&#160;of&#160;the&#160;current&#160;function&#160;and&#160;gives&#160;the<br/>returned&#160;value&#160;to&#160;the&#160;code&#160;that&#160;called&#160;the&#160;function.&#160;A&#160;return&#160;keyword&#160;without<br/>an&#160;expression&#160;after&#160;it&#160;will&#160;cause&#160;the&#160;function&#160;to&#160;return&#160;undefined.&#160;Functions<br/>that&#160;don’t&#160;have&#160;a&#160;return&#160;statement&#160;at&#160;all,&#160;such&#160;as&#160;makeNoise,&#160;similarly&#160;return<br/>undefined.<br/>
Parameters&#160;to&#160;a&#160;function&#160;behave&#160;like&#160;regular&#160;bindings,&#160;but&#160;their&#160;initial&#160;values<br/>
are&#160;given&#160;by&#160;the&#160;<i>caller&#160;</i>of&#160;the&#160;function,&#160;not&#160;the&#160;code&#160;in&#160;the&#160;function&#160;itself.<br/>
<b>Bindings&#160;and&#160;scopes</b><br/>
Each&#160;binding&#160;has&#160;a&#160;<i>scope</i>,&#160;which&#160;is&#160;the&#160;part&#160;of&#160;the&#160;program&#160;in&#160;which&#160;the&#160;binding<br/>is&#160;visible.&#160;For&#160;bindings&#160;defined&#160;outside&#160;of&#160;any&#160;function&#160;or&#160;block,&#160;the&#160;scope&#160;is<br/>the&#160;whole&#160;program—you&#160;can&#160;refer&#160;to&#160;such&#160;bindings&#160;wherever&#160;you&#160;want.&#160;These<br/>are&#160;called&#160;<i>global</i>.<br/>
But&#160;bindings&#160;created&#160;for&#160;function&#160;parameters&#160;or&#160;declared&#160;inside&#160;a&#160;function<br/>
can&#160;be&#160;referenced&#160;only&#160;in&#160;that&#160;function,&#160;so&#160;they&#160;are&#160;known&#160;as&#160;<i>local&#160;</i>bindings.<br/>
40<br/>
<hr/>
<a name=53></a>Every&#160;time&#160;the&#160;function&#160;is&#160;called,&#160;new&#160;instances&#160;of&#160;these&#160;bindings&#160;are&#160;created.<br/>This&#160;provides&#160;some&#160;isolation&#160;between&#160;functions—each&#160;function&#160;call&#160;acts&#160;in&#160;its<br/>own&#160;little&#160;world&#160;(its&#160;local&#160;environment)&#160;and&#160;can&#160;often&#160;be&#160;understood&#160;without<br/>knowing&#160;a&#160;lot&#160;about&#160;what’s&#160;going&#160;on&#160;in&#160;the&#160;global&#160;environment.<br/>
Bindings&#160;declared&#160;with&#160;let&#160;and&#160;const&#160;are&#160;in&#160;fact&#160;local&#160;to&#160;the&#160;<i>block&#160;</i>that&#160;they<br/>
are&#160;declared&#160;in,&#160;so&#160;if&#160;you&#160;create&#160;one&#160;of&#160;those&#160;inside&#160;of&#160;a&#160;loop,&#160;the&#160;code&#160;before&#160;and<br/>after&#160;the&#160;loop&#160;cannot&#160;“see”&#160;it.&#160;In&#160;pre-2015&#160;JavaScript,&#160;only&#160;functions&#160;created<br/>new&#160;scopes,&#160;so&#160;old-style&#160;bindings,&#160;created&#160;with&#160;the&#160;var&#160;keyword,&#160;are&#160;visible<br/>throughout&#160;the&#160;whole&#160;function&#160;that&#160;they&#160;appear&#160;in—or&#160;throughout&#160;the&#160;global<br/>scope,&#160;if&#160;they&#160;are&#160;not&#160;in&#160;a&#160;function.<br/>
let&#160;x&#160;=&#160;10;<br/>if&#160;(true)&#160;{<br/>
let&#160;y&#160;=&#160;20;<br/>var&#160;z&#160;=&#160;30;<br/>console.log(x&#160;+&#160;y&#160;+&#160;z);<br/>//&#160;→&#160;60<br/>
}<br/>//&#160;y&#160;is&#160;not&#160;visible&#160;here<br/>console.log(x&#160;+&#160;z);<br/>//&#160;→&#160;40<br/>
Each&#160;scope&#160;can&#160;“look&#160;out”&#160;into&#160;the&#160;scope&#160;around&#160;it,&#160;so&#160;x&#160;is&#160;visible&#160;inside&#160;the<br/>
block&#160;in&#160;the&#160;example.&#160;The&#160;exception&#160;is&#160;when&#160;multiple&#160;bindings&#160;have&#160;the&#160;same<br/>name—in&#160;that&#160;case,&#160;code&#160;can&#160;see&#160;only&#160;the&#160;innermost&#160;one.&#160;For&#160;example,&#160;when<br/>the&#160;code&#160;inside&#160;the&#160;halve&#160;function&#160;refers&#160;to&#160;n,&#160;it&#160;is&#160;seeing&#160;its&#160;<i>own&#160;</i>n,&#160;not&#160;the<br/>global&#160;n.<br/>
const&#160;halve&#160;=&#160;function(n)&#160;{<br/>
return&#160;n&#160;/&#160;2;<br/>
};<br/>
let&#160;n&#160;=&#160;10;<br/>console.log(halve(100));<br/>//&#160;→&#160;50<br/>console.log(n);<br/>//&#160;→&#160;10<br/>
41<br/>
<hr/>
<a name=54></a><b>Nested&#160;scope</b><br/>
JavaScript&#160;distinguishes&#160;not&#160;just&#160;<i>global&#160;</i>and&#160;<i>local&#160;</i>bindings.&#160;Blocks&#160;and&#160;functions<br/>can&#160;be&#160;created&#160;inside&#160;other&#160;blocks&#160;and&#160;functions,&#160;producing&#160;multiple&#160;degrees<br/>of&#160;locality.<br/>
For&#160;example,&#160;this&#160;function—which&#160;outputs&#160;the&#160;ingredients&#160;needed&#160;to&#160;make<br/>
a&#160;batch&#160;of&#160;hummus—has&#160;another&#160;function&#160;inside&#160;it:<br/>
const&#160;hummus&#160;=&#160;function(factor)&#160;{<br/>
const&#160;ingredient&#160;=&#160;function(amount,&#160;unit,&#160;name)&#160;{<br/>
let&#160;ingredientAmount&#160;=&#160;amount&#160;*&#160;factor;<br/>if&#160;(ingredientAmount&#160;&gt;&#160;1)&#160;{<br/>
unit&#160;+=&#160;&#34;s&#34;;<br/>
}<br/>console.log(`${ingredientAmount}&#160;${unit}&#160;${name}`);<br/>
};<br/>ingredient(1,&#160;&#34;can&#34;,&#160;&#34;chickpeas&#34;);<br/>ingredient(0.25,&#160;&#34;cup&#34;,&#160;&#34;tahini&#34;);<br/>ingredient(0.25,&#160;&#34;cup&#34;,&#160;&#34;lemon&#160;juice&#34;);<br/>ingredient(1,&#160;&#34;clove&#34;,&#160;&#34;garlic&#34;);<br/>ingredient(2,&#160;&#34;tablespoon&#34;,&#160;&#34;olive&#160;oil&#34;);<br/>ingredient(0.5,&#160;&#34;teaspoon&#34;,&#160;&#34;cumin&#34;);<br/>
};<br/>
The&#160;code&#160;inside&#160;the&#160;ingredient&#160;function&#160;can&#160;see&#160;the&#160;factor&#160;binding&#160;from<br/>
the&#160;outer&#160;function.&#160;But&#160;its&#160;local&#160;bindings,&#160;such&#160;as&#160;unit&#160;or&#160;ingredientAmount,<br/>are&#160;not&#160;visible&#160;in&#160;the&#160;outer&#160;function.<br/>
The&#160;set&#160;of&#160;bindings&#160;visible&#160;inside&#160;a&#160;block&#160;is&#160;determined&#160;by&#160;the&#160;place&#160;of&#160;that<br/>
block&#160;in&#160;the&#160;program&#160;text.&#160;Each&#160;local&#160;scope&#160;can&#160;also&#160;see&#160;all&#160;the&#160;local&#160;scopes&#160;that<br/>contain&#160;it,&#160;and&#160;all&#160;scopes&#160;can&#160;see&#160;the&#160;global&#160;scope.&#160;This&#160;approach&#160;to&#160;binding<br/>visibility&#160;is&#160;called&#160;<i>lexical&#160;scoping</i>.<br/>
<b>Functions&#160;as&#160;values</b><br/>
A&#160;function&#160;binding&#160;usually&#160;simply&#160;acts&#160;as&#160;a&#160;name&#160;for&#160;a&#160;specific&#160;piece&#160;of&#160;the<br/>program.&#160;Such&#160;a&#160;binding&#160;is&#160;defined&#160;once&#160;and&#160;never&#160;changed.&#160;This&#160;makes&#160;it<br/>easy&#160;to&#160;confuse&#160;the&#160;function&#160;and&#160;its&#160;name.<br/>
But&#160;the&#160;two&#160;are&#160;different.&#160;A&#160;function&#160;value&#160;can&#160;do&#160;all&#160;the&#160;things&#160;that&#160;other<br/>
values&#160;can&#160;do—you&#160;can&#160;use&#160;it&#160;in&#160;arbitrary&#160;expressions,&#160;not&#160;just&#160;call&#160;it.&#160;It&#160;is<br/>possible&#160;to&#160;store&#160;a&#160;function&#160;value&#160;in&#160;a&#160;new&#160;binding,&#160;pass&#160;it&#160;as&#160;an&#160;argument&#160;to<br/>a&#160;function,&#160;and&#160;so&#160;on.&#160;Similarly,&#160;a&#160;binding&#160;that&#160;holds&#160;a&#160;function&#160;is&#160;still&#160;just&#160;a<br/>regular&#160;binding&#160;and&#160;can,&#160;if&#160;not&#160;constant,&#160;be&#160;assigned&#160;a&#160;new&#160;value,&#160;like&#160;so:<br/>
42<br/>
<hr/>
<a name=55></a>let&#160;launchMissiles&#160;=&#160;function()&#160;{<br/>
missileSystem.launch(&#34;now&#34;);<br/>
};<br/>if&#160;(safeMode)&#160;{<br/>
launchMissiles&#160;=&#160;function()&#160;{/*&#160;do&#160;nothing&#160;*/};<br/>
}<br/>
In&#160;<a href="eloquent-javascripts.html#94">Chapter&#160;5</a>,&#160;we&#160;will&#160;discuss&#160;the&#160;interesting&#160;things&#160;that&#160;can&#160;be&#160;done&#160;by<br/>
passing&#160;around&#160;function&#160;values&#160;to&#160;other&#160;functions.<br/>
<b>Declaration&#160;notation</b><br/>
There&#160;is&#160;a&#160;slightly&#160;shorter&#160;way&#160;to&#160;create&#160;a&#160;function&#160;binding.&#160;When&#160;the&#160;function<br/>keyword&#160;is&#160;used&#160;at&#160;the&#160;start&#160;of&#160;a&#160;statement,&#160;it&#160;works&#160;differently.<br/>
function&#160;square(x)&#160;{<br/>
return&#160;x&#160;*&#160;x;<br/>
}<br/>
This&#160;is&#160;a&#160;function&#160;<i>declaration</i>.&#160;The&#160;statement&#160;defines&#160;the&#160;binding&#160;square&#160;and<br/>
points&#160;it&#160;at&#160;the&#160;given&#160;function.&#160;It&#160;is&#160;slightly&#160;easier&#160;to&#160;write&#160;and&#160;doesn’t&#160;require<br/>a&#160;semicolon&#160;after&#160;the&#160;function.<br/>
There&#160;is&#160;one&#160;subtlety&#160;with&#160;this&#160;form&#160;of&#160;function&#160;definition.<br/>
console.log(&#34;The&#160;future&#160;says:&#34;,&#160;future());<br/>
function&#160;future()&#160;{<br/>
return&#160;&#34;You'll&#160;never&#160;have&#160;flying&#160;cars&#34;;<br/>
}<br/>
The&#160;preceding&#160;code&#160;works,&#160;even&#160;though&#160;the&#160;function&#160;is&#160;defined&#160;<i>below&#160;</i>the&#160;code<br/>
that&#160;uses&#160;it.&#160;Function&#160;declarations&#160;are&#160;not&#160;part&#160;of&#160;the&#160;regular&#160;top-to-bottom<br/>flow&#160;of&#160;control.&#160;They&#160;are&#160;conceptually&#160;moved&#160;to&#160;the&#160;top&#160;of&#160;their&#160;scope&#160;and&#160;can<br/>be&#160;used&#160;by&#160;all&#160;the&#160;code&#160;in&#160;that&#160;scope.&#160;This&#160;is&#160;sometimes&#160;useful&#160;because&#160;it&#160;offers<br/>the&#160;freedom&#160;to&#160;order&#160;code&#160;in&#160;a&#160;way&#160;that&#160;seems&#160;meaningful,&#160;without&#160;worrying<br/>about&#160;having&#160;to&#160;define&#160;all&#160;functions&#160;before&#160;they&#160;are&#160;used.<br/>
43<br/>
<hr/>
<a name=56></a><b>Arrow&#160;functions</b><br/>
There’s&#160;a&#160;third&#160;notation&#160;for&#160;functions,&#160;which&#160;looks&#160;very&#160;different&#160;from&#160;the<br/>others.&#160;Instead&#160;of&#160;the&#160;function&#160;keyword,&#160;it&#160;uses&#160;an&#160;arrow&#160;(=&gt;)&#160;made&#160;up&#160;of&#160;an<br/>equal&#160;sign&#160;and&#160;a&#160;greater-than&#160;character&#160;(not&#160;to&#160;be&#160;confused&#160;with&#160;the&#160;greater-<br/>than-or-equal&#160;operator,&#160;which&#160;is&#160;written&#160;&gt;=).<br/>
const&#160;power&#160;=&#160;(base,&#160;exponent)&#160;=&gt;&#160;{<br/>
let&#160;result&#160;=&#160;1;<br/>for&#160;(let&#160;count&#160;=&#160;0;&#160;count&#160;&lt;&#160;exponent;&#160;count++)&#160;{<br/>
result&#160;*=&#160;base;<br/>
}<br/>return&#160;result;<br/>
};<br/>
The&#160;arrow&#160;comes&#160;<i>after&#160;</i>the&#160;list&#160;of&#160;parameters&#160;and&#160;is&#160;followed&#160;by&#160;the&#160;function’s<br/>
body.&#160;It&#160;expresses&#160;something&#160;like&#160;“this&#160;input&#160;(the&#160;parameters)&#160;produces&#160;this<br/>result&#160;(the&#160;body)”.<br/>
When&#160;there&#160;is&#160;only&#160;one&#160;parameter&#160;name,&#160;you&#160;can&#160;omit&#160;the&#160;parentheses<br/>
around&#160;the&#160;parameter&#160;list.&#160;If&#160;the&#160;body&#160;is&#160;a&#160;single&#160;expression,&#160;rather&#160;than&#160;a<br/>block&#160;in&#160;braces,&#160;that&#160;expression&#160;will&#160;be&#160;returned&#160;from&#160;the&#160;function.&#160;So,&#160;these<br/>two&#160;definitions&#160;of&#160;square&#160;do&#160;the&#160;same&#160;thing:<br/>
const&#160;square1&#160;=&#160;(x)&#160;=&gt;&#160;{&#160;return&#160;x&#160;*&#160;x;&#160;};<br/>const&#160;square2&#160;=&#160;x&#160;=&gt;&#160;x&#160;*&#160;x;<br/>
When&#160;an&#160;arrow&#160;function&#160;has&#160;no&#160;parameters&#160;at&#160;all,&#160;its&#160;parameter&#160;list&#160;is&#160;just<br/>
an&#160;empty&#160;set&#160;of&#160;parentheses.<br/>
const&#160;horn&#160;=&#160;()&#160;=&gt;&#160;{<br/>
console.log(&#34;Toot&#34;);<br/>
};<br/>
There’s&#160;no&#160;deep&#160;reason&#160;to&#160;have&#160;both&#160;arrow&#160;functions&#160;and&#160;function&#160;expres-<br/>
sions&#160;in&#160;the&#160;language.&#160;Apart&#160;from&#160;a&#160;minor&#160;detail,&#160;which&#160;we’ll&#160;discuss&#160;in&#160;<a href="eloquent-javascripts.html#109">Chapter<br/>6</a>,&#160;they&#160;do&#160;the&#160;same&#160;thing.&#160;Arrow&#160;functions&#160;were&#160;added&#160;in&#160;2015,&#160;mostly&#160;to&#160;make<br/>it&#160;possible&#160;to&#160;write&#160;small&#160;function&#160;expressions&#160;in&#160;a&#160;less&#160;verbose&#160;way.&#160;We’ll&#160;be<br/>using&#160;them&#160;a&#160;lot&#160;in&#160;<a href="eloquent-javascripts.html#94">Chapter&#160;5</a>.<br/>
44<br/>
<hr/>
<a name=57></a><b>The&#160;call&#160;stack</b><br/>
The&#160;way&#160;control&#160;flows&#160;through&#160;functions&#160;is&#160;somewhat&#160;involved.&#160;Let’s&#160;take&#160;a<br/>closer&#160;look&#160;at&#160;it.&#160;Here&#160;is&#160;a&#160;simple&#160;program&#160;that&#160;makes&#160;a&#160;few&#160;function&#160;calls:<br/>
function&#160;greet(who)&#160;{<br/>
console.log(&#34;Hello&#160;&#34;&#160;+&#160;who);<br/>
}<br/>greet(&#34;Harry&#34;);<br/>console.log(&#34;Bye&#34;);<br/>
A&#160;run&#160;through&#160;this&#160;program&#160;goes&#160;roughly&#160;like&#160;this:&#160;the&#160;call&#160;to&#160;greet&#160;causes<br/>
control&#160;to&#160;jump&#160;to&#160;the&#160;start&#160;of&#160;that&#160;function&#160;(line&#160;2).&#160;The&#160;function&#160;calls&#160;console<br/>.log,&#160;which&#160;takes&#160;control,&#160;does&#160;its&#160;job,&#160;and&#160;then&#160;returns&#160;control&#160;to&#160;line&#160;2.&#160;There<br/>it&#160;reaches&#160;the&#160;end&#160;of&#160;the&#160;greet&#160;function,&#160;so&#160;it&#160;returns&#160;to&#160;the&#160;place&#160;that&#160;called&#160;it,<br/>which&#160;is&#160;line&#160;4.&#160;The&#160;line&#160;after&#160;that&#160;calls&#160;console.log&#160;again.&#160;After&#160;that&#160;returns,<br/>the&#160;program&#160;reaches&#160;its&#160;end.<br/>
We&#160;could&#160;show&#160;the&#160;flow&#160;of&#160;control&#160;schematically&#160;like&#160;this:<br/>
not&#160;in&#160;function<br/>
in&#160;greet<br/>
in&#160;console.log<br/>
in&#160;greet<br/>
not&#160;in&#160;function<br/>
in&#160;console.log<br/>
not&#160;in&#160;function<br/>
Because&#160;a&#160;function&#160;has&#160;to&#160;jump&#160;back&#160;to&#160;the&#160;place&#160;that&#160;called&#160;it&#160;when&#160;it&#160;re-<br/>
turns,&#160;the&#160;computer&#160;must&#160;remember&#160;the&#160;context&#160;from&#160;which&#160;the&#160;call&#160;happened.<br/>In&#160;one&#160;case,&#160;console.log&#160;has&#160;to&#160;return&#160;to&#160;the&#160;greet&#160;function&#160;when&#160;it&#160;is&#160;done.<br/>In&#160;the&#160;other&#160;case,&#160;it&#160;returns&#160;to&#160;the&#160;end&#160;of&#160;the&#160;program.<br/>
The&#160;place&#160;where&#160;the&#160;computer&#160;stores&#160;this&#160;context&#160;is&#160;the&#160;<i>call&#160;stack</i>.&#160;Every<br/>
time&#160;a&#160;function&#160;is&#160;called,&#160;the&#160;current&#160;context&#160;is&#160;stored&#160;on&#160;top&#160;of&#160;this&#160;stack.<br/>When&#160;a&#160;function&#160;returns,&#160;it&#160;removes&#160;the&#160;top&#160;context&#160;from&#160;the&#160;stack&#160;and&#160;uses<br/>that&#160;context&#160;to&#160;continue&#160;execution.<br/>
Storing&#160;this&#160;stack&#160;requires&#160;space&#160;in&#160;the&#160;computer’s&#160;memory.&#160;When&#160;the&#160;stack<br/>
grows&#160;too&#160;big,&#160;the&#160;computer&#160;will&#160;fail&#160;with&#160;a&#160;message&#160;like&#160;“out&#160;of&#160;stack&#160;space”<br/>or&#160;“too&#160;much&#160;recursion”.&#160;The&#160;following&#160;code&#160;illustrates&#160;this&#160;by&#160;asking&#160;the<br/>computer&#160;a&#160;really&#160;hard&#160;question&#160;that&#160;causes&#160;an&#160;infinite&#160;back-and-forth&#160;between<br/>two&#160;functions.&#160;Rather,&#160;it&#160;<i>would&#160;</i>be&#160;infinite,&#160;if&#160;the&#160;computer&#160;had&#160;an&#160;infinite<br/>stack.&#160;As&#160;it&#160;is,&#160;we&#160;will&#160;run&#160;out&#160;of&#160;space,&#160;or&#160;“blow&#160;the&#160;stack”.<br/>
45<br/>
<hr/>
<a name=58></a>function&#160;chicken()&#160;{<br/>
return&#160;egg();<br/>
}<br/>function&#160;egg()&#160;{<br/>
return&#160;chicken();<br/>
}<br/>console.log(chicken()&#160;+&#160;&#34;&#160;came&#160;first.&#34;);<br/>//&#160;→&#160;??<br/>
<b>Optional&#160;Arguments</b><br/>
The&#160;following&#160;code&#160;is&#160;allowed&#160;and&#160;executes&#160;without&#160;any&#160;problem:<br/>
function&#160;square(x)&#160;{&#160;return&#160;x&#160;*&#160;x;&#160;}<br/>console.log(square(4,&#160;true,&#160;&#34;hedgehog&#34;));<br/>//&#160;→&#160;16<br/>
We&#160;defined&#160;square&#160;with&#160;only&#160;one&#160;parameter.&#160;Yet&#160;when&#160;we&#160;call&#160;it&#160;with&#160;three,<br/>
the&#160;language&#160;doesn’t&#160;complain.&#160;It&#160;ignores&#160;the&#160;extra&#160;arguments&#160;and&#160;computes<br/>the&#160;square&#160;of&#160;the&#160;first&#160;one.<br/>
JavaScript&#160;is&#160;extremely&#160;broad-minded&#160;about&#160;the&#160;number&#160;of&#160;arguments&#160;you<br/>
pass&#160;to&#160;a&#160;function.&#160;If&#160;you&#160;pass&#160;too&#160;many,&#160;the&#160;extra&#160;ones&#160;are&#160;ignored.&#160;If&#160;you<br/>pass&#160;too&#160;few,&#160;the&#160;missing&#160;parameters&#160;get&#160;assigned&#160;the&#160;value&#160;undefined.<br/>
The&#160;downside&#160;of&#160;this&#160;is&#160;that&#160;it&#160;is&#160;possible—likely,&#160;even—that&#160;you’ll&#160;acciden-<br/>
tally&#160;pass&#160;the&#160;wrong&#160;number&#160;of&#160;arguments&#160;to&#160;functions.&#160;And&#160;no&#160;one&#160;will&#160;tell<br/>you&#160;about&#160;it.<br/>
The&#160;upside&#160;is&#160;that&#160;this&#160;behavior&#160;can&#160;be&#160;used&#160;to&#160;allow&#160;a&#160;function&#160;to&#160;be&#160;called<br/>
with&#160;different&#160;numbers&#160;of&#160;arguments.&#160;For&#160;example,&#160;this&#160;minus&#160;function&#160;tries&#160;to<br/>imitate&#160;the&#160;-&#160;operator&#160;by&#160;acting&#160;on&#160;either&#160;one&#160;or&#160;two&#160;arguments:<br/>
function&#160;minus(a,&#160;b)&#160;{<br/>
if&#160;(b&#160;===&#160;undefined)&#160;return&#160;-a;<br/>else&#160;return&#160;a&#160;-&#160;b;<br/>
}<br/>
console.log(minus(10));<br/>//&#160;→&#160;-10<br/>console.log(minus(10,&#160;5));<br/>//&#160;→&#160;5<br/>
46<br/>
<hr/>
<a name=59></a>If&#160;you&#160;write&#160;an&#160;=&#160;operator&#160;after&#160;a&#160;parameter,&#160;followed&#160;by&#160;an&#160;expression,&#160;the<br/>
value&#160;of&#160;that&#160;expression&#160;will&#160;replace&#160;the&#160;argument&#160;when&#160;it&#160;is&#160;not&#160;given.<br/>
For&#160;example,&#160;this&#160;version&#160;of&#160;power&#160;makes&#160;its&#160;second&#160;argument&#160;optional.&#160;If<br/>
you&#160;don’t&#160;provide&#160;it&#160;or&#160;pass&#160;the&#160;value&#160;undefined,&#160;it&#160;will&#160;default&#160;to&#160;two,&#160;and&#160;the<br/>function&#160;will&#160;behave&#160;like&#160;square.<br/>
function&#160;power(base,&#160;exponent&#160;=&#160;2)&#160;{<br/>
let&#160;result&#160;=&#160;1;<br/>for&#160;(let&#160;count&#160;=&#160;0;&#160;count&#160;&lt;&#160;exponent;&#160;count++)&#160;{<br/>
result&#160;*=&#160;base;<br/>
}<br/>return&#160;result;<br/>
}<br/>
console.log(power(4));<br/>//&#160;→&#160;16<br/>console.log(power(2,&#160;6));<br/>//&#160;→&#160;64<br/>
In&#160;the&#160;<a href="eloquent-javascripts.html#85">next&#160;chapter</a>,&#160;we&#160;will&#160;see&#160;a&#160;way&#160;in&#160;which&#160;a&#160;function&#160;body&#160;can&#160;get&#160;at<br/>
the&#160;whole&#160;list&#160;of&#160;arguments&#160;it&#160;was&#160;passed.&#160;This&#160;is&#160;helpful&#160;because&#160;it&#160;makes<br/>it&#160;possible&#160;for&#160;a&#160;function&#160;to&#160;accept&#160;any&#160;number&#160;of&#160;arguments.&#160;For&#160;example,<br/>console.log&#160;does&#160;this—it&#160;outputs&#160;all&#160;of&#160;the&#160;values&#160;it&#160;is&#160;given.<br/>
console.log(&#34;C&#34;,&#160;&#34;O&#34;,&#160;2);<br/>//&#160;→&#160;C&#160;O&#160;2<br/>
<b>Closure</b><br/>
The&#160;ability&#160;to&#160;treat&#160;functions&#160;as&#160;values,&#160;combined&#160;with&#160;the&#160;fact&#160;that&#160;local<br/>bindings&#160;are&#160;re-created&#160;every&#160;time&#160;a&#160;function&#160;is&#160;called,&#160;brings&#160;up&#160;an&#160;interesting<br/>question.&#160;What&#160;happens&#160;to&#160;local&#160;bindings&#160;when&#160;the&#160;function&#160;call&#160;that&#160;created<br/>them&#160;is&#160;no&#160;longer&#160;active?<br/>
The&#160;following&#160;code&#160;shows&#160;an&#160;example&#160;of&#160;this.&#160;It&#160;defines&#160;a&#160;function,&#160;wrapValue,<br/>
that&#160;creates&#160;a&#160;local&#160;binding.&#160;It&#160;then&#160;returns&#160;a&#160;function&#160;that&#160;accesses&#160;and&#160;returns<br/>this&#160;local&#160;binding.<br/>
function&#160;wrapValue(n)&#160;{<br/>
let&#160;local&#160;=&#160;n;<br/>return&#160;()&#160;=&gt;&#160;local;<br/>
}<br/>
47<br/>
<hr/>
<a name=60></a>let&#160;wrap1&#160;=&#160;wrapValue(1);<br/>let&#160;wrap2&#160;=&#160;wrapValue(2);<br/>console.log(wrap1());<br/>//&#160;→&#160;1<br/>console.log(wrap2());<br/>//&#160;→&#160;2<br/>
This&#160;is&#160;allowed&#160;and&#160;works&#160;as&#160;you’d&#160;hope—both&#160;instances&#160;of&#160;the&#160;binding&#160;can<br/>
still&#160;be&#160;accessed.&#160;This&#160;situation&#160;is&#160;a&#160;good&#160;demonstration&#160;of&#160;the&#160;fact&#160;that&#160;local<br/>bindings&#160;are&#160;created&#160;anew&#160;for&#160;every&#160;call,&#160;and&#160;different&#160;calls&#160;can’t&#160;trample&#160;on<br/>one&#160;another’s&#160;local&#160;bindings.<br/>
This&#160;feature—being&#160;able&#160;to&#160;reference&#160;a&#160;specific&#160;instance&#160;of&#160;a&#160;local&#160;binding&#160;in<br/>
an&#160;enclosing&#160;scope—is&#160;called&#160;<i>closure</i>.&#160;A&#160;function&#160;that&#160;references&#160;bindings&#160;from<br/>local&#160;scopes&#160;around&#160;it&#160;is&#160;called&#160;<i>a&#160;</i>closure.&#160;This&#160;behavior&#160;not&#160;only&#160;frees&#160;you&#160;from<br/>having&#160;to&#160;worry&#160;about&#160;lifetimes&#160;of&#160;bindings&#160;but&#160;also&#160;makes&#160;it&#160;possible&#160;to&#160;use<br/>function&#160;values&#160;in&#160;some&#160;creative&#160;ways.<br/>
With&#160;a&#160;slight&#160;change,&#160;we&#160;can&#160;turn&#160;the&#160;previous&#160;example&#160;into&#160;a&#160;way&#160;to&#160;create<br/>
functions&#160;that&#160;multiply&#160;by&#160;an&#160;arbitrary&#160;amount.<br/>
function&#160;multiplier(factor)&#160;{<br/>
return&#160;number&#160;=&gt;&#160;number&#160;*&#160;factor;<br/>
}<br/>
let&#160;twice&#160;=&#160;multiplier(2);<br/>console.log(twice(5));<br/>//&#160;→&#160;10<br/>
The&#160;explicit&#160;local&#160;binding&#160;from&#160;the&#160;wrapValue&#160;example&#160;isn’t&#160;really&#160;needed<br/>
since&#160;a&#160;parameter&#160;is&#160;itself&#160;a&#160;local&#160;binding.<br/>
Thinking&#160;about&#160;programs&#160;like&#160;this&#160;takes&#160;some&#160;practice.&#160;A&#160;good&#160;mental&#160;model<br/>
is&#160;to&#160;think&#160;of&#160;function&#160;values&#160;as&#160;containing&#160;both&#160;the&#160;code&#160;in&#160;their&#160;body&#160;and&#160;the<br/>environment&#160;in&#160;which&#160;they&#160;are&#160;created.&#160;When&#160;called,&#160;the&#160;function&#160;body&#160;sees<br/>the&#160;environment&#160;in&#160;which&#160;it&#160;was&#160;created,&#160;not&#160;the&#160;environment&#160;in&#160;which&#160;it&#160;is<br/>called.<br/>
In&#160;the&#160;example,&#160;multiplier&#160;is&#160;called&#160;and&#160;creates&#160;an&#160;environment&#160;in&#160;which&#160;its<br/>
factor&#160;parameter&#160;is&#160;bound&#160;to&#160;2.&#160;The&#160;function&#160;value&#160;it&#160;returns,&#160;which&#160;is&#160;stored<br/>in&#160;twice,&#160;remembers&#160;this&#160;environment.&#160;So&#160;when&#160;that&#160;is&#160;called,&#160;it&#160;multiplies&#160;its<br/>argument&#160;by&#160;2.<br/>
48<br/>
<hr/>
<a name=61></a><b>Recursion</b><br/>
It&#160;is&#160;perfectly&#160;okay&#160;for&#160;a&#160;function&#160;to&#160;call&#160;itself,&#160;as&#160;long&#160;as&#160;it&#160;doesn’t&#160;do&#160;it&#160;so<br/>often&#160;that&#160;it&#160;overflows&#160;the&#160;stack.&#160;A&#160;function&#160;that&#160;calls&#160;itself&#160;is&#160;called&#160;<i>recursive</i>.<br/>Recursion&#160;allows&#160;some&#160;functions&#160;to&#160;be&#160;written&#160;in&#160;a&#160;different&#160;style.&#160;Take,&#160;for<br/>example,&#160;this&#160;alternative&#160;implementation&#160;of&#160;power:<br/>
function&#160;power(base,&#160;exponent)&#160;{<br/>
if&#160;(exponent&#160;==&#160;0)&#160;{<br/>
return&#160;1;<br/>
}&#160;else&#160;{<br/>
return&#160;base&#160;*&#160;power(base,&#160;exponent&#160;-&#160;1);<br/>
}<br/>
}<br/>
console.log(power(2,&#160;3));<br/>//&#160;→&#160;8<br/>
This&#160;is&#160;rather&#160;close&#160;to&#160;the&#160;way&#160;mathematicians&#160;define&#160;exponentiation&#160;and<br/>
arguably&#160;describes&#160;the&#160;concept&#160;more&#160;clearly&#160;than&#160;the&#160;looping&#160;variant.&#160;The<br/>function&#160;calls&#160;itself&#160;multiple&#160;times&#160;with&#160;ever&#160;smaller&#160;exponents&#160;to&#160;achieve&#160;the<br/>repeated&#160;multiplication.<br/>
But&#160;this&#160;implementation&#160;has&#160;one&#160;problem:&#160;in&#160;typical&#160;JavaScript&#160;implementa-<br/>
tions,&#160;it’s&#160;about&#160;three&#160;times&#160;slower&#160;than&#160;the&#160;looping&#160;version.&#160;Running&#160;through<br/>a&#160;simple&#160;loop&#160;is&#160;generally&#160;cheaper&#160;than&#160;calling&#160;a&#160;function&#160;multiple&#160;times.<br/>
The&#160;dilemma&#160;of&#160;speed&#160;versus&#160;elegance&#160;is&#160;an&#160;interesting&#160;one.&#160;You&#160;can&#160;see&#160;it&#160;as<br/>
a&#160;kind&#160;of&#160;continuum&#160;between&#160;human-friendliness&#160;and&#160;machine-friendliness.&#160;Al-<br/>most&#160;any&#160;program&#160;can&#160;be&#160;made&#160;faster&#160;by&#160;making&#160;it&#160;bigger&#160;and&#160;more&#160;convoluted.<br/>The&#160;programmer&#160;has&#160;to&#160;decide&#160;on&#160;an&#160;appropriate&#160;balance.<br/>
In&#160;the&#160;case&#160;of&#160;the&#160;power&#160;function,&#160;the&#160;inelegant&#160;(looping)&#160;version&#160;is&#160;still&#160;fairly<br/>
simple&#160;and&#160;easy&#160;to&#160;read.&#160;It&#160;doesn’t&#160;make&#160;much&#160;sense&#160;to&#160;replace&#160;it&#160;with&#160;the<br/>recursive&#160;version.&#160;Often,&#160;though,&#160;a&#160;program&#160;deals&#160;with&#160;such&#160;complex&#160;concepts<br/>that&#160;giving&#160;up&#160;some&#160;efficiency&#160;in&#160;order&#160;to&#160;make&#160;the&#160;program&#160;more&#160;straightfor-<br/>ward&#160;is&#160;helpful.<br/>
Worrying&#160;about&#160;efficiency&#160;can&#160;be&#160;a&#160;distraction.&#160;It’s&#160;yet&#160;another&#160;factor&#160;that<br/>
complicates&#160;program&#160;design,&#160;and&#160;when&#160;you’re&#160;doing&#160;something&#160;that’s&#160;already<br/>difficult,&#160;that&#160;extra&#160;thing&#160;to&#160;worry&#160;about&#160;can&#160;be&#160;paralyzing.<br/>
Therefore,&#160;always&#160;start&#160;by&#160;writing&#160;something&#160;that’s&#160;correct&#160;and&#160;easy&#160;to&#160;un-<br/>
derstand.&#160;If&#160;you’re&#160;worried&#160;that&#160;it’s&#160;too&#160;slow—which&#160;it&#160;usually&#160;isn’t&#160;since<br/>most&#160;code&#160;simply&#160;isn’t&#160;executed&#160;often&#160;enough&#160;to&#160;take&#160;any&#160;significant&#160;amount<br/>of&#160;time—you&#160;can&#160;measure&#160;afterward&#160;and&#160;improve&#160;it&#160;if&#160;necessary.<br/>
49<br/>
<hr/>
<a name=62></a>Recursion&#160;is&#160;not&#160;always&#160;just&#160;an&#160;inefficient&#160;alternative&#160;to&#160;looping.&#160;Some&#160;prob-<br/>
lems&#160;really&#160;are&#160;easier&#160;to&#160;solve&#160;with&#160;recursion&#160;than&#160;with&#160;loops.&#160;Most&#160;often&#160;these<br/>are&#160;problems&#160;that&#160;require&#160;exploring&#160;or&#160;processing&#160;several&#160;“branches”,&#160;each&#160;of<br/>which&#160;might&#160;branch&#160;out&#160;again&#160;into&#160;even&#160;more&#160;branches.<br/>
Consider&#160;this&#160;puzzle:&#160;by&#160;starting&#160;from&#160;the&#160;number&#160;1&#160;and&#160;repeatedly&#160;either<br/>
adding&#160;5&#160;or&#160;multiplying&#160;by&#160;3,&#160;an&#160;infinite&#160;set&#160;of&#160;numbers&#160;can&#160;be&#160;produced.&#160;How<br/>would&#160;you&#160;write&#160;a&#160;function&#160;that,&#160;given&#160;a&#160;number,&#160;tries&#160;to&#160;find&#160;a&#160;sequence&#160;of<br/>such&#160;additions&#160;and&#160;multiplications&#160;that&#160;produces&#160;that&#160;number?<br/>
For&#160;example,&#160;the&#160;number&#160;13&#160;could&#160;be&#160;reached&#160;by&#160;first&#160;multiplying&#160;by&#160;3&#160;and<br/>
then&#160;adding&#160;5&#160;twice,&#160;whereas&#160;the&#160;number&#160;15&#160;cannot&#160;be&#160;reached&#160;at&#160;all.<br/>
Here&#160;is&#160;a&#160;recursive&#160;solution:<br/>
function&#160;findSolution(target)&#160;{<br/>
function&#160;find(current,&#160;history)&#160;{<br/>
if&#160;(current&#160;==&#160;target)&#160;{<br/>
return&#160;history;<br/>
}&#160;else&#160;if&#160;(current&#160;&gt;&#160;target)&#160;{<br/>
return&#160;null;<br/>
}&#160;else&#160;{<br/>
return&#160;find(current&#160;+&#160;5,&#160;`(${history}&#160;+&#160;5)`)&#160;||<br/>
find(current&#160;*&#160;3,&#160;`(${history}&#160;*&#160;3)`);<br/>
}<br/>
}<br/>return&#160;find(1,&#160;&#34;1&#34;);<br/>
}<br/>
console.log(findSolution(24));<br/>//&#160;→&#160;(((1&#160;*&#160;3)&#160;+&#160;5)&#160;*&#160;3)<br/>
Note&#160;that&#160;this&#160;program&#160;doesn’t&#160;necessarily&#160;find&#160;the&#160;<i>shortest&#160;</i>sequence&#160;of&#160;op-<br/>
erations.&#160;It&#160;is&#160;satisfied&#160;when&#160;it&#160;finds&#160;any&#160;sequence&#160;at&#160;all.<br/>
It&#160;is&#160;okay&#160;if&#160;you&#160;don’t&#160;see&#160;how&#160;it&#160;works&#160;right&#160;away.&#160;Let’s&#160;work&#160;through&#160;it,<br/>
since&#160;it&#160;makes&#160;for&#160;a&#160;great&#160;exercise&#160;in&#160;recursive&#160;thinking.<br/>
The&#160;inner&#160;function&#160;find&#160;does&#160;the&#160;actual&#160;recursing.&#160;It&#160;takes&#160;two&#160;arguments:<br/>
the&#160;current&#160;number&#160;and&#160;a&#160;string&#160;that&#160;records&#160;how&#160;we&#160;reached&#160;this&#160;number.&#160;If<br/>it&#160;finds&#160;a&#160;solution,&#160;it&#160;returns&#160;a&#160;string&#160;that&#160;shows&#160;how&#160;to&#160;get&#160;to&#160;the&#160;target.&#160;If<br/>no&#160;solution&#160;can&#160;be&#160;found&#160;starting&#160;from&#160;this&#160;number,&#160;it&#160;returns&#160;null.<br/>
To&#160;do&#160;this,&#160;the&#160;function&#160;performs&#160;one&#160;of&#160;three&#160;actions.&#160;If&#160;the&#160;current&#160;number<br/>
is&#160;the&#160;target&#160;number,&#160;the&#160;current&#160;history&#160;is&#160;a&#160;way&#160;to&#160;reach&#160;that&#160;target,&#160;so&#160;it<br/>is&#160;returned.&#160;If&#160;the&#160;current&#160;number&#160;is&#160;greater&#160;than&#160;the&#160;target,&#160;there’s&#160;no&#160;sense<br/>in&#160;further&#160;exploring&#160;this&#160;branch&#160;because&#160;both&#160;adding&#160;and&#160;multiplying&#160;will&#160;only<br/>
50<br/>
<hr/>
<a name=63></a>make&#160;the&#160;number&#160;bigger,&#160;so&#160;it&#160;returns&#160;null.&#160;Finally,&#160;if&#160;we’re&#160;still&#160;below&#160;the<br/>target&#160;number,&#160;the&#160;function&#160;tries&#160;both&#160;possible&#160;paths&#160;that&#160;start&#160;from&#160;the&#160;current<br/>number&#160;by&#160;calling&#160;itself&#160;twice,&#160;once&#160;for&#160;addition&#160;and&#160;once&#160;for&#160;multiplication.&#160;If<br/>the&#160;first&#160;call&#160;returns&#160;something&#160;that&#160;is&#160;not&#160;null,&#160;it&#160;is&#160;returned.&#160;Otherwise,&#160;the<br/>second&#160;call&#160;is&#160;returned,&#160;regardless&#160;of&#160;whether&#160;it&#160;produces&#160;a&#160;string&#160;or&#160;null.<br/>
To&#160;better&#160;understand&#160;how&#160;this&#160;function&#160;produces&#160;the&#160;effect&#160;we’re&#160;looking&#160;for,<br/>
let’s&#160;look&#160;at&#160;all&#160;the&#160;calls&#160;to&#160;find&#160;that&#160;are&#160;made&#160;when&#160;searching&#160;for&#160;a&#160;solution<br/>for&#160;the&#160;number&#160;13.<br/>
find(1,&#160;&#34;1&#34;)<br/>
find(6,&#160;&#34;(1&#160;+&#160;5)&#34;)<br/>
find(11,&#160;&#34;((1&#160;+&#160;5)&#160;+&#160;5)&#34;)<br/>
find(16,&#160;&#34;(((1&#160;+&#160;5)&#160;+&#160;5)&#160;+&#160;5)&#34;)<br/>
too&#160;big<br/>
find(33,&#160;&#34;(((1&#160;+&#160;5)&#160;+&#160;5)&#160;*&#160;3)&#34;)<br/>
too&#160;big<br/>
find(18,&#160;&#34;((1&#160;+&#160;5)&#160;*&#160;3)&#34;)<br/>
too&#160;big<br/>
find(3,&#160;&#34;(1&#160;*&#160;3)&#34;)<br/>
find(8,&#160;&#34;((1&#160;*&#160;3)&#160;+&#160;5)&#34;)<br/>
find(13,&#160;&#34;(((1&#160;*&#160;3)&#160;+&#160;5)&#160;+&#160;5)&#34;)<br/>
found!<br/>
The&#160;indentation&#160;indicates&#160;the&#160;depth&#160;of&#160;the&#160;call&#160;stack.&#160;The&#160;first&#160;time&#160;find&#160;is<br/>
called,&#160;it&#160;starts&#160;by&#160;calling&#160;itself&#160;to&#160;explore&#160;the&#160;solution&#160;that&#160;starts&#160;with&#160;(1&#160;+&#160;5).<br/>That&#160;call&#160;will&#160;further&#160;recurse&#160;to&#160;explore&#160;<i>every&#160;</i>continued&#160;solution&#160;that&#160;yields&#160;a<br/>number&#160;less&#160;than&#160;or&#160;equal&#160;to&#160;the&#160;target&#160;number.&#160;Since&#160;it&#160;doesn’t&#160;find&#160;one&#160;that<br/>hits&#160;the&#160;target,&#160;it&#160;returns&#160;null&#160;back&#160;to&#160;the&#160;first&#160;call.&#160;There&#160;the&#160;||&#160;operator<br/>causes&#160;the&#160;call&#160;that&#160;explores&#160;(1&#160;*&#160;3)&#160;to&#160;happen.&#160;This&#160;search&#160;has&#160;more&#160;luck—<br/>its&#160;first&#160;recursive&#160;call,&#160;through&#160;yet&#160;<i>another&#160;</i>recursive&#160;call,&#160;hits&#160;upon&#160;the&#160;target<br/>number.&#160;That&#160;innermost&#160;call&#160;returns&#160;a&#160;string,&#160;and&#160;each&#160;of&#160;the&#160;||&#160;operators<br/>in&#160;the&#160;intermediate&#160;calls&#160;passes&#160;that&#160;string&#160;along,&#160;ultimately&#160;returning&#160;the<br/>solution.<br/>
<b>Growing&#160;functions</b><br/>
There&#160;are&#160;two&#160;more&#160;or&#160;less&#160;natural&#160;ways&#160;for&#160;functions&#160;to&#160;be&#160;introduced&#160;into<br/>programs.<br/>
The&#160;first&#160;is&#160;that&#160;you&#160;find&#160;yourself&#160;writing&#160;similar&#160;code&#160;multiple&#160;times.&#160;You’d<br/>
prefer&#160;not&#160;to&#160;do&#160;that.&#160;Having&#160;more&#160;code&#160;means&#160;more&#160;space&#160;for&#160;mistakes&#160;to<br/>hide&#160;and&#160;more&#160;material&#160;to&#160;read&#160;for&#160;people&#160;trying&#160;to&#160;understand&#160;the&#160;program.<br/>
51<br/>
<hr/>
<a name=64></a>So&#160;you&#160;take&#160;the&#160;repeated&#160;functionality,&#160;find&#160;a&#160;good&#160;name&#160;for&#160;it,&#160;and&#160;put&#160;it&#160;into<br/>a&#160;function.<br/>
The&#160;second&#160;way&#160;is&#160;that&#160;you&#160;find&#160;you&#160;need&#160;some&#160;functionality&#160;that&#160;you&#160;haven’t<br/>
written&#160;yet&#160;and&#160;that&#160;sounds&#160;like&#160;it&#160;deserves&#160;its&#160;own&#160;function.&#160;You’ll&#160;start&#160;by<br/>naming&#160;the&#160;function,&#160;and&#160;then&#160;you’ll&#160;write&#160;its&#160;body.&#160;You&#160;might&#160;even&#160;start<br/>writing&#160;code&#160;that&#160;uses&#160;the&#160;function&#160;before&#160;you&#160;actually&#160;define&#160;the&#160;function<br/>itself.<br/>
How&#160;difficult&#160;it&#160;is&#160;to&#160;find&#160;a&#160;good&#160;name&#160;for&#160;a&#160;function&#160;is&#160;a&#160;good&#160;indication<br/>
of&#160;how&#160;clear&#160;a&#160;concept&#160;it&#160;is&#160;that&#160;you’re&#160;trying&#160;to&#160;wrap.&#160;Let’s&#160;go&#160;through&#160;an<br/>example.<br/>
We&#160;want&#160;to&#160;write&#160;a&#160;program&#160;that&#160;prints&#160;two&#160;numbers:&#160;the&#160;numbers&#160;of&#160;cows<br/>
and&#160;chickens&#160;on&#160;a&#160;farm,&#160;with&#160;the&#160;words&#160;Cows&#160;and&#160;Chickens&#160;after&#160;them&#160;and&#160;zeros<br/>padded&#160;before&#160;both&#160;numbers&#160;so&#160;that&#160;they&#160;are&#160;always&#160;three&#160;digits&#160;long.<br/>
007&#160;Cows<br/>011&#160;Chickens<br/>
This&#160;asks&#160;for&#160;a&#160;function&#160;of&#160;two&#160;arguments—the&#160;number&#160;of&#160;cows&#160;and&#160;the<br/>
number&#160;of&#160;chickens.&#160;Let’s&#160;get&#160;coding.<br/>
function&#160;printFarmInventory(cows,&#160;chickens)&#160;{<br/>
let&#160;cowString&#160;=&#160;String(cows);<br/>while&#160;(cowString.length&#160;&lt;&#160;3)&#160;{<br/>
cowString&#160;=&#160;&#34;0&#34;&#160;+&#160;cowString;<br/>
}<br/>console.log(`${cowString}&#160;Cows`);<br/>let&#160;chickenString&#160;=&#160;String(chickens);<br/>while&#160;(chickenString.length&#160;&lt;&#160;3)&#160;{<br/>
chickenString&#160;=&#160;&#34;0&#34;&#160;+&#160;chickenString;<br/>
}<br/>console.log(`${chickenString}&#160;Chickens`);<br/>
}<br/>printFarmInventory(7,&#160;11);<br/>
Writing&#160;.length&#160;after&#160;a&#160;string&#160;expression&#160;will&#160;give&#160;us&#160;the&#160;length&#160;of&#160;that&#160;string.<br/>
Thus,&#160;the&#160;while&#160;loops&#160;keep&#160;adding&#160;zeros&#160;in&#160;front&#160;of&#160;the&#160;number&#160;strings&#160;until<br/>they&#160;are&#160;at&#160;least&#160;three&#160;characters&#160;long.<br/>
Mission&#160;accomplished!&#160;But&#160;just&#160;as&#160;we&#160;are&#160;about&#160;to&#160;send&#160;the&#160;farmer&#160;the&#160;code<br/>
(along&#160;with&#160;a&#160;hefty&#160;invoice),&#160;she&#160;calls&#160;and&#160;tells&#160;us&#160;she’s&#160;also&#160;started&#160;keeping<br/>pigs,&#160;and&#160;couldn’t&#160;we&#160;please&#160;extend&#160;the&#160;software&#160;to&#160;also&#160;print&#160;pigs?<br/>
We&#160;sure&#160;can.&#160;But&#160;just&#160;as&#160;we’re&#160;in&#160;the&#160;process&#160;of&#160;copying&#160;and&#160;pasting&#160;those<br/>
52<br/>
<hr/>
<a name=65></a>four&#160;lines&#160;one&#160;more&#160;time,&#160;we&#160;stop&#160;and&#160;reconsider.&#160;There&#160;has&#160;to&#160;be&#160;a&#160;better&#160;way.<br/>Here’s&#160;a&#160;first&#160;attempt:<br/>
function&#160;printZeroPaddedWithLabel(number,&#160;label)&#160;{<br/>
let&#160;numberString&#160;=&#160;String(number);<br/>while&#160;(numberString.length&#160;&lt;&#160;3)&#160;{<br/>
numberString&#160;=&#160;&#34;0&#34;&#160;+&#160;numberString;<br/>
}<br/>console.log(`${numberString}&#160;${label}`);<br/>
}<br/>
function&#160;printFarmInventory(cows,&#160;chickens,&#160;pigs)&#160;{<br/>
printZeroPaddedWithLabel(cows,&#160;&#34;Cows&#34;);<br/>printZeroPaddedWithLabel(chickens,&#160;&#34;Chickens&#34;);<br/>printZeroPaddedWithLabel(pigs,&#160;&#34;Pigs&#34;);<br/>
}<br/>
printFarmInventory(7,&#160;11,&#160;3);<br/>
It&#160;works!&#160;But&#160;that&#160;name,&#160;printZeroPaddedWithLabel,&#160;is&#160;a&#160;little&#160;awkward.<br/>
It&#160;conflates&#160;three&#160;things—printing,&#160;zero-padding,&#160;and&#160;adding&#160;a&#160;label—into&#160;a<br/>single&#160;function.<br/>
Instead&#160;of&#160;lifting&#160;out&#160;the&#160;repeated&#160;part&#160;of&#160;our&#160;program&#160;wholesale,&#160;let’s&#160;try<br/>
to&#160;pick&#160;out&#160;a&#160;single&#160;<i>concept</i>.<br/>
function&#160;zeroPad(number,&#160;width)&#160;{<br/>
let&#160;string&#160;=&#160;String(number);<br/>while&#160;(string.length&#160;&lt;&#160;width)&#160;{<br/>
string&#160;=&#160;&#34;0&#34;&#160;+&#160;string;<br/>
}<br/>return&#160;string;<br/>
}<br/>
function&#160;printFarmInventory(cows,&#160;chickens,&#160;pigs)&#160;{<br/>
console.log(`${zeroPad(cows,&#160;3)}&#160;Cows`);<br/>console.log(`${zeroPad(chickens,&#160;3)}&#160;Chickens`);<br/>console.log(`${zeroPad(pigs,&#160;3)}&#160;Pigs`);<br/>
}<br/>
printFarmInventory(7,&#160;16,&#160;3);<br/>
A&#160;function&#160;with&#160;a&#160;nice,&#160;obvious&#160;name&#160;like&#160;zeroPad&#160;makes&#160;it&#160;easier&#160;for&#160;someone<br/>
who&#160;reads&#160;the&#160;code&#160;to&#160;figure&#160;out&#160;what&#160;it&#160;does.&#160;And&#160;such&#160;a&#160;function&#160;is&#160;useful&#160;in<br/>
53<br/>
<hr/>
<a name=66></a>more&#160;situations&#160;than&#160;just&#160;this&#160;specific&#160;program.&#160;For&#160;example,&#160;you&#160;could&#160;use&#160;it<br/>to&#160;help&#160;print&#160;nicely&#160;aligned&#160;tables&#160;of&#160;numbers.<br/>
How&#160;smart&#160;and&#160;versatile&#160;<i>should&#160;</i>our&#160;function&#160;be?&#160;We&#160;could&#160;write&#160;anything,<br/>
from&#160;a&#160;terribly&#160;simple&#160;function&#160;that&#160;can&#160;only&#160;pad&#160;a&#160;number&#160;to&#160;be&#160;three&#160;charac-<br/>ters&#160;wide&#160;to&#160;a&#160;complicated&#160;generalized&#160;number-formatting&#160;system&#160;that&#160;handles<br/>fractional&#160;numbers,&#160;negative&#160;numbers,&#160;alignment&#160;of&#160;decimal&#160;dots,&#160;padding&#160;with<br/>different&#160;characters,&#160;and&#160;so&#160;on.<br/>
A&#160;useful&#160;principle&#160;is&#160;to&#160;not&#160;add&#160;cleverness&#160;unless&#160;you&#160;are&#160;absolutely&#160;sure<br/>
you’re&#160;going&#160;to&#160;need&#160;it.&#160;It&#160;can&#160;be&#160;tempting&#160;to&#160;write&#160;general&#160;“frameworks”&#160;for<br/>every&#160;bit&#160;of&#160;functionality&#160;you&#160;come&#160;across.&#160;Resist&#160;that&#160;urge.&#160;You&#160;won’t&#160;get&#160;any<br/>real&#160;work&#160;done—you’ll&#160;just&#160;be&#160;writing&#160;code&#160;that&#160;you&#160;never&#160;use.<br/>
<b>Functions&#160;and&#160;side&#160;effects</b><br/>
Functions&#160;can&#160;be&#160;roughly&#160;divided&#160;into&#160;those&#160;that&#160;are&#160;called&#160;for&#160;their&#160;side&#160;effects<br/>and&#160;those&#160;that&#160;are&#160;called&#160;for&#160;their&#160;return&#160;value.&#160;(Though&#160;it&#160;is&#160;definitely&#160;also<br/>possible&#160;to&#160;both&#160;have&#160;side&#160;effects&#160;and&#160;return&#160;a&#160;value.)<br/>
The&#160;first&#160;helper&#160;function&#160;in&#160;the&#160;farm&#160;example,&#160;printZeroPaddedWithLabel,<br/>
is&#160;called&#160;for&#160;its&#160;side&#160;effect:&#160;it&#160;prints&#160;a&#160;line.&#160;The&#160;second&#160;version,&#160;zeroPad,&#160;is<br/>called&#160;for&#160;its&#160;return&#160;value.&#160;It&#160;is&#160;no&#160;coincidence&#160;that&#160;the&#160;second&#160;is&#160;useful&#160;in&#160;more<br/>situations&#160;than&#160;the&#160;first.&#160;Functions&#160;that&#160;create&#160;values&#160;are&#160;easier&#160;to&#160;combine&#160;in<br/>new&#160;ways&#160;than&#160;functions&#160;that&#160;directly&#160;perform&#160;side&#160;effects.<br/>
A&#160;<i>pure&#160;</i>function&#160;is&#160;a&#160;specific&#160;kind&#160;of&#160;value-producing&#160;function&#160;that&#160;not&#160;only<br/>
has&#160;no&#160;side&#160;effects&#160;but&#160;also&#160;doesn’t&#160;rely&#160;on&#160;side&#160;effects&#160;from&#160;other&#160;code—for<br/>example,&#160;it&#160;doesn’t&#160;read&#160;global&#160;bindings&#160;whose&#160;value&#160;might&#160;change.&#160;A&#160;pure<br/>function&#160;has&#160;the&#160;pleasant&#160;property&#160;that,&#160;when&#160;called&#160;with&#160;the&#160;same&#160;arguments,<br/>it&#160;always&#160;produces&#160;the&#160;same&#160;value&#160;(and&#160;doesn’t&#160;do&#160;anything&#160;else).&#160;A&#160;call&#160;to<br/>such&#160;a&#160;function&#160;can&#160;be&#160;substituted&#160;by&#160;its&#160;return&#160;value&#160;without&#160;changing&#160;the<br/>meaning&#160;of&#160;the&#160;code.&#160;When&#160;you&#160;are&#160;not&#160;sure&#160;that&#160;a&#160;pure&#160;function&#160;is&#160;working<br/>correctly,&#160;you&#160;can&#160;test&#160;it&#160;by&#160;simply&#160;calling&#160;it&#160;and&#160;know&#160;that&#160;if&#160;it&#160;works&#160;in&#160;that<br/>context,&#160;it&#160;will&#160;work&#160;in&#160;any&#160;context.&#160;Nonpure&#160;functions&#160;tend&#160;to&#160;require&#160;more<br/>scaffolding&#160;to&#160;test.<br/>
Still,&#160;there’s&#160;no&#160;need&#160;to&#160;feel&#160;bad&#160;when&#160;writing&#160;functions&#160;that&#160;are&#160;not&#160;pure&#160;or<br/>
to&#160;wage&#160;a&#160;holy&#160;war&#160;to&#160;purge&#160;them&#160;from&#160;your&#160;code.&#160;Side&#160;effects&#160;are&#160;often&#160;useful.<br/>There’d&#160;be&#160;no&#160;way&#160;to&#160;write&#160;a&#160;pure&#160;version&#160;of&#160;console.log,&#160;for&#160;example,&#160;and<br/>console.log&#160;is&#160;good&#160;to&#160;have.&#160;Some&#160;operations&#160;are&#160;also&#160;easier&#160;to&#160;express&#160;in&#160;an<br/>efficient&#160;way&#160;when&#160;we&#160;use&#160;side&#160;effects,&#160;so&#160;computing&#160;speed&#160;can&#160;be&#160;a&#160;reason&#160;to<br/>avoid&#160;purity.<br/>
54<br/>
<hr/>
<a name=67></a><b>Summary</b><br/>
This&#160;chapter&#160;taught&#160;you&#160;how&#160;to&#160;write&#160;your&#160;own&#160;functions.&#160;The&#160;function&#160;key-<br/>word,&#160;when&#160;used&#160;as&#160;an&#160;expression,&#160;can&#160;create&#160;a&#160;function&#160;value.&#160;When&#160;used&#160;as<br/>a&#160;statement,&#160;it&#160;can&#160;be&#160;used&#160;to&#160;declare&#160;a&#160;binding&#160;and&#160;give&#160;it&#160;a&#160;function&#160;as&#160;its<br/>value.&#160;Arrow&#160;functions&#160;are&#160;yet&#160;another&#160;way&#160;to&#160;create&#160;functions.<br/>
//&#160;Define&#160;f&#160;to&#160;hold&#160;a&#160;function&#160;value<br/>const&#160;f&#160;=&#160;function(a)&#160;{<br/>
console.log(a&#160;+&#160;2);<br/>
};<br/>
//&#160;Declare&#160;g&#160;to&#160;be&#160;a&#160;function<br/>function&#160;g(a,&#160;b)&#160;{<br/>
return&#160;a&#160;*&#160;b&#160;*&#160;3.5;<br/>
}<br/>
//&#160;A&#160;less&#160;verbose&#160;function&#160;value<br/>let&#160;h&#160;=&#160;a&#160;=&gt;&#160;a&#160;%&#160;3;<br/>
A&#160;key&#160;aspect&#160;in&#160;understanding&#160;functions&#160;is&#160;understanding&#160;scopes.&#160;Each&#160;block<br/>
creates&#160;a&#160;new&#160;scope.&#160;Parameters&#160;and&#160;bindings&#160;declared&#160;in&#160;a&#160;given&#160;scope&#160;are<br/>local&#160;and&#160;not&#160;visible&#160;from&#160;the&#160;outside.&#160;Bindings&#160;declared&#160;with&#160;var&#160;behave<br/>differently—they&#160;end&#160;up&#160;in&#160;the&#160;nearest&#160;function&#160;scope&#160;or&#160;the&#160;global&#160;scope.<br/>
Separating&#160;the&#160;tasks&#160;your&#160;program&#160;performs&#160;into&#160;different&#160;functions&#160;is&#160;help-<br/>
ful.&#160;You&#160;won’t&#160;have&#160;to&#160;repeat&#160;yourself&#160;as&#160;much,&#160;and&#160;functions&#160;can&#160;help&#160;organize<br/>a&#160;program&#160;by&#160;grouping&#160;code&#160;into&#160;pieces&#160;that&#160;do&#160;specific&#160;things.<br/>
<b>Exercises</b><br/>
<b>Minimum</b><br/>
The&#160;<a href="eloquent-javascripts.html#38">previous&#160;chapter&#160;</a>introduced&#160;the&#160;standard&#160;function&#160;Math.min&#160;that&#160;returns<br/>its&#160;smallest&#160;argument.&#160;We&#160;can&#160;build&#160;something&#160;like&#160;that&#160;now.&#160;Write&#160;a&#160;function<br/>min&#160;that&#160;takes&#160;two&#160;arguments&#160;and&#160;returns&#160;their&#160;minimum.<br/>
<b>Recursion</b><br/>
We’ve&#160;seen&#160;that&#160;%&#160;(the&#160;remainder&#160;operator)&#160;can&#160;be&#160;used&#160;to&#160;test&#160;whether&#160;a<br/>number&#160;is&#160;even&#160;or&#160;odd&#160;by&#160;using&#160;%&#160;2&#160;to&#160;see&#160;whether&#160;it’s&#160;divisible&#160;by&#160;two.&#160;Here’s<br/>another&#160;way&#160;to&#160;define&#160;whether&#160;a&#160;positive&#160;whole&#160;number&#160;is&#160;even&#160;or&#160;odd:<br/>
55<br/>
<hr/>
<a name=68></a>•&#160;Zero&#160;is&#160;even.<br/>
•&#160;One&#160;is&#160;odd.<br/>
•&#160;For&#160;any&#160;other&#160;number&#160;<i>N</i>,&#160;its&#160;evenness&#160;is&#160;the&#160;same&#160;as&#160;<i>N&#160;</i>-&#160;2.<br/>
Define&#160;a&#160;recursive&#160;function&#160;isEven&#160;corresponding&#160;to&#160;this&#160;description.&#160;The<br/>
function&#160;should&#160;accept&#160;a&#160;single&#160;parameter&#160;(a&#160;positive,&#160;whole&#160;number)&#160;and&#160;return<br/>a&#160;Boolean.<br/>
Test&#160;it&#160;on&#160;50&#160;and&#160;75.&#160;See&#160;how&#160;it&#160;behaves&#160;on&#160;-1.&#160;Why?&#160;Can&#160;you&#160;think&#160;of&#160;a<br/>
way&#160;to&#160;fix&#160;this?<br/>
<b>Bean&#160;counting</b><br/>
You&#160;can&#160;get&#160;the&#160;Nth&#160;character,&#160;or&#160;letter,&#160;from&#160;a&#160;string&#160;by&#160;writing&#160;&#34;string&#34;[N].<br/>The&#160;returned&#160;value&#160;will&#160;be&#160;a&#160;string&#160;containing&#160;only&#160;one&#160;character&#160;(for&#160;example,<br/>&#34;b&#34;).&#160;The&#160;first&#160;character&#160;has&#160;position&#160;0,&#160;which&#160;causes&#160;the&#160;last&#160;one&#160;to&#160;be&#160;found&#160;at<br/>position&#160;string.length&#160;-&#160;1.&#160;In&#160;other&#160;words,&#160;a&#160;two-character&#160;string&#160;has&#160;length<br/>2,&#160;and&#160;its&#160;characters&#160;have&#160;positions&#160;0&#160;and&#160;1.<br/>
Write&#160;a&#160;function&#160;countBs&#160;that&#160;takes&#160;a&#160;string&#160;as&#160;its&#160;only&#160;argument&#160;and&#160;returns<br/>
a&#160;number&#160;that&#160;indicates&#160;how&#160;many&#160;uppercase&#160;“B”&#160;characters&#160;there&#160;are&#160;in&#160;the<br/>string.<br/>
Next,&#160;write&#160;a&#160;function&#160;called&#160;countChar&#160;that&#160;behaves&#160;like&#160;countBs,&#160;except<br/>
it&#160;takes&#160;a&#160;second&#160;argument&#160;that&#160;indicates&#160;the&#160;character&#160;that&#160;is&#160;to&#160;be&#160;counted<br/>(rather&#160;than&#160;counting&#160;only&#160;uppercase&#160;“B”&#160;characters).&#160;Rewrite&#160;countBs&#160;to<br/>make&#160;use&#160;of&#160;this&#160;new&#160;function.<br/>
56<br/>
<hr/>
<a name=69></a><i>“On&#160;two&#160;occasions&#160;I&#160;have&#160;been&#160;asked,&#160;‘Pray,&#160;Mr.&#160;Babbage,&#160;if&#160;you&#160;put</i><br/>
<i>into&#160;the&#160;machine&#160;wrong&#160;figures,&#160;will&#160;the&#160;right&#160;answers&#160;come&#160;out?’<br/>[...]&#160;I&#160;am&#160;not&#160;able&#160;rightly&#160;to&#160;apprehend&#160;the&#160;kind&#160;of&#160;confusion&#160;of&#160;ideas<br/>that&#160;could&#160;provoke&#160;such&#160;a&#160;question.”</i><br/>
—Charles&#160;Babbage,&#160;Passages&#160;from&#160;the&#160;Life&#160;of&#160;a&#160;Philosopher&#160;(1864)<br/>
<b>Chapter&#160;4<br/>Data&#160;Structures:&#160;Objects&#160;and&#160;Arrays</b><br/>
Numbers,&#160;Booleans,&#160;and&#160;strings&#160;are&#160;the&#160;atoms&#160;that&#160;data&#160;structures&#160;are&#160;built<br/>from.&#160;Many&#160;types&#160;of&#160;information&#160;require&#160;more&#160;than&#160;one&#160;atom,&#160;though.&#160;<i>Ob-<br/>jects&#160;</i>allow&#160;us&#160;to&#160;group&#160;values—including&#160;other&#160;objects—to&#160;build&#160;more&#160;complex<br/>structures.<br/>
The&#160;programs&#160;we&#160;have&#160;built&#160;so&#160;far&#160;have&#160;been&#160;limited&#160;by&#160;the&#160;fact&#160;that&#160;they<br/>
were&#160;operating&#160;only&#160;on&#160;simple&#160;data&#160;types.&#160;This&#160;chapter&#160;will&#160;introduce&#160;basic<br/>data&#160;structures.&#160;By&#160;the&#160;end&#160;of&#160;it,&#160;you’ll&#160;know&#160;enough&#160;to&#160;start&#160;writing&#160;useful<br/>programs.<br/>
The&#160;chapter&#160;will&#160;work&#160;through&#160;a&#160;more&#160;or&#160;less&#160;realistic&#160;programming&#160;example,<br/>
introducing&#160;concepts&#160;as&#160;they&#160;apply&#160;to&#160;the&#160;problem&#160;at&#160;hand.&#160;The&#160;example&#160;code<br/>will&#160;often&#160;build&#160;on&#160;functions&#160;and&#160;bindings&#160;that&#160;were&#160;introduced&#160;earlier&#160;in&#160;the<br/>text.<br/>
The&#160;online&#160;coding&#160;sandbox&#160;for&#160;the&#160;book&#160;(<a href="https://eloquentjavascript.net/code"><i>https://eloquentjavascript.net/code</i>)</a><br/>
provides&#160;a&#160;way&#160;to&#160;run&#160;code&#160;in&#160;the&#160;context&#160;of&#160;a&#160;specific&#160;chapter.&#160;If&#160;you&#160;decide&#160;to<br/>work&#160;through&#160;the&#160;examples&#160;in&#160;another&#160;environment,&#160;be&#160;sure&#160;to&#160;first&#160;download<br/>the&#160;full&#160;code&#160;for&#160;this&#160;chapter&#160;from&#160;the&#160;sandbox&#160;page.<br/>
<b>The&#160;weresquirrel</b><br/>
Every&#160;now&#160;and&#160;then,&#160;usually&#160;between&#160;8&#160;p.m.&#160;and&#160;10&#160;p.m.,&#160;Jacques&#160;finds&#160;himself<br/>transforming&#160;into&#160;a&#160;small&#160;furry&#160;rodent&#160;with&#160;a&#160;bushy&#160;tail.<br/>
On&#160;one&#160;hand,&#160;Jacques&#160;is&#160;quite&#160;glad&#160;that&#160;he&#160;doesn’t&#160;have&#160;classic&#160;lycanthropy.<br/>
Turning&#160;into&#160;a&#160;squirrel&#160;does&#160;cause&#160;fewer&#160;problems&#160;than&#160;turning&#160;into&#160;a&#160;wolf.<br/>Instead&#160;of&#160;having&#160;to&#160;worry&#160;about&#160;accidentally&#160;eating&#160;the&#160;neighbor&#160;(<i>that&#160;</i>would<br/>be&#160;awkward),&#160;he&#160;worries&#160;about&#160;being&#160;eaten&#160;by&#160;the&#160;neighbor’s&#160;cat.&#160;After&#160;two<br/>occasions&#160;where&#160;he&#160;woke&#160;up&#160;on&#160;a&#160;precariously&#160;thin&#160;branch&#160;in&#160;the&#160;crown&#160;of&#160;an<br/>oak,&#160;naked&#160;and&#160;disoriented,&#160;he&#160;has&#160;taken&#160;to&#160;locking&#160;the&#160;doors&#160;and&#160;windows&#160;of<br/>his&#160;room&#160;at&#160;night&#160;and&#160;putting&#160;a&#160;few&#160;walnuts&#160;on&#160;the&#160;floor&#160;to&#160;keep&#160;himself&#160;busy.<br/>
That&#160;takes&#160;care&#160;of&#160;the&#160;cat&#160;and&#160;tree&#160;problems.&#160;But&#160;Jacques&#160;would&#160;prefer&#160;to<br/>
get&#160;rid&#160;of&#160;his&#160;condition&#160;entirely.&#160;The&#160;irregular&#160;occurrences&#160;of&#160;the&#160;transformation<br/>
57<br/>
<hr/>
<a name=70></a>make&#160;him&#160;suspect&#160;that&#160;they&#160;might&#160;be&#160;triggered&#160;by&#160;something.&#160;For&#160;a&#160;while,&#160;he<br/>believed&#160;that&#160;it&#160;happened&#160;only&#160;on&#160;days&#160;when&#160;he&#160;had&#160;been&#160;near&#160;oak&#160;trees.&#160;But<br/>avoiding&#160;oak&#160;trees&#160;did&#160;not&#160;stop&#160;the&#160;problem.<br/>
Switching&#160;to&#160;a&#160;more&#160;scientific&#160;approach,&#160;Jacques&#160;has&#160;started&#160;keeping&#160;a&#160;daily<br/>
log&#160;of&#160;everything&#160;he&#160;does&#160;on&#160;a&#160;given&#160;day&#160;and&#160;whether&#160;he&#160;changed&#160;form.&#160;With<br/>this&#160;data&#160;he&#160;hopes&#160;to&#160;narrow&#160;down&#160;the&#160;conditions&#160;that&#160;trigger&#160;the&#160;transforma-<br/>tions.<br/>
The&#160;first&#160;thing&#160;he&#160;needs&#160;is&#160;a&#160;data&#160;structure&#160;to&#160;store&#160;this&#160;information.<br/>
<b>Data&#160;sets</b><br/>
To&#160;work&#160;with&#160;a&#160;chunk&#160;of&#160;digital&#160;data,&#160;we’ll&#160;first&#160;have&#160;to&#160;find&#160;a&#160;way&#160;to&#160;represent<br/>it&#160;in&#160;our&#160;machine’s&#160;memory.&#160;Say,&#160;for&#160;example,&#160;that&#160;we&#160;want&#160;to&#160;represent&#160;a<br/>collection&#160;of&#160;the&#160;numbers&#160;2,&#160;3,&#160;5,&#160;7,&#160;and&#160;11.<br/>
We&#160;could&#160;get&#160;creative&#160;with&#160;strings—after&#160;all,&#160;strings&#160;can&#160;have&#160;any&#160;length,&#160;so<br/>
we&#160;can&#160;put&#160;a&#160;lot&#160;of&#160;data&#160;into&#160;them—and&#160;use&#160;&#34;2&#160;3&#160;5&#160;7&#160;11&#34;&#160;as&#160;our&#160;representation.<br/>But&#160;this&#160;is&#160;awkward.&#160;You’d&#160;have&#160;to&#160;somehow&#160;extract&#160;the&#160;digits&#160;and&#160;convert<br/>them&#160;back&#160;to&#160;numbers&#160;to&#160;access&#160;them.<br/>
Fortunately,&#160;JavaScript&#160;provides&#160;a&#160;data&#160;type&#160;specifically&#160;for&#160;storing&#160;sequences<br/>
of&#160;values.&#160;It&#160;is&#160;called&#160;an&#160;<i>array&#160;</i>and&#160;is&#160;written&#160;as&#160;a&#160;list&#160;of&#160;values&#160;between&#160;square<br/>brackets,&#160;separated&#160;by&#160;commas.<br/>
let&#160;listOfNumbers&#160;=&#160;[2,&#160;3,&#160;5,&#160;7,&#160;11];<br/>console.log(listOfNumbers[2]);<br/>//&#160;→&#160;5<br/>console.log(listOfNumbers[0]);<br/>//&#160;→&#160;2<br/>console.log(listOfNumbers[2&#160;-&#160;1]);<br/>//&#160;→&#160;3<br/>
The&#160;notation&#160;for&#160;getting&#160;at&#160;the&#160;elements&#160;inside&#160;an&#160;array&#160;also&#160;uses&#160;square<br/>
brackets.&#160;A&#160;pair&#160;of&#160;square&#160;brackets&#160;immediately&#160;after&#160;an&#160;expression,&#160;with<br/>another&#160;expression&#160;inside&#160;of&#160;them,&#160;will&#160;look&#160;up&#160;the&#160;element&#160;in&#160;the&#160;left-hand<br/>expression&#160;that&#160;corresponds&#160;to&#160;the&#160;<i>index&#160;</i>given&#160;by&#160;the&#160;expression&#160;in&#160;the&#160;brackets.<br/>
The&#160;first&#160;index&#160;of&#160;an&#160;array&#160;is&#160;zero,&#160;not&#160;one.&#160;So&#160;the&#160;first&#160;element&#160;is&#160;retrieved<br/>
with&#160;listOfNumbers[0].&#160;Zero-based&#160;counting&#160;has&#160;a&#160;long&#160;tradition&#160;in&#160;technology<br/>and&#160;in&#160;certain&#160;ways&#160;makes&#160;a&#160;lot&#160;of&#160;sense,&#160;but&#160;it&#160;takes&#160;some&#160;getting&#160;used&#160;to.<br/>Think&#160;of&#160;the&#160;index&#160;as&#160;the&#160;amount&#160;of&#160;items&#160;to&#160;skip,&#160;counting&#160;from&#160;the&#160;start&#160;of<br/>the&#160;array.<br/>
58<br/>
<hr/>
<a name=71></a><b>Properties</b><br/>
We’ve&#160;seen&#160;a&#160;few&#160;suspicious-looking&#160;expressions&#160;like&#160;myString.length&#160;(to&#160;get<br/>the&#160;length&#160;of&#160;a&#160;string)&#160;and&#160;Math.max&#160;(the&#160;maximum&#160;function)&#160;in&#160;past&#160;chapters.<br/>These&#160;are&#160;expressions&#160;that&#160;access&#160;a&#160;<i>property&#160;</i>of&#160;some&#160;value.&#160;In&#160;the&#160;first&#160;case,<br/>we&#160;access&#160;the&#160;length&#160;property&#160;of&#160;the&#160;value&#160;in&#160;myString.&#160;In&#160;the&#160;second,&#160;we<br/>access&#160;the&#160;property&#160;named&#160;max&#160;in&#160;the&#160;Math&#160;object&#160;(which&#160;is&#160;a&#160;collection&#160;of<br/>mathematics-related&#160;constants&#160;and&#160;functions).<br/>
Almost&#160;all&#160;JavaScript&#160;values&#160;have&#160;properties.&#160;The&#160;exceptions&#160;are&#160;null&#160;and<br/>
undefined.&#160;If&#160;you&#160;try&#160;to&#160;access&#160;a&#160;property&#160;on&#160;one&#160;of&#160;these&#160;nonvalues,&#160;you&#160;get<br/>an&#160;error.<br/>
null.length;<br/>//&#160;→&#160;TypeError:&#160;null&#160;has&#160;no&#160;properties<br/>
The&#160;two&#160;main&#160;ways&#160;to&#160;access&#160;properties&#160;in&#160;JavaScript&#160;are&#160;with&#160;a&#160;dot&#160;and&#160;with<br/>
square&#160;brackets.&#160;Both&#160;value.x&#160;and&#160;value[x]&#160;access&#160;a&#160;property&#160;on&#160;value—but<br/>not&#160;necessarily&#160;the&#160;same&#160;property.&#160;The&#160;difference&#160;is&#160;in&#160;how&#160;x&#160;is&#160;interpreted.<br/>When&#160;using&#160;a&#160;dot,&#160;the&#160;word&#160;after&#160;the&#160;dot&#160;is&#160;the&#160;literal&#160;name&#160;of&#160;the&#160;property.<br/>When&#160;using&#160;square&#160;brackets,&#160;the&#160;expression&#160;between&#160;the&#160;brackets&#160;is&#160;<i>evaluated&#160;</i>to<br/>get&#160;the&#160;property&#160;name.&#160;Whereas&#160;value.x&#160;fetches&#160;the&#160;property&#160;of&#160;value&#160;named<br/>“x”,&#160;value[x]&#160;tries&#160;to&#160;evaluate&#160;the&#160;expression&#160;x&#160;and&#160;uses&#160;the&#160;result,&#160;converted<br/>to&#160;a&#160;string,&#160;as&#160;the&#160;property&#160;name.<br/>
So&#160;if&#160;you&#160;know&#160;that&#160;the&#160;property&#160;you&#160;are&#160;interested&#160;in&#160;is&#160;called&#160;<i>color</i>,&#160;you&#160;say<br/>
value.color.&#160;If&#160;you&#160;want&#160;to&#160;extract&#160;the&#160;property&#160;named&#160;by&#160;the&#160;value&#160;held&#160;in<br/>the&#160;binding&#160;i,&#160;you&#160;say&#160;value[i].&#160;Property&#160;names&#160;are&#160;strings.&#160;They&#160;can&#160;be&#160;any<br/>string,&#160;but&#160;the&#160;dot&#160;notation&#160;works&#160;only&#160;with&#160;names&#160;that&#160;look&#160;like&#160;valid&#160;binding<br/>names.&#160;So&#160;if&#160;you&#160;want&#160;to&#160;access&#160;a&#160;property&#160;named&#160;<i>2&#160;</i>or&#160;<i>John&#160;Doe</i>,&#160;you&#160;must<br/>use&#160;square&#160;brackets:&#160;value[2]&#160;or&#160;value[&#34;John&#160;Doe&#34;].<br/>
The&#160;elements&#160;in&#160;an&#160;array&#160;are&#160;stored&#160;as&#160;the&#160;array’s&#160;properties,&#160;using&#160;numbers<br/>
as&#160;property&#160;names.&#160;Because&#160;you&#160;can’t&#160;use&#160;the&#160;dot&#160;notation&#160;with&#160;numbers&#160;and<br/>usually&#160;want&#160;to&#160;use&#160;a&#160;binding&#160;that&#160;holds&#160;the&#160;index&#160;anyway,&#160;you&#160;have&#160;to&#160;use&#160;the<br/>bracket&#160;notation&#160;to&#160;get&#160;at&#160;them.<br/>
The&#160;length&#160;property&#160;of&#160;an&#160;array&#160;tells&#160;us&#160;how&#160;many&#160;elements&#160;it&#160;has.&#160;This<br/>
property&#160;name&#160;is&#160;a&#160;valid&#160;binding&#160;name,&#160;and&#160;we&#160;know&#160;its&#160;name&#160;in&#160;advance,&#160;so<br/>to&#160;find&#160;the&#160;length&#160;of&#160;an&#160;array,&#160;you&#160;typically&#160;write&#160;array.length&#160;because&#160;that’s<br/>easier&#160;to&#160;write&#160;than&#160;array[&#34;length&#34;].<br/>
59<br/>
<hr/>
<a name=72></a><b>Methods</b><br/>
Both&#160;string&#160;and&#160;array&#160;values&#160;contain,&#160;in&#160;addition&#160;to&#160;the&#160;length&#160;property,&#160;a<br/>number&#160;of&#160;properties&#160;that&#160;hold&#160;function&#160;values.<br/>
let&#160;doh&#160;=&#160;&#34;Doh&#34;;<br/>console.log(typeof&#160;doh.toUpperCase);<br/>//&#160;→&#160;function<br/>console.log(doh.toUpperCase());<br/>//&#160;→&#160;DOH<br/>
Every&#160;string&#160;has&#160;a&#160;toUpperCase&#160;property.&#160;When&#160;called,&#160;it&#160;will&#160;return&#160;a&#160;copy<br/>
of&#160;the&#160;string&#160;in&#160;which&#160;all&#160;letters&#160;have&#160;been&#160;converted&#160;to&#160;uppercase.&#160;There&#160;is<br/>also&#160;toLowerCase,&#160;going&#160;the&#160;other&#160;way.<br/>
Interestingly,&#160;even&#160;though&#160;the&#160;call&#160;to&#160;toUpperCase&#160;does&#160;not&#160;pass&#160;any&#160;argu-<br/>
ments,&#160;the&#160;function&#160;somehow&#160;has&#160;access&#160;to&#160;the&#160;string&#160;&#34;Doh&#34;,&#160;the&#160;value&#160;whose<br/>property&#160;we&#160;called.&#160;How&#160;this&#160;works&#160;is&#160;described&#160;in&#160;<a href="eloquent-javascripts.html#109">Chapter&#160;6</a>.<br/>
Properties&#160;that&#160;contain&#160;functions&#160;are&#160;generally&#160;called&#160;<i>methods&#160;</i>of&#160;the&#160;value<br/>
they&#160;belong&#160;to,&#160;as&#160;in&#160;“toUpperCase&#160;is&#160;a&#160;method&#160;of&#160;a&#160;string”.<br/>
This&#160;example&#160;demonstrates&#160;two&#160;methods&#160;you&#160;can&#160;use&#160;to&#160;manipulate&#160;arrays:<br/>
let&#160;sequence&#160;=&#160;[1,&#160;2,&#160;3];<br/>sequence.push(4);<br/>sequence.push(5);<br/>console.log(sequence);<br/>//&#160;→&#160;[1,&#160;2,&#160;3,&#160;4,&#160;5]<br/>console.log(sequence.pop());<br/>//&#160;→&#160;5<br/>console.log(sequence);<br/>//&#160;→&#160;[1,&#160;2,&#160;3,&#160;4]<br/>
The&#160;push&#160;method&#160;adds&#160;values&#160;to&#160;the&#160;end&#160;of&#160;an&#160;array,&#160;and&#160;the&#160;pop&#160;method<br/>
does&#160;the&#160;opposite,&#160;removing&#160;the&#160;last&#160;value&#160;in&#160;the&#160;array&#160;and&#160;returning&#160;it.<br/>
These&#160;somewhat&#160;silly&#160;names&#160;are&#160;the&#160;traditional&#160;terms&#160;for&#160;operations&#160;on&#160;a<br/>
<i>stack</i>.&#160;A&#160;stack,&#160;in&#160;programming,&#160;is&#160;a&#160;data&#160;structure&#160;that&#160;allows&#160;you&#160;to&#160;push<br/>values&#160;into&#160;it&#160;and&#160;pop&#160;them&#160;out&#160;again&#160;in&#160;the&#160;opposite&#160;order&#160;so&#160;that&#160;the&#160;thing<br/>that&#160;was&#160;added&#160;last&#160;is&#160;removed&#160;first.&#160;These&#160;are&#160;common&#160;in&#160;programming—you<br/>might&#160;remember&#160;the&#160;function&#160;call&#160;stack&#160;from&#160;<a href="eloquent-javascripts.html#56">the&#160;previous&#160;chapter</a>,&#160;which&#160;is&#160;an<br/>instance&#160;of&#160;the&#160;same&#160;idea.<br/>
60<br/>
<hr/>
<a name=73></a><b>Objects</b><br/>
Back&#160;to&#160;the&#160;weresquirrel.&#160;A&#160;set&#160;of&#160;daily&#160;log&#160;entries&#160;can&#160;be&#160;represented&#160;as&#160;an<br/>array.&#160;But&#160;the&#160;entries&#160;do&#160;not&#160;consist&#160;of&#160;just&#160;a&#160;number&#160;or&#160;a&#160;string—each&#160;entry<br/>needs&#160;to&#160;store&#160;a&#160;list&#160;of&#160;activities&#160;and&#160;a&#160;Boolean&#160;value&#160;that&#160;indicates&#160;whether<br/>Jacques&#160;turned&#160;into&#160;a&#160;squirrel&#160;or&#160;not.&#160;Ideally,&#160;we&#160;would&#160;like&#160;to&#160;group&#160;these<br/>together&#160;into&#160;a&#160;single&#160;value&#160;and&#160;then&#160;put&#160;those&#160;grouped&#160;values&#160;into&#160;an&#160;array&#160;of<br/>log&#160;entries.<br/>
Values&#160;of&#160;the&#160;type&#160;<i>object&#160;</i>are&#160;arbitrary&#160;collections&#160;of&#160;properties.&#160;One&#160;way&#160;to<br/>
create&#160;an&#160;object&#160;is&#160;by&#160;using&#160;braces&#160;as&#160;an&#160;expression.<br/>
let&#160;day1&#160;=&#160;{<br/>
squirrel:&#160;false,<br/>events:&#160;[&#34;work&#34;,&#160;&#34;touched&#160;tree&#34;,&#160;&#34;pizza&#34;,&#160;&#34;running&#34;]<br/>
};<br/>console.log(day1.squirrel);<br/>//&#160;→&#160;false<br/>console.log(day1.wolf);<br/>//&#160;→&#160;undefined<br/>day1.wolf&#160;=&#160;false;<br/>console.log(day1.wolf);<br/>//&#160;→&#160;false<br/>
Inside&#160;the&#160;braces,&#160;there&#160;is&#160;a&#160;list&#160;of&#160;properties&#160;separated&#160;by&#160;commas.&#160;Each<br/>
property&#160;has&#160;a&#160;name&#160;followed&#160;by&#160;a&#160;colon&#160;and&#160;a&#160;value.&#160;When&#160;an&#160;object&#160;is&#160;written<br/>over&#160;multiple&#160;lines,&#160;indenting&#160;it&#160;like&#160;in&#160;the&#160;example&#160;helps&#160;with&#160;readability.<br/>Properties&#160;whose&#160;names&#160;aren’t&#160;valid&#160;binding&#160;names&#160;or&#160;valid&#160;numbers&#160;have&#160;to<br/>be&#160;quoted.<br/>
let&#160;descriptions&#160;=&#160;{<br/>
work:&#160;&#34;Went&#160;to&#160;work&#34;,<br/>&#34;touched&#160;tree&#34;:&#160;&#34;Touched&#160;a&#160;tree&#34;<br/>
};<br/>
This&#160;means&#160;that&#160;braces&#160;have&#160;<i>two&#160;</i>meanings&#160;in&#160;JavaScript.&#160;At&#160;the&#160;start&#160;of<br/>
a&#160;statement,&#160;they&#160;start&#160;a&#160;block&#160;of&#160;statements.&#160;In&#160;any&#160;other&#160;position,&#160;they<br/>describe&#160;an&#160;object.&#160;Fortunately,&#160;it&#160;is&#160;rarely&#160;useful&#160;to&#160;start&#160;a&#160;statement&#160;with&#160;an<br/>object&#160;in&#160;braces,&#160;so&#160;the&#160;ambiguity&#160;between&#160;these&#160;two&#160;is&#160;not&#160;much&#160;of&#160;a&#160;problem.<br/>
Reading&#160;a&#160;property&#160;that&#160;doesn’t&#160;exist&#160;will&#160;give&#160;you&#160;the&#160;value&#160;undefined.<br/>It&#160;is&#160;possible&#160;to&#160;assign&#160;a&#160;value&#160;to&#160;a&#160;property&#160;expression&#160;with&#160;the&#160;=&#160;operator.<br/>
This&#160;will&#160;replace&#160;the&#160;property’s&#160;value&#160;if&#160;it&#160;already&#160;existed&#160;or&#160;create&#160;a&#160;new<br/>
61<br/>
<hr/>
<a name=74></a>property&#160;on&#160;the&#160;object&#160;if&#160;it&#160;didn’t.<br/>
To&#160;briefly&#160;return&#160;to&#160;our&#160;tentacle&#160;model&#160;of&#160;bindings—property&#160;bindings&#160;are<br/>
similar.&#160;They&#160;<i>grasp&#160;</i>values,&#160;but&#160;other&#160;bindings&#160;and&#160;properties&#160;might&#160;be&#160;holding<br/>onto&#160;those&#160;same&#160;values.&#160;You&#160;may&#160;think&#160;of&#160;objects&#160;as&#160;octopuses&#160;with&#160;any&#160;number<br/>of&#160;tentacles,&#160;each&#160;of&#160;which&#160;has&#160;a&#160;name&#160;tattooed&#160;on&#160;it.<br/>
The&#160;delete&#160;operator&#160;cuts&#160;off&#160;a&#160;tentacle&#160;from&#160;such&#160;an&#160;octopus.&#160;It&#160;is&#160;a&#160;unary<br/>
operator&#160;that,&#160;when&#160;applied&#160;to&#160;an&#160;object&#160;property,&#160;will&#160;remove&#160;the&#160;named<br/>property&#160;from&#160;the&#160;object.&#160;This&#160;is&#160;not&#160;a&#160;common&#160;thing&#160;to&#160;do,&#160;but&#160;it&#160;is&#160;possible.<br/>
let&#160;anObject&#160;=&#160;{left:&#160;1,&#160;right:&#160;2};<br/>console.log(anObject.left);<br/>//&#160;→&#160;1<br/>delete&#160;anObject.left;<br/>console.log(anObject.left);<br/>//&#160;→&#160;undefined<br/>console.log(&#34;left&#34;&#160;in&#160;anObject);<br/>//&#160;→&#160;false<br/>console.log(&#34;right&#34;&#160;in&#160;anObject);<br/>//&#160;→&#160;true<br/>
The&#160;binary&#160;in&#160;operator,&#160;when&#160;applied&#160;to&#160;a&#160;string&#160;and&#160;an&#160;object,&#160;tells&#160;you<br/>
whether&#160;that&#160;object&#160;has&#160;a&#160;property&#160;with&#160;that&#160;name.&#160;The&#160;difference&#160;between<br/>setting&#160;a&#160;property&#160;to&#160;undefined&#160;and&#160;actually&#160;deleting&#160;it&#160;is&#160;that,&#160;in&#160;the&#160;first<br/>case,&#160;the&#160;object&#160;still&#160;<i>has&#160;</i>the&#160;property&#160;(it&#160;just&#160;doesn’t&#160;have&#160;a&#160;very&#160;interesting<br/>value),&#160;whereas&#160;in&#160;the&#160;second&#160;case&#160;the&#160;property&#160;is&#160;no&#160;longer&#160;present&#160;and&#160;in&#160;will<br/>return&#160;false.<br/>
To&#160;find&#160;out&#160;what&#160;properties&#160;an&#160;object&#160;has,&#160;you&#160;can&#160;use&#160;the&#160;Object.keys<br/>
function.&#160;You&#160;give&#160;it&#160;an&#160;object,&#160;and&#160;it&#160;returns&#160;an&#160;array&#160;of&#160;strings—the&#160;object’s<br/>property&#160;names.<br/>
console.log(Object.keys({x:&#160;0,&#160;y:&#160;0,&#160;z:&#160;2}));<br/>//&#160;→&#160;[&#34;x&#34;,&#160;&#34;y&#34;,&#160;&#34;z&#34;]<br/>
There’s&#160;an&#160;Object.assign&#160;function&#160;that&#160;copies&#160;all&#160;properties&#160;from&#160;one&#160;object<br/>
into&#160;another.<br/>
let&#160;objectA&#160;=&#160;{a:&#160;1,&#160;b:&#160;2};<br/>Object.assign(objectA,&#160;{b:&#160;3,&#160;c:&#160;4});<br/>console.log(objectA);<br/>//&#160;→&#160;{a:&#160;1,&#160;b:&#160;3,&#160;c:&#160;4}<br/>
62<br/>
<hr/>
<a name=75></a>Arrays,&#160;then,&#160;are&#160;just&#160;a&#160;kind&#160;of&#160;object&#160;specialized&#160;for&#160;storing&#160;sequences&#160;of<br/>
things.&#160;If&#160;you&#160;evaluate&#160;typeof&#160;[],&#160;it&#160;produces&#160;&#34;object&#34;.&#160;You&#160;can&#160;see&#160;them&#160;as<br/>long,&#160;flat&#160;octopuses&#160;with&#160;all&#160;their&#160;tentacles&#160;in&#160;a&#160;neat&#160;row,&#160;labeled&#160;with&#160;numbers.<br/>
We&#160;will&#160;represent&#160;the&#160;journal&#160;that&#160;Jacques&#160;keeps&#160;as&#160;an&#160;array&#160;of&#160;objects.<br/>
let&#160;journal&#160;=&#160;[<br/>
{events:&#160;[&#34;work&#34;,&#160;&#34;touched&#160;tree&#34;,&#160;&#34;pizza&#34;,<br/>
&#34;running&#34;,&#160;&#34;television&#34;],<br/>
squirrel:&#160;false},<br/>
{events:&#160;[&#34;work&#34;,&#160;&#34;ice&#160;cream&#34;,&#160;&#34;cauliflower&#34;,<br/>
&#34;lasagna&#34;,&#160;&#34;touched&#160;tree&#34;,&#160;&#34;brushed&#160;teeth&#34;],<br/>
squirrel:&#160;false},<br/>
{events:&#160;[&#34;weekend&#34;,&#160;&#34;cycling&#34;,&#160;&#34;break&#34;,&#160;&#34;peanuts&#34;,<br/>
&#34;beer&#34;],<br/>
squirrel:&#160;true},<br/>
/*&#160;and&#160;so&#160;on...&#160;*/<br/>
];<br/>
<b>Mutability</b><br/>
We&#160;will&#160;get&#160;to&#160;actual&#160;programming&#160;<i>real&#160;</i>soon&#160;now.&#160;First&#160;there’s&#160;one&#160;more&#160;piece<br/>of&#160;theory&#160;to&#160;understand.<br/>
We&#160;saw&#160;that&#160;object&#160;values&#160;can&#160;be&#160;modified.&#160;The&#160;types&#160;of&#160;values&#160;discussed&#160;in<br/>
earlier&#160;chapters,&#160;such&#160;as&#160;numbers,&#160;strings,&#160;and&#160;Booleans,&#160;are&#160;all&#160;<i>immutable</i>—it<br/>is&#160;impossible&#160;to&#160;change&#160;values&#160;of&#160;those&#160;types.&#160;You&#160;can&#160;combine&#160;them&#160;and&#160;derive<br/>new&#160;values&#160;from&#160;them,&#160;but&#160;when&#160;you&#160;take&#160;a&#160;specific&#160;string&#160;value,&#160;that&#160;value<br/>will&#160;always&#160;remain&#160;the&#160;same.&#160;The&#160;text&#160;inside&#160;it&#160;cannot&#160;be&#160;changed.&#160;If&#160;you<br/>have&#160;a&#160;string&#160;that&#160;contains&#160;&#34;cat&#34;,&#160;it&#160;is&#160;not&#160;possible&#160;for&#160;other&#160;code&#160;to&#160;change&#160;a<br/>character&#160;in&#160;your&#160;string&#160;to&#160;make&#160;it&#160;spell&#160;&#34;rat&#34;.<br/>
Objects&#160;work&#160;differently.&#160;You&#160;<i>can&#160;</i>change&#160;their&#160;properties,&#160;causing&#160;a&#160;single<br/>
object&#160;value&#160;to&#160;have&#160;different&#160;content&#160;at&#160;different&#160;times.<br/>
When&#160;we&#160;have&#160;two&#160;numbers,&#160;120&#160;and&#160;120,&#160;we&#160;can&#160;consider&#160;them&#160;precisely<br/>
the&#160;same&#160;number,&#160;whether&#160;or&#160;not&#160;they&#160;refer&#160;to&#160;the&#160;same&#160;physical&#160;bits.&#160;With<br/>objects,&#160;there&#160;is&#160;a&#160;difference&#160;between&#160;having&#160;two&#160;references&#160;to&#160;the&#160;same&#160;object<br/>and&#160;having&#160;two&#160;different&#160;objects&#160;that&#160;contain&#160;the&#160;same&#160;properties.&#160;Consider<br/>the&#160;following&#160;code:<br/>
let&#160;object1&#160;=&#160;{value:&#160;10};<br/>let&#160;object2&#160;=&#160;object1;<br/>let&#160;object3&#160;=&#160;{value:&#160;10};<br/>
63<br/>
<hr/>
<a name=76></a>console.log(object1&#160;==&#160;object2);<br/>//&#160;→&#160;true<br/>console.log(object1&#160;==&#160;object3);<br/>//&#160;→&#160;false<br/>
object1.value&#160;=&#160;15;<br/>console.log(object2.value);<br/>//&#160;→&#160;15<br/>console.log(object3.value);<br/>//&#160;→&#160;10<br/>
The&#160;object1&#160;and&#160;object2&#160;bindings&#160;grasp&#160;the&#160;<i>same&#160;</i>object,&#160;which&#160;is&#160;why<br/>
changing&#160;object1&#160;also&#160;changes&#160;the&#160;value&#160;of&#160;object2.&#160;They&#160;are&#160;said&#160;to&#160;have&#160;the<br/>same&#160;<i>identity</i>.&#160;The&#160;binding&#160;object3&#160;points&#160;to&#160;a&#160;different&#160;object,&#160;which&#160;initially<br/>contains&#160;the&#160;same&#160;properties&#160;as&#160;object1&#160;but&#160;lives&#160;a&#160;separate&#160;life.<br/>
Bindings&#160;can&#160;also&#160;be&#160;changeable&#160;or&#160;constant,&#160;but&#160;this&#160;is&#160;separate&#160;from&#160;the<br/>
way&#160;their&#160;values&#160;behave.&#160;Even&#160;though&#160;number&#160;values&#160;don’t&#160;change,&#160;you&#160;can<br/>use&#160;a&#160;let&#160;binding&#160;to&#160;keep&#160;track&#160;of&#160;a&#160;changing&#160;number&#160;by&#160;changing&#160;the&#160;value<br/>the&#160;binding&#160;points&#160;at.&#160;Similarly,&#160;though&#160;a&#160;const&#160;binding&#160;to&#160;an&#160;object&#160;can&#160;itself<br/>not&#160;be&#160;changed&#160;and&#160;will&#160;continue&#160;to&#160;point&#160;at&#160;the&#160;same&#160;object,&#160;the&#160;<i>contents&#160;</i>of<br/>that&#160;object&#160;might&#160;change.<br/>
const&#160;score&#160;=&#160;{visitors:&#160;0,&#160;home:&#160;0};<br/>//&#160;This&#160;is&#160;okay<br/>score.visitors&#160;=&#160;1;<br/>//&#160;This&#160;isn't&#160;allowed<br/>score&#160;=&#160;{visitors:&#160;1,&#160;home:&#160;1};<br/>
When&#160;you&#160;compare&#160;objects&#160;with&#160;JavaScript’s&#160;==&#160;operator,&#160;it&#160;compares&#160;by<br/>
identity:&#160;it&#160;will&#160;produce&#160;true&#160;only&#160;if&#160;both&#160;objects&#160;are&#160;precisely&#160;the&#160;same&#160;value.<br/>Comparing&#160;different&#160;objects&#160;will&#160;return&#160;false,&#160;even&#160;if&#160;they&#160;have&#160;identical&#160;prop-<br/>erties.&#160;There&#160;is&#160;no&#160;“deep”&#160;comparison&#160;operation&#160;built&#160;into&#160;JavaScript,&#160;which<br/>compares&#160;objects&#160;by&#160;contents,&#160;but&#160;it&#160;is&#160;possible&#160;to&#160;write&#160;it&#160;yourself&#160;(which&#160;is<br/>one&#160;of&#160;the&#160;<a href="eloquent-javascripts.html#92">exercises&#160;</a>at&#160;the&#160;end&#160;of&#160;this&#160;chapter).<br/>
<b>The&#160;lycanthrope's&#160;log</b><br/>
So,&#160;Jacques&#160;starts&#160;up&#160;his&#160;JavaScript&#160;interpreter&#160;and&#160;sets&#160;up&#160;the&#160;environment<br/>he&#160;needs&#160;to&#160;keep&#160;his&#160;journal.<br/>
let&#160;journal&#160;=&#160;[];<br/>
64<br/>
<hr/>
<a name=77></a>function&#160;addEntry(events,&#160;squirrel)&#160;{<br/>
journal.push({events,&#160;squirrel});<br/>
}<br/>
Note&#160;that&#160;the&#160;object&#160;added&#160;to&#160;the&#160;journal&#160;looks&#160;a&#160;little&#160;odd.&#160;Instead&#160;of<br/>
declaring&#160;properties&#160;like&#160;events:&#160;events,&#160;it&#160;just&#160;gives&#160;a&#160;property&#160;name.&#160;This<br/>is&#160;shorthand&#160;that&#160;means&#160;the&#160;same&#160;thing—if&#160;a&#160;property&#160;name&#160;in&#160;brace&#160;notation<br/>isn’t&#160;followed&#160;by&#160;a&#160;value,&#160;its&#160;value&#160;is&#160;taken&#160;from&#160;the&#160;binding&#160;with&#160;the&#160;same<br/>name.<br/>
So&#160;then,&#160;every&#160;evening&#160;at&#160;10&#160;p.m.—or&#160;sometimes&#160;the&#160;next&#160;morning,&#160;after<br/>
climbing&#160;down&#160;from&#160;the&#160;top&#160;shelf&#160;of&#160;his&#160;bookcase—Jacques&#160;records&#160;the&#160;day.<br/>
addEntry([&#34;work&#34;,&#160;&#34;touched&#160;tree&#34;,&#160;&#34;pizza&#34;,&#160;&#34;running&#34;,<br/>
&#34;television&#34;],&#160;false);<br/>
addEntry([&#34;work&#34;,&#160;&#34;ice&#160;cream&#34;,&#160;&#34;cauliflower&#34;,&#160;&#34;lasagna&#34;,<br/>
&#34;touched&#160;tree&#34;,&#160;&#34;brushed&#160;teeth&#34;],&#160;false);<br/>
addEntry([&#34;weekend&#34;,&#160;&#34;cycling&#34;,&#160;&#34;break&#34;,&#160;&#34;peanuts&#34;,<br/>
&#34;beer&#34;],&#160;true);<br/>
Once&#160;he&#160;has&#160;enough&#160;data&#160;points,&#160;he&#160;intends&#160;to&#160;use&#160;statistics&#160;to&#160;find&#160;out&#160;which<br/>
of&#160;these&#160;events&#160;may&#160;be&#160;related&#160;to&#160;the&#160;squirrelifications.<br/>
<i>Correlation&#160;</i>is&#160;a&#160;measure&#160;of&#160;dependence&#160;between&#160;statistical&#160;variables.&#160;A&#160;sta-<br/>
tistical&#160;variable&#160;is&#160;not&#160;quite&#160;the&#160;same&#160;as&#160;a&#160;programming&#160;variable.&#160;In&#160;statistics<br/>you&#160;typically&#160;have&#160;a&#160;set&#160;of&#160;<i>measurements</i>,&#160;and&#160;each&#160;variable&#160;is&#160;measured&#160;for<br/>every&#160;measurement.&#160;Correlation&#160;between&#160;variables&#160;is&#160;usually&#160;expressed&#160;as&#160;a<br/>value&#160;that&#160;ranges&#160;from&#160;-1&#160;to&#160;1.&#160;Zero&#160;correlation&#160;means&#160;the&#160;variables&#160;are&#160;not<br/>related.&#160;A&#160;correlation&#160;of&#160;one&#160;indicates&#160;that&#160;the&#160;two&#160;are&#160;perfectly&#160;related—if<br/>you&#160;know&#160;one,&#160;you&#160;also&#160;know&#160;the&#160;other.&#160;Negative&#160;one&#160;also&#160;means&#160;that&#160;the<br/>variables&#160;are&#160;perfectly&#160;related&#160;but&#160;that&#160;they&#160;are&#160;opposites—when&#160;one&#160;is&#160;true,<br/>the&#160;other&#160;is&#160;false.<br/>
To&#160;compute&#160;the&#160;measure&#160;of&#160;correlation&#160;between&#160;two&#160;Boolean&#160;variables,&#160;we<br/>
can&#160;use&#160;the&#160;<i>phi&#160;coefficient&#160;</i>(<i>φ</i>).&#160;This&#160;is&#160;a&#160;formula&#160;whose&#160;input&#160;is&#160;a&#160;frequency<br/>table&#160;containing&#160;the&#160;number&#160;of&#160;times&#160;the&#160;different&#160;combinations&#160;of&#160;the&#160;variables<br/>were&#160;observed.&#160;The&#160;output&#160;of&#160;the&#160;formula&#160;is&#160;a&#160;number&#160;between&#160;-1&#160;and&#160;1&#160;that<br/>describes&#160;the&#160;correlation.<br/>
We&#160;could&#160;take&#160;the&#160;event&#160;of&#160;eating&#160;pizza&#160;and&#160;put&#160;that&#160;in&#160;a&#160;frequency&#160;table<br/>
like&#160;this,&#160;where&#160;each&#160;number&#160;indicates&#160;the&#160;amount&#160;of&#160;times&#160;that&#160;combination<br/>occurred&#160;in&#160;our&#160;measurements:<br/>
65<br/>
<hr/>
<a name=78></a>No squirrel, no pizza76<br/>
No squirrel, pizza<br/>
9<br/>
Squirrel, no pizza<br/>
4&#160;Squirrel, pizza<br/>
1<br/>
If&#160;we&#160;call&#160;that&#160;table&#160;<i>n</i>,&#160;we&#160;can&#160;compute&#160;<i>φ&#160;</i>using&#160;the&#160;following&#160;formula:<br/>
<i>n</i>11<i>n</i>00&#160;<i>−&#160;n</i>10<i>n</i>01<br/>
<i>φ&#160;</i>=&#160;<i>√</i><br/>
(4.1)<br/>
<i>n</i>1<i>•n</i>0<i>•n•</i>1<i>n•</i>0<br/>
(If&#160;at&#160;this&#160;point&#160;you’re&#160;putting&#160;the&#160;book&#160;down&#160;to&#160;focus&#160;on&#160;a&#160;terrible&#160;flashback<br/>
to&#160;10th&#160;grade&#160;math&#160;class—hold&#160;on!&#160;I&#160;do&#160;not&#160;intend&#160;to&#160;torture&#160;you&#160;with&#160;endless<br/>pages&#160;of&#160;cryptic&#160;notation—it’s&#160;just&#160;this&#160;one&#160;formula&#160;for&#160;now.&#160;And&#160;even&#160;with<br/>this&#160;one,&#160;all&#160;we&#160;do&#160;is&#160;turn&#160;it&#160;into&#160;JavaScript.)<br/>
The&#160;notation&#160;<i>n</i>01&#160;indicates&#160;the&#160;number&#160;of&#160;measurements&#160;where&#160;the&#160;first&#160;vari-<br/>
able&#160;(squirrelness)&#160;is&#160;false&#160;(0)&#160;and&#160;the&#160;second&#160;variable&#160;(pizza)&#160;is&#160;true&#160;(1).&#160;In<br/>the&#160;pizza&#160;table,&#160;<i>n</i>01&#160;is&#160;9.<br/>
The&#160;value&#160;<i>n</i>1<i>•&#160;</i>refers&#160;to&#160;the&#160;sum&#160;of&#160;all&#160;measurements&#160;where&#160;the&#160;first&#160;variable<br/>
is&#160;true,&#160;which&#160;is&#160;5&#160;in&#160;the&#160;example&#160;table.&#160;Likewise,&#160;<i>n•</i>0&#160;refers&#160;to&#160;the&#160;sum&#160;of&#160;the<br/>measurements&#160;where&#160;the&#160;second&#160;variable&#160;is&#160;false.<br/>
So&#160;for&#160;the&#160;pizza&#160;table,&#160;the&#160;part&#160;above&#160;the&#160;division&#160;line&#160;(the&#160;dividend)&#160;would<br/>
be&#160;1×76−4×9&#160;=&#160;40,&#160;and&#160;the&#160;part&#160;below&#160;it&#160;(the&#160;divisor)&#160;would&#160;be&#160;the&#160;square<br/>
<i>√</i><br/>
root&#160;of&#160;5×85×10×80,&#160;or<br/>
340000.&#160;This&#160;comes&#160;out&#160;to&#160;<i>φ&#160;≈&#160;</i>0.069,&#160;which&#160;is&#160;tiny.<br/>
Eating&#160;pizza&#160;does&#160;not&#160;appear&#160;to&#160;have&#160;influence&#160;on&#160;the&#160;transformations.<br/>
<b>Computing&#160;correlation</b><br/>
We&#160;can&#160;represent&#160;a&#160;two-by-two&#160;table&#160;in&#160;JavaScript&#160;with&#160;a&#160;four-element&#160;array<br/>([76,&#160;9,&#160;4,&#160;1]).&#160;We&#160;could&#160;also&#160;use&#160;other&#160;representations,&#160;such&#160;as&#160;an&#160;array&#160;con-<br/>taining&#160;two&#160;two-element&#160;arrays&#160;([[76,&#160;9],&#160;[4,&#160;1]])&#160;or&#160;an&#160;object&#160;with&#160;property<br/>names&#160;like&#160;&#34;11&#34;&#160;and&#160;&#34;01&#34;,&#160;but&#160;the&#160;flat&#160;array&#160;is&#160;simple&#160;and&#160;makes&#160;the&#160;expres-<br/>sions&#160;that&#160;access&#160;the&#160;table&#160;pleasantly&#160;short.&#160;We’ll&#160;interpret&#160;the&#160;indices&#160;to&#160;the<br/>array&#160;as&#160;two-bit&#160;binary&#160;numbers,&#160;where&#160;the&#160;leftmost&#160;(most&#160;significant)&#160;digit<br/>refers&#160;to&#160;the&#160;squirrel&#160;variable&#160;and&#160;the&#160;rightmost&#160;(least&#160;significant)&#160;digit&#160;refers<br/>to&#160;the&#160;event&#160;variable.&#160;For&#160;example,&#160;the&#160;binary&#160;number&#160;10&#160;refers&#160;to&#160;the&#160;case<br/>
66<br/>
<hr/>
<a name=79></a>where&#160;Jacques&#160;did&#160;turn&#160;into&#160;a&#160;squirrel,&#160;but&#160;the&#160;event&#160;(say,&#160;“pizza”)&#160;didn’t&#160;oc-<br/>cur.&#160;This&#160;happened&#160;four&#160;times.&#160;And&#160;since&#160;binary&#160;10&#160;is&#160;2&#160;in&#160;decimal&#160;notation,<br/>we&#160;will&#160;store&#160;this&#160;number&#160;at&#160;index&#160;2&#160;of&#160;the&#160;array.<br/>
This&#160;is&#160;the&#160;function&#160;that&#160;computes&#160;the&#160;<i>φ&#160;</i>coefficient&#160;from&#160;such&#160;an&#160;array:<br/>
function&#160;phi(table)&#160;{<br/>
return&#160;(table[3]&#160;*&#160;table[0]&#160;-&#160;table[2]&#160;*&#160;table[1])&#160;/<br/>
Math.sqrt((table[2]&#160;+&#160;table[3])&#160;*<br/>
(table[0]&#160;+&#160;table[1])&#160;*<br/>(table[1]&#160;+&#160;table[3])&#160;*<br/>(table[0]&#160;+&#160;table[2]));<br/>
}<br/>
console.log(phi([76,&#160;9,&#160;4,&#160;1]));<br/>//&#160;→&#160;0.068599434<br/>
This&#160;is&#160;a&#160;direct&#160;translation&#160;of&#160;the&#160;<i>φ&#160;</i>formula&#160;into&#160;JavaScript.&#160;Math.sqrt<br/>
is&#160;the&#160;square&#160;root&#160;function,&#160;as&#160;provided&#160;by&#160;the&#160;Math&#160;object&#160;in&#160;a&#160;standard<br/>
JavaScript&#160;environment.&#160;We&#160;have&#160;to&#160;add&#160;two&#160;fields&#160;from&#160;the&#160;table&#160;to&#160;get&#160;fields<br/>like&#160;<i>n</i>1<i>•&#160;</i>because&#160;the&#160;sums&#160;of&#160;rows&#160;or&#160;columns&#160;are&#160;not&#160;stored&#160;directly&#160;in&#160;our&#160;data<br/>structure.<br/>
Jacques&#160;kept&#160;his&#160;journal&#160;for&#160;three&#160;months.&#160;The&#160;resulting&#160;data&#160;set&#160;is&#160;available<br/>
in&#160;the&#160;<a href="https://eloquentjavascript.net/code#4">coding&#160;sandbox&#160;</a>for&#160;this&#160;chapter&#160;<a href="https://eloquentjavascript.net/code#4">(<i>https://eloquentjavascript.net/code#4</i></a>),<br/>where&#160;it&#160;is&#160;stored&#160;in&#160;the&#160;JOURNAL&#160;binding&#160;and&#160;in&#160;a&#160;downloadable&#160;<a href="https://eloquentjavascript.net/code/journal.js">file</a>.<br/>
To&#160;extract&#160;a&#160;two-by-two&#160;table&#160;for&#160;a&#160;specific&#160;event&#160;from&#160;the&#160;journal,&#160;we&#160;must<br/>
loop&#160;over&#160;all&#160;the&#160;entries&#160;and&#160;tally&#160;how&#160;many&#160;times&#160;the&#160;event&#160;occurs&#160;in&#160;relation<br/>to&#160;squirrel&#160;transformations.<br/>
function&#160;tableFor(event,&#160;journal)&#160;{<br/>
let&#160;table&#160;=&#160;[0,&#160;0,&#160;0,&#160;0];<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;journal.length;&#160;i++)&#160;{<br/>
let&#160;entry&#160;=&#160;journal[i],&#160;index&#160;=&#160;0;<br/>if&#160;(entry.events.includes(event))&#160;index&#160;+=&#160;1;<br/>if&#160;(entry.squirrel)&#160;index&#160;+=&#160;2;<br/>table[index]&#160;+=&#160;1;<br/>
}<br/>return&#160;table;<br/>
}<br/>
console.log(tableFor(&#34;pizza&#34;,&#160;JOURNAL));<br/>//&#160;→&#160;[76,&#160;9,&#160;4,&#160;1]<br/>
67<br/>
<hr/>
<a name=80></a>Arrays&#160;have&#160;an&#160;includes&#160;method&#160;that&#160;checks&#160;whether&#160;a&#160;given&#160;value&#160;exists&#160;in<br/>
the&#160;array.&#160;The&#160;function&#160;uses&#160;that&#160;to&#160;determine&#160;whether&#160;the&#160;event&#160;name&#160;it&#160;is<br/>interested&#160;in&#160;is&#160;part&#160;of&#160;the&#160;event&#160;list&#160;for&#160;a&#160;given&#160;day.<br/>
The&#160;body&#160;of&#160;the&#160;loop&#160;in&#160;tableFor&#160;figures&#160;out&#160;which&#160;box&#160;in&#160;the&#160;table&#160;each<br/>
journal&#160;entry&#160;falls&#160;into&#160;by&#160;checking&#160;whether&#160;the&#160;entry&#160;contains&#160;the&#160;specific&#160;event<br/>it’s&#160;interested&#160;in&#160;and&#160;whether&#160;the&#160;event&#160;happens&#160;alongside&#160;a&#160;squirrel&#160;incident.<br/>The&#160;loop&#160;then&#160;adds&#160;one&#160;to&#160;the&#160;correct&#160;box&#160;in&#160;the&#160;table.<br/>
We&#160;now&#160;have&#160;the&#160;tools&#160;we&#160;need&#160;to&#160;compute&#160;individual&#160;correlations.&#160;The&#160;only<br/>
step&#160;remaining&#160;is&#160;to&#160;find&#160;a&#160;correlation&#160;for&#160;every&#160;type&#160;of&#160;event&#160;that&#160;was&#160;recorded<br/>and&#160;see&#160;whether&#160;anything&#160;stands&#160;out.<br/>
<b>Array&#160;loops</b><br/>
In&#160;the&#160;tableFor&#160;function,&#160;there’s&#160;a&#160;loop&#160;like&#160;this:<br/>
for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;JOURNAL.length;&#160;i++)&#160;{<br/>
let&#160;entry&#160;=&#160;JOURNAL[i];<br/>//&#160;Do&#160;something&#160;with&#160;entry<br/>
}<br/>
This&#160;kind&#160;of&#160;loop&#160;is&#160;common&#160;in&#160;classical&#160;JavaScript—going&#160;over&#160;arrays&#160;one<br/>
element&#160;at&#160;a&#160;time&#160;is&#160;something&#160;that&#160;comes&#160;up&#160;a&#160;lot,&#160;and&#160;to&#160;do&#160;that&#160;you’d&#160;run<br/>a&#160;counter&#160;over&#160;the&#160;length&#160;of&#160;the&#160;array&#160;and&#160;pick&#160;out&#160;each&#160;element&#160;in&#160;turn.<br/>
There&#160;is&#160;a&#160;simpler&#160;way&#160;to&#160;write&#160;such&#160;loops&#160;in&#160;modern&#160;JavaScript.<br/>
for&#160;(let&#160;entry&#160;of&#160;JOURNAL)&#160;{<br/>
console.log(`${entry.events.length}&#160;events.`);<br/>
}<br/>
When&#160;a&#160;for&#160;loop&#160;looks&#160;like&#160;this,&#160;with&#160;the&#160;word&#160;of&#160;after&#160;a&#160;variable&#160;definition,<br/>
it&#160;will&#160;loop&#160;over&#160;the&#160;elements&#160;of&#160;the&#160;value&#160;given&#160;after&#160;of.&#160;This&#160;works&#160;not&#160;only<br/>for&#160;arrays&#160;but&#160;also&#160;for&#160;strings&#160;and&#160;some&#160;other&#160;data&#160;structures.&#160;We’ll&#160;discuss<br/><i>how&#160;</i>it&#160;works&#160;in&#160;<a href="eloquent-javascripts.html#109">Chapter&#160;6.</a><br/>
<b>The&#160;final&#160;analysis</b><br/>
We&#160;need&#160;to&#160;compute&#160;a&#160;correlation&#160;for&#160;every&#160;type&#160;of&#160;event&#160;that&#160;occurs&#160;in&#160;the<br/>data&#160;set.&#160;To&#160;do&#160;that,&#160;we&#160;first&#160;need&#160;to&#160;<i>find&#160;</i>every&#160;type&#160;of&#160;event.<br/>
function&#160;journalEvents(journal)&#160;{<br/>
68<br/>
<hr/>
<a name=81></a>let&#160;events&#160;=&#160;[];<br/>for&#160;(let&#160;entry&#160;of&#160;journal)&#160;{<br/>
for&#160;(let&#160;event&#160;of&#160;entry.events)&#160;{<br/>
if&#160;(!events.includes(event))&#160;{<br/>
events.push(event);<br/>
}<br/>
}<br/>
}<br/>return&#160;events;<br/>
}<br/>
console.log(journalEvents(JOURNAL));<br/>//&#160;→&#160;[&#34;carrot&#34;,&#160;&#34;exercise&#34;,&#160;&#34;weekend&#34;,&#160;&#34;bread&#34;,&#160;…]<br/>
By&#160;going&#160;over&#160;all&#160;the&#160;events&#160;and&#160;adding&#160;those&#160;that&#160;aren’t&#160;already&#160;in&#160;there&#160;to<br/>
the&#160;events&#160;array,&#160;the&#160;function&#160;collects&#160;every&#160;type&#160;of&#160;event.<br/>
Using&#160;that,&#160;we&#160;can&#160;see&#160;all&#160;the&#160;correlations.<br/>
for&#160;(let&#160;event&#160;of&#160;journalEvents(JOURNAL))&#160;{<br/>
console.log(event&#160;+&#160;&#34;:&#34;,&#160;phi(tableFor(event,&#160;JOURNAL)));<br/>
}<br/>//&#160;→&#160;carrot:<br/>
0.0140970969<br/>
//&#160;→&#160;exercise:&#160;0.0685994341<br/>//&#160;→&#160;weekend:<br/>
0.1371988681<br/>
//&#160;→&#160;bread:<br/>
-0.0757554019<br/>
//&#160;→&#160;pudding:&#160;-0.0648203724<br/>//&#160;and&#160;so&#160;on...<br/>
Most&#160;correlations&#160;seem&#160;to&#160;lie&#160;close&#160;to&#160;zero.&#160;Eating&#160;carrots,&#160;bread,&#160;or&#160;pudding<br/>
apparently&#160;does&#160;not&#160;trigger&#160;squirrel-lycanthropy.&#160;It&#160;<i>does&#160;</i>seem&#160;to&#160;occur&#160;some-<br/>what&#160;more&#160;often&#160;on&#160;weekends.&#160;Let’s&#160;filter&#160;the&#160;results&#160;to&#160;show&#160;only&#160;correlations<br/>greater&#160;than&#160;0.1&#160;or&#160;less&#160;than&#160;-0.1.<br/>
for&#160;(let&#160;event&#160;of&#160;journalEvents(JOURNAL))&#160;{<br/>
let&#160;correlation&#160;=&#160;phi(tableFor(event,&#160;JOURNAL));<br/>if&#160;(correlation&#160;&gt;&#160;0.1&#160;||&#160;correlation&#160;&lt;&#160;-0.1)&#160;{<br/>
console.log(event&#160;+&#160;&#34;:&#34;,&#160;correlation);<br/>
}<br/>
}<br/>//&#160;→&#160;weekend:<br/>
0.1371988681<br/>
//&#160;→&#160;brushed&#160;teeth:&#160;-0.3805211953<br/>//&#160;→&#160;candy:<br/>
0.1296407447<br/>
//&#160;→&#160;work:<br/>
-0.1371988681<br/>
69<br/>
<hr/>
<a name=82></a>//&#160;→&#160;spaghetti:<br/>
0.2425356250<br/>
//&#160;→&#160;reading:<br/>
0.1106828054<br/>
//&#160;→&#160;peanuts:<br/>
0.5902679812<br/>
Aha!&#160;There&#160;are&#160;two&#160;factors&#160;with&#160;a&#160;correlation&#160;that’s&#160;clearly&#160;stronger&#160;than<br/>
the&#160;others.&#160;Eating&#160;peanuts&#160;has&#160;a&#160;strong&#160;positive&#160;effect&#160;on&#160;the&#160;chance&#160;of&#160;turning<br/>into&#160;a&#160;squirrel,&#160;whereas&#160;brushing&#160;his&#160;teeth&#160;has&#160;a&#160;significant&#160;negative&#160;effect.<br/>
Interesting.&#160;Let’s&#160;try&#160;something.<br/>
for&#160;(let&#160;entry&#160;of&#160;JOURNAL)&#160;{<br/>
if&#160;(entry.events.includes(&#34;peanuts&#34;)&#160;&amp;&amp;<br/>
!entry.events.includes(&#34;brushed&#160;teeth&#34;))&#160;{<br/>
entry.events.push(&#34;peanut&#160;teeth&#34;);<br/>
}<br/>
}<br/>console.log(phi(tableFor(&#34;peanut&#160;teeth&#34;,&#160;JOURNAL)));<br/>//&#160;→&#160;1<br/>
That’s&#160;a&#160;strong&#160;result.&#160;The&#160;phenomenon&#160;occurs&#160;precisely&#160;when&#160;Jacques&#160;eats<br/>
peanuts&#160;and&#160;fails&#160;to&#160;brush&#160;his&#160;teeth.&#160;If&#160;only&#160;he&#160;weren’t&#160;such&#160;a&#160;slob&#160;about&#160;dental<br/>hygiene,&#160;he’d&#160;have&#160;never&#160;even&#160;noticed&#160;his&#160;affliction.<br/>
Knowing&#160;this,&#160;Jacques&#160;stops&#160;eating&#160;peanuts&#160;altogether&#160;and&#160;finds&#160;that&#160;his<br/>
transformations&#160;don’t&#160;come&#160;back.<br/>
For&#160;a&#160;few&#160;years,&#160;things&#160;go&#160;great&#160;for&#160;Jacques.&#160;But&#160;at&#160;some&#160;point&#160;he&#160;loses&#160;his<br/>
job.&#160;Because&#160;he&#160;lives&#160;in&#160;a&#160;nasty&#160;country&#160;where&#160;having&#160;no&#160;job&#160;means&#160;having<br/>no&#160;medical&#160;services,&#160;he&#160;is&#160;forced&#160;to&#160;take&#160;employment&#160;with&#160;a&#160;circus&#160;where&#160;he<br/>performs&#160;as&#160;<i>The&#160;Incredible&#160;Squirrelman</i>,&#160;stuffing&#160;his&#160;mouth&#160;with&#160;peanut&#160;butter<br/>before&#160;every&#160;show.<br/>
One&#160;day,&#160;fed&#160;up&#160;with&#160;this&#160;pitiful&#160;existence,&#160;Jacques&#160;fails&#160;to&#160;change&#160;back&#160;into<br/>
his&#160;human&#160;form,&#160;hops&#160;through&#160;a&#160;crack&#160;in&#160;the&#160;circus&#160;tent,&#160;and&#160;vanishes&#160;into&#160;the<br/>forest.&#160;He&#160;is&#160;never&#160;seen&#160;again.<br/>
<b>Further&#160;arrayology</b><br/>
Before&#160;finishing&#160;the&#160;chapter,&#160;I&#160;want&#160;to&#160;introduce&#160;you&#160;to&#160;a&#160;few&#160;more&#160;object-<br/>related&#160;concepts.&#160;I’ll&#160;start&#160;by&#160;introducing&#160;some&#160;generally&#160;useful&#160;array&#160;methods.<br/>
We&#160;saw&#160;push&#160;and&#160;pop,&#160;which&#160;add&#160;and&#160;remove&#160;elements&#160;at&#160;the&#160;end&#160;of&#160;an&#160;array,<br/>
<a href="eloquent-javascripts.html#72">earlier&#160;</a>in&#160;this&#160;chapter.&#160;The&#160;corresponding&#160;methods&#160;for&#160;adding&#160;and&#160;removing<br/>things&#160;at&#160;the&#160;start&#160;of&#160;an&#160;array&#160;are&#160;called&#160;unshift&#160;and&#160;shift.<br/>
70<br/>
<hr/>
<a name=83></a>let&#160;todoList&#160;=&#160;[];<br/>function&#160;remember(task)&#160;{<br/>
todoList.push(task);<br/>
}<br/>function&#160;getTask()&#160;{<br/>
return&#160;todoList.shift();<br/>
}<br/>function&#160;rememberUrgently(task)&#160;{<br/>
todoList.unshift(task);<br/>
}<br/>
That&#160;program&#160;manages&#160;a&#160;queue&#160;of&#160;tasks.&#160;You&#160;add&#160;tasks&#160;to&#160;the&#160;end&#160;of&#160;the<br/>
queue&#160;by&#160;calling&#160;remember(&#34;groceries&#34;),&#160;and&#160;when&#160;you’re&#160;ready&#160;to&#160;do&#160;some-<br/>thing,&#160;you&#160;call&#160;getTask()&#160;to&#160;get&#160;(and&#160;remove)&#160;the&#160;front&#160;item&#160;from&#160;the&#160;queue.<br/>The&#160;rememberUrgently&#160;function&#160;also&#160;adds&#160;a&#160;task&#160;but&#160;adds&#160;it&#160;to&#160;the&#160;front&#160;instead<br/>of&#160;the&#160;back&#160;of&#160;the&#160;queue.<br/>
To&#160;search&#160;for&#160;a&#160;specific&#160;value,&#160;arrays&#160;provide&#160;an&#160;indexOf&#160;method.&#160;The&#160;method<br/>
searches&#160;through&#160;the&#160;array&#160;from&#160;the&#160;start&#160;to&#160;the&#160;end&#160;and&#160;returns&#160;the&#160;index&#160;at<br/>which&#160;the&#160;requested&#160;value&#160;was&#160;found—or&#160;-1&#160;if&#160;it&#160;wasn’t&#160;found.&#160;To&#160;search&#160;from<br/>the&#160;end&#160;instead&#160;of&#160;the&#160;start,&#160;there’s&#160;a&#160;similar&#160;method&#160;called&#160;lastIndexOf.<br/>
console.log([1,&#160;2,&#160;3,&#160;2,&#160;1].indexOf(2));<br/>//&#160;→&#160;1<br/>console.log([1,&#160;2,&#160;3,&#160;2,&#160;1].lastIndexOf(2));<br/>//&#160;→&#160;3<br/>
Both&#160;indexOf&#160;and&#160;lastIndexOf&#160;take&#160;an&#160;optional&#160;second&#160;argument&#160;that&#160;indi-<br/>
cates&#160;where&#160;to&#160;start&#160;searching.<br/>
Another&#160;fundamental&#160;array&#160;method&#160;is&#160;slice,&#160;which&#160;takes&#160;start&#160;and&#160;end&#160;in-<br/>
dices&#160;and&#160;returns&#160;an&#160;array&#160;that&#160;has&#160;only&#160;the&#160;elements&#160;between&#160;them.&#160;The&#160;start<br/>index&#160;is&#160;inclusive,&#160;the&#160;end&#160;index&#160;exclusive.<br/>
console.log([0,&#160;1,&#160;2,&#160;3,&#160;4].slice(2,&#160;4));<br/>//&#160;→&#160;[2,&#160;3]<br/>console.log([0,&#160;1,&#160;2,&#160;3,&#160;4].slice(2));<br/>//&#160;→&#160;[2,&#160;3,&#160;4]<br/>
When&#160;the&#160;end&#160;index&#160;is&#160;not&#160;given,&#160;slice&#160;will&#160;take&#160;all&#160;of&#160;the&#160;elements&#160;after&#160;the<br/>
start&#160;index.&#160;You&#160;can&#160;also&#160;omit&#160;the&#160;start&#160;index&#160;to&#160;copy&#160;the&#160;entire&#160;array.<br/>
The&#160;concat&#160;method&#160;can&#160;be&#160;used&#160;to&#160;glue&#160;arrays&#160;together&#160;to&#160;create&#160;a&#160;new&#160;array,<br/>
similar&#160;to&#160;what&#160;the&#160;+&#160;operator&#160;does&#160;for&#160;strings.<br/>
71<br/>
<hr/>
<a name=84></a>The&#160;following&#160;example&#160;shows&#160;both&#160;concat&#160;and&#160;slice&#160;in&#160;action.&#160;It&#160;takes&#160;an<br/>
array&#160;and&#160;an&#160;index,&#160;and&#160;it&#160;returns&#160;a&#160;new&#160;array&#160;that&#160;is&#160;a&#160;copy&#160;of&#160;the&#160;original<br/>array&#160;with&#160;the&#160;element&#160;at&#160;the&#160;given&#160;index&#160;removed.<br/>
function&#160;remove(array,&#160;index)&#160;{<br/>
return&#160;array.slice(0,&#160;index)<br/>
.concat(array.slice(index&#160;+&#160;1));<br/>
}<br/>console.log(remove([&#34;a&#34;,&#160;&#34;b&#34;,&#160;&#34;c&#34;,&#160;&#34;d&#34;,&#160;&#34;e&#34;],&#160;2));<br/>//&#160;→&#160;[&#34;a&#34;,&#160;&#34;b&#34;,&#160;&#34;d&#34;,&#160;&#34;e&#34;]<br/>
If&#160;you&#160;pass&#160;concat&#160;an&#160;argument&#160;that&#160;is&#160;not&#160;an&#160;array,&#160;that&#160;value&#160;will&#160;be&#160;added<br/>
to&#160;the&#160;new&#160;array&#160;as&#160;if&#160;it&#160;were&#160;a&#160;one-element&#160;array.<br/>
<b>Strings&#160;and&#160;their&#160;properties</b><br/>
We&#160;can&#160;read&#160;properties&#160;like&#160;length&#160;and&#160;toUpperCase&#160;from&#160;string&#160;values.&#160;But&#160;if<br/>you&#160;try&#160;to&#160;add&#160;a&#160;new&#160;property,&#160;it&#160;doesn’t&#160;stick.<br/>
let&#160;kim&#160;=&#160;&#34;Kim&#34;;<br/>kim.age&#160;=&#160;88;<br/>console.log(kim.age);<br/>//&#160;→&#160;undefined<br/>
Values&#160;of&#160;type&#160;string,&#160;number,&#160;and&#160;Boolean&#160;are&#160;not&#160;objects,&#160;and&#160;though<br/>
the&#160;language&#160;doesn’t&#160;complain&#160;if&#160;you&#160;try&#160;to&#160;set&#160;new&#160;properties&#160;on&#160;them,&#160;it<br/>doesn’t&#160;actually&#160;store&#160;those&#160;properties.&#160;As&#160;mentioned&#160;earlier,&#160;such&#160;values&#160;are<br/>immutable&#160;and&#160;cannot&#160;be&#160;changed.<br/>
But&#160;these&#160;types&#160;do&#160;have&#160;built-in&#160;properties.&#160;Every&#160;string&#160;value&#160;has&#160;a&#160;number<br/>
of&#160;methods.&#160;Some&#160;very&#160;useful&#160;ones&#160;are&#160;slice&#160;and&#160;indexOf,&#160;which&#160;resemble&#160;the<br/>array&#160;methods&#160;of&#160;the&#160;same&#160;name.<br/>
console.log(&#34;coconuts&#34;.slice(4,&#160;7));<br/>//&#160;→&#160;nut<br/>console.log(&#34;coconut&#34;.indexOf(&#34;u&#34;));<br/>//&#160;→&#160;5<br/>
One&#160;difference&#160;is&#160;that&#160;a&#160;string’s&#160;indexOf&#160;can&#160;search&#160;for&#160;a&#160;string&#160;containing<br/>
more&#160;than&#160;one&#160;character,&#160;whereas&#160;the&#160;corresponding&#160;array&#160;method&#160;looks&#160;only<br/>for&#160;a&#160;single&#160;element.<br/>
72<br/>
<hr/>
<a name=85></a>console.log(&#34;one&#160;two&#160;three&#34;.indexOf(&#34;ee&#34;));<br/>//&#160;→&#160;11<br/>
The&#160;trim&#160;method&#160;removes&#160;whitespace&#160;(spaces,&#160;newlines,&#160;tabs,&#160;and&#160;similar<br/>
characters)&#160;from&#160;the&#160;start&#160;and&#160;end&#160;of&#160;a&#160;string.<br/>
console.log(&#34;<br/>
okay&#160;\n&#160;&#34;.trim());<br/>
//&#160;→&#160;okay<br/>
The&#160;zeroPad&#160;function&#160;from&#160;the&#160;<a href="eloquent-javascripts.html#51">previous&#160;chapter&#160;</a>also&#160;exists&#160;as&#160;a&#160;method.<br/>
It&#160;is&#160;called&#160;padStart&#160;and&#160;takes&#160;the&#160;desired&#160;length&#160;and&#160;padding&#160;character&#160;as<br/>arguments.<br/>
console.log(String(6).padStart(3,&#160;&#34;0&#34;));<br/>//&#160;→&#160;006<br/>
You&#160;can&#160;split&#160;a&#160;string&#160;on&#160;every&#160;occurrence&#160;of&#160;another&#160;string&#160;with&#160;split&#160;and<br/>
join&#160;it&#160;again&#160;with&#160;join.<br/>
let&#160;sentence&#160;=&#160;&#34;Secretarybirds&#160;specialize&#160;in&#160;stomping&#34;;<br/>let&#160;words&#160;=&#160;sentence.split(&#34;&#160;&#34;);<br/>console.log(words);<br/>//&#160;→&#160;[&#34;Secretarybirds&#34;,&#160;&#34;specialize&#34;,&#160;&#34;in&#34;,&#160;&#34;stomping&#34;]<br/>console.log(words.join(&#34;.&#160;&#34;));<br/>//&#160;→&#160;Secretarybirds.&#160;specialize.&#160;in.&#160;stomping<br/>
A&#160;string&#160;can&#160;be&#160;repeated&#160;with&#160;the&#160;repeat&#160;method,&#160;which&#160;creates&#160;a&#160;new&#160;string<br/>
containing&#160;multiple&#160;copies&#160;of&#160;the&#160;original&#160;string,&#160;glued&#160;together.<br/>
console.log(&#34;LA&#34;.repeat(3));<br/>//&#160;→&#160;LALALA<br/>
We&#160;have&#160;already&#160;seen&#160;the&#160;string&#160;type’s&#160;length&#160;property.&#160;Accessing&#160;the&#160;indi-<br/>
vidual&#160;characters&#160;in&#160;a&#160;string&#160;looks&#160;like&#160;accessing&#160;array&#160;elements&#160;(with&#160;a&#160;caveat<br/>that&#160;we’ll&#160;discuss&#160;in&#160;<a href="eloquent-javascripts.html#104">Chapter&#160;5</a>).<br/>
let&#160;string&#160;=&#160;&#34;abc&#34;;<br/>console.log(string.length);<br/>//&#160;→&#160;3<br/>console.log(string[1]);<br/>//&#160;→&#160;b<br/>
73<br/>
<hr/>
<a name=86></a><b>Rest&#160;parameters</b><br/>
It&#160;can&#160;be&#160;useful&#160;for&#160;a&#160;function&#160;to&#160;accept&#160;any&#160;number&#160;of&#160;arguments.&#160;For&#160;example,<br/>Math.max&#160;computes&#160;the&#160;maximum&#160;of&#160;<i>all&#160;</i>the&#160;arguments&#160;it&#160;is&#160;given.<br/>
To&#160;write&#160;such&#160;a&#160;function,&#160;you&#160;put&#160;three&#160;dots&#160;before&#160;the&#160;function’s&#160;last&#160;pa-<br/>
rameter,&#160;like&#160;this:<br/>
function&#160;max(...numbers)&#160;{<br/>
let&#160;result&#160;=&#160;-Infinity;<br/>for&#160;(let&#160;number&#160;of&#160;numbers)&#160;{<br/>
if&#160;(number&#160;&gt;&#160;result)&#160;result&#160;=&#160;number;<br/>
}<br/>return&#160;result;<br/>
}<br/>console.log(max(4,&#160;1,&#160;9,&#160;-2));<br/>//&#160;→&#160;9<br/>
When&#160;such&#160;a&#160;function&#160;is&#160;called,&#160;the&#160;<i>rest&#160;parameter&#160;</i>is&#160;bound&#160;to&#160;an&#160;array<br/>
containing&#160;all&#160;further&#160;arguments.&#160;If&#160;there&#160;are&#160;other&#160;parameters&#160;before&#160;it,&#160;their<br/>values&#160;aren’t&#160;part&#160;of&#160;that&#160;array.&#160;When,&#160;as&#160;in&#160;max,&#160;it&#160;is&#160;the&#160;only&#160;parameter,&#160;it<br/>will&#160;hold&#160;all&#160;arguments.<br/>
You&#160;can&#160;use&#160;a&#160;similar&#160;three-dot&#160;notation&#160;to&#160;<i>call&#160;</i>a&#160;function&#160;with&#160;an&#160;array&#160;of<br/>
arguments.<br/>
let&#160;numbers&#160;=&#160;[5,&#160;1,&#160;7];<br/>console.log(max(...numbers));<br/>//&#160;→&#160;7<br/>
This&#160;“spreads”&#160;out&#160;the&#160;array&#160;into&#160;the&#160;function&#160;call,&#160;passing&#160;its&#160;elements&#160;as<br/>
separate&#160;arguments.&#160;It&#160;is&#160;possible&#160;to&#160;include&#160;an&#160;array&#160;like&#160;that&#160;along&#160;with&#160;other<br/>arguments,&#160;as&#160;in&#160;max(9,&#160;...numbers,&#160;2).<br/>
Square&#160;bracket&#160;array&#160;notation&#160;similarly&#160;allows&#160;the&#160;triple-dot&#160;operator&#160;to<br/>
spread&#160;another&#160;array&#160;into&#160;the&#160;new&#160;array.<br/>
let&#160;words&#160;=&#160;[&#34;never&#34;,&#160;&#34;fully&#34;];<br/>console.log([&#34;will&#34;,&#160;...words,&#160;&#34;understand&#34;]);<br/>//&#160;→&#160;[&#34;will&#34;,&#160;&#34;never&#34;,&#160;&#34;fully&#34;,&#160;&#34;understand&#34;]<br/>
74<br/>
<hr/>
<a name=87></a><b>The&#160;Math&#160;object</b><br/>
As&#160;we’ve&#160;seen,&#160;Math&#160;is&#160;a&#160;grab&#160;bag&#160;of&#160;number-related&#160;utility&#160;functions,&#160;such&#160;as<br/>Math.max&#160;(maximum),&#160;Math.min&#160;(minimum),&#160;and&#160;Math.sqrt&#160;(square&#160;root).<br/>
The&#160;Math&#160;object&#160;is&#160;used&#160;as&#160;a&#160;container&#160;to&#160;group&#160;a&#160;bunch&#160;of&#160;related&#160;function-<br/>
ality.&#160;There&#160;is&#160;only&#160;one&#160;Math&#160;object,&#160;and&#160;it&#160;is&#160;almost&#160;never&#160;useful&#160;as&#160;a&#160;value.<br/>Rather,&#160;it&#160;provides&#160;a&#160;<i>namespace&#160;</i>so&#160;that&#160;all&#160;these&#160;functions&#160;and&#160;values&#160;do&#160;not<br/>have&#160;to&#160;be&#160;global&#160;bindings.<br/>
Having&#160;too&#160;many&#160;global&#160;bindings&#160;“pollutes”&#160;the&#160;namespace.&#160;The&#160;more&#160;names<br/>
have&#160;been&#160;taken,&#160;the&#160;more&#160;likely&#160;you&#160;are&#160;to&#160;accidentally&#160;overwrite&#160;the&#160;value&#160;of<br/>some&#160;existing&#160;binding.&#160;For&#160;example,&#160;it’s&#160;not&#160;unlikely&#160;to&#160;want&#160;to&#160;name&#160;some-<br/>thing&#160;max&#160;in&#160;one&#160;of&#160;your&#160;programs.&#160;Since&#160;JavaScript’s&#160;built-in&#160;max&#160;function&#160;is<br/>tucked&#160;safely&#160;inside&#160;the&#160;Math&#160;object,&#160;we&#160;don’t&#160;have&#160;to&#160;worry&#160;about&#160;overwriting<br/>it.<br/>
Many&#160;languages&#160;will&#160;stop&#160;you,&#160;or&#160;at&#160;least&#160;warn&#160;you,&#160;when&#160;you&#160;are&#160;defining<br/>
a&#160;binding&#160;with&#160;a&#160;name&#160;that&#160;is&#160;already&#160;taken.&#160;JavaScript&#160;does&#160;this&#160;for&#160;bindings<br/>you&#160;declared&#160;with&#160;let&#160;or&#160;const&#160;but—perversely—not&#160;for&#160;standard&#160;bindings&#160;nor<br/>for&#160;bindings&#160;declared&#160;with&#160;var&#160;or&#160;function.<br/>
Back&#160;to&#160;the&#160;Math&#160;object.&#160;If&#160;you&#160;need&#160;to&#160;do&#160;trigonometry,&#160;Math&#160;can&#160;help.&#160;It<br/>
contains&#160;cos&#160;(cosine),&#160;sin&#160;(sine),&#160;and&#160;tan&#160;(tangent),&#160;as&#160;well&#160;as&#160;their&#160;inverse<br/>functions,&#160;acos,&#160;asin,&#160;and&#160;atan,&#160;respectively.&#160;The&#160;number&#160;<i>π&#160;</i>(pi)—or&#160;at&#160;least<br/>the&#160;closest&#160;approximation&#160;that&#160;fits&#160;in&#160;a&#160;JavaScript&#160;number—is&#160;available&#160;as&#160;Math<br/>.PI.&#160;There&#160;is&#160;an&#160;old&#160;programming&#160;tradition&#160;of&#160;writing&#160;the&#160;names&#160;of&#160;constant<br/>values&#160;in&#160;all&#160;caps.<br/>
function&#160;randomPointOnCircle(radius)&#160;{<br/>
let&#160;angle&#160;=&#160;Math.random()&#160;*&#160;2&#160;*&#160;Math.PI;<br/>return&#160;{x:&#160;radius&#160;*&#160;Math.cos(angle),<br/>
y:&#160;radius&#160;*&#160;Math.sin(angle)};<br/>
}<br/>console.log(randomPointOnCircle(2));<br/>//&#160;→&#160;{x:&#160;0.3667,&#160;y:&#160;1.966}<br/>
If&#160;sines&#160;and&#160;cosines&#160;are&#160;not&#160;something&#160;you&#160;are&#160;familiar&#160;with,&#160;don’t&#160;worry.<br/>
When&#160;they&#160;are&#160;used&#160;in&#160;this&#160;book,&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14,&#160;</a>I’ll&#160;explain&#160;them.<br/>
The&#160;previous&#160;example&#160;used&#160;Math.random.&#160;This&#160;is&#160;a&#160;function&#160;that&#160;returns&#160;a<br/>
new&#160;pseudorandom&#160;number&#160;between&#160;zero&#160;(inclusive)&#160;and&#160;one&#160;(exclusive)&#160;every<br/>time&#160;you&#160;call&#160;it.<br/>
console.log(Math.random());<br/>//&#160;→&#160;0.36993729369714856<br/>
75<br/>
<hr/>
<a name=88></a>console.log(Math.random());<br/>//&#160;→&#160;0.727367032552138<br/>console.log(Math.random());<br/>//&#160;→&#160;0.40180766698904335<br/>
Though&#160;computers&#160;are&#160;deterministic&#160;machines—they&#160;always&#160;react&#160;the&#160;same<br/>
way&#160;if&#160;given&#160;the&#160;same&#160;input—it&#160;is&#160;possible&#160;to&#160;have&#160;them&#160;produce&#160;numbers<br/>that&#160;appear&#160;random.&#160;To&#160;do&#160;that,&#160;the&#160;machine&#160;keeps&#160;some&#160;hidden&#160;value,&#160;and<br/>whenever&#160;you&#160;ask&#160;for&#160;a&#160;new&#160;random&#160;number,&#160;it&#160;performs&#160;complicated&#160;com-<br/>putations&#160;on&#160;this&#160;hidden&#160;value&#160;to&#160;create&#160;a&#160;new&#160;value.&#160;It&#160;stores&#160;a&#160;new&#160;value<br/>and&#160;returns&#160;some&#160;number&#160;derived&#160;from&#160;it.&#160;That&#160;way,&#160;it&#160;can&#160;produce&#160;ever&#160;new,<br/>hard-to-predict&#160;numbers&#160;in&#160;a&#160;way&#160;that&#160;<i>seems&#160;</i>random.<br/>
If&#160;we&#160;want&#160;a&#160;whole&#160;random&#160;number&#160;instead&#160;of&#160;a&#160;fractional&#160;one,&#160;we&#160;can&#160;use<br/>
Math.floor&#160;(which&#160;rounds&#160;down&#160;to&#160;the&#160;nearest&#160;whole&#160;number)&#160;on&#160;the&#160;result&#160;of<br/>Math.random.<br/>
console.log(Math.floor(Math.random()&#160;*&#160;10));<br/>//&#160;→&#160;2<br/>
Multiplying&#160;the&#160;random&#160;number&#160;by&#160;10&#160;gives&#160;us&#160;a&#160;number&#160;greater&#160;than&#160;or<br/>
equal&#160;to&#160;0&#160;and&#160;below&#160;10.&#160;Since&#160;Math.floor&#160;rounds&#160;down,&#160;this&#160;expression&#160;will<br/>produce,&#160;with&#160;equal&#160;chance,&#160;any&#160;number&#160;from&#160;0&#160;through&#160;9.<br/>
There&#160;are&#160;also&#160;the&#160;functions&#160;Math.ceil&#160;(for&#160;“ceiling”,&#160;which&#160;rounds&#160;up&#160;to<br/>
a&#160;whole&#160;number),&#160;Math.round&#160;(to&#160;the&#160;nearest&#160;whole&#160;number),&#160;and&#160;Math.abs,<br/>which&#160;takes&#160;the&#160;absolute&#160;value&#160;of&#160;a&#160;number,&#160;meaning&#160;it&#160;negates&#160;negative&#160;values<br/>but&#160;leaves&#160;positive&#160;ones&#160;as&#160;they&#160;are.<br/>
<b>Destructuring</b><br/>
Let’s&#160;go&#160;back&#160;to&#160;the&#160;phi&#160;function&#160;for&#160;a&#160;moment.<br/>
function&#160;phi(table)&#160;{<br/>
return&#160;(table[3]&#160;*&#160;table[0]&#160;-&#160;table[2]&#160;*&#160;table[1])&#160;/<br/>
Math.sqrt((table[2]&#160;+&#160;table[3])&#160;*<br/>
(table[0]&#160;+&#160;table[1])&#160;*<br/>(table[1]&#160;+&#160;table[3])&#160;*<br/>(table[0]&#160;+&#160;table[2]));<br/>
}<br/>
One&#160;of&#160;the&#160;reasons&#160;this&#160;function&#160;is&#160;awkward&#160;to&#160;read&#160;is&#160;that&#160;we&#160;have&#160;a&#160;binding<br/>
76<br/>
<hr/>
<a name=89></a>pointing&#160;at&#160;our&#160;array,&#160;but&#160;we’d&#160;much&#160;prefer&#160;to&#160;have&#160;bindings&#160;for&#160;the&#160;<i>elements<br/></i>of&#160;the&#160;array,&#160;that&#160;is,&#160;let&#160;n00&#160;=&#160;table[0]&#160;and&#160;so&#160;on.&#160;Fortunately,&#160;there&#160;is&#160;a<br/>succinct&#160;way&#160;to&#160;do&#160;this&#160;in&#160;JavaScript.<br/>
function&#160;phi([n00,&#160;n01,&#160;n10,&#160;n11])&#160;{<br/>
return&#160;(n11&#160;*&#160;n00&#160;-&#160;n10&#160;*&#160;n01)&#160;/<br/>
Math.sqrt((n10&#160;+&#160;n11)&#160;*&#160;(n00&#160;+&#160;n01)&#160;*<br/>
(n01&#160;+&#160;n11)&#160;*&#160;(n00&#160;+&#160;n10));<br/>
}<br/>
This&#160;also&#160;works&#160;for&#160;bindings&#160;created&#160;with&#160;let,&#160;var,&#160;or&#160;const.&#160;If&#160;you&#160;know&#160;the<br/>
value&#160;you&#160;are&#160;binding&#160;is&#160;an&#160;array,&#160;you&#160;can&#160;use&#160;square&#160;brackets&#160;to&#160;“look&#160;inside”<br/>of&#160;the&#160;value,&#160;binding&#160;its&#160;contents.<br/>
A&#160;similar&#160;trick&#160;works&#160;for&#160;objects,&#160;using&#160;braces&#160;instead&#160;of&#160;square&#160;brackets.<br/>
let&#160;{name}&#160;=&#160;{name:&#160;&#34;Faraji&#34;,&#160;age:&#160;23};<br/>console.log(name);<br/>//&#160;→&#160;Faraji<br/>
Note&#160;that&#160;if&#160;you&#160;try&#160;to&#160;destructure&#160;null&#160;or&#160;undefined,&#160;you&#160;get&#160;an&#160;error,&#160;much<br/>
as&#160;you&#160;would&#160;if&#160;you&#160;directly&#160;try&#160;to&#160;access&#160;a&#160;property&#160;of&#160;those&#160;values.<br/>
<b>JSON</b><br/>
Because&#160;properties&#160;only&#160;grasp&#160;their&#160;value,&#160;rather&#160;than&#160;contain&#160;it,&#160;objects&#160;and<br/>arrays&#160;are&#160;stored&#160;in&#160;the&#160;computer’s&#160;memory&#160;as&#160;sequences&#160;of&#160;bits&#160;holding&#160;the<br/><i>addresses</i>—the&#160;place&#160;in&#160;memory—of&#160;their&#160;contents.&#160;So&#160;an&#160;array&#160;with&#160;another<br/>array&#160;inside&#160;of&#160;it&#160;consists&#160;of&#160;(at&#160;least)&#160;one&#160;memory&#160;region&#160;for&#160;the&#160;inner&#160;array,<br/>and&#160;another&#160;for&#160;the&#160;outer&#160;array,&#160;containing&#160;(among&#160;other&#160;things)&#160;a&#160;binary<br/>number&#160;that&#160;represents&#160;the&#160;position&#160;of&#160;the&#160;inner&#160;array.<br/>
If&#160;you&#160;want&#160;to&#160;save&#160;data&#160;in&#160;a&#160;file&#160;for&#160;later&#160;or&#160;send&#160;it&#160;to&#160;another&#160;computer&#160;over<br/>
the&#160;network,&#160;you&#160;have&#160;to&#160;somehow&#160;convert&#160;these&#160;tangles&#160;of&#160;memory&#160;addresses<br/>to&#160;a&#160;description&#160;that&#160;can&#160;be&#160;stored&#160;or&#160;sent.&#160;You&#160;<i>could&#160;</i>send&#160;over&#160;your&#160;entire<br/>computer&#160;memory&#160;along&#160;with&#160;the&#160;address&#160;of&#160;the&#160;value&#160;you’re&#160;interested&#160;in,&#160;I<br/>suppose,&#160;but&#160;that&#160;doesn’t&#160;seem&#160;like&#160;the&#160;best&#160;approach.<br/>
What&#160;we&#160;can&#160;do&#160;is&#160;<i>serialize&#160;</i>the&#160;data.&#160;That&#160;means&#160;it&#160;is&#160;converted&#160;into&#160;a<br/>
flat&#160;description.&#160;A&#160;popular&#160;serialization&#160;format&#160;is&#160;called&#160;<i>JSON&#160;</i>(pronounced<br/>“Jason”),&#160;which&#160;stands&#160;for&#160;JavaScript&#160;Object&#160;Notation.&#160;It&#160;is&#160;widely&#160;used&#160;as&#160;a<br/>data&#160;storage&#160;and&#160;communication&#160;format&#160;on&#160;the&#160;Web,&#160;even&#160;in&#160;languages&#160;other<br/>than&#160;JavaScript.<br/>
77<br/>
<hr/>
<a name=90></a>JSON&#160;looks&#160;similar&#160;to&#160;JavaScript’s&#160;way&#160;of&#160;writing&#160;arrays&#160;and&#160;objects,&#160;with&#160;a<br/>
few&#160;restrictions.&#160;All&#160;property&#160;names&#160;have&#160;to&#160;be&#160;surrounded&#160;by&#160;double&#160;quotes,<br/>and&#160;only&#160;simple&#160;data&#160;expressions&#160;are&#160;allowed—no&#160;function&#160;calls,&#160;bindings,&#160;or<br/>anything&#160;that&#160;involves&#160;actual&#160;computation.&#160;Comments&#160;are&#160;not&#160;allowed&#160;in<br/>JSON.<br/>
A&#160;journal&#160;entry&#160;might&#160;look&#160;like&#160;this&#160;when&#160;represented&#160;as&#160;JSON&#160;data:<br/>
{<br/>
&#34;squirrel&#34;:&#160;false,<br/>&#34;events&#34;:&#160;[&#34;work&#34;,&#160;&#34;touched&#160;tree&#34;,&#160;&#34;pizza&#34;,&#160;&#34;running&#34;]<br/>
}<br/>
JavaScript&#160;gives&#160;us&#160;the&#160;functions&#160;JSON.stringify&#160;and&#160;JSON.parse&#160;to&#160;convert<br/>
data&#160;to&#160;and&#160;from&#160;this&#160;format.&#160;The&#160;first&#160;takes&#160;a&#160;JavaScript&#160;value&#160;and&#160;returns<br/>a&#160;JSON-encoded&#160;string.&#160;The&#160;second&#160;takes&#160;such&#160;a&#160;string&#160;and&#160;converts&#160;it&#160;to&#160;the<br/>value&#160;it&#160;encodes.<br/>
let&#160;string&#160;=&#160;JSON.stringify({squirrel:&#160;false,<br/>
events:&#160;[&#34;weekend&#34;]});<br/>
console.log(string);<br/>//&#160;→&#160;{&#34;squirrel&#34;:false,&#34;events&#34;:[&#34;weekend&#34;]}<br/>console.log(JSON.parse(string).events);<br/>//&#160;→&#160;[&#34;weekend&#34;]<br/>
<b>Summary</b><br/>
Objects&#160;and&#160;arrays&#160;(which&#160;are&#160;a&#160;specific&#160;kind&#160;of&#160;object)&#160;provide&#160;ways&#160;to&#160;group<br/>several&#160;values&#160;into&#160;a&#160;single&#160;value.&#160;Conceptually,&#160;this&#160;allows&#160;us&#160;to&#160;put&#160;a&#160;bunch<br/>of&#160;related&#160;things&#160;in&#160;a&#160;bag&#160;and&#160;run&#160;around&#160;with&#160;the&#160;bag,&#160;instead&#160;of&#160;wrapping<br/>our&#160;arms&#160;around&#160;all&#160;of&#160;the&#160;individual&#160;things&#160;and&#160;trying&#160;to&#160;hold&#160;on&#160;to&#160;them<br/>separately.<br/>
Most&#160;values&#160;in&#160;JavaScript&#160;have&#160;properties,&#160;the&#160;exceptions&#160;being&#160;null&#160;and<br/>
undefined.&#160;Properties&#160;are&#160;accessed&#160;using&#160;value.prop&#160;or&#160;value[&#34;prop&#34;].&#160;Ob-<br/>jects&#160;tend&#160;to&#160;use&#160;names&#160;for&#160;their&#160;properties&#160;and&#160;store&#160;more&#160;or&#160;less&#160;a&#160;fixed&#160;set<br/>of&#160;them.&#160;Arrays,&#160;on&#160;the&#160;other&#160;hand,&#160;usually&#160;contain&#160;varying&#160;amounts&#160;of&#160;con-<br/>ceptually&#160;identical&#160;values&#160;and&#160;use&#160;numbers&#160;(starting&#160;from&#160;0)&#160;as&#160;the&#160;names&#160;of<br/>their&#160;properties.<br/>
There&#160;<i>are&#160;</i>some&#160;named&#160;properties&#160;in&#160;arrays,&#160;such&#160;as&#160;length&#160;and&#160;a&#160;number&#160;of<br/>
methods.&#160;Methods&#160;are&#160;functions&#160;that&#160;live&#160;in&#160;properties&#160;and&#160;(usually)&#160;act&#160;on<br/>
78<br/>
<hr/>
<a name=91></a>the&#160;value&#160;they&#160;are&#160;a&#160;property&#160;of.<br/>
You&#160;can&#160;iterate&#160;over&#160;arrays&#160;using&#160;a&#160;special&#160;kind&#160;of&#160;for&#160;loop—for&#160;(let<br/>
element&#160;of&#160;array).<br/>
<b>Exercises</b><br/>
<b>The&#160;sum&#160;of&#160;a&#160;range</b><br/>
The&#160;<a href="eloquent-javascripts.html#13">introduction&#160;</a>of&#160;this&#160;book&#160;alluded&#160;to&#160;the&#160;following&#160;as&#160;a&#160;nice&#160;way&#160;to&#160;compute<br/>the&#160;sum&#160;of&#160;a&#160;range&#160;of&#160;numbers:<br/>
console.log(sum(range(1,&#160;10)));<br/>
Write&#160;a&#160;range&#160;function&#160;that&#160;takes&#160;two&#160;arguments,&#160;start&#160;and&#160;end,&#160;and&#160;returns<br/>
an&#160;array&#160;containing&#160;all&#160;the&#160;numbers&#160;from&#160;start&#160;up&#160;to&#160;(and&#160;including)&#160;end.<br/>
Next,&#160;write&#160;a&#160;sum&#160;function&#160;that&#160;takes&#160;an&#160;array&#160;of&#160;numbers&#160;and&#160;returns&#160;the<br/>
sum&#160;of&#160;these&#160;numbers.&#160;Run&#160;the&#160;example&#160;program&#160;and&#160;see&#160;whether&#160;it&#160;does<br/>indeed&#160;return&#160;55.<br/>
As&#160;a&#160;bonus&#160;assignment,&#160;modify&#160;your&#160;range&#160;function&#160;to&#160;take&#160;an&#160;optional&#160;third<br/>
argument&#160;that&#160;indicates&#160;the&#160;“step”&#160;value&#160;used&#160;when&#160;building&#160;the&#160;array.&#160;If&#160;no<br/>step&#160;is&#160;given,&#160;the&#160;elements&#160;go&#160;up&#160;by&#160;increments&#160;of&#160;one,&#160;corresponding&#160;to&#160;the<br/>old&#160;behavior.&#160;The&#160;function&#160;call&#160;range(1,&#160;10,&#160;2)&#160;should&#160;return&#160;[1,&#160;3,&#160;5,&#160;7,<br/>9].&#160;Make&#160;sure&#160;it&#160;also&#160;works&#160;with&#160;negative&#160;step&#160;values&#160;so&#160;that&#160;range(5,&#160;2,&#160;-1)<br/>produces&#160;[5,&#160;4,&#160;3,&#160;2].<br/>
<b>Reversing&#160;an&#160;array</b><br/>
Arrays&#160;have&#160;a&#160;reverse&#160;method&#160;that&#160;changes&#160;the&#160;array&#160;by&#160;inverting&#160;the&#160;order&#160;in<br/>which&#160;its&#160;elements&#160;appear.&#160;For&#160;this&#160;exercise,&#160;write&#160;two&#160;functions,&#160;reverseArray<br/>and&#160;reverseArrayInPlace.&#160;The&#160;first,&#160;reverseArray,&#160;takes&#160;an&#160;array&#160;as&#160;argument<br/>and&#160;produces&#160;a&#160;<i>new&#160;</i>array&#160;that&#160;has&#160;the&#160;same&#160;elements&#160;in&#160;the&#160;inverse&#160;order.&#160;The<br/>second,&#160;reverseArrayInPlace,&#160;does&#160;what&#160;the&#160;reverse&#160;method&#160;does:&#160;it&#160;<i>modifies<br/></i>the&#160;array&#160;given&#160;as&#160;argument&#160;by&#160;reversing&#160;its&#160;elements.&#160;Neither&#160;may&#160;use&#160;the<br/>standard&#160;reverse&#160;method.<br/>
Thinking&#160;back&#160;to&#160;the&#160;notes&#160;about&#160;side&#160;effects&#160;and&#160;pure&#160;functions&#160;in&#160;the<br/>
<a href="eloquent-javascripts.html#65">previous&#160;chapter,&#160;</a>which&#160;variant&#160;do&#160;you&#160;expect&#160;to&#160;be&#160;useful&#160;in&#160;more&#160;situations?<br/>Which&#160;one&#160;runs&#160;faster?<br/>
79<br/>
<hr/>
<a name=92></a><b>A&#160;list</b><br/>
Objects,&#160;as&#160;generic&#160;blobs&#160;of&#160;values,&#160;can&#160;be&#160;used&#160;to&#160;build&#160;all&#160;sorts&#160;of&#160;data&#160;struc-<br/>tures.&#160;A&#160;common&#160;data&#160;structure&#160;is&#160;the&#160;<i>list&#160;</i>(not&#160;to&#160;be&#160;confused&#160;with&#160;array).&#160;A<br/>list&#160;is&#160;a&#160;nested&#160;set&#160;of&#160;objects,&#160;with&#160;the&#160;first&#160;object&#160;holding&#160;a&#160;reference&#160;to&#160;the<br/>second,&#160;the&#160;second&#160;to&#160;the&#160;third,&#160;and&#160;so&#160;on.<br/>
let&#160;list&#160;=&#160;{<br/>
value:&#160;1,<br/>rest:&#160;{<br/>
value:&#160;2,<br/>rest:&#160;{<br/>
value:&#160;3,<br/>rest:&#160;null<br/>
}<br/>
}<br/>
};<br/>
The&#160;resulting&#160;objects&#160;form&#160;a&#160;chain,&#160;like&#160;this:<br/>
value: 1<br/>
value: 2<br/>
rest:<br/>
value: 3<br/>
rest:<br/>
rest:&#160;null<br/>
A&#160;nice&#160;thing&#160;about&#160;lists&#160;is&#160;that&#160;they&#160;can&#160;share&#160;parts&#160;of&#160;their&#160;structure.&#160;For<br/>
example,&#160;if&#160;I&#160;create&#160;two&#160;new&#160;values&#160;{value:&#160;0,&#160;rest:&#160;list}&#160;and&#160;{value:&#160;-1,<br/>rest:&#160;list}&#160;(with&#160;list&#160;referring&#160;to&#160;the&#160;binding&#160;defined&#160;earlier),&#160;they&#160;are&#160;both<br/>independent&#160;lists,&#160;but&#160;they&#160;share&#160;the&#160;structure&#160;that&#160;makes&#160;up&#160;their&#160;last&#160;three<br/>elements.&#160;The&#160;original&#160;list&#160;is&#160;also&#160;still&#160;a&#160;valid&#160;three-element&#160;list.<br/>
Write&#160;a&#160;function&#160;arrayToList&#160;that&#160;builds&#160;up&#160;a&#160;list&#160;structure&#160;like&#160;the&#160;one<br/>
shown&#160;when&#160;given&#160;[1,&#160;2,&#160;3]&#160;as&#160;argument.&#160;Also&#160;write&#160;a&#160;listToArray&#160;function<br/>that&#160;produces&#160;an&#160;array&#160;from&#160;a&#160;list.&#160;Then&#160;add&#160;a&#160;helper&#160;function&#160;prepend,&#160;which<br/>takes&#160;an&#160;element&#160;and&#160;a&#160;list&#160;and&#160;creates&#160;a&#160;new&#160;list&#160;that&#160;adds&#160;the&#160;element&#160;to&#160;the<br/>front&#160;of&#160;the&#160;input&#160;list,&#160;and&#160;nth,&#160;which&#160;takes&#160;a&#160;list&#160;and&#160;a&#160;number&#160;and&#160;returns<br/>the&#160;element&#160;at&#160;the&#160;given&#160;position&#160;in&#160;the&#160;list&#160;(with&#160;zero&#160;referring&#160;to&#160;the&#160;first<br/>element)&#160;or&#160;undefined&#160;when&#160;there&#160;is&#160;no&#160;such&#160;element.<br/>
If&#160;you&#160;haven’t&#160;already,&#160;also&#160;write&#160;a&#160;recursive&#160;version&#160;of&#160;nth.<br/>
<b>Deep&#160;comparison</b><br/>
The&#160;==&#160;operator&#160;compares&#160;objects&#160;by&#160;identity.&#160;But&#160;sometimes&#160;you’d&#160;prefer&#160;to<br/>compare&#160;the&#160;values&#160;of&#160;their&#160;actual&#160;properties.<br/>
80<br/>
<hr/>
<a name=93></a>Write&#160;a&#160;function&#160;deepEqual&#160;that&#160;takes&#160;two&#160;values&#160;and&#160;returns&#160;true&#160;only&#160;if&#160;they<br/>
are&#160;the&#160;same&#160;value&#160;or&#160;are&#160;objects&#160;with&#160;the&#160;same&#160;properties,&#160;where&#160;the&#160;values<br/>of&#160;the&#160;properties&#160;are&#160;equal&#160;when&#160;compared&#160;with&#160;a&#160;recursive&#160;call&#160;to&#160;deepEqual.<br/>
To&#160;find&#160;out&#160;whether&#160;values&#160;should&#160;be&#160;compared&#160;directly&#160;(use&#160;the&#160;===&#160;operator<br/>
for&#160;that)&#160;or&#160;have&#160;their&#160;properties&#160;compared,&#160;you&#160;can&#160;use&#160;the&#160;typeof&#160;operator.<br/>If&#160;it&#160;produces&#160;&#34;object&#34;&#160;for&#160;both&#160;values,&#160;you&#160;should&#160;do&#160;a&#160;deep&#160;comparison.<br/>But&#160;you&#160;have&#160;to&#160;take&#160;one&#160;silly&#160;exception&#160;into&#160;account:&#160;because&#160;of&#160;a&#160;historical<br/>accident,&#160;typeof&#160;null&#160;also&#160;produces&#160;&#34;object&#34;.<br/>
The&#160;Object.keys&#160;function&#160;will&#160;be&#160;useful&#160;when&#160;you&#160;need&#160;to&#160;go&#160;over&#160;the&#160;prop-<br/>
erties&#160;of&#160;objects&#160;to&#160;compare&#160;them.<br/>
81<br/>
<hr/>
<a name=94></a><i>“There&#160;are&#160;two&#160;ways&#160;of&#160;constructing&#160;a&#160;software&#160;design:&#160;One&#160;way&#160;is</i><br/>
<i>to&#160;make&#160;it&#160;so&#160;simple&#160;that&#160;there&#160;are&#160;obviously&#160;no&#160;deficiencies,&#160;and&#160;the<br/>other&#160;way&#160;is&#160;to&#160;make&#160;it&#160;so&#160;complicated&#160;that&#160;there&#160;are&#160;no&#160;obvious<br/>deficiencies.”</i><br/>
—C.A.R.&#160;Hoare,&#160;1980&#160;ACM&#160;Turing&#160;Award&#160;Lecture<br/>
<b>Chapter&#160;5<br/>Higher-Order&#160;Functions</b><br/>
A&#160;large&#160;program&#160;is&#160;a&#160;costly&#160;program,&#160;and&#160;not&#160;just&#160;because&#160;of&#160;the&#160;time&#160;it&#160;takes<br/>to&#160;build.&#160;Size&#160;almost&#160;always&#160;involves&#160;complexity,&#160;and&#160;complexity&#160;confuses<br/>programmers.&#160;Confused&#160;programmers,&#160;in&#160;turn,&#160;introduce&#160;mistakes&#160;(<i>bugs</i>)&#160;into<br/>programs.&#160;A&#160;large&#160;program&#160;then&#160;provides&#160;a&#160;lot&#160;of&#160;space&#160;for&#160;these&#160;bugs&#160;to&#160;hide,<br/>making&#160;them&#160;hard&#160;to&#160;find.<br/>
Let’s&#160;briefly&#160;go&#160;back&#160;to&#160;the&#160;final&#160;two&#160;example&#160;programs&#160;in&#160;the&#160;introduction.<br/>
The&#160;first&#160;is&#160;self-contained&#160;and&#160;six&#160;lines&#160;long.<br/>
let&#160;total&#160;=&#160;0,&#160;count&#160;=&#160;1;<br/>while&#160;(count&#160;&lt;=&#160;10)&#160;{<br/>
total&#160;+=&#160;count;<br/>count&#160;+=&#160;1;<br/>
}<br/>console.log(total);<br/>
The&#160;second&#160;relies&#160;on&#160;two&#160;external&#160;functions&#160;and&#160;is&#160;one&#160;line&#160;long.<br/>
console.log(sum(range(1,&#160;10)));<br/>
Which&#160;one&#160;is&#160;more&#160;likely&#160;to&#160;contain&#160;a&#160;bug?<br/>If&#160;we&#160;count&#160;the&#160;size&#160;of&#160;the&#160;definitions&#160;of&#160;sum&#160;and&#160;range,&#160;the&#160;second&#160;program<br/>
is&#160;also&#160;big—even&#160;bigger&#160;than&#160;the&#160;first.&#160;But&#160;still,&#160;I’d&#160;argue&#160;that&#160;it&#160;is&#160;more&#160;likely<br/>to&#160;be&#160;correct.<br/>
It&#160;is&#160;more&#160;likely&#160;to&#160;be&#160;correct&#160;because&#160;the&#160;solution&#160;is&#160;expressed&#160;in&#160;a&#160;vocabulary<br/>
that&#160;corresponds&#160;to&#160;the&#160;problem&#160;being&#160;solved.&#160;Summing&#160;a&#160;range&#160;of&#160;numbers<br/>isn’t&#160;about&#160;loops&#160;and&#160;counters.&#160;It&#160;is&#160;about&#160;ranges&#160;and&#160;sums.<br/>
The&#160;definitions&#160;of&#160;this&#160;vocabulary&#160;(the&#160;functions&#160;sum&#160;and&#160;range)&#160;will&#160;still<br/>
involve&#160;loops,&#160;counters,&#160;and&#160;other&#160;incidental&#160;details.&#160;But&#160;because&#160;they&#160;are<br/>expressing&#160;simpler&#160;concepts&#160;than&#160;the&#160;program&#160;as&#160;a&#160;whole,&#160;they&#160;are&#160;easier&#160;to<br/>get&#160;right.<br/>
82<br/>
<hr/>
<a name=95></a><b>Abstraction</b><br/>
In&#160;the&#160;context&#160;of&#160;programming,&#160;these&#160;kinds&#160;of&#160;vocabularies&#160;are&#160;usually&#160;called<br/><i>abstractions</i>.&#160;Abstractions&#160;hide&#160;details&#160;and&#160;give&#160;us&#160;the&#160;ability&#160;to&#160;talk&#160;about<br/>problems&#160;at&#160;a&#160;higher&#160;(or&#160;more&#160;abstract)&#160;level.<br/>
As&#160;an&#160;analogy,&#160;compare&#160;these&#160;two&#160;recipes&#160;for&#160;pea&#160;soup.&#160;The&#160;first&#160;one&#160;goes<br/>
like&#160;this:<br/>
Put&#160;1&#160;cup&#160;of&#160;dried&#160;peas&#160;per&#160;person&#160;into&#160;a&#160;container.&#160;Add&#160;water<br/>until&#160;the&#160;peas&#160;are&#160;well&#160;covered.&#160;Leave&#160;the&#160;peas&#160;in&#160;water&#160;for&#160;at&#160;least<br/>12&#160;hours.&#160;Take&#160;the&#160;peas&#160;out&#160;of&#160;the&#160;water&#160;and&#160;put&#160;them&#160;in&#160;a&#160;cooking<br/>pan.&#160;Add&#160;4&#160;cups&#160;of&#160;water&#160;per&#160;person.&#160;Cover&#160;the&#160;pan&#160;and&#160;keep&#160;the<br/>peas&#160;simmering&#160;for&#160;two&#160;hours.&#160;Take&#160;half&#160;an&#160;onion&#160;per&#160;person.&#160;Cut<br/>it&#160;into&#160;pieces&#160;with&#160;a&#160;knife.&#160;Add&#160;it&#160;to&#160;the&#160;peas.&#160;Take&#160;a&#160;stalk&#160;of<br/>celery&#160;per&#160;person.&#160;Cut&#160;it&#160;into&#160;pieces&#160;with&#160;a&#160;knife.&#160;Add&#160;it&#160;to&#160;the<br/>peas.&#160;Take&#160;a&#160;carrot&#160;per&#160;person.&#160;Cut&#160;it&#160;into&#160;pieces.&#160;With&#160;a&#160;knife!<br/>Add&#160;it&#160;to&#160;the&#160;peas.&#160;Cook&#160;for&#160;10&#160;more&#160;minutes.<br/>
And&#160;this&#160;is&#160;the&#160;second&#160;recipe:<br/>
Per&#160;person:&#160;1&#160;cup&#160;dried&#160;split&#160;peas,&#160;half&#160;a&#160;chopped&#160;onion,&#160;a&#160;stalk&#160;of<br/>celery,&#160;and&#160;a&#160;carrot.<br/>
Soak&#160;peas&#160;for&#160;12&#160;hours.&#160;Simmer&#160;for&#160;2&#160;hours&#160;in&#160;4&#160;cups&#160;of&#160;water&#160;(per<br/>person).&#160;Chop&#160;and&#160;add&#160;vegetables.&#160;Cook&#160;for&#160;10&#160;more&#160;minutes.<br/>
The&#160;second&#160;is&#160;shorter&#160;and&#160;easier&#160;to&#160;interpret.&#160;But&#160;you&#160;do&#160;need&#160;to&#160;understand<br/>
a&#160;few&#160;more&#160;cooking-related&#160;words&#160;such&#160;as&#160;<i>soak</i>,&#160;<i>simmer</i>,&#160;<i>chop</i>,&#160;and,&#160;I&#160;guess,<br/><i>vegetable</i>.<br/>
When&#160;programming,&#160;we&#160;can’t&#160;rely&#160;on&#160;all&#160;the&#160;words&#160;we&#160;need&#160;to&#160;be&#160;waiting&#160;for<br/>
us&#160;in&#160;the&#160;dictionary.&#160;Thus,&#160;we&#160;might&#160;fall&#160;into&#160;the&#160;pattern&#160;of&#160;the&#160;first&#160;recipe—<br/>work&#160;out&#160;the&#160;precise&#160;steps&#160;the&#160;computer&#160;has&#160;to&#160;perform,&#160;one&#160;by&#160;one,&#160;blind&#160;to<br/>the&#160;higher-level&#160;concepts&#160;that&#160;they&#160;express.<br/>
It&#160;is&#160;a&#160;useful&#160;skill,&#160;in&#160;programming,&#160;to&#160;notice&#160;when&#160;you&#160;are&#160;working&#160;at&#160;too<br/>
low&#160;a&#160;level&#160;of&#160;abstraction.<br/>
<b>Abstracting&#160;repetition</b><br/>
Plain&#160;functions,&#160;as&#160;we’ve&#160;seen&#160;them&#160;so&#160;far,&#160;are&#160;a&#160;good&#160;way&#160;to&#160;build&#160;abstractions.<br/>But&#160;sometimes&#160;they&#160;fall&#160;short.<br/>
It&#160;is&#160;common&#160;for&#160;a&#160;program&#160;to&#160;do&#160;something&#160;a&#160;given&#160;number&#160;of&#160;times.&#160;You<br/>
can&#160;write&#160;a&#160;for&#160;loop&#160;for&#160;that,&#160;like&#160;this:<br/>
83<br/>
<hr/>
<a name=96></a>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;10;&#160;i++)&#160;{<br/>
console.log(i);<br/>
}<br/>
Can&#160;we&#160;abstract&#160;“doing&#160;something&#160;<i>N&#160;</i>times”&#160;as&#160;a&#160;function?&#160;Well,&#160;it’s&#160;easy<br/>
to&#160;write&#160;a&#160;function&#160;that&#160;calls&#160;console.log&#160;<i>N&#160;</i>times.<br/>
function&#160;repeatLog(n)&#160;{<br/>
for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;n;&#160;i++)&#160;{<br/>
console.log(i);<br/>
}<br/>
}<br/>
But&#160;what&#160;if&#160;we&#160;want&#160;to&#160;do&#160;something&#160;other&#160;than&#160;logging&#160;the&#160;numbers?&#160;Since<br/>
“doing&#160;something”&#160;can&#160;be&#160;represented&#160;as&#160;a&#160;function&#160;and&#160;functions&#160;are&#160;just<br/>values,&#160;we&#160;can&#160;pass&#160;our&#160;action&#160;as&#160;a&#160;function&#160;value.<br/>
function&#160;repeat(n,&#160;action)&#160;{<br/>
for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;n;&#160;i++)&#160;{<br/>
action(i);<br/>
}<br/>
}<br/>
repeat(3,&#160;console.log);<br/>//&#160;→&#160;0<br/>//&#160;→&#160;1<br/>//&#160;→&#160;2<br/>
We&#160;don’t&#160;have&#160;to&#160;pass&#160;a&#160;predefined&#160;function&#160;to&#160;repeat.&#160;Often,&#160;it&#160;is&#160;easier&#160;to<br/>
create&#160;a&#160;function&#160;value&#160;on&#160;the&#160;spot&#160;instead.<br/>
let&#160;labels&#160;=&#160;[];<br/>repeat(5,&#160;i&#160;=&gt;&#160;{<br/>
labels.push(`Unit&#160;${i&#160;+&#160;1}`);<br/>
});<br/>console.log(labels);<br/>//&#160;→&#160;[&#34;Unit&#160;1&#34;,&#160;&#34;Unit&#160;2&#34;,&#160;&#34;Unit&#160;3&#34;,&#160;&#34;Unit&#160;4&#34;,&#160;&#34;Unit&#160;5&#34;]<br/>
This&#160;is&#160;structured&#160;a&#160;little&#160;like&#160;a&#160;for&#160;loop—it&#160;first&#160;describes&#160;the&#160;kind&#160;of&#160;loop<br/>
and&#160;then&#160;provides&#160;a&#160;body.&#160;However,&#160;the&#160;body&#160;is&#160;now&#160;written&#160;as&#160;a&#160;function<br/>value,&#160;which&#160;is&#160;wrapped&#160;in&#160;the&#160;parentheses&#160;of&#160;the&#160;call&#160;to&#160;repeat.&#160;This&#160;is&#160;why<br/>it&#160;has&#160;to&#160;be&#160;closed&#160;with&#160;the&#160;closing&#160;brace&#160;<i>and&#160;</i>closing&#160;parenthesis.&#160;In&#160;cases&#160;like<br/>
84<br/>
<hr/>
<a name=97></a>this&#160;example,&#160;where&#160;the&#160;body&#160;is&#160;a&#160;single&#160;small&#160;expression,&#160;you&#160;could&#160;also&#160;omit<br/>the&#160;braces&#160;and&#160;write&#160;the&#160;loop&#160;on&#160;a&#160;single&#160;line.<br/>
<b>Higher-order&#160;functions</b><br/>
Functions&#160;that&#160;operate&#160;on&#160;other&#160;functions,&#160;either&#160;by&#160;taking&#160;them&#160;as&#160;arguments<br/>or&#160;by&#160;returning&#160;them,&#160;are&#160;called&#160;<i>higher-order&#160;functions</i>.&#160;Since&#160;we&#160;have&#160;already<br/>seen&#160;that&#160;functions&#160;are&#160;regular&#160;values,&#160;there&#160;is&#160;nothing&#160;particularly&#160;remarkable<br/>about&#160;the&#160;fact&#160;that&#160;such&#160;functions&#160;exist.&#160;The&#160;term&#160;comes&#160;from&#160;mathemat-<br/>ics,&#160;where&#160;the&#160;distinction&#160;between&#160;functions&#160;and&#160;other&#160;values&#160;is&#160;taken&#160;more<br/>seriously.<br/>
Higher-order&#160;functions&#160;allow&#160;us&#160;to&#160;abstract&#160;over&#160;<i>actions</i>,&#160;not&#160;just&#160;values.<br/>
They&#160;come&#160;in&#160;several&#160;forms.&#160;For&#160;example,&#160;we&#160;can&#160;have&#160;functions&#160;that&#160;create<br/>new&#160;functions.<br/>
function&#160;greaterThan(n)&#160;{<br/>
return&#160;m&#160;=&gt;&#160;m&#160;&gt;&#160;n;<br/>
}<br/>let&#160;greaterThan10&#160;=&#160;greaterThan(10);<br/>console.log(greaterThan10(11));<br/>//&#160;→&#160;true<br/>
And&#160;we&#160;can&#160;have&#160;functions&#160;that&#160;change&#160;other&#160;functions.<br/>
function&#160;noisy(f)&#160;{<br/>
return&#160;(...args)&#160;=&gt;&#160;{<br/>
console.log(&#34;calling&#160;with&#34;,&#160;args);<br/>let&#160;result&#160;=&#160;f(...args);<br/>console.log(&#34;called&#160;with&#34;,&#160;args,&#160;&#34;,&#160;returned&#34;,&#160;result);<br/>return&#160;result;<br/>
};<br/>
}<br/>noisy(Math.min)(3,&#160;2,&#160;1);<br/>//&#160;→&#160;calling&#160;with&#160;[3,&#160;2,&#160;1]<br/>//&#160;→&#160;called&#160;with&#160;[3,&#160;2,&#160;1]&#160;,&#160;returned&#160;1<br/>
We&#160;can&#160;even&#160;write&#160;functions&#160;that&#160;provide&#160;new&#160;types&#160;of&#160;control&#160;flow.<br/>
function&#160;unless(test,&#160;then)&#160;{<br/>
if&#160;(!test)&#160;then();<br/>
}<br/>
85<br/>
<hr/>
<a name=98></a><img src="eloquent-javascript-98_1.png"/><br/>
repeat(3,&#160;n&#160;=&gt;&#160;{<br/>
unless(n&#160;%&#160;2&#160;==&#160;1,&#160;()&#160;=&gt;&#160;{<br/>
console.log(n,&#160;&#34;is&#160;even&#34;);<br/>
});<br/>
});<br/>//&#160;→&#160;0&#160;is&#160;even<br/>//&#160;→&#160;2&#160;is&#160;even<br/>
There&#160;is&#160;a&#160;built-in&#160;array&#160;method,&#160;forEach,&#160;that&#160;provides&#160;something&#160;like&#160;a<br/>
for/of&#160;loop&#160;as&#160;a&#160;higher-order&#160;function.<br/>
[&#34;A&#34;,&#160;&#34;B&#34;].forEach(l&#160;=&gt;&#160;console.log(l));<br/>//&#160;→&#160;A<br/>//&#160;→&#160;B<br/>
<b>Script&#160;data&#160;set</b><br/>
One&#160;area&#160;where&#160;higher-order&#160;functions&#160;shine&#160;is&#160;data&#160;processing.&#160;To&#160;process<br/>data,&#160;we’ll&#160;need&#160;some&#160;actual&#160;data.&#160;This&#160;chapter&#160;will&#160;use&#160;a&#160;data&#160;set&#160;about<br/>scripts—writing&#160;systems&#160;such&#160;as&#160;Latin,&#160;Cyrillic,&#160;or&#160;Arabic.<br/>
Remember&#160;Unicode&#160;from&#160;<a href="eloquent-javascripts.html#26">Chapter&#160;1</a>,&#160;the&#160;system&#160;that&#160;assigns&#160;a&#160;number&#160;to<br/>
each&#160;character&#160;in&#160;written&#160;language?&#160;Most&#160;of&#160;these&#160;characters&#160;are&#160;associated<br/>with&#160;a&#160;specific&#160;script.&#160;The&#160;standard&#160;contains&#160;140&#160;different&#160;scripts—81&#160;are&#160;still<br/>in&#160;use&#160;today,&#160;and&#160;59&#160;are&#160;historic.<br/>
Though&#160;I&#160;can&#160;fluently&#160;read&#160;only&#160;Latin&#160;characters,&#160;I&#160;appreciate&#160;the&#160;fact&#160;that<br/>
people&#160;are&#160;writing&#160;texts&#160;in&#160;at&#160;least&#160;80&#160;other&#160;writing&#160;systems,&#160;many&#160;of&#160;which&#160;I<br/>wouldn’t&#160;even&#160;recognize.&#160;For&#160;example,&#160;here’s&#160;a&#160;sample&#160;of&#160;Tamil&#160;handwriting:<br/>
The&#160;example&#160;data&#160;set&#160;contains&#160;some&#160;pieces&#160;of&#160;information&#160;about&#160;the&#160;140<br/>
scripts&#160;defined&#160;in&#160;Unicode.&#160;It&#160;is&#160;available&#160;in&#160;the&#160;<a href="https://eloquentjavascript.net/code#5">coding&#160;sandbox&#160;</a>for&#160;this&#160;chapter<br/><a href="https://eloquentjavascript.net/code#5">(<i>https://eloquentjavascript.net/code#5</i></a>)&#160;as&#160;the&#160;SCRIPTS&#160;binding.&#160;The&#160;binding<br/>contains&#160;an&#160;array&#160;of&#160;objects,&#160;each&#160;of&#160;which&#160;describes&#160;a&#160;script.<br/>
{<br/>
name:&#160;&#34;Coptic&#34;,<br/>ranges:&#160;[[994,&#160;1008],&#160;[11392,&#160;11508],&#160;[11513,&#160;11520]],<br/>
86<br/>
<hr/>
<a name=99></a>direction:&#160;&#34;ltr&#34;,<br/>year:&#160;-200,<br/>living:&#160;false,<br/>link:&#160;&#34;https://en.wikipedia.org/wiki/Coptic_alphabet&#34;<br/>
}<br/>
Such&#160;an&#160;object&#160;tells&#160;us&#160;the&#160;name&#160;of&#160;the&#160;script,&#160;the&#160;Unicode&#160;ranges&#160;assigned&#160;to<br/>
it,&#160;the&#160;direction&#160;in&#160;which&#160;it&#160;is&#160;written,&#160;the&#160;(approximate)&#160;origin&#160;time,&#160;whether<br/>it&#160;is&#160;still&#160;in&#160;use,&#160;and&#160;a&#160;link&#160;to&#160;more&#160;information.&#160;The&#160;direction&#160;may&#160;be&#160;&#34;ltr&#34;<br/>for&#160;left&#160;to&#160;right,&#160;&#34;rtl&#34;&#160;for&#160;right&#160;to&#160;left&#160;(the&#160;way&#160;Arabic&#160;and&#160;Hebrew&#160;text&#160;are<br/>written),&#160;or&#160;&#34;ttb&#34;&#160;for&#160;top&#160;to&#160;bottom&#160;(as&#160;with&#160;Mongolian&#160;writing).<br/>
The&#160;ranges&#160;property&#160;contains&#160;an&#160;array&#160;of&#160;Unicode&#160;character&#160;ranges,&#160;each&#160;of<br/>
which&#160;is&#160;a&#160;two-element&#160;array&#160;containing&#160;a&#160;lower&#160;bound&#160;and&#160;an&#160;upper&#160;bound.<br/>Any&#160;character&#160;codes&#160;within&#160;these&#160;ranges&#160;are&#160;assigned&#160;to&#160;the&#160;script.&#160;The&#160;lower<br/>bound&#160;is&#160;inclusive&#160;(code&#160;994&#160;is&#160;a&#160;Coptic&#160;character),&#160;and&#160;the&#160;upper&#160;bound&#160;is<br/>non-inclusive&#160;(code&#160;1008&#160;isn’t).<br/>
<b>Filtering&#160;arrays</b><br/>
To&#160;find&#160;the&#160;scripts&#160;in&#160;the&#160;data&#160;set&#160;that&#160;are&#160;still&#160;in&#160;use,&#160;the&#160;following&#160;function<br/>might&#160;be&#160;helpful.&#160;It&#160;filters&#160;out&#160;the&#160;elements&#160;in&#160;an&#160;array&#160;that&#160;don’t&#160;pass&#160;a&#160;test.<br/>
function&#160;filter(array,&#160;test)&#160;{<br/>
let&#160;passed&#160;=&#160;[];<br/>for&#160;(let&#160;element&#160;of&#160;array)&#160;{<br/>
if&#160;(test(element))&#160;{<br/>
passed.push(element);<br/>
}<br/>
}<br/>return&#160;passed;<br/>
}<br/>
console.log(filter(SCRIPTS,&#160;script&#160;=&gt;&#160;script.living));<br/>//&#160;→&#160;[{name:&#160;&#34;Adlam&#34;,&#160;…},&#160;…]<br/>
The&#160;function&#160;uses&#160;the&#160;argument&#160;named&#160;test,&#160;a&#160;function&#160;value,&#160;to&#160;fill&#160;a&#160;“gap”<br/>
in&#160;the&#160;computation—the&#160;process&#160;of&#160;deciding&#160;which&#160;elements&#160;to&#160;collect.<br/>
Note&#160;how&#160;the&#160;filter&#160;function,&#160;rather&#160;than&#160;deleting&#160;elements&#160;from&#160;the&#160;ex-<br/>
isting&#160;array,&#160;builds&#160;up&#160;a&#160;new&#160;array&#160;with&#160;only&#160;the&#160;elements&#160;that&#160;pass&#160;the&#160;test.<br/>This&#160;function&#160;is&#160;<i>pure</i>.&#160;It&#160;does&#160;not&#160;modify&#160;the&#160;array&#160;it&#160;is&#160;given.<br/>
Like&#160;forEach,&#160;filter&#160;is&#160;a&#160;standard&#160;array&#160;method.&#160;The&#160;example&#160;defined&#160;the<br/>
87<br/>
<hr/>
<a name=100></a>function&#160;only&#160;to&#160;show&#160;what&#160;it&#160;does&#160;internally.&#160;From&#160;now&#160;on,&#160;we’ll&#160;use&#160;it&#160;like<br/>this&#160;instead:<br/>
console.log(SCRIPTS.filter(s&#160;=&gt;&#160;s.direction&#160;==&#160;&#34;ttb&#34;));<br/>//&#160;→&#160;[{name:&#160;&#34;Mongolian&#34;,&#160;…},&#160;…]<br/>
<b>Transforming&#160;with&#160;map</b><br/>
Say&#160;we&#160;have&#160;an&#160;array&#160;of&#160;objects&#160;representing&#160;scripts,&#160;produced&#160;by&#160;filtering&#160;the<br/>SCRIPTS&#160;array&#160;somehow.&#160;But&#160;we&#160;want&#160;an&#160;array&#160;of&#160;names,&#160;which&#160;is&#160;easier&#160;to<br/>inspect.<br/>
The&#160;map&#160;method&#160;transforms&#160;an&#160;array&#160;by&#160;applying&#160;a&#160;function&#160;to&#160;all&#160;of&#160;its<br/>
elements&#160;and&#160;building&#160;a&#160;new&#160;array&#160;from&#160;the&#160;returned&#160;values.&#160;The&#160;new&#160;array<br/>will&#160;have&#160;the&#160;same&#160;length&#160;as&#160;the&#160;input&#160;array,&#160;but&#160;its&#160;content&#160;will&#160;have&#160;been<br/><i>mapped&#160;</i>to&#160;a&#160;new&#160;form&#160;by&#160;the&#160;function.<br/>
function&#160;map(array,&#160;transform)&#160;{<br/>
let&#160;mapped&#160;=&#160;[];<br/>for&#160;(let&#160;element&#160;of&#160;array)&#160;{<br/>
mapped.push(transform(element));<br/>
}<br/>return&#160;mapped;<br/>
}<br/>
let&#160;rtlScripts&#160;=&#160;SCRIPTS.filter(s&#160;=&gt;&#160;s.direction&#160;==&#160;&#34;rtl&#34;);<br/>console.log(map(rtlScripts,&#160;s&#160;=&gt;&#160;s.name));<br/>//&#160;→&#160;[&#34;Adlam&#34;,&#160;&#34;Arabic&#34;,&#160;&#34;Imperial&#160;Aramaic&#34;,&#160;…]<br/>
Like&#160;forEach&#160;and&#160;filter,&#160;map&#160;is&#160;a&#160;standard&#160;array&#160;method.<br/>
<b>Summarizing&#160;with&#160;reduce</b><br/>
Another&#160;common&#160;thing&#160;to&#160;do&#160;with&#160;arrays&#160;is&#160;to&#160;compute&#160;a&#160;single&#160;value&#160;from<br/>them.&#160;Our&#160;recurring&#160;example,&#160;summing&#160;a&#160;collection&#160;of&#160;numbers,&#160;is&#160;an&#160;instance<br/>of&#160;this.&#160;Another&#160;example&#160;is&#160;finding&#160;the&#160;script&#160;with&#160;the&#160;most&#160;characters.<br/>
The&#160;higher-order&#160;operation&#160;that&#160;represents&#160;this&#160;pattern&#160;is&#160;called&#160;<i>reduce&#160;</i>(some-<br/>
times&#160;also&#160;called&#160;<i>fold</i>).&#160;It&#160;builds&#160;a&#160;value&#160;by&#160;repeatedly&#160;taking&#160;a&#160;single&#160;element<br/>from&#160;the&#160;array&#160;and&#160;combining&#160;it&#160;with&#160;the&#160;current&#160;value.&#160;When&#160;summing&#160;num-<br/>bers,&#160;you’d&#160;start&#160;with&#160;the&#160;number&#160;zero&#160;and,&#160;for&#160;each&#160;element,&#160;add&#160;that&#160;to&#160;the<br/>
88<br/>
<hr/>
<a name=101></a>sum.<br/>
The&#160;parameters&#160;to&#160;reduce&#160;are,&#160;apart&#160;from&#160;the&#160;array,&#160;a&#160;combining&#160;function<br/>
and&#160;a&#160;start&#160;value.&#160;This&#160;function&#160;is&#160;a&#160;little&#160;less&#160;straightforward&#160;than&#160;filter&#160;and<br/>map,&#160;so&#160;take&#160;a&#160;close&#160;look&#160;at&#160;it:<br/>
function&#160;reduce(array,&#160;combine,&#160;start)&#160;{<br/>
let&#160;current&#160;=&#160;start;<br/>for&#160;(let&#160;element&#160;of&#160;array)&#160;{<br/>
current&#160;=&#160;combine(current,&#160;element);<br/>
}<br/>return&#160;current;<br/>
}<br/>
console.log(reduce([1,&#160;2,&#160;3,&#160;4],&#160;(a,&#160;b)&#160;=&gt;&#160;a&#160;+&#160;b,&#160;0));<br/>//&#160;→&#160;10<br/>
The&#160;standard&#160;array&#160;method&#160;reduce,&#160;which&#160;of&#160;course&#160;corresponds&#160;to&#160;this<br/>
function,&#160;has&#160;an&#160;added&#160;convenience.&#160;If&#160;your&#160;array&#160;contains&#160;at&#160;least&#160;one&#160;element,<br/>you&#160;are&#160;allowed&#160;to&#160;leave&#160;off&#160;the&#160;start&#160;argument.&#160;The&#160;method&#160;will&#160;take&#160;the&#160;first<br/>element&#160;of&#160;the&#160;array&#160;as&#160;its&#160;start&#160;value&#160;and&#160;start&#160;reducing&#160;at&#160;the&#160;second&#160;element.<br/>
console.log([1,&#160;2,&#160;3,&#160;4].reduce((a,&#160;b)&#160;=&gt;&#160;a&#160;+&#160;b));<br/>//&#160;→&#160;10<br/>
To&#160;use&#160;reduce&#160;(twice)&#160;to&#160;find&#160;the&#160;script&#160;with&#160;the&#160;most&#160;characters,&#160;we&#160;can<br/>
write&#160;something&#160;like&#160;this:<br/>
function&#160;characterCount(script)&#160;{<br/>
return&#160;script.ranges.reduce((count,&#160;[from,&#160;to])&#160;=&gt;&#160;{<br/>
return&#160;count&#160;+&#160;(to&#160;-&#160;from);<br/>
},&#160;0);<br/>
}<br/>
console.log(SCRIPTS.reduce((a,&#160;b)&#160;=&gt;&#160;{<br/>
return&#160;characterCount(a)&#160;&lt;&#160;characterCount(b)&#160;?&#160;b&#160;:&#160;a;<br/>
}));<br/>//&#160;→&#160;{name:&#160;&#34;Han&#34;,&#160;…}<br/>
The&#160;characterCount&#160;function&#160;reduces&#160;the&#160;ranges&#160;assigned&#160;to&#160;a&#160;script&#160;by&#160;sum-<br/>
ming&#160;their&#160;sizes.&#160;Note&#160;the&#160;use&#160;of&#160;destructuring&#160;in&#160;the&#160;parameter&#160;list&#160;of&#160;the<br/>reducer&#160;function.&#160;The&#160;second&#160;call&#160;to&#160;reduce&#160;then&#160;uses&#160;this&#160;to&#160;find&#160;the&#160;largest<br/>script&#160;by&#160;repeatedly&#160;comparing&#160;two&#160;scripts&#160;and&#160;returning&#160;the&#160;larger&#160;one.<br/>
89<br/>
<hr/>
<a name=102></a>The&#160;Han&#160;script&#160;has&#160;more&#160;than&#160;89,000&#160;characters&#160;assigned&#160;to&#160;it&#160;in&#160;the&#160;Unicode<br/>
standard,&#160;making&#160;it&#160;by&#160;far&#160;the&#160;biggest&#160;writing&#160;system&#160;in&#160;the&#160;data&#160;set.&#160;Han<br/>is&#160;a&#160;script&#160;(sometimes)&#160;used&#160;for&#160;Chinese,&#160;Japanese,&#160;and&#160;Korean&#160;text.&#160;Those<br/>languages&#160;share&#160;a&#160;lot&#160;of&#160;characters,&#160;though&#160;they&#160;tend&#160;to&#160;write&#160;them&#160;differently.<br/>The&#160;(U.S.-based)&#160;Unicode&#160;Consortium&#160;decided&#160;to&#160;treat&#160;them&#160;as&#160;a&#160;single&#160;writing<br/>system&#160;to&#160;save&#160;character&#160;codes.&#160;This&#160;is&#160;called&#160;<i>Han&#160;unification&#160;</i>and&#160;still&#160;makes<br/>some&#160;people&#160;very&#160;angry.<br/>
<b>Composability</b><br/>
Consider&#160;how&#160;we&#160;would&#160;have&#160;written&#160;the&#160;previous&#160;example&#160;(finding&#160;the&#160;biggest<br/>script)&#160;without&#160;higher-order&#160;functions.&#160;The&#160;code&#160;is&#160;not&#160;that&#160;much&#160;worse.<br/>
let&#160;biggest&#160;=&#160;null;<br/>for&#160;(let&#160;script&#160;of&#160;SCRIPTS)&#160;{<br/>
if&#160;(biggest&#160;==&#160;null&#160;||<br/>
characterCount(biggest)&#160;&lt;&#160;characterCount(script))&#160;{<br/>
biggest&#160;=&#160;script;<br/>
}<br/>
}<br/>console.log(biggest);<br/>//&#160;→&#160;{name:&#160;&#34;Han&#34;,&#160;…}<br/>
There&#160;are&#160;a&#160;few&#160;more&#160;bindings,&#160;and&#160;the&#160;program&#160;is&#160;four&#160;lines&#160;longer.&#160;But&#160;it<br/>
is&#160;still&#160;very&#160;readable.<br/>
Higher-order&#160;functions&#160;start&#160;to&#160;shine&#160;when&#160;you&#160;need&#160;to&#160;<i>compose&#160;</i>operations.<br/>
As&#160;an&#160;example,&#160;let’s&#160;write&#160;code&#160;that&#160;finds&#160;the&#160;average&#160;year&#160;of&#160;origin&#160;for&#160;living<br/>and&#160;dead&#160;scripts&#160;in&#160;the&#160;data&#160;set.<br/>
function&#160;average(array)&#160;{<br/>
return&#160;array.reduce((a,&#160;b)&#160;=&gt;&#160;a&#160;+&#160;b)&#160;/&#160;array.length;<br/>
}<br/>
console.log(Math.round(average(<br/>
SCRIPTS.filter(s&#160;=&gt;&#160;s.living).map(s&#160;=&gt;&#160;s.year))));<br/>
//&#160;→&#160;1165<br/>console.log(Math.round(average(<br/>
SCRIPTS.filter(s&#160;=&gt;&#160;!s.living).map(s&#160;=&gt;&#160;s.year))));<br/>
//&#160;→&#160;204<br/>
So&#160;the&#160;dead&#160;scripts&#160;in&#160;Unicode&#160;are,&#160;on&#160;average,&#160;older&#160;than&#160;the&#160;living&#160;ones.<br/>
90<br/>
<hr/>
<a name=103></a>This&#160;is&#160;not&#160;a&#160;terribly&#160;meaningful&#160;or&#160;surprising&#160;statistic.&#160;But&#160;I&#160;hope&#160;you’ll&#160;agree<br/>that&#160;the&#160;code&#160;used&#160;to&#160;compute&#160;it&#160;isn’t&#160;hard&#160;to&#160;read.&#160;You&#160;can&#160;see&#160;it&#160;as&#160;a&#160;pipeline:<br/>we&#160;start&#160;with&#160;all&#160;scripts,&#160;filter&#160;out&#160;the&#160;living&#160;(or&#160;dead)&#160;ones,&#160;take&#160;the&#160;years&#160;from<br/>those,&#160;average&#160;them,&#160;and&#160;round&#160;the&#160;result.<br/>
You&#160;could&#160;definitely&#160;also&#160;write&#160;this&#160;computation&#160;as&#160;one&#160;big&#160;loop.<br/>
let&#160;total&#160;=&#160;0,&#160;count&#160;=&#160;0;<br/>for&#160;(let&#160;script&#160;of&#160;SCRIPTS)&#160;{<br/>
if&#160;(script.living)&#160;{<br/>
total&#160;+=&#160;script.year;<br/>count&#160;+=&#160;1;<br/>
}<br/>
}<br/>console.log(Math.round(total&#160;/&#160;count));<br/>//&#160;→&#160;1165<br/>
But&#160;it&#160;is&#160;harder&#160;to&#160;see&#160;what&#160;was&#160;being&#160;computed&#160;and&#160;how.&#160;And&#160;because<br/>
intermediate&#160;results&#160;aren’t&#160;represented&#160;as&#160;coherent&#160;values,&#160;it’d&#160;be&#160;a&#160;lot&#160;more<br/>work&#160;to&#160;extract&#160;something&#160;like&#160;average&#160;into&#160;a&#160;separate&#160;function.<br/>
In&#160;terms&#160;of&#160;what&#160;the&#160;computer&#160;is&#160;actually&#160;doing,&#160;these&#160;two&#160;approaches&#160;are<br/>
also&#160;quite&#160;different.&#160;The&#160;first&#160;will&#160;build&#160;up&#160;new&#160;arrays&#160;when&#160;running&#160;filter<br/>and&#160;map,&#160;whereas&#160;the&#160;second&#160;computes&#160;only&#160;some&#160;numbers,&#160;doing&#160;less&#160;work.<br/>You&#160;can&#160;usually&#160;afford&#160;the&#160;readable&#160;approach,&#160;but&#160;if&#160;you’re&#160;processing&#160;huge<br/>arrays,&#160;and&#160;doing&#160;so&#160;many&#160;times,&#160;the&#160;less&#160;abstract&#160;style&#160;might&#160;be&#160;worth&#160;the<br/>extra&#160;speed.<br/>
<b>Strings&#160;and&#160;character&#160;codes</b><br/>
One&#160;use&#160;of&#160;the&#160;data&#160;set&#160;would&#160;be&#160;figuring&#160;out&#160;what&#160;script&#160;a&#160;piece&#160;of&#160;text&#160;is<br/>using.&#160;Let’s&#160;go&#160;through&#160;a&#160;program&#160;that&#160;does&#160;this.<br/>
Remember&#160;that&#160;each&#160;script&#160;has&#160;an&#160;array&#160;of&#160;character&#160;code&#160;ranges&#160;associated<br/>
with&#160;it.&#160;So&#160;given&#160;a&#160;character&#160;code,&#160;we&#160;could&#160;use&#160;a&#160;function&#160;like&#160;this&#160;to&#160;find&#160;the<br/>corresponding&#160;script&#160;(if&#160;any):<br/>
function&#160;characterScript(code)&#160;{<br/>
for&#160;(let&#160;script&#160;of&#160;SCRIPTS)&#160;{<br/>
if&#160;(script.ranges.some(([from,&#160;to])&#160;=&gt;&#160;{<br/>
return&#160;code&#160;&gt;=&#160;from&#160;&amp;&amp;&#160;code&#160;&lt;&#160;to;<br/>
}))&#160;{<br/>
return&#160;script;<br/>
}<br/>
}<br/>
91<br/>
<hr/>
<a name=104></a>return&#160;null;<br/>
}<br/>
console.log(characterScript(121));<br/>//&#160;→&#160;{name:&#160;&#34;Latin&#34;,&#160;…}<br/>
The&#160;some&#160;method&#160;is&#160;another&#160;higher-order&#160;function.&#160;It&#160;takes&#160;a&#160;test&#160;function<br/>
and&#160;tells&#160;you&#160;whether&#160;that&#160;function&#160;returns&#160;true&#160;for&#160;any&#160;of&#160;the&#160;elements&#160;in&#160;the<br/>array.<br/>
But&#160;how&#160;do&#160;we&#160;get&#160;the&#160;character&#160;codes&#160;in&#160;a&#160;string?<br/>In&#160;<a href="eloquent-javascripts.html#22">Chapter&#160;1&#160;</a>I&#160;mentioned&#160;that&#160;JavaScript&#160;strings&#160;are&#160;encoded&#160;as&#160;a&#160;sequence<br/>
of&#160;16-bit&#160;numbers.&#160;These&#160;are&#160;called&#160;<i>code&#160;units</i>.&#160;A&#160;Unicode&#160;character&#160;code<br/>was&#160;initially&#160;supposed&#160;to&#160;fit&#160;within&#160;such&#160;a&#160;unit&#160;(which&#160;gives&#160;you&#160;a&#160;little&#160;over<br/>65,000&#160;characters).&#160;When&#160;it&#160;became&#160;clear&#160;that&#160;wasn’t&#160;going&#160;to&#160;be&#160;enough,<br/>many&#160;people&#160;balked&#160;at&#160;the&#160;need&#160;to&#160;use&#160;more&#160;memory&#160;per&#160;character.&#160;To&#160;address<br/>these&#160;concerns,&#160;UTF-16,&#160;the&#160;format&#160;used&#160;by&#160;JavaScript&#160;strings,&#160;was&#160;invented.<br/>It&#160;describes&#160;most&#160;common&#160;characters&#160;using&#160;a&#160;single&#160;16-bit&#160;code&#160;unit&#160;but&#160;uses<br/>a&#160;pair&#160;of&#160;two&#160;such&#160;units&#160;for&#160;others.<br/>
UTF-16&#160;is&#160;generally&#160;considered&#160;a&#160;bad&#160;idea&#160;today.&#160;It&#160;seems&#160;almost&#160;inten-<br/>
tionally&#160;designed&#160;to&#160;invite&#160;mistakes.&#160;It’s&#160;easy&#160;to&#160;write&#160;programs&#160;that&#160;pretend<br/>code&#160;units&#160;and&#160;characters&#160;are&#160;the&#160;same&#160;thing.&#160;And&#160;if&#160;your&#160;language&#160;doesn’t&#160;use<br/>two-unit&#160;characters,&#160;that&#160;will&#160;appear&#160;to&#160;work&#160;just&#160;fine.&#160;But&#160;as&#160;soon&#160;as&#160;some-<br/>one&#160;tries&#160;to&#160;use&#160;such&#160;a&#160;program&#160;with&#160;some&#160;less&#160;common&#160;Chinese&#160;characters,<br/>it&#160;breaks.&#160;Fortunately,&#160;with&#160;the&#160;advent&#160;of&#160;emoji,&#160;everybody&#160;has&#160;started&#160;us-<br/>ing&#160;two-unit&#160;characters,&#160;and&#160;the&#160;burden&#160;of&#160;dealing&#160;with&#160;such&#160;problems&#160;is&#160;more<br/>fairly&#160;distributed.<br/>
Unfortunately,&#160;obvious&#160;operations&#160;on&#160;JavaScript&#160;strings,&#160;such&#160;as&#160;getting&#160;their<br/>
length&#160;through&#160;the&#160;length&#160;property&#160;and&#160;accessing&#160;their&#160;content&#160;using&#160;square<br/>brackets,&#160;deal&#160;only&#160;with&#160;code&#160;units.<br/>
//&#160;Two&#160;emoji&#160;characters,&#160;horse&#160;and&#160;shoe<br/>
let&#160;horseShoe&#160;=&#160;&#34;🐴👟&#34;;<br/>console.log(horseShoe.length);<br/>//&#160;→&#160;4<br/>console.log(horseShoe[0]);<br/>//&#160;→&#160;(Invalid&#160;half-character)<br/>console.log(horseShoe.charCodeAt(0));<br/>//&#160;→&#160;55357&#160;(Code&#160;of&#160;the&#160;half-character)<br/>console.log(horseShoe.codePointAt(0));<br/>//&#160;→&#160;128052&#160;(Actual&#160;code&#160;for&#160;horse&#160;emoji)<br/>
92<br/>
<hr/>
<a name=105></a>JavaScript’s&#160;charCodeAt&#160;method&#160;gives&#160;you&#160;a&#160;code&#160;unit,&#160;not&#160;a&#160;full&#160;character<br/>
code.&#160;The&#160;codePointAt&#160;method,&#160;added&#160;later,&#160;does&#160;give&#160;a&#160;full&#160;Unicode&#160;character.<br/>So&#160;we&#160;could&#160;use&#160;that&#160;to&#160;get&#160;characters&#160;from&#160;a&#160;string.&#160;But&#160;the&#160;argument&#160;passed<br/>to&#160;codePointAt&#160;is&#160;still&#160;an&#160;index&#160;into&#160;the&#160;sequence&#160;of&#160;code&#160;units.&#160;So&#160;to&#160;run&#160;over<br/>all&#160;characters&#160;in&#160;a&#160;string,&#160;we’d&#160;still&#160;need&#160;to&#160;deal&#160;with&#160;the&#160;question&#160;of&#160;whether<br/>a&#160;character&#160;takes&#160;up&#160;one&#160;or&#160;two&#160;code&#160;units.<br/>
In&#160;the&#160;<a href="eloquent-javascripts.html#79">previous&#160;chapter</a>,&#160;I&#160;mentioned&#160;that&#160;a&#160;for/of&#160;loop&#160;can&#160;also&#160;be&#160;used&#160;on<br/>
strings.&#160;Like&#160;codePointAt,&#160;this&#160;type&#160;of&#160;loop&#160;was&#160;introduced&#160;at&#160;a&#160;time&#160;where<br/>people&#160;were&#160;acutely&#160;aware&#160;of&#160;the&#160;problems&#160;with&#160;UTF-16.&#160;When&#160;you&#160;use&#160;it&#160;to<br/>loop&#160;over&#160;a&#160;string,&#160;it&#160;gives&#160;you&#160;real&#160;characters,&#160;not&#160;code&#160;units.<br/>
let&#160;roseDragon&#160;=&#160;&#34;🌹🐉&#34;;<br/>for&#160;(let&#160;char&#160;of&#160;roseDragon)&#160;{<br/>
console.log(char);<br/>
}<br/>
//&#160;→&#160;🌹<br/>//&#160;→&#160;🐉<br/>
If&#160;you&#160;have&#160;a&#160;character&#160;(which&#160;will&#160;be&#160;a&#160;string&#160;of&#160;one&#160;or&#160;two&#160;code&#160;units),&#160;you<br/>
can&#160;use&#160;codePointAt(0)&#160;to&#160;get&#160;its&#160;code.<br/>
<b>Recognizing&#160;text</b><br/>
We&#160;have&#160;a&#160;characterScript&#160;function&#160;and&#160;a&#160;way&#160;to&#160;correctly&#160;loop&#160;over&#160;charac-<br/>ters.&#160;The&#160;next&#160;step&#160;is&#160;to&#160;count&#160;the&#160;characters&#160;that&#160;belong&#160;to&#160;each&#160;script.&#160;The<br/>following&#160;counting&#160;abstraction&#160;will&#160;be&#160;useful&#160;there:<br/>
function&#160;countBy(items,&#160;groupName)&#160;{<br/>
let&#160;counts&#160;=&#160;[];<br/>for&#160;(let&#160;item&#160;of&#160;items)&#160;{<br/>
let&#160;name&#160;=&#160;groupName(item);<br/>let&#160;known&#160;=&#160;counts.findIndex(c&#160;=&gt;&#160;c.name&#160;==&#160;name);<br/>if&#160;(known&#160;==&#160;-1)&#160;{<br/>
counts.push({name,&#160;count:&#160;1});<br/>
}&#160;else&#160;{<br/>
counts[known].count++;<br/>
}<br/>
}<br/>return&#160;counts;<br/>
}<br/>
console.log(countBy([1,&#160;2,&#160;3,&#160;4,&#160;5],&#160;n&#160;=&gt;&#160;n&#160;&gt;&#160;2));<br/>
93<br/>
<hr/>
<a name=106></a>//&#160;→&#160;[{name:&#160;false,&#160;count:&#160;2},&#160;{name:&#160;true,&#160;count:&#160;3}]<br/>
The&#160;countBy&#160;function&#160;expects&#160;a&#160;collection&#160;(anything&#160;that&#160;we&#160;can&#160;loop&#160;over<br/>
with&#160;for/of)&#160;and&#160;a&#160;function&#160;that&#160;computes&#160;a&#160;group&#160;name&#160;for&#160;a&#160;given&#160;element.<br/>It&#160;returns&#160;an&#160;array&#160;of&#160;objects,&#160;each&#160;of&#160;which&#160;names&#160;a&#160;group&#160;and&#160;tells&#160;you&#160;the<br/>number&#160;of&#160;elements&#160;that&#160;were&#160;found&#160;in&#160;that&#160;group.<br/>
It&#160;uses&#160;another&#160;array&#160;method—findIndex.&#160;This&#160;method&#160;is&#160;somewhat&#160;like<br/>
indexOf,&#160;but&#160;instead&#160;of&#160;looking&#160;for&#160;a&#160;specific&#160;value,&#160;it&#160;finds&#160;the&#160;first&#160;value&#160;for<br/>which&#160;the&#160;given&#160;function&#160;returns&#160;true.&#160;Like&#160;indexOf,&#160;it&#160;returns&#160;-1&#160;when&#160;no&#160;such<br/>element&#160;is&#160;found.<br/>
Using&#160;countBy,&#160;we&#160;can&#160;write&#160;the&#160;function&#160;that&#160;tells&#160;us&#160;which&#160;scripts&#160;are&#160;used<br/>
in&#160;a&#160;piece&#160;of&#160;text.<br/>
function&#160;textScripts(text)&#160;{<br/>
let&#160;scripts&#160;=&#160;countBy(text,&#160;char&#160;=&gt;&#160;{<br/>
let&#160;script&#160;=&#160;characterScript(char.codePointAt(0));<br/>return&#160;script&#160;?&#160;script.name&#160;:&#160;&#34;none&#34;;<br/>
}).filter(({name})&#160;=&gt;&#160;name&#160;!=&#160;&#34;none&#34;);<br/>
let&#160;total&#160;=&#160;scripts.reduce((n,&#160;{count})&#160;=&gt;&#160;n&#160;+&#160;count,&#160;0);<br/>if&#160;(total&#160;==&#160;0)&#160;return&#160;&#34;No&#160;scripts&#160;found&#34;;<br/>
return&#160;scripts.map(({name,&#160;count})&#160;=&gt;&#160;{<br/>
return&#160;`${Math.round(count&#160;*&#160;100&#160;/&#160;total)}%&#160;${name}`;<br/>
}).join(&#34;,&#160;&#34;);<br/>
}<br/>
console.log(textScripts('英国的狗说&#34;woof&#34;,&#160;俄罗斯的狗说&#34;тяв&#34;'));<br/>//&#160;→&#160;61%&#160;Han,&#160;22%&#160;Latin,&#160;17%&#160;Cyrillic<br/>
The&#160;function&#160;first&#160;counts&#160;the&#160;characters&#160;by&#160;name,&#160;using&#160;characterScript&#160;to<br/>
assign&#160;them&#160;a&#160;name&#160;and&#160;falling&#160;back&#160;to&#160;the&#160;string&#160;&#34;none&#34;&#160;for&#160;characters&#160;that<br/>aren’t&#160;part&#160;of&#160;any&#160;script.&#160;The&#160;filter&#160;call&#160;drops&#160;the&#160;entry&#160;for&#160;&#34;none&#34;&#160;from&#160;the<br/>resulting&#160;array&#160;since&#160;we&#160;aren’t&#160;interested&#160;in&#160;those&#160;characters.<br/>
To&#160;be&#160;able&#160;to&#160;compute&#160;percentages,&#160;we&#160;first&#160;need&#160;the&#160;total&#160;number&#160;of&#160;char-<br/>
acters&#160;that&#160;belong&#160;to&#160;a&#160;script,&#160;which&#160;we&#160;can&#160;compute&#160;with&#160;reduce.&#160;If&#160;no&#160;such<br/>characters&#160;are&#160;found,&#160;the&#160;function&#160;returns&#160;a&#160;specific&#160;string.&#160;Otherwise,&#160;it&#160;trans-<br/>forms&#160;the&#160;counting&#160;entries&#160;into&#160;readable&#160;strings&#160;with&#160;map&#160;and&#160;then&#160;combines<br/>them&#160;with&#160;join.<br/>
94<br/>
<hr/>
<a name=107></a><b>Summary</b><br/>
Being&#160;able&#160;to&#160;pass&#160;function&#160;values&#160;to&#160;other&#160;functions&#160;is&#160;a&#160;deeply&#160;useful&#160;aspect<br/>of&#160;JavaScript.&#160;It&#160;allows&#160;us&#160;to&#160;write&#160;functions&#160;that&#160;model&#160;computations&#160;with<br/>“gaps”&#160;in&#160;them.&#160;The&#160;code&#160;that&#160;calls&#160;these&#160;functions&#160;can&#160;fill&#160;in&#160;the&#160;gaps&#160;by<br/>providing&#160;function&#160;values.<br/>
Arrays&#160;provide&#160;a&#160;number&#160;of&#160;useful&#160;higher-order&#160;methods.<br/>
You&#160;can&#160;use<br/>
forEach&#160;to&#160;loop&#160;over&#160;the&#160;elements&#160;in&#160;an&#160;array.&#160;The&#160;filter&#160;method&#160;returns<br/>a&#160;new&#160;array&#160;containing&#160;only&#160;the&#160;elements&#160;that&#160;pass&#160;the&#160;predicate&#160;function.<br/>Transforming&#160;an&#160;array&#160;by&#160;putting&#160;each&#160;element&#160;through&#160;a&#160;function&#160;is&#160;done<br/>with&#160;map.&#160;You&#160;can&#160;use&#160;reduce&#160;to&#160;combine&#160;all&#160;the&#160;elements&#160;in&#160;an&#160;array&#160;into<br/>a&#160;single&#160;value.&#160;The&#160;some&#160;method&#160;tests&#160;whether&#160;any&#160;element&#160;matches&#160;a&#160;given<br/>predicate&#160;function.&#160;And&#160;findIndex&#160;finds&#160;the&#160;position&#160;of&#160;the&#160;first&#160;element&#160;that<br/>matches&#160;a&#160;predicate.<br/>
<b>Exercises</b><br/>
<b>Flattening</b><br/>
Use&#160;the&#160;reduce&#160;method&#160;in&#160;combination&#160;with&#160;the&#160;concat&#160;method&#160;to&#160;“flatten”<br/>an&#160;array&#160;of&#160;arrays&#160;into&#160;a&#160;single&#160;array&#160;that&#160;has&#160;all&#160;the&#160;elements&#160;of&#160;the&#160;original<br/>arrays.<br/>
<b>Your&#160;own&#160;loop</b><br/>
Write&#160;a&#160;higher-order&#160;function&#160;loop&#160;that&#160;provides&#160;something&#160;like&#160;a&#160;for&#160;loop<br/>statement.&#160;It&#160;takes&#160;a&#160;value,&#160;a&#160;test&#160;function,&#160;an&#160;update&#160;function,&#160;and&#160;a&#160;body<br/>function.&#160;Each&#160;iteration,&#160;it&#160;first&#160;runs&#160;the&#160;test&#160;function&#160;on&#160;the&#160;current&#160;loop&#160;value<br/>and&#160;stops&#160;if&#160;that&#160;returns&#160;false.&#160;Then&#160;it&#160;calls&#160;the&#160;body&#160;function,&#160;giving&#160;it&#160;the<br/>current&#160;value.&#160;Finally,&#160;it&#160;calls&#160;the&#160;update&#160;function&#160;to&#160;create&#160;a&#160;new&#160;value&#160;and<br/>starts&#160;from&#160;the&#160;beginning.<br/>
When&#160;defining&#160;the&#160;function,&#160;you&#160;can&#160;use&#160;a&#160;regular&#160;loop&#160;to&#160;do&#160;the&#160;actual<br/>
looping.<br/>
<b>Everything</b><br/>
Analogous&#160;to&#160;the&#160;some&#160;method,&#160;arrays&#160;also&#160;have&#160;an&#160;every&#160;method.&#160;This&#160;one<br/>returns&#160;true&#160;when&#160;the&#160;given&#160;function&#160;returns&#160;true&#160;for&#160;<i>every&#160;</i>element&#160;in&#160;the&#160;array.<br/>In&#160;a&#160;way,&#160;some&#160;is&#160;a&#160;version&#160;of&#160;the&#160;||&#160;operator&#160;that&#160;acts&#160;on&#160;arrays,&#160;and&#160;every&#160;is<br/>like&#160;the&#160;&amp;&amp;&#160;operator.<br/>
95<br/>
<hr/>
<a name=108></a>Implement&#160;every&#160;as&#160;a&#160;function&#160;that&#160;takes&#160;an&#160;array&#160;and&#160;a&#160;predicate&#160;function<br/>
as&#160;parameters.&#160;Write&#160;two&#160;versions,&#160;one&#160;using&#160;a&#160;loop&#160;and&#160;one&#160;using&#160;the&#160;some<br/>method.<br/>
<b>Dominant&#160;writing&#160;direction</b><br/>
Write&#160;a&#160;function&#160;that&#160;computes&#160;the&#160;dominant&#160;writing&#160;direction&#160;in&#160;a&#160;string&#160;of<br/>text.&#160;Remember&#160;that&#160;each&#160;script&#160;object&#160;has&#160;a&#160;direction&#160;property&#160;that&#160;can&#160;be<br/>&#34;ltr&#34;&#160;(left&#160;to&#160;right),&#160;&#34;rtl&#34;&#160;(right&#160;to&#160;left),&#160;or&#160;&#34;ttb&#34;&#160;(top&#160;to&#160;bottom).<br/>
The&#160;dominant&#160;direction&#160;is&#160;the&#160;direction&#160;of&#160;a&#160;majority&#160;of&#160;the&#160;characters&#160;that<br/>
have&#160;a&#160;script&#160;associated&#160;with&#160;them.&#160;The&#160;characterScript&#160;and&#160;countBy&#160;func-<br/>tions&#160;defined&#160;earlier&#160;in&#160;the&#160;chapter&#160;are&#160;probably&#160;useful&#160;here.<br/>
96<br/>
<hr/>
<a name=109></a><i>“An&#160;abstract&#160;data&#160;type&#160;is&#160;realized&#160;by&#160;writing&#160;a&#160;special&#160;kind&#160;of&#160;program</i><br/>
<i>[…]&#160;which&#160;defines&#160;the&#160;type&#160;in&#160;terms&#160;of&#160;the&#160;operations&#160;which&#160;can&#160;be<br/>performed&#160;on&#160;it.”</i><br/>
—Barbara&#160;Liskov,&#160;Programming&#160;with&#160;Abstract&#160;Data&#160;Types<br/>
<b>Chapter&#160;6<br/>The&#160;Secret&#160;Life&#160;of&#160;Objects</b><br/>
<a href="eloquent-javascripts.html#69">Chapter&#160;4&#160;</a>introduced&#160;JavaScript’s&#160;objects.&#160;In&#160;programming&#160;culture,&#160;we&#160;have&#160;a<br/>thing&#160;called&#160;<i>object-oriented&#160;programming</i>,&#160;a&#160;set&#160;of&#160;techniques&#160;that&#160;use&#160;objects<br/>(and&#160;related&#160;concepts)&#160;as&#160;the&#160;central&#160;principle&#160;of&#160;program&#160;organization.<br/>
Though&#160;no&#160;one&#160;really&#160;agrees&#160;on&#160;its&#160;precise&#160;definition,&#160;object-oriented&#160;pro-<br/>
gramming&#160;has&#160;shaped&#160;the&#160;design&#160;of&#160;many&#160;programming&#160;languages,&#160;including<br/>JavaScript.&#160;This&#160;chapter&#160;will&#160;describe&#160;the&#160;way&#160;these&#160;ideas&#160;can&#160;be&#160;applied&#160;in<br/>JavaScript.<br/>
<b>Encapsulation</b><br/>
The&#160;core&#160;idea&#160;in&#160;object-oriented&#160;programming&#160;is&#160;to&#160;divide&#160;programs&#160;into&#160;smaller<br/>pieces&#160;and&#160;make&#160;each&#160;piece&#160;responsible&#160;for&#160;managing&#160;its&#160;own&#160;state.<br/>
This&#160;way,&#160;some&#160;knowledge&#160;about&#160;the&#160;way&#160;a&#160;piece&#160;of&#160;the&#160;program&#160;works&#160;can<br/>
be&#160;kept&#160;<i>local&#160;</i>to&#160;that&#160;piece.&#160;Someone&#160;working&#160;on&#160;the&#160;rest&#160;of&#160;the&#160;program&#160;does<br/>not&#160;have&#160;to&#160;remember&#160;or&#160;even&#160;be&#160;aware&#160;of&#160;that&#160;knowledge.&#160;Whenever&#160;these<br/>local&#160;details&#160;change,&#160;only&#160;the&#160;code&#160;directly&#160;around&#160;it&#160;needs&#160;to&#160;be&#160;updated.<br/>
Different&#160;pieces&#160;of&#160;such&#160;a&#160;program&#160;interact&#160;with&#160;each&#160;other&#160;through&#160;<i>inter-</i><br/>
<i>faces</i>,&#160;limited&#160;sets&#160;of&#160;functions&#160;or&#160;bindings&#160;that&#160;provide&#160;useful&#160;functionality&#160;at<br/>a&#160;more&#160;abstract&#160;level,&#160;hiding&#160;their&#160;precise&#160;implementation.<br/>
Such&#160;program&#160;pieces&#160;are&#160;modeled&#160;using&#160;objects.&#160;Their&#160;interface&#160;consists&#160;of&#160;a<br/>
specific&#160;set&#160;of&#160;methods&#160;and&#160;properties.&#160;Properties&#160;that&#160;are&#160;part&#160;of&#160;the&#160;interface<br/>are&#160;called&#160;<i>public</i>.&#160;The&#160;others,&#160;which&#160;outside&#160;code&#160;should&#160;not&#160;be&#160;touching,&#160;are<br/>called&#160;<i>private</i>.<br/>
Many&#160;languages&#160;provide&#160;a&#160;way&#160;to&#160;distinguish&#160;public&#160;and&#160;private&#160;properties<br/>
and&#160;prevent&#160;outside&#160;code&#160;from&#160;accessing&#160;the&#160;private&#160;ones&#160;altogether.&#160;JavaScript,<br/>once&#160;again&#160;taking&#160;the&#160;minimalist&#160;approach,&#160;does&#160;not—not&#160;yet&#160;at&#160;least.&#160;There<br/>is&#160;work&#160;underway&#160;to&#160;add&#160;this&#160;to&#160;the&#160;language.<br/>
Even&#160;though&#160;the&#160;language&#160;doesn’t&#160;have&#160;this&#160;distinction&#160;built&#160;in,&#160;JavaScript<br/>
programmers&#160;<i>are&#160;</i>successfully&#160;using&#160;this&#160;idea.&#160;Typically,&#160;the&#160;available&#160;interface<br/>is&#160;described&#160;in&#160;documentation&#160;or&#160;comments.&#160;It&#160;is&#160;also&#160;common&#160;to&#160;put&#160;an<br/>
97<br/>
<hr/>
<a name=110></a>underscore&#160;(_)&#160;character&#160;at&#160;the&#160;start&#160;of&#160;property&#160;names&#160;to&#160;indicate&#160;that&#160;those<br/>properties&#160;are&#160;private.<br/>
Separating&#160;interface&#160;from&#160;implementation&#160;is&#160;a&#160;great&#160;idea.&#160;It&#160;is&#160;usually&#160;called<br/>
<i>encapsulation</i>.<br/>
<b>Methods</b><br/>
Methods&#160;are&#160;nothing&#160;more&#160;than&#160;properties&#160;that&#160;hold&#160;function&#160;values.&#160;This&#160;is&#160;a<br/>simple&#160;method:<br/>
let&#160;rabbit&#160;=&#160;{};<br/>rabbit.speak&#160;=&#160;function(line)&#160;{<br/>
console.log(`The&#160;rabbit&#160;says&#160;'${line}'`);<br/>
};<br/>
rabbit.speak(&#34;I'm&#160;alive.&#34;);<br/>//&#160;→&#160;The&#160;rabbit&#160;says&#160;'I'm&#160;alive.'<br/>
Usually&#160;a&#160;method&#160;needs&#160;to&#160;do&#160;something&#160;with&#160;the&#160;object&#160;it&#160;was&#160;called&#160;on.<br/>
When&#160;a&#160;function&#160;is&#160;called&#160;as&#160;a&#160;method—looked&#160;up&#160;as&#160;a&#160;property&#160;and&#160;immedi-<br/>ately&#160;called,&#160;as&#160;in&#160;object.method()—the&#160;binding&#160;called&#160;this&#160;in&#160;its&#160;body&#160;auto-<br/>matically&#160;points&#160;at&#160;the&#160;object&#160;that&#160;it&#160;was&#160;called&#160;on.<br/>
function&#160;speak(line)&#160;{<br/>
console.log(`The&#160;${this.type}&#160;rabbit&#160;says&#160;'${line}'`);<br/>
}<br/>let&#160;whiteRabbit&#160;=&#160;{type:&#160;&#34;white&#34;,&#160;speak};<br/>let&#160;hungryRabbit&#160;=&#160;{type:&#160;&#34;hungry&#34;,&#160;speak};<br/>
whiteRabbit.speak(&#34;Oh&#160;my&#160;ears&#160;and&#160;whiskers,&#160;&#34;&#160;+<br/>
&#34;how&#160;late&#160;it's&#160;getting!&#34;);<br/>
//&#160;→&#160;The&#160;white&#160;rabbit&#160;says&#160;'Oh&#160;my&#160;ears&#160;and&#160;whiskers,&#160;how<br/>//<br/>
late&#160;it's&#160;getting!'<br/>
hungryRabbit.speak(&#34;I&#160;could&#160;use&#160;a&#160;carrot&#160;right&#160;now.&#34;);<br/>//&#160;→&#160;The&#160;hungry&#160;rabbit&#160;says&#160;'I&#160;could&#160;use&#160;a&#160;carrot&#160;right&#160;now.'<br/>
You&#160;can&#160;think&#160;of&#160;this&#160;as&#160;an&#160;extra&#160;parameter&#160;that&#160;is&#160;passed&#160;in&#160;a&#160;different<br/>
way.&#160;If&#160;you&#160;want&#160;to&#160;pass&#160;it&#160;explicitly,&#160;you&#160;can&#160;use&#160;a&#160;function’s&#160;call&#160;method,<br/>which&#160;takes&#160;the&#160;this&#160;value&#160;as&#160;its&#160;first&#160;argument&#160;and&#160;treats&#160;further&#160;arguments<br/>as&#160;normal&#160;parameters.<br/>
speak.call(hungryRabbit,&#160;&#34;Burp!&#34;);<br/>
98<br/>
<hr/>
<a name=111></a>//&#160;→&#160;The&#160;hungry&#160;rabbit&#160;says&#160;'Burp!'<br/>
Since&#160;each&#160;function&#160;has&#160;its&#160;own&#160;this&#160;binding,&#160;whose&#160;value&#160;depends&#160;on&#160;the<br/>
way&#160;it&#160;is&#160;called,&#160;you&#160;cannot&#160;refer&#160;to&#160;the&#160;this&#160;of&#160;the&#160;wrapping&#160;scope&#160;in&#160;a&#160;regular<br/>function&#160;defined&#160;with&#160;the&#160;function&#160;keyword.<br/>
Arrow&#160;functions&#160;are&#160;different—they&#160;do&#160;not&#160;bind&#160;their&#160;own&#160;this&#160;but&#160;can&#160;see<br/>
the&#160;this&#160;binding&#160;of&#160;the&#160;scope&#160;around&#160;them.&#160;Thus,&#160;you&#160;can&#160;do&#160;something&#160;like<br/>the&#160;following&#160;code,&#160;which&#160;references&#160;this&#160;from&#160;inside&#160;a&#160;local&#160;function:<br/>
function&#160;normalize()&#160;{<br/>
console.log(this.coords.map(n&#160;=&gt;&#160;n&#160;/&#160;this.length));<br/>
}<br/>normalize.call({coords:&#160;[0,&#160;2,&#160;3],&#160;length:&#160;5});<br/>//&#160;→&#160;[0,&#160;0.4,&#160;0.6]<br/>
If&#160;I&#160;had&#160;written&#160;the&#160;argument&#160;to&#160;map&#160;using&#160;the&#160;function&#160;keyword,&#160;the&#160;code<br/>
wouldn’t&#160;work.<br/>
<b>Prototypes</b><br/>
Watch&#160;closely.<br/>
let&#160;empty&#160;=&#160;{};<br/>console.log(empty.toString);<br/>//&#160;→&#160;function&#160;toString()…{}<br/>console.log(empty.toString());<br/>//&#160;→&#160;[object&#160;Object]<br/>
I&#160;pulled&#160;a&#160;property&#160;out&#160;of&#160;an&#160;empty&#160;object.&#160;Magic!<br/>Well,&#160;not&#160;really.&#160;I&#160;have&#160;simply&#160;been&#160;withholding&#160;information&#160;about&#160;the&#160;way<br/>
JavaScript&#160;objects&#160;work.&#160;In&#160;addition&#160;to&#160;their&#160;set&#160;of&#160;properties,&#160;most&#160;objects<br/>also&#160;have&#160;a&#160;<i>prototype</i>.&#160;A&#160;prototype&#160;is&#160;another&#160;object&#160;that&#160;is&#160;used&#160;as&#160;a&#160;fallback<br/>source&#160;of&#160;properties.&#160;When&#160;an&#160;object&#160;gets&#160;a&#160;request&#160;for&#160;a&#160;property&#160;that&#160;it&#160;does<br/>not&#160;have,&#160;its&#160;prototype&#160;will&#160;be&#160;searched&#160;for&#160;the&#160;property,&#160;then&#160;the&#160;prototype’s<br/>prototype,&#160;and&#160;so&#160;on.<br/>
So&#160;who&#160;is&#160;the&#160;prototype&#160;of&#160;that&#160;empty&#160;object?&#160;It&#160;is&#160;the&#160;great&#160;ancestral<br/>
prototype,&#160;the&#160;entity&#160;behind&#160;almost&#160;all&#160;objects,&#160;Object.prototype.<br/>
console.log(Object.getPrototypeOf({})&#160;==<br/>
Object.prototype);<br/>
99<br/>
<hr/>
<a name=112></a>//&#160;→&#160;true<br/>console.log(Object.getPrototypeOf(Object.prototype));<br/>//&#160;→&#160;null<br/>
As&#160;you&#160;guess,&#160;Object.getPrototypeOf&#160;returns&#160;the&#160;prototype&#160;of&#160;an&#160;object.<br/>The&#160;prototype&#160;relations&#160;of&#160;JavaScript&#160;objects&#160;form&#160;a&#160;tree-shaped&#160;structure,<br/>
and&#160;at&#160;the&#160;root&#160;of&#160;this&#160;structure&#160;sits&#160;Object.prototype.&#160;It&#160;provides&#160;a&#160;few<br/>methods&#160;that&#160;show&#160;up&#160;in&#160;all&#160;objects,&#160;such&#160;as&#160;toString,&#160;which&#160;converts&#160;an<br/>object&#160;to&#160;a&#160;string&#160;representation.<br/>
Many&#160;objects&#160;don’t&#160;directly&#160;have&#160;Object.prototype&#160;as&#160;their&#160;prototype&#160;but<br/>
instead&#160;have&#160;another&#160;object&#160;that&#160;provides&#160;a&#160;different&#160;set&#160;of&#160;default&#160;proper-<br/>ties.&#160;Functions&#160;derive&#160;from&#160;Function.prototype,&#160;and&#160;arrays&#160;derive&#160;from&#160;Array<br/>.prototype.<br/>
console.log(Object.getPrototypeOf(Math.max)&#160;==<br/>
Function.prototype);<br/>
//&#160;→&#160;true<br/>console.log(Object.getPrototypeOf([])&#160;==<br/>
Array.prototype);<br/>
//&#160;→&#160;true<br/>
Such&#160;a&#160;prototype&#160;object&#160;will&#160;itself&#160;have&#160;a&#160;prototype,&#160;often&#160;Object.prototype,<br/>
so&#160;that&#160;it&#160;still&#160;indirectly&#160;provides&#160;methods&#160;like&#160;toString.<br/>
You&#160;can&#160;use&#160;Object.create&#160;to&#160;create&#160;an&#160;object&#160;with&#160;a&#160;specific&#160;prototype.<br/>
let&#160;protoRabbit&#160;=&#160;{<br/>
speak(line)&#160;{<br/>
console.log(`The&#160;${this.type}&#160;rabbit&#160;says&#160;'${line}'`);<br/>
}<br/>
};<br/>let&#160;killerRabbit&#160;=&#160;Object.create(protoRabbit);<br/>killerRabbit.type&#160;=&#160;&#34;killer&#34;;<br/>killerRabbit.speak(&#34;SKREEEE!&#34;);<br/>//&#160;→&#160;The&#160;killer&#160;rabbit&#160;says&#160;'SKREEEE!'<br/>
A&#160;property&#160;like&#160;speak(line)&#160;in&#160;an&#160;object&#160;expression&#160;is&#160;a&#160;shorthand&#160;way&#160;of<br/>
defining&#160;a&#160;method.&#160;It&#160;creates&#160;a&#160;property&#160;called&#160;speak&#160;and&#160;gives&#160;it&#160;a&#160;function<br/>as&#160;its&#160;value.<br/>
The&#160;“proto”&#160;rabbit&#160;acts&#160;as&#160;a&#160;container&#160;for&#160;the&#160;properties&#160;that&#160;are&#160;shared&#160;by&#160;all<br/>
rabbits.&#160;An&#160;individual&#160;rabbit&#160;object,&#160;like&#160;the&#160;killer&#160;rabbit,&#160;contains&#160;properties<br/>that&#160;apply&#160;only&#160;to&#160;itself—in&#160;this&#160;case&#160;its&#160;type—and&#160;derives&#160;shared&#160;properties<br/>
100<br/>
<hr/>
<a name=113></a>from&#160;its&#160;prototype.<br/>
<b>Classes</b><br/>
JavaScript’s&#160;prototype&#160;system&#160;can&#160;be&#160;interpreted&#160;as&#160;a&#160;somewhat&#160;informal&#160;take<br/>on&#160;an&#160;object-oriented&#160;concept&#160;called&#160;<i>classes</i>.&#160;A&#160;class&#160;defines&#160;the&#160;shape&#160;of&#160;a<br/>type&#160;of&#160;object—what&#160;methods&#160;and&#160;properties&#160;it&#160;has.&#160;Such&#160;an&#160;object&#160;is&#160;called<br/>an&#160;<i>instance&#160;</i>of&#160;the&#160;class.<br/>
Prototypes&#160;are&#160;useful&#160;for&#160;defining&#160;properties&#160;for&#160;which&#160;all&#160;instances&#160;of&#160;a&#160;class<br/>
share&#160;the&#160;same&#160;value,&#160;such&#160;as&#160;methods.&#160;Properties&#160;that&#160;differ&#160;per&#160;instance,<br/>such&#160;as&#160;our&#160;rabbits’&#160;type&#160;property,&#160;need&#160;to&#160;be&#160;stored&#160;directly&#160;in&#160;the&#160;objects<br/>themselves.<br/>
So&#160;to&#160;create&#160;an&#160;instance&#160;of&#160;a&#160;given&#160;class,&#160;you&#160;have&#160;to&#160;make&#160;an&#160;object&#160;that<br/>
derives&#160;from&#160;the&#160;proper&#160;prototype,&#160;but&#160;you&#160;<i>also&#160;</i>have&#160;to&#160;make&#160;sure&#160;it,&#160;itself,&#160;has<br/>the&#160;properties&#160;that&#160;instances&#160;of&#160;this&#160;class&#160;are&#160;supposed&#160;to&#160;have.&#160;This&#160;is&#160;what&#160;a<br/><i>constructor&#160;</i>function&#160;does.<br/>
function&#160;makeRabbit(type)&#160;{<br/>
let&#160;rabbit&#160;=&#160;Object.create(protoRabbit);<br/>rabbit.type&#160;=&#160;type;<br/>return&#160;rabbit;<br/>
}<br/>
JavaScript&#160;provides&#160;a&#160;way&#160;to&#160;make&#160;defining&#160;this&#160;type&#160;of&#160;function&#160;easier.&#160;If<br/>
you&#160;put&#160;the&#160;keyword&#160;new&#160;in&#160;front&#160;of&#160;a&#160;function&#160;call,&#160;the&#160;function&#160;is&#160;treated&#160;as<br/>a&#160;constructor.&#160;This&#160;means&#160;that&#160;an&#160;object&#160;with&#160;the&#160;right&#160;prototype&#160;is&#160;automat-<br/>ically&#160;created,&#160;bound&#160;to&#160;this&#160;in&#160;the&#160;function,&#160;and&#160;returned&#160;at&#160;the&#160;end&#160;of&#160;the<br/>function.<br/>
The&#160;prototype&#160;object&#160;used&#160;when&#160;constructing&#160;objects&#160;is&#160;found&#160;by&#160;taking&#160;the<br/>
prototype&#160;property&#160;of&#160;the&#160;constructor&#160;function.<br/>
function&#160;Rabbit(type)&#160;{<br/>
this.type&#160;=&#160;type;<br/>
}<br/>Rabbit.prototype.speak&#160;=&#160;function(line)&#160;{<br/>
console.log(`The&#160;${this.type}&#160;rabbit&#160;says&#160;'${line}'`);<br/>
};<br/>
let&#160;weirdRabbit&#160;=&#160;new&#160;Rabbit(&#34;weird&#34;);<br/>
Constructors&#160;(all&#160;functions,&#160;in&#160;fact)&#160;automatically&#160;get&#160;a&#160;property&#160;named<br/>
101<br/>
<hr/>
<a name=114></a>prototype,&#160;which&#160;by&#160;default&#160;holds&#160;a&#160;plain,&#160;empty&#160;object&#160;that&#160;derives&#160;from<br/>Object.prototype.&#160;You&#160;can&#160;overwrite&#160;it&#160;with&#160;a&#160;new&#160;object&#160;if&#160;you&#160;want.&#160;Or&#160;you<br/>can&#160;add&#160;properties&#160;to&#160;the&#160;existing&#160;object,&#160;as&#160;the&#160;example&#160;does.<br/>
By&#160;convention,&#160;the&#160;names&#160;of&#160;constructors&#160;are&#160;capitalized&#160;so&#160;that&#160;they&#160;can<br/>
easily&#160;be&#160;distinguished&#160;from&#160;other&#160;functions.<br/>
It&#160;is&#160;important&#160;to&#160;understand&#160;the&#160;distinction&#160;between&#160;the&#160;way&#160;a&#160;prototype<br/>
is&#160;associated&#160;with&#160;a&#160;constructor&#160;(through&#160;its&#160;prototype&#160;property)&#160;and&#160;the&#160;way<br/>objects&#160;<i>have&#160;</i>a&#160;prototype&#160;(which&#160;can&#160;be&#160;found&#160;with&#160;Object.getPrototypeOf).<br/>The&#160;actual&#160;prototype&#160;of&#160;a&#160;constructor&#160;is&#160;Function.prototype&#160;since&#160;constructors<br/>are&#160;functions.&#160;Its&#160;prototype&#160;<i>property&#160;</i>holds&#160;the&#160;prototype&#160;used&#160;for&#160;instances<br/>created&#160;through&#160;it.<br/>
console.log(Object.getPrototypeOf(Rabbit)&#160;==<br/>
Function.prototype);<br/>
//&#160;→&#160;true<br/>console.log(Object.getPrototypeOf(weirdRabbit)&#160;==<br/>
Rabbit.prototype);<br/>
//&#160;→&#160;true<br/>
<b>Class&#160;notation</b><br/>
So&#160;JavaScript&#160;classes&#160;are&#160;constructor&#160;functions&#160;with&#160;a&#160;prototype&#160;property.&#160;That<br/>is&#160;how&#160;they&#160;work,&#160;and&#160;until&#160;2015,&#160;that&#160;was&#160;how&#160;you&#160;had&#160;to&#160;write&#160;them.&#160;These<br/>days,&#160;we&#160;have&#160;a&#160;less&#160;awkward&#160;notation.<br/>
class&#160;Rabbit&#160;{<br/>
constructor(type)&#160;{<br/>
this.type&#160;=&#160;type;<br/>
}<br/>speak(line)&#160;{<br/>
console.log(`The&#160;${this.type}&#160;rabbit&#160;says&#160;'${line}'`);<br/>
}<br/>
}<br/>
let&#160;killerRabbit&#160;=&#160;new&#160;Rabbit(&#34;killer&#34;);<br/>let&#160;blackRabbit&#160;=&#160;new&#160;Rabbit(&#34;black&#34;);<br/>
The&#160;class&#160;keyword&#160;starts&#160;a&#160;class&#160;declaration,&#160;which&#160;allows&#160;us&#160;to&#160;define&#160;a<br/>
constructor&#160;and&#160;a&#160;set&#160;of&#160;methods&#160;all&#160;in&#160;a&#160;single&#160;place.&#160;Any&#160;number&#160;of&#160;methods<br/>may&#160;be&#160;written&#160;inside&#160;the&#160;declaration’s&#160;braces.&#160;The&#160;one&#160;named&#160;constructor<br/>
102<br/>
<hr/>
<a name=115></a>is&#160;treated&#160;specially.&#160;It&#160;provides&#160;the&#160;actual&#160;constructor&#160;function,&#160;which&#160;will&#160;be<br/>bound&#160;to&#160;the&#160;name&#160;Rabbit.&#160;The&#160;others&#160;are&#160;packaged&#160;into&#160;that&#160;constructor’s<br/>prototype.&#160;Thus,&#160;the&#160;earlier&#160;class&#160;declaration&#160;is&#160;equivalent&#160;to&#160;the&#160;constructor<br/>definition&#160;from&#160;the&#160;previous&#160;section.&#160;It&#160;just&#160;looks&#160;nicer.<br/>
Class&#160;declarations&#160;currently&#160;allow&#160;only&#160;<i>methods</i>—properties&#160;that&#160;hold&#160;functions—<br/>
to&#160;be&#160;added&#160;to&#160;the&#160;prototype.&#160;This&#160;can&#160;be&#160;somewhat&#160;inconvenient&#160;when&#160;you<br/>want&#160;to&#160;save&#160;a&#160;non-function&#160;value&#160;in&#160;there.&#160;The&#160;next&#160;version&#160;of&#160;the&#160;language<br/>will&#160;probably&#160;improve&#160;this.&#160;For&#160;now,&#160;you&#160;can&#160;create&#160;such&#160;properties&#160;by&#160;directly<br/>manipulating&#160;the&#160;prototype&#160;after&#160;you’ve&#160;defined&#160;the&#160;class.<br/>
Like&#160;function,&#160;class&#160;can&#160;be&#160;used&#160;both&#160;in&#160;statements&#160;and&#160;in&#160;expressions.<br/>
When&#160;used&#160;as&#160;an&#160;expression,&#160;it&#160;doesn’t&#160;define&#160;a&#160;binding&#160;but&#160;just&#160;produces&#160;the<br/>constructor&#160;as&#160;a&#160;value.&#160;You&#160;are&#160;allowed&#160;to&#160;omit&#160;the&#160;class&#160;name&#160;in&#160;a&#160;class<br/>expression.<br/>
let&#160;object&#160;=&#160;new&#160;class&#160;{&#160;getWord()&#160;{&#160;return&#160;&#34;hello&#34;;&#160;}&#160;};<br/>console.log(object.getWord());<br/>//&#160;→&#160;hello<br/>
<b>Overriding&#160;derived&#160;properties</b><br/>
When&#160;you&#160;add&#160;a&#160;property&#160;to&#160;an&#160;object,&#160;whether&#160;it&#160;is&#160;present&#160;in&#160;the&#160;prototype&#160;or<br/>not,&#160;the&#160;property&#160;is&#160;added&#160;to&#160;the&#160;object&#160;<i>itself</i>.&#160;If&#160;there&#160;was&#160;already&#160;a&#160;property<br/>with&#160;the&#160;same&#160;name&#160;in&#160;the&#160;prototype,&#160;this&#160;property&#160;will&#160;no&#160;longer&#160;affect&#160;the<br/>object,&#160;as&#160;it&#160;is&#160;now&#160;hidden&#160;behind&#160;the&#160;object’s&#160;own&#160;property.<br/>
Rabbit.prototype.teeth&#160;=&#160;&#34;small&#34;;<br/>console.log(killerRabbit.teeth);<br/>//&#160;→&#160;small<br/>killerRabbit.teeth&#160;=&#160;&#34;long,&#160;sharp,&#160;and&#160;bloody&#34;;<br/>console.log(killerRabbit.teeth);<br/>//&#160;→&#160;long,&#160;sharp,&#160;and&#160;bloody<br/>console.log(blackRabbit.teeth);<br/>//&#160;→&#160;small<br/>console.log(Rabbit.prototype.teeth);<br/>//&#160;→&#160;small<br/>
The&#160;following&#160;diagram&#160;sketches&#160;the&#160;situation&#160;after&#160;this&#160;code&#160;has&#160;run.&#160;The<br/>
Rabbit&#160;and&#160;Object&#160;prototypes&#160;lie&#160;behind&#160;killerRabbit&#160;as&#160;a&#160;kind&#160;of&#160;backdrop,<br/>where&#160;properties&#160;that&#160;are&#160;not&#160;found&#160;in&#160;the&#160;object&#160;itself&#160;can&#160;be&#160;looked&#160;up.<br/>
103<br/>
<hr/>
<a name=116></a>Rabbit<br/>
prototype<br/>
Object<br/>
killerRabbit<br/>
create:&#160;&lt;function&gt;<br/>
teeth:&#160;&#34;long,&#160;sharp,&#160;...&#34;<br/>
prototype<br/>
type: &#34;killer&#34;<br/>
...<br/>
teeth:&#160;&#34;small&#34;<br/>speak:&#160;&lt;function&gt;<br/>
toString:&#160;&lt;function&gt;<br/>...<br/>
Overriding&#160;properties&#160;that&#160;exist&#160;in&#160;a&#160;prototype&#160;can&#160;be&#160;a&#160;useful&#160;thing&#160;to&#160;do.&#160;As<br/>
the&#160;rabbit&#160;teeth&#160;example&#160;shows,&#160;overriding&#160;can&#160;be&#160;used&#160;to&#160;express&#160;exceptional<br/>properties&#160;in&#160;instances&#160;of&#160;a&#160;more&#160;generic&#160;class&#160;of&#160;objects,&#160;while&#160;letting&#160;the<br/>nonexceptional&#160;objects&#160;take&#160;a&#160;standard&#160;value&#160;from&#160;their&#160;prototype.<br/>
Overriding&#160;is&#160;also&#160;used&#160;to&#160;give&#160;the&#160;standard&#160;function&#160;and&#160;array&#160;prototypes&#160;a<br/>
different&#160;toString&#160;method&#160;than&#160;the&#160;basic&#160;object&#160;prototype.<br/>
console.log(Array.prototype.toString&#160;==<br/>
Object.prototype.toString);<br/>
//&#160;→&#160;false<br/>console.log([1,&#160;2].toString());<br/>//&#160;→&#160;1,2<br/>
Calling&#160;toString&#160;on&#160;an&#160;array&#160;gives&#160;a&#160;result&#160;similar&#160;to&#160;calling&#160;.join(&#34;,&#34;)&#160;on<br/>
it—it&#160;puts&#160;commas&#160;between&#160;the&#160;values&#160;in&#160;the&#160;array.&#160;Directly&#160;calling&#160;Object.<br/>prototype.toString&#160;with&#160;an&#160;array&#160;produces&#160;a&#160;different&#160;string.&#160;That&#160;function<br/>doesn’t&#160;know&#160;about&#160;arrays,&#160;so&#160;it&#160;simply&#160;puts&#160;the&#160;word&#160;<i>object&#160;</i>and&#160;the&#160;name&#160;of<br/>the&#160;type&#160;between&#160;square&#160;brackets.<br/>
console.log(Object.prototype.toString.call([1,&#160;2]));<br/>//&#160;→&#160;[object&#160;Array]<br/>
<b>Maps</b><br/>
We&#160;saw&#160;the&#160;word&#160;<i>map&#160;</i>used&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#100">previous&#160;chapter&#160;</a>for&#160;an&#160;operation&#160;that&#160;trans-<br/>forms&#160;a&#160;data&#160;structure&#160;by&#160;applying&#160;a&#160;function&#160;to&#160;its&#160;elements.&#160;Confusing&#160;as&#160;it<br/>is,&#160;in&#160;programming&#160;the&#160;same&#160;word&#160;is&#160;also&#160;used&#160;for&#160;a&#160;related&#160;but&#160;rather&#160;different<br/>thing.<br/>
A&#160;<i>map&#160;</i>(noun)&#160;is&#160;a&#160;data&#160;structure&#160;that&#160;associates&#160;values&#160;(the&#160;keys)&#160;with&#160;other<br/>
values.&#160;For&#160;example,&#160;you&#160;might&#160;want&#160;to&#160;map&#160;names&#160;to&#160;ages.&#160;It&#160;is&#160;possible&#160;to<br/>use&#160;objects&#160;for&#160;this.<br/>
104<br/>
<hr/>
<a name=117></a>let&#160;ages&#160;=&#160;{<br/>
Boris:&#160;39,<br/>Liang:&#160;22,<br/>Júlia:&#160;62<br/>
};<br/>
console.log(`Júlia&#160;is&#160;${ages[&#34;Júlia&#34;]}`);<br/>//&#160;→&#160;Júlia&#160;is&#160;62<br/>console.log(&#34;Is&#160;Jack's&#160;age&#160;known?&#34;,&#160;&#34;Jack&#34;&#160;in&#160;ages);<br/>//&#160;→&#160;Is&#160;Jack's&#160;age&#160;known?&#160;false<br/>console.log(&#34;Is&#160;toString's&#160;age&#160;known?&#34;,&#160;&#34;toString&#34;&#160;in&#160;ages);<br/>//&#160;→&#160;Is&#160;toString's&#160;age&#160;known?&#160;true<br/>
Here,&#160;the&#160;object’s&#160;property&#160;names&#160;are&#160;the&#160;people’s&#160;names,&#160;and&#160;the&#160;property<br/>
values&#160;are&#160;their&#160;ages.&#160;But&#160;we&#160;certainly&#160;didn’t&#160;list&#160;anybody&#160;named&#160;toString&#160;in<br/>our&#160;map.&#160;Yet,&#160;because&#160;plain&#160;objects&#160;derive&#160;from&#160;Object.prototype,&#160;it&#160;looks<br/>like&#160;the&#160;property&#160;is&#160;there.<br/>
As&#160;such,&#160;using&#160;plain&#160;objects&#160;as&#160;maps&#160;is&#160;dangerous.&#160;There&#160;are&#160;several&#160;possible<br/>
ways&#160;to&#160;avoid&#160;this&#160;problem.&#160;First,&#160;it&#160;is&#160;possible&#160;to&#160;create&#160;objects&#160;with&#160;<i>no<br/></i>prototype.&#160;If&#160;you&#160;pass&#160;null&#160;to&#160;Object.create,&#160;the&#160;resulting&#160;object&#160;will&#160;not<br/>derive&#160;from&#160;Object.prototype&#160;and&#160;can&#160;safely&#160;be&#160;used&#160;as&#160;a&#160;map.<br/>
console.log(&#34;toString&#34;&#160;in&#160;Object.create(null));<br/>//&#160;→&#160;false<br/>
Object&#160;property&#160;names&#160;must&#160;be&#160;strings.&#160;If&#160;you&#160;need&#160;a&#160;map&#160;whose&#160;keys&#160;can’t<br/>
easily&#160;be&#160;converted&#160;to&#160;strings—such&#160;as&#160;objects—you&#160;cannot&#160;use&#160;an&#160;object&#160;as<br/>your&#160;map.<br/>
Fortunately,&#160;JavaScript&#160;comes&#160;with&#160;a&#160;class&#160;called&#160;Map&#160;that&#160;is&#160;written&#160;for&#160;this<br/>
exact&#160;purpose.&#160;It&#160;stores&#160;a&#160;mapping&#160;and&#160;allows&#160;any&#160;type&#160;of&#160;keys.<br/>
let&#160;ages&#160;=&#160;new&#160;Map();<br/>ages.set(&#34;Boris&#34;,&#160;39);<br/>ages.set(&#34;Liang&#34;,&#160;22);<br/>ages.set(&#34;Júlia&#34;,&#160;62);<br/>
console.log(`Júlia&#160;is&#160;${ages.get(&#34;Júlia&#34;)}`);<br/>//&#160;→&#160;Júlia&#160;is&#160;62<br/>console.log(&#34;Is&#160;Jack's&#160;age&#160;known?&#34;,&#160;ages.has(&#34;Jack&#34;));<br/>//&#160;→&#160;Is&#160;Jack's&#160;age&#160;known?&#160;false<br/>console.log(ages.has(&#34;toString&#34;));<br/>//&#160;→&#160;false<br/>
105<br/>
<hr/>
<a name=118></a>The&#160;methods&#160;set,&#160;get,&#160;and&#160;has&#160;are&#160;part&#160;of&#160;the&#160;interface&#160;of&#160;the&#160;Map&#160;object.<br/>
Writing&#160;a&#160;data&#160;structure&#160;that&#160;can&#160;quickly&#160;update&#160;and&#160;search&#160;a&#160;large&#160;set&#160;of<br/>values&#160;isn’t&#160;easy,&#160;but&#160;we&#160;don’t&#160;have&#160;to&#160;worry&#160;about&#160;that.&#160;Someone&#160;else&#160;did&#160;it<br/>for&#160;us,&#160;and&#160;we&#160;can&#160;go&#160;through&#160;this&#160;simple&#160;interface&#160;to&#160;use&#160;their&#160;work.<br/>
If&#160;you&#160;do&#160;have&#160;a&#160;plain&#160;object&#160;that&#160;you&#160;need&#160;to&#160;treat&#160;as&#160;a&#160;map&#160;for&#160;some&#160;reason,<br/>
it&#160;is&#160;useful&#160;to&#160;know&#160;that&#160;Object.keys&#160;returns&#160;only&#160;an&#160;object’s&#160;<i>own&#160;</i>keys,&#160;not<br/>those&#160;in&#160;the&#160;prototype.&#160;As&#160;an&#160;alternative&#160;to&#160;the&#160;in&#160;operator,&#160;you&#160;can&#160;use&#160;the<br/>hasOwnProperty&#160;method,&#160;which&#160;ignores&#160;the&#160;object’s&#160;prototype.<br/>
console.log({x:&#160;1}.hasOwnProperty(&#34;x&#34;));<br/>//&#160;→&#160;true<br/>console.log({x:&#160;1}.hasOwnProperty(&#34;toString&#34;));<br/>//&#160;→&#160;false<br/>
<b>Polymorphism</b><br/>
When&#160;you&#160;call&#160;the&#160;String&#160;function&#160;(which&#160;converts&#160;a&#160;value&#160;to&#160;a&#160;string)&#160;on&#160;an<br/>object,&#160;it&#160;will&#160;call&#160;the&#160;toString&#160;method&#160;on&#160;that&#160;object&#160;to&#160;try&#160;to&#160;create&#160;a&#160;mean-<br/>ingful&#160;string&#160;from&#160;it.&#160;I&#160;mentioned&#160;that&#160;some&#160;of&#160;the&#160;standard&#160;prototypes&#160;define<br/>their&#160;own&#160;version&#160;of&#160;toString&#160;so&#160;they&#160;can&#160;create&#160;a&#160;string&#160;that&#160;contains&#160;more<br/>useful&#160;information&#160;than&#160;&#34;[object&#160;Object]&#34;.&#160;You&#160;can&#160;also&#160;do&#160;that&#160;yourself.<br/>
Rabbit.prototype.toString&#160;=&#160;function()&#160;{<br/>
return&#160;`a&#160;${this.type}&#160;rabbit`;<br/>
};<br/>
console.log(String(blackRabbit));<br/>//&#160;→&#160;a&#160;black&#160;rabbit<br/>
This&#160;is&#160;a&#160;simple&#160;instance&#160;of&#160;a&#160;powerful&#160;idea.&#160;When&#160;a&#160;piece&#160;of&#160;code&#160;is&#160;written<br/>
to&#160;work&#160;with&#160;objects&#160;that&#160;have&#160;a&#160;certain&#160;interface—in&#160;this&#160;case,&#160;a&#160;toString<br/>
method—any&#160;kind&#160;of&#160;object&#160;that&#160;happens&#160;to&#160;support&#160;this&#160;interface&#160;can&#160;be<br/>
plugged&#160;into&#160;the&#160;code,&#160;and&#160;it&#160;will&#160;just&#160;work.<br/>
This&#160;technique&#160;is&#160;called&#160;<i>polymorphism</i>.&#160;Polymorphic&#160;code&#160;can&#160;work&#160;with<br/>
values&#160;of&#160;different&#160;shapes,&#160;as&#160;long&#160;as&#160;they&#160;support&#160;the&#160;interface&#160;it&#160;expects.<br/>
I&#160;mentioned&#160;in&#160;<a href="eloquent-javascripts.html#79">Chapter&#160;4&#160;</a>that&#160;a&#160;for/of&#160;loop&#160;can&#160;loop&#160;over&#160;several&#160;kinds&#160;of<br/>
data&#160;structures.&#160;This&#160;is&#160;another&#160;case&#160;of&#160;polymorphism—such&#160;loops&#160;expect&#160;the<br/>data&#160;structure&#160;to&#160;expose&#160;a&#160;specific&#160;interface,&#160;which&#160;arrays&#160;and&#160;strings&#160;do.&#160;And<br/>
106<br/>
<hr/>
<a name=119></a>we&#160;can&#160;also&#160;add&#160;this&#160;interface&#160;to&#160;your&#160;own&#160;objects!&#160;But&#160;before&#160;we&#160;can&#160;do&#160;that,<br/>we&#160;need&#160;to&#160;know&#160;what&#160;symbols&#160;are.<br/>
<b>Symbols</b><br/>
It&#160;is&#160;possible&#160;for&#160;multiple&#160;interfaces&#160;to&#160;use&#160;the&#160;same&#160;property&#160;name&#160;for&#160;different<br/>things.&#160;For&#160;example,&#160;I&#160;could&#160;define&#160;an&#160;interface&#160;in&#160;which&#160;the&#160;toString&#160;method&#160;is<br/>supposed&#160;to&#160;convert&#160;the&#160;object&#160;into&#160;a&#160;piece&#160;of&#160;yarn.&#160;It&#160;would&#160;not&#160;be&#160;possible&#160;for<br/>an&#160;object&#160;to&#160;conform&#160;to&#160;both&#160;that&#160;interface&#160;and&#160;the&#160;standard&#160;use&#160;of&#160;toString.<br/>
That&#160;would&#160;be&#160;a&#160;bad&#160;idea,&#160;and&#160;this&#160;problem&#160;isn’t&#160;that&#160;common.&#160;Most<br/>
JavaScript&#160;programmers&#160;simply&#160;don’t&#160;think&#160;about&#160;it.&#160;But&#160;the&#160;language&#160;de-<br/>signers,&#160;whose&#160;<i>job&#160;</i>it&#160;is&#160;to&#160;think&#160;about&#160;this&#160;stuff,&#160;have&#160;provided&#160;us&#160;with&#160;a<br/>solution&#160;anyway.<br/>
When&#160;I&#160;claimed&#160;that&#160;property&#160;names&#160;are&#160;strings,&#160;that&#160;wasn’t&#160;entirely&#160;ac-<br/>
curate.&#160;They&#160;usually&#160;are,&#160;but&#160;they&#160;can&#160;also&#160;be&#160;<i>symbols</i>.&#160;Symbols&#160;are&#160;values<br/>created&#160;with&#160;the&#160;Symbol&#160;function.&#160;Unlike&#160;strings,&#160;newly&#160;created&#160;symbols&#160;are<br/>unique—you&#160;cannot&#160;create&#160;the&#160;same&#160;symbol&#160;twice.<br/>
let&#160;sym&#160;=&#160;Symbol(&#34;name&#34;);<br/>console.log(sym&#160;==&#160;Symbol(&#34;name&#34;));<br/>//&#160;→&#160;false<br/>Rabbit.prototype[sym]&#160;=&#160;55;<br/>console.log(blackRabbit[sym]);<br/>//&#160;→&#160;55<br/>
The&#160;string&#160;you&#160;pass&#160;to&#160;Symbol&#160;is&#160;included&#160;when&#160;you&#160;convert&#160;it&#160;to&#160;a&#160;string<br/>
and&#160;can&#160;make&#160;it&#160;easier&#160;to&#160;recognize&#160;a&#160;symbol&#160;when,&#160;for&#160;example,&#160;showing&#160;it&#160;in<br/>the&#160;console.&#160;But&#160;it&#160;has&#160;no&#160;meaning&#160;beyond&#160;that—multiple&#160;symbols&#160;may&#160;have<br/>the&#160;same&#160;name.<br/>
Being&#160;both&#160;unique&#160;and&#160;usable&#160;as&#160;property&#160;names&#160;makes&#160;symbols&#160;suitable<br/>
for&#160;defining&#160;interfaces&#160;that&#160;can&#160;peacefully&#160;live&#160;alongside&#160;other&#160;properties,&#160;no<br/>matter&#160;what&#160;their&#160;names&#160;are.<br/>
const&#160;toStringSymbol&#160;=&#160;Symbol(&#34;toString&#34;);<br/>Array.prototype[toStringSymbol]&#160;=&#160;function()&#160;{<br/>
return&#160;`${this.length}&#160;cm&#160;of&#160;blue&#160;yarn`;<br/>
};<br/>
console.log([1,&#160;2].toString());<br/>//&#160;→&#160;1,2<br/>console.log([1,&#160;2][toStringSymbol]());<br/>
107<br/>
<hr/>
<a name=120></a>//&#160;→&#160;2&#160;cm&#160;of&#160;blue&#160;yarn<br/>
It&#160;is&#160;possible&#160;to&#160;include&#160;symbol&#160;properties&#160;in&#160;object&#160;expressions&#160;and&#160;classes<br/>
by&#160;using&#160;square&#160;brackets&#160;around&#160;the&#160;property&#160;name.&#160;That&#160;causes&#160;the&#160;property<br/>name&#160;to&#160;be&#160;evaluated,&#160;much&#160;like&#160;the&#160;square&#160;bracket&#160;property&#160;access&#160;notation,<br/>which&#160;allows&#160;us&#160;to&#160;refer&#160;to&#160;a&#160;binding&#160;that&#160;holds&#160;the&#160;symbol.<br/>
let&#160;stringObject&#160;=&#160;{<br/>
[toStringSymbol]()&#160;{&#160;return&#160;&#34;a&#160;jute&#160;rope&#34;;&#160;}<br/>
};<br/>console.log(stringObject[toStringSymbol]());<br/>//&#160;→&#160;a&#160;jute&#160;rope<br/>
<b>The&#160;iterator&#160;interface</b><br/>
The&#160;object&#160;given&#160;to&#160;a&#160;for/of&#160;loop&#160;is&#160;expected&#160;to&#160;be&#160;<i>iterable</i>.&#160;This&#160;means&#160;it&#160;has<br/>a&#160;method&#160;named&#160;with&#160;the&#160;Symbol.iterator&#160;symbol&#160;(a&#160;symbol&#160;value&#160;defined&#160;by<br/>the&#160;language,&#160;stored&#160;as&#160;a&#160;property&#160;of&#160;the&#160;Symbol&#160;function).<br/>
When&#160;called,&#160;that&#160;method&#160;should&#160;return&#160;an&#160;object&#160;that&#160;provides&#160;a&#160;second<br/>
interface,&#160;<i>iterator</i>.&#160;This&#160;is&#160;the&#160;actual&#160;thing&#160;that&#160;iterates.&#160;It&#160;has&#160;a&#160;next&#160;method<br/>that&#160;returns&#160;the&#160;next&#160;result.&#160;That&#160;result&#160;should&#160;be&#160;an&#160;object&#160;with&#160;a&#160;value<br/>property&#160;that&#160;provides&#160;the&#160;next&#160;value,&#160;if&#160;there&#160;is&#160;one,&#160;and&#160;a&#160;done&#160;property,<br/>which&#160;should&#160;be&#160;true&#160;when&#160;there&#160;are&#160;no&#160;more&#160;results&#160;and&#160;false&#160;otherwise.<br/>
Note&#160;that&#160;the&#160;next,&#160;value,&#160;and&#160;done&#160;property&#160;names&#160;are&#160;plain&#160;strings,&#160;not<br/>
symbols.&#160;Only&#160;Symbol.iterator,&#160;which&#160;is&#160;likely&#160;to&#160;be&#160;added&#160;to&#160;a&#160;<i>lot&#160;</i>of&#160;different<br/>objects,&#160;is&#160;an&#160;actual&#160;symbol.<br/>
We&#160;can&#160;directly&#160;use&#160;this&#160;interface&#160;ourselves.<br/>
let&#160;okIterator&#160;=&#160;&#34;OK&#34;[Symbol.iterator]();<br/>console.log(okIterator.next());<br/>//&#160;→&#160;{value:&#160;&#34;O&#34;,&#160;done:&#160;false}<br/>console.log(okIterator.next());<br/>//&#160;→&#160;{value:&#160;&#34;K&#34;,&#160;done:&#160;false}<br/>console.log(okIterator.next());<br/>//&#160;→&#160;{value:&#160;undefined,&#160;done:&#160;true}<br/>
Let’s&#160;implement&#160;an&#160;iterable&#160;data&#160;structure.&#160;We’ll&#160;build&#160;a&#160;<i>matrix&#160;</i>class,&#160;acting<br/>
as&#160;a&#160;two-dimensional&#160;array.<br/>
108<br/>
<hr/>
<a name=121></a>class&#160;Matrix&#160;{<br/>
constructor(width,&#160;height,&#160;element&#160;=&#160;(x,&#160;y)&#160;=&gt;&#160;undefined)&#160;{<br/>
this.width&#160;=&#160;width;<br/>this.height&#160;=&#160;height;<br/>this.content&#160;=&#160;[];<br/>
for&#160;(let&#160;y&#160;=&#160;0;&#160;y&#160;&lt;&#160;height;&#160;y++)&#160;{<br/>
for&#160;(let&#160;x&#160;=&#160;0;&#160;x&#160;&lt;&#160;width;&#160;x++)&#160;{<br/>
this.content[y&#160;*&#160;width&#160;+&#160;x]&#160;=&#160;element(x,&#160;y);<br/>
}<br/>
}<br/>
}<br/>
get(x,&#160;y)&#160;{<br/>
return&#160;this.content[y&#160;*&#160;this.width&#160;+&#160;x];<br/>
}<br/>set(x,&#160;y,&#160;value)&#160;{<br/>
this.content[y&#160;*&#160;this.width&#160;+&#160;x]&#160;=&#160;value;<br/>
}<br/>
}<br/>
The&#160;class&#160;stores&#160;its&#160;content&#160;in&#160;a&#160;single&#160;array&#160;of&#160;<i>width&#160;</i>×&#160;<i>height&#160;</i>elements.&#160;The<br/>
elements&#160;are&#160;stored&#160;row&#160;by&#160;row,&#160;so,&#160;for&#160;example,&#160;the&#160;third&#160;element&#160;in&#160;the&#160;fifth<br/>row&#160;is&#160;(using&#160;zero-based&#160;indexing)&#160;stored&#160;at&#160;position&#160;4&#160;×&#160;<i>width&#160;</i>+&#160;2.<br/>
The&#160;constructor&#160;function&#160;takes&#160;a&#160;width,&#160;a&#160;height,&#160;and&#160;an&#160;optional&#160;element<br/>
function&#160;that&#160;will&#160;be&#160;used&#160;to&#160;fill&#160;in&#160;the&#160;initial&#160;values.&#160;There&#160;are&#160;get&#160;and&#160;set<br/>methods&#160;to&#160;retrieve&#160;and&#160;update&#160;elements&#160;in&#160;the&#160;matrix.<br/>
When&#160;looping&#160;over&#160;a&#160;matrix,&#160;you&#160;are&#160;usually&#160;interested&#160;in&#160;the&#160;position&#160;of&#160;the<br/>
elements&#160;as&#160;well&#160;as&#160;the&#160;elements&#160;themselves,&#160;so&#160;we’ll&#160;have&#160;our&#160;iterator&#160;produce<br/>objects&#160;with&#160;x,&#160;y,&#160;and&#160;value&#160;properties.<br/>
class&#160;MatrixIterator&#160;{<br/>
constructor(matrix)&#160;{<br/>
this.x&#160;=&#160;0;<br/>this.y&#160;=&#160;0;<br/>this.matrix&#160;=&#160;matrix;<br/>
}<br/>
next()&#160;{<br/>
if&#160;(this.y&#160;==&#160;this.matrix.height)&#160;return&#160;{done:&#160;true};<br/>
let&#160;value&#160;=&#160;{x:&#160;this.x,<br/>
y:&#160;this.y,<br/>value:&#160;this.matrix.get(this.x,&#160;this.y)};<br/>
109<br/>
<hr/>
<a name=122></a>this.x++;<br/>if&#160;(this.x&#160;==&#160;this.matrix.width)&#160;{<br/>
this.x&#160;=&#160;0;<br/>this.y++;<br/>
}<br/>return&#160;{value,&#160;done:&#160;false};<br/>
}<br/>
}<br/>
The&#160;class&#160;tracks&#160;the&#160;progress&#160;of&#160;iterating&#160;over&#160;a&#160;matrix&#160;in&#160;its&#160;x&#160;and&#160;y&#160;prop-<br/>
erties.&#160;The&#160;next&#160;method&#160;starts&#160;by&#160;checking&#160;whether&#160;the&#160;bottom&#160;of&#160;the&#160;matrix<br/>has&#160;been&#160;reached.&#160;If&#160;it&#160;hasn’t,&#160;it&#160;<i>first&#160;</i>creates&#160;the&#160;object&#160;holding&#160;the&#160;current<br/>value&#160;and&#160;<i>then&#160;</i>updates&#160;its&#160;position,&#160;moving&#160;to&#160;the&#160;next&#160;row&#160;if&#160;necessary.<br/>
Let’s&#160;set&#160;up&#160;the&#160;Matrix&#160;class&#160;to&#160;be&#160;iterable.&#160;Throughout&#160;this&#160;book,&#160;I’ll&#160;oc-<br/>
casionally&#160;use&#160;after-the-fact&#160;prototype&#160;manipulation&#160;to&#160;add&#160;methods&#160;to&#160;classes<br/>so&#160;that&#160;the&#160;individual&#160;pieces&#160;of&#160;code&#160;remain&#160;small&#160;and&#160;self-contained.&#160;In&#160;a&#160;reg-<br/>ular&#160;program,&#160;where&#160;there&#160;is&#160;no&#160;need&#160;to&#160;split&#160;the&#160;code&#160;into&#160;small&#160;pieces,&#160;you’d<br/>declare&#160;these&#160;methods&#160;directly&#160;in&#160;the&#160;class&#160;instead.<br/>
Matrix.prototype[Symbol.iterator]&#160;=&#160;function()&#160;{<br/>
return&#160;new&#160;MatrixIterator(this);<br/>
};<br/>
We&#160;can&#160;now&#160;loop&#160;over&#160;a&#160;matrix&#160;with&#160;for/of.<br/>
let&#160;matrix&#160;=&#160;new&#160;Matrix(2,&#160;2,&#160;(x,&#160;y)&#160;=&gt;&#160;`value&#160;${x},${y}`);<br/>for&#160;(let&#160;{x,&#160;y,&#160;value}&#160;of&#160;matrix)&#160;{<br/>
console.log(x,&#160;y,&#160;value);<br/>
}<br/>//&#160;→&#160;0&#160;0&#160;value&#160;0,0<br/>//&#160;→&#160;1&#160;0&#160;value&#160;1,0<br/>//&#160;→&#160;0&#160;1&#160;value&#160;0,1<br/>//&#160;→&#160;1&#160;1&#160;value&#160;1,1<br/>
<b>Getters,&#160;setters,&#160;and&#160;statics</b><br/>
Interfaces&#160;often&#160;consist&#160;mostly&#160;of&#160;methods,&#160;but&#160;it&#160;is&#160;also&#160;okay&#160;to&#160;include&#160;prop-<br/>erties&#160;that&#160;hold&#160;non-function&#160;values.&#160;For&#160;example,&#160;Map&#160;objects&#160;have&#160;a&#160;size<br/>property&#160;that&#160;tells&#160;you&#160;how&#160;many&#160;keys&#160;are&#160;stored&#160;in&#160;them.<br/>
It&#160;is&#160;not&#160;even&#160;necessary&#160;for&#160;such&#160;an&#160;object&#160;to&#160;compute&#160;and&#160;store&#160;such&#160;a<br/>
110<br/>
<hr/>
<a name=123></a>property&#160;directly&#160;in&#160;the&#160;instance.&#160;Even&#160;properties&#160;that&#160;are&#160;accessed&#160;directly<br/>may&#160;hide&#160;a&#160;method&#160;call.&#160;Such&#160;methods&#160;are&#160;called&#160;<i>getters</i>,&#160;and&#160;they&#160;are&#160;defined<br/>by&#160;writing&#160;get&#160;in&#160;front&#160;of&#160;the&#160;method&#160;name&#160;in&#160;an&#160;object&#160;expression&#160;or&#160;class<br/>declaration.<br/>
let&#160;varyingSize&#160;=&#160;{<br/>
get&#160;size()&#160;{<br/>
return&#160;Math.floor(Math.random()&#160;*&#160;100);<br/>
}<br/>
};<br/>
console.log(varyingSize.size);<br/>//&#160;→&#160;73<br/>console.log(varyingSize.size);<br/>//&#160;→&#160;49<br/>
Whenever&#160;someone&#160;reads&#160;from&#160;this&#160;object’s&#160;size&#160;property,&#160;the&#160;associated<br/>
method&#160;is&#160;called.&#160;You&#160;can&#160;do&#160;a&#160;similar&#160;thing&#160;when&#160;a&#160;property&#160;is&#160;written&#160;to,<br/>using&#160;a&#160;<i>setter</i>.<br/>
class&#160;Temperature&#160;{<br/>
constructor(celsius)&#160;{<br/>
this.celsius&#160;=&#160;celsius;<br/>
}<br/>get&#160;fahrenheit()&#160;{<br/>
return&#160;this.celsius&#160;*&#160;1.8&#160;+&#160;32;<br/>
}<br/>set&#160;fahrenheit(value)&#160;{<br/>
this.celsius&#160;=&#160;(value&#160;-&#160;32)&#160;/&#160;1.8;<br/>
}<br/>
static&#160;fromFahrenheit(value)&#160;{<br/>
return&#160;new&#160;Temperature((value&#160;-&#160;32)&#160;/&#160;1.8);<br/>
}<br/>
}<br/>
let&#160;temp&#160;=&#160;new&#160;Temperature(22);<br/>console.log(temp.fahrenheit);<br/>//&#160;→&#160;71.6<br/>temp.fahrenheit&#160;=&#160;86;<br/>console.log(temp.celsius);<br/>//&#160;→&#160;30<br/>
111<br/>
<hr/>
<a name=124></a>The&#160;Temperature&#160;class&#160;allows&#160;you&#160;to&#160;read&#160;and&#160;write&#160;the&#160;temperature&#160;in&#160;either<br/>
degrees&#160;Celsius&#160;or&#160;degrees&#160;Fahrenheit,&#160;but&#160;internally&#160;it&#160;stores&#160;only&#160;Celsius&#160;and<br/>automatically&#160;converts&#160;to&#160;and&#160;from&#160;Celsius&#160;in&#160;the&#160;fahrenheit&#160;getter&#160;and&#160;setter.<br/>
Sometimes&#160;you&#160;want&#160;to&#160;attach&#160;some&#160;properties&#160;directly&#160;to&#160;your&#160;constructor<br/>
function,&#160;rather&#160;than&#160;to&#160;the&#160;prototype.&#160;Such&#160;methods&#160;won’t&#160;have&#160;access&#160;to<br/>a&#160;class&#160;instance&#160;but&#160;can,&#160;for&#160;example,&#160;be&#160;used&#160;to&#160;provide&#160;additional&#160;ways&#160;to<br/>create&#160;instances.<br/>
Inside&#160;a&#160;class&#160;declaration,&#160;methods&#160;that&#160;have&#160;static&#160;written&#160;before&#160;their<br/>
name&#160;are&#160;stored&#160;on&#160;the&#160;constructor.&#160;So&#160;the&#160;Temperature&#160;class&#160;allows&#160;you&#160;to<br/>write&#160;Temperature.fromFahrenheit(100)&#160;to&#160;create&#160;a&#160;temperature&#160;using&#160;degrees<br/>Fahrenheit.<br/>
<b>Inheritance</b><br/>
Some&#160;matrices&#160;are&#160;known&#160;to&#160;be&#160;<i>symmetric</i>.&#160;If&#160;you&#160;mirror&#160;a&#160;symmetric&#160;matrix<br/>around&#160;its&#160;top-left-to-bottom-right&#160;diagonal,&#160;it&#160;stays&#160;the&#160;same.&#160;In&#160;other&#160;words,<br/>the&#160;value&#160;stored&#160;at&#160;<i>x</i>,<i>y&#160;</i>is&#160;always&#160;the&#160;same&#160;as&#160;that&#160;at&#160;<i>y</i>,<i>x</i>.<br/>
Imagine&#160;we&#160;need&#160;a&#160;data&#160;structure&#160;like&#160;Matrix&#160;but&#160;one&#160;that&#160;enforces&#160;the&#160;fact<br/>
that&#160;the&#160;matrix&#160;is&#160;and&#160;remains&#160;symmetrical.&#160;We&#160;could&#160;write&#160;it&#160;from&#160;scratch,<br/>but&#160;that&#160;would&#160;involve&#160;repeating&#160;some&#160;code&#160;very&#160;similar&#160;to&#160;what&#160;we&#160;already<br/>wrote.<br/>
JavaScript’s&#160;prototype&#160;system&#160;makes&#160;it&#160;possible&#160;to&#160;create&#160;a&#160;<i>new&#160;</i>class,&#160;much<br/>
like&#160;the&#160;old&#160;class,&#160;but&#160;with&#160;new&#160;definitions&#160;for&#160;some&#160;of&#160;its&#160;properties.&#160;The<br/>prototype&#160;for&#160;the&#160;new&#160;class&#160;derives&#160;from&#160;the&#160;old&#160;prototype&#160;but&#160;adds&#160;a&#160;new<br/>definition&#160;for,&#160;say,&#160;the&#160;set&#160;method.<br/>
In&#160;object-oriented&#160;programming&#160;terms,&#160;this&#160;is&#160;called&#160;<i>inheritance</i>.&#160;The&#160;new<br/>
class&#160;inherits&#160;properties&#160;and&#160;behavior&#160;from&#160;the&#160;old&#160;class.<br/>
class&#160;SymmetricMatrix&#160;extends&#160;Matrix&#160;{<br/>
constructor(size,&#160;element&#160;=&#160;(x,&#160;y)&#160;=&gt;&#160;undefined)&#160;{<br/>
super(size,&#160;size,&#160;(x,&#160;y)&#160;=&gt;&#160;{<br/>
if&#160;(x&#160;&lt;&#160;y)&#160;return&#160;element(y,&#160;x);<br/>else&#160;return&#160;element(x,&#160;y);<br/>
});<br/>
}<br/>
set(x,&#160;y,&#160;value)&#160;{<br/>
super.set(x,&#160;y,&#160;value);<br/>if&#160;(x&#160;!=&#160;y)&#160;{<br/>
super.set(y,&#160;x,&#160;value);<br/>
}<br/>
}<br/>
112<br/>
<hr/>
<a name=125></a>}<br/>
let&#160;matrix&#160;=&#160;new&#160;SymmetricMatrix(5,&#160;(x,&#160;y)&#160;=&gt;&#160;`${x},${y}`);<br/>console.log(matrix.get(2,&#160;3));<br/>//&#160;→&#160;3,2<br/>
The&#160;use&#160;of&#160;the&#160;word&#160;extends&#160;indicates&#160;that&#160;this&#160;class&#160;shouldn’t&#160;be&#160;directly<br/>
based&#160;on&#160;the&#160;default&#160;Object&#160;prototype&#160;but&#160;on&#160;some&#160;other&#160;class.&#160;This&#160;is&#160;called<br/>the&#160;<i>superclass</i>.&#160;The&#160;derived&#160;class&#160;is&#160;the&#160;<i>subclass</i>.<br/>
To&#160;initialize&#160;a&#160;SymmetricMatrix&#160;instance,&#160;the&#160;constructor&#160;calls&#160;its&#160;superclass’s<br/>
constructor&#160;through&#160;the&#160;super&#160;keyword.&#160;This&#160;is&#160;necessary&#160;because&#160;if&#160;this&#160;new<br/>object&#160;is&#160;to&#160;behave&#160;(roughly)&#160;like&#160;a&#160;Matrix,&#160;it&#160;is&#160;going&#160;to&#160;need&#160;the&#160;instance<br/>properties&#160;that&#160;matrices&#160;have.&#160;To&#160;ensure&#160;the&#160;matrix&#160;is&#160;symmetrical,&#160;the&#160;con-<br/>structor&#160;wraps&#160;the&#160;element&#160;function&#160;to&#160;swap&#160;the&#160;coordinates&#160;for&#160;values&#160;below<br/>the&#160;diagonal.<br/>
The&#160;set&#160;method&#160;again&#160;uses&#160;super&#160;but&#160;this&#160;time&#160;not&#160;to&#160;call&#160;the&#160;constructor<br/>
but&#160;to&#160;call&#160;a&#160;specific&#160;method&#160;from&#160;the&#160;superclass’s&#160;set&#160;of&#160;methods.&#160;We&#160;are<br/>redefining&#160;set&#160;but&#160;do&#160;want&#160;to&#160;use&#160;the&#160;original&#160;behavior.&#160;Because&#160;this.set<br/>refers&#160;to&#160;the&#160;<i>new&#160;</i>set&#160;method,&#160;calling&#160;that&#160;wouldn’t&#160;work.&#160;Inside&#160;class&#160;methods,<br/>super&#160;provides&#160;a&#160;way&#160;to&#160;call&#160;methods&#160;as&#160;they&#160;were&#160;defined&#160;in&#160;the&#160;superclass.<br/>
Inheritance&#160;allows&#160;us&#160;to&#160;build&#160;slightly&#160;different&#160;data&#160;types&#160;from&#160;existing&#160;data<br/>
types&#160;with&#160;relatively&#160;little&#160;work.&#160;It&#160;is&#160;a&#160;fundamental&#160;part&#160;of&#160;the&#160;object-oriented<br/>tradition,&#160;alongside&#160;encapsulation&#160;and&#160;polymorphism.&#160;But&#160;while&#160;the&#160;latter&#160;two<br/>are&#160;now&#160;generally&#160;regarded&#160;as&#160;wonderful&#160;ideas,&#160;inheritance&#160;is&#160;more&#160;controversial.<br/>
Whereas&#160;encapsulation&#160;and&#160;polymorphism&#160;can&#160;be&#160;used&#160;to&#160;<i>separate&#160;</i>pieces<br/>
of&#160;code&#160;from&#160;each&#160;other,&#160;reducing&#160;the&#160;tangledness&#160;of&#160;the&#160;overall&#160;program,&#160;in-<br/>heritance&#160;fundamentally&#160;ties&#160;classes&#160;together,&#160;creating&#160;<i>more&#160;</i>tangle.&#160;When<br/>inheriting&#160;from&#160;a&#160;class,&#160;you&#160;usually&#160;have&#160;to&#160;know&#160;more&#160;about&#160;how&#160;it&#160;works<br/>than&#160;when&#160;simply&#160;using&#160;it.&#160;Inheritance&#160;can&#160;be&#160;a&#160;useful&#160;tool,&#160;and&#160;I&#160;use&#160;it&#160;now<br/>and&#160;then&#160;in&#160;my&#160;own&#160;programs,&#160;but&#160;it&#160;shouldn’t&#160;be&#160;the&#160;first&#160;tool&#160;you&#160;reach&#160;for,<br/>and&#160;you&#160;probably&#160;shouldn’t&#160;actively&#160;go&#160;looking&#160;for&#160;opportunities&#160;to&#160;construct<br/>class&#160;hierarchies&#160;(family&#160;trees&#160;of&#160;classes).<br/>
<b>The&#160;instanceof&#160;operator</b><br/>
It&#160;is&#160;occasionally&#160;useful&#160;to&#160;know&#160;whether&#160;an&#160;object&#160;was&#160;derived&#160;from&#160;a&#160;specific<br/>class.&#160;For&#160;this,&#160;JavaScript&#160;provides&#160;a&#160;binary&#160;operator&#160;called&#160;instanceof.<br/>
console.log(<br/>
new&#160;SymmetricMatrix(2)&#160;instanceof&#160;SymmetricMatrix);<br/>
113<br/>
<hr/>
<a name=126></a>//&#160;→&#160;true<br/>console.log(new&#160;SymmetricMatrix(2)&#160;instanceof&#160;Matrix);<br/>//&#160;→&#160;true<br/>console.log(new&#160;Matrix(2,&#160;2)&#160;instanceof&#160;SymmetricMatrix);<br/>//&#160;→&#160;false<br/>console.log([1]&#160;instanceof&#160;Array);<br/>//&#160;→&#160;true<br/>
The&#160;operator&#160;will&#160;see&#160;through&#160;inherited&#160;types,&#160;so&#160;a&#160;SymmetricMatrix&#160;is&#160;an<br/>
instance&#160;of&#160;Matrix.&#160;The&#160;operator&#160;can&#160;also&#160;be&#160;applied&#160;to&#160;standard&#160;constructors<br/>like&#160;Array.&#160;Almost&#160;every&#160;object&#160;is&#160;an&#160;instance&#160;of&#160;Object.<br/>
<b>Summary</b><br/>
So&#160;objects&#160;do&#160;more&#160;than&#160;just&#160;hold&#160;their&#160;own&#160;properties.&#160;They&#160;have&#160;prototypes,<br/>which&#160;are&#160;other&#160;objects.&#160;They’ll&#160;act&#160;as&#160;if&#160;they&#160;have&#160;properties&#160;they&#160;don’t&#160;have<br/>as&#160;long&#160;as&#160;their&#160;prototype&#160;has&#160;that&#160;property.&#160;Simple&#160;objects&#160;have&#160;Object.<br/>prototype&#160;as&#160;their&#160;prototype.<br/>
Constructors,&#160;which&#160;are&#160;functions&#160;whose&#160;names&#160;usually&#160;start&#160;with&#160;a&#160;capital<br/>
letter,&#160;can&#160;be&#160;used&#160;with&#160;the&#160;new&#160;operator&#160;to&#160;create&#160;new&#160;objects.&#160;The&#160;new<br/>object’s&#160;prototype&#160;will&#160;be&#160;the&#160;object&#160;found&#160;in&#160;the&#160;prototype&#160;property&#160;of&#160;the<br/>constructor.&#160;You&#160;can&#160;make&#160;good&#160;use&#160;of&#160;this&#160;by&#160;putting&#160;the&#160;properties&#160;that&#160;all<br/>values&#160;of&#160;a&#160;given&#160;type&#160;share&#160;into&#160;their&#160;prototype.&#160;There’s&#160;a&#160;class&#160;notation&#160;that<br/>provides&#160;a&#160;clear&#160;way&#160;to&#160;define&#160;a&#160;constructor&#160;and&#160;its&#160;prototype.<br/>
You&#160;can&#160;define&#160;getters&#160;and&#160;setters&#160;to&#160;secretly&#160;call&#160;methods&#160;every&#160;time&#160;an<br/>
object’s&#160;property&#160;is&#160;accessed.&#160;Static&#160;methods&#160;are&#160;methods&#160;stored&#160;in&#160;a&#160;class’s<br/>constructor,&#160;rather&#160;than&#160;its&#160;prototype.<br/>
The&#160;instanceof&#160;operator&#160;can,&#160;given&#160;an&#160;object&#160;and&#160;a&#160;constructor,&#160;tell&#160;you<br/>
whether&#160;that&#160;object&#160;is&#160;an&#160;instance&#160;of&#160;that&#160;constructor.<br/>
One&#160;useful&#160;thing&#160;to&#160;do&#160;with&#160;objects&#160;is&#160;to&#160;specify&#160;an&#160;interface&#160;for&#160;them&#160;and<br/>
tell&#160;everybody&#160;that&#160;they&#160;are&#160;supposed&#160;to&#160;talk&#160;to&#160;your&#160;object&#160;only&#160;through&#160;that<br/>interface.&#160;The&#160;rest&#160;of&#160;the&#160;details&#160;that&#160;make&#160;up&#160;your&#160;object&#160;are&#160;now&#160;<i>encapsulated</i>,<br/>hidden&#160;behind&#160;the&#160;interface.<br/>
More&#160;than&#160;one&#160;type&#160;may&#160;implement&#160;the&#160;same&#160;interface.&#160;Code&#160;written&#160;to&#160;use<br/>
an&#160;interface&#160;automatically&#160;knows&#160;how&#160;to&#160;work&#160;with&#160;any&#160;number&#160;of&#160;different<br/>objects&#160;that&#160;provide&#160;the&#160;interface.&#160;This&#160;is&#160;called&#160;<i>polymorphism</i>.<br/>
When&#160;implementing&#160;multiple&#160;classes&#160;that&#160;differ&#160;in&#160;only&#160;some&#160;details,&#160;it&#160;can<br/>
be&#160;helpful&#160;to&#160;write&#160;the&#160;new&#160;classes&#160;as&#160;<i>subclasses&#160;</i>of&#160;an&#160;existing&#160;class,&#160;<i>inheriting<br/></i>part&#160;of&#160;its&#160;behavior.<br/>
114<br/>
<hr/>
<a name=127></a><b>Exercises</b><br/>
<b>A&#160;vector&#160;type</b><br/>
Write&#160;a&#160;class&#160;Vec&#160;that&#160;represents&#160;a&#160;vector&#160;in&#160;two-dimensional&#160;space.&#160;It&#160;takes<br/>x&#160;and&#160;y&#160;parameters&#160;(numbers),&#160;which&#160;it&#160;should&#160;save&#160;to&#160;properties&#160;of&#160;the&#160;same<br/>name.<br/>
Give&#160;the&#160;Vec&#160;prototype&#160;two&#160;methods,&#160;plus&#160;and&#160;minus,&#160;that&#160;take&#160;another<br/>
vector&#160;as&#160;a&#160;parameter&#160;and&#160;return&#160;a&#160;new&#160;vector&#160;that&#160;has&#160;the&#160;sum&#160;or&#160;difference<br/>of&#160;the&#160;two&#160;vectors’&#160;(this&#160;and&#160;the&#160;parameter)&#160;<i>x&#160;</i>and&#160;<i>y&#160;</i>values.<br/>
Add&#160;a&#160;getter&#160;property&#160;length&#160;to&#160;the&#160;prototype&#160;that&#160;computes&#160;the&#160;length&#160;of<br/>
the&#160;vector—that&#160;is,&#160;the&#160;distance&#160;of&#160;the&#160;point&#160;(<i>x</i>,&#160;<i>y</i>)&#160;from&#160;the&#160;origin&#160;(0,&#160;0).<br/>
<b>Groups</b><br/>
The&#160;standard&#160;JavaScript&#160;environment&#160;provides&#160;another&#160;data&#160;structure&#160;called<br/>Set.&#160;Like&#160;an&#160;instance&#160;of&#160;Map,&#160;a&#160;set&#160;holds&#160;a&#160;collection&#160;of&#160;values.&#160;Unlike&#160;Map,&#160;it<br/>does&#160;not&#160;associate&#160;other&#160;values&#160;with&#160;those—it&#160;just&#160;tracks&#160;which&#160;values&#160;are&#160;part<br/>of&#160;the&#160;set.&#160;A&#160;value&#160;can&#160;be&#160;part&#160;of&#160;a&#160;set&#160;only&#160;once—adding&#160;it&#160;again&#160;doesn’t&#160;have<br/>any&#160;effect.<br/>
Write&#160;a&#160;class&#160;called&#160;Group&#160;(since&#160;Set&#160;is&#160;already&#160;taken).&#160;Like&#160;Set,&#160;it&#160;has&#160;add,<br/>
delete,&#160;and&#160;has&#160;methods.&#160;Its&#160;constructor&#160;creates&#160;an&#160;empty&#160;group,&#160;add&#160;adds<br/>a&#160;value&#160;to&#160;the&#160;group&#160;(but&#160;only&#160;if&#160;it&#160;isn’t&#160;already&#160;a&#160;member),&#160;delete&#160;removes<br/>its&#160;argument&#160;from&#160;the&#160;group&#160;(if&#160;it&#160;was&#160;a&#160;member),&#160;and&#160;has&#160;returns&#160;a&#160;Boolean<br/>value&#160;indicating&#160;whether&#160;its&#160;argument&#160;is&#160;a&#160;member&#160;of&#160;the&#160;group.<br/>
Use&#160;the&#160;===&#160;operator,&#160;or&#160;something&#160;equivalent&#160;such&#160;as&#160;indexOf,&#160;to&#160;determine<br/>
whether&#160;two&#160;values&#160;are&#160;the&#160;same.<br/>
Give&#160;the&#160;class&#160;a&#160;static&#160;from&#160;method&#160;that&#160;takes&#160;an&#160;iterable&#160;object&#160;as&#160;argument<br/>
and&#160;creates&#160;a&#160;group&#160;that&#160;contains&#160;all&#160;the&#160;values&#160;produced&#160;by&#160;iterating&#160;over&#160;it.<br/>
<b>Iterable&#160;groups</b><br/>
Make&#160;the&#160;Group&#160;class&#160;from&#160;the&#160;previous&#160;exercise&#160;iterable.&#160;Refer&#160;to&#160;the&#160;section<br/>about&#160;the&#160;iterator&#160;interface&#160;earlier&#160;in&#160;the&#160;chapter&#160;if&#160;you&#160;aren’t&#160;clear&#160;on&#160;the<br/>exact&#160;form&#160;of&#160;the&#160;interface&#160;anymore.<br/>
If&#160;you&#160;used&#160;an&#160;array&#160;to&#160;represent&#160;the&#160;group’s&#160;members,&#160;don’t&#160;just&#160;return&#160;the<br/>
iterator&#160;created&#160;by&#160;calling&#160;the&#160;Symbol.iterator&#160;method&#160;on&#160;the&#160;array.&#160;That<br/>would&#160;work,&#160;but&#160;it&#160;defeats&#160;the&#160;purpose&#160;of&#160;this&#160;exercise.<br/>
It&#160;is&#160;okay&#160;if&#160;your&#160;iterator&#160;behaves&#160;strangely&#160;when&#160;the&#160;group&#160;is&#160;modified&#160;during<br/>
iteration.<br/>
115<br/>
<hr/>
<a name=128></a><b>Borrowing&#160;a&#160;method</b><br/>
Earlier&#160;in&#160;the&#160;chapter&#160;I&#160;mentioned&#160;that&#160;an&#160;object’s&#160;hasOwnProperty&#160;can&#160;be<br/>used&#160;as&#160;a&#160;more&#160;robust&#160;alternative&#160;to&#160;the&#160;in&#160;operator&#160;when&#160;you&#160;want&#160;to&#160;ignore<br/>the&#160;prototype’s&#160;properties.&#160;But&#160;what&#160;if&#160;your&#160;map&#160;needs&#160;to&#160;include&#160;the&#160;word<br/>&#34;hasOwnProperty&#34;?&#160;You&#160;won’t&#160;be&#160;able&#160;to&#160;call&#160;that&#160;method&#160;anymore&#160;because<br/>the&#160;object’s&#160;own&#160;property&#160;hides&#160;the&#160;method&#160;value.<br/>
Can&#160;you&#160;think&#160;of&#160;a&#160;way&#160;to&#160;call&#160;hasOwnProperty&#160;on&#160;an&#160;object&#160;that&#160;has&#160;its&#160;own<br/>
property&#160;by&#160;that&#160;name?<br/>
116<br/>
<hr/>
<a name=129></a><i>“[...]&#160;the&#160;question&#160;of&#160;whether&#160;Machines&#160;Can&#160;Think&#160;[...]&#160;is&#160;about&#160;as</i><br/>
<i>relevant&#160;as&#160;the&#160;question&#160;of&#160;whether&#160;Submarines&#160;Can&#160;Swim.”</i><br/>
—Edsger&#160;Dijkstra,&#160;The&#160;Threats&#160;to&#160;Computing&#160;Science<br/>
<b>Chapter&#160;7<br/>Project:&#160;A&#160;Robot</b><br/>
In&#160;“project”&#160;chapters,&#160;I’ll&#160;stop&#160;pummeling&#160;you&#160;with&#160;new&#160;theory&#160;for&#160;a&#160;brief&#160;mo-<br/>ment,&#160;and&#160;instead&#160;we’ll&#160;work&#160;through&#160;a&#160;program&#160;together.&#160;Theory&#160;is&#160;necessary<br/>to&#160;learn&#160;to&#160;program,&#160;but&#160;reading&#160;and&#160;understanding&#160;actual&#160;programs&#160;is&#160;just&#160;as<br/>important.<br/>
Our&#160;project&#160;in&#160;this&#160;chapter&#160;is&#160;to&#160;build&#160;an&#160;automaton,&#160;a&#160;little&#160;program&#160;that<br/>
performs&#160;a&#160;task&#160;in&#160;a&#160;virtual&#160;world.&#160;Our&#160;automaton&#160;will&#160;be&#160;a&#160;mail-delivery&#160;robot<br/>picking&#160;up&#160;and&#160;dropping&#160;off&#160;parcels.<br/>
<b>Meadowfield</b><br/>
The&#160;village&#160;of&#160;Meadowfield&#160;isn’t&#160;very&#160;big.&#160;It&#160;consists&#160;of&#160;11&#160;places&#160;with&#160;14&#160;roads<br/>between&#160;them.&#160;It&#160;can&#160;be&#160;described&#160;with&#160;this&#160;array&#160;of&#160;roads:<br/>
const&#160;roads&#160;=&#160;[<br/>
&#34;Alice's&#160;House-Bob's&#160;House&#34;,<br/>
&#34;Alice's&#160;House-Cabin&#34;,<br/>
&#34;Alice's&#160;House-Post&#160;Office&#34;,<br/>
&#34;Bob's&#160;House-Town&#160;Hall&#34;,<br/>
&#34;Daria's&#160;House-Ernie's&#160;House&#34;,&#160;&#34;Daria's&#160;House-Town&#160;Hall&#34;,<br/>&#34;Ernie's&#160;House-Grete's&#160;House&#34;,&#160;&#34;Grete's&#160;House-Farm&#34;,<br/>&#34;Grete's&#160;House-Shop&#34;,<br/>
&#34;Marketplace-Farm&#34;,<br/>
&#34;Marketplace-Post&#160;Office&#34;,<br/>
&#34;Marketplace-Shop&#34;,<br/>
&#34;Marketplace-Town&#160;Hall&#34;,<br/>
&#34;Shop-Town&#160;Hall&#34;<br/>
];<br/>
117<br/>
<hr/>
<a name=130></a><img src="eloquent-javascript-130_1.png"/><br/>
The&#160;network&#160;of&#160;roads&#160;in&#160;the&#160;village&#160;forms&#160;a&#160;<i>graph</i>.&#160;A&#160;graph&#160;is&#160;a&#160;collection&#160;of<br/>
points&#160;(places&#160;in&#160;the&#160;village)&#160;with&#160;lines&#160;between&#160;them&#160;(roads).&#160;This&#160;graph&#160;will<br/>be&#160;the&#160;world&#160;that&#160;our&#160;robot&#160;moves&#160;through.<br/>
The&#160;array&#160;of&#160;strings&#160;isn’t&#160;very&#160;easy&#160;to&#160;work&#160;with.&#160;What&#160;we’re&#160;interested&#160;in<br/>
is&#160;the&#160;destinations&#160;that&#160;we&#160;can&#160;reach&#160;from&#160;a&#160;given&#160;place.&#160;Let’s&#160;convert&#160;the&#160;list<br/>of&#160;roads&#160;to&#160;a&#160;data&#160;structure&#160;that,&#160;for&#160;each&#160;place,&#160;tells&#160;us&#160;what&#160;can&#160;be&#160;reached<br/>from&#160;there.<br/>
function&#160;buildGraph(edges)&#160;{<br/>
let&#160;graph&#160;=&#160;Object.create(null);<br/>function&#160;addEdge(from,&#160;to)&#160;{<br/>
if&#160;(graph[from]&#160;==&#160;null)&#160;{<br/>
graph[from]&#160;=&#160;[to];<br/>
}&#160;else&#160;{<br/>
graph[from].push(to);<br/>
}<br/>
}<br/>for&#160;(let&#160;[from,&#160;to]&#160;of&#160;edges.map(r&#160;=&gt;&#160;r.split(&#34;-&#34;)))&#160;{<br/>
addEdge(from,&#160;to);<br/>addEdge(to,&#160;from);<br/>
}<br/>return&#160;graph;<br/>
}<br/>
const&#160;roadGraph&#160;=&#160;buildGraph(roads);<br/>
Given&#160;an&#160;array&#160;of&#160;edges,&#160;buildGraph&#160;creates&#160;a&#160;map&#160;object&#160;that,&#160;for&#160;each&#160;node,<br/>
118<br/>
<hr/>
<a name=131></a>stores&#160;an&#160;array&#160;of&#160;connected&#160;nodes.<br/>
It&#160;uses&#160;the&#160;split&#160;method&#160;to&#160;go&#160;from&#160;the&#160;road&#160;strings,&#160;which&#160;have&#160;the&#160;form<br/>
&#34;Start-End&#34;,&#160;to&#160;two-element&#160;arrays&#160;containing&#160;the&#160;start&#160;and&#160;end&#160;as&#160;separate<br/>strings.<br/>
<b>The&#160;task</b><br/>
Our&#160;robot&#160;will&#160;be&#160;moving&#160;around&#160;the&#160;village.&#160;There&#160;are&#160;parcels&#160;in&#160;various<br/>places,&#160;each&#160;addressed&#160;to&#160;some&#160;other&#160;place.&#160;The&#160;robot&#160;picks&#160;up&#160;parcels&#160;when<br/>it&#160;comes&#160;to&#160;them&#160;and&#160;delivers&#160;them&#160;when&#160;it&#160;arrives&#160;at&#160;their&#160;destinations.<br/>
The&#160;automaton&#160;must&#160;decide,&#160;at&#160;each&#160;point,&#160;where&#160;to&#160;go&#160;next.&#160;It&#160;has&#160;finished<br/>
its&#160;task&#160;when&#160;all&#160;parcels&#160;have&#160;been&#160;delivered.<br/>
To&#160;be&#160;able&#160;to&#160;simulate&#160;this&#160;process,&#160;we&#160;must&#160;define&#160;a&#160;virtual&#160;world&#160;that&#160;can<br/>
describe&#160;it.&#160;This&#160;model&#160;tells&#160;us&#160;where&#160;the&#160;robot&#160;is&#160;and&#160;where&#160;the&#160;parcels&#160;are.<br/>When&#160;the&#160;robot&#160;has&#160;decided&#160;to&#160;move&#160;somewhere,&#160;we&#160;need&#160;to&#160;update&#160;the&#160;model<br/>to&#160;reflect&#160;the&#160;new&#160;situation.<br/>
If&#160;you’re&#160;thinking&#160;in&#160;terms&#160;of&#160;object-oriented&#160;programming,&#160;your&#160;first&#160;impulse<br/>
might&#160;be&#160;to&#160;start&#160;defining&#160;objects&#160;for&#160;the&#160;various&#160;elements&#160;in&#160;the&#160;world:&#160;a&#160;class<br/>for&#160;the&#160;robot,&#160;one&#160;for&#160;a&#160;parcel,&#160;maybe&#160;one&#160;for&#160;places.&#160;These&#160;could&#160;then&#160;hold<br/>properties&#160;that&#160;describe&#160;their&#160;current&#160;state,&#160;such&#160;as&#160;the&#160;pile&#160;of&#160;parcels&#160;at&#160;a<br/>location,&#160;which&#160;we&#160;could&#160;change&#160;when&#160;updating&#160;the&#160;world.<br/>
This&#160;is&#160;wrong.<br/>At&#160;least,&#160;it&#160;usually&#160;is.&#160;The&#160;fact&#160;that&#160;something&#160;sounds&#160;like&#160;an&#160;object&#160;does&#160;not<br/>
automatically&#160;mean&#160;that&#160;it&#160;should&#160;be&#160;an&#160;object&#160;in&#160;your&#160;program.&#160;Reflexively<br/>writing&#160;classes&#160;for&#160;every&#160;concept&#160;in&#160;your&#160;application&#160;tends&#160;to&#160;leave&#160;you&#160;with&#160;a<br/>collection&#160;of&#160;interconnected&#160;objects&#160;that&#160;each&#160;have&#160;their&#160;own&#160;internal,&#160;changing<br/>state.&#160;Such&#160;programs&#160;are&#160;often&#160;hard&#160;to&#160;understand&#160;and&#160;thus&#160;easy&#160;to&#160;break.<br/>
Instead,&#160;let’s&#160;condense&#160;the&#160;village’s&#160;state&#160;down&#160;to&#160;the&#160;minimal&#160;set&#160;of&#160;values<br/>
that&#160;define&#160;it.&#160;There’s&#160;the&#160;robot’s&#160;current&#160;location&#160;and&#160;the&#160;collection&#160;of&#160;unde-<br/>livered&#160;parcels,&#160;each&#160;of&#160;which&#160;has&#160;a&#160;current&#160;location&#160;and&#160;a&#160;destination&#160;address.<br/>That’s&#160;it.<br/>
And&#160;while&#160;we’re&#160;at&#160;it,&#160;let’s&#160;make&#160;it&#160;so&#160;that&#160;we&#160;don’t&#160;<i>change&#160;</i>this&#160;state&#160;when<br/>
the&#160;robot&#160;moves&#160;but&#160;rather&#160;compute&#160;a&#160;<i>new&#160;</i>state&#160;for&#160;the&#160;situation&#160;after&#160;the<br/>move.<br/>
class&#160;VillageState&#160;{<br/>
constructor(place,&#160;parcels)&#160;{<br/>
this.place&#160;=&#160;place;<br/>this.parcels&#160;=&#160;parcels;<br/>
}<br/>
119<br/>
<hr/>
<a name=132></a>move(destination)&#160;{<br/>
if&#160;(!roadGraph[this.place].includes(destination))&#160;{<br/>
return&#160;this;<br/>
}&#160;else&#160;{<br/>
let&#160;parcels&#160;=&#160;this.parcels.map(p&#160;=&gt;&#160;{<br/>
if&#160;(p.place&#160;!=&#160;this.place)&#160;return&#160;p;<br/>return&#160;{place:&#160;destination,&#160;address:&#160;p.address};<br/>
}).filter(p&#160;=&gt;&#160;p.place&#160;!=&#160;p.address);<br/>return&#160;new&#160;VillageState(destination,&#160;parcels);<br/>
}<br/>
}<br/>
}<br/>
The&#160;move&#160;method&#160;is&#160;where&#160;the&#160;action&#160;happens.&#160;It&#160;first&#160;checks&#160;whether&#160;there<br/>
is&#160;a&#160;road&#160;going&#160;from&#160;the&#160;current&#160;place&#160;to&#160;the&#160;destination,&#160;and&#160;if&#160;not,&#160;it&#160;returns<br/>the&#160;old&#160;state&#160;since&#160;this&#160;is&#160;not&#160;a&#160;valid&#160;move.<br/>
Then&#160;it&#160;creates&#160;a&#160;new&#160;state&#160;with&#160;the&#160;destination&#160;as&#160;the&#160;robot’s&#160;new&#160;place.&#160;But<br/>
it&#160;also&#160;needs&#160;to&#160;create&#160;a&#160;new&#160;set&#160;of&#160;parcels—parcels&#160;that&#160;the&#160;robot&#160;is&#160;carrying<br/>(that&#160;are&#160;at&#160;the&#160;robot’s&#160;current&#160;place)&#160;need&#160;to&#160;be&#160;moved&#160;along&#160;to&#160;the&#160;new&#160;place.<br/>And&#160;parcels&#160;that&#160;are&#160;addressed&#160;to&#160;the&#160;new&#160;place&#160;need&#160;to&#160;be&#160;delivered—that&#160;is,<br/>they&#160;need&#160;to&#160;be&#160;removed&#160;from&#160;the&#160;set&#160;of&#160;undelivered&#160;parcels.&#160;The&#160;call&#160;to&#160;map<br/>takes&#160;care&#160;of&#160;the&#160;moving,&#160;and&#160;the&#160;call&#160;to&#160;filter&#160;does&#160;the&#160;delivering.<br/>
Parcel&#160;objects&#160;aren’t&#160;changed&#160;when&#160;they&#160;are&#160;moved&#160;but&#160;re-created.&#160;The&#160;move<br/>
method&#160;gives&#160;us&#160;a&#160;new&#160;village&#160;state&#160;but&#160;leaves&#160;the&#160;old&#160;one&#160;entirely&#160;intact.<br/>
let&#160;first&#160;=&#160;new&#160;VillageState(<br/>
&#34;Post&#160;Office&#34;,<br/>[{place:&#160;&#34;Post&#160;Office&#34;,&#160;address:&#160;&#34;Alice's&#160;House&#34;}]<br/>
);<br/>let&#160;next&#160;=&#160;first.move(&#34;Alice's&#160;House&#34;);<br/>
console.log(next.place);<br/>//&#160;→&#160;Alice's&#160;House<br/>console.log(next.parcels);<br/>//&#160;→&#160;[]<br/>console.log(first.place);<br/>//&#160;→&#160;Post&#160;Office<br/>
The&#160;move&#160;causes&#160;the&#160;parcel&#160;to&#160;be&#160;delivered,&#160;and&#160;this&#160;is&#160;reflected&#160;in&#160;the&#160;next<br/>
state.&#160;But&#160;the&#160;initial&#160;state&#160;still&#160;describes&#160;the&#160;situation&#160;where&#160;the&#160;robot&#160;is&#160;at<br/>the&#160;post&#160;office&#160;and&#160;the&#160;parcel&#160;is&#160;undelivered.<br/>
120<br/>
<hr/>
<a name=133></a><b>Persistent&#160;data</b><br/>
Data&#160;structures&#160;that&#160;don’t&#160;change&#160;are&#160;called&#160;<i>immutable&#160;</i>or&#160;<i>persistent</i>.&#160;They<br/>behave&#160;a&#160;lot&#160;like&#160;strings&#160;and&#160;numbers&#160;in&#160;that&#160;they&#160;are&#160;who&#160;they&#160;are&#160;and&#160;stay<br/>that&#160;way,&#160;rather&#160;than&#160;containing&#160;different&#160;things&#160;at&#160;different&#160;times.<br/>
In&#160;JavaScript,&#160;just&#160;about&#160;everything&#160;<i>can&#160;</i>be&#160;changed,&#160;so&#160;working&#160;with&#160;values<br/>
that&#160;are&#160;supposed&#160;to&#160;be&#160;persistent&#160;requires&#160;some&#160;restraint.&#160;There&#160;is&#160;a&#160;function<br/>called&#160;Object.freeze&#160;that&#160;changes&#160;an&#160;object&#160;so&#160;that&#160;writing&#160;to&#160;its&#160;properties<br/>is&#160;ignored.&#160;You&#160;could&#160;use&#160;that&#160;to&#160;make&#160;sure&#160;your&#160;objects&#160;aren’t&#160;changed,&#160;if<br/>you&#160;want&#160;to&#160;be&#160;careful.&#160;Freezing&#160;does&#160;require&#160;the&#160;computer&#160;to&#160;do&#160;some&#160;extra<br/>work,&#160;and&#160;having&#160;updates&#160;ignored&#160;is&#160;just&#160;about&#160;as&#160;likely&#160;to&#160;confuse&#160;someone&#160;as<br/>having&#160;them&#160;do&#160;the&#160;wrong&#160;thing.&#160;So&#160;I&#160;usually&#160;prefer&#160;to&#160;just&#160;tell&#160;people&#160;that&#160;a<br/>given&#160;object&#160;shouldn’t&#160;be&#160;messed&#160;with&#160;and&#160;hope&#160;they&#160;remember&#160;it.<br/>
let&#160;object&#160;=&#160;Object.freeze({value:&#160;5});<br/>object.value&#160;=&#160;10;<br/>console.log(object.value);<br/>//&#160;→&#160;5<br/>
Why&#160;am&#160;I&#160;going&#160;out&#160;of&#160;my&#160;way&#160;to&#160;not&#160;change&#160;objects&#160;when&#160;the&#160;language&#160;is<br/>
obviously&#160;expecting&#160;me&#160;to?<br/>
Because&#160;it&#160;helps&#160;me&#160;understand&#160;my&#160;programs.&#160;This&#160;is&#160;about&#160;complexity<br/>
management&#160;again.&#160;When&#160;the&#160;objects&#160;in&#160;my&#160;system&#160;are&#160;fixed,&#160;stable&#160;things,<br/>I&#160;can&#160;consider&#160;operations&#160;on&#160;them&#160;in&#160;isolation—moving&#160;to&#160;Alice’s&#160;house&#160;from<br/>a&#160;given&#160;start&#160;state&#160;always&#160;produces&#160;the&#160;same&#160;new&#160;state.&#160;When&#160;objects&#160;change<br/>over&#160;time,&#160;that&#160;adds&#160;a&#160;whole&#160;new&#160;dimension&#160;of&#160;complexity&#160;to&#160;this&#160;kind&#160;of<br/>reasoning.<br/>
For&#160;a&#160;small&#160;system&#160;like&#160;the&#160;one&#160;we&#160;are&#160;building&#160;in&#160;this&#160;chapter,&#160;we&#160;could<br/>
handle&#160;that&#160;bit&#160;of&#160;extra&#160;complexity.&#160;But&#160;the&#160;most&#160;important&#160;limit&#160;on&#160;what&#160;kind<br/>of&#160;systems&#160;we&#160;can&#160;build&#160;is&#160;how&#160;much&#160;we&#160;can&#160;understand.&#160;Anything&#160;that&#160;makes<br/>your&#160;code&#160;easier&#160;to&#160;understand&#160;makes&#160;it&#160;possible&#160;to&#160;build&#160;a&#160;more&#160;ambitious<br/>system.<br/>
Unfortunately,&#160;although&#160;understanding&#160;a&#160;system&#160;built&#160;on&#160;persistent&#160;data<br/>
structures&#160;is&#160;easier,&#160;<i>designing&#160;</i>one,&#160;especially&#160;when&#160;your&#160;programming&#160;language<br/>isn’t&#160;helping,&#160;can&#160;be&#160;a&#160;little&#160;harder.&#160;We’ll&#160;look&#160;for&#160;opportunities&#160;to&#160;use&#160;persis-<br/>tent&#160;data&#160;structures&#160;in&#160;this&#160;book,&#160;but&#160;we’ll&#160;also&#160;be&#160;using&#160;changeable&#160;ones.<br/>
121<br/>
<hr/>
<a name=134></a><b>Simulation</b><br/>
A&#160;delivery&#160;robot&#160;looks&#160;at&#160;the&#160;world&#160;and&#160;decides&#160;in&#160;which&#160;direction&#160;it&#160;wants<br/>to&#160;move.<br/>
As&#160;such,&#160;we&#160;could&#160;say&#160;that&#160;a&#160;robot&#160;is&#160;a&#160;function&#160;that&#160;takes&#160;a<br/>
VillageState&#160;object&#160;and&#160;returns&#160;the&#160;name&#160;of&#160;a&#160;nearby&#160;place.<br/>
Because&#160;we&#160;want&#160;robots&#160;to&#160;be&#160;able&#160;to&#160;remember&#160;things,&#160;so&#160;that&#160;they&#160;can<br/>
make&#160;and&#160;execute&#160;plans,&#160;we&#160;also&#160;pass&#160;them&#160;their&#160;memory&#160;and&#160;allow&#160;them&#160;to<br/>return&#160;a&#160;new&#160;memory.&#160;Thus,&#160;the&#160;thing&#160;a&#160;robot&#160;returns&#160;is&#160;an&#160;object&#160;containing<br/>both&#160;the&#160;direction&#160;it&#160;wants&#160;to&#160;move&#160;in&#160;and&#160;a&#160;memory&#160;value&#160;that&#160;will&#160;be&#160;given<br/>back&#160;to&#160;it&#160;the&#160;next&#160;time&#160;it&#160;is&#160;called.<br/>
function&#160;runRobot(state,&#160;robot,&#160;memory)&#160;{<br/>
for&#160;(let&#160;turn&#160;=&#160;0;;&#160;turn++)&#160;{<br/>
if&#160;(state.parcels.length&#160;==&#160;0)&#160;{<br/>
console.log(`Done&#160;in&#160;${turn}&#160;turns`);<br/>break;<br/>
}<br/>let&#160;action&#160;=&#160;robot(state,&#160;memory);<br/>state&#160;=&#160;state.move(action.direction);<br/>memory&#160;=&#160;action.memory;<br/>console.log(`Moved&#160;to&#160;${action.direction}`);<br/>
}<br/>
}<br/>
Consider&#160;what&#160;a&#160;robot&#160;has&#160;to&#160;do&#160;to&#160;“solve”&#160;a&#160;given&#160;state.&#160;It&#160;must&#160;pick&#160;up<br/>
all&#160;parcels&#160;by&#160;visiting&#160;every&#160;location&#160;that&#160;has&#160;a&#160;parcel&#160;and&#160;deliver&#160;them&#160;by<br/>visiting&#160;every&#160;location&#160;that&#160;a&#160;parcel&#160;is&#160;addressed&#160;to,&#160;but&#160;only&#160;after&#160;picking&#160;up<br/>the&#160;parcel.<br/>
What&#160;is&#160;the&#160;dumbest&#160;strategy&#160;that&#160;could&#160;possibly&#160;work?&#160;The&#160;robot&#160;could<br/>
just&#160;walk&#160;in&#160;a&#160;random&#160;direction&#160;every&#160;turn.&#160;That&#160;means,&#160;with&#160;great&#160;likelihood,<br/>it&#160;will&#160;eventually&#160;run&#160;into&#160;all&#160;parcels&#160;and&#160;then&#160;also&#160;at&#160;some&#160;point&#160;reach&#160;the<br/>place&#160;where&#160;they&#160;should&#160;be&#160;delivered.<br/>
Here’s&#160;what&#160;that&#160;could&#160;look&#160;like:<br/>
function&#160;randomPick(array)&#160;{<br/>
let&#160;choice&#160;=&#160;Math.floor(Math.random()&#160;*&#160;array.length);<br/>return&#160;array[choice];<br/>
}<br/>
function&#160;randomRobot(state)&#160;{<br/>
return&#160;{direction:&#160;randomPick(roadGraph[state.place])};<br/>
}<br/>
122<br/>
<hr/>
<a name=135></a>Remember&#160;that&#160;Math.random()&#160;returns&#160;a&#160;number&#160;between&#160;zero&#160;and&#160;one—but<br/>
always&#160;below&#160;one.&#160;Multiplying&#160;such&#160;a&#160;number&#160;by&#160;the&#160;length&#160;of&#160;an&#160;array&#160;and<br/>then&#160;applying&#160;Math.floor&#160;to&#160;it&#160;gives&#160;us&#160;a&#160;random&#160;index&#160;for&#160;the&#160;array.<br/>
Since&#160;this&#160;robot&#160;does&#160;not&#160;need&#160;to&#160;remember&#160;anything,&#160;it&#160;ignores&#160;its&#160;second<br/>
argument&#160;(remember&#160;that&#160;JavaScript&#160;functions&#160;can&#160;be&#160;called&#160;with&#160;extra&#160;argu-<br/>ments&#160;without&#160;ill&#160;effects)&#160;and&#160;omits&#160;the&#160;memory&#160;property&#160;in&#160;its&#160;returned&#160;object.<br/>
To&#160;put&#160;this&#160;sophisticated&#160;robot&#160;to&#160;work,&#160;we’ll&#160;first&#160;need&#160;a&#160;way&#160;to&#160;create&#160;a<br/>
new&#160;state&#160;with&#160;some&#160;parcels.&#160;A&#160;static&#160;method&#160;(written&#160;here&#160;by&#160;directly&#160;adding<br/>a&#160;property&#160;to&#160;the&#160;constructor)&#160;is&#160;a&#160;good&#160;place&#160;to&#160;put&#160;that&#160;functionality.<br/>
VillageState.random&#160;=&#160;function(parcelCount&#160;=&#160;5)&#160;{<br/>
let&#160;parcels&#160;=&#160;[];<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;parcelCount;&#160;i++)&#160;{<br/>
let&#160;address&#160;=&#160;randomPick(Object.keys(roadGraph));<br/>let&#160;place;<br/>do&#160;{<br/>
place&#160;=&#160;randomPick(Object.keys(roadGraph));<br/>
}&#160;while&#160;(place&#160;==&#160;address);<br/>parcels.push({place,&#160;address});<br/>
}<br/>return&#160;new&#160;VillageState(&#34;Post&#160;Office&#34;,&#160;parcels);<br/>
};<br/>
We&#160;don’t&#160;want&#160;any&#160;parcels&#160;that&#160;are&#160;sent&#160;from&#160;the&#160;same&#160;place&#160;that&#160;they&#160;are<br/>
addressed&#160;to.&#160;For&#160;this&#160;reason,&#160;the&#160;do&#160;loop&#160;keeps&#160;picking&#160;new&#160;places&#160;when&#160;it<br/>gets&#160;one&#160;that’s&#160;equal&#160;to&#160;the&#160;address.<br/>
Let’s&#160;start&#160;up&#160;a&#160;virtual&#160;world.<br/>
runRobot(VillageState.random(),&#160;randomRobot);<br/>//&#160;→&#160;Moved&#160;to&#160;Marketplace<br/>//&#160;→&#160;Moved&#160;to&#160;Town&#160;Hall<br/>//&#160;→…<br/>//&#160;→&#160;Done&#160;in&#160;63&#160;turns<br/>
It&#160;takes&#160;the&#160;robot&#160;a&#160;lot&#160;of&#160;turns&#160;to&#160;deliver&#160;the&#160;parcels&#160;because&#160;it&#160;isn’t&#160;planning<br/>
ahead&#160;very&#160;well.&#160;We’ll&#160;address&#160;that&#160;soon.<br/>
123<br/>
<hr/>
<a name=136></a><b>The&#160;mail&#160;truck's&#160;route</b><br/>
We&#160;should&#160;be&#160;able&#160;to&#160;do&#160;a&#160;lot&#160;better&#160;than&#160;the&#160;random&#160;robot.&#160;An&#160;easy&#160;improve-<br/>ment&#160;would&#160;be&#160;to&#160;take&#160;a&#160;hint&#160;from&#160;the&#160;way&#160;real-world&#160;mail&#160;delivery&#160;works.&#160;If<br/>we&#160;find&#160;a&#160;route&#160;that&#160;passes&#160;all&#160;places&#160;in&#160;the&#160;village,&#160;the&#160;robot&#160;could&#160;run&#160;that<br/>route&#160;twice,&#160;at&#160;which&#160;point&#160;it&#160;is&#160;guaranteed&#160;to&#160;be&#160;done.&#160;Here&#160;is&#160;one&#160;such&#160;route<br/>(starting&#160;from&#160;the&#160;post&#160;office):<br/>
const&#160;mailRoute&#160;=&#160;[<br/>
&#34;Alice's&#160;House&#34;,&#160;&#34;Cabin&#34;,&#160;&#34;Alice's&#160;House&#34;,&#160;&#34;Bob's&#160;House&#34;,<br/>&#34;Town&#160;Hall&#34;,&#160;&#34;Daria's&#160;House&#34;,&#160;&#34;Ernie's&#160;House&#34;,<br/>&#34;Grete's&#160;House&#34;,&#160;&#34;Shop&#34;,&#160;&#34;Grete's&#160;House&#34;,&#160;&#34;Farm&#34;,<br/>&#34;Marketplace&#34;,&#160;&#34;Post&#160;Office&#34;<br/>
];<br/>
To&#160;implement&#160;the&#160;route-following&#160;robot,&#160;we’ll&#160;need&#160;to&#160;make&#160;use&#160;of&#160;robot<br/>
memory.&#160;The&#160;robot&#160;keeps&#160;the&#160;rest&#160;of&#160;its&#160;route&#160;in&#160;its&#160;memory&#160;and&#160;drops&#160;the<br/>first&#160;element&#160;every&#160;turn.<br/>
function&#160;routeRobot(state,&#160;memory)&#160;{<br/>
if&#160;(memory.length&#160;==&#160;0)&#160;{<br/>
memory&#160;=&#160;mailRoute;<br/>
}<br/>return&#160;{direction:&#160;memory[0],&#160;memory:&#160;memory.slice(1)};<br/>
}<br/>
This&#160;robot&#160;is&#160;a&#160;lot&#160;faster&#160;already.&#160;It’ll&#160;take&#160;a&#160;maximum&#160;of&#160;26&#160;turns&#160;(twice<br/>
the&#160;13-step&#160;route)&#160;but&#160;usually&#160;less.<br/>
<b>Pathfinding</b><br/>
Still,&#160;I&#160;wouldn’t&#160;really&#160;call&#160;blindly&#160;following&#160;a&#160;fixed&#160;route&#160;intelligent&#160;behavior.<br/>The&#160;robot&#160;could&#160;work&#160;more&#160;efficiently&#160;if&#160;it&#160;adjusted&#160;its&#160;behavior&#160;to&#160;the&#160;actual<br/>work&#160;that&#160;needs&#160;to&#160;be&#160;done.<br/>
To&#160;do&#160;that,&#160;it&#160;has&#160;to&#160;be&#160;able&#160;to&#160;deliberately&#160;move&#160;toward&#160;a&#160;given&#160;parcel&#160;or<br/>
toward&#160;the&#160;location&#160;where&#160;a&#160;parcel&#160;has&#160;to&#160;be&#160;delivered.&#160;Doing&#160;that,&#160;even&#160;when<br/>the&#160;goal&#160;is&#160;more&#160;than&#160;one&#160;move&#160;away,&#160;will&#160;require&#160;some&#160;kind&#160;of&#160;route-finding<br/>function.<br/>
The&#160;problem&#160;of&#160;finding&#160;a&#160;route&#160;through&#160;a&#160;graph&#160;is&#160;a&#160;typical&#160;<i>search&#160;problem</i>.<br/>
We&#160;can&#160;tell&#160;whether&#160;a&#160;given&#160;solution&#160;(a&#160;route)&#160;is&#160;a&#160;valid&#160;solution,&#160;but&#160;we&#160;can’t<br/>
124<br/>
<hr/>
<a name=137></a>directly&#160;compute&#160;the&#160;solution&#160;the&#160;way&#160;we&#160;could&#160;for&#160;2&#160;+&#160;2.&#160;Instead,&#160;we&#160;have&#160;to<br/>keep&#160;creating&#160;potential&#160;solutions&#160;until&#160;we&#160;find&#160;one&#160;that&#160;works.<br/>
The&#160;number&#160;of&#160;possible&#160;routes&#160;through&#160;a&#160;graph&#160;is&#160;infinite.&#160;But&#160;when&#160;search-<br/>
ing&#160;for&#160;a&#160;route&#160;from&#160;<i>A&#160;</i>to&#160;<i>B</i>,&#160;we&#160;are&#160;interested&#160;only&#160;in&#160;the&#160;ones&#160;that&#160;start&#160;at<br/><i>A</i>.&#160;We&#160;also&#160;don’t&#160;care&#160;about&#160;routes&#160;that&#160;visit&#160;the&#160;same&#160;place&#160;twice—those&#160;are<br/>definitely&#160;not&#160;the&#160;most&#160;efficient&#160;route&#160;anywhere.&#160;So&#160;that&#160;cuts&#160;down&#160;on&#160;the<br/>number&#160;of&#160;routes&#160;that&#160;the&#160;route&#160;finder&#160;has&#160;to&#160;consider.<br/>
In&#160;fact,&#160;we&#160;are&#160;mostly&#160;interested&#160;in&#160;the&#160;<i>shortest&#160;</i>route.&#160;So&#160;we&#160;want&#160;to&#160;make<br/>
sure&#160;we&#160;look&#160;at&#160;short&#160;routes&#160;before&#160;we&#160;look&#160;at&#160;longer&#160;ones.&#160;A&#160;good&#160;approach<br/>would&#160;be&#160;to&#160;“grow”&#160;routes&#160;from&#160;the&#160;starting&#160;point,&#160;exploring&#160;every&#160;reachable<br/>place&#160;that&#160;hasn’t&#160;been&#160;visited&#160;yet,&#160;until&#160;a&#160;route&#160;reaches&#160;the&#160;goal.&#160;That&#160;way,<br/>we’ll&#160;only&#160;explore&#160;routes&#160;that&#160;are&#160;potentially&#160;interesting,&#160;and&#160;we’ll&#160;find&#160;the<br/>shortest&#160;route&#160;(or&#160;one&#160;of&#160;the&#160;shortest&#160;routes,&#160;if&#160;there&#160;are&#160;more&#160;than&#160;one)&#160;to&#160;the<br/>goal.<br/>
Here&#160;is&#160;a&#160;function&#160;that&#160;does&#160;this:<br/>
function&#160;findRoute(graph,&#160;from,&#160;to)&#160;{<br/>
let&#160;work&#160;=&#160;[{at:&#160;from,&#160;route:&#160;[]}];<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;work.length;&#160;i++)&#160;{<br/>
let&#160;{at,&#160;route}&#160;=&#160;work[i];<br/>for&#160;(let&#160;place&#160;of&#160;graph[at])&#160;{<br/>
if&#160;(place&#160;==&#160;to)&#160;return&#160;route.concat(place);<br/>if&#160;(!work.some(w&#160;=&gt;&#160;w.at&#160;==&#160;place))&#160;{<br/>
work.push({at:&#160;place,&#160;route:&#160;route.concat(place)});<br/>
}<br/>
}<br/>
}<br/>
}<br/>
The&#160;exploring&#160;has&#160;to&#160;be&#160;done&#160;in&#160;the&#160;right&#160;order—the&#160;places&#160;that&#160;were&#160;reached<br/>
first&#160;have&#160;to&#160;be&#160;explored&#160;first.&#160;We&#160;can’t&#160;immediately&#160;explore&#160;a&#160;place&#160;as&#160;soon<br/>as&#160;we&#160;reach&#160;it&#160;because&#160;that&#160;would&#160;mean&#160;places&#160;reached&#160;<i>from&#160;there&#160;</i>would&#160;also<br/>be&#160;explored&#160;immediately,&#160;and&#160;so&#160;on,&#160;even&#160;though&#160;there&#160;may&#160;be&#160;other,&#160;shorter<br/>paths&#160;that&#160;haven’t&#160;yet&#160;been&#160;explored.<br/>
Therefore,&#160;the&#160;function&#160;keeps&#160;a&#160;<i>work&#160;list</i>.&#160;This&#160;is&#160;an&#160;array&#160;of&#160;places&#160;that<br/>
should&#160;be&#160;explored&#160;next,&#160;along&#160;with&#160;the&#160;route&#160;that&#160;got&#160;us&#160;there.&#160;It&#160;starts&#160;with<br/>just&#160;the&#160;start&#160;position&#160;and&#160;an&#160;empty&#160;route.<br/>
The&#160;search&#160;then&#160;operates&#160;by&#160;taking&#160;the&#160;next&#160;item&#160;in&#160;the&#160;list&#160;and&#160;exploring<br/>
that,&#160;which&#160;means&#160;all&#160;roads&#160;going&#160;from&#160;that&#160;place&#160;are&#160;looked&#160;at.&#160;If&#160;one&#160;of&#160;them<br/>is&#160;the&#160;goal,&#160;a&#160;finished&#160;route&#160;can&#160;be&#160;returned.&#160;Otherwise,&#160;if&#160;we&#160;haven’t&#160;looked<br/>at&#160;this&#160;place&#160;before,&#160;a&#160;new&#160;item&#160;is&#160;added&#160;to&#160;the&#160;list.&#160;If&#160;we&#160;have&#160;looked&#160;at&#160;it<br/>
125<br/>
<hr/>
<a name=138></a>before,&#160;since&#160;we&#160;are&#160;looking&#160;at&#160;short&#160;routes&#160;first,&#160;we’ve&#160;found&#160;either&#160;a&#160;longer<br/>route&#160;to&#160;that&#160;place&#160;or&#160;one&#160;precisely&#160;as&#160;long&#160;as&#160;the&#160;existing&#160;one,&#160;and&#160;we&#160;don’t<br/>need&#160;to&#160;explore&#160;it.<br/>
You&#160;can&#160;visually&#160;imagine&#160;this&#160;as&#160;a&#160;web&#160;of&#160;known&#160;routes&#160;crawling&#160;out&#160;from&#160;the<br/>
start&#160;location,&#160;growing&#160;evenly&#160;on&#160;all&#160;sides&#160;(but&#160;never&#160;tangling&#160;back&#160;into&#160;itself).<br/>As&#160;soon&#160;as&#160;the&#160;first&#160;thread&#160;reaches&#160;the&#160;goal&#160;location,&#160;that&#160;thread&#160;is&#160;traced&#160;back<br/>to&#160;the&#160;start,&#160;giving&#160;us&#160;our&#160;route.<br/>
Our&#160;code&#160;doesn’t&#160;handle&#160;the&#160;situation&#160;where&#160;there&#160;are&#160;no&#160;more&#160;work&#160;items<br/>
on&#160;the&#160;work&#160;list&#160;because&#160;we&#160;know&#160;that&#160;our&#160;graph&#160;is&#160;<i>connected</i>,&#160;meaning&#160;that<br/>every&#160;location&#160;can&#160;be&#160;reached&#160;from&#160;all&#160;other&#160;locations.&#160;We’ll&#160;always&#160;be&#160;able&#160;to<br/>find&#160;a&#160;route&#160;between&#160;two&#160;points,&#160;and&#160;the&#160;search&#160;can’t&#160;fail.<br/>
function&#160;goalOrientedRobot({place,&#160;parcels},&#160;route)&#160;{<br/>
if&#160;(route.length&#160;==&#160;0)&#160;{<br/>
let&#160;parcel&#160;=&#160;parcels[0];<br/>if&#160;(parcel.place&#160;!=&#160;place)&#160;{<br/>
route&#160;=&#160;findRoute(roadGraph,&#160;place,&#160;parcel.place);<br/>
}&#160;else&#160;{<br/>
route&#160;=&#160;findRoute(roadGraph,&#160;place,&#160;parcel.address);<br/>
}<br/>
}<br/>return&#160;{direction:&#160;route[0],&#160;memory:&#160;route.slice(1)};<br/>
}<br/>
This&#160;robot&#160;uses&#160;its&#160;memory&#160;value&#160;as&#160;a&#160;list&#160;of&#160;directions&#160;to&#160;move&#160;in,&#160;just&#160;like<br/>
the&#160;route-following&#160;robot.&#160;Whenever&#160;that&#160;list&#160;is&#160;empty,&#160;it&#160;has&#160;to&#160;figure&#160;out<br/>what&#160;to&#160;do&#160;next.&#160;It&#160;takes&#160;the&#160;first&#160;undelivered&#160;parcel&#160;in&#160;the&#160;set&#160;and,&#160;if&#160;that<br/>parcel&#160;hasn’t&#160;been&#160;picked&#160;up&#160;yet,&#160;plots&#160;a&#160;route&#160;toward&#160;it.&#160;If&#160;the&#160;parcel&#160;<i>has&#160;</i>been<br/>picked&#160;up,&#160;it&#160;still&#160;needs&#160;to&#160;be&#160;delivered,&#160;so&#160;the&#160;robot&#160;creates&#160;a&#160;route&#160;toward&#160;the<br/>delivery&#160;address&#160;instead.<br/>
This&#160;robot&#160;usually&#160;finishes&#160;the&#160;task&#160;of&#160;delivering&#160;5&#160;parcels&#160;in&#160;about&#160;16&#160;turns.<br/>
That’s&#160;slightly&#160;better&#160;than&#160;routeRobot&#160;but&#160;still&#160;definitely&#160;not&#160;optimal.<br/>
<b>Exercises</b><br/>
<b>Measuring&#160;a&#160;robot</b><br/>
It’s&#160;hard&#160;to&#160;objectively&#160;compare&#160;robots&#160;by&#160;just&#160;letting&#160;them&#160;solve&#160;a&#160;few&#160;sce-<br/>narios.&#160;Maybe&#160;one&#160;robot&#160;just&#160;happened&#160;to&#160;get&#160;easier&#160;tasks&#160;or&#160;the&#160;kind&#160;of&#160;tasks<br/>that&#160;it&#160;is&#160;good&#160;at,&#160;whereas&#160;the&#160;other&#160;didn’t.<br/>
Write&#160;a&#160;function&#160;compareRobots&#160;that&#160;takes&#160;two&#160;robots&#160;(and&#160;their&#160;starting<br/>
126<br/>
<hr/>
<a name=139></a>memory).&#160;It&#160;should&#160;generate&#160;100&#160;tasks&#160;and&#160;let&#160;each&#160;of&#160;the&#160;robots&#160;solve&#160;each<br/>of&#160;these&#160;tasks.&#160;When&#160;done,&#160;it&#160;should&#160;output&#160;the&#160;average&#160;number&#160;of&#160;steps&#160;each<br/>robot&#160;took&#160;per&#160;task.<br/>
For&#160;the&#160;sake&#160;of&#160;fairness,&#160;make&#160;sure&#160;you&#160;give&#160;each&#160;task&#160;to&#160;both&#160;robots,&#160;rather<br/>
than&#160;generating&#160;different&#160;tasks&#160;per&#160;robot.<br/>
<b>Robot&#160;efficiency</b><br/>
Can&#160;you&#160;write&#160;a&#160;robot&#160;that&#160;finishes&#160;the&#160;delivery&#160;task&#160;faster&#160;than&#160;goalOrientedRobot<br/>?&#160;If&#160;you&#160;observe&#160;that&#160;robot’s&#160;behavior,&#160;what&#160;obviously&#160;stupid&#160;things&#160;does&#160;it<br/>do?&#160;How&#160;could&#160;those&#160;be&#160;improved?<br/>
If&#160;you&#160;solved&#160;the&#160;previous&#160;exercise,&#160;you&#160;might&#160;want&#160;to&#160;use&#160;your&#160;compareRobots<br/>
function&#160;to&#160;verify&#160;whether&#160;you&#160;improved&#160;the&#160;robot.<br/>
<b>Persistent&#160;group</b><br/>
Most&#160;data&#160;structures&#160;provided&#160;in&#160;a&#160;standard&#160;JavaScript&#160;environment&#160;aren’t<br/>very&#160;well&#160;suited&#160;for&#160;persistent&#160;use.&#160;Arrays&#160;have&#160;slice&#160;and&#160;concat&#160;methods,<br/>which&#160;allow&#160;us&#160;to&#160;easily&#160;create&#160;new&#160;arrays&#160;without&#160;damaging&#160;the&#160;old&#160;one.&#160;But<br/>Set,&#160;for&#160;example,&#160;has&#160;no&#160;methods&#160;for&#160;creating&#160;a&#160;new&#160;set&#160;with&#160;an&#160;item&#160;added&#160;or<br/>removed.<br/>
Write&#160;a&#160;new&#160;class&#160;PGroup,&#160;similar&#160;to&#160;the&#160;Group&#160;class&#160;from&#160;<a href="eloquent-javascripts.html#127">Chapter&#160;6,&#160;</a>which<br/>
stores&#160;a&#160;set&#160;of&#160;values.&#160;Like&#160;Group,&#160;it&#160;has&#160;add,&#160;delete,&#160;and&#160;has&#160;methods.<br/>
Its&#160;add&#160;method,&#160;however,&#160;should&#160;return&#160;a&#160;<i>new&#160;</i>PGroup&#160;instance&#160;with&#160;the&#160;given<br/>
member&#160;added&#160;and&#160;leave&#160;the&#160;old&#160;one&#160;unchanged.&#160;Similarly,&#160;delete&#160;creates&#160;a<br/>new&#160;instance&#160;without&#160;a&#160;given&#160;member.<br/>
The&#160;class&#160;should&#160;work&#160;for&#160;values&#160;of&#160;any&#160;type,&#160;not&#160;just&#160;strings.&#160;It&#160;does&#160;<i>not</i><br/>
have&#160;to&#160;be&#160;efficient&#160;when&#160;used&#160;with&#160;large&#160;amounts&#160;of&#160;values.<br/>
The&#160;constructor&#160;shouldn’t&#160;be&#160;part&#160;of&#160;the&#160;class’s&#160;interface&#160;(though&#160;you’ll&#160;def-<br/>
initely&#160;want&#160;to&#160;use&#160;it&#160;internally).&#160;Instead,&#160;there&#160;is&#160;an&#160;empty&#160;instance,&#160;PGroup.<br/>empty,&#160;that&#160;can&#160;be&#160;used&#160;as&#160;a&#160;starting&#160;value.<br/>
Why&#160;do&#160;you&#160;need&#160;only&#160;one&#160;PGroup.empty&#160;value,&#160;rather&#160;than&#160;having&#160;a&#160;function<br/>
that&#160;creates&#160;a&#160;new,&#160;empty&#160;map&#160;every&#160;time?<br/>
127<br/>
<hr/>
<a name=140></a><i>“Debugging&#160;is&#160;twice&#160;as&#160;hard&#160;as&#160;writing&#160;the&#160;code&#160;in&#160;the&#160;first&#160;place.</i><br/>
<i>Therefore,&#160;if&#160;you&#160;write&#160;the&#160;code&#160;as&#160;cleverly&#160;as&#160;possible,&#160;you&#160;are,&#160;by<br/>definition,&#160;not&#160;smart&#160;enough&#160;to&#160;debug&#160;it.”<br/></i>—Brian&#160;Kernighan&#160;and&#160;P.J.&#160;Plauger,&#160;The&#160;Elements&#160;of&#160;Programming<br/>
Style<br/>
<b>Chapter&#160;8<br/>Bugs&#160;and&#160;Errors</b><br/>
Flaws&#160;in&#160;computer&#160;programs&#160;are&#160;usually&#160;called&#160;<i>bugs</i>.&#160;It&#160;makes&#160;programmers<br/>feel&#160;good&#160;to&#160;imagine&#160;them&#160;as&#160;little&#160;things&#160;that&#160;just&#160;happen&#160;to&#160;crawl&#160;into&#160;our<br/>work.&#160;In&#160;reality,&#160;of&#160;course,&#160;we&#160;put&#160;them&#160;there&#160;ourselves.<br/>
If&#160;a&#160;program&#160;is&#160;crystallized&#160;thought,&#160;you&#160;can&#160;roughly&#160;categorize&#160;bugs&#160;into<br/>
those&#160;caused&#160;by&#160;the&#160;thoughts&#160;being&#160;confused&#160;and&#160;those&#160;caused&#160;by&#160;mistakes<br/>introduced&#160;while&#160;converting&#160;a&#160;thought&#160;to&#160;code.&#160;The&#160;former&#160;type&#160;is&#160;generally<br/>harder&#160;to&#160;diagnose&#160;and&#160;fix&#160;than&#160;the&#160;latter.<br/>
<b>Language</b><br/>
Many&#160;mistakes&#160;could&#160;be&#160;pointed&#160;out&#160;to&#160;us&#160;automatically&#160;by&#160;the&#160;computer,&#160;if&#160;it<br/>knew&#160;enough&#160;about&#160;what&#160;we’re&#160;trying&#160;to&#160;do.&#160;But&#160;here&#160;JavaScript’s&#160;looseness<br/>is&#160;a&#160;hindrance.&#160;Its&#160;concept&#160;of&#160;bindings&#160;and&#160;properties&#160;is&#160;vague&#160;enough&#160;that&#160;it<br/>will&#160;rarely&#160;catch&#160;typos&#160;before&#160;actually&#160;running&#160;the&#160;program.&#160;And&#160;even&#160;then,<br/>it&#160;allows&#160;you&#160;to&#160;do&#160;some&#160;clearly&#160;nonsensical&#160;things&#160;without&#160;complaint,&#160;such&#160;as<br/>computing&#160;true&#160;*&#160;&#34;monkey&#34;.<br/>
There&#160;are&#160;some&#160;things&#160;that&#160;JavaScript&#160;does&#160;complain&#160;about.&#160;Writing&#160;a&#160;pro-<br/>
gram&#160;that&#160;does&#160;not&#160;follow&#160;the&#160;language’s&#160;grammar&#160;will&#160;immediately&#160;make&#160;the<br/>computer&#160;complain.&#160;Other&#160;things,&#160;such&#160;as&#160;calling&#160;something&#160;that’s&#160;not&#160;a&#160;func-<br/>tion&#160;or&#160;looking&#160;up&#160;a&#160;property&#160;on&#160;an&#160;undefined&#160;value,&#160;will&#160;cause&#160;an&#160;error&#160;to&#160;be<br/>reported&#160;when&#160;the&#160;program&#160;tries&#160;to&#160;perform&#160;the&#160;action.<br/>
But&#160;often,&#160;your&#160;nonsense&#160;computation&#160;will&#160;merely&#160;produce&#160;NaN&#160;(not&#160;a&#160;num-<br/>
ber)&#160;or&#160;an&#160;undefined&#160;value,&#160;while&#160;the&#160;program&#160;happily&#160;continues,&#160;convinced<br/>that&#160;it’s&#160;doing&#160;something&#160;meaningful.&#160;The&#160;mistake&#160;will&#160;manifest&#160;itself&#160;only<br/>later,&#160;after&#160;the&#160;bogus&#160;value&#160;has&#160;traveled&#160;through&#160;several&#160;functions.&#160;It&#160;might<br/>not&#160;trigger&#160;an&#160;error&#160;at&#160;all&#160;but&#160;silently&#160;cause&#160;the&#160;program’s&#160;output&#160;to&#160;be&#160;wrong.<br/>Finding&#160;the&#160;source&#160;of&#160;such&#160;problems&#160;can&#160;be&#160;difficult.<br/>
The&#160;process&#160;of&#160;finding&#160;mistakes—bugs—in&#160;programs&#160;is&#160;called&#160;<i>debugging</i>.<br/>
128<br/>
<hr/>
<a name=141></a><b>Strict&#160;mode</b><br/>
JavaScript&#160;can&#160;be&#160;made&#160;a&#160;<i>little&#160;</i>stricter&#160;by&#160;enabling&#160;<i>strict&#160;mode</i>.&#160;This&#160;is&#160;done&#160;by<br/>putting&#160;the&#160;string&#160;&#34;use&#160;strict&#34;&#160;at&#160;the&#160;top&#160;of&#160;a&#160;file&#160;or&#160;a&#160;function&#160;body.&#160;Here’s<br/>an&#160;example:<br/>
function&#160;canYouSpotTheProblem()&#160;{<br/>
&#34;use&#160;strict&#34;;<br/>for&#160;(counter&#160;=&#160;0;&#160;counter&#160;&lt;&#160;10;&#160;counter++)&#160;{<br/>
console.log(&#34;Happy&#160;happy&#34;);<br/>
}<br/>
}<br/>
canYouSpotTheProblem();<br/>//&#160;→&#160;ReferenceError:&#160;counter&#160;is&#160;not&#160;defined<br/>
Normally,&#160;when&#160;you&#160;forget&#160;to&#160;put&#160;let&#160;in&#160;front&#160;of&#160;your&#160;binding,&#160;as&#160;with<br/>
counter&#160;in&#160;the&#160;example,&#160;JavaScript&#160;quietly&#160;creates&#160;a&#160;global&#160;binding&#160;and&#160;uses<br/>that.&#160;In&#160;strict&#160;mode,&#160;an&#160;error&#160;is&#160;reported&#160;instead.&#160;This&#160;is&#160;very&#160;helpful.&#160;It&#160;should<br/>be&#160;noted,&#160;though,&#160;that&#160;this&#160;doesn’t&#160;work&#160;when&#160;the&#160;binding&#160;in&#160;question&#160;already<br/>exists&#160;as&#160;a&#160;global&#160;binding.&#160;In&#160;that&#160;case,&#160;the&#160;loop&#160;will&#160;still&#160;quietly&#160;overwrite&#160;the<br/>value&#160;of&#160;the&#160;binding.<br/>
Another&#160;change&#160;in&#160;strict&#160;mode&#160;is&#160;that&#160;the&#160;this&#160;binding&#160;holds&#160;the&#160;value<br/>
undefined&#160;in&#160;functions&#160;that&#160;are&#160;not&#160;called&#160;as&#160;methods.&#160;When&#160;making&#160;such<br/>a&#160;call&#160;outside&#160;of&#160;strict&#160;mode,&#160;this&#160;refers&#160;to&#160;the&#160;global&#160;scope&#160;object,&#160;which&#160;is<br/>an&#160;object&#160;whose&#160;properties&#160;are&#160;the&#160;global&#160;bindings.&#160;So&#160;if&#160;you&#160;accidentally&#160;call<br/>a&#160;method&#160;or&#160;constructor&#160;incorrectly&#160;in&#160;strict&#160;mode,&#160;JavaScript&#160;will&#160;produce<br/>an&#160;error&#160;as&#160;soon&#160;as&#160;it&#160;tries&#160;to&#160;read&#160;something&#160;from&#160;this,&#160;rather&#160;than&#160;happily<br/>writing&#160;to&#160;the&#160;global&#160;scope.<br/>
For&#160;example,&#160;consider&#160;the&#160;following&#160;code,&#160;which&#160;calls&#160;a&#160;constructor&#160;function<br/>
without&#160;the&#160;new&#160;keyword&#160;so&#160;that&#160;its&#160;this&#160;will&#160;<i>not&#160;</i>refer&#160;to&#160;a&#160;newly&#160;constructed<br/>object:<br/>
function&#160;Person(name)&#160;{&#160;this.name&#160;=&#160;name;&#160;}<br/>let&#160;ferdinand&#160;=&#160;Person(&#34;Ferdinand&#34;);&#160;//&#160;oops<br/>console.log(name);<br/>//&#160;→&#160;Ferdinand<br/>
So&#160;the&#160;bogus&#160;call&#160;to&#160;Person&#160;succeeded&#160;but&#160;returned&#160;an&#160;undefined&#160;value&#160;and<br/>
created&#160;the&#160;global&#160;binding&#160;name.&#160;In&#160;strict&#160;mode,&#160;the&#160;result&#160;is&#160;different.<br/>
&#34;use&#160;strict&#34;;<br/>
129<br/>
<hr/>
<a name=142></a>function&#160;Person(name)&#160;{&#160;this.name&#160;=&#160;name;&#160;}<br/>let&#160;ferdinand&#160;=&#160;Person(&#34;Ferdinand&#34;);&#160;//&#160;forgot&#160;new<br/>//&#160;→&#160;TypeError:&#160;Cannot&#160;set&#160;property&#160;'name'&#160;of&#160;undefined<br/>
We&#160;are&#160;immediately&#160;told&#160;that&#160;something&#160;is&#160;wrong.&#160;This&#160;is&#160;helpful.<br/>Fortunately,&#160;constructors&#160;created&#160;with&#160;the&#160;class&#160;notation&#160;will&#160;always&#160;com-<br/>
plain&#160;if&#160;they&#160;are&#160;called&#160;without&#160;new,&#160;making&#160;this&#160;less&#160;of&#160;a&#160;problem&#160;even&#160;in<br/>non-strict&#160;mode.<br/>
Strict&#160;mode&#160;does&#160;a&#160;few&#160;more&#160;things.&#160;It&#160;disallows&#160;giving&#160;a&#160;function&#160;multiple<br/>
parameters&#160;with&#160;the&#160;same&#160;name&#160;and&#160;removes&#160;certain&#160;problematic&#160;language<br/>features&#160;entirely&#160;(such&#160;as&#160;the&#160;with&#160;statement,&#160;which&#160;is&#160;so&#160;wrong&#160;it&#160;is&#160;not&#160;further<br/>discussed&#160;in&#160;this&#160;book).<br/>
In&#160;short,&#160;putting&#160;&#34;use&#160;strict&#34;&#160;at&#160;the&#160;top&#160;of&#160;your&#160;program&#160;rarely&#160;hurts&#160;and<br/>
might&#160;help&#160;you&#160;spot&#160;a&#160;problem.<br/>
<b>Types</b><br/>
Some&#160;languages&#160;want&#160;to&#160;know&#160;the&#160;types&#160;of&#160;all&#160;your&#160;bindings&#160;and&#160;expressions<br/>before&#160;even&#160;running&#160;a&#160;program.&#160;They&#160;will&#160;tell&#160;you&#160;right&#160;away&#160;when&#160;a&#160;type<br/>is&#160;used&#160;in&#160;an&#160;inconsistent&#160;way.&#160;JavaScript&#160;considers&#160;types&#160;only&#160;when&#160;actually<br/>running&#160;the&#160;program,&#160;and&#160;even&#160;there&#160;often&#160;tries&#160;to&#160;implicitly&#160;convert&#160;values&#160;to<br/>the&#160;type&#160;it&#160;expects,&#160;so&#160;it’s&#160;not&#160;much&#160;help.<br/>
Still,&#160;types&#160;provide&#160;a&#160;useful&#160;framework&#160;for&#160;talking&#160;about&#160;programs.&#160;A&#160;lot&#160;of<br/>
mistakes&#160;come&#160;from&#160;being&#160;confused&#160;about&#160;the&#160;kind&#160;of&#160;value&#160;that&#160;goes&#160;into&#160;or<br/>comes&#160;out&#160;of&#160;a&#160;function.&#160;If&#160;you&#160;have&#160;that&#160;information&#160;written&#160;down,&#160;you’re&#160;less<br/>likely&#160;to&#160;get&#160;confused.<br/>
You&#160;could&#160;add&#160;a&#160;comment&#160;like&#160;the&#160;following&#160;before&#160;the&#160;goalOrientedRobot<br/>
function&#160;from&#160;the&#160;previous&#160;chapter&#160;to&#160;describe&#160;its&#160;type:<br/>
//&#160;(VillageState,&#160;Array)&#160;→&#160;{direction:&#160;string,&#160;memory:&#160;Array}<br/>function&#160;goalOrientedRobot(state,&#160;memory)&#160;{<br/>
//&#160;...<br/>
}<br/>
There&#160;are&#160;a&#160;number&#160;of&#160;different&#160;conventions&#160;for&#160;annotating&#160;JavaScript&#160;pro-<br/>
grams&#160;with&#160;types.<br/>
One&#160;thing&#160;about&#160;types&#160;is&#160;that&#160;they&#160;need&#160;to&#160;introduce&#160;their&#160;own&#160;complexity<br/>
to&#160;be&#160;able&#160;to&#160;describe&#160;enough&#160;code&#160;to&#160;be&#160;useful.&#160;What&#160;do&#160;you&#160;think&#160;would&#160;be<br/>the&#160;type&#160;of&#160;the&#160;randomPick&#160;function&#160;that&#160;returns&#160;a&#160;random&#160;element&#160;from&#160;an<br/>
130<br/>
<hr/>
<a name=143></a>array?&#160;You’d&#160;need&#160;to&#160;introduce&#160;a&#160;<i>type&#160;variable</i>,&#160;<i>T</i>,&#160;which&#160;can&#160;stand&#160;in&#160;for&#160;any<br/>type,&#160;so&#160;that&#160;you&#160;can&#160;give&#160;randomPick&#160;a&#160;type&#160;like&#160;([T])→&#160;T&#160;(function&#160;from&#160;an<br/>array&#160;of&#160;<i>T</i>s&#160;to&#160;a&#160;<i>T</i>).<br/>
When&#160;the&#160;types&#160;of&#160;a&#160;program&#160;are&#160;known,&#160;it&#160;is&#160;possible&#160;for&#160;the&#160;computer&#160;to<br/>
<i>check&#160;</i>them&#160;for&#160;you,&#160;pointing&#160;out&#160;mistakes&#160;before&#160;the&#160;program&#160;is&#160;run.&#160;There<br/>are&#160;several&#160;JavaScript&#160;dialects&#160;that&#160;add&#160;types&#160;to&#160;the&#160;language&#160;and&#160;check&#160;them.<br/>The&#160;most&#160;popular&#160;one&#160;is&#160;called&#160;<a href="https://www.typescriptlang.org/">TypeScript.&#160;</a>If&#160;you&#160;are&#160;interested&#160;in&#160;adding<br/>more&#160;rigor&#160;to&#160;your&#160;programs,&#160;I&#160;recommend&#160;you&#160;give&#160;it&#160;a&#160;try.<br/>
In&#160;this&#160;book,&#160;we’ll&#160;continue&#160;using&#160;raw,&#160;dangerous,&#160;untyped&#160;JavaScript&#160;code.<br/>
<b>Testing</b><br/>
If&#160;the&#160;language&#160;is&#160;not&#160;going&#160;to&#160;do&#160;much&#160;to&#160;help&#160;us&#160;find&#160;mistakes,&#160;we’ll&#160;have&#160;to<br/>find&#160;them&#160;the&#160;hard&#160;way:&#160;by&#160;running&#160;the&#160;program&#160;and&#160;seeing&#160;whether&#160;it&#160;does<br/>the&#160;right&#160;thing.<br/>
Doing&#160;this&#160;by&#160;hand,&#160;again&#160;and&#160;again,&#160;is&#160;a&#160;really&#160;bad&#160;idea.&#160;Not&#160;only&#160;is<br/>
it&#160;annoying,&#160;it&#160;also&#160;tends&#160;to&#160;be&#160;ineffective&#160;since&#160;it&#160;takes&#160;too&#160;much&#160;time&#160;to<br/>exhaustively&#160;test&#160;everything&#160;every&#160;time&#160;you&#160;make&#160;a&#160;change.<br/>
Computers&#160;are&#160;good&#160;at&#160;repetitive&#160;tasks,&#160;and&#160;testing&#160;is&#160;the&#160;ideal&#160;repetitive<br/>
task.&#160;Automated&#160;testing&#160;is&#160;the&#160;process&#160;of&#160;writing&#160;a&#160;program&#160;that&#160;tests&#160;another<br/>program.&#160;Writing&#160;tests&#160;is&#160;a&#160;bit&#160;more&#160;work&#160;than&#160;testing&#160;manually,&#160;but&#160;once<br/>you’ve&#160;done&#160;it,&#160;you&#160;gain&#160;a&#160;kind&#160;of&#160;superpower:&#160;it&#160;takes&#160;you&#160;only&#160;a&#160;few&#160;seconds<br/>to&#160;verify&#160;that&#160;your&#160;program&#160;still&#160;behaves&#160;properly&#160;in&#160;all&#160;the&#160;situations&#160;you<br/>wrote&#160;tests&#160;for.&#160;When&#160;you&#160;break&#160;something,&#160;you’ll&#160;immediately&#160;notice,&#160;rather<br/>than&#160;randomly&#160;running&#160;into&#160;it&#160;at&#160;some&#160;later&#160;time.<br/>
Tests&#160;usually&#160;take&#160;the&#160;form&#160;of&#160;little&#160;labeled&#160;programs&#160;that&#160;verify&#160;some&#160;aspect<br/>
of&#160;your&#160;code.&#160;For&#160;example,&#160;a&#160;set&#160;of&#160;tests&#160;for&#160;the&#160;(standard,&#160;probably&#160;already<br/>tested&#160;by&#160;someone&#160;else)&#160;toUpperCase&#160;method&#160;might&#160;look&#160;like&#160;this:<br/>
function&#160;test(label,&#160;body)&#160;{<br/>
if&#160;(!body())&#160;console.log(`Failed:&#160;${label}`);<br/>
}<br/>
test(&#34;convert&#160;Latin&#160;text&#160;to&#160;uppercase&#34;,&#160;()&#160;=&gt;&#160;{<br/>
return&#160;&#34;hello&#34;.toUpperCase()&#160;==&#160;&#34;HELLO&#34;;<br/>
});<br/>test(&#34;convert&#160;Greek&#160;text&#160;to&#160;uppercase&#34;,&#160;()&#160;=&gt;&#160;{<br/>
return&#160;&#34;Χαίρετε&#34;.toUpperCase()&#160;==&#160;&#34;ΧΑΊΡΕΤΕ&#34;;<br/>
});<br/>test(&#34;don't&#160;convert&#160;case-less&#160;characters&#34;,&#160;()&#160;=&gt;&#160;{<br/>
return&#160;&#34;߈࠶ࢎఆ௷&#34;.toUpperCase()&#160;==&#160;&#34;߈࠶ࢎఆ௷&#34;;<br/>
131<br/>
<hr/>
<a name=144></a>});<br/>
Writing&#160;tests&#160;like&#160;this&#160;tends&#160;to&#160;produce&#160;rather&#160;repetitive,&#160;awkward&#160;code.&#160;For-<br/>
tunately,&#160;there&#160;exist&#160;pieces&#160;of&#160;software&#160;that&#160;help&#160;you&#160;build&#160;and&#160;run&#160;collections<br/>of&#160;tests&#160;(<i>test&#160;suites</i>)&#160;by&#160;providing&#160;a&#160;language&#160;(in&#160;the&#160;form&#160;of&#160;functions&#160;and<br/>methods)&#160;suited&#160;to&#160;expressing&#160;tests&#160;and&#160;by&#160;outputting&#160;informative&#160;information<br/>when&#160;a&#160;test&#160;fails.&#160;These&#160;are&#160;usually&#160;called&#160;<i>test&#160;runners</i>.<br/>
Some&#160;code&#160;is&#160;easier&#160;to&#160;test&#160;than&#160;other&#160;code.&#160;Generally,&#160;the&#160;more&#160;external<br/>
objects&#160;that&#160;the&#160;code&#160;interacts&#160;with,&#160;the&#160;harder&#160;it&#160;is&#160;to&#160;set&#160;up&#160;the&#160;context&#160;in<br/>which&#160;to&#160;test&#160;it.&#160;The&#160;style&#160;of&#160;programming&#160;shown&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#129">previous&#160;chapter,<br/></a>which&#160;uses&#160;self-contained&#160;persistent&#160;values&#160;rather&#160;than&#160;changing&#160;objects,&#160;tends<br/>to&#160;be&#160;easy&#160;to&#160;test.<br/>
<b>Debugging</b><br/>
Once&#160;you&#160;notice&#160;there&#160;is&#160;something&#160;wrong&#160;with&#160;your&#160;program&#160;because&#160;it&#160;mis-<br/>behaves&#160;or&#160;produces&#160;errors,&#160;the&#160;next&#160;step&#160;is&#160;to&#160;figure&#160;out&#160;<i>what&#160;</i>the&#160;problem<br/>is.<br/>
Sometimes&#160;it&#160;is&#160;obvious.&#160;The&#160;error&#160;message&#160;will&#160;point&#160;at&#160;a&#160;specific&#160;line&#160;of<br/>
your&#160;program,&#160;and&#160;if&#160;you&#160;look&#160;at&#160;the&#160;error&#160;description&#160;and&#160;that&#160;line&#160;of&#160;code,<br/>you&#160;can&#160;often&#160;see&#160;the&#160;problem.<br/>
But&#160;not&#160;always.&#160;Sometimes&#160;the&#160;line&#160;that&#160;triggered&#160;the&#160;problem&#160;is&#160;simply&#160;the<br/>
first&#160;place&#160;where&#160;a&#160;flaky&#160;value&#160;produced&#160;elsewhere&#160;gets&#160;used&#160;in&#160;an&#160;invalid&#160;way.<br/>If&#160;you&#160;have&#160;been&#160;solving&#160;the&#160;exercises&#160;in&#160;earlier&#160;chapters,&#160;you&#160;will&#160;probably<br/>have&#160;already&#160;experienced&#160;such&#160;situations.<br/>
The&#160;following&#160;example&#160;program&#160;tries&#160;to&#160;convert&#160;a&#160;whole&#160;number&#160;to&#160;a&#160;string<br/>
in&#160;a&#160;given&#160;base&#160;(decimal,&#160;binary,&#160;and&#160;so&#160;on)&#160;by&#160;repeatedly&#160;picking&#160;out&#160;the&#160;last<br/>digit&#160;and&#160;then&#160;dividing&#160;the&#160;number&#160;to&#160;get&#160;rid&#160;of&#160;this&#160;digit.&#160;But&#160;the&#160;strange<br/>output&#160;that&#160;it&#160;currently&#160;produces&#160;suggests&#160;that&#160;it&#160;has&#160;a&#160;bug.<br/>
function&#160;numberToString(n,&#160;base&#160;=&#160;10)&#160;{<br/>
let&#160;result&#160;=&#160;&#34;&#34;,&#160;sign&#160;=&#160;&#34;&#34;;<br/>if&#160;(n&#160;&lt;&#160;0)&#160;{<br/>
sign&#160;=&#160;&#34;-&#34;;<br/>n&#160;=&#160;-n;<br/>
}<br/>do&#160;{<br/>
result&#160;=&#160;String(n&#160;%&#160;base)&#160;+&#160;result;<br/>n&#160;/=&#160;base;<br/>
}&#160;while&#160;(n&#160;&gt;&#160;0);<br/>return&#160;sign&#160;+&#160;result;<br/>
132<br/>
<hr/>
<a name=145></a>}<br/>console.log(numberToString(13,&#160;10));<br/>//&#160;→&#160;1.5e-3231.3e-3221.3e-3211.3e-3201.3e-3191.3e…-3181.3<br/>
Even&#160;if&#160;you&#160;see&#160;the&#160;problem&#160;already,&#160;pretend&#160;for&#160;a&#160;moment&#160;that&#160;you&#160;don’t.<br/>
We&#160;know&#160;that&#160;our&#160;program&#160;is&#160;malfunctioning,&#160;and&#160;we&#160;want&#160;to&#160;find&#160;out&#160;why.<br/>
This&#160;is&#160;where&#160;you&#160;must&#160;resist&#160;the&#160;urge&#160;to&#160;start&#160;making&#160;random&#160;changes&#160;to<br/>
the&#160;code&#160;to&#160;see&#160;whether&#160;that&#160;makes&#160;it&#160;better.&#160;Instead,&#160;<i>think</i>.&#160;Analyze&#160;what&#160;is<br/>happening&#160;and&#160;come&#160;up&#160;with&#160;a&#160;theory&#160;of&#160;why&#160;it&#160;might&#160;be&#160;happening.&#160;Then,<br/>make&#160;additional&#160;observations&#160;to&#160;test&#160;this&#160;theory—or,&#160;if&#160;you&#160;don’t&#160;yet&#160;have&#160;a<br/>theory,&#160;make&#160;additional&#160;observations&#160;to&#160;help&#160;you&#160;come&#160;up&#160;with&#160;one.<br/>
Putting&#160;a&#160;few&#160;strategic&#160;console.log&#160;calls&#160;into&#160;the&#160;program&#160;is&#160;a&#160;good&#160;way&#160;to<br/>
get&#160;additional&#160;information&#160;about&#160;what&#160;the&#160;program&#160;is&#160;doing.&#160;In&#160;this&#160;case,&#160;we<br/>want&#160;n&#160;to&#160;take&#160;the&#160;values&#160;13,&#160;1,&#160;and&#160;then&#160;0.&#160;Let’s&#160;write&#160;out&#160;its&#160;value&#160;at&#160;the<br/>start&#160;of&#160;the&#160;loop.<br/>
13<br/>1.3<br/>0.13<br/>0.013…<br/>
1.5e-323<br/>
<i>Right</i>.&#160;Dividing&#160;13&#160;by&#160;10&#160;does&#160;not&#160;produce&#160;a&#160;whole&#160;number.&#160;Instead&#160;of&#160;n&#160;/=<br/>
base,&#160;what&#160;we&#160;actually&#160;want&#160;is&#160;n&#160;=&#160;Math.floor(n&#160;/&#160;base)&#160;so&#160;that&#160;the&#160;number<br/>is&#160;properly&#160;“shifted”&#160;to&#160;the&#160;right.<br/>
An&#160;alternative&#160;to&#160;using&#160;console.log&#160;to&#160;peek&#160;into&#160;the&#160;program’s&#160;behavior&#160;is&#160;to<br/>
use&#160;the&#160;<i>debugger&#160;</i>capabilities&#160;of&#160;your&#160;browser.&#160;Browsers&#160;come&#160;with&#160;the&#160;ability<br/>to&#160;set&#160;a&#160;<i>breakpoint&#160;</i>on&#160;a&#160;specific&#160;line&#160;of&#160;your&#160;code.&#160;When&#160;the&#160;execution&#160;of&#160;the<br/>program&#160;reaches&#160;a&#160;line&#160;with&#160;a&#160;breakpoint,&#160;it&#160;is&#160;paused,&#160;and&#160;you&#160;can&#160;inspect&#160;the<br/>values&#160;of&#160;bindings&#160;at&#160;that&#160;point.&#160;I&#160;won’t&#160;go&#160;into&#160;details,&#160;as&#160;debuggers&#160;differ<br/>from&#160;browser&#160;to&#160;browser,&#160;but&#160;look&#160;in&#160;your&#160;browser’s&#160;developer&#160;tools&#160;or&#160;search<br/>the&#160;Web&#160;for&#160;more&#160;information.<br/>
Another&#160;way&#160;to&#160;set&#160;a&#160;breakpoint&#160;is&#160;to&#160;include&#160;a&#160;debugger&#160;statement&#160;(con-<br/>
sisting&#160;of&#160;simply&#160;that&#160;keyword)&#160;in&#160;your&#160;program.&#160;If&#160;the&#160;developer&#160;tools&#160;of<br/>your&#160;browser&#160;are&#160;active,&#160;the&#160;program&#160;will&#160;pause&#160;whenever&#160;it&#160;reaches&#160;such&#160;a<br/>statement.<br/>
133<br/>
<hr/>
<a name=146></a><b>Error&#160;propagation</b><br/>
Not&#160;all&#160;problems&#160;can&#160;be&#160;prevented&#160;by&#160;the&#160;programmer,&#160;unfortunately.&#160;If&#160;your<br/>program&#160;communicates&#160;with&#160;the&#160;outside&#160;world&#160;in&#160;any&#160;way,&#160;it&#160;is&#160;possible&#160;to&#160;get<br/>malformed&#160;input,&#160;to&#160;become&#160;overloaded&#160;with&#160;work,&#160;or&#160;to&#160;have&#160;the&#160;network&#160;fail.<br/>
If&#160;you’re&#160;programming&#160;only&#160;for&#160;yourself,&#160;you&#160;can&#160;afford&#160;to&#160;just&#160;ignore&#160;such<br/>
problems&#160;until&#160;they&#160;occur.&#160;But&#160;if&#160;you&#160;build&#160;something&#160;that&#160;is&#160;going&#160;to&#160;be&#160;used<br/>by&#160;anybody&#160;else,&#160;you&#160;usually&#160;want&#160;the&#160;program&#160;to&#160;do&#160;better&#160;than&#160;just&#160;crash.<br/>Sometimes&#160;the&#160;right&#160;thing&#160;to&#160;do&#160;is&#160;take&#160;the&#160;bad&#160;input&#160;in&#160;stride&#160;and&#160;continue<br/>running.&#160;In&#160;other&#160;cases,&#160;it&#160;is&#160;better&#160;to&#160;report&#160;to&#160;the&#160;user&#160;what&#160;went&#160;wrong&#160;and<br/>then&#160;give&#160;up.&#160;But&#160;in&#160;either&#160;situation,&#160;the&#160;program&#160;has&#160;to&#160;actively&#160;do&#160;something<br/>in&#160;response&#160;to&#160;the&#160;problem.<br/>
Say&#160;you&#160;have&#160;a&#160;function&#160;promptNumber&#160;that&#160;asks&#160;the&#160;user&#160;for&#160;a&#160;number&#160;and<br/>
returns&#160;it.&#160;What&#160;should&#160;it&#160;return&#160;if&#160;the&#160;user&#160;inputs&#160;“orange”?<br/>
One&#160;option&#160;is&#160;to&#160;make&#160;it&#160;return&#160;a&#160;special&#160;value.&#160;Common&#160;choices&#160;for&#160;such<br/>
values&#160;are&#160;null,&#160;undefined,&#160;or&#160;-1.<br/>
function&#160;promptNumber(question)&#160;{<br/>
let&#160;result&#160;=&#160;Number(prompt(question));<br/>if&#160;(Number.isNaN(result))&#160;return&#160;null;<br/>else&#160;return&#160;result;<br/>
}<br/>
console.log(promptNumber(&#34;How&#160;many&#160;trees&#160;do&#160;you&#160;see?&#34;));<br/>
Now&#160;any&#160;code&#160;that&#160;calls&#160;promptNumber&#160;must&#160;check&#160;whether&#160;an&#160;actual&#160;number<br/>
was&#160;read&#160;and,&#160;failing&#160;that,&#160;must&#160;somehow&#160;recover—maybe&#160;by&#160;asking&#160;again&#160;or<br/>by&#160;filling&#160;in&#160;a&#160;default&#160;value.&#160;Or&#160;it&#160;could&#160;again&#160;return&#160;a&#160;special&#160;value&#160;to&#160;<i>its&#160;</i>caller<br/>to&#160;indicate&#160;that&#160;it&#160;failed&#160;to&#160;do&#160;what&#160;it&#160;was&#160;asked.<br/>
In&#160;many&#160;situations,&#160;mostly&#160;when&#160;errors&#160;are&#160;common&#160;and&#160;the&#160;caller&#160;should<br/>
be&#160;explicitly&#160;taking&#160;them&#160;into&#160;account,&#160;returning&#160;a&#160;special&#160;value&#160;is&#160;a&#160;good&#160;way<br/>to&#160;indicate&#160;an&#160;error.&#160;It&#160;does,&#160;however,&#160;have&#160;its&#160;downsides.&#160;First,&#160;what&#160;if&#160;the<br/>function&#160;can&#160;already&#160;return&#160;every&#160;possible&#160;kind&#160;of&#160;value?&#160;In&#160;such&#160;a&#160;function,<br/>you’ll&#160;have&#160;to&#160;do&#160;something&#160;like&#160;wrap&#160;the&#160;result&#160;in&#160;an&#160;object&#160;to&#160;be&#160;able&#160;to<br/>distinguish&#160;success&#160;from&#160;failure.<br/>
function&#160;lastElement(array)&#160;{<br/>
if&#160;(array.length&#160;==&#160;0)&#160;{<br/>
return&#160;{failed:&#160;true};<br/>
}&#160;else&#160;{<br/>
return&#160;{element:&#160;array[array.length&#160;-&#160;1]};<br/>
}<br/>
134<br/>
<hr/>
<a name=147></a>}<br/>
The&#160;second&#160;issue&#160;with&#160;returning&#160;special&#160;values&#160;is&#160;that&#160;it&#160;can&#160;lead&#160;to&#160;awkward<br/>
code.&#160;If&#160;a&#160;piece&#160;of&#160;code&#160;calls&#160;promptNumber&#160;10&#160;times,&#160;it&#160;has&#160;to&#160;check&#160;10&#160;times<br/>whether&#160;null&#160;was&#160;returned.&#160;And&#160;if&#160;its&#160;response&#160;to&#160;finding&#160;null&#160;is&#160;to&#160;simply<br/>return&#160;null&#160;itself,&#160;callers&#160;of&#160;the&#160;function&#160;will&#160;in&#160;turn&#160;have&#160;to&#160;check&#160;for&#160;it,&#160;and<br/>so&#160;on.<br/>
<b>Exceptions</b><br/>
When&#160;a&#160;function&#160;cannot&#160;proceed&#160;normally,&#160;what&#160;we&#160;would&#160;<i>like&#160;</i>to&#160;do&#160;is&#160;just<br/>stop&#160;what&#160;we&#160;are&#160;doing&#160;and&#160;immediately&#160;jump&#160;to&#160;a&#160;place&#160;that&#160;knows&#160;how&#160;to<br/>handle&#160;the&#160;problem.&#160;This&#160;is&#160;what&#160;<i>exception&#160;handling&#160;</i>does.<br/>
Exceptions&#160;are&#160;a&#160;mechanism&#160;that&#160;makes&#160;it&#160;possible&#160;for&#160;code&#160;that&#160;runs&#160;into<br/>
a&#160;problem&#160;to&#160;<i>raise&#160;</i>(or&#160;<i>throw</i>)&#160;an&#160;exception.&#160;An&#160;exception&#160;can&#160;be&#160;any&#160;value.<br/>Raising&#160;one&#160;somewhat&#160;resembles&#160;a&#160;super-charged&#160;return&#160;from&#160;a&#160;function:&#160;it<br/>jumps&#160;out&#160;of&#160;not&#160;just&#160;the&#160;current&#160;function&#160;but&#160;also&#160;its&#160;callers,&#160;all&#160;the&#160;way&#160;down<br/>to&#160;the&#160;first&#160;call&#160;that&#160;started&#160;the&#160;current&#160;execution.&#160;This&#160;is&#160;called&#160;<i>unwinding<br/>the&#160;stack</i>.&#160;You&#160;may&#160;remember&#160;the&#160;stack&#160;of&#160;function&#160;calls&#160;that&#160;was&#160;mentioned<br/>in&#160;<a href="eloquent-javascripts.html#56">Chapter&#160;3</a>.&#160;An&#160;exception&#160;zooms&#160;down&#160;this&#160;stack,&#160;throwing&#160;away&#160;all&#160;the&#160;call<br/>contexts&#160;it&#160;encounters.<br/>
If&#160;exceptions&#160;always&#160;zoomed&#160;right&#160;down&#160;to&#160;the&#160;bottom&#160;of&#160;the&#160;stack,&#160;they<br/>
would&#160;not&#160;be&#160;of&#160;much&#160;use.&#160;They’d&#160;just&#160;provide&#160;a&#160;novel&#160;way&#160;to&#160;blow&#160;up&#160;your<br/>program.&#160;Their&#160;power&#160;lies&#160;in&#160;the&#160;fact&#160;that&#160;you&#160;can&#160;set&#160;“obstacles”&#160;along&#160;the<br/>stack&#160;to&#160;<i>catch&#160;</i>the&#160;exception&#160;as&#160;it&#160;is&#160;zooming&#160;down.&#160;Once&#160;you’ve&#160;caught&#160;an<br/>exception,&#160;you&#160;can&#160;do&#160;something&#160;with&#160;it&#160;to&#160;address&#160;the&#160;problem&#160;and&#160;then<br/>continue&#160;to&#160;run&#160;the&#160;program.<br/>
Here’s&#160;an&#160;example:<br/>
function&#160;promptDirection(question)&#160;{<br/>
let&#160;result&#160;=&#160;prompt(question);<br/>if&#160;(result.toLowerCase()&#160;==&#160;&#34;left&#34;)&#160;return&#160;&#34;L&#34;;<br/>if&#160;(result.toLowerCase()&#160;==&#160;&#34;right&#34;)&#160;return&#160;&#34;R&#34;;<br/>throw&#160;new&#160;Error(&#34;Invalid&#160;direction:&#160;&#34;&#160;+&#160;result);<br/>
}<br/>
function&#160;look()&#160;{<br/>
if&#160;(promptDirection(&#34;Which&#160;way?&#34;)&#160;==&#160;&#34;L&#34;)&#160;{<br/>
return&#160;&#34;a&#160;house&#34;;<br/>
}&#160;else&#160;{<br/>
return&#160;&#34;two&#160;angry&#160;bears&#34;;<br/>
135<br/>
<hr/>
<a name=148></a>}<br/>
}<br/>
try&#160;{<br/>
console.log(&#34;You&#160;see&#34;,&#160;look());<br/>
}&#160;catch&#160;(error)&#160;{<br/>
console.log(&#34;Something&#160;went&#160;wrong:&#160;&#34;&#160;+&#160;error);<br/>
}<br/>
The&#160;throw&#160;keyword&#160;is&#160;used&#160;to&#160;raise&#160;an&#160;exception.&#160;Catching&#160;one&#160;is&#160;done&#160;by<br/>
wrapping&#160;a&#160;piece&#160;of&#160;code&#160;in&#160;a&#160;try&#160;block,&#160;followed&#160;by&#160;the&#160;keyword&#160;catch.&#160;When<br/>the&#160;code&#160;in&#160;the&#160;try&#160;block&#160;causes&#160;an&#160;exception&#160;to&#160;be&#160;raised,&#160;the&#160;catch&#160;block&#160;is<br/>evaluated,&#160;with&#160;the&#160;name&#160;in&#160;parentheses&#160;bound&#160;to&#160;the&#160;exception&#160;value.&#160;After<br/>the&#160;catch&#160;block&#160;finishes—or&#160;if&#160;the&#160;try&#160;block&#160;finishes&#160;without&#160;problems—the<br/>program&#160;proceeds&#160;beneath&#160;the&#160;entire&#160;try/catch&#160;statement.<br/>
In&#160;this&#160;case,&#160;we&#160;used&#160;the&#160;Error&#160;constructor&#160;to&#160;create&#160;our&#160;exception&#160;value.<br/>
This&#160;is&#160;a&#160;standard&#160;JavaScript&#160;constructor&#160;that&#160;creates&#160;an&#160;object&#160;with&#160;a&#160;message<br/>property.&#160;In&#160;most&#160;JavaScript&#160;environments,&#160;instances&#160;of&#160;this&#160;constructor&#160;also<br/>gather&#160;information&#160;about&#160;the&#160;call&#160;stack&#160;that&#160;existed&#160;when&#160;the&#160;exception&#160;was<br/>created,&#160;a&#160;so-called&#160;<i>stack&#160;trace</i>.&#160;This&#160;information&#160;is&#160;stored&#160;in&#160;the&#160;stack&#160;property<br/>and&#160;can&#160;be&#160;helpful&#160;when&#160;trying&#160;to&#160;debug&#160;a&#160;problem:&#160;it&#160;tells&#160;us&#160;the&#160;function<br/>where&#160;the&#160;problem&#160;occurred&#160;and&#160;which&#160;functions&#160;made&#160;the&#160;failing&#160;call.<br/>
Note&#160;that&#160;the&#160;look&#160;function&#160;completely&#160;ignores&#160;the&#160;possibility&#160;that&#160;promptDirection<br/>
might&#160;go&#160;wrong.&#160;This&#160;is&#160;the&#160;big&#160;advantage&#160;of&#160;exceptions:&#160;error-handling&#160;code<br/>
is&#160;necessary&#160;only&#160;at&#160;the&#160;point&#160;where&#160;the&#160;error&#160;occurs&#160;and&#160;at&#160;the&#160;point&#160;where&#160;it<br/>is&#160;handled.&#160;The&#160;functions&#160;in&#160;between&#160;can&#160;forget&#160;all&#160;about&#160;it.<br/>
Well,&#160;almost...<br/>
<b>Cleaning&#160;up&#160;after&#160;exceptions</b><br/>
The&#160;effect&#160;of&#160;an&#160;exception&#160;is&#160;another&#160;kind&#160;of&#160;control&#160;flow.&#160;Every&#160;action&#160;that<br/>might&#160;cause&#160;an&#160;exception,&#160;which&#160;is&#160;pretty&#160;much&#160;every&#160;function&#160;call&#160;and&#160;property<br/>access,&#160;might&#160;cause&#160;control&#160;to&#160;suddenly&#160;leave&#160;your&#160;code.<br/>
This&#160;means&#160;when&#160;code&#160;has&#160;several&#160;side&#160;effects,&#160;even&#160;if&#160;its&#160;“regular”&#160;control<br/>
flow&#160;looks&#160;like&#160;they’ll&#160;always&#160;all&#160;happen,&#160;an&#160;exception&#160;might&#160;prevent&#160;some&#160;of<br/>them&#160;from&#160;taking&#160;place.<br/>
Here&#160;is&#160;some&#160;really&#160;bad&#160;banking&#160;code.<br/>
const&#160;accounts&#160;=&#160;{<br/>
a:&#160;100,<br/>
136<br/>
<hr/>
<a name=149></a>b:&#160;0,<br/>c:&#160;20<br/>
};<br/>
function&#160;getAccount()&#160;{<br/>
let&#160;accountName&#160;=&#160;prompt(&#34;Enter&#160;an&#160;account&#160;name&#34;);<br/>if&#160;(!accounts.hasOwnProperty(accountName))&#160;{<br/>
throw&#160;new&#160;Error(`No&#160;such&#160;account:&#160;${accountName}`);<br/>
}<br/>return&#160;accountName;<br/>
}<br/>
function&#160;transfer(from,&#160;amount)&#160;{<br/>
if&#160;(accounts[from]&#160;&lt;&#160;amount)&#160;return;<br/>accounts[from]&#160;-=&#160;amount;<br/>accounts[getAccount()]&#160;+=&#160;amount;<br/>
}<br/>
The&#160;transfer&#160;function&#160;transfers&#160;a&#160;sum&#160;of&#160;money&#160;from&#160;a&#160;given&#160;account&#160;to<br/>
another,&#160;asking&#160;for&#160;the&#160;name&#160;of&#160;the&#160;other&#160;account&#160;in&#160;the&#160;process.&#160;If&#160;given&#160;an<br/>invalid&#160;account&#160;name,&#160;getAccount&#160;throws&#160;an&#160;exception.<br/>
But&#160;transfer&#160;<i>first&#160;</i>removes&#160;the&#160;money&#160;from&#160;the&#160;account&#160;and&#160;<i>then&#160;</i>calls<br/>
getAccount&#160;before&#160;it&#160;adds&#160;it&#160;to&#160;another&#160;account.<br/>
If&#160;it&#160;is&#160;broken&#160;off&#160;by&#160;an<br/>
exception&#160;at&#160;that&#160;point,&#160;it’ll&#160;just&#160;make&#160;the&#160;money&#160;disappear.<br/>
That&#160;code&#160;could&#160;have&#160;been&#160;written&#160;a&#160;little&#160;more&#160;intelligently,&#160;for&#160;example&#160;by<br/>
calling&#160;getAccount&#160;before&#160;it&#160;starts&#160;moving&#160;money&#160;around.&#160;But&#160;often&#160;problems<br/>like&#160;this&#160;occur&#160;in&#160;more&#160;subtle&#160;ways.&#160;Even&#160;functions&#160;that&#160;don’t&#160;look&#160;like&#160;they<br/>will&#160;throw&#160;an&#160;exception&#160;might&#160;do&#160;so&#160;in&#160;exceptional&#160;circumstances&#160;or&#160;when&#160;they<br/>contain&#160;a&#160;programmer&#160;mistake.<br/>
One&#160;way&#160;to&#160;address&#160;this&#160;is&#160;to&#160;use&#160;fewer&#160;side&#160;effects.&#160;Again,&#160;a&#160;programming<br/>
style&#160;that&#160;computes&#160;new&#160;values&#160;instead&#160;of&#160;changing&#160;existing&#160;data&#160;helps.&#160;If&#160;a<br/>piece&#160;of&#160;code&#160;stops&#160;running&#160;in&#160;the&#160;middle&#160;of&#160;creating&#160;a&#160;new&#160;value,&#160;no&#160;one&#160;ever<br/>sees&#160;the&#160;half-finished&#160;value,&#160;and&#160;there&#160;is&#160;no&#160;problem.<br/>
But&#160;that&#160;isn’t&#160;always&#160;practical.&#160;So&#160;there&#160;is&#160;another&#160;feature&#160;that&#160;try&#160;state-<br/>
ments&#160;have.&#160;They&#160;may&#160;be&#160;followed&#160;by&#160;a&#160;finally&#160;block&#160;either&#160;instead&#160;of&#160;or&#160;in<br/>addition&#160;to&#160;a&#160;catch&#160;block.&#160;A&#160;finally&#160;block&#160;says&#160;“no&#160;matter&#160;<i>what&#160;</i>happens,&#160;run<br/>this&#160;code&#160;after&#160;trying&#160;to&#160;run&#160;the&#160;code&#160;in&#160;the&#160;try&#160;block.”<br/>
function&#160;transfer(from,&#160;amount)&#160;{<br/>
if&#160;(accounts[from]&#160;&lt;&#160;amount)&#160;return;<br/>let&#160;progress&#160;=&#160;0;<br/>try&#160;{<br/>
137<br/>
<hr/>
<a name=150></a>accounts[from]&#160;-=&#160;amount;<br/>progress&#160;=&#160;1;<br/>accounts[getAccount()]&#160;+=&#160;amount;<br/>progress&#160;=&#160;2;<br/>
}&#160;finally&#160;{<br/>
if&#160;(progress&#160;==&#160;1)&#160;{<br/>
accounts[from]&#160;+=&#160;amount;<br/>
}<br/>
}<br/>
}<br/>
This&#160;version&#160;of&#160;the&#160;function&#160;tracks&#160;its&#160;progress,&#160;and&#160;if,&#160;when&#160;leaving,&#160;it&#160;notices<br/>
that&#160;it&#160;was&#160;aborted&#160;at&#160;a&#160;point&#160;where&#160;it&#160;had&#160;created&#160;an&#160;inconsistent&#160;program<br/>state,&#160;it&#160;repairs&#160;the&#160;damage&#160;it&#160;did.<br/>
Note&#160;that&#160;even&#160;though&#160;the&#160;finally&#160;code&#160;is&#160;run&#160;when&#160;an&#160;exception&#160;is&#160;thrown<br/>
in&#160;the&#160;try&#160;block,&#160;it&#160;does&#160;not&#160;interfere&#160;with&#160;the&#160;exception.&#160;After&#160;the&#160;finally<br/>block&#160;runs,&#160;the&#160;stack&#160;continues&#160;unwinding.<br/>
Writing&#160;programs&#160;that&#160;operate&#160;reliably&#160;even&#160;when&#160;exceptions&#160;pop&#160;up&#160;in&#160;un-<br/>
expected&#160;places&#160;is&#160;hard.&#160;Many&#160;people&#160;simply&#160;don’t&#160;bother,&#160;and&#160;because&#160;ex-<br/>ceptions&#160;are&#160;typically&#160;reserved&#160;for&#160;exceptional&#160;circumstances,&#160;the&#160;problem&#160;may<br/>occur&#160;so&#160;rarely&#160;that&#160;it&#160;is&#160;never&#160;even&#160;noticed.&#160;Whether&#160;that&#160;is&#160;a&#160;good&#160;thing&#160;or<br/>a&#160;really&#160;bad&#160;thing&#160;depends&#160;on&#160;how&#160;much&#160;damage&#160;the&#160;software&#160;will&#160;do&#160;when&#160;it<br/>fails.<br/>
<b>Selective&#160;catching</b><br/>
When&#160;an&#160;exception&#160;makes&#160;it&#160;all&#160;the&#160;way&#160;to&#160;the&#160;bottom&#160;of&#160;the&#160;stack&#160;without<br/>being&#160;caught,&#160;it&#160;gets&#160;handled&#160;by&#160;the&#160;environment.&#160;What&#160;this&#160;means&#160;differs<br/>between&#160;environments.&#160;In&#160;browsers,&#160;a&#160;description&#160;of&#160;the&#160;error&#160;typically&#160;gets<br/>written&#160;to&#160;the&#160;JavaScript&#160;console&#160;(reachable&#160;through&#160;the&#160;browser’s&#160;Tools&#160;or<br/>Developer&#160;menu).&#160;Node.js,&#160;the&#160;browserless&#160;JavaScript&#160;environment&#160;we&#160;will<br/>discuss&#160;in&#160;<a href="eloquent-javascripts.html#362">Chapter&#160;20</a>,&#160;is&#160;more&#160;careful&#160;about&#160;data&#160;corruption.&#160;It&#160;aborts&#160;the<br/>whole&#160;process&#160;when&#160;an&#160;unhandled&#160;exception&#160;occurs.<br/>
For&#160;programmer&#160;mistakes,&#160;just&#160;letting&#160;the&#160;error&#160;go&#160;through&#160;is&#160;often&#160;the&#160;best<br/>
you&#160;can&#160;do.&#160;An&#160;unhandled&#160;exception&#160;is&#160;a&#160;reasonable&#160;way&#160;to&#160;signal&#160;a&#160;broken<br/>program,&#160;and&#160;the&#160;JavaScript&#160;console&#160;will,&#160;on&#160;modern&#160;browsers,&#160;provide&#160;you<br/>with&#160;some&#160;information&#160;about&#160;which&#160;function&#160;calls&#160;were&#160;on&#160;the&#160;stack&#160;when&#160;the<br/>problem&#160;occurred.<br/>
For&#160;problems&#160;that&#160;are&#160;<i>expected&#160;</i>to&#160;happen&#160;during&#160;routine&#160;use,&#160;crashing&#160;with<br/>
an&#160;unhandled&#160;exception&#160;is&#160;a&#160;terrible&#160;strategy.<br/>
138<br/>
<hr/>
<a name=151></a>Invalid&#160;uses&#160;of&#160;the&#160;language,&#160;such&#160;as&#160;referencing&#160;a&#160;nonexistent&#160;binding,&#160;look-<br/>
ing&#160;up&#160;a&#160;property&#160;on&#160;null,&#160;or&#160;calling&#160;something&#160;that’s&#160;not&#160;a&#160;function,&#160;will&#160;also<br/>result&#160;in&#160;exceptions&#160;being&#160;raised.&#160;Such&#160;exceptions&#160;can&#160;also&#160;be&#160;caught.<br/>
When&#160;a&#160;catch&#160;body&#160;is&#160;entered,&#160;all&#160;we&#160;know&#160;is&#160;that&#160;<i>something&#160;</i>in&#160;our&#160;try<br/>
body&#160;caused&#160;an&#160;exception.&#160;But&#160;we&#160;don’t&#160;know&#160;<i>what&#160;</i>did&#160;or&#160;<i>which&#160;</i>exception&#160;it<br/>caused.<br/>
JavaScript&#160;(in&#160;a&#160;rather&#160;glaring&#160;omission)&#160;doesn’t&#160;provide&#160;direct&#160;support&#160;for<br/>
selectively&#160;catching&#160;exceptions:&#160;either&#160;you&#160;catch&#160;them&#160;all&#160;or&#160;you&#160;don’t&#160;catch<br/>any.&#160;This&#160;makes&#160;it&#160;tempting&#160;to&#160;<i>assume&#160;</i>that&#160;the&#160;exception&#160;you&#160;get&#160;is&#160;the&#160;one<br/>you&#160;were&#160;thinking&#160;about&#160;when&#160;you&#160;wrote&#160;the&#160;catch&#160;block.<br/>
But&#160;it&#160;might&#160;not&#160;be.&#160;Some&#160;other&#160;assumption&#160;might&#160;be&#160;violated,&#160;or&#160;you&#160;might<br/>
have&#160;introduced&#160;a&#160;bug&#160;that&#160;is&#160;causing&#160;an&#160;exception.&#160;Here&#160;is&#160;an&#160;example&#160;that<br/><i>attempts&#160;</i>to&#160;keep&#160;on&#160;calling&#160;promptDirection&#160;until&#160;it&#160;gets&#160;a&#160;valid&#160;answer:<br/>
for&#160;(;;)&#160;{<br/>
try&#160;{<br/>
let&#160;dir&#160;=&#160;promtDirection(&#34;Where?&#34;);&#160;//&#160;←&#160;typo!<br/>console.log(&#34;You&#160;chose&#160;&#34;,&#160;dir);<br/>break;<br/>
}&#160;catch&#160;(e)&#160;{<br/>
console.log(&#34;Not&#160;a&#160;valid&#160;direction.&#160;Try&#160;again.&#34;);<br/>
}<br/>
}<br/>
The&#160;for&#160;(;;)&#160;construct&#160;is&#160;a&#160;way&#160;to&#160;intentionally&#160;create&#160;a&#160;loop&#160;that&#160;doesn’t<br/>
terminate&#160;on&#160;its&#160;own.&#160;We&#160;break&#160;out&#160;of&#160;the&#160;loop&#160;only&#160;when&#160;a&#160;valid&#160;direction&#160;is<br/>given.&#160;<i>But&#160;</i>we&#160;misspelled&#160;promptDirection,&#160;which&#160;will&#160;result&#160;in&#160;an&#160;“undefined<br/>variable”&#160;error.&#160;Because&#160;the&#160;catch&#160;block&#160;completely&#160;ignores&#160;its&#160;exception&#160;value<br/>(e),&#160;assuming&#160;it&#160;knows&#160;what&#160;the&#160;problem&#160;is,&#160;it&#160;wrongly&#160;treats&#160;the&#160;binding&#160;error<br/>as&#160;indicating&#160;bad&#160;input.&#160;Not&#160;only&#160;does&#160;this&#160;cause&#160;an&#160;infinite&#160;loop,&#160;it&#160;“buries”<br/>the&#160;useful&#160;error&#160;message&#160;about&#160;the&#160;misspelled&#160;binding.<br/>
As&#160;a&#160;general&#160;rule,&#160;don’t&#160;blanket-catch&#160;exceptions&#160;unless&#160;it&#160;is&#160;for&#160;the&#160;purpose<br/>
of&#160;“routing”&#160;them&#160;somewhere—for&#160;example,&#160;over&#160;the&#160;network&#160;to&#160;tell&#160;another<br/>system&#160;that&#160;our&#160;program&#160;crashed.&#160;And&#160;even&#160;then,&#160;think&#160;carefully&#160;about&#160;how<br/>you&#160;might&#160;be&#160;hiding&#160;information.<br/>
So&#160;we&#160;want&#160;to&#160;catch&#160;a&#160;<i>specific&#160;</i>kind&#160;of&#160;exception.&#160;We&#160;can&#160;do&#160;this&#160;by&#160;checking<br/>
in&#160;the&#160;catch&#160;block&#160;whether&#160;the&#160;exception&#160;we&#160;got&#160;is&#160;the&#160;one&#160;we&#160;are&#160;interested<br/>in&#160;and&#160;rethrowing&#160;it&#160;otherwise.&#160;But&#160;how&#160;do&#160;we&#160;recognize&#160;an&#160;exception?<br/>
We&#160;could&#160;compare&#160;its&#160;message&#160;property&#160;against&#160;the&#160;error&#160;message&#160;we&#160;happen<br/>
to&#160;expect.&#160;But&#160;that’s&#160;a&#160;shaky&#160;way&#160;to&#160;write&#160;code—we’d&#160;be&#160;using&#160;information<br/>that’s&#160;intended&#160;for&#160;human&#160;consumption&#160;(the&#160;message)&#160;to&#160;make&#160;a&#160;programmatic<br/>
139<br/>
<hr/>
<a name=152></a>decision.&#160;As&#160;soon&#160;as&#160;someone&#160;changes&#160;(or&#160;translates)&#160;the&#160;message,&#160;the&#160;code&#160;will<br/>stop&#160;working.<br/>
Rather,&#160;let’s&#160;define&#160;a&#160;new&#160;type&#160;of&#160;error&#160;and&#160;use&#160;instanceof&#160;to&#160;identify&#160;it.<br/>
class&#160;InputError&#160;extends&#160;Error&#160;{}<br/>
function&#160;promptDirection(question)&#160;{<br/>
let&#160;result&#160;=&#160;prompt(question);<br/>if&#160;(result.toLowerCase()&#160;==&#160;&#34;left&#34;)&#160;return&#160;&#34;L&#34;;<br/>if&#160;(result.toLowerCase()&#160;==&#160;&#34;right&#34;)&#160;return&#160;&#34;R&#34;;<br/>throw&#160;new&#160;InputError(&#34;Invalid&#160;direction:&#160;&#34;&#160;+&#160;result);<br/>
}<br/>
The&#160;new&#160;error&#160;class&#160;extends&#160;Error.&#160;It&#160;doesn’t&#160;define&#160;its&#160;own&#160;constructor,<br/>
which&#160;means&#160;that&#160;it&#160;inherits&#160;the&#160;Error&#160;constructor,&#160;which&#160;expects&#160;a&#160;string<br/>message&#160;as&#160;argument.&#160;In&#160;fact,&#160;it&#160;doesn’t&#160;define&#160;anything&#160;at&#160;all—the&#160;class&#160;is<br/>empty.&#160;InputError&#160;objects&#160;behave&#160;like&#160;Error&#160;objects,&#160;except&#160;that&#160;they&#160;have&#160;a<br/>different&#160;class&#160;by&#160;which&#160;we&#160;can&#160;recognize&#160;them.<br/>
Now&#160;the&#160;loop&#160;can&#160;catch&#160;these&#160;more&#160;carefully.<br/>
for&#160;(;;)&#160;{<br/>
try&#160;{<br/>
let&#160;dir&#160;=&#160;promptDirection(&#34;Where?&#34;);<br/>console.log(&#34;You&#160;chose&#160;&#34;,&#160;dir);<br/>break;<br/>
}&#160;catch&#160;(e)&#160;{<br/>
if&#160;(e&#160;instanceof&#160;InputError)&#160;{<br/>
console.log(&#34;Not&#160;a&#160;valid&#160;direction.&#160;Try&#160;again.&#34;);<br/>
}&#160;else&#160;{<br/>
throw&#160;e;<br/>
}<br/>
}<br/>
}<br/>
This&#160;will&#160;catch&#160;only&#160;instances&#160;of&#160;InputError&#160;and&#160;let&#160;unrelated&#160;exceptions<br/>
through.&#160;If&#160;you&#160;reintroduce&#160;the&#160;typo,&#160;the&#160;undefined&#160;binding&#160;error&#160;will&#160;be&#160;prop-<br/>erly&#160;reported.<br/>
<b>Assertions</b><br/>
<i>Assertions&#160;</i>are&#160;checks&#160;inside&#160;a&#160;program&#160;that&#160;verify&#160;that&#160;something&#160;is&#160;the&#160;way<br/>it&#160;is&#160;supposed&#160;to&#160;be.&#160;They&#160;are&#160;used&#160;not&#160;to&#160;handle&#160;situations&#160;that&#160;can&#160;come&#160;up<br/>
140<br/>
<hr/>
<a name=153></a>in&#160;normal&#160;operation&#160;but&#160;to&#160;find&#160;programmer&#160;mistakes.<br/>
If,&#160;for&#160;example,&#160;firstElement&#160;is&#160;described&#160;as&#160;a&#160;function&#160;that&#160;should&#160;never&#160;be<br/>
called&#160;on&#160;empty&#160;arrays,&#160;we&#160;might&#160;write&#160;it&#160;like&#160;this:<br/>
function&#160;firstElement(array)&#160;{<br/>
if&#160;(array.length&#160;==&#160;0)&#160;{<br/>
throw&#160;new&#160;Error(&#34;firstElement&#160;called&#160;with&#160;[]&#34;);<br/>
}<br/>return&#160;array[0];<br/>
}<br/>
Now,&#160;instead&#160;of&#160;silently&#160;returning&#160;undefined&#160;(which&#160;you&#160;get&#160;when&#160;reading<br/>
an&#160;array&#160;property&#160;that&#160;does&#160;not&#160;exist),&#160;this&#160;will&#160;loudly&#160;blow&#160;up&#160;your&#160;program<br/>as&#160;soon&#160;as&#160;you&#160;misuse&#160;it.&#160;This&#160;makes&#160;it&#160;less&#160;likely&#160;for&#160;such&#160;mistakes&#160;to&#160;go<br/>unnoticed&#160;and&#160;easier&#160;to&#160;find&#160;their&#160;cause&#160;when&#160;they&#160;occur.<br/>
I&#160;do&#160;not&#160;recommend&#160;trying&#160;to&#160;write&#160;assertions&#160;for&#160;every&#160;possible&#160;kind&#160;of&#160;bad<br/>
input.&#160;That’d&#160;be&#160;a&#160;lot&#160;of&#160;work&#160;and&#160;would&#160;lead&#160;to&#160;very&#160;noisy&#160;code.&#160;You’ll&#160;want<br/>to&#160;reserve&#160;them&#160;for&#160;mistakes&#160;that&#160;are&#160;easy&#160;to&#160;make&#160;(or&#160;that&#160;you&#160;find&#160;yourself<br/>making).<br/>
<b>Summary</b><br/>
Mistakes&#160;and&#160;bad&#160;input&#160;are&#160;facts&#160;of&#160;life.&#160;An&#160;important&#160;part&#160;of&#160;programming&#160;is<br/>finding,&#160;diagnosing,&#160;and&#160;fixing&#160;bugs.&#160;Problems&#160;can&#160;become&#160;easier&#160;to&#160;notice&#160;if<br/>you&#160;have&#160;an&#160;automated&#160;test&#160;suite&#160;or&#160;add&#160;assertions&#160;to&#160;your&#160;programs.<br/>
Problems&#160;caused&#160;by&#160;factors&#160;outside&#160;the&#160;program’s&#160;control&#160;should&#160;usually<br/>
be&#160;handled&#160;gracefully.&#160;Sometimes,&#160;when&#160;the&#160;problem&#160;can&#160;be&#160;handled&#160;locally,<br/>special&#160;return&#160;values&#160;are&#160;a&#160;good&#160;way&#160;to&#160;track&#160;them.&#160;Otherwise,&#160;exceptions&#160;may<br/>be&#160;preferable.<br/>
Throwing&#160;an&#160;exception&#160;causes&#160;the&#160;call&#160;stack&#160;to&#160;be&#160;unwound&#160;until&#160;the&#160;next<br/>
enclosing&#160;try/catch&#160;block&#160;or&#160;until&#160;the&#160;bottom&#160;of&#160;the&#160;stack.&#160;The&#160;exception<br/>value&#160;will&#160;be&#160;given&#160;to&#160;the&#160;catch&#160;block&#160;that&#160;catches&#160;it,&#160;which&#160;should&#160;verify&#160;that<br/>it&#160;is&#160;actually&#160;the&#160;expected&#160;kind&#160;of&#160;exception&#160;and&#160;then&#160;do&#160;something&#160;with&#160;it.<br/>To&#160;help&#160;address&#160;the&#160;unpredictable&#160;control&#160;flow&#160;caused&#160;by&#160;exceptions,&#160;finally<br/>blocks&#160;can&#160;be&#160;used&#160;to&#160;ensure&#160;that&#160;a&#160;piece&#160;of&#160;code&#160;<i>always&#160;</i>runs&#160;when&#160;a&#160;block<br/>finishes.<br/>
141<br/>
<hr/>
<a name=154></a><b>Exercises</b><br/>
<b>Retry</b><br/>
Say&#160;you&#160;have&#160;a&#160;function&#160;primitiveMultiply&#160;that&#160;in&#160;20&#160;percent&#160;of&#160;cases&#160;mul-<br/>tiplies&#160;two&#160;numbers&#160;and&#160;in&#160;the&#160;other&#160;80&#160;percent&#160;of&#160;cases&#160;raises&#160;an&#160;exception<br/>of&#160;type&#160;MultiplicatorUnitFailure.&#160;Write&#160;a&#160;function&#160;that&#160;wraps&#160;this&#160;clunky<br/>function&#160;and&#160;just&#160;keeps&#160;trying&#160;until&#160;a&#160;call&#160;succeeds,&#160;after&#160;which&#160;it&#160;returns&#160;the<br/>result.<br/>
Make&#160;sure&#160;you&#160;handle&#160;only&#160;the&#160;exceptions&#160;you&#160;are&#160;trying&#160;to&#160;handle.<br/>
<b>The&#160;locked&#160;box</b><br/>
Consider&#160;the&#160;following&#160;(rather&#160;contrived)&#160;object:<br/>
const&#160;box&#160;=&#160;{<br/>
locked:&#160;true,<br/>unlock()&#160;{&#160;this.locked&#160;=&#160;false;&#160;},<br/>lock()&#160;{&#160;this.locked&#160;=&#160;true;<br/>
},<br/>
_content:&#160;[],<br/>get&#160;content()&#160;{<br/>
if&#160;(this.locked)&#160;throw&#160;new&#160;Error(&#34;Locked!&#34;);<br/>return&#160;this._content;<br/>
}<br/>
};<br/>
It&#160;is&#160;a&#160;box&#160;with&#160;a&#160;lock.&#160;There&#160;is&#160;an&#160;array&#160;in&#160;the&#160;box,&#160;but&#160;you&#160;can&#160;get&#160;at&#160;it&#160;only<br/>
when&#160;the&#160;box&#160;is&#160;unlocked.&#160;Directly&#160;accessing&#160;the&#160;private&#160;_content&#160;property&#160;is<br/>forbidden.<br/>
Write&#160;a&#160;function&#160;called&#160;withBoxUnlocked&#160;that&#160;takes&#160;a&#160;function&#160;value&#160;as&#160;ar-<br/>
gument,&#160;unlocks&#160;the&#160;box,&#160;runs&#160;the&#160;function,&#160;and&#160;then&#160;ensures&#160;that&#160;the&#160;box<br/>is&#160;locked&#160;again&#160;before&#160;returning,&#160;regardless&#160;of&#160;whether&#160;the&#160;argument&#160;function<br/>returned&#160;normally&#160;or&#160;threw&#160;an&#160;exception.<br/>
For&#160;extra&#160;points,&#160;make&#160;sure&#160;that&#160;if&#160;you&#160;call&#160;withBoxUnlocked&#160;when&#160;the&#160;box<br/>
is&#160;already&#160;unlocked,&#160;the&#160;box&#160;stays&#160;unlocked.<br/>
142<br/>
<hr/>
<a name=155></a><i>“Some&#160;people,&#160;when&#160;confronted&#160;with&#160;a&#160;problem,&#160;think&#160;‘I&#160;know,&#160;I’ll</i><br/>
<i>use&#160;regular&#160;expressions.’&#160;Now&#160;they&#160;have&#160;two&#160;problems.”</i><br/>
—Jamie&#160;Zawinski<br/>
<b>Chapter&#160;9<br/>Regular&#160;Expressions</b><br/>
Programming&#160;tools&#160;and&#160;techniques&#160;survive&#160;and&#160;spread&#160;in&#160;a&#160;chaotic,&#160;evolutionary<br/>way.&#160;It’s&#160;not&#160;always&#160;the&#160;pretty&#160;or&#160;brilliant&#160;ones&#160;that&#160;win&#160;but&#160;rather&#160;the&#160;ones<br/>that&#160;function&#160;well&#160;enough&#160;within&#160;the&#160;right&#160;niche&#160;or&#160;that&#160;happen&#160;to&#160;be&#160;integrated<br/>with&#160;another&#160;successful&#160;piece&#160;of&#160;technology.<br/>
In&#160;this&#160;chapter,&#160;I&#160;will&#160;discuss&#160;one&#160;such&#160;tool,&#160;<i>regular&#160;expressions</i>.&#160;Regular<br/>
expressions&#160;are&#160;a&#160;way&#160;to&#160;describe&#160;patterns&#160;in&#160;string&#160;data.&#160;They&#160;form&#160;a&#160;small,<br/>separate&#160;language&#160;that&#160;is&#160;part&#160;of&#160;JavaScript&#160;and&#160;many&#160;other&#160;languages&#160;and<br/>systems.<br/>
Regular&#160;expressions&#160;are&#160;both&#160;terribly&#160;awkward&#160;and&#160;extremely&#160;useful.&#160;Their<br/>
syntax&#160;is&#160;cryptic,&#160;and&#160;the&#160;programming&#160;interface&#160;JavaScript&#160;provides&#160;for&#160;them<br/>is&#160;clumsy.&#160;But&#160;they&#160;are&#160;a&#160;powerful&#160;tool&#160;for&#160;inspecting&#160;and&#160;processing&#160;strings.<br/>Properly&#160;understanding&#160;regular&#160;expressions&#160;will&#160;make&#160;you&#160;a&#160;more&#160;effective&#160;pro-<br/>grammer.<br/>
<b>Creating&#160;a&#160;regular&#160;expression</b><br/>
A&#160;regular&#160;expression&#160;is&#160;a&#160;type&#160;of&#160;object.&#160;It&#160;can&#160;be&#160;either&#160;constructed&#160;with<br/>the&#160;RegExp&#160;constructor&#160;or&#160;written&#160;as&#160;a&#160;literal&#160;value&#160;by&#160;enclosing&#160;a&#160;pattern&#160;in<br/>forward&#160;slash&#160;(/)&#160;characters.<br/>
let&#160;re1&#160;=&#160;new&#160;RegExp(&#34;abc&#34;);<br/>let&#160;re2&#160;=&#160;/abc/;<br/>
Both&#160;of&#160;those&#160;regular&#160;expression&#160;objects&#160;represent&#160;the&#160;same&#160;pattern:&#160;an&#160;<i>a</i><br/>
character&#160;followed&#160;by&#160;a&#160;<i>b&#160;</i>followed&#160;by&#160;a&#160;<i>c</i>.<br/>
When&#160;using&#160;the&#160;RegExp&#160;constructor,&#160;the&#160;pattern&#160;is&#160;written&#160;as&#160;a&#160;normal&#160;string,<br/>
so&#160;the&#160;usual&#160;rules&#160;apply&#160;for&#160;backslashes.<br/>
The&#160;second&#160;notation,&#160;where&#160;the&#160;pattern&#160;appears&#160;between&#160;slash&#160;characters,<br/>
treats&#160;backslashes&#160;somewhat&#160;differently.&#160;First,&#160;since&#160;a&#160;forward&#160;slash&#160;ends&#160;the<br/>pattern,&#160;we&#160;need&#160;to&#160;put&#160;a&#160;backslash&#160;before&#160;any&#160;forward&#160;slash&#160;that&#160;we&#160;want<br/>
143<br/>
<hr/>
<a name=156></a>to&#160;be&#160;<i>part&#160;</i>of&#160;the&#160;pattern.&#160;In&#160;addition,&#160;backslashes&#160;that&#160;aren’t&#160;part&#160;of&#160;special<br/>character&#160;codes&#160;(like&#160;\n)&#160;will&#160;be&#160;<i>preserved</i>,&#160;rather&#160;than&#160;ignored&#160;as&#160;they&#160;are<br/>in&#160;strings,&#160;and&#160;change&#160;the&#160;meaning&#160;of&#160;the&#160;pattern.&#160;Some&#160;characters,&#160;such&#160;as<br/>question&#160;marks&#160;and&#160;plus&#160;signs,&#160;have&#160;special&#160;meanings&#160;in&#160;regular&#160;expressions&#160;and<br/>must&#160;be&#160;preceded&#160;by&#160;a&#160;backslash&#160;if&#160;they&#160;are&#160;meant&#160;to&#160;represent&#160;the&#160;character<br/>itself.<br/>
let&#160;eighteenPlus&#160;=&#160;/eighteen\+/;<br/>
<b>Testing&#160;for&#160;matches</b><br/>
Regular&#160;expression&#160;objects&#160;have&#160;a&#160;number&#160;of&#160;methods.&#160;The&#160;simplest&#160;one&#160;is<br/>test.&#160;If&#160;you&#160;pass&#160;it&#160;a&#160;string,&#160;it&#160;will&#160;return&#160;a&#160;Boolean&#160;telling&#160;you&#160;whether&#160;the<br/>string&#160;contains&#160;a&#160;match&#160;of&#160;the&#160;pattern&#160;in&#160;the&#160;expression.<br/>
console.log(/abc/.test(&#34;abcde&#34;));<br/>//&#160;→&#160;true<br/>console.log(/abc/.test(&#34;abxde&#34;));<br/>//&#160;→&#160;false<br/>
A&#160;regular&#160;expression&#160;consisting&#160;of&#160;only&#160;nonspecial&#160;characters&#160;simply&#160;repre-<br/>
sents&#160;that&#160;sequence&#160;of&#160;characters.&#160;If&#160;<i>abc&#160;</i>occurs&#160;anywhere&#160;in&#160;the&#160;string&#160;we&#160;are<br/>testing&#160;against&#160;(not&#160;just&#160;at&#160;the&#160;start),&#160;test&#160;will&#160;return&#160;true.<br/>
<b>Sets&#160;of&#160;characters</b><br/>
Finding&#160;out&#160;whether&#160;a&#160;string&#160;contains&#160;<i>abc&#160;</i>could&#160;just&#160;as&#160;well&#160;be&#160;done&#160;with&#160;a&#160;call<br/>to&#160;indexOf.&#160;Regular&#160;expressions&#160;allow&#160;us&#160;to&#160;express&#160;more&#160;complicated&#160;patterns.<br/>
Say&#160;we&#160;want&#160;to&#160;match&#160;any&#160;number.&#160;In&#160;a&#160;regular&#160;expression,&#160;putting&#160;a&#160;set<br/>
of&#160;characters&#160;between&#160;square&#160;brackets&#160;makes&#160;that&#160;part&#160;of&#160;the&#160;expression&#160;match<br/>any&#160;of&#160;the&#160;characters&#160;between&#160;the&#160;brackets.<br/>
Both&#160;of&#160;the&#160;following&#160;expressions&#160;match&#160;all&#160;strings&#160;that&#160;contain&#160;a&#160;digit:<br/>
console.log(/[0123456789]/.test(&#34;in&#160;1992&#34;));<br/>//&#160;→&#160;true<br/>console.log(/[0-9]/.test(&#34;in&#160;1992&#34;));<br/>//&#160;→&#160;true<br/>
144<br/>
<hr/>
<a name=157></a>Within&#160;square&#160;brackets,&#160;a&#160;hyphen&#160;(-)&#160;between&#160;two&#160;characters&#160;can&#160;be&#160;used<br/>
to&#160;indicate&#160;a&#160;range&#160;of&#160;characters,&#160;where&#160;the&#160;ordering&#160;is&#160;determined&#160;by&#160;the<br/>character’s&#160;Unicode&#160;number.&#160;Characters&#160;0&#160;to&#160;9&#160;sit&#160;right&#160;next&#160;to&#160;each&#160;other&#160;in<br/>this&#160;ordering&#160;(codes&#160;48&#160;to&#160;57),&#160;so&#160;[0-9]&#160;covers&#160;all&#160;of&#160;them&#160;and&#160;matches&#160;any<br/>digit.<br/>
A&#160;number&#160;of&#160;common&#160;character&#160;groups&#160;have&#160;their&#160;own&#160;built-in&#160;shortcuts.<br/>
Digits&#160;are&#160;one&#160;of&#160;them:&#160;\d&#160;means&#160;the&#160;same&#160;thing&#160;as&#160;[0-9].<br/>
\d<br/>
Any&#160;digit&#160;character<br/>
\w<br/>
An&#160;alphanumeric&#160;character&#160;(“word&#160;character”)<br/>
\s<br/>
Any&#160;whitespace&#160;character&#160;(space,&#160;tab,&#160;newline,&#160;and&#160;similar)<br/>
\D<br/>
A&#160;character&#160;that&#160;is&#160;<i>not&#160;</i>a&#160;digit<br/>
\W<br/>
A&#160;nonalphanumeric&#160;character<br/>
\S<br/>
A&#160;nonwhitespace&#160;character<br/>
.<br/>
Any&#160;character&#160;except&#160;for&#160;newline<br/>
So&#160;you&#160;could&#160;match&#160;a&#160;date&#160;and&#160;time&#160;format&#160;like&#160;01-30-2003&#160;15:20&#160;with&#160;the<br/>
following&#160;expression:<br/>
let&#160;dateTime&#160;=&#160;/\d\d-\d\d-\d\d\d\d&#160;\d\d:\d\d/;<br/>console.log(dateTime.test(&#34;01-30-2003&#160;15:20&#34;));<br/>//&#160;→&#160;true<br/>console.log(dateTime.test(&#34;30-jan-2003&#160;15:20&#34;));<br/>//&#160;→&#160;false<br/>
That&#160;looks&#160;completely&#160;awful,&#160;doesn’t&#160;it?&#160;Half&#160;of&#160;it&#160;is&#160;backslashes,&#160;producing<br/>
a&#160;background&#160;noise&#160;that&#160;makes&#160;it&#160;hard&#160;to&#160;spot&#160;the&#160;actual&#160;pattern&#160;expressed.<br/>We’ll&#160;see&#160;a&#160;slightly&#160;improved&#160;version&#160;of&#160;this&#160;expression&#160;<a href="eloquent-javascripts.html#158">later.</a><br/>
These&#160;backslash&#160;codes&#160;can&#160;also&#160;be&#160;used&#160;inside&#160;square&#160;brackets.&#160;For&#160;example,<br/>
[\d.]&#160;means&#160;any&#160;digit&#160;or&#160;a&#160;period&#160;character.&#160;But&#160;the&#160;period&#160;itself,&#160;between<br/>square&#160;brackets,&#160;loses&#160;its&#160;special&#160;meaning.&#160;The&#160;same&#160;goes&#160;for&#160;other&#160;special<br/>characters,&#160;such&#160;as&#160;+.<br/>
To&#160;<i>invert&#160;</i>a&#160;set&#160;of&#160;characters—that&#160;is,&#160;to&#160;express&#160;that&#160;you&#160;want&#160;to&#160;match&#160;any<br/>
character&#160;<i>except&#160;</i>the&#160;ones&#160;in&#160;the&#160;set—you&#160;can&#160;write&#160;a&#160;caret&#160;(^)&#160;character&#160;after<br/>the&#160;opening&#160;bracket.<br/>
let&#160;notBinary&#160;=&#160;/[^01]/;<br/>console.log(notBinary.test(&#34;1100100010100110&#34;));<br/>//&#160;→&#160;false<br/>console.log(notBinary.test(&#34;1100100010200110&#34;));<br/>//&#160;→&#160;true<br/>
145<br/>
<hr/>
<a name=158></a><b>Repeating&#160;parts&#160;of&#160;a&#160;pattern</b><br/>
We&#160;now&#160;know&#160;how&#160;to&#160;match&#160;a&#160;single&#160;digit.&#160;What&#160;if&#160;we&#160;want&#160;to&#160;match&#160;a&#160;whole<br/>number—a&#160;sequence&#160;of&#160;one&#160;or&#160;more&#160;digits?<br/>
When&#160;you&#160;put&#160;a&#160;plus&#160;sign&#160;(+)&#160;after&#160;something&#160;in&#160;a&#160;regular&#160;expression,&#160;it<br/>
indicates&#160;that&#160;the&#160;element&#160;may&#160;be&#160;repeated&#160;more&#160;than&#160;once.&#160;Thus,&#160;/\d+/<br/>matches&#160;one&#160;or&#160;more&#160;digit&#160;characters.<br/>
console.log(/'\d+'/.test(&#34;'123'&#34;));<br/>//&#160;→&#160;true<br/>console.log(/'\d+'/.test(&#34;''&#34;));<br/>//&#160;→&#160;false<br/>console.log(/'\d*'/.test(&#34;'123'&#34;));<br/>//&#160;→&#160;true<br/>console.log(/'\d*'/.test(&#34;''&#34;));<br/>//&#160;→&#160;true<br/>
The&#160;star&#160;(*)&#160;has&#160;a&#160;similar&#160;meaning&#160;but&#160;also&#160;allows&#160;the&#160;pattern&#160;to&#160;match&#160;zero<br/>
times.&#160;Something&#160;with&#160;a&#160;star&#160;after&#160;it&#160;never&#160;prevents&#160;a&#160;pattern&#160;from&#160;matching—<br/>it’ll&#160;just&#160;match&#160;zero&#160;instances&#160;if&#160;it&#160;can’t&#160;find&#160;any&#160;suitable&#160;text&#160;to&#160;match.<br/>
A&#160;question&#160;mark&#160;makes&#160;a&#160;part&#160;of&#160;a&#160;pattern&#160;<i>optional</i>,&#160;meaning&#160;it&#160;may&#160;occur<br/>
zero&#160;times&#160;or&#160;one&#160;time.&#160;In&#160;the&#160;following&#160;example,&#160;the&#160;<i>u&#160;</i>character&#160;is&#160;allowed&#160;to<br/>occur,&#160;but&#160;the&#160;pattern&#160;also&#160;matches&#160;when&#160;it&#160;is&#160;missing.<br/>
let&#160;neighbor&#160;=&#160;/neighbou?r/;<br/>console.log(neighbor.test(&#34;neighbour&#34;));<br/>//&#160;→&#160;true<br/>console.log(neighbor.test(&#34;neighbor&#34;));<br/>//&#160;→&#160;true<br/>
To&#160;indicate&#160;that&#160;a&#160;pattern&#160;should&#160;occur&#160;a&#160;precise&#160;number&#160;of&#160;times,&#160;use&#160;braces.<br/>
Putting&#160;{4}&#160;after&#160;an&#160;element,&#160;for&#160;example,&#160;requires&#160;it&#160;to&#160;occur&#160;exactly&#160;four<br/>times.&#160;It&#160;is&#160;also&#160;possible&#160;to&#160;specify&#160;a&#160;range&#160;this&#160;way:&#160;{2,4}&#160;means&#160;the&#160;element<br/>must&#160;occur&#160;at&#160;least&#160;twice&#160;and&#160;at&#160;most&#160;four&#160;times.<br/>
Here&#160;is&#160;another&#160;version&#160;of&#160;the&#160;date&#160;and&#160;time&#160;pattern&#160;that&#160;allows&#160;both&#160;single-<br/>
and&#160;double-digit&#160;days,&#160;months,&#160;and&#160;hours.&#160;It&#160;is&#160;also&#160;slightly&#160;easier&#160;to&#160;decipher.<br/>
let&#160;dateTime&#160;=&#160;/\d{1,2}-\d{1,2}-\d{4}&#160;\d{1,2}:\d{2}/;<br/>console.log(dateTime.test(&#34;1-30-2003&#160;8:45&#34;));<br/>//&#160;→&#160;true<br/>
146<br/>
<hr/>
<a name=159></a>You&#160;can&#160;also&#160;specify&#160;open-ended&#160;ranges&#160;when&#160;using&#160;braces&#160;by&#160;omitting&#160;the<br/>
number&#160;after&#160;the&#160;comma.&#160;So,&#160;{5,}&#160;means&#160;five&#160;or&#160;more&#160;times.<br/>
<b>Grouping&#160;subexpressions</b><br/>
To&#160;use&#160;an&#160;operator&#160;like&#160;*&#160;or&#160;+&#160;on&#160;more&#160;than&#160;one&#160;element&#160;at&#160;a&#160;time,&#160;you&#160;have&#160;to<br/>use&#160;parentheses.&#160;A&#160;part&#160;of&#160;a&#160;regular&#160;expression&#160;that&#160;is&#160;enclosed&#160;in&#160;parentheses<br/>counts&#160;as&#160;a&#160;single&#160;element&#160;as&#160;far&#160;as&#160;the&#160;operators&#160;following&#160;it&#160;are&#160;concerned.<br/>
let&#160;cartoonCrying&#160;=&#160;/boo+(hoo+)+/i;<br/>console.log(cartoonCrying.test(&#34;Boohoooohoohooo&#34;));<br/>//&#160;→&#160;true<br/>
The&#160;first&#160;and&#160;second&#160;+&#160;characters&#160;apply&#160;only&#160;to&#160;the&#160;second&#160;<i>o&#160;</i>in&#160;<i>boo&#160;</i>and&#160;<i>hoo</i>,<br/>
respectively.&#160;The&#160;third&#160;+&#160;applies&#160;to&#160;the&#160;whole&#160;group&#160;(hoo+),&#160;matching&#160;one&#160;or<br/>more&#160;sequences&#160;like&#160;that.<br/>
The&#160;i&#160;at&#160;the&#160;end&#160;of&#160;the&#160;expression&#160;in&#160;the&#160;example&#160;makes&#160;this&#160;regular&#160;expres-<br/>
sion&#160;case&#160;insensitive,&#160;allowing&#160;it&#160;to&#160;match&#160;the&#160;uppercase&#160;<i>B&#160;</i>in&#160;the&#160;input&#160;string,<br/>even&#160;though&#160;the&#160;pattern&#160;is&#160;itself&#160;all&#160;lowercase.<br/>
<b>Matches&#160;and&#160;groups</b><br/>
The&#160;test&#160;method&#160;is&#160;the&#160;absolute&#160;simplest&#160;way&#160;to&#160;match&#160;a&#160;regular&#160;expression.<br/>It&#160;tells&#160;you&#160;only&#160;whether&#160;it&#160;matched&#160;and&#160;nothing&#160;else.&#160;Regular&#160;expressions&#160;also<br/>have&#160;an&#160;exec&#160;(execute)&#160;method&#160;that&#160;will&#160;return&#160;null&#160;if&#160;no&#160;match&#160;was&#160;found<br/>and&#160;return&#160;an&#160;object&#160;with&#160;information&#160;about&#160;the&#160;match&#160;otherwise.<br/>
let&#160;match&#160;=&#160;/\d+/.exec(&#34;one&#160;two&#160;100&#34;);<br/>console.log(match);<br/>//&#160;→&#160;[&#34;100&#34;]<br/>console.log(match.index);<br/>//&#160;→&#160;8<br/>
An&#160;object&#160;returned&#160;from&#160;exec&#160;has&#160;an&#160;index&#160;property&#160;that&#160;tells&#160;us&#160;<i>where&#160;</i>in<br/>
the&#160;string&#160;the&#160;successful&#160;match&#160;begins.&#160;Other&#160;than&#160;that,&#160;the&#160;object&#160;looks&#160;like<br/>(and&#160;in&#160;fact&#160;is)&#160;an&#160;array&#160;of&#160;strings,&#160;whose&#160;first&#160;element&#160;is&#160;the&#160;string&#160;that&#160;was<br/>matched.&#160;In&#160;the&#160;previous&#160;example,&#160;this&#160;is&#160;the&#160;sequence&#160;of&#160;digits&#160;that&#160;we&#160;were<br/>looking&#160;for.<br/>
String&#160;values&#160;have&#160;a&#160;match&#160;method&#160;that&#160;behaves&#160;similarly.<br/>
147<br/>
<hr/>
<a name=160></a>console.log(&#34;one&#160;two&#160;100&#34;.match(/\d+/));<br/>//&#160;→&#160;[&#34;100&#34;]<br/>
When&#160;the&#160;regular&#160;expression&#160;contains&#160;subexpressions&#160;grouped&#160;with&#160;paren-<br/>
theses,&#160;the&#160;text&#160;that&#160;matched&#160;those&#160;groups&#160;will&#160;also&#160;show&#160;up&#160;in&#160;the&#160;array.<br/>The&#160;whole&#160;match&#160;is&#160;always&#160;the&#160;first&#160;element.&#160;The&#160;next&#160;element&#160;is&#160;the&#160;part<br/>matched&#160;by&#160;the&#160;first&#160;group&#160;(the&#160;one&#160;whose&#160;opening&#160;parenthesis&#160;comes&#160;first&#160;in<br/>the&#160;expression),&#160;then&#160;the&#160;second&#160;group,&#160;and&#160;so&#160;on.<br/>
let&#160;quotedText&#160;=&#160;/'([^']*)'/;<br/>console.log(quotedText.exec(&#34;she&#160;said&#160;'hello'&#34;));<br/>//&#160;→&#160;[&#34;'hello'&#34;,&#160;&#34;hello&#34;]<br/>
When&#160;a&#160;group&#160;does&#160;not&#160;end&#160;up&#160;being&#160;matched&#160;at&#160;all&#160;(for&#160;example,&#160;when&#160;fol-<br/>
lowed&#160;by&#160;a&#160;question&#160;mark),&#160;its&#160;position&#160;in&#160;the&#160;output&#160;array&#160;will&#160;hold&#160;undefined.<br/>Similarly,&#160;when&#160;a&#160;group&#160;is&#160;matched&#160;multiple&#160;times,&#160;only&#160;the&#160;last&#160;match&#160;ends<br/>up&#160;in&#160;the&#160;array.<br/>
console.log(/bad(ly)?/.exec(&#34;bad&#34;));<br/>//&#160;→&#160;[&#34;bad&#34;,&#160;undefined]<br/>console.log(/(\d)+/.exec(&#34;123&#34;));<br/>//&#160;→&#160;[&#34;123&#34;,&#160;&#34;3&#34;]<br/>
Groups&#160;can&#160;be&#160;useful&#160;for&#160;extracting&#160;parts&#160;of&#160;a&#160;string.&#160;If&#160;we&#160;don’t&#160;just&#160;want<br/>
to&#160;verify&#160;whether&#160;a&#160;string&#160;contains&#160;a&#160;date&#160;but&#160;also&#160;extract&#160;it&#160;and&#160;construct&#160;an<br/>object&#160;that&#160;represents&#160;it,&#160;we&#160;can&#160;wrap&#160;parentheses&#160;around&#160;the&#160;digit&#160;patterns<br/>and&#160;directly&#160;pick&#160;the&#160;date&#160;out&#160;of&#160;the&#160;result&#160;of&#160;exec.<br/>
But&#160;first&#160;we’ll&#160;take&#160;a&#160;brief&#160;detour,&#160;in&#160;which&#160;we&#160;discuss&#160;the&#160;built-in&#160;way&#160;to<br/>
represent&#160;date&#160;and&#160;time&#160;values&#160;in&#160;JavaScript.<br/>
<b>The&#160;Date&#160;class</b><br/>
JavaScript&#160;has&#160;a&#160;standard&#160;class&#160;for&#160;representing&#160;dates—or,&#160;rather,&#160;points&#160;in<br/>time.&#160;It&#160;is&#160;called&#160;Date.&#160;If&#160;you&#160;simply&#160;create&#160;a&#160;date&#160;object&#160;using&#160;new,&#160;you&#160;get<br/>the&#160;current&#160;date&#160;and&#160;time.<br/>
console.log(new&#160;Date());<br/>//&#160;→&#160;Mon&#160;Nov&#160;13&#160;2017&#160;16:19:11&#160;GMT+0100&#160;(CET)<br/>
You&#160;can&#160;also&#160;create&#160;an&#160;object&#160;for&#160;a&#160;specific&#160;time.<br/>
148<br/>
<hr/>
<a name=161></a>console.log(new&#160;Date(2009,&#160;11,&#160;9));<br/>//&#160;→&#160;Wed&#160;Dec&#160;09&#160;2009&#160;00:00:00&#160;GMT+0100&#160;(CET)<br/>console.log(new&#160;Date(2009,&#160;11,&#160;9,&#160;12,&#160;59,&#160;59,&#160;999));<br/>//&#160;→&#160;Wed&#160;Dec&#160;09&#160;2009&#160;12:59:59&#160;GMT+0100&#160;(CET)<br/>
JavaScript&#160;uses&#160;a&#160;convention&#160;where&#160;month&#160;numbers&#160;start&#160;at&#160;zero&#160;(so&#160;De-<br/>
cember&#160;is&#160;11),&#160;yet&#160;day&#160;numbers&#160;start&#160;at&#160;one.&#160;This&#160;is&#160;confusing&#160;and&#160;silly.&#160;Be<br/>careful.<br/>
The&#160;last&#160;four&#160;arguments&#160;(hours,&#160;minutes,&#160;seconds,&#160;and&#160;milliseconds)&#160;are&#160;op-<br/>
tional&#160;and&#160;taken&#160;to&#160;be&#160;zero&#160;when&#160;not&#160;given.<br/>
Timestamps&#160;are&#160;stored&#160;as&#160;the&#160;number&#160;of&#160;milliseconds&#160;since&#160;the&#160;start&#160;of&#160;1970,<br/>
in&#160;the&#160;UTC&#160;time&#160;zone.&#160;This&#160;follows&#160;a&#160;convention&#160;set&#160;by&#160;“Unix&#160;time”,&#160;which<br/>was&#160;invented&#160;around&#160;that&#160;time.&#160;You&#160;can&#160;use&#160;negative&#160;numbers&#160;for&#160;times&#160;before<br/>1970.&#160;The&#160;getTime&#160;method&#160;on&#160;a&#160;date&#160;object&#160;returns&#160;this&#160;number.&#160;It&#160;is&#160;big,&#160;as<br/>you&#160;can&#160;imagine.<br/>
console.log(new&#160;Date(2013,&#160;11,&#160;19).getTime());<br/>//&#160;→&#160;1387407600000<br/>console.log(new&#160;Date(1387407600000));<br/>//&#160;→&#160;Thu&#160;Dec&#160;19&#160;2013&#160;00:00:00&#160;GMT+0100&#160;(CET)<br/>
If&#160;you&#160;give&#160;the&#160;Date&#160;constructor&#160;a&#160;single&#160;argument,&#160;that&#160;argument&#160;is&#160;treated<br/>
as&#160;such&#160;a&#160;millisecond&#160;count.&#160;You&#160;can&#160;get&#160;the&#160;current&#160;millisecond&#160;count&#160;by<br/>creating&#160;a&#160;new&#160;Date&#160;object&#160;and&#160;calling&#160;getTime&#160;on&#160;it&#160;or&#160;by&#160;calling&#160;the&#160;Date.now<br/>function.<br/>
Date&#160;objects&#160;provide&#160;methods&#160;such&#160;as&#160;getFullYear,&#160;getMonth,&#160;getDate,&#160;getHours<br/>
,&#160;getMinutes,&#160;and&#160;getSeconds&#160;to&#160;extract&#160;their&#160;components.&#160;Besides&#160;getFullYear<br/>
there’s&#160;also&#160;getYear,&#160;which&#160;gives&#160;you&#160;the&#160;year&#160;minus&#160;1900&#160;(98&#160;or&#160;119)&#160;and&#160;is<br/>
mostly&#160;useless.<br/>
Putting&#160;parentheses&#160;around&#160;the&#160;parts&#160;of&#160;the&#160;expression&#160;that&#160;we&#160;are&#160;interested<br/>
in,&#160;we&#160;can&#160;now&#160;create&#160;a&#160;date&#160;object&#160;from&#160;a&#160;string.<br/>
function&#160;getDate(string)&#160;{<br/>
let&#160;[_,&#160;month,&#160;day,&#160;year]&#160;=<br/>
/(\d{1,2})-(\d{1,2})-(\d{4})/.exec(string);<br/>
return&#160;new&#160;Date(year,&#160;month&#160;-&#160;1,&#160;day);<br/>
}<br/>console.log(getDate(&#34;1-30-2003&#34;));<br/>//&#160;→&#160;Thu&#160;Jan&#160;30&#160;2003&#160;00:00:00&#160;GMT+0100&#160;(CET)<br/>
149<br/>
<hr/>
<a name=162></a>The&#160;_&#160;(underscore)&#160;binding&#160;is&#160;ignored&#160;and&#160;used&#160;only&#160;to&#160;skip&#160;the&#160;full&#160;match<br/>
element&#160;in&#160;the&#160;array&#160;returned&#160;by&#160;exec.<br/>
<b>Word&#160;and&#160;string&#160;boundaries</b><br/>
Unfortunately,&#160;getDate&#160;will&#160;also&#160;happily&#160;extract&#160;the&#160;nonsensical&#160;date&#160;00-1-3000<br/>from&#160;the&#160;string&#160;&#34;100-1-30000&#34;.&#160;A&#160;match&#160;may&#160;happen&#160;anywhere&#160;in&#160;the&#160;string,&#160;so<br/>in&#160;this&#160;case,&#160;it’ll&#160;just&#160;start&#160;at&#160;the&#160;second&#160;character&#160;and&#160;end&#160;at&#160;the&#160;second-to-last<br/>character.<br/>
If&#160;we&#160;want&#160;to&#160;enforce&#160;that&#160;the&#160;match&#160;must&#160;span&#160;the&#160;whole&#160;string,&#160;we&#160;can&#160;add<br/>
the&#160;markers&#160;^&#160;and&#160;$.&#160;The&#160;caret&#160;matches&#160;the&#160;start&#160;of&#160;the&#160;input&#160;string,&#160;whereas<br/>the&#160;dollar&#160;sign&#160;matches&#160;the&#160;end.&#160;So,&#160;/^\d+$/&#160;matches&#160;a&#160;string&#160;consisting&#160;entirely<br/>of&#160;one&#160;or&#160;more&#160;digits,&#160;/^!/&#160;matches&#160;any&#160;string&#160;that&#160;starts&#160;with&#160;an&#160;exclamation<br/>mark,&#160;and&#160;/x^/&#160;does&#160;not&#160;match&#160;any&#160;string&#160;(there&#160;cannot&#160;be&#160;an&#160;<i>x&#160;</i>before&#160;the<br/>start&#160;of&#160;the&#160;string).<br/>
If,&#160;on&#160;the&#160;other&#160;hand,&#160;we&#160;just&#160;want&#160;to&#160;make&#160;sure&#160;the&#160;date&#160;starts&#160;and&#160;ends<br/>
on&#160;a&#160;word&#160;boundary,&#160;we&#160;can&#160;use&#160;the&#160;marker&#160;\b.&#160;A&#160;word&#160;boundary&#160;can&#160;be&#160;the<br/>start&#160;or&#160;end&#160;of&#160;the&#160;string&#160;or&#160;any&#160;point&#160;in&#160;the&#160;string&#160;that&#160;has&#160;a&#160;word&#160;character<br/>(as&#160;in&#160;\w)&#160;on&#160;one&#160;side&#160;and&#160;a&#160;nonword&#160;character&#160;on&#160;the&#160;other.<br/>
console.log(/cat/.test(&#34;concatenate&#34;));<br/>//&#160;→&#160;true<br/>console.log(/\bcat\b/.test(&#34;concatenate&#34;));<br/>//&#160;→&#160;false<br/>
Note&#160;that&#160;a&#160;boundary&#160;marker&#160;doesn’t&#160;match&#160;an&#160;actual&#160;character.&#160;It&#160;just<br/>
enforces&#160;that&#160;the&#160;regular&#160;expression&#160;matches&#160;only&#160;when&#160;a&#160;certain&#160;condition<br/>holds&#160;at&#160;the&#160;place&#160;where&#160;it&#160;appears&#160;in&#160;the&#160;pattern.<br/>
<b>Choice&#160;patterns</b><br/>
Say&#160;we&#160;want&#160;to&#160;know&#160;whether&#160;a&#160;piece&#160;of&#160;text&#160;contains&#160;not&#160;only&#160;a&#160;number&#160;but&#160;a<br/>number&#160;followed&#160;by&#160;one&#160;of&#160;the&#160;words&#160;<i>pig</i>,&#160;<i>cow</i>,&#160;or&#160;<i>chicken</i>,&#160;or&#160;any&#160;of&#160;their&#160;plural<br/>forms.<br/>
We&#160;could&#160;write&#160;three&#160;regular&#160;expressions&#160;and&#160;test&#160;them&#160;in&#160;turn,&#160;but&#160;there&#160;is<br/>
a&#160;nicer&#160;way.&#160;The&#160;pipe&#160;character&#160;(|)&#160;denotes&#160;a&#160;choice&#160;between&#160;the&#160;pattern&#160;to&#160;its<br/>left&#160;and&#160;the&#160;pattern&#160;to&#160;its&#160;right.&#160;So&#160;I&#160;can&#160;say&#160;this:<br/>
let&#160;animalCount&#160;=&#160;/\b\d+&#160;(pig|cow|chicken)s?\b/;<br/>console.log(animalCount.test(&#34;15&#160;pigs&#34;));<br/>
150<br/>
<hr/>
<a name=163></a>//&#160;→&#160;true<br/>console.log(animalCount.test(&#34;15&#160;pigchickens&#34;));<br/>//&#160;→&#160;false<br/>
Parentheses&#160;can&#160;be&#160;used&#160;to&#160;limit&#160;the&#160;part&#160;of&#160;the&#160;pattern&#160;that&#160;the&#160;pipe&#160;operator<br/>
applies&#160;to,&#160;and&#160;you&#160;can&#160;put&#160;multiple&#160;such&#160;operators&#160;next&#160;to&#160;each&#160;other&#160;to&#160;express<br/>a&#160;choice&#160;between&#160;more&#160;than&#160;two&#160;alternatives.<br/>
<b>The&#160;mechanics&#160;of&#160;matching</b><br/>
Conceptually,&#160;when&#160;you&#160;use&#160;exec&#160;or&#160;test,&#160;the&#160;regular&#160;expression&#160;engine&#160;looks<br/>for&#160;a&#160;match&#160;in&#160;your&#160;string&#160;by&#160;trying&#160;to&#160;match&#160;the&#160;expression&#160;first&#160;from&#160;the&#160;start<br/>of&#160;the&#160;string,&#160;then&#160;from&#160;the&#160;second&#160;character,&#160;and&#160;so&#160;on,&#160;until&#160;it&#160;finds&#160;a&#160;match<br/>or&#160;reaches&#160;the&#160;end&#160;of&#160;the&#160;string.&#160;It’ll&#160;either&#160;return&#160;the&#160;first&#160;match&#160;that&#160;can&#160;be<br/>found&#160;or&#160;fail&#160;to&#160;find&#160;any&#160;match&#160;at&#160;all.<br/>
To&#160;do&#160;the&#160;actual&#160;matching,&#160;the&#160;engine&#160;treats&#160;a&#160;regular&#160;expression&#160;something<br/>
like&#160;a&#160;flow&#160;diagram.&#160;This&#160;is&#160;the&#160;diagram&#160;for&#160;the&#160;livestock&#160;expression&#160;in&#160;the<br/>previous&#160;example:<br/>
Group #1<br/>
&#34;pig&#34;<br/>
boundary<br/>
digit<br/>
&#34; &#34;<br/>
&#34;cow&#34;<br/>
&#34;s&#34;<br/>
boundary<br/>
&#34;chicken&#34;<br/>
Our&#160;expression&#160;matches&#160;if&#160;we&#160;can&#160;find&#160;a&#160;path&#160;from&#160;the&#160;left&#160;side&#160;of&#160;the&#160;diagram<br/>
to&#160;the&#160;right&#160;side.&#160;We&#160;keep&#160;a&#160;current&#160;position&#160;in&#160;the&#160;string,&#160;and&#160;every&#160;time&#160;we<br/>move&#160;through&#160;a&#160;box,&#160;we&#160;verify&#160;that&#160;the&#160;part&#160;of&#160;the&#160;string&#160;after&#160;our&#160;current<br/>position&#160;matches&#160;that&#160;box.<br/>
So&#160;if&#160;we&#160;try&#160;to&#160;match&#160;&#34;the&#160;3&#160;pigs&#34;&#160;from&#160;position&#160;4,&#160;our&#160;progress&#160;through<br/>
the&#160;flow&#160;chart&#160;would&#160;look&#160;like&#160;this:<br/>
•&#160;At&#160;position&#160;4,&#160;there&#160;is&#160;a&#160;word&#160;boundary,&#160;so&#160;we&#160;can&#160;move&#160;past&#160;the&#160;first<br/>
box.<br/>
•&#160;Still&#160;at&#160;position&#160;4,&#160;we&#160;find&#160;a&#160;digit,&#160;so&#160;we&#160;can&#160;also&#160;move&#160;past&#160;the&#160;second<br/>
box.<br/>
•&#160;At&#160;position&#160;5,&#160;one&#160;path&#160;loops&#160;back&#160;to&#160;before&#160;the&#160;second&#160;(digit)&#160;box,<br/>
while&#160;the&#160;other&#160;moves&#160;forward&#160;through&#160;the&#160;box&#160;that&#160;holds&#160;a&#160;single&#160;space<br/>
151<br/>
<hr/>
<a name=164></a>character.&#160;There&#160;is&#160;a&#160;space&#160;here,&#160;not&#160;a&#160;digit,&#160;so&#160;we&#160;must&#160;take&#160;the&#160;second<br/>path.<br/>
•&#160;We&#160;are&#160;now&#160;at&#160;position&#160;6&#160;(the&#160;start&#160;of&#160;<i>pigs</i>)&#160;and&#160;at&#160;the&#160;three-way&#160;branch<br/>
in&#160;the&#160;diagram.&#160;We&#160;don’t&#160;see&#160;<i>cow&#160;</i>or&#160;<i>chicken&#160;</i>here,&#160;but&#160;we&#160;do&#160;see&#160;<i>pig</i>,&#160;so<br/>we&#160;take&#160;that&#160;branch.<br/>
•&#160;At&#160;position&#160;9,&#160;after&#160;the&#160;three-way&#160;branch,&#160;one&#160;path&#160;skips&#160;the&#160;<i>s&#160;</i>box&#160;and<br/>
goes&#160;straight&#160;to&#160;the&#160;final&#160;word&#160;boundary,&#160;while&#160;the&#160;other&#160;path&#160;matches&#160;an<br/><i>s</i>.&#160;There&#160;is&#160;an&#160;<i>s&#160;</i>character&#160;here,&#160;not&#160;a&#160;word&#160;boundary,&#160;so&#160;we&#160;go&#160;through<br/>the&#160;<i>s&#160;</i>box.<br/>
•&#160;We’re&#160;at&#160;position&#160;10&#160;(the&#160;end&#160;of&#160;the&#160;string)&#160;and&#160;can&#160;match&#160;only&#160;a&#160;word<br/>
boundary.&#160;The&#160;end&#160;of&#160;a&#160;string&#160;counts&#160;as&#160;a&#160;word&#160;boundary,&#160;so&#160;we&#160;go<br/>through&#160;the&#160;last&#160;box&#160;and&#160;have&#160;successfully&#160;matched&#160;this&#160;string.<br/>
<b>Backtracking</b><br/>
The&#160;regular&#160;expression&#160;/\b([01]+b|[\da-f]+h|\d+)\b/&#160;matches&#160;either&#160;a&#160;binary<br/>number&#160;followed&#160;by&#160;a&#160;<i>b</i>,&#160;a&#160;hexadecimal&#160;number&#160;(that&#160;is,&#160;base&#160;16,&#160;with&#160;the&#160;letters<br/><i>a&#160;</i>to&#160;<i>f&#160;</i>standing&#160;for&#160;the&#160;digits&#160;10&#160;to&#160;15)&#160;followed&#160;by&#160;an&#160;<i>h</i>,&#160;or&#160;a&#160;regular&#160;decimal<br/>number&#160;with&#160;no&#160;suffix&#160;character.&#160;This&#160;is&#160;the&#160;corresponding&#160;diagram:<br/>
group #1<br/>
One of:<br/>
“0”<br/>
“b”<br/>
“1”<br/>
One of:<br/>
word boundary<br/>
word boundary<br/>
digit<br/>
“h”<br/>
“a”&#160;-&#160;“f”<br/>
digit<br/>
When&#160;matching&#160;this&#160;expression,&#160;it&#160;will&#160;often&#160;happen&#160;that&#160;the&#160;top&#160;(binary)<br/>
branch&#160;is&#160;entered&#160;even&#160;though&#160;the&#160;input&#160;does&#160;not&#160;actually&#160;contain&#160;a&#160;binary<br/>number.&#160;When&#160;matching&#160;the&#160;string&#160;&#34;103&#34;,&#160;for&#160;example,&#160;it&#160;becomes&#160;clear&#160;only<br/>at&#160;the&#160;3&#160;that&#160;we&#160;are&#160;in&#160;the&#160;wrong&#160;branch.&#160;The&#160;string&#160;<i>does&#160;</i>match&#160;the&#160;expression,<br/>just&#160;not&#160;the&#160;branch&#160;we&#160;are&#160;currently&#160;in.<br/>
152<br/>
<hr/>
<a name=165></a>So&#160;the&#160;matcher&#160;<i>backtracks</i>.&#160;When&#160;entering&#160;a&#160;branch,&#160;it&#160;remembers&#160;its&#160;current<br/>
position&#160;(in&#160;this&#160;case,&#160;at&#160;the&#160;start&#160;of&#160;the&#160;string,&#160;just&#160;past&#160;the&#160;first&#160;boundary&#160;box<br/>in&#160;the&#160;diagram)&#160;so&#160;that&#160;it&#160;can&#160;go&#160;back&#160;and&#160;try&#160;another&#160;branch&#160;if&#160;the&#160;current&#160;one<br/>does&#160;not&#160;work&#160;out.&#160;For&#160;the&#160;string&#160;&#34;103&#34;,&#160;after&#160;encountering&#160;the&#160;3&#160;character,&#160;it<br/>will&#160;start&#160;trying&#160;the&#160;branch&#160;for&#160;hexadecimal&#160;numbers,&#160;which&#160;fails&#160;again&#160;because<br/>there&#160;is&#160;no&#160;<i>h&#160;</i>after&#160;the&#160;number.&#160;So&#160;it&#160;tries&#160;the&#160;decimal&#160;number&#160;branch.&#160;This<br/>one&#160;fits,&#160;and&#160;a&#160;match&#160;is&#160;reported&#160;after&#160;all.<br/>
The&#160;matcher&#160;stops&#160;as&#160;soon&#160;as&#160;it&#160;finds&#160;a&#160;full&#160;match.&#160;This&#160;means&#160;that&#160;if<br/>
multiple&#160;branches&#160;could&#160;potentially&#160;match&#160;a&#160;string,&#160;only&#160;the&#160;first&#160;one&#160;(ordered<br/>by&#160;where&#160;the&#160;branches&#160;appear&#160;in&#160;the&#160;regular&#160;expression)&#160;is&#160;used.<br/>
Backtracking&#160;also&#160;happens&#160;for&#160;repetition&#160;operators&#160;like&#160;+&#160;and&#160;*.&#160;If&#160;you<br/>
match&#160;/^.*x/&#160;against&#160;&#34;abcxe&#34;,&#160;the&#160;.*&#160;part&#160;will&#160;first&#160;try&#160;to&#160;consume&#160;the&#160;whole<br/>string.&#160;The&#160;engine&#160;will&#160;then&#160;realize&#160;that&#160;it&#160;needs&#160;an&#160;<i>x&#160;</i>to&#160;match&#160;the&#160;pattern.<br/>Since&#160;there&#160;is&#160;no&#160;<i>x&#160;</i>past&#160;the&#160;end&#160;of&#160;the&#160;string,&#160;the&#160;star&#160;operator&#160;tries&#160;to&#160;match<br/>one&#160;character&#160;less.&#160;But&#160;the&#160;matcher&#160;doesn’t&#160;find&#160;an&#160;<i>x&#160;</i>after&#160;abcx&#160;either,&#160;so&#160;it<br/>backtracks&#160;again,&#160;matching&#160;the&#160;star&#160;operator&#160;to&#160;just&#160;abc.&#160;<i>Now&#160;</i>it&#160;finds&#160;an&#160;<i>x<br/></i>where&#160;it&#160;needs&#160;it&#160;and&#160;reports&#160;a&#160;successful&#160;match&#160;from&#160;positions&#160;0&#160;to&#160;4.<br/>
It&#160;is&#160;possible&#160;to&#160;write&#160;regular&#160;expressions&#160;that&#160;will&#160;do&#160;a&#160;<i>lot&#160;</i>of&#160;backtracking.<br/>
This&#160;problem&#160;occurs&#160;when&#160;a&#160;pattern&#160;can&#160;match&#160;a&#160;piece&#160;of&#160;input&#160;in&#160;many&#160;dif-<br/>ferent&#160;ways.&#160;For&#160;example,&#160;if&#160;we&#160;get&#160;confused&#160;while&#160;writing&#160;a&#160;binary-number<br/>regular&#160;expression,&#160;we&#160;might&#160;accidentally&#160;write&#160;something&#160;like&#160;/([01]+)+b/.<br/>
Group #1<br/>
One of:<br/>
&#34;0&#34;<br/>
&#34;b&#34;<br/>
&#34;1&#34;<br/>
If&#160;that&#160;tries&#160;to&#160;match&#160;some&#160;long&#160;series&#160;of&#160;zeros&#160;and&#160;ones&#160;with&#160;no&#160;trailing&#160;<i>b</i><br/>
character,&#160;the&#160;matcher&#160;first&#160;goes&#160;through&#160;the&#160;inner&#160;loop&#160;until&#160;it&#160;runs&#160;out&#160;of<br/>digits.&#160;Then&#160;it&#160;notices&#160;there&#160;is&#160;no&#160;<i>b</i>,&#160;so&#160;it&#160;backtracks&#160;one&#160;position,&#160;goes&#160;through<br/>the&#160;outer&#160;loop&#160;once,&#160;and&#160;gives&#160;up&#160;again,&#160;trying&#160;to&#160;backtrack&#160;out&#160;of&#160;the&#160;inner<br/>loop&#160;once&#160;more.&#160;It&#160;will&#160;continue&#160;to&#160;try&#160;every&#160;possible&#160;route&#160;through&#160;these&#160;two<br/>loops.&#160;This&#160;means&#160;the&#160;amount&#160;of&#160;work&#160;<i>doubles&#160;</i>with&#160;each&#160;additional&#160;character.<br/>For&#160;even&#160;just&#160;a&#160;few&#160;dozen&#160;characters,&#160;the&#160;resulting&#160;match&#160;will&#160;take&#160;practically<br/>forever.<br/>
153<br/>
<hr/>
<a name=166></a><b>The&#160;replace&#160;method</b><br/>
String&#160;values&#160;have&#160;a&#160;replace&#160;method&#160;that&#160;can&#160;be&#160;used&#160;to&#160;replace&#160;part&#160;of&#160;the<br/>string&#160;with&#160;another&#160;string.<br/>
console.log(&#34;papa&#34;.replace(&#34;p&#34;,&#160;&#34;m&#34;));<br/>//&#160;→&#160;mapa<br/>
The&#160;first&#160;argument&#160;can&#160;also&#160;be&#160;a&#160;regular&#160;expression,&#160;in&#160;which&#160;case&#160;the&#160;first<br/>
match&#160;of&#160;the&#160;regular&#160;expression&#160;is&#160;replaced.&#160;When&#160;a&#160;g&#160;option&#160;(for&#160;<i>global</i>)&#160;is<br/>added&#160;to&#160;the&#160;regular&#160;expression,&#160;<i>all&#160;</i>matches&#160;in&#160;the&#160;string&#160;will&#160;be&#160;replaced,&#160;not<br/>just&#160;the&#160;first.<br/>
console.log(&#34;Borobudur&#34;.replace(/[ou]/,&#160;&#34;a&#34;));<br/>//&#160;→&#160;Barobudur<br/>console.log(&#34;Borobudur&#34;.replace(/[ou]/g,&#160;&#34;a&#34;));<br/>//&#160;→&#160;Barabadar<br/>
It&#160;would&#160;have&#160;been&#160;sensible&#160;if&#160;the&#160;choice&#160;between&#160;replacing&#160;one&#160;match&#160;or&#160;all<br/>
matches&#160;was&#160;made&#160;through&#160;an&#160;additional&#160;argument&#160;to&#160;replace&#160;or&#160;by&#160;providing<br/>a&#160;different&#160;method,&#160;replaceAll.&#160;But&#160;for&#160;some&#160;unfortunate&#160;reason,&#160;the&#160;choice<br/>relies&#160;on&#160;a&#160;property&#160;of&#160;the&#160;regular&#160;expression&#160;instead.<br/>
The&#160;real&#160;power&#160;of&#160;using&#160;regular&#160;expressions&#160;with&#160;replace&#160;comes&#160;from&#160;the&#160;fact<br/>
that&#160;we&#160;can&#160;refer&#160;to&#160;matched&#160;groups&#160;in&#160;the&#160;replacement&#160;string.&#160;For&#160;example,<br/>say&#160;we&#160;have&#160;a&#160;big&#160;string&#160;containing&#160;the&#160;names&#160;of&#160;people,&#160;one&#160;name&#160;per&#160;line,&#160;in<br/>the&#160;format&#160;Lastname,&#160;Firstname.&#160;If&#160;we&#160;want&#160;to&#160;swap&#160;these&#160;names&#160;and&#160;remove<br/>the&#160;comma&#160;to&#160;get&#160;a&#160;Firstname&#160;Lastname&#160;format,&#160;we&#160;can&#160;use&#160;the&#160;following&#160;code:<br/>
console.log(<br/>
&#34;Liskov,&#160;Barbara\nMcCarthy,&#160;John\nWadler,&#160;Philip&#34;<br/>
.replace(/(\w+),&#160;(\w+)/g,&#160;&#34;$2&#160;$1&#34;));<br/>
//&#160;→&#160;Barbara&#160;Liskov<br/>//<br/>
John&#160;McCarthy<br/>
//<br/>
Philip&#160;Wadler<br/>
The&#160;$1&#160;and&#160;$2&#160;in&#160;the&#160;replacement&#160;string&#160;refer&#160;to&#160;the&#160;parenthesized&#160;groups&#160;in<br/>
the&#160;pattern.&#160;$1&#160;is&#160;replaced&#160;by&#160;the&#160;text&#160;that&#160;matched&#160;against&#160;the&#160;first&#160;group,&#160;$2<br/>by&#160;the&#160;second,&#160;and&#160;so&#160;on,&#160;up&#160;to&#160;$9.&#160;The&#160;whole&#160;match&#160;can&#160;be&#160;referred&#160;to&#160;with<br/>$&amp;.<br/>
It&#160;is&#160;possible&#160;to&#160;pass&#160;a&#160;function—rather&#160;than&#160;a&#160;string—as&#160;the&#160;second&#160;argu-<br/>
ment&#160;to&#160;replace.&#160;For&#160;each&#160;replacement,&#160;the&#160;function&#160;will&#160;be&#160;called&#160;with&#160;the<br/>
154<br/>
<hr/>
<a name=167></a>matched&#160;groups&#160;(as&#160;well&#160;as&#160;the&#160;whole&#160;match)&#160;as&#160;arguments,&#160;and&#160;its&#160;return&#160;value<br/>will&#160;be&#160;inserted&#160;into&#160;the&#160;new&#160;string.<br/>
Here’s&#160;a&#160;small&#160;example:<br/>
let&#160;s&#160;=&#160;&#34;the&#160;cia&#160;and&#160;fbi&#34;;<br/>console.log(s.replace(/\b(fbi|cia)\b/g,<br/>
str&#160;=&gt;&#160;str.toUpperCase()));<br/>
//&#160;→&#160;the&#160;CIA&#160;and&#160;FBI<br/>
Here’s&#160;a&#160;more&#160;interesting&#160;one:<br/>
let&#160;stock&#160;=&#160;&#34;1&#160;lemon,&#160;2&#160;cabbages,&#160;and&#160;101&#160;eggs&#34;;<br/>function&#160;minusOne(match,&#160;amount,&#160;unit)&#160;{<br/>
amount&#160;=&#160;Number(amount)&#160;-&#160;1;<br/>if&#160;(amount&#160;==&#160;1)&#160;{&#160;//&#160;only&#160;one&#160;left,&#160;remove&#160;the&#160;'s'<br/>
unit&#160;=&#160;unit.slice(0,&#160;unit.length&#160;-&#160;1);<br/>
}&#160;else&#160;if&#160;(amount&#160;==&#160;0)&#160;{<br/>
amount&#160;=&#160;&#34;no&#34;;<br/>
}<br/>return&#160;amount&#160;+&#160;&#34;&#160;&#34;&#160;+&#160;unit;<br/>
}<br/>console.log(stock.replace(/(\d+)&#160;(\w+)/g,&#160;minusOne));<br/>//&#160;→&#160;no&#160;lemon,&#160;1&#160;cabbage,&#160;and&#160;100&#160;eggs<br/>
This&#160;takes&#160;a&#160;string,&#160;finds&#160;all&#160;occurrences&#160;of&#160;a&#160;number&#160;followed&#160;by&#160;an&#160;alphanu-<br/>
meric&#160;word,&#160;and&#160;returns&#160;a&#160;string&#160;wherein&#160;every&#160;such&#160;occurrence&#160;is&#160;decremented<br/>by&#160;one.<br/>
The&#160;(\d+)&#160;group&#160;ends&#160;up&#160;as&#160;the&#160;amount&#160;argument&#160;to&#160;the&#160;function,&#160;and&#160;the<br/>
(\w+)&#160;group&#160;gets&#160;bound&#160;to&#160;unit.&#160;The&#160;function&#160;converts&#160;amount&#160;to&#160;a&#160;number—<br/>which&#160;always&#160;works&#160;since&#160;it&#160;matched&#160;\d+—and&#160;makes&#160;some&#160;adjustments&#160;in&#160;case<br/>there&#160;is&#160;only&#160;one&#160;or&#160;zero&#160;left.<br/>
<b>Greed</b><br/>
It&#160;is&#160;possible&#160;to&#160;use&#160;replace&#160;to&#160;write&#160;a&#160;function&#160;that&#160;removes&#160;all&#160;comments<br/>from&#160;a&#160;piece&#160;of&#160;JavaScript&#160;code.&#160;Here&#160;is&#160;a&#160;first&#160;attempt:<br/>
function&#160;stripComments(code)&#160;{<br/>
return&#160;code.replace(/\/\/.*|\/\*[^]*\*\//g,&#160;&#34;&#34;);<br/>
}<br/>console.log(stripComments(&#34;1&#160;+&#160;/*&#160;2&#160;*/3&#34;));<br/>//&#160;→&#160;1&#160;+&#160;3<br/>
155<br/>
<hr/>
<a name=168></a>console.log(stripComments(&#34;x&#160;=&#160;10;//&#160;ten!&#34;));<br/>//&#160;→&#160;x&#160;=&#160;10;<br/>console.log(stripComments(&#34;1&#160;/*&#160;a&#160;*/+/*&#160;b&#160;*/&#160;1&#34;));<br/>//&#160;→&#160;1<br/>
1<br/>
The&#160;part&#160;before&#160;the&#160;<i>or&#160;</i>operator&#160;matches&#160;two&#160;slash&#160;characters&#160;followed&#160;by&#160;any<br/>
number&#160;of&#160;non-newline&#160;characters.&#160;The&#160;part&#160;for&#160;multiline&#160;comments&#160;is&#160;more<br/>involved.&#160;We&#160;use&#160;[^]&#160;(any&#160;character&#160;that&#160;is&#160;not&#160;in&#160;the&#160;empty&#160;set&#160;of&#160;characters)<br/>as&#160;a&#160;way&#160;to&#160;match&#160;any&#160;character.&#160;We&#160;cannot&#160;just&#160;use&#160;a&#160;period&#160;here&#160;because<br/>block&#160;comments&#160;can&#160;continue&#160;on&#160;a&#160;new&#160;line,&#160;and&#160;the&#160;period&#160;character&#160;does&#160;not<br/>match&#160;newline&#160;characters.<br/>
But&#160;the&#160;output&#160;for&#160;the&#160;last&#160;line&#160;appears&#160;to&#160;have&#160;gone&#160;wrong.&#160;Why?<br/>The&#160;[^]*&#160;part&#160;of&#160;the&#160;expression,&#160;as&#160;I&#160;described&#160;in&#160;the&#160;section&#160;on&#160;backtracking,<br/>
will&#160;first&#160;match&#160;as&#160;much&#160;as&#160;it&#160;can.&#160;If&#160;that&#160;causes&#160;the&#160;next&#160;part&#160;of&#160;the&#160;pattern&#160;to<br/>fail,&#160;the&#160;matcher&#160;moves&#160;back&#160;one&#160;character&#160;and&#160;tries&#160;again&#160;from&#160;there.&#160;In&#160;the<br/>example,&#160;the&#160;matcher&#160;first&#160;tries&#160;to&#160;match&#160;the&#160;whole&#160;rest&#160;of&#160;the&#160;string&#160;and&#160;then<br/>moves&#160;back&#160;from&#160;there.&#160;It&#160;will&#160;find&#160;an&#160;occurrence&#160;of&#160;*/&#160;after&#160;going&#160;back&#160;four<br/>characters&#160;and&#160;match&#160;that.&#160;This&#160;is&#160;not&#160;what&#160;we&#160;wanted—the&#160;intention&#160;was&#160;to<br/>match&#160;a&#160;single&#160;comment,&#160;not&#160;to&#160;go&#160;all&#160;the&#160;way&#160;to&#160;the&#160;end&#160;of&#160;the&#160;code&#160;and&#160;find<br/>the&#160;end&#160;of&#160;the&#160;last&#160;block&#160;comment.<br/>
Because&#160;of&#160;this&#160;behavior,&#160;we&#160;say&#160;the&#160;repetition&#160;operators&#160;(+,&#160;*,&#160;?,&#160;and&#160;{}<br/>
)&#160;are&#160;<i>greedy</i>,&#160;meaning&#160;they&#160;match&#160;as&#160;much&#160;as&#160;they&#160;can&#160;and&#160;backtrack&#160;from<br/>there.&#160;If&#160;you&#160;put&#160;a&#160;question&#160;mark&#160;after&#160;them&#160;(+?,&#160;*?,&#160;??,&#160;{}?),&#160;they&#160;become<br/>nongreedy&#160;and&#160;start&#160;by&#160;matching&#160;as&#160;little&#160;as&#160;possible,&#160;matching&#160;more&#160;only&#160;when<br/>the&#160;remaining&#160;pattern&#160;does&#160;not&#160;fit&#160;the&#160;smaller&#160;match.<br/>
And&#160;that&#160;is&#160;exactly&#160;what&#160;we&#160;want&#160;in&#160;this&#160;case.&#160;By&#160;having&#160;the&#160;star&#160;match<br/>
the&#160;smallest&#160;stretch&#160;of&#160;characters&#160;that&#160;brings&#160;us&#160;to&#160;a&#160;*/,&#160;we&#160;consume&#160;one&#160;block<br/>comment&#160;and&#160;nothing&#160;more.<br/>
function&#160;stripComments(code)&#160;{<br/>
return&#160;code.replace(/\/\/.*|\/\*[^]*?\*\//g,&#160;&#34;&#34;);<br/>
}<br/>console.log(stripComments(&#34;1&#160;/*&#160;a&#160;*/+/*&#160;b&#160;*/&#160;1&#34;));<br/>//&#160;→&#160;1&#160;+&#160;1<br/>
A&#160;lot&#160;of&#160;bugs&#160;in&#160;regular&#160;expression&#160;programs&#160;can&#160;be&#160;traced&#160;to&#160;unintentionally<br/>
using&#160;a&#160;greedy&#160;operator&#160;where&#160;a&#160;nongreedy&#160;one&#160;would&#160;work&#160;better.&#160;When&#160;using<br/>a&#160;repetition&#160;operator,&#160;consider&#160;the&#160;nongreedy&#160;variant&#160;first.<br/>
156<br/>
<hr/>
<a name=169></a><b>Dynamically&#160;creating&#160;RegExp&#160;objects</b><br/>
There&#160;are&#160;cases&#160;where&#160;you&#160;might&#160;not&#160;know&#160;the&#160;exact&#160;pattern&#160;you&#160;need&#160;to&#160;match<br/>against&#160;when&#160;you&#160;are&#160;writing&#160;your&#160;code.&#160;Say&#160;you&#160;want&#160;to&#160;look&#160;for&#160;the&#160;user’s<br/>name&#160;in&#160;a&#160;piece&#160;of&#160;text&#160;and&#160;enclose&#160;it&#160;in&#160;underscore&#160;characters&#160;to&#160;make&#160;it&#160;stand<br/>out.&#160;Since&#160;you&#160;will&#160;know&#160;the&#160;name&#160;only&#160;once&#160;the&#160;program&#160;is&#160;actually&#160;running,<br/>you&#160;can’t&#160;use&#160;the&#160;slash-based&#160;notation.<br/>
But&#160;you&#160;can&#160;build&#160;up&#160;a&#160;string&#160;and&#160;use&#160;the&#160;RegExp&#160;constructor&#160;on&#160;that.&#160;Here’s<br/>
an&#160;example:<br/>
let&#160;name&#160;=&#160;&#34;harry&#34;;<br/>let&#160;text&#160;=&#160;&#34;Harry&#160;is&#160;a&#160;suspicious&#160;character.&#34;;<br/>let&#160;regexp&#160;=&#160;new&#160;RegExp(&#34;\\b(&#34;&#160;+&#160;name&#160;+&#160;&#34;)\\b&#34;,&#160;&#34;gi&#34;);<br/>console.log(text.replace(regexp,&#160;&#34;_$1_&#34;));<br/>//&#160;→&#160;_Harry_&#160;is&#160;a&#160;suspicious&#160;character.<br/>
When&#160;creating&#160;the&#160;\b&#160;boundary&#160;markers,&#160;we&#160;have&#160;to&#160;use&#160;two&#160;backslashes<br/>
because&#160;we&#160;are&#160;writing&#160;them&#160;in&#160;a&#160;normal&#160;string,&#160;not&#160;a&#160;slash-enclosed&#160;regu-<br/>lar&#160;expression.&#160;The&#160;second&#160;argument&#160;to&#160;the&#160;RegExp&#160;constructor&#160;contains&#160;the<br/>options&#160;for&#160;the&#160;regular&#160;expression—in&#160;this&#160;case,&#160;&#34;gi&#34;&#160;for&#160;global&#160;and&#160;case&#160;insen-<br/>sitive.<br/>
But&#160;what&#160;if&#160;the&#160;name&#160;is&#160;&#34;dea+hl[]rd&#34;&#160;because&#160;our&#160;user&#160;is&#160;a&#160;nerdy&#160;teenager?<br/>
That&#160;would&#160;result&#160;in&#160;a&#160;nonsensical&#160;regular&#160;expression&#160;that&#160;won’t&#160;actually&#160;match<br/>the&#160;user’s&#160;name.<br/>
To&#160;work&#160;around&#160;this,&#160;we&#160;can&#160;add&#160;backslashes&#160;before&#160;any&#160;character&#160;that&#160;has<br/>
a&#160;special&#160;meaning.<br/>
let&#160;name&#160;=&#160;&#34;dea+hl[]rd&#34;;<br/>let&#160;text&#160;=&#160;&#34;This&#160;dea+hl[]rd&#160;guy&#160;is&#160;super&#160;annoying.&#34;;<br/>let&#160;escaped&#160;=&#160;name.replace(/[\\[.+*?(){|^$]/g,&#160;&#34;\\$&amp;&#34;);<br/>let&#160;regexp&#160;=&#160;new&#160;RegExp(&#34;\\b&#34;&#160;+&#160;escaped&#160;+&#160;&#34;\\b&#34;,&#160;&#34;gi&#34;);<br/>console.log(text.replace(regexp,&#160;&#34;_$&amp;_&#34;));<br/>//&#160;→&#160;This&#160;_dea+hl[]rd_&#160;guy&#160;is&#160;super&#160;annoying.<br/>
<b>The&#160;search&#160;method</b><br/>
The&#160;indexOf&#160;method&#160;on&#160;strings&#160;cannot&#160;be&#160;called&#160;with&#160;a&#160;regular&#160;expression.&#160;But<br/>there&#160;is&#160;another&#160;method,&#160;search,&#160;that&#160;does&#160;expect&#160;a&#160;regular&#160;expression.&#160;Like<br/>indexOf,&#160;it&#160;returns&#160;the&#160;first&#160;index&#160;on&#160;which&#160;the&#160;expression&#160;was&#160;found,&#160;or&#160;-1<br/>when&#160;it&#160;wasn’t&#160;found.<br/>
157<br/>
<hr/>
<a name=170></a>console.log(&#34;<br/>
word&#34;.search(/\S/));<br/>
//&#160;→&#160;2<br/>console.log(&#34;<br/>
&#34;.search(/\S/));<br/>
//&#160;→&#160;-1<br/>
Unfortunately,&#160;there&#160;is&#160;no&#160;way&#160;to&#160;indicate&#160;that&#160;the&#160;match&#160;should&#160;start&#160;at&#160;a<br/>
given&#160;offset&#160;(like&#160;we&#160;can&#160;with&#160;the&#160;second&#160;argument&#160;to&#160;indexOf),&#160;which&#160;would<br/>often&#160;be&#160;useful.<br/>
<b>The&#160;lastIndex&#160;property</b><br/>
The&#160;exec&#160;method&#160;similarly&#160;does&#160;not&#160;provide&#160;a&#160;convenient&#160;way&#160;to&#160;start&#160;searching<br/>from&#160;a&#160;given&#160;position&#160;in&#160;the&#160;string.&#160;But&#160;it&#160;does&#160;provide&#160;an&#160;<i>in</i>convenient&#160;way.<br/>
Regular&#160;expression&#160;objects&#160;have&#160;properties.&#160;One&#160;such&#160;property&#160;is&#160;source,<br/>
which&#160;contains&#160;the&#160;string&#160;that&#160;expression&#160;was&#160;created&#160;from.&#160;Another&#160;property<br/>is&#160;lastIndex,&#160;which&#160;controls,&#160;in&#160;some&#160;limited&#160;circumstances,&#160;where&#160;the&#160;next<br/>match&#160;will&#160;start.<br/>
Those&#160;circumstances&#160;are&#160;that&#160;the&#160;regular&#160;expression&#160;must&#160;have&#160;the&#160;global<br/>
(g)&#160;or&#160;sticky&#160;(y)&#160;option&#160;enabled,&#160;and&#160;the&#160;match&#160;must&#160;happen&#160;through&#160;the&#160;exec<br/>method.&#160;Again,&#160;a&#160;less&#160;confusing&#160;solution&#160;would&#160;have&#160;been&#160;to&#160;just&#160;allow&#160;an<br/>extra&#160;argument&#160;to&#160;be&#160;passed&#160;to&#160;exec,&#160;but&#160;confusion&#160;is&#160;an&#160;essential&#160;feature&#160;of<br/>JavaScript’s&#160;regular&#160;expression&#160;interface.<br/>
let&#160;pattern&#160;=&#160;/y/g;<br/>pattern.lastIndex&#160;=&#160;3;<br/>let&#160;match&#160;=&#160;pattern.exec(&#34;xyzzy&#34;);<br/>console.log(match.index);<br/>//&#160;→&#160;4<br/>console.log(pattern.lastIndex);<br/>//&#160;→&#160;5<br/>
If&#160;the&#160;match&#160;was&#160;successful,&#160;the&#160;call&#160;to&#160;exec&#160;automatically&#160;updates&#160;the<br/>
lastIndex&#160;property&#160;to&#160;point&#160;after&#160;the&#160;match.&#160;If&#160;no&#160;match&#160;was&#160;found,&#160;lastIndex<br/>is&#160;set&#160;back&#160;to&#160;zero,&#160;which&#160;is&#160;also&#160;the&#160;value&#160;it&#160;has&#160;in&#160;a&#160;newly&#160;constructed&#160;regular<br/>expression&#160;object.<br/>
The&#160;difference&#160;between&#160;the&#160;global&#160;and&#160;the&#160;sticky&#160;options&#160;is&#160;that,&#160;when&#160;sticky<br/>
is&#160;enabled,&#160;the&#160;match&#160;will&#160;succeed&#160;only&#160;if&#160;it&#160;starts&#160;directly&#160;at&#160;lastIndex,&#160;whereas<br/>with&#160;global,&#160;it&#160;will&#160;search&#160;ahead&#160;for&#160;a&#160;position&#160;where&#160;a&#160;match&#160;can&#160;start.<br/>
let&#160;global&#160;=&#160;/abc/g;<br/>console.log(global.exec(&#34;xyz&#160;abc&#34;));<br/>
158<br/>
<hr/>
<a name=171></a>//&#160;→&#160;[&#34;abc&#34;]<br/>let&#160;sticky&#160;=&#160;/abc/y;<br/>console.log(sticky.exec(&#34;xyz&#160;abc&#34;));<br/>//&#160;→&#160;null<br/>
When&#160;using&#160;a&#160;shared&#160;regular&#160;expression&#160;value&#160;for&#160;multiple&#160;exec&#160;calls,&#160;these<br/>
automatic&#160;updates&#160;to&#160;the&#160;lastIndex&#160;property&#160;can&#160;cause&#160;problems.&#160;Your&#160;regular<br/>expression&#160;might&#160;be&#160;accidentally&#160;starting&#160;at&#160;an&#160;index&#160;that&#160;was&#160;left&#160;over&#160;from&#160;a<br/>previous&#160;call.<br/>
let&#160;digit&#160;=&#160;/\d/g;<br/>console.log(digit.exec(&#34;here&#160;it&#160;is:&#160;1&#34;));<br/>//&#160;→&#160;[&#34;1&#34;]<br/>console.log(digit.exec(&#34;and&#160;now:&#160;1&#34;));<br/>//&#160;→&#160;null<br/>
Another&#160;interesting&#160;effect&#160;of&#160;the&#160;global&#160;option&#160;is&#160;that&#160;it&#160;changes&#160;the&#160;way<br/>
the&#160;match&#160;method&#160;on&#160;strings&#160;works.&#160;When&#160;called&#160;with&#160;a&#160;global&#160;expression,<br/>instead&#160;of&#160;returning&#160;an&#160;array&#160;similar&#160;to&#160;that&#160;returned&#160;by&#160;exec,&#160;match&#160;will&#160;find<br/><i>all&#160;</i>matches&#160;of&#160;the&#160;pattern&#160;in&#160;the&#160;string&#160;and&#160;return&#160;an&#160;array&#160;containing&#160;the<br/>matched&#160;strings.<br/>
console.log(&#34;Banana&#34;.match(/an/g));<br/>//&#160;→&#160;[&#34;an&#34;,&#160;&#34;an&#34;]<br/>
So&#160;be&#160;cautious&#160;with&#160;global&#160;regular&#160;expressions.&#160;The&#160;cases&#160;where&#160;they&#160;are<br/>
necessary—calls&#160;to&#160;replace&#160;and&#160;places&#160;where&#160;you&#160;want&#160;to&#160;explicitly&#160;use&#160;lastIndex<br/>—are&#160;typically&#160;the&#160;only&#160;places&#160;where&#160;you&#160;want&#160;to&#160;use&#160;them.<br/>
<b>Looping&#160;over&#160;matches</b><br/>
A&#160;common&#160;thing&#160;to&#160;do&#160;is&#160;to&#160;scan&#160;through&#160;all&#160;occurrences&#160;of&#160;a&#160;pattern&#160;in&#160;a<br/>string,&#160;in&#160;a&#160;way&#160;that&#160;gives&#160;us&#160;access&#160;to&#160;the&#160;match&#160;object&#160;in&#160;the&#160;loop&#160;body.&#160;We<br/>can&#160;do&#160;this&#160;by&#160;using&#160;lastIndex&#160;and&#160;exec.<br/>
let&#160;input&#160;=&#160;&#34;A&#160;string&#160;with&#160;3&#160;numbers&#160;in&#160;it...&#160;42&#160;and&#160;88.&#34;;<br/>let&#160;number&#160;=&#160;/\b\d+\b/g;<br/>let&#160;match;<br/>while&#160;(match&#160;=&#160;number.exec(input))&#160;{<br/>
console.log(&#34;Found&#34;,&#160;match[0],&#160;&#34;at&#34;,&#160;match.index);<br/>
}<br/>//&#160;→&#160;Found&#160;3&#160;at&#160;14<br/>
159<br/>
<hr/>
<a name=172></a>//<br/>
Found&#160;42&#160;at&#160;33<br/>
//<br/>
Found&#160;88&#160;at&#160;40<br/>
This&#160;makes&#160;use&#160;of&#160;the&#160;fact&#160;that&#160;the&#160;value&#160;of&#160;an&#160;assignment&#160;expression&#160;(=)&#160;is<br/>
the&#160;assigned&#160;value.&#160;So&#160;by&#160;using&#160;match&#160;=&#160;number.exec(input)&#160;as&#160;the&#160;condition<br/>in&#160;the&#160;while&#160;statement,&#160;we&#160;perform&#160;the&#160;match&#160;at&#160;the&#160;start&#160;of&#160;each&#160;iteration,<br/>save&#160;its&#160;result&#160;in&#160;a&#160;binding,&#160;and&#160;stop&#160;looping&#160;when&#160;no&#160;more&#160;matches&#160;are&#160;found.<br/>
<b>Parsing&#160;an&#160;INI&#160;file</b><br/>
To&#160;conclude&#160;the&#160;chapter,&#160;we’ll&#160;look&#160;at&#160;a&#160;problem&#160;that&#160;calls&#160;for&#160;regular&#160;expres-<br/>sions.&#160;Imagine&#160;we&#160;are&#160;writing&#160;a&#160;program&#160;to&#160;automatically&#160;collect&#160;information<br/>about&#160;our&#160;enemies&#160;from&#160;the&#160;Internet.&#160;(We&#160;will&#160;not&#160;actually&#160;write&#160;that&#160;program<br/>here,&#160;just&#160;the&#160;part&#160;that&#160;reads&#160;the&#160;configuration&#160;file.&#160;Sorry.)&#160;The&#160;configuration<br/>file&#160;looks&#160;like&#160;this:<br/>
searchengine=https://duckduckgo.com/?q=$1<br/>spitefulness=9.7<br/>
;&#160;comments&#160;are&#160;preceded&#160;by&#160;a&#160;semicolon...<br/>;&#160;each&#160;section&#160;concerns&#160;an&#160;individual&#160;enemy<br/>[larry]<br/>fullname=Larry&#160;Doe<br/>type=kindergarten&#160;bully<br/>website=http://www.geocities.com/CapeCanaveral/11451<br/>
[davaeorn]<br/>fullname=Davaeorn<br/>type=evil&#160;wizard<br/>outputdir=/home/marijn/enemies/davaeorn<br/>
The&#160;exact&#160;rules&#160;for&#160;this&#160;format&#160;(which&#160;is&#160;a&#160;widely&#160;used&#160;format,&#160;usually&#160;called<br/>
an&#160;<i>INI&#160;</i>file)&#160;are&#160;as&#160;follows:<br/>
•&#160;Blank&#160;lines&#160;and&#160;lines&#160;starting&#160;with&#160;semicolons&#160;are&#160;ignored.<br/>
•&#160;Lines&#160;wrapped&#160;in&#160;[&#160;and&#160;]&#160;start&#160;a&#160;new&#160;section.<br/>
•&#160;Lines&#160;containing&#160;an&#160;alphanumeric&#160;identifier&#160;followed&#160;by&#160;an&#160;=&#160;character<br/>
add&#160;a&#160;setting&#160;to&#160;the&#160;current&#160;section.<br/>
•&#160;Anything&#160;else&#160;is&#160;invalid.<br/>
160<br/>
<hr/>
<a name=173></a>Our&#160;task&#160;is&#160;to&#160;convert&#160;a&#160;string&#160;like&#160;this&#160;into&#160;an&#160;object&#160;whose&#160;properties&#160;hold<br/>
strings&#160;for&#160;settings&#160;written&#160;before&#160;the&#160;first&#160;section&#160;header&#160;and&#160;subobjects&#160;for<br/>sections,&#160;with&#160;those&#160;subobjects&#160;holding&#160;the&#160;section’s&#160;settings.<br/>
Since&#160;the&#160;format&#160;has&#160;to&#160;be&#160;processed&#160;line&#160;by&#160;line,&#160;splitting&#160;up&#160;the&#160;file&#160;into<br/>
separate&#160;lines&#160;is&#160;a&#160;good&#160;start.&#160;We&#160;saw&#160;the&#160;split&#160;method&#160;in&#160;<a href="eloquent-javascripts.html#85">Chapter&#160;4.&#160;</a>Some<br/>operating&#160;systems,&#160;however,&#160;use&#160;not&#160;just&#160;a&#160;newline&#160;character&#160;to&#160;separate&#160;lines<br/>but&#160;a&#160;carriage&#160;return&#160;character&#160;followed&#160;by&#160;a&#160;newline&#160;(&#34;\r\n&#34;).&#160;Given&#160;that<br/>the&#160;split&#160;method&#160;also&#160;allows&#160;a&#160;regular&#160;expression&#160;as&#160;its&#160;argument,&#160;we&#160;can&#160;use<br/>a&#160;regular&#160;expression&#160;like&#160;/\r?\n/&#160;to&#160;split&#160;in&#160;a&#160;way&#160;that&#160;allows&#160;both&#160;&#34;\n&#34;&#160;and<br/>&#34;\r\n&#34;&#160;between&#160;lines.<br/>
function&#160;parseINI(string)&#160;{<br/>
//&#160;Start&#160;with&#160;an&#160;object&#160;to&#160;hold&#160;the&#160;top-level&#160;fields<br/>let&#160;result&#160;=&#160;{};<br/>let&#160;section&#160;=&#160;result;<br/>string.split(/\r?\n/).forEach(line&#160;=&gt;&#160;{<br/>
let&#160;match;<br/>if&#160;(match&#160;=&#160;line.match(/^(\w+)=(.*)$/))&#160;{<br/>
section[match[1]]&#160;=&#160;match[2];<br/>
}&#160;else&#160;if&#160;(match&#160;=&#160;line.match(/^\[(.*)\]$/))&#160;{<br/>
section&#160;=&#160;result[match[1]]&#160;=&#160;{};<br/>
}&#160;else&#160;if&#160;(!/^\s*(;.*)?$/.test(line))&#160;{<br/>
throw&#160;new&#160;Error(&#34;Line&#160;'&#34;&#160;+&#160;line&#160;+&#160;&#34;'&#160;is&#160;not&#160;valid.&#34;);<br/>
}<br/>
});<br/>return&#160;result;<br/>
}<br/>
console.log(parseINI(`<br/>name=Vasilis<br/>[address]<br/>city=Tessaloniki`));<br/>//&#160;→&#160;{name:&#160;&#34;Vasilis&#34;,&#160;address:&#160;{city:&#160;&#34;Tessaloniki&#34;}}<br/>
The&#160;code&#160;goes&#160;over&#160;the&#160;file’s&#160;lines&#160;and&#160;builds&#160;up&#160;an&#160;object.&#160;Properties&#160;at&#160;the<br/>
top&#160;are&#160;stored&#160;directly&#160;into&#160;that&#160;object,&#160;whereas&#160;properties&#160;found&#160;in&#160;sections&#160;are<br/>stored&#160;in&#160;a&#160;separate&#160;section&#160;object.&#160;The&#160;section&#160;binding&#160;points&#160;at&#160;the&#160;object<br/>for&#160;the&#160;current&#160;section.<br/>
There&#160;are&#160;two&#160;kinds&#160;of&#160;significant&#160;lines—section&#160;headers&#160;or&#160;property&#160;lines.<br/>
When&#160;a&#160;line&#160;is&#160;a&#160;regular&#160;property,&#160;it&#160;is&#160;stored&#160;in&#160;the&#160;current&#160;section.&#160;When&#160;it<br/>is&#160;a&#160;section&#160;header,&#160;a&#160;new&#160;section&#160;object&#160;is&#160;created,&#160;and&#160;section&#160;is&#160;set&#160;to&#160;point<br/>at&#160;it.<br/>
161<br/>
<hr/>
<a name=174></a>Note&#160;the&#160;recurring&#160;use&#160;of&#160;^&#160;and&#160;$&#160;to&#160;make&#160;sure&#160;the&#160;expression&#160;matches&#160;the<br/>
whole&#160;line,&#160;not&#160;just&#160;part&#160;of&#160;it.&#160;Leaving&#160;these&#160;out&#160;results&#160;in&#160;code&#160;that&#160;mostly<br/>works&#160;but&#160;behaves&#160;strangely&#160;for&#160;some&#160;input,&#160;which&#160;can&#160;be&#160;a&#160;difficult&#160;bug&#160;to<br/>track&#160;down.<br/>
The&#160;pattern&#160;if&#160;(match&#160;=&#160;string.match(...))&#160;is&#160;similar&#160;to&#160;the&#160;trick&#160;of&#160;using<br/>
an&#160;assignment&#160;as&#160;the&#160;condition&#160;for&#160;while.&#160;You&#160;often&#160;aren’t&#160;sure&#160;that&#160;your&#160;call<br/>to&#160;match&#160;will&#160;succeed,&#160;so&#160;you&#160;can&#160;access&#160;the&#160;resulting&#160;object&#160;only&#160;inside&#160;an<br/>if&#160;statement&#160;that&#160;tests&#160;for&#160;this.&#160;To&#160;not&#160;break&#160;the&#160;pleasant&#160;chain&#160;of&#160;else&#160;if<br/>forms,&#160;we&#160;assign&#160;the&#160;result&#160;of&#160;the&#160;match&#160;to&#160;a&#160;binding&#160;and&#160;immediately&#160;use&#160;that<br/>assignment&#160;as&#160;the&#160;test&#160;for&#160;the&#160;if&#160;statement.<br/>
If&#160;a&#160;line&#160;is&#160;not&#160;a&#160;section&#160;header&#160;or&#160;a&#160;property,&#160;the&#160;function&#160;checks&#160;whether&#160;it<br/>
is&#160;a&#160;comment&#160;or&#160;an&#160;empty&#160;line&#160;using&#160;the&#160;expression&#160;/^\s*(;.*)?$/.&#160;Do&#160;you&#160;see<br/>how&#160;it&#160;works?&#160;The&#160;part&#160;between&#160;the&#160;parentheses&#160;will&#160;match&#160;comments,&#160;and<br/>the&#160;?&#160;makes&#160;sure&#160;it&#160;also&#160;matches&#160;lines&#160;containing&#160;only&#160;whitespace.&#160;When&#160;a&#160;line<br/>doesn’t&#160;match&#160;any&#160;of&#160;the&#160;expected&#160;forms,&#160;the&#160;function&#160;throws&#160;an&#160;exception.<br/>
<b>International&#160;characters</b><br/>
Because&#160;of&#160;JavaScript’s&#160;initial&#160;simplistic&#160;implementation&#160;and&#160;the&#160;fact&#160;that&#160;this<br/>simplistic&#160;approach&#160;was&#160;later&#160;set&#160;in&#160;stone&#160;as&#160;standard&#160;behavior,&#160;JavaScript’s<br/>regular&#160;expressions&#160;are&#160;rather&#160;dumb&#160;about&#160;characters&#160;that&#160;do&#160;not&#160;appear&#160;in<br/>the&#160;English&#160;language.&#160;For&#160;example,&#160;as&#160;far&#160;as&#160;JavaScript’s&#160;regular&#160;expressions<br/>are&#160;concerned,&#160;a&#160;“word&#160;character”&#160;is&#160;only&#160;one&#160;of&#160;the&#160;26&#160;characters&#160;in&#160;the&#160;Latin<br/>alphabet&#160;(uppercase&#160;or&#160;lowercase),&#160;decimal&#160;digits,&#160;and,&#160;for&#160;some&#160;reason,&#160;the<br/>underscore&#160;character.&#160;Things&#160;like&#160;<i>é&#160;</i>or&#160;<i>ß</i>,&#160;which&#160;most&#160;definitely&#160;are&#160;word&#160;char-<br/>acters,&#160;will&#160;not&#160;match&#160;\w&#160;(and&#160;<i>will&#160;</i>match&#160;uppercase&#160;\W,&#160;the&#160;nonword&#160;category).<br/>
By&#160;a&#160;strange&#160;historical&#160;accident,&#160;\s&#160;(whitespace)&#160;does&#160;not&#160;have&#160;this&#160;problem<br/>
and&#160;matches&#160;all&#160;characters&#160;that&#160;the&#160;Unicode&#160;standard&#160;considers&#160;whitespace,<br/>including&#160;things&#160;like&#160;the&#160;nonbreaking&#160;space&#160;and&#160;the&#160;Mongolian&#160;vowel&#160;separator.<br/>
Another&#160;problem&#160;is&#160;that,&#160;by&#160;default,&#160;regular&#160;expressions&#160;work&#160;on&#160;code&#160;units,<br/>
as&#160;discussed&#160;in&#160;<a href="eloquent-javascripts.html#104">Chapter&#160;5,&#160;</a>not&#160;actual&#160;characters.&#160;This&#160;means&#160;characters&#160;that<br/>are&#160;composed&#160;of&#160;two&#160;code&#160;units&#160;behave&#160;strangely.<br/>
console.log(/🍎{3}/.test(&#34;🍎🍎🍎&#34;));<br/>//&#160;→&#160;false<br/>
console.log(/&lt;.&gt;/.test(&#34;&lt;🌹&gt;&#34;));<br/>//&#160;→&#160;false<br/>
console.log(/&lt;.&gt;/u.test(&#34;&lt;🌹&gt;&#34;));<br/>//&#160;→&#160;true<br/>
162<br/>
<hr/>
<a name=175></a>The&#160;problem&#160;is&#160;that&#160;the&#160;🍎&#160;in&#160;the&#160;first&#160;line&#160;is&#160;treated&#160;as&#160;two&#160;code&#160;units,&#160;and<br/>
the&#160;{3}&#160;part&#160;is&#160;applied&#160;only&#160;to&#160;the&#160;second&#160;one.&#160;Similarly,&#160;the&#160;dot&#160;matches&#160;a<br/>single&#160;code&#160;unit,&#160;not&#160;the&#160;two&#160;that&#160;make&#160;up&#160;the&#160;rose&#160;emoji.<br/>
You&#160;must&#160;add&#160;a&#160;u&#160;option&#160;(for&#160;Unicode)&#160;to&#160;your&#160;regular&#160;expression&#160;to&#160;make<br/>
it&#160;treat&#160;such&#160;characters&#160;properly.&#160;The&#160;wrong&#160;behavior&#160;remains&#160;the&#160;default,<br/>unfortunately,&#160;because&#160;changing&#160;that&#160;might&#160;cause&#160;problems&#160;for&#160;existing&#160;code<br/>that&#160;depends&#160;on&#160;it.<br/>
Though&#160;this&#160;was&#160;only&#160;just&#160;standardized&#160;and&#160;is,&#160;at&#160;the&#160;time&#160;of&#160;writing,&#160;not<br/>
widely&#160;supported&#160;yet,&#160;it&#160;is&#160;possible&#160;to&#160;use&#160;\p&#160;in&#160;a&#160;regular&#160;expression&#160;(that&#160;must<br/>have&#160;the&#160;Unicode&#160;option&#160;enabled)&#160;to&#160;match&#160;all&#160;characters&#160;to&#160;which&#160;the&#160;Unicode<br/>standard&#160;assigns&#160;a&#160;given&#160;property.<br/>
console.log(/\p{Script=Greek}/u.test(&#34;α&#34;));<br/>//&#160;→&#160;true<br/>console.log(/\p{Script=Arabic}/u.test(&#34;α&#34;));<br/>//&#160;→&#160;false<br/>console.log(/\p{Alphabetic}/u.test(&#34;α&#34;));<br/>//&#160;→&#160;true<br/>console.log(/\p{Alphabetic}/u.test(&#34;!&#34;));<br/>//&#160;→&#160;false<br/>
Unicode&#160;defines&#160;a&#160;number&#160;of&#160;useful&#160;properties,&#160;though&#160;finding&#160;the&#160;one&#160;that<br/>
you&#160;need&#160;may&#160;not&#160;always&#160;be&#160;trivial.&#160;You&#160;can&#160;use&#160;the&#160;\p{Property=Value}<br/>notation&#160;to&#160;match&#160;any&#160;character&#160;that&#160;has&#160;the&#160;given&#160;value&#160;for&#160;that&#160;property.&#160;If<br/>the&#160;property&#160;name&#160;is&#160;left&#160;off,&#160;as&#160;in&#160;\p{Name},&#160;the&#160;name&#160;is&#160;assumed&#160;to&#160;be&#160;either<br/>a&#160;binary&#160;property&#160;such&#160;as&#160;Alphabetic&#160;or&#160;a&#160;category&#160;such&#160;as&#160;Number.<br/>
<b>Summary</b><br/>
Regular&#160;expressions&#160;are&#160;objects&#160;that&#160;represent&#160;patterns&#160;in&#160;strings.&#160;They&#160;use<br/>their&#160;own&#160;language&#160;to&#160;express&#160;these&#160;patterns.<br/>
163<br/>
<hr/>
<a name=176></a>/abc/<br/>
A&#160;sequence&#160;of&#160;characters<br/>
/[abc]/<br/>
Any&#160;character&#160;from&#160;a&#160;set&#160;of&#160;characters<br/>
/[^abc]/<br/>
Any&#160;character&#160;<i>not&#160;</i>in&#160;a&#160;set&#160;of&#160;characters<br/>
/[0-9]/<br/>
Any&#160;character&#160;in&#160;a&#160;range&#160;of&#160;characters<br/>
/x+/<br/>
One&#160;or&#160;more&#160;occurrences&#160;of&#160;the&#160;pattern&#160;x<br/>
/x+?/<br/>
One&#160;or&#160;more&#160;occurrences,&#160;nongreedy<br/>
/x*/<br/>
Zero&#160;or&#160;more&#160;occurrences<br/>
/x?/<br/>
Zero&#160;or&#160;one&#160;occurrence<br/>
/x{2,4}/<br/>
Two&#160;to&#160;four&#160;occurrences<br/>
/(abc)/<br/>
A&#160;group<br/>
/a|b|c/<br/>
Any&#160;one&#160;of&#160;several&#160;patterns<br/>
/\d/<br/>
Any&#160;digit&#160;character<br/>
/\w/<br/>
An&#160;alphanumeric&#160;character&#160;(“word&#160;character”)<br/>
/\s/<br/>
Any&#160;whitespace&#160;character<br/>
/./<br/>
Any&#160;character&#160;except&#160;newlines<br/>
/\b/<br/>
A&#160;word&#160;boundary<br/>
/^/<br/>
Start&#160;of&#160;input<br/>
/$/<br/>
End&#160;of&#160;input<br/>
A&#160;regular&#160;expression&#160;has&#160;a&#160;method&#160;test&#160;to&#160;test&#160;whether&#160;a&#160;given&#160;string<br/>
matches&#160;it.&#160;It&#160;also&#160;has&#160;a&#160;method&#160;exec&#160;that,&#160;when&#160;a&#160;match&#160;is&#160;found,&#160;returns<br/>an&#160;array&#160;containing&#160;all&#160;matched&#160;groups.&#160;Such&#160;an&#160;array&#160;has&#160;an&#160;index&#160;property<br/>that&#160;indicates&#160;where&#160;the&#160;match&#160;started.<br/>
Strings&#160;have&#160;a&#160;match&#160;method&#160;to&#160;match&#160;them&#160;against&#160;a&#160;regular&#160;expression<br/>
and&#160;a&#160;search&#160;method&#160;to&#160;search&#160;for&#160;one,&#160;returning&#160;only&#160;the&#160;starting&#160;position<br/>of&#160;the&#160;match.&#160;Their&#160;replace&#160;method&#160;can&#160;replace&#160;matches&#160;of&#160;a&#160;pattern&#160;with&#160;a<br/>replacement&#160;string&#160;or&#160;function.<br/>
Regular&#160;expressions&#160;can&#160;have&#160;options,&#160;which&#160;are&#160;written&#160;after&#160;the&#160;closing<br/>
slash.&#160;The&#160;i&#160;option&#160;makes&#160;the&#160;match&#160;case&#160;insensitive.&#160;The&#160;g&#160;option&#160;makes<br/>the&#160;expression&#160;<i>global</i>,&#160;which,&#160;among&#160;other&#160;things,&#160;causes&#160;the&#160;replace&#160;method<br/>to&#160;replace&#160;all&#160;instances&#160;instead&#160;of&#160;just&#160;the&#160;first.&#160;The&#160;y&#160;option&#160;makes&#160;it&#160;sticky,<br/>which&#160;means&#160;that&#160;it&#160;will&#160;not&#160;search&#160;ahead&#160;and&#160;skip&#160;part&#160;of&#160;the&#160;string&#160;when<br/>looking&#160;for&#160;a&#160;match.&#160;The&#160;u&#160;option&#160;turns&#160;on&#160;Unicode&#160;mode,&#160;which&#160;fixes&#160;a<br/>number&#160;of&#160;problems&#160;around&#160;the&#160;handling&#160;of&#160;characters&#160;that&#160;take&#160;up&#160;two&#160;code<br/>units.<br/>
Regular&#160;expressions&#160;are&#160;a&#160;sharp&#160;tool&#160;with&#160;an&#160;awkward&#160;handle.&#160;They&#160;simplify<br/>
some&#160;tasks&#160;tremendously&#160;but&#160;can&#160;quickly&#160;become&#160;unmanageable&#160;when&#160;applied<br/>to&#160;complex&#160;problems.&#160;Part&#160;of&#160;knowing&#160;how&#160;to&#160;use&#160;them&#160;is&#160;resisting&#160;the&#160;urge&#160;to<br/>try&#160;to&#160;shoehorn&#160;things&#160;that&#160;they&#160;cannot&#160;cleanly&#160;express&#160;into&#160;them.<br/>
164<br/>
<hr/>
<a name=177></a><b>Exercises</b><br/>
It&#160;is&#160;almost&#160;unavoidable&#160;that,&#160;in&#160;the&#160;course&#160;of&#160;working&#160;on&#160;these&#160;exercises,<br/>you&#160;will&#160;get&#160;confused&#160;and&#160;frustrated&#160;by&#160;some&#160;regular&#160;expression’s&#160;inexplicable<br/>behavior.&#160;Sometimes&#160;it&#160;helps&#160;to&#160;enter&#160;your&#160;expression&#160;into&#160;an&#160;online&#160;tool&#160;like<br/><a href="https://www.debuggex.com/"><i>https://debuggex.com&#160;</i></a>to&#160;see&#160;whether&#160;its&#160;visualization&#160;corresponds&#160;to&#160;what&#160;you<br/>intended&#160;and&#160;to&#160;experiment&#160;with&#160;the&#160;way&#160;it&#160;responds&#160;to&#160;various&#160;input&#160;strings.<br/>
<b>Regexp&#160;golf</b><br/>
<i>Code&#160;golf&#160;</i>is&#160;a&#160;term&#160;used&#160;for&#160;the&#160;game&#160;of&#160;trying&#160;to&#160;express&#160;a&#160;particular&#160;program<br/>in&#160;as&#160;few&#160;characters&#160;as&#160;possible.&#160;Similarly,&#160;<i>regexp&#160;golf&#160;</i>is&#160;the&#160;practice&#160;of&#160;writing<br/>as&#160;tiny&#160;a&#160;regular&#160;expression&#160;as&#160;possible&#160;to&#160;match&#160;a&#160;given&#160;pattern,&#160;and&#160;<i>only&#160;</i>that<br/>pattern.<br/>
For&#160;each&#160;of&#160;the&#160;following&#160;items,&#160;write&#160;a&#160;regular&#160;expression&#160;to&#160;test&#160;whether&#160;any<br/>
of&#160;the&#160;given&#160;substrings&#160;occur&#160;in&#160;a&#160;string.&#160;The&#160;regular&#160;expression&#160;should&#160;match<br/>only&#160;strings&#160;containing&#160;one&#160;of&#160;the&#160;substrings&#160;described.&#160;Do&#160;not&#160;worry&#160;about<br/>word&#160;boundaries&#160;unless&#160;explicitly&#160;mentioned.&#160;When&#160;your&#160;expression&#160;works,&#160;see<br/>whether&#160;you&#160;can&#160;make&#160;it&#160;any&#160;smaller.<br/>
1.&#160;<i>car&#160;</i>and&#160;<i>cat</i><br/>
2.&#160;<i>pop&#160;</i>and&#160;<i>prop</i><br/>
3.&#160;<i>ferret</i>,&#160;<i>ferry</i>,&#160;and&#160;<i>ferrari</i><br/>
4.&#160;Any&#160;word&#160;ending&#160;in&#160;<i>ious</i><br/>
5.&#160;A&#160;whitespace&#160;character&#160;followed&#160;by&#160;a&#160;period,&#160;comma,&#160;colon,&#160;or&#160;semicolon<br/>
6.&#160;A&#160;word&#160;longer&#160;than&#160;six&#160;letters<br/>
7.&#160;A&#160;word&#160;without&#160;the&#160;letter&#160;<i>e&#160;</i>(or&#160;<i>E</i>)<br/>
Refer&#160;to&#160;the&#160;table&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#175">chapter&#160;summary&#160;</a>for&#160;help.&#160;Test&#160;each&#160;solution&#160;with<br/>
a&#160;few&#160;test&#160;strings.<br/>
<b>Quoting&#160;style</b><br/>
Imagine&#160;you&#160;have&#160;written&#160;a&#160;story&#160;and&#160;used&#160;single&#160;quotation&#160;marks&#160;throughout<br/>to&#160;mark&#160;pieces&#160;of&#160;dialogue.&#160;Now&#160;you&#160;want&#160;to&#160;replace&#160;all&#160;the&#160;dialogue&#160;quotes<br/>with&#160;double&#160;quotes,&#160;while&#160;keeping&#160;the&#160;single&#160;quotes&#160;used&#160;in&#160;contractions&#160;like<br/><i>aren’t</i>.<br/>
Think&#160;of&#160;a&#160;pattern&#160;that&#160;distinguishes&#160;these&#160;two&#160;kinds&#160;of&#160;quote&#160;usage&#160;and<br/>
craft&#160;a&#160;call&#160;to&#160;the&#160;replace&#160;method&#160;that&#160;does&#160;the&#160;proper&#160;replacement.<br/>
165<br/>
<hr/>
<a name=178></a><b>Numbers&#160;again</b><br/>
Write&#160;an&#160;expression&#160;that&#160;matches&#160;only&#160;JavaScript-style&#160;numbers.&#160;It&#160;must&#160;sup-<br/>port&#160;an&#160;optional&#160;minus&#160;<i>or&#160;</i>plus&#160;sign&#160;in&#160;front&#160;of&#160;the&#160;number,&#160;the&#160;decimal&#160;dot,<br/>and&#160;exponent&#160;notation—5e-3&#160;or&#160;1E10—again&#160;with&#160;an&#160;optional&#160;sign&#160;in&#160;front&#160;of<br/>the&#160;exponent.&#160;Also&#160;note&#160;that&#160;it&#160;is&#160;not&#160;necessary&#160;for&#160;there&#160;to&#160;be&#160;digits&#160;in&#160;front<br/>of&#160;or&#160;after&#160;the&#160;dot,&#160;but&#160;the&#160;number&#160;cannot&#160;be&#160;a&#160;dot&#160;alone.&#160;That&#160;is,&#160;.5&#160;and&#160;5.<br/>are&#160;valid&#160;JavaScript&#160;numbers,&#160;but&#160;a&#160;lone&#160;dot&#160;<i>isn’t</i>.<br/>
166<br/>
<hr/>
<a name=179></a><i>“Write&#160;code&#160;that&#160;is&#160;easy&#160;to&#160;delete,&#160;not&#160;easy&#160;to&#160;extend.”</i><br/>
—Tef,&#160;Programming&#160;is&#160;Terrible<br/>
<b>Chapter&#160;10<br/>Modules</b><br/>
The&#160;ideal&#160;program&#160;has&#160;a&#160;crystal-clear&#160;structure.&#160;The&#160;way&#160;it&#160;works&#160;is&#160;easy&#160;to<br/>explain,&#160;and&#160;each&#160;part&#160;plays&#160;a&#160;well-defined&#160;role.<br/>
A&#160;typical&#160;real&#160;program&#160;grows&#160;organically.&#160;New&#160;pieces&#160;of&#160;functionality&#160;are<br/>
added&#160;as&#160;new&#160;needs&#160;come&#160;up.&#160;Structuring—and&#160;preserving&#160;structure—is&#160;ad-<br/>ditional&#160;work.&#160;It’s&#160;work&#160;that&#160;will&#160;pay&#160;off&#160;only&#160;in&#160;the&#160;future,&#160;the&#160;<i>next&#160;</i>time<br/>someone&#160;works&#160;on&#160;the&#160;program.&#160;So&#160;it&#160;is&#160;tempting&#160;to&#160;neglect&#160;it&#160;and&#160;allow&#160;the<br/>parts&#160;of&#160;the&#160;program&#160;to&#160;become&#160;deeply&#160;entangled.<br/>
This&#160;causes&#160;two&#160;practical&#160;issues.&#160;First,&#160;understanding&#160;such&#160;a&#160;system&#160;is&#160;hard.<br/>
If&#160;everything&#160;can&#160;touch&#160;everything&#160;else,&#160;it&#160;is&#160;difficult&#160;to&#160;look&#160;at&#160;any&#160;given&#160;piece<br/>in&#160;isolation.&#160;You&#160;are&#160;forced&#160;to&#160;build&#160;up&#160;a&#160;holistic&#160;understanding&#160;of&#160;the&#160;entire<br/>thing.&#160;Second,&#160;if&#160;you&#160;want&#160;to&#160;use&#160;any&#160;of&#160;the&#160;functionality&#160;from&#160;such&#160;a&#160;program<br/>in&#160;another&#160;situation,&#160;rewriting&#160;it&#160;may&#160;be&#160;easier&#160;than&#160;trying&#160;to&#160;disentangle&#160;it<br/>from&#160;its&#160;context.<br/>
The&#160;phrase&#160;“big&#160;ball&#160;of&#160;mud”&#160;is&#160;often&#160;used&#160;for&#160;such&#160;large,&#160;structureless&#160;pro-<br/>
grams.&#160;Everything&#160;sticks&#160;together,&#160;and&#160;when&#160;you&#160;try&#160;to&#160;pick&#160;out&#160;a&#160;piece,&#160;the<br/>whole&#160;thing&#160;comes&#160;apart,&#160;and&#160;your&#160;hands&#160;get&#160;dirty.<br/>
<b>Modules</b><br/>
<i>Modules&#160;</i>are&#160;an&#160;attempt&#160;to&#160;avoid&#160;these&#160;problems.&#160;A&#160;module&#160;is&#160;a&#160;piece&#160;of&#160;program<br/>that&#160;specifies&#160;which&#160;other&#160;pieces&#160;it&#160;relies&#160;on&#160;and&#160;which&#160;functionality&#160;it&#160;provides<br/>for&#160;other&#160;modules&#160;to&#160;use&#160;(its&#160;<i>interface</i>).<br/>
Module&#160;interfaces&#160;have&#160;a&#160;lot&#160;in&#160;common&#160;with&#160;object&#160;interfaces,&#160;as&#160;we&#160;saw<br/>
them&#160;in&#160;<a href="eloquent-javascripts.html#109">Chapter&#160;6</a>.&#160;They&#160;make&#160;part&#160;of&#160;the&#160;module&#160;available&#160;to&#160;the&#160;outside<br/>world&#160;and&#160;keep&#160;the&#160;rest&#160;private.&#160;By&#160;restricting&#160;the&#160;ways&#160;in&#160;which&#160;modules<br/>interact&#160;with&#160;each&#160;other,&#160;the&#160;system&#160;becomes&#160;more&#160;like&#160;LEGO,&#160;where&#160;pieces<br/>interact&#160;through&#160;well-defined&#160;connectors,&#160;and&#160;less&#160;like&#160;mud,&#160;where&#160;everything<br/>mixes&#160;with&#160;everything.<br/>
The&#160;relations&#160;between&#160;modules&#160;are&#160;called&#160;<i>dependencies</i>.&#160;When&#160;a&#160;module<br/>
needs&#160;a&#160;piece&#160;from&#160;another&#160;module,&#160;it&#160;is&#160;said&#160;to&#160;depend&#160;on&#160;that&#160;module.&#160;When<br/>
167<br/>
<hr/>
<a name=180></a>this&#160;fact&#160;is&#160;clearly&#160;specified&#160;in&#160;the&#160;module&#160;itself,&#160;it&#160;can&#160;be&#160;used&#160;to&#160;figure&#160;out<br/>which&#160;other&#160;modules&#160;need&#160;to&#160;be&#160;present&#160;to&#160;be&#160;able&#160;to&#160;use&#160;a&#160;given&#160;module&#160;and<br/>to&#160;automatically&#160;load&#160;dependencies.<br/>
To&#160;separate&#160;modules&#160;in&#160;that&#160;way,&#160;each&#160;needs&#160;its&#160;own&#160;private&#160;scope.<br/>Just&#160;putting&#160;your&#160;JavaScript&#160;code&#160;into&#160;different&#160;files&#160;does&#160;not&#160;satisfy&#160;these<br/>
requirements.&#160;The&#160;files&#160;still&#160;share&#160;the&#160;same&#160;global&#160;namespace.&#160;They&#160;can,<br/>intentionally&#160;or&#160;accidentally,&#160;interfere&#160;with&#160;each&#160;other’s&#160;bindings.&#160;And&#160;the<br/>dependency&#160;structure&#160;remains&#160;unclear.&#160;We&#160;can&#160;do&#160;better,&#160;as&#160;we’ll&#160;see&#160;later&#160;in<br/>the&#160;chapter.<br/>
Designing&#160;a&#160;fitting&#160;module&#160;structure&#160;for&#160;a&#160;program&#160;can&#160;be&#160;difficult.&#160;In&#160;the<br/>
phase&#160;where&#160;you&#160;are&#160;still&#160;exploring&#160;the&#160;problem,&#160;trying&#160;different&#160;things&#160;to&#160;see<br/>what&#160;works,&#160;you&#160;might&#160;want&#160;to&#160;not&#160;worry&#160;about&#160;it&#160;too&#160;much&#160;since&#160;it&#160;can&#160;be&#160;a<br/>big&#160;distraction.&#160;Once&#160;you&#160;have&#160;something&#160;that&#160;feels&#160;solid,&#160;that’s&#160;a&#160;good&#160;time<br/>to&#160;take&#160;a&#160;step&#160;back&#160;and&#160;organize&#160;it.<br/>
<b>Packages</b><br/>
One&#160;of&#160;the&#160;advantages&#160;of&#160;building&#160;a&#160;program&#160;out&#160;of&#160;separate&#160;pieces,&#160;and&#160;being<br/>actually&#160;able&#160;to&#160;run&#160;those&#160;pieces&#160;on&#160;their&#160;own,&#160;is&#160;that&#160;you&#160;might&#160;be&#160;able&#160;to<br/>apply&#160;the&#160;same&#160;piece&#160;in&#160;different&#160;programs.<br/>
But&#160;how&#160;do&#160;you&#160;set&#160;this&#160;up?&#160;Say&#160;I&#160;want&#160;to&#160;use&#160;the&#160;parseINI&#160;function&#160;from<br/>
<a href="eloquent-javascripts.html#172">Chapter&#160;9&#160;</a>in&#160;another&#160;program.&#160;If&#160;it&#160;is&#160;clear&#160;what&#160;the&#160;function&#160;depends&#160;on&#160;(in<br/>this&#160;case,&#160;nothing),&#160;I&#160;can&#160;just&#160;copy&#160;all&#160;the&#160;necessary&#160;code&#160;into&#160;my&#160;new&#160;project<br/>and&#160;use&#160;it.&#160;But&#160;then,&#160;if&#160;I&#160;find&#160;a&#160;mistake&#160;in&#160;that&#160;code,&#160;I’ll&#160;probably&#160;fix&#160;it&#160;in<br/>whichever&#160;program&#160;I’m&#160;working&#160;with&#160;at&#160;the&#160;time&#160;and&#160;forget&#160;to&#160;also&#160;fix&#160;it&#160;in&#160;the<br/>other&#160;program.<br/>
Once&#160;you&#160;start&#160;duplicating&#160;code,&#160;you’ll&#160;quickly&#160;find&#160;yourself&#160;wasting&#160;time<br/>
and&#160;energy&#160;moving&#160;copies&#160;around&#160;and&#160;keeping&#160;them&#160;up-to-date.<br/>
That’s&#160;where&#160;<i>packages&#160;</i>come&#160;in.&#160;A&#160;package&#160;is&#160;a&#160;chunk&#160;of&#160;code&#160;that&#160;can&#160;be<br/>
distributed&#160;(copied&#160;and&#160;installed).&#160;It&#160;may&#160;contain&#160;one&#160;or&#160;more&#160;modules&#160;and<br/>has&#160;information&#160;about&#160;which&#160;other&#160;packages&#160;it&#160;depends&#160;on.&#160;A&#160;package&#160;also<br/>usually&#160;comes&#160;with&#160;documentation&#160;explaining&#160;what&#160;it&#160;does&#160;so&#160;that&#160;people&#160;who<br/>didn’t&#160;write&#160;it&#160;might&#160;still&#160;be&#160;able&#160;to&#160;use&#160;it.<br/>
When&#160;a&#160;problem&#160;is&#160;found&#160;in&#160;a&#160;package&#160;or&#160;a&#160;new&#160;feature&#160;is&#160;added,&#160;the&#160;package<br/>
is&#160;updated.&#160;Now&#160;the&#160;programs&#160;that&#160;depend&#160;on&#160;it&#160;(which&#160;may&#160;also&#160;be&#160;packages)<br/>can&#160;upgrade&#160;to&#160;the&#160;new&#160;version.<br/>
Working&#160;in&#160;this&#160;way&#160;requires&#160;infrastructure.&#160;We&#160;need&#160;a&#160;place&#160;to&#160;store&#160;and&#160;find<br/>
packages&#160;and&#160;a&#160;convenient&#160;way&#160;to&#160;install&#160;and&#160;upgrade&#160;them.&#160;In&#160;the&#160;JavaScript<br/>world,&#160;this&#160;infrastructure&#160;is&#160;provided&#160;by&#160;NPM&#160;(<a href="https://npmjs.org"><i>https://npmjs.org</i></a>).<br/>
168<br/>
<hr/>
<a name=181></a>NPM&#160;is&#160;two&#160;things:&#160;an&#160;online&#160;service&#160;where&#160;one&#160;can&#160;download&#160;(and&#160;upload)<br/>
packages&#160;and&#160;a&#160;program&#160;(bundled&#160;with&#160;Node.js)&#160;that&#160;helps&#160;you&#160;install&#160;and<br/>manage&#160;them.<br/>
At&#160;the&#160;time&#160;of&#160;writing,&#160;there&#160;are&#160;more&#160;than&#160;half&#160;a&#160;million&#160;different&#160;packages<br/>
available&#160;on&#160;NPM.&#160;A&#160;large&#160;portion&#160;of&#160;those&#160;are&#160;rubbish,&#160;I&#160;should&#160;mention,<br/>but&#160;almost&#160;every&#160;useful,&#160;publicly&#160;available&#160;package&#160;can&#160;be&#160;found&#160;on&#160;there.&#160;For<br/>example,&#160;an&#160;INI&#160;file&#160;parser,&#160;similar&#160;to&#160;the&#160;one&#160;we&#160;built&#160;in&#160;<a href="eloquent-javascripts.html#155">Chapter&#160;9,&#160;</a>is&#160;available<br/>under&#160;the&#160;package&#160;name&#160;ini.<br/>
<a href="eloquent-javascripts.html#362">Chapter&#160;20&#160;</a>will&#160;show&#160;how&#160;to&#160;install&#160;such&#160;packages&#160;locally&#160;using&#160;the&#160;npm<br/>
command&#160;line&#160;program.<br/>
Having&#160;quality&#160;packages&#160;available&#160;for&#160;download&#160;is&#160;extremely&#160;valuable.&#160;It<br/>
means&#160;that&#160;we&#160;can&#160;often&#160;avoid&#160;reinventing&#160;a&#160;program&#160;that&#160;100&#160;people&#160;have<br/>written&#160;before&#160;and&#160;get&#160;a&#160;solid,&#160;well-tested&#160;implementation&#160;at&#160;the&#160;press&#160;of&#160;a&#160;few<br/>keys.<br/>
Software&#160;is&#160;cheap&#160;to&#160;copy,&#160;so&#160;once&#160;someone&#160;has&#160;written&#160;it,&#160;distributing&#160;it&#160;to<br/>
other&#160;people&#160;is&#160;an&#160;efficient&#160;process.&#160;But&#160;writing&#160;it&#160;in&#160;the&#160;first&#160;place&#160;<i>is&#160;</i>work,<br/>and&#160;responding&#160;to&#160;people&#160;who&#160;have&#160;found&#160;problems&#160;in&#160;the&#160;code,&#160;or&#160;who&#160;want<br/>to&#160;propose&#160;new&#160;features,&#160;is&#160;even&#160;more&#160;work.<br/>
By&#160;default,&#160;you&#160;own&#160;the&#160;copyright&#160;to&#160;the&#160;code&#160;you&#160;write,&#160;and&#160;other&#160;peo-<br/>
ple&#160;may&#160;use&#160;it&#160;only&#160;with&#160;your&#160;permission.&#160;But&#160;because&#160;some&#160;people&#160;are&#160;just<br/>nice&#160;and&#160;because&#160;publishing&#160;good&#160;software&#160;can&#160;help&#160;make&#160;you&#160;a&#160;little&#160;bit&#160;fa-<br/>mous&#160;among&#160;programmers,&#160;many&#160;packages&#160;are&#160;published&#160;under&#160;a&#160;license&#160;that<br/>explicitly&#160;allows&#160;other&#160;people&#160;to&#160;use&#160;it.<br/>
Most&#160;code&#160;on&#160;NPM&#160;is&#160;licensed&#160;this&#160;way.&#160;Some&#160;licenses&#160;require&#160;you&#160;to&#160;also<br/>
publish&#160;code&#160;that&#160;you&#160;build&#160;on&#160;top&#160;of&#160;the&#160;package&#160;under&#160;the&#160;same&#160;license.<br/>Others&#160;are&#160;less&#160;demanding,&#160;just&#160;requiring&#160;that&#160;you&#160;keep&#160;the&#160;license&#160;with&#160;the<br/>code&#160;as&#160;you&#160;distribute&#160;it.&#160;The&#160;JavaScript&#160;community&#160;mostly&#160;uses&#160;the&#160;latter<br/>type&#160;of&#160;license.&#160;When&#160;using&#160;other&#160;people’s&#160;packages,&#160;make&#160;sure&#160;you&#160;are&#160;aware<br/>of&#160;their&#160;license.<br/>
<b>Improvised&#160;modules</b><br/>
Until&#160;2015,&#160;the&#160;JavaScript&#160;language&#160;had&#160;no&#160;built-in&#160;module&#160;system.&#160;Yet&#160;people<br/>had&#160;been&#160;building&#160;large&#160;systems&#160;in&#160;JavaScript&#160;for&#160;more&#160;than&#160;a&#160;decade,&#160;and&#160;they<br/><i>needed&#160;</i>modules.<br/>
So&#160;they&#160;designed&#160;their&#160;own&#160;module&#160;systems&#160;on&#160;top&#160;of&#160;the&#160;language.&#160;You&#160;can<br/>
use&#160;JavaScript&#160;functions&#160;to&#160;create&#160;local&#160;scopes&#160;and&#160;objects&#160;to&#160;represent&#160;module<br/>interfaces.<br/>
This&#160;is&#160;a&#160;module&#160;for&#160;going&#160;between&#160;day&#160;names&#160;and&#160;numbers&#160;(as&#160;returned<br/>
169<br/>
<hr/>
<a name=182></a>by&#160;Date’s&#160;getDay&#160;method).&#160;Its&#160;interface&#160;consists&#160;of&#160;weekDay.name&#160;and&#160;weekDay<br/>.number,&#160;and&#160;it&#160;hides&#160;its&#160;local&#160;binding&#160;names&#160;inside&#160;the&#160;scope&#160;of&#160;a&#160;function<br/>expression&#160;that&#160;is&#160;immediately&#160;invoked.<br/>
const&#160;weekDay&#160;=&#160;function()&#160;{<br/>
const&#160;names&#160;=&#160;[&#34;Sunday&#34;,&#160;&#34;Monday&#34;,&#160;&#34;Tuesday&#34;,&#160;&#34;Wednesday&#34;,<br/>
&#34;Thursday&#34;,&#160;&#34;Friday&#34;,&#160;&#34;Saturday&#34;];<br/>
return&#160;{<br/>
name(number)&#160;{&#160;return&#160;names[number];&#160;},<br/>number(name)&#160;{&#160;return&#160;names.indexOf(name);&#160;}<br/>
};<br/>
}();<br/>
console.log(weekDay.name(weekDay.number(&#34;Sunday&#34;)));<br/>//&#160;→&#160;Sunday<br/>
This&#160;style&#160;of&#160;modules&#160;provides&#160;isolation,&#160;to&#160;a&#160;certain&#160;degree,&#160;but&#160;it&#160;does&#160;not<br/>
declare&#160;dependencies.&#160;Instead,&#160;it&#160;just&#160;puts&#160;its&#160;interface&#160;into&#160;the&#160;global&#160;scope<br/>and&#160;expects&#160;its&#160;dependencies,&#160;if&#160;any,&#160;to&#160;do&#160;the&#160;same.&#160;For&#160;a&#160;long&#160;time&#160;this&#160;was<br/>the&#160;main&#160;approach&#160;used&#160;in&#160;web&#160;programming,&#160;but&#160;it&#160;is&#160;mostly&#160;obsolete&#160;now.<br/>
If&#160;we&#160;want&#160;to&#160;make&#160;dependency&#160;relations&#160;part&#160;of&#160;the&#160;code,&#160;we’ll&#160;have&#160;to&#160;take<br/>
control&#160;of&#160;loading&#160;dependencies.&#160;Doing&#160;that&#160;requires&#160;being&#160;able&#160;to&#160;execute<br/>strings&#160;as&#160;code.&#160;JavaScript&#160;can&#160;do&#160;this.<br/>
<b>Evaluating&#160;data&#160;as&#160;code</b><br/>
There&#160;are&#160;several&#160;ways&#160;to&#160;take&#160;data&#160;(a&#160;string&#160;of&#160;code)&#160;and&#160;run&#160;it&#160;as&#160;part&#160;of&#160;the<br/>current&#160;program.<br/>
The&#160;most&#160;obvious&#160;way&#160;is&#160;the&#160;special&#160;operator&#160;eval,&#160;which&#160;will&#160;execute&#160;a<br/>
string&#160;in&#160;the&#160;<i>current&#160;</i>scope.&#160;This&#160;is&#160;usually&#160;a&#160;bad&#160;idea&#160;because&#160;it&#160;breaks&#160;some<br/>of&#160;the&#160;properties&#160;that&#160;scopes&#160;normally&#160;have,&#160;such&#160;as&#160;it&#160;being&#160;easily&#160;predictable<br/>which&#160;binding&#160;a&#160;given&#160;name&#160;refers&#160;to.<br/>
const&#160;x&#160;=&#160;1;<br/>function&#160;evalAndReturnX(code)&#160;{<br/>
eval(code);<br/>return&#160;x;<br/>
}<br/>
console.log(evalAndReturnX(&#34;var&#160;x&#160;=&#160;2&#34;));<br/>//&#160;→&#160;2<br/>console.log(x);<br/>
170<br/>
<hr/>
<a name=183></a>//&#160;→&#160;1<br/>
A&#160;less&#160;scary&#160;way&#160;of&#160;interpreting&#160;data&#160;as&#160;code&#160;is&#160;to&#160;use&#160;the&#160;Function&#160;con-<br/>
structor.&#160;It&#160;takes&#160;two&#160;arguments:&#160;a&#160;string&#160;containing&#160;a&#160;comma-separated&#160;list<br/>of&#160;argument&#160;names&#160;and&#160;a&#160;string&#160;containing&#160;the&#160;function&#160;body.&#160;It&#160;wraps&#160;the<br/>code&#160;in&#160;a&#160;function&#160;value&#160;so&#160;that&#160;it&#160;gets&#160;its&#160;own&#160;scope&#160;and&#160;won’t&#160;do&#160;odd&#160;things<br/>with&#160;other&#160;scopes.<br/>
let&#160;plusOne&#160;=&#160;Function(&#34;n&#34;,&#160;&#34;return&#160;n&#160;+&#160;1;&#34;);<br/>console.log(plusOne(4));<br/>//&#160;→&#160;5<br/>
This&#160;is&#160;precisely&#160;what&#160;we&#160;need&#160;for&#160;a&#160;module&#160;system.&#160;We&#160;can&#160;wrap&#160;the<br/>
module’s&#160;code&#160;in&#160;a&#160;function&#160;and&#160;use&#160;that&#160;function’s&#160;scope&#160;as&#160;module&#160;scope.<br/>
<b>CommonJS</b><br/>
The&#160;most&#160;widely&#160;used&#160;approach&#160;to&#160;bolted-on&#160;JavaScript&#160;modules&#160;is&#160;called&#160;<i>Com-<br/>monJS&#160;modules</i>.&#160;Node.js&#160;uses&#160;it&#160;and&#160;is&#160;the&#160;system&#160;used&#160;by&#160;most&#160;packages&#160;on<br/>NPM.<br/>
The&#160;main&#160;concept&#160;in&#160;CommonJS&#160;modules&#160;is&#160;a&#160;function&#160;called&#160;require.&#160;When<br/>
you&#160;call&#160;this&#160;with&#160;the&#160;module&#160;name&#160;of&#160;a&#160;dependency,&#160;it&#160;makes&#160;sure&#160;the&#160;module<br/>is&#160;loaded&#160;and&#160;returns&#160;its&#160;interface.<br/>
Because&#160;the&#160;loader&#160;wraps&#160;the&#160;module&#160;code&#160;in&#160;a&#160;function,&#160;modules&#160;automat-<br/>
ically&#160;get&#160;their&#160;own&#160;local&#160;scope.&#160;All&#160;they&#160;have&#160;to&#160;do&#160;is&#160;call&#160;require&#160;to&#160;access<br/>their&#160;dependencies&#160;and&#160;put&#160;their&#160;interface&#160;in&#160;the&#160;object&#160;bound&#160;to&#160;exports.<br/>
This&#160;example&#160;module&#160;provides&#160;a&#160;date-formatting&#160;function.&#160;It&#160;uses&#160;two&#160;pack-<br/>
ages&#160;from&#160;NPM—ordinal&#160;to&#160;convert&#160;numbers&#160;to&#160;strings&#160;like&#160;&#34;1st&#34;&#160;and&#160;&#34;2nd&#34;,<br/>and&#160;date-names&#160;to&#160;get&#160;the&#160;English&#160;names&#160;for&#160;weekdays&#160;and&#160;months.&#160;It&#160;exports<br/>a&#160;single&#160;function,&#160;formatDate,&#160;which&#160;takes&#160;a&#160;Date&#160;object&#160;and&#160;a&#160;template&#160;string.<br/>
The&#160;template&#160;string&#160;may&#160;contain&#160;codes&#160;that&#160;direct&#160;the&#160;format,&#160;such&#160;as&#160;YYYY<br/>
for&#160;the&#160;full&#160;year&#160;and&#160;Do&#160;for&#160;the&#160;ordinal&#160;day&#160;of&#160;the&#160;month.&#160;You&#160;could&#160;give&#160;it&#160;a<br/>string&#160;like&#160;&#34;MMMM&#160;Do&#160;YYYY&#34;&#160;to&#160;get&#160;output&#160;like&#160;“November&#160;22nd&#160;2017”.<br/>
const&#160;ordinal&#160;=&#160;require(&#34;ordinal&#34;);<br/>const&#160;{days,&#160;months}&#160;=&#160;require(&#34;date-names&#34;);<br/>
exports.formatDate&#160;=&#160;function(date,&#160;format)&#160;{<br/>
return&#160;format.replace(/YYYY|M(MMM)?|Do?|dddd/g,&#160;tag&#160;=&gt;&#160;{<br/>
if&#160;(tag&#160;==&#160;&#34;YYYY&#34;)&#160;return&#160;date.getFullYear();<br/>
171<br/>
<hr/>
<a name=184></a>if&#160;(tag&#160;==&#160;&#34;M&#34;)&#160;return&#160;date.getMonth();<br/>if&#160;(tag&#160;==&#160;&#34;MMMM&#34;)&#160;return&#160;months[date.getMonth()];<br/>if&#160;(tag&#160;==&#160;&#34;D&#34;)&#160;return&#160;date.getDate();<br/>if&#160;(tag&#160;==&#160;&#34;Do&#34;)&#160;return&#160;ordinal(date.getDate());<br/>if&#160;(tag&#160;==&#160;&#34;dddd&#34;)&#160;return&#160;days[date.getDay()];<br/>
});<br/>
};<br/>
The&#160;interface&#160;of&#160;ordinal&#160;is&#160;a&#160;single&#160;function,&#160;whereas&#160;date-names&#160;exports&#160;an<br/>
object&#160;containing&#160;multiple&#160;things—days&#160;and&#160;months&#160;are&#160;arrays&#160;of&#160;names.&#160;De-<br/>structuring&#160;is&#160;very&#160;convenient&#160;when&#160;creating&#160;bindings&#160;for&#160;imported&#160;interfaces.<br/>
The&#160;module&#160;adds&#160;its&#160;interface&#160;function&#160;to&#160;exports&#160;so&#160;that&#160;modules&#160;that<br/>
depend&#160;on&#160;it&#160;get&#160;access&#160;to&#160;it.&#160;We&#160;could&#160;use&#160;the&#160;module&#160;like&#160;this:<br/>
const&#160;{formatDate}&#160;=&#160;require(&#34;./format-date&#34;);<br/>
console.log(formatDate(new&#160;Date(2017,&#160;9,&#160;13),<br/>
&#34;dddd&#160;the&#160;Do&#34;));<br/>
//&#160;→&#160;Friday&#160;the&#160;13th<br/>
We&#160;can&#160;define&#160;require,&#160;in&#160;its&#160;most&#160;minimal&#160;form,&#160;like&#160;this:<br/>
require.cache&#160;=&#160;Object.create(null);<br/>
function&#160;require(name)&#160;{<br/>
if&#160;(!(name&#160;in&#160;require.cache))&#160;{<br/>
let&#160;code&#160;=&#160;readFile(name);<br/>let&#160;module&#160;=&#160;{exports:&#160;{}};<br/>require.cache[name]&#160;=&#160;module;<br/>let&#160;wrapper&#160;=&#160;Function(&#34;require,&#160;exports,&#160;module&#34;,&#160;code);<br/>wrapper(require,&#160;module.exports,&#160;module);<br/>
}<br/>return&#160;require.cache[name].exports;<br/>
}<br/>
In&#160;this&#160;code,&#160;readFile&#160;is&#160;a&#160;made-up&#160;function&#160;that&#160;reads&#160;a&#160;file&#160;and&#160;returns&#160;its<br/>
contents&#160;as&#160;a&#160;string.&#160;Standard&#160;JavaScript&#160;provides&#160;no&#160;such&#160;functionality—but<br/>different&#160;JavaScript&#160;environments,&#160;such&#160;as&#160;the&#160;browser&#160;and&#160;Node.js,&#160;provide<br/>their&#160;own&#160;ways&#160;of&#160;accessing&#160;files.&#160;The&#160;example&#160;just&#160;pretends&#160;that&#160;readFile<br/>exists.<br/>
To&#160;avoid&#160;loading&#160;the&#160;same&#160;module&#160;multiple&#160;times,&#160;require&#160;keeps&#160;a&#160;store<br/>
(cache)&#160;of&#160;already&#160;loaded&#160;modules.&#160;When&#160;called,&#160;it&#160;first&#160;checks&#160;if&#160;the&#160;requested<br/>
172<br/>
<hr/>
<a name=185></a>module&#160;has&#160;been&#160;loaded&#160;and,&#160;if&#160;not,&#160;loads&#160;it.&#160;This&#160;involves&#160;reading&#160;the&#160;module’s<br/>code,&#160;wrapping&#160;it&#160;in&#160;a&#160;function,&#160;and&#160;calling&#160;it.<br/>
The&#160;interface&#160;of&#160;the&#160;ordinal&#160;package&#160;we&#160;saw&#160;before&#160;is&#160;not&#160;an&#160;object&#160;but<br/>
a&#160;function.&#160;A&#160;quirk&#160;of&#160;the&#160;CommonJS&#160;modules&#160;is&#160;that,&#160;though&#160;the&#160;module<br/>system&#160;will&#160;create&#160;an&#160;empty&#160;interface&#160;object&#160;for&#160;you&#160;(bound&#160;to&#160;exports),&#160;you<br/>can&#160;replace&#160;that&#160;with&#160;any&#160;value&#160;by&#160;overwriting&#160;module.exports.&#160;This&#160;is&#160;done<br/>by&#160;many&#160;modules&#160;to&#160;export&#160;a&#160;single&#160;value&#160;instead&#160;of&#160;an&#160;interface&#160;object.<br/>
By&#160;defining&#160;require,&#160;exports,&#160;and&#160;module&#160;as&#160;parameters&#160;for&#160;the&#160;generated<br/>
wrapper&#160;function&#160;(and&#160;passing&#160;the&#160;appropriate&#160;values&#160;when&#160;calling&#160;it),&#160;the<br/>loader&#160;makes&#160;sure&#160;that&#160;these&#160;bindings&#160;are&#160;available&#160;in&#160;the&#160;module’s&#160;scope.<br/>
The&#160;way&#160;the&#160;string&#160;given&#160;to&#160;require&#160;is&#160;translated&#160;to&#160;an&#160;actual&#160;filename&#160;or<br/>
web&#160;address&#160;differs&#160;in&#160;different&#160;systems.&#160;When&#160;it&#160;starts&#160;with&#160;&#34;./&#34;&#160;or&#160;&#34;../&#34;,<br/>it&#160;is&#160;generally&#160;interpreted&#160;as&#160;relative&#160;to&#160;the&#160;current&#160;module’s&#160;filename.&#160;So&#160;&#34;./<br/>format-date&#34;&#160;would&#160;be&#160;the&#160;file&#160;named&#160;format-date.js&#160;in&#160;the&#160;same&#160;directory.<br/>
When&#160;the&#160;name&#160;isn’t&#160;relative,&#160;Node.js&#160;will&#160;look&#160;for&#160;an&#160;installed&#160;package&#160;by<br/>
that&#160;name.&#160;In&#160;the&#160;example&#160;code&#160;in&#160;this&#160;chapter,&#160;we’ll&#160;interpret&#160;such&#160;names&#160;as<br/>referring&#160;to&#160;NPM&#160;packages.&#160;We’ll&#160;go&#160;into&#160;more&#160;detail&#160;on&#160;how&#160;to&#160;install&#160;and&#160;use<br/>NPM&#160;modules&#160;in&#160;<a href="eloquent-javascripts.html#362">Chapter&#160;20.</a><br/>
Now,&#160;instead&#160;of&#160;writing&#160;our&#160;own&#160;INI&#160;file&#160;parser,&#160;we&#160;can&#160;use&#160;one&#160;from&#160;NPM.<br/>
const&#160;{parse}&#160;=&#160;require(&#34;ini&#34;);<br/>
console.log(parse(&#34;x&#160;=&#160;10\ny&#160;=&#160;20&#34;));<br/>//&#160;→&#160;{x:&#160;&#34;10&#34;,&#160;y:&#160;&#34;20&#34;}<br/>
<b>ECMAScript&#160;modules</b><br/>
CommonJS&#160;modules&#160;work&#160;quite&#160;well&#160;and,&#160;in&#160;combination&#160;with&#160;NPM,&#160;have<br/>allowed&#160;the&#160;JavaScript&#160;community&#160;to&#160;start&#160;sharing&#160;code&#160;on&#160;a&#160;large&#160;scale.<br/>
But&#160;they&#160;remain&#160;a&#160;bit&#160;of&#160;a&#160;duct-tape&#160;hack.&#160;The&#160;notation&#160;is&#160;slightly&#160;awkward—<br/>
the&#160;things&#160;you&#160;add&#160;to&#160;exports&#160;are&#160;not&#160;available&#160;in&#160;the&#160;local&#160;scope,&#160;for&#160;example.<br/>And&#160;because&#160;require&#160;is&#160;a&#160;normal&#160;function&#160;call&#160;taking&#160;any&#160;kind&#160;of&#160;argument,&#160;not<br/>just&#160;a&#160;string&#160;literal,&#160;it&#160;can&#160;be&#160;hard&#160;to&#160;determine&#160;the&#160;dependencies&#160;of&#160;a&#160;module<br/>without&#160;running&#160;its&#160;code.<br/>
This&#160;is&#160;why&#160;the&#160;JavaScript&#160;standard&#160;from&#160;2015&#160;introduces&#160;its&#160;own,&#160;differ-<br/>
ent&#160;module&#160;system.&#160;It&#160;is&#160;usually&#160;called&#160;<i>ES&#160;modules</i>,&#160;where&#160;<i>ES&#160;</i>stands&#160;for<br/>ECMAScript.&#160;The&#160;main&#160;concepts&#160;of&#160;dependencies&#160;and&#160;interfaces&#160;remain&#160;the<br/>same,&#160;but&#160;the&#160;details&#160;differ.&#160;For&#160;one&#160;thing,&#160;the&#160;notation&#160;is&#160;now&#160;integrated&#160;into<br/>
173<br/>
<hr/>
<a name=186></a>the&#160;language.&#160;Instead&#160;of&#160;calling&#160;a&#160;function&#160;to&#160;access&#160;a&#160;dependency,&#160;you&#160;use&#160;a<br/>special&#160;import&#160;keyword.<br/>
import&#160;ordinal&#160;from&#160;&#34;ordinal&#34;;<br/>import&#160;{days,&#160;months}&#160;from&#160;&#34;date-names&#34;;<br/>
export&#160;function&#160;formatDate(date,&#160;format)&#160;{&#160;/*&#160;...&#160;*/&#160;}<br/>
Similarly,&#160;the&#160;export&#160;keyword&#160;is&#160;used&#160;to&#160;export&#160;things.&#160;It&#160;may&#160;appear&#160;in<br/>
front&#160;of&#160;a&#160;function,&#160;class,&#160;or&#160;binding&#160;definition&#160;(let,&#160;const,&#160;or&#160;var).<br/>
An&#160;ES&#160;module’s&#160;interface&#160;is&#160;not&#160;a&#160;single&#160;value&#160;but&#160;a&#160;set&#160;of&#160;named&#160;bindings.<br/>
The&#160;preceding&#160;module&#160;binds&#160;formatDate&#160;to&#160;a&#160;function.&#160;When&#160;you&#160;import&#160;from<br/>another&#160;module,&#160;you&#160;import&#160;the&#160;<i>binding</i>,&#160;not&#160;the&#160;value,&#160;which&#160;means&#160;an&#160;export-<br/>ing&#160;module&#160;may&#160;change&#160;the&#160;value&#160;of&#160;the&#160;binding&#160;at&#160;any&#160;time,&#160;and&#160;the&#160;modules<br/>that&#160;import&#160;it&#160;will&#160;see&#160;its&#160;new&#160;value.<br/>
When&#160;there&#160;is&#160;a&#160;binding&#160;named&#160;default,&#160;it&#160;is&#160;treated&#160;as&#160;the&#160;module’s&#160;main<br/>
exported&#160;value.&#160;If&#160;you&#160;import&#160;a&#160;module&#160;like&#160;ordinal&#160;in&#160;the&#160;example,&#160;without<br/>braces&#160;around&#160;the&#160;binding&#160;name,&#160;you&#160;get&#160;its&#160;default&#160;binding.&#160;Such&#160;modules<br/>can&#160;still&#160;export&#160;other&#160;bindings&#160;under&#160;different&#160;names&#160;alongside&#160;their&#160;default<br/>export.<br/>
To&#160;create&#160;a&#160;default&#160;export,&#160;you&#160;write&#160;export&#160;default&#160;before&#160;an&#160;expression,<br/>
a&#160;function&#160;declaration,&#160;or&#160;a&#160;class&#160;declaration.<br/>
export&#160;default&#160;[&#34;Winter&#34;,&#160;&#34;Spring&#34;,&#160;&#34;Summer&#34;,&#160;&#34;Autumn&#34;];<br/>
It&#160;is&#160;possible&#160;to&#160;rename&#160;imported&#160;bindings&#160;using&#160;the&#160;word&#160;as.<br/>
import&#160;{days&#160;as&#160;dayNames}&#160;from&#160;&#34;date-names&#34;;<br/>
console.log(dayNames.length);<br/>//&#160;→&#160;7<br/>
Another&#160;important&#160;difference&#160;is&#160;that&#160;ES&#160;module&#160;imports&#160;happen&#160;before&#160;a<br/>
module’s&#160;script&#160;starts&#160;running.&#160;That&#160;means&#160;import&#160;declarations&#160;may&#160;not&#160;ap-<br/>pear&#160;inside&#160;functions&#160;or&#160;blocks,&#160;and&#160;the&#160;names&#160;of&#160;dependencies&#160;must&#160;be&#160;quoted<br/>strings,&#160;not&#160;arbitrary&#160;expressions.<br/>
At&#160;the&#160;time&#160;of&#160;writing,&#160;the&#160;JavaScript&#160;community&#160;is&#160;in&#160;the&#160;process&#160;of&#160;adopt-<br/>
ing&#160;this&#160;module&#160;style.&#160;But&#160;it&#160;has&#160;been&#160;a&#160;slow&#160;process.&#160;It&#160;took&#160;a&#160;few&#160;years,<br/>after&#160;the&#160;format&#160;was&#160;specified,&#160;for&#160;browsers&#160;and&#160;Node.js&#160;to&#160;start&#160;supporting&#160;it.<br/>And&#160;though&#160;they&#160;mostly&#160;support&#160;it&#160;now,&#160;this&#160;support&#160;still&#160;has&#160;issues,&#160;and&#160;the<br/>
174<br/>
<hr/>
<a name=187></a>discussion&#160;on&#160;how&#160;such&#160;modules&#160;should&#160;be&#160;distributed&#160;through&#160;NPM&#160;is&#160;still<br/>ongoing.<br/>
Many&#160;projects&#160;are&#160;written&#160;using&#160;ES&#160;modules&#160;and&#160;then&#160;automatically&#160;con-<br/>
verted&#160;to&#160;some&#160;other&#160;format&#160;when&#160;published.&#160;We&#160;are&#160;in&#160;a&#160;transitional&#160;period<br/>in&#160;which&#160;two&#160;different&#160;module&#160;systems&#160;are&#160;used&#160;side&#160;by&#160;side,&#160;and&#160;it&#160;is&#160;useful&#160;to<br/>be&#160;able&#160;to&#160;read&#160;and&#160;write&#160;code&#160;in&#160;either&#160;of&#160;them.<br/>
<b>Building&#160;and&#160;bundling</b><br/>
In&#160;fact,&#160;many&#160;JavaScript&#160;projects&#160;aren’t&#160;even,&#160;technically,&#160;written&#160;in&#160;JavaScript.<br/>There&#160;are&#160;extensions,&#160;such&#160;as&#160;the&#160;type&#160;checking&#160;dialect&#160;mentioned&#160;in&#160;<a href="eloquent-javascripts.html#142">Chapter<br/>8</a>,&#160;that&#160;are&#160;widely&#160;used.&#160;People&#160;also&#160;often&#160;start&#160;using&#160;planned&#160;extensions&#160;to&#160;the<br/>language&#160;long&#160;before&#160;they&#160;have&#160;been&#160;added&#160;to&#160;the&#160;platforms&#160;that&#160;actually&#160;run<br/>JavaScript.<br/>
To&#160;make&#160;this&#160;possible,&#160;they&#160;<i>compile&#160;</i>their&#160;code,&#160;translating&#160;it&#160;from&#160;their<br/>
chosen&#160;JavaScript&#160;dialect&#160;to&#160;plain&#160;old&#160;JavaScript—or&#160;even&#160;to&#160;a&#160;past&#160;version&#160;of<br/>JavaScript—so&#160;that&#160;old&#160;browsers&#160;can&#160;run&#160;it.<br/>
Including&#160;a&#160;modular&#160;program&#160;that&#160;consists&#160;of&#160;200&#160;different&#160;files&#160;in&#160;a&#160;web&#160;page<br/>
produces&#160;its&#160;own&#160;problems.&#160;If&#160;fetching&#160;a&#160;single&#160;file&#160;over&#160;the&#160;network&#160;takes&#160;50<br/>milliseconds,&#160;loading&#160;the&#160;whole&#160;program&#160;takes&#160;10&#160;seconds,&#160;or&#160;maybe&#160;half&#160;that&#160;if<br/>you&#160;can&#160;load&#160;several&#160;files&#160;simultaneously.&#160;That’s&#160;a&#160;lot&#160;of&#160;wasted&#160;time.&#160;Because<br/>fetching&#160;a&#160;single&#160;big&#160;file&#160;tends&#160;to&#160;be&#160;faster&#160;than&#160;fetching&#160;a&#160;lot&#160;of&#160;tiny&#160;ones,<br/>web&#160;programmers&#160;have&#160;started&#160;using&#160;tools&#160;that&#160;roll&#160;their&#160;programs&#160;(which&#160;they<br/>painstakingly&#160;split&#160;into&#160;modules)&#160;back&#160;into&#160;a&#160;single&#160;big&#160;file&#160;before&#160;they&#160;publish<br/>it&#160;to&#160;the&#160;Web.&#160;Such&#160;tools&#160;are&#160;called&#160;<i>bundlers</i>.<br/>
And&#160;we&#160;can&#160;go&#160;further.&#160;Apart&#160;from&#160;the&#160;number&#160;of&#160;files,&#160;the&#160;<i>size&#160;</i>of&#160;the<br/>
files&#160;also&#160;determines&#160;how&#160;fast&#160;they&#160;can&#160;be&#160;transferred&#160;over&#160;the&#160;network.&#160;Thus,<br/>the&#160;JavaScript&#160;community&#160;has&#160;invented&#160;<i>minifiers</i>.&#160;These&#160;are&#160;tools&#160;that&#160;take<br/>a&#160;JavaScript&#160;program&#160;and&#160;make&#160;it&#160;smaller&#160;by&#160;automatically&#160;removing&#160;com-<br/>ments&#160;and&#160;whitespace,&#160;renaming&#160;bindings,&#160;and&#160;replacing&#160;pieces&#160;of&#160;code&#160;with<br/>equivalent&#160;code&#160;that&#160;take&#160;up&#160;less&#160;space.<br/>
So&#160;it&#160;is&#160;not&#160;uncommon&#160;for&#160;the&#160;code&#160;that&#160;you&#160;find&#160;in&#160;an&#160;NPM&#160;package&#160;or&#160;that<br/>
runs&#160;on&#160;a&#160;web&#160;page&#160;to&#160;have&#160;gone&#160;through&#160;<i>multiple&#160;</i>stages&#160;of&#160;transformation—<br/>converted&#160;from&#160;modern&#160;JavaScript&#160;to&#160;historic&#160;JavaScript,&#160;from&#160;ES&#160;module&#160;for-<br/>mat&#160;to&#160;CommonJS,&#160;bundled,&#160;and&#160;minified.&#160;We&#160;won’t&#160;go&#160;into&#160;the&#160;details&#160;of<br/>these&#160;tools&#160;in&#160;this&#160;book&#160;since&#160;they&#160;tend&#160;to&#160;be&#160;boring&#160;and&#160;change&#160;rapidly.&#160;Just<br/>be&#160;aware&#160;that&#160;the&#160;JavaScript&#160;code&#160;you&#160;run&#160;is&#160;often&#160;not&#160;the&#160;code&#160;as&#160;it&#160;was<br/>written.<br/>
175<br/>
<hr/>
<a name=188></a><b>Module&#160;design</b><br/>
Structuring&#160;programs&#160;is&#160;one&#160;of&#160;the&#160;subtler&#160;aspects&#160;of&#160;programming.&#160;Any&#160;non-<br/>trivial&#160;piece&#160;of&#160;functionality&#160;can&#160;be&#160;modeled&#160;in&#160;various&#160;ways.<br/>
Good&#160;program&#160;design&#160;is&#160;subjective—there&#160;are&#160;trade-offs&#160;involved&#160;and&#160;matters<br/>
of&#160;taste.&#160;The&#160;best&#160;way&#160;to&#160;learn&#160;the&#160;value&#160;of&#160;well-structured&#160;design&#160;is&#160;to&#160;read<br/>or&#160;work&#160;on&#160;a&#160;lot&#160;of&#160;programs&#160;and&#160;notice&#160;what&#160;works&#160;and&#160;what&#160;doesn’t.&#160;Don’t<br/>assume&#160;that&#160;a&#160;painful&#160;mess&#160;is&#160;“just&#160;the&#160;way&#160;it&#160;is”.&#160;You&#160;can&#160;improve&#160;the&#160;structure<br/>of&#160;almost&#160;everything&#160;by&#160;putting&#160;more&#160;thought&#160;into&#160;it.<br/>
One&#160;aspect&#160;of&#160;module&#160;design&#160;is&#160;ease&#160;of&#160;use.&#160;If&#160;you&#160;are&#160;designing&#160;something<br/>
that&#160;is&#160;intended&#160;to&#160;be&#160;used&#160;by&#160;multiple&#160;people—or&#160;even&#160;by&#160;yourself,&#160;in&#160;three<br/>months&#160;when&#160;you&#160;no&#160;longer&#160;remember&#160;the&#160;specifics&#160;of&#160;what&#160;you&#160;did—it&#160;is<br/>helpful&#160;if&#160;your&#160;interface&#160;is&#160;simple&#160;and&#160;predictable.<br/>
That&#160;may&#160;mean&#160;following&#160;existing&#160;conventions.&#160;A&#160;good&#160;example&#160;is&#160;the&#160;ini<br/>
package.&#160;This&#160;module&#160;imitates&#160;the&#160;standard&#160;JSON&#160;object&#160;by&#160;providing&#160;parse<br/>and&#160;stringify&#160;(to&#160;write&#160;an&#160;INI&#160;file)&#160;functions,&#160;and,&#160;like&#160;JSON,&#160;converts&#160;between<br/>strings&#160;and&#160;plain&#160;objects.&#160;So&#160;the&#160;interface&#160;is&#160;small&#160;and&#160;familiar,&#160;and&#160;after&#160;you’ve<br/>worked&#160;with&#160;it&#160;once,&#160;you’re&#160;likely&#160;to&#160;remember&#160;how&#160;to&#160;use&#160;it.<br/>
Even&#160;if&#160;there’s&#160;no&#160;standard&#160;function&#160;or&#160;widely&#160;used&#160;package&#160;to&#160;imitate,&#160;you<br/>
can&#160;keep&#160;your&#160;modules&#160;predictable&#160;by&#160;using&#160;simple&#160;data&#160;structures&#160;and&#160;doing<br/>a&#160;single,&#160;focused&#160;thing.&#160;Many&#160;of&#160;the&#160;INI-file&#160;parsing&#160;modules&#160;on&#160;NPM&#160;provide<br/>a&#160;function&#160;that&#160;directly&#160;reads&#160;such&#160;a&#160;file&#160;from&#160;the&#160;hard&#160;disk&#160;and&#160;parses&#160;it,<br/>for&#160;example.&#160;This&#160;makes&#160;it&#160;impossible&#160;to&#160;use&#160;such&#160;modules&#160;in&#160;the&#160;browser,<br/>where&#160;we&#160;don’t&#160;have&#160;direct&#160;file&#160;system&#160;access,&#160;and&#160;adds&#160;complexity&#160;that&#160;would<br/>have&#160;been&#160;better&#160;addressed&#160;by&#160;<i>composing&#160;</i>the&#160;module&#160;with&#160;some&#160;file-reading<br/>function.<br/>
This&#160;points&#160;to&#160;another&#160;helpful&#160;aspect&#160;of&#160;module&#160;design—the&#160;ease&#160;with&#160;which<br/>
something&#160;can&#160;be&#160;composed&#160;with&#160;other&#160;code.&#160;Focused&#160;modules&#160;that&#160;compute<br/>values&#160;are&#160;applicable&#160;in&#160;a&#160;wider&#160;range&#160;of&#160;programs&#160;than&#160;bigger&#160;modules&#160;that<br/>perform&#160;complicated&#160;actions&#160;with&#160;side&#160;effects.&#160;An&#160;INI&#160;file&#160;reader&#160;that&#160;insists&#160;on<br/>reading&#160;the&#160;file&#160;from&#160;disk&#160;is&#160;useless&#160;in&#160;a&#160;scenario&#160;where&#160;the&#160;file’s&#160;content&#160;comes<br/>from&#160;some&#160;other&#160;source.<br/>
Relatedly,&#160;stateful&#160;objects&#160;are&#160;sometimes&#160;useful&#160;or&#160;even&#160;necessary,&#160;but&#160;if<br/>
something&#160;can&#160;be&#160;done&#160;with&#160;a&#160;function,&#160;use&#160;a&#160;function.&#160;Several&#160;of&#160;the&#160;INI&#160;file<br/>readers&#160;on&#160;NPM&#160;provide&#160;an&#160;interface&#160;style&#160;that&#160;requires&#160;you&#160;to&#160;first&#160;create&#160;an<br/>object,&#160;then&#160;load&#160;the&#160;file&#160;into&#160;your&#160;object,&#160;and&#160;finally&#160;use&#160;specialized&#160;methods<br/>to&#160;get&#160;at&#160;the&#160;results.&#160;This&#160;type&#160;of&#160;thing&#160;is&#160;common&#160;in&#160;the&#160;object-oriented<br/>tradition,&#160;and&#160;it’s&#160;terrible.&#160;Instead&#160;of&#160;making&#160;a&#160;single&#160;function&#160;call&#160;and&#160;moving<br/>on,&#160;you&#160;have&#160;to&#160;perform&#160;the&#160;ritual&#160;of&#160;moving&#160;your&#160;object&#160;through&#160;various<br/>states.&#160;And&#160;because&#160;the&#160;data&#160;is&#160;now&#160;wrapped&#160;in&#160;a&#160;specialized&#160;object&#160;type,&#160;all<br/>
176<br/>
<hr/>
<a name=189></a>code&#160;that&#160;interacts&#160;with&#160;it&#160;has&#160;to&#160;know&#160;about&#160;that&#160;type,&#160;creating&#160;unnecessary<br/>interdependencies.<br/>
Often&#160;defining&#160;new&#160;data&#160;structures&#160;can’t&#160;be&#160;avoided—only&#160;a&#160;few&#160;basic&#160;ones<br/>
are&#160;provided&#160;by&#160;the&#160;language&#160;standard,&#160;and&#160;many&#160;types&#160;of&#160;data&#160;have&#160;to&#160;be<br/>more&#160;complex&#160;than&#160;an&#160;array&#160;or&#160;a&#160;map.&#160;But&#160;when&#160;an&#160;array&#160;suffices,&#160;use&#160;an<br/>array.<br/>
An&#160;example&#160;of&#160;a&#160;slightly&#160;more&#160;complex&#160;data&#160;structure&#160;is&#160;the&#160;graph&#160;from<br/>
<a href="eloquent-javascripts.html#129">Chapter&#160;7</a>.&#160;There&#160;is&#160;no&#160;single&#160;obvious&#160;way&#160;to&#160;represent&#160;a&#160;graph&#160;in&#160;JavaScript.<br/>In&#160;that&#160;chapter,&#160;we&#160;used&#160;an&#160;object&#160;whose&#160;properties&#160;hold&#160;arrays&#160;of&#160;strings—the<br/>other&#160;nodes&#160;reachable&#160;from&#160;that&#160;node.<br/>
There&#160;are&#160;several&#160;different&#160;pathfinding&#160;packages&#160;on&#160;NPM,&#160;but&#160;none&#160;of&#160;them<br/>
uses&#160;this&#160;graph&#160;format.&#160;They&#160;usually&#160;allow&#160;the&#160;graph’s&#160;edges&#160;to&#160;have&#160;a&#160;weight,<br/>which&#160;is&#160;the&#160;cost&#160;or&#160;distance&#160;associated&#160;with&#160;it.&#160;That&#160;isn’t&#160;possible&#160;in&#160;our<br/>representation.<br/>
For&#160;example,&#160;there’s&#160;the&#160;dijkstrajs&#160;package.&#160;A&#160;well-known&#160;approach&#160;to<br/>
pathfinding,&#160;quite&#160;similar&#160;to&#160;our&#160;findRoute&#160;function,&#160;is&#160;called&#160;<i>Dijkstra’s&#160;algo-<br/>rithm</i>,&#160;after&#160;Edsger&#160;Dijkstra,&#160;who&#160;first&#160;wrote&#160;it&#160;down.&#160;The&#160;js&#160;suffix&#160;is&#160;often<br/>added&#160;to&#160;package&#160;names&#160;to&#160;indicate&#160;the&#160;fact&#160;that&#160;they&#160;are&#160;written&#160;in&#160;JavaScript.<br/>This&#160;dijkstrajs&#160;package&#160;uses&#160;a&#160;graph&#160;format&#160;similar&#160;to&#160;ours,&#160;but&#160;instead&#160;of<br/>arrays,&#160;it&#160;uses&#160;objects&#160;whose&#160;property&#160;values&#160;are&#160;numbers—the&#160;weights&#160;of&#160;the<br/>edges.<br/>
So&#160;if&#160;we&#160;wanted&#160;to&#160;use&#160;that&#160;package,&#160;we’d&#160;have&#160;to&#160;make&#160;sure&#160;that&#160;our&#160;graph<br/>
was&#160;stored&#160;in&#160;the&#160;format&#160;it&#160;expects.&#160;All&#160;edges&#160;get&#160;the&#160;same&#160;weight&#160;since&#160;our<br/>simplified&#160;model&#160;treats&#160;each&#160;road&#160;as&#160;having&#160;the&#160;same&#160;cost&#160;(one&#160;turn).<br/>
const&#160;{find_path}&#160;=&#160;require(&#34;dijkstrajs&#34;);<br/>
let&#160;graph&#160;=&#160;{};<br/>for&#160;(let&#160;node&#160;of&#160;Object.keys(roadGraph))&#160;{<br/>
let&#160;edges&#160;=&#160;graph[node]&#160;=&#160;{};<br/>for&#160;(let&#160;dest&#160;of&#160;roadGraph[node])&#160;{<br/>
edges[dest]&#160;=&#160;1;<br/>
}<br/>
}<br/>
console.log(find_path(graph,&#160;&#34;Post&#160;Office&#34;,&#160;&#34;Cabin&#34;));<br/>//&#160;→&#160;[&#34;Post&#160;Office&#34;,&#160;&#34;Alice's&#160;House&#34;,&#160;&#34;Cabin&#34;]<br/>
This&#160;can&#160;be&#160;a&#160;barrier&#160;to&#160;composition—when&#160;various&#160;packages&#160;are&#160;using&#160;dif-<br/>
ferent&#160;data&#160;structures&#160;to&#160;describe&#160;similar&#160;things,&#160;combining&#160;them&#160;is&#160;difficult.<br/>Therefore,&#160;if&#160;you&#160;want&#160;to&#160;design&#160;for&#160;composability,&#160;find&#160;out&#160;what&#160;data&#160;struc-<br/>
177<br/>
<hr/>
<a name=190></a>tures&#160;other&#160;people&#160;are&#160;using&#160;and,&#160;when&#160;possible,&#160;follow&#160;their&#160;example.<br/>
<b>Summary</b><br/>
Modules&#160;provide&#160;structure&#160;to&#160;bigger&#160;programs&#160;by&#160;separating&#160;the&#160;code&#160;into&#160;pieces<br/>with&#160;clear&#160;interfaces&#160;and&#160;dependencies.&#160;The&#160;interface&#160;is&#160;the&#160;part&#160;of&#160;the&#160;module<br/>that’s&#160;visible&#160;from&#160;other&#160;modules,&#160;and&#160;the&#160;dependencies&#160;are&#160;the&#160;other&#160;modules<br/>that&#160;it&#160;makes&#160;use&#160;of.<br/>
Because&#160;JavaScript&#160;historically&#160;did&#160;not&#160;provide&#160;a&#160;module&#160;system,&#160;the&#160;Com-<br/>
monJS&#160;system&#160;was&#160;built&#160;on&#160;top&#160;of&#160;it.&#160;Then&#160;at&#160;some&#160;point&#160;it&#160;<i>did&#160;</i>get&#160;a&#160;built-in<br/>system,&#160;which&#160;now&#160;coexists&#160;uneasily&#160;with&#160;the&#160;CommonJS&#160;system.<br/>
A&#160;package&#160;is&#160;a&#160;chunk&#160;of&#160;code&#160;that&#160;can&#160;be&#160;distributed&#160;on&#160;its&#160;own.&#160;NPM&#160;is&#160;a<br/>
repository&#160;of&#160;JavaScript&#160;packages.&#160;You&#160;can&#160;download&#160;all&#160;kinds&#160;of&#160;useful&#160;(and<br/>useless)&#160;packages&#160;from&#160;it.<br/>
<b>Exercises</b><br/>
<b>A&#160;modular&#160;robot</b><br/>
These&#160;are&#160;the&#160;bindings&#160;that&#160;the&#160;project&#160;from&#160;<a href="eloquent-javascripts.html#129">Chapter&#160;7&#160;</a>creates:<br/>
roads<br/>buildGraph<br/>roadGraph<br/>VillageState<br/>runRobot<br/>randomPick<br/>randomRobot<br/>mailRoute<br/>routeRobot<br/>findRoute<br/>goalOrientedRobot<br/>
If&#160;you&#160;were&#160;to&#160;write&#160;that&#160;project&#160;as&#160;a&#160;modular&#160;program,&#160;what&#160;modules&#160;would<br/>
you&#160;create?&#160;Which&#160;module&#160;would&#160;depend&#160;on&#160;which&#160;other&#160;module,&#160;and&#160;what<br/>would&#160;their&#160;interfaces&#160;look&#160;like?<br/>
Which&#160;pieces&#160;are&#160;likely&#160;to&#160;be&#160;available&#160;prewritten&#160;on&#160;NPM?&#160;Would&#160;you&#160;prefer<br/>
to&#160;use&#160;an&#160;NPM&#160;package&#160;or&#160;write&#160;them&#160;yourself?<br/>
178<br/>
<hr/>
<a name=191></a><b>Roads&#160;module</b><br/>
Write&#160;a&#160;CommonJS&#160;module,&#160;based&#160;on&#160;the&#160;example&#160;from&#160;<a href="eloquent-javascripts.html#129">Chapter&#160;7,&#160;</a>that&#160;con-<br/>tains&#160;the&#160;array&#160;of&#160;roads&#160;and&#160;exports&#160;the&#160;graph&#160;data&#160;structure&#160;representing&#160;them<br/>as&#160;roadGraph.&#160;It&#160;should&#160;depend&#160;on&#160;a&#160;module&#160;./graph,&#160;which&#160;exports&#160;a&#160;function<br/>buildGraph&#160;that&#160;is&#160;used&#160;to&#160;build&#160;the&#160;graph.&#160;This&#160;function&#160;expects&#160;an&#160;array&#160;of<br/>two-element&#160;arrays&#160;(the&#160;start&#160;and&#160;end&#160;points&#160;of&#160;the&#160;roads).<br/>
<b>Circular&#160;dependencies</b><br/>
A&#160;circular&#160;dependency&#160;is&#160;a&#160;situation&#160;where&#160;module&#160;A&#160;depends&#160;on&#160;B,&#160;and&#160;B<br/>also,&#160;directly&#160;or&#160;indirectly,&#160;depends&#160;on&#160;A.&#160;Many&#160;module&#160;systems&#160;simply&#160;forbid<br/>this&#160;because&#160;whichever&#160;order&#160;you&#160;choose&#160;for&#160;loading&#160;such&#160;modules,&#160;you&#160;cannot<br/>make&#160;sure&#160;that&#160;each&#160;module’s&#160;dependencies&#160;have&#160;been&#160;loaded&#160;before&#160;it&#160;runs.<br/>
CommonJS&#160;modules&#160;allow&#160;a&#160;limited&#160;form&#160;of&#160;cyclic&#160;dependencies.&#160;As&#160;long&#160;as<br/>
the&#160;modules&#160;do&#160;not&#160;replace&#160;their&#160;default&#160;exports&#160;object&#160;and&#160;don’t&#160;access&#160;each<br/>other’s&#160;interface&#160;until&#160;after&#160;they&#160;finish&#160;loading,&#160;cyclic&#160;dependencies&#160;are&#160;okay.<br/>
The&#160;require&#160;function&#160;given&#160;<a href="eloquent-javascripts.html#184">earlier&#160;in&#160;this&#160;chapter&#160;</a>supports&#160;this&#160;type&#160;of&#160;de-<br/>
pendency&#160;cycle.&#160;Can&#160;you&#160;see&#160;how&#160;it&#160;handles&#160;cycles?&#160;What&#160;would&#160;go&#160;wrong<br/>when&#160;a&#160;module&#160;in&#160;a&#160;cycle&#160;<i>does&#160;</i>replace&#160;its&#160;default&#160;exports&#160;object?<br/>
179<br/>
<hr/>
<a name=192></a><i>“Who&#160;can&#160;wait&#160;quietly&#160;while&#160;the&#160;mud&#160;settles?</i><br/>
<i>Who&#160;can&#160;remain&#160;still&#160;until&#160;the&#160;moment&#160;of&#160;action?”</i><br/>
—Laozi,&#160;Tao&#160;Te&#160;Ching<br/>
<b>Chapter&#160;11<br/>Asynchronous&#160;Programming</b><br/>
The&#160;central&#160;part&#160;of&#160;a&#160;computer,&#160;the&#160;part&#160;that&#160;carries&#160;out&#160;the&#160;individual&#160;steps<br/>that&#160;make&#160;up&#160;our&#160;programs,&#160;is&#160;called&#160;the&#160;<i>processor</i>.&#160;The&#160;programs&#160;we&#160;have&#160;seen<br/>so&#160;far&#160;are&#160;things&#160;that&#160;will&#160;keep&#160;the&#160;processor&#160;busy&#160;until&#160;they&#160;have&#160;finished&#160;their<br/>work.&#160;The&#160;speed&#160;at&#160;which&#160;something&#160;like&#160;a&#160;loop&#160;that&#160;manipulates&#160;numbers&#160;can<br/>be&#160;executed&#160;depends&#160;pretty&#160;much&#160;entirely&#160;on&#160;the&#160;speed&#160;of&#160;the&#160;processor.<br/>
But&#160;many&#160;programs&#160;interact&#160;with&#160;things&#160;outside&#160;of&#160;the&#160;processor.&#160;For&#160;ex-<br/>
ample,&#160;they&#160;may&#160;communicate&#160;over&#160;a&#160;computer&#160;network&#160;or&#160;request&#160;data&#160;from<br/>the&#160;hard&#160;disk—which&#160;is&#160;a&#160;lot&#160;slower&#160;than&#160;getting&#160;it&#160;from&#160;memory.<br/>
When&#160;such&#160;a&#160;thing&#160;is&#160;happening,&#160;it&#160;would&#160;be&#160;a&#160;shame&#160;to&#160;let&#160;the&#160;processor<br/>
sit&#160;idle—there&#160;might&#160;be&#160;some&#160;other&#160;work&#160;it&#160;could&#160;do&#160;in&#160;the&#160;meantime.&#160;In<br/>part,&#160;this&#160;is&#160;handled&#160;by&#160;your&#160;operating&#160;system,&#160;which&#160;will&#160;switch&#160;the&#160;processor<br/>between&#160;multiple&#160;running&#160;programs.&#160;But&#160;that&#160;doesn’t&#160;help&#160;when&#160;we&#160;want&#160;a<br/><i>single&#160;</i>program&#160;to&#160;be&#160;able&#160;to&#160;make&#160;progress&#160;while&#160;it&#160;is&#160;waiting&#160;for&#160;a&#160;network<br/>request.<br/>
<b>Asynchronicity</b><br/>
In&#160;a&#160;<i>synchronous&#160;</i>programming&#160;model,&#160;things&#160;happen&#160;one&#160;at&#160;a&#160;time.&#160;When&#160;you<br/>call&#160;a&#160;function&#160;that&#160;performs&#160;a&#160;long-running&#160;action,&#160;it&#160;returns&#160;only&#160;when&#160;the<br/>action&#160;has&#160;finished&#160;and&#160;it&#160;can&#160;return&#160;the&#160;result.&#160;This&#160;stops&#160;your&#160;program&#160;for<br/>the&#160;time&#160;the&#160;action&#160;takes.<br/>
An&#160;<i>asynchronous&#160;</i>model&#160;allows&#160;multiple&#160;things&#160;to&#160;happen&#160;at&#160;the&#160;same&#160;time.<br/>
When&#160;you&#160;start&#160;an&#160;action,&#160;your&#160;program&#160;continues&#160;to&#160;run.&#160;When&#160;the&#160;action<br/>finishes,&#160;the&#160;program&#160;is&#160;informed&#160;and&#160;gets&#160;access&#160;to&#160;the&#160;result&#160;(for&#160;example,<br/>the&#160;data&#160;read&#160;from&#160;disk).<br/>
We&#160;can&#160;compare&#160;synchronous&#160;and&#160;asynchronous&#160;programming&#160;using&#160;a&#160;small<br/>
example:&#160;a&#160;program&#160;that&#160;fetches&#160;two&#160;resources&#160;from&#160;the&#160;network&#160;and&#160;then<br/>combines&#160;results.<br/>
In&#160;a&#160;synchronous&#160;environment,&#160;where&#160;the&#160;request&#160;function&#160;returns&#160;only&#160;after<br/>
it&#160;has&#160;done&#160;its&#160;work,&#160;the&#160;easiest&#160;way&#160;to&#160;perform&#160;this&#160;task&#160;is&#160;to&#160;make&#160;the&#160;requests<br/>
180<br/>
<hr/>
<a name=193></a>one&#160;after&#160;the&#160;other.&#160;This&#160;has&#160;the&#160;drawback&#160;that&#160;the&#160;second&#160;request&#160;will&#160;be<br/>started&#160;only&#160;when&#160;the&#160;first&#160;has&#160;finished.&#160;The&#160;total&#160;time&#160;taken&#160;will&#160;be&#160;at&#160;least<br/>the&#160;sum&#160;of&#160;the&#160;two&#160;response&#160;times.<br/>
The&#160;solution&#160;to&#160;this&#160;problem,&#160;in&#160;a&#160;synchronous&#160;system,&#160;is&#160;to&#160;start&#160;additional<br/>
threads&#160;of&#160;control.&#160;A&#160;<i>thread&#160;</i>is&#160;another&#160;running&#160;program&#160;whose&#160;execution&#160;may<br/>be&#160;interleaved&#160;with&#160;other&#160;programs&#160;by&#160;the&#160;operating&#160;system—since&#160;most&#160;mod-<br/>ern&#160;computers&#160;contain&#160;multiple&#160;processors,&#160;multiple&#160;threads&#160;may&#160;even&#160;run&#160;at<br/>the&#160;same&#160;time,&#160;on&#160;different&#160;processors.&#160;A&#160;second&#160;thread&#160;could&#160;start&#160;the&#160;second<br/>request,&#160;and&#160;then&#160;both&#160;threads&#160;wait&#160;for&#160;their&#160;results&#160;to&#160;come&#160;back,&#160;after&#160;which<br/>they&#160;resynchronize&#160;to&#160;combine&#160;their&#160;results.<br/>
In&#160;the&#160;following&#160;diagram,&#160;the&#160;thick&#160;lines&#160;represent&#160;time&#160;the&#160;program&#160;spends<br/>
running&#160;normally,&#160;and&#160;the&#160;thin&#160;lines&#160;represent&#160;time&#160;spent&#160;waiting&#160;for&#160;the&#160;net-<br/>work.&#160;In&#160;the&#160;synchronous&#160;model,&#160;the&#160;time&#160;taken&#160;by&#160;the&#160;network&#160;is&#160;<i>part&#160;</i>of&#160;the<br/>timeline&#160;for&#160;a&#160;given&#160;thread&#160;of&#160;control.&#160;In&#160;the&#160;asynchronous&#160;model,&#160;starting&#160;a<br/>network&#160;action&#160;conceptually&#160;causes&#160;a&#160;<i>split&#160;</i>in&#160;the&#160;timeline.&#160;The&#160;program&#160;that<br/>initiated&#160;the&#160;action&#160;continues&#160;running,&#160;and&#160;the&#160;action&#160;happens&#160;alongside&#160;it,<br/>notifying&#160;the&#160;program&#160;when&#160;it&#160;is&#160;finished.<br/>
synchronous,&#160;single&#160;thread&#160;of&#160;control<br/>
synchronous, two threads of control<br/>
asynchronous<br/>
Another&#160;way&#160;to&#160;describe&#160;the&#160;difference&#160;is&#160;that&#160;waiting&#160;for&#160;actions&#160;to&#160;finish<br/>
is&#160;<i>implicit&#160;</i>in&#160;the&#160;synchronous&#160;model,&#160;while&#160;it&#160;is&#160;<i>explicit</i>,&#160;under&#160;our&#160;control,&#160;in<br/>the&#160;asynchronous&#160;one.<br/>
Asynchronicity&#160;cuts&#160;both&#160;ways.&#160;It&#160;makes&#160;expressing&#160;programs&#160;that&#160;do&#160;not<br/>
fit&#160;the&#160;straight-line&#160;model&#160;of&#160;control&#160;easier,&#160;but&#160;it&#160;can&#160;also&#160;make&#160;expressing<br/>programs&#160;that&#160;do&#160;follow&#160;a&#160;straight&#160;line&#160;more&#160;awkward.&#160;We’ll&#160;see&#160;some&#160;ways&#160;to<br/>address&#160;this&#160;awkwardness&#160;later&#160;in&#160;the&#160;chapter.<br/>
Both&#160;of&#160;the&#160;important&#160;JavaScript&#160;programming&#160;platforms—browsers&#160;and<br/>
Node.js—make&#160;operations&#160;that&#160;might&#160;take&#160;a&#160;while&#160;asynchronous,&#160;rather&#160;than<br/>relying&#160;on&#160;threads.&#160;Since&#160;programming&#160;with&#160;threads&#160;is&#160;notoriously&#160;hard&#160;(under-<br/>standing&#160;what&#160;a&#160;program&#160;does&#160;is&#160;much&#160;more&#160;difficult&#160;when&#160;it’s&#160;doing&#160;multiple<br/>things&#160;at&#160;once),&#160;this&#160;is&#160;generally&#160;considered&#160;a&#160;good&#160;thing.<br/>
181<br/>
<hr/>
<a name=194></a><img src="eloquent-javascript-194_1.png"/><br/>
<b>Crow&#160;tech</b><br/>
Most&#160;people&#160;are&#160;aware&#160;of&#160;the&#160;fact&#160;that&#160;crows&#160;are&#160;very&#160;smart&#160;birds.&#160;They&#160;can<br/>use&#160;tools,&#160;plan&#160;ahead,&#160;remember&#160;things,&#160;and&#160;even&#160;communicate&#160;these&#160;things<br/>among&#160;themselves.<br/>
What&#160;most&#160;people&#160;don’t&#160;know&#160;is&#160;that&#160;they&#160;are&#160;capable&#160;of&#160;many&#160;things&#160;that<br/>
they&#160;keep&#160;well&#160;hidden&#160;from&#160;us.&#160;I’ve&#160;been&#160;told&#160;by&#160;a&#160;reputable&#160;(if&#160;somewhat<br/>eccentric)&#160;expert&#160;on&#160;corvids&#160;that&#160;crow&#160;technology&#160;is&#160;not&#160;far&#160;behind&#160;human<br/>technology,&#160;and&#160;they&#160;are&#160;catching&#160;up.<br/>
For&#160;example,&#160;many&#160;crow&#160;cultures&#160;have&#160;the&#160;ability&#160;to&#160;construct&#160;computing<br/>
devices.&#160;These&#160;are&#160;not&#160;electronic,&#160;as&#160;human&#160;computing&#160;devices&#160;are,&#160;but&#160;operate<br/>through&#160;the&#160;actions&#160;of&#160;tiny&#160;insects,&#160;a&#160;species&#160;closely&#160;related&#160;to&#160;the&#160;termite,&#160;which<br/>has&#160;developed&#160;a&#160;symbiotic&#160;relationship&#160;with&#160;the&#160;crows.&#160;The&#160;birds&#160;provide&#160;them<br/>with&#160;food,&#160;and&#160;in&#160;return&#160;the&#160;insects&#160;build&#160;and&#160;operate&#160;their&#160;complex&#160;colonies<br/>that,&#160;with&#160;the&#160;help&#160;of&#160;the&#160;living&#160;creatures&#160;inside&#160;them,&#160;perform&#160;computations.<br/>
Such&#160;colonies&#160;are&#160;usually&#160;located&#160;in&#160;big,&#160;long-lived&#160;nests.&#160;The&#160;birds&#160;and<br/>
insects&#160;work&#160;together&#160;to&#160;build&#160;a&#160;network&#160;of&#160;bulbous&#160;clay&#160;structures,&#160;hidden<br/>between&#160;the&#160;twigs&#160;of&#160;the&#160;nest,&#160;in&#160;which&#160;the&#160;insects&#160;live&#160;and&#160;work.<br/>
To&#160;communicate&#160;with&#160;other&#160;devices,&#160;these&#160;machines&#160;use&#160;light&#160;signals.&#160;The<br/>
crows&#160;embed&#160;pieces&#160;of&#160;reflective&#160;material&#160;in&#160;special&#160;communication&#160;stalks,&#160;and<br/>the&#160;insects&#160;aim&#160;these&#160;to&#160;reflect&#160;light&#160;at&#160;another&#160;nest,&#160;encoding&#160;data&#160;as&#160;a&#160;sequence<br/>of&#160;quick&#160;flashes.&#160;This&#160;means&#160;that&#160;only&#160;nests&#160;that&#160;have&#160;an&#160;unbroken&#160;visual<br/>connection&#160;can&#160;communicate.<br/>
Our&#160;friend&#160;the&#160;corvid&#160;expert&#160;has&#160;mapped&#160;the&#160;network&#160;of&#160;crow&#160;nests&#160;in&#160;the<br/>
village&#160;of&#160;Hières-sur-Amby,&#160;on&#160;the&#160;banks&#160;of&#160;the&#160;river&#160;Rhône.&#160;This&#160;map&#160;shows<br/>the&#160;nests&#160;and&#160;their&#160;connections:<br/>
In&#160;an&#160;astounding&#160;example&#160;of&#160;convergent&#160;evolution,&#160;crow&#160;computers&#160;run&#160;JavaScript.<br/>
In&#160;this&#160;chapter&#160;we’ll&#160;write&#160;some&#160;basic&#160;networking&#160;functions&#160;for&#160;them.<br/>
182<br/>
<hr/>
<a name=195></a><b>Callbacks</b><br/>
One&#160;approach&#160;to&#160;asynchronous&#160;programming&#160;is&#160;to&#160;make&#160;functions&#160;that&#160;perform<br/>a&#160;slow&#160;action&#160;take&#160;an&#160;extra&#160;argument,&#160;a&#160;<i>callback&#160;function</i>.&#160;The&#160;action&#160;is&#160;started,<br/>and&#160;when&#160;it&#160;finishes,&#160;the&#160;callback&#160;function&#160;is&#160;called&#160;with&#160;the&#160;result.<br/>
As&#160;an&#160;example,&#160;the&#160;setTimeout&#160;function,&#160;available&#160;both&#160;in&#160;Node.js&#160;and&#160;in<br/>
browsers,&#160;waits&#160;a&#160;given&#160;number&#160;of&#160;milliseconds&#160;(a&#160;second&#160;is&#160;a&#160;thousand&#160;mil-<br/>liseconds)&#160;and&#160;then&#160;calls&#160;a&#160;function.<br/>
setTimeout(()&#160;=&gt;&#160;console.log(&#34;Tick&#34;),&#160;500);<br/>
Waiting&#160;is&#160;not&#160;generally&#160;a&#160;very&#160;important&#160;type&#160;of&#160;work,&#160;but&#160;it&#160;can&#160;be&#160;useful<br/>
when&#160;doing&#160;something&#160;like&#160;updating&#160;an&#160;animation&#160;or&#160;checking&#160;whether&#160;some-<br/>thing&#160;is&#160;taking&#160;longer&#160;than&#160;a&#160;given&#160;amount&#160;of&#160;time.<br/>
Performing&#160;multiple&#160;asynchronous&#160;actions&#160;in&#160;a&#160;row&#160;using&#160;callbacks&#160;means<br/>
that&#160;you&#160;have&#160;to&#160;keep&#160;passing&#160;new&#160;functions&#160;to&#160;handle&#160;the&#160;continuation&#160;of&#160;the<br/>computation&#160;after&#160;the&#160;actions.<br/>
Most&#160;crow&#160;nest&#160;computers&#160;have&#160;a&#160;long-term&#160;data&#160;storage&#160;bulb,&#160;where&#160;pieces<br/>
of&#160;information&#160;are&#160;etched&#160;into&#160;twigs&#160;so&#160;that&#160;they&#160;can&#160;be&#160;retrieved&#160;later.&#160;Etching,<br/>or&#160;finding&#160;a&#160;piece&#160;of&#160;data,&#160;takes&#160;a&#160;moment,&#160;so&#160;the&#160;interface&#160;to&#160;long-term&#160;storage<br/>is&#160;asynchronous&#160;and&#160;uses&#160;callback&#160;functions.<br/>
Storage&#160;bulbs&#160;store&#160;pieces&#160;of&#160;JSON-encodable&#160;data&#160;under&#160;names.&#160;A&#160;crow<br/>
might&#160;store&#160;information&#160;about&#160;the&#160;places&#160;where&#160;it’s&#160;hidden&#160;food&#160;under&#160;the<br/>name&#160;&#34;food&#160;caches&#34;,&#160;which&#160;could&#160;hold&#160;an&#160;array&#160;of&#160;names&#160;that&#160;point&#160;at&#160;other<br/>pieces&#160;of&#160;data,&#160;describing&#160;the&#160;actual&#160;cache.&#160;To&#160;look&#160;up&#160;a&#160;food&#160;cache&#160;in&#160;the<br/>storage&#160;bulbs&#160;of&#160;the&#160;<i>Big&#160;Oak&#160;</i>nest,&#160;a&#160;crow&#160;could&#160;run&#160;code&#160;like&#160;this:<br/>
import&#160;{bigOak}&#160;from&#160;&#34;./crow-tech&#34;;<br/>
bigOak.readStorage(&#34;food&#160;caches&#34;,&#160;caches&#160;=&gt;&#160;{<br/>
let&#160;firstCache&#160;=&#160;caches[0];<br/>bigOak.readStorage(firstCache,&#160;info&#160;=&gt;&#160;{<br/>
console.log(info);<br/>
});<br/>
});<br/>
(All&#160;binding&#160;names&#160;and&#160;strings&#160;have&#160;been&#160;translated&#160;from&#160;crow&#160;language&#160;to<br/>
English.)<br/>
This&#160;style&#160;of&#160;programming&#160;is&#160;workable,&#160;but&#160;the&#160;indentation&#160;level&#160;increases<br/>
with&#160;each&#160;asynchronous&#160;action&#160;because&#160;you&#160;end&#160;up&#160;in&#160;another&#160;function.&#160;Doing<br/>more&#160;complicated&#160;things,&#160;such&#160;as&#160;running&#160;multiple&#160;actions&#160;at&#160;the&#160;same&#160;time,<br/>
183<br/>
<hr/>
<a name=196></a>can&#160;get&#160;a&#160;little&#160;awkward.<br/>
Crow&#160;nest&#160;computers&#160;are&#160;built&#160;to&#160;communicate&#160;using&#160;request-response&#160;pairs.<br/>
That&#160;means&#160;one&#160;nest&#160;sends&#160;a&#160;message&#160;to&#160;another&#160;nest,&#160;which&#160;then&#160;immediately<br/>sends&#160;a&#160;message&#160;back,&#160;confirming&#160;receipt&#160;and&#160;possibly&#160;including&#160;a&#160;reply&#160;to&#160;a<br/>question&#160;asked&#160;in&#160;the&#160;message.<br/>
Each&#160;message&#160;is&#160;tagged&#160;with&#160;a&#160;<i>type</i>,&#160;which&#160;determines&#160;how&#160;it&#160;is&#160;handled.&#160;Our<br/>
code&#160;can&#160;define&#160;handlers&#160;for&#160;specific&#160;request&#160;types,&#160;and&#160;when&#160;such&#160;a&#160;request<br/>comes&#160;in,&#160;the&#160;handler&#160;is&#160;called&#160;to&#160;produce&#160;a&#160;response.<br/>
The&#160;interface&#160;exported&#160;by&#160;the&#160;&#34;./crow-tech&#34;&#160;module&#160;provides&#160;callback-based<br/>
functions&#160;for&#160;communication.&#160;Nests&#160;have&#160;a&#160;send&#160;method&#160;that&#160;sends&#160;off&#160;a&#160;re-<br/>quest.&#160;It&#160;expects&#160;the&#160;name&#160;of&#160;the&#160;target&#160;nest,&#160;the&#160;type&#160;of&#160;the&#160;request,&#160;and&#160;the<br/>content&#160;of&#160;the&#160;request&#160;as&#160;its&#160;first&#160;three&#160;arguments,&#160;and&#160;it&#160;expects&#160;a&#160;function&#160;to<br/>call&#160;when&#160;a&#160;response&#160;comes&#160;in&#160;as&#160;its&#160;fourth&#160;and&#160;last&#160;argument.<br/>
bigOak.send(&#34;Cow&#160;Pasture&#34;,&#160;&#34;note&#34;,&#160;&#34;Let's&#160;caw&#160;loudly&#160;at&#160;7PM&#34;,<br/>
()&#160;=&gt;&#160;console.log(&#34;Note&#160;delivered.&#34;));<br/>
But&#160;to&#160;make&#160;nests&#160;capable&#160;of&#160;receiving&#160;that&#160;request,&#160;we&#160;first&#160;have&#160;to&#160;define&#160;a<br/>
request&#160;type&#160;named&#160;&#34;note&#34;.&#160;The&#160;code&#160;that&#160;handles&#160;the&#160;requests&#160;has&#160;to&#160;run&#160;not<br/>just&#160;on&#160;this&#160;nest-computer&#160;but&#160;on&#160;all&#160;nests&#160;that&#160;can&#160;receive&#160;messages&#160;of&#160;this<br/>type.&#160;We’ll&#160;just&#160;assume&#160;that&#160;a&#160;crow&#160;flies&#160;over&#160;and&#160;installs&#160;our&#160;handler&#160;code&#160;on<br/>all&#160;the&#160;nests.<br/>
import&#160;{defineRequestType}&#160;from&#160;&#34;./crow-tech&#34;;<br/>
defineRequestType(&#34;note&#34;,&#160;(nest,&#160;content,&#160;source,&#160;done)&#160;=&gt;&#160;{<br/>
console.log(`${nest.name}&#160;received&#160;note:&#160;${content}`);<br/>done();<br/>
});<br/>
The&#160;defineRequestType&#160;function&#160;defines&#160;a&#160;new&#160;type&#160;of&#160;request.&#160;The&#160;example<br/>
adds&#160;support&#160;for&#160;&#34;note&#34;&#160;requests,&#160;which&#160;just&#160;sends&#160;a&#160;note&#160;to&#160;a&#160;given&#160;nest.&#160;Our<br/>implementation&#160;calls&#160;console.log&#160;so&#160;that&#160;we&#160;can&#160;verify&#160;that&#160;the&#160;request&#160;arrived.<br/>Nests&#160;have&#160;a&#160;name&#160;property&#160;that&#160;holds&#160;their&#160;name.<br/>
The&#160;fourth&#160;argument&#160;given&#160;to&#160;the&#160;handler,&#160;done,&#160;is&#160;a&#160;callback&#160;function&#160;that&#160;it<br/>
must&#160;call&#160;when&#160;it&#160;is&#160;done&#160;with&#160;the&#160;request.&#160;If&#160;we&#160;had&#160;used&#160;the&#160;handler’s&#160;return<br/>value&#160;as&#160;the&#160;response&#160;value,&#160;that&#160;would&#160;mean&#160;that&#160;a&#160;request&#160;handler&#160;can’t&#160;itself<br/>perform&#160;asynchronous&#160;actions.&#160;A&#160;function&#160;doing&#160;asynchronous&#160;work&#160;typically<br/>returns&#160;before&#160;the&#160;work&#160;is&#160;done,&#160;having&#160;arranged&#160;for&#160;a&#160;callback&#160;to&#160;be&#160;called<br/>when&#160;it&#160;completes.&#160;So&#160;we&#160;need&#160;some&#160;asynchronous&#160;mechanism—in&#160;this&#160;case,<br/>
184<br/>
<hr/>
<a name=197></a>another&#160;callback&#160;function—to&#160;signal&#160;when&#160;a&#160;response&#160;is&#160;available.<br/>
In&#160;a&#160;way,&#160;asynchronicity&#160;is&#160;<i>contagious</i>.&#160;Any&#160;function&#160;that&#160;calls&#160;a&#160;function<br/>
that&#160;works&#160;asynchronously&#160;must&#160;itself&#160;be&#160;asynchronous,&#160;using&#160;a&#160;callback&#160;or<br/>similar&#160;mechanism&#160;to&#160;deliver&#160;its&#160;result.&#160;Calling&#160;a&#160;callback&#160;is&#160;somewhat&#160;more<br/>involved&#160;and&#160;error-prone&#160;than&#160;simply&#160;returning&#160;a&#160;value,&#160;so&#160;needing&#160;to&#160;structure<br/>large&#160;parts&#160;of&#160;your&#160;program&#160;that&#160;way&#160;is&#160;not&#160;great.<br/>
<b>Promises</b><br/>
Working&#160;with&#160;abstract&#160;concepts&#160;is&#160;often&#160;easier&#160;when&#160;those&#160;concepts&#160;can&#160;be<br/>represented&#160;by&#160;values.&#160;In&#160;the&#160;case&#160;of&#160;asynchronous&#160;actions,&#160;you&#160;could,&#160;instead<br/>of&#160;arranging&#160;for&#160;a&#160;function&#160;to&#160;be&#160;called&#160;at&#160;some&#160;point&#160;in&#160;the&#160;future,&#160;return&#160;an<br/>object&#160;that&#160;represents&#160;this&#160;future&#160;event.<br/>
This&#160;is&#160;what&#160;the&#160;standard&#160;class&#160;Promise&#160;is&#160;for.&#160;A&#160;<i>promise&#160;</i>is&#160;an&#160;asynchronous<br/>
action&#160;that&#160;may&#160;complete&#160;at&#160;some&#160;point&#160;and&#160;produce&#160;a&#160;value.&#160;It&#160;is&#160;able&#160;to<br/>notify&#160;anyone&#160;who&#160;is&#160;interested&#160;when&#160;its&#160;value&#160;is&#160;available.<br/>
The&#160;easiest&#160;way&#160;to&#160;create&#160;a&#160;promise&#160;is&#160;by&#160;calling&#160;Promise.resolve.&#160;This<br/>
function&#160;ensures&#160;that&#160;the&#160;value&#160;you&#160;give&#160;it&#160;is&#160;wrapped&#160;in&#160;a&#160;promise.&#160;If&#160;it’s<br/>already&#160;a&#160;promise,&#160;it&#160;is&#160;simply&#160;returned—otherwise,&#160;you&#160;get&#160;a&#160;new&#160;promise<br/>that&#160;immediately&#160;finishes&#160;with&#160;your&#160;value&#160;as&#160;its&#160;result.<br/>
let&#160;fifteen&#160;=&#160;Promise.resolve(15);<br/>fifteen.then(value&#160;=&gt;&#160;console.log(`Got&#160;${value}`));<br/>//&#160;→&#160;Got&#160;15<br/>
To&#160;get&#160;the&#160;result&#160;of&#160;a&#160;promise,&#160;you&#160;can&#160;use&#160;its&#160;then&#160;method.&#160;This&#160;registers&#160;a<br/>
callback&#160;function&#160;to&#160;be&#160;called&#160;when&#160;the&#160;promise&#160;resolves&#160;and&#160;produces&#160;a&#160;value.<br/>You&#160;can&#160;add&#160;multiple&#160;callbacks&#160;to&#160;a&#160;single&#160;promise,&#160;and&#160;they&#160;will&#160;be&#160;called,<br/>even&#160;if&#160;you&#160;add&#160;them&#160;after&#160;the&#160;promise&#160;has&#160;already&#160;<i>resolved&#160;</i>(finished).<br/>
But&#160;that’s&#160;not&#160;all&#160;the&#160;then&#160;method&#160;does.&#160;It&#160;returns&#160;another&#160;promise,&#160;which<br/>
resolves&#160;to&#160;the&#160;value&#160;that&#160;the&#160;handler&#160;function&#160;returns&#160;or,&#160;if&#160;that&#160;returns&#160;a<br/>promise,&#160;waits&#160;for&#160;that&#160;promise&#160;and&#160;then&#160;resolves&#160;to&#160;its&#160;result.<br/>
It&#160;is&#160;useful&#160;to&#160;think&#160;of&#160;promises&#160;as&#160;a&#160;device&#160;to&#160;move&#160;values&#160;into&#160;an&#160;asyn-<br/>
chronous&#160;reality.&#160;A&#160;normal&#160;value&#160;is&#160;simply&#160;there.&#160;A&#160;promised&#160;value&#160;is&#160;a&#160;value<br/>that&#160;<i>might&#160;</i>already&#160;be&#160;there&#160;or&#160;might&#160;appear&#160;at&#160;some&#160;point&#160;in&#160;the&#160;future.&#160;Com-<br/>putations&#160;defined&#160;in&#160;terms&#160;of&#160;promises&#160;act&#160;on&#160;such&#160;wrapped&#160;values&#160;and&#160;are<br/>executed&#160;asynchronously&#160;as&#160;the&#160;values&#160;become&#160;available.<br/>
To&#160;create&#160;a&#160;promise,&#160;you&#160;can&#160;use&#160;Promise&#160;as&#160;a&#160;constructor.&#160;It&#160;has&#160;a&#160;some-<br/>
what&#160;odd&#160;interface—the&#160;constructor&#160;expects&#160;a&#160;function&#160;as&#160;argument,&#160;which&#160;it<br/>
185<br/>
<hr/>
<a name=198></a>immediately&#160;calls,&#160;passing&#160;it&#160;a&#160;function&#160;that&#160;it&#160;can&#160;use&#160;to&#160;resolve&#160;the&#160;promise.<br/>It&#160;works&#160;this&#160;way,&#160;instead&#160;of&#160;for&#160;example&#160;with&#160;a&#160;resolve&#160;method,&#160;so&#160;that&#160;only<br/>the&#160;code&#160;that&#160;created&#160;the&#160;promise&#160;can&#160;resolve&#160;it.<br/>
This&#160;is&#160;how&#160;you’d&#160;create&#160;a&#160;promise-based&#160;interface&#160;for&#160;the&#160;readStorage&#160;func-<br/>
tion:<br/>
function&#160;storage(nest,&#160;name)&#160;{<br/>
return&#160;new&#160;Promise(resolve&#160;=&gt;&#160;{<br/>
nest.readStorage(name,&#160;result&#160;=&gt;&#160;resolve(result));<br/>
});<br/>
}<br/>
storage(bigOak,&#160;&#34;enemies&#34;)<br/>
.then(value&#160;=&gt;&#160;console.log(&#34;Got&#34;,&#160;value));<br/>
This&#160;asynchronous&#160;function&#160;returns&#160;a&#160;meaningful&#160;value.&#160;This&#160;is&#160;the&#160;main<br/>
advantage&#160;of&#160;promises—they&#160;simplify&#160;the&#160;use&#160;of&#160;asynchronous&#160;functions.&#160;In-<br/>stead&#160;of&#160;having&#160;to&#160;pass&#160;around&#160;callbacks,&#160;promise-based&#160;functions&#160;look&#160;similar<br/>to&#160;regular&#160;ones:&#160;they&#160;take&#160;input&#160;as&#160;arguments&#160;and&#160;return&#160;their&#160;output.&#160;The<br/>only&#160;difference&#160;is&#160;that&#160;the&#160;output&#160;may&#160;not&#160;be&#160;available&#160;yet.<br/>
<b>Failure</b><br/>
Regular&#160;JavaScript&#160;computations&#160;can&#160;fail&#160;by&#160;throwing&#160;an&#160;exception.&#160;Asyn-<br/>chronous&#160;computations&#160;often&#160;need&#160;something&#160;like&#160;that.&#160;A&#160;network&#160;request&#160;may<br/>fail,&#160;or&#160;some&#160;code&#160;that&#160;is&#160;part&#160;of&#160;the&#160;asynchronous&#160;computation&#160;may&#160;throw&#160;an<br/>exception.<br/>
One&#160;of&#160;the&#160;most&#160;pressing&#160;problems&#160;with&#160;the&#160;callback&#160;style&#160;of&#160;asynchronous<br/>
programming&#160;is&#160;that&#160;it&#160;makes&#160;it&#160;extremely&#160;difficult&#160;to&#160;make&#160;sure&#160;failures&#160;are<br/>properly&#160;reported&#160;to&#160;the&#160;callbacks.<br/>
A&#160;widely&#160;used&#160;convention&#160;is&#160;that&#160;the&#160;first&#160;argument&#160;to&#160;the&#160;callback&#160;is&#160;used<br/>
to&#160;indicate&#160;that&#160;the&#160;action&#160;failed,&#160;and&#160;the&#160;second&#160;contains&#160;the&#160;value&#160;produced<br/>by&#160;the&#160;action&#160;when&#160;it&#160;was&#160;successful.&#160;Such&#160;callback&#160;functions&#160;must&#160;always<br/>check&#160;whether&#160;they&#160;received&#160;an&#160;exception&#160;and&#160;make&#160;sure&#160;that&#160;any&#160;problems<br/>they&#160;cause,&#160;including&#160;exceptions&#160;thrown&#160;by&#160;functions&#160;they&#160;call,&#160;are&#160;caught&#160;and<br/>given&#160;to&#160;the&#160;right&#160;function.<br/>
Promises&#160;make&#160;this&#160;easier.&#160;They&#160;can&#160;be&#160;either&#160;resolved&#160;(the&#160;action&#160;finished<br/>
successfully)&#160;or&#160;rejected&#160;(it&#160;failed).&#160;Resolve&#160;handlers&#160;(as&#160;registered&#160;with&#160;then)<br/>are&#160;called&#160;only&#160;when&#160;the&#160;action&#160;is&#160;successful,&#160;and&#160;rejections&#160;are&#160;automatically<br/>propagated&#160;to&#160;the&#160;new&#160;promise&#160;that&#160;is&#160;returned&#160;by&#160;then.&#160;And&#160;when&#160;a&#160;handler<br/>
186<br/>
<hr/>
<a name=199></a>throws&#160;an&#160;exception,&#160;this&#160;automatically&#160;causes&#160;the&#160;promise&#160;produced&#160;by&#160;its<br/>then&#160;call&#160;to&#160;be&#160;rejected.&#160;So&#160;if&#160;any&#160;element&#160;in&#160;a&#160;chain&#160;of&#160;asynchronous&#160;actions<br/>fails,&#160;the&#160;outcome&#160;of&#160;the&#160;whole&#160;chain&#160;is&#160;marked&#160;as&#160;rejected,&#160;and&#160;no&#160;success<br/>handlers&#160;are&#160;called&#160;beyond&#160;the&#160;point&#160;where&#160;it&#160;failed.<br/>
Much&#160;like&#160;resolving&#160;a&#160;promise&#160;provides&#160;a&#160;value,&#160;rejecting&#160;one&#160;also&#160;provides<br/>
one,&#160;usually&#160;called&#160;the&#160;<i>reason&#160;</i>of&#160;the&#160;rejection.&#160;When&#160;an&#160;exception&#160;in&#160;a&#160;handler<br/>function&#160;causes&#160;the&#160;rejection,&#160;the&#160;exception&#160;value&#160;is&#160;used&#160;as&#160;the&#160;reason.&#160;Sim-<br/>ilarly,&#160;when&#160;a&#160;handler&#160;returns&#160;a&#160;promise&#160;that&#160;is&#160;rejected,&#160;that&#160;rejection&#160;flows<br/>into&#160;the&#160;next&#160;promise.&#160;There’s&#160;a&#160;Promise.reject&#160;function&#160;that&#160;creates&#160;a&#160;new,<br/>immediately&#160;rejected&#160;promise.<br/>
To&#160;explicitly&#160;handle&#160;such&#160;rejections,&#160;promises&#160;have&#160;a&#160;catch&#160;method&#160;that<br/>
registers&#160;a&#160;handler&#160;to&#160;be&#160;called&#160;when&#160;the&#160;promise&#160;is&#160;rejected,&#160;similar&#160;to&#160;how<br/>then&#160;handlers&#160;handle&#160;normal&#160;resolution.&#160;It’s&#160;also&#160;very&#160;much&#160;like&#160;then&#160;in&#160;that<br/>it&#160;returns&#160;a&#160;new&#160;promise,&#160;which&#160;resolves&#160;to&#160;the&#160;original&#160;promise’s&#160;value&#160;if&#160;it<br/>resolves&#160;normally&#160;and&#160;to&#160;the&#160;result&#160;of&#160;the&#160;catch&#160;handler&#160;otherwise.&#160;If&#160;a&#160;catch<br/>handler&#160;throws&#160;an&#160;error,&#160;the&#160;new&#160;promise&#160;is&#160;also&#160;rejected.<br/>
As&#160;a&#160;shorthand,&#160;then&#160;also&#160;accepts&#160;a&#160;rejection&#160;handler&#160;as&#160;a&#160;second&#160;argument,<br/>
so&#160;you&#160;can&#160;install&#160;both&#160;types&#160;of&#160;handlers&#160;in&#160;a&#160;single&#160;method&#160;call.<br/>
A&#160;function&#160;passed&#160;to&#160;the&#160;Promise&#160;constructor&#160;receives&#160;a&#160;second&#160;argument,<br/>
alongside&#160;the&#160;resolve&#160;function,&#160;which&#160;it&#160;can&#160;use&#160;to&#160;reject&#160;the&#160;new&#160;promise.<br/>
The&#160;chains&#160;of&#160;promise&#160;values&#160;created&#160;by&#160;calls&#160;to&#160;then&#160;and&#160;catch&#160;can&#160;be&#160;seen<br/>
as&#160;a&#160;pipeline&#160;through&#160;which&#160;asynchronous&#160;values&#160;or&#160;failures&#160;move.&#160;Since&#160;such<br/>chains&#160;are&#160;created&#160;by&#160;registering&#160;handlers,&#160;each&#160;link&#160;has&#160;a&#160;success&#160;handler&#160;or&#160;a<br/>rejection&#160;handler&#160;(or&#160;both)&#160;associated&#160;with&#160;it.&#160;Handlers&#160;that&#160;don’t&#160;match&#160;the<br/>type&#160;of&#160;outcome&#160;(success&#160;or&#160;failure)&#160;are&#160;ignored.&#160;But&#160;those&#160;that&#160;do&#160;match&#160;are<br/>called,&#160;and&#160;their&#160;outcome&#160;determines&#160;what&#160;kind&#160;of&#160;value&#160;comes&#160;next—success<br/>when&#160;it&#160;returns&#160;a&#160;non-promise&#160;value,&#160;rejection&#160;when&#160;it&#160;throws&#160;an&#160;exception,<br/>and&#160;the&#160;outcome&#160;of&#160;a&#160;promise&#160;when&#160;it&#160;returns&#160;one&#160;of&#160;those.<br/>
new&#160;Promise((_,&#160;reject)&#160;=&gt;&#160;reject(new&#160;Error(&#34;Fail&#34;)))<br/>
.then(value&#160;=&gt;&#160;console.log(&#34;Handler&#160;1&#34;))<br/>.catch(reason&#160;=&gt;&#160;{<br/>
console.log(&#34;Caught&#160;failure&#160;&#34;&#160;+&#160;reason);<br/>return&#160;&#34;nothing&#34;;<br/>
})<br/>.then(value&#160;=&gt;&#160;console.log(&#34;Handler&#160;2&#34;,&#160;value));<br/>
//&#160;→&#160;Caught&#160;failure&#160;Error:&#160;Fail<br/>//&#160;→&#160;Handler&#160;2&#160;nothing<br/>
Much&#160;like&#160;an&#160;uncaught&#160;exception&#160;is&#160;handled&#160;by&#160;the&#160;environment,&#160;JavaScript<br/>
environments&#160;can&#160;detect&#160;when&#160;a&#160;promise&#160;rejection&#160;isn’t&#160;handled&#160;and&#160;will&#160;report<br/>
187<br/>
<hr/>
<a name=200></a>this&#160;as&#160;an&#160;error.<br/>
<b>Networks&#160;are&#160;hard</b><br/>
Occasionally,&#160;there&#160;isn’t&#160;enough&#160;light&#160;for&#160;the&#160;crows’&#160;mirror&#160;systems&#160;to&#160;transmit<br/>a&#160;signal&#160;or&#160;something&#160;is&#160;blocking&#160;the&#160;path&#160;of&#160;the&#160;signal.&#160;It&#160;is&#160;possible&#160;for&#160;a<br/>signal&#160;to&#160;be&#160;sent&#160;but&#160;never&#160;received.<br/>
As&#160;it&#160;is,&#160;that&#160;will&#160;just&#160;cause&#160;the&#160;callback&#160;given&#160;to&#160;send&#160;to&#160;never&#160;be&#160;called,<br/>
which&#160;will&#160;probably&#160;cause&#160;the&#160;program&#160;to&#160;stop&#160;without&#160;even&#160;noticing&#160;there&#160;is<br/>a&#160;problem.&#160;It&#160;would&#160;be&#160;nice&#160;if,&#160;after&#160;a&#160;given&#160;period&#160;of&#160;not&#160;getting&#160;a&#160;response,<br/>a&#160;request&#160;would&#160;<i>time&#160;out&#160;</i>and&#160;report&#160;failure.<br/>
Often,&#160;transmission&#160;failures&#160;are&#160;random&#160;accidents,&#160;like&#160;a&#160;car’s&#160;headlight&#160;in-<br/>
terfering&#160;with&#160;the&#160;light&#160;signals,&#160;and&#160;simply&#160;retrying&#160;the&#160;request&#160;may&#160;cause&#160;it<br/>to&#160;succeed.&#160;So&#160;while&#160;we’re&#160;at&#160;it,&#160;let’s&#160;make&#160;our&#160;request&#160;function&#160;automatically<br/>retry&#160;the&#160;sending&#160;of&#160;the&#160;request&#160;a&#160;few&#160;times&#160;before&#160;it&#160;gives&#160;up.<br/>
And,&#160;since&#160;we’ve&#160;established&#160;that&#160;promises&#160;are&#160;a&#160;good&#160;thing,&#160;we’ll&#160;also&#160;make<br/>
our&#160;request&#160;function&#160;return&#160;a&#160;promise.&#160;In&#160;terms&#160;of&#160;what&#160;they&#160;can&#160;express,&#160;call-<br/>backs&#160;and&#160;promises&#160;are&#160;equivalent.&#160;Callback-based&#160;functions&#160;can&#160;be&#160;wrapped<br/>to&#160;expose&#160;a&#160;promise-based&#160;interface,&#160;and&#160;vice&#160;versa.<br/>
Even&#160;when&#160;a&#160;request&#160;and&#160;its&#160;response&#160;are&#160;successfully&#160;delivered,&#160;the&#160;response<br/>
may&#160;indicate&#160;failure—for&#160;example,&#160;if&#160;the&#160;request&#160;tries&#160;to&#160;use&#160;a&#160;request&#160;type<br/>that&#160;hasn’t&#160;been&#160;defined&#160;or&#160;the&#160;handler&#160;throws&#160;an&#160;error.&#160;To&#160;support&#160;this,&#160;send<br/>and&#160;defineRequestType&#160;follow&#160;the&#160;convention&#160;mentioned&#160;before,&#160;where&#160;the&#160;first<br/>argument&#160;passed&#160;to&#160;callbacks&#160;is&#160;the&#160;failure&#160;reason,&#160;if&#160;any,&#160;and&#160;the&#160;second&#160;is&#160;the<br/>actual&#160;result.<br/>
These&#160;can&#160;be&#160;translated&#160;to&#160;promise&#160;resolution&#160;and&#160;rejection&#160;by&#160;our&#160;wrapper.<br/>
class&#160;Timeout&#160;extends&#160;Error&#160;{}<br/>
function&#160;request(nest,&#160;target,&#160;type,&#160;content)&#160;{<br/>
return&#160;new&#160;Promise((resolve,&#160;reject)&#160;=&gt;&#160;{<br/>
let&#160;done&#160;=&#160;false;<br/>function&#160;attempt(n)&#160;{<br/>
nest.send(target,&#160;type,&#160;content,&#160;(failed,&#160;value)&#160;=&gt;&#160;{<br/>
done&#160;=&#160;true;<br/>if&#160;(failed)&#160;reject(failed);<br/>else&#160;resolve(value);<br/>
});<br/>setTimeout(()&#160;=&gt;&#160;{<br/>
if&#160;(done)&#160;return;<br/>else&#160;if&#160;(n&#160;&lt;&#160;3)&#160;attempt(n&#160;+&#160;1);<br/>else&#160;reject(new&#160;Timeout(&#34;Timed&#160;out&#34;));<br/>
188<br/>
<hr/>
<a name=201></a>},&#160;250);<br/>
}<br/>attempt(1);<br/>
});<br/>
}<br/>
Because&#160;promises&#160;can&#160;be&#160;resolved&#160;(or&#160;rejected)&#160;only&#160;once,&#160;this&#160;will&#160;work.&#160;The<br/>
first&#160;time&#160;resolve&#160;or&#160;reject&#160;is&#160;called&#160;determines&#160;the&#160;outcome&#160;of&#160;the&#160;promise,<br/>and&#160;further&#160;calls&#160;caused&#160;by&#160;a&#160;request&#160;coming&#160;back&#160;after&#160;another&#160;request&#160;finished<br/>are&#160;ignored.<br/>
To&#160;build&#160;an&#160;asynchronous&#160;loop,&#160;for&#160;the&#160;retries,&#160;we&#160;need&#160;to&#160;use&#160;a&#160;recursive<br/>
function—a&#160;regular&#160;loop&#160;doesn’t&#160;allow&#160;us&#160;to&#160;stop&#160;and&#160;wait&#160;for&#160;an&#160;asynchronous<br/>action.&#160;The&#160;attempt&#160;function&#160;makes&#160;a&#160;single&#160;attempt&#160;to&#160;send&#160;a&#160;request.&#160;It&#160;also<br/>sets&#160;a&#160;timeout&#160;that,&#160;if&#160;no&#160;response&#160;has&#160;come&#160;back&#160;after&#160;250&#160;milliseconds,&#160;either<br/>starts&#160;the&#160;next&#160;attempt&#160;or,&#160;if&#160;this&#160;was&#160;the&#160;third&#160;attempt,&#160;rejects&#160;the&#160;promise<br/>with&#160;an&#160;instance&#160;of&#160;Timeout&#160;as&#160;the&#160;reason.<br/>
Retrying&#160;every&#160;quarter-second&#160;and&#160;giving&#160;up&#160;when&#160;no&#160;response&#160;has&#160;come&#160;in<br/>
after&#160;three-quarter&#160;second&#160;is&#160;definitely&#160;somewhat&#160;arbitrary.&#160;It&#160;is&#160;even&#160;possible,<br/>if&#160;the&#160;request&#160;did&#160;come&#160;through&#160;but&#160;the&#160;handler&#160;is&#160;just&#160;taking&#160;a&#160;bit&#160;longer,<br/>for&#160;requests&#160;to&#160;be&#160;delivered&#160;multiple&#160;times.&#160;We’ll&#160;write&#160;our&#160;handlers&#160;with&#160;that<br/>problem&#160;in&#160;mind—duplicate&#160;messages&#160;should&#160;be&#160;harmless.<br/>
In&#160;general,&#160;we&#160;will&#160;not&#160;be&#160;building&#160;a&#160;world-class,&#160;robust&#160;network&#160;today.&#160;But<br/>
that’s&#160;okay—crows&#160;don’t&#160;have&#160;very&#160;high&#160;expectations&#160;yet&#160;when&#160;it&#160;comes&#160;to<br/>computing.<br/>
To&#160;isolate&#160;ourselves&#160;from&#160;callbacks&#160;altogether,&#160;we’ll&#160;go&#160;ahead&#160;and&#160;also&#160;define<br/>
a&#160;wrapper&#160;for&#160;defineRequestType&#160;that&#160;allows&#160;the&#160;handler&#160;function&#160;to&#160;return&#160;a<br/>promise&#160;or&#160;plain&#160;value&#160;and&#160;wires&#160;that&#160;up&#160;to&#160;the&#160;callback&#160;for&#160;us.<br/>
function&#160;requestType(name,&#160;handler)&#160;{<br/>
defineRequestType(name,&#160;(nest,&#160;content,&#160;source,<br/>
callback)&#160;=&gt;&#160;{<br/>
try&#160;{<br/>
Promise.resolve(handler(nest,&#160;content,&#160;source))<br/>
.then(response&#160;=&gt;&#160;callback(null,&#160;response),<br/>
failure&#160;=&gt;&#160;callback(failure));<br/>
}&#160;catch&#160;(exception)&#160;{<br/>
callback(exception);<br/>
}<br/>
});<br/>
}<br/>
189<br/>
<hr/>
<a name=202></a>Promise.resolve&#160;is&#160;used&#160;to&#160;convert&#160;the&#160;value&#160;returned&#160;by&#160;handler&#160;to&#160;a<br/>
promise&#160;if&#160;it&#160;isn’t&#160;already.<br/>
Note&#160;that&#160;the&#160;call&#160;to&#160;handler&#160;had&#160;to&#160;be&#160;wrapped&#160;in&#160;a&#160;try&#160;block&#160;to&#160;make&#160;sure<br/>
any&#160;exception&#160;it&#160;raises&#160;directly&#160;is&#160;given&#160;to&#160;the&#160;callback.&#160;This&#160;nicely&#160;illustrates<br/>the&#160;difficulty&#160;of&#160;properly&#160;handling&#160;errors&#160;with&#160;raw&#160;callbacks—it&#160;is&#160;easy&#160;to&#160;forget<br/>to&#160;properly&#160;route&#160;exceptions&#160;like&#160;that,&#160;and&#160;if&#160;you&#160;don’t&#160;do&#160;it,&#160;failures&#160;won’t&#160;get<br/>reported&#160;to&#160;the&#160;right&#160;callback.&#160;Promises&#160;make&#160;this&#160;mostly&#160;automatic&#160;and&#160;thus<br/>less&#160;error-prone.<br/>
<b>Collections&#160;of&#160;promises</b><br/>
Each&#160;nest&#160;computer&#160;keeps&#160;an&#160;array&#160;of&#160;other&#160;nests&#160;within&#160;transmission&#160;distance<br/>in&#160;its&#160;neighbors&#160;property.&#160;To&#160;check&#160;which&#160;of&#160;those&#160;are&#160;currently&#160;reachable,<br/>you&#160;could&#160;write&#160;a&#160;function&#160;that&#160;tries&#160;to&#160;send&#160;a&#160;&#34;ping&#34;&#160;request&#160;(a&#160;request&#160;that<br/>simply&#160;asks&#160;for&#160;a&#160;response)&#160;to&#160;each&#160;of&#160;them&#160;and&#160;see&#160;which&#160;ones&#160;come&#160;back.<br/>
When&#160;working&#160;with&#160;collections&#160;of&#160;promises&#160;running&#160;at&#160;the&#160;same&#160;time,&#160;the<br/>
Promise.all&#160;function&#160;can&#160;be&#160;useful.&#160;It&#160;returns&#160;a&#160;promise&#160;that&#160;waits&#160;for&#160;all&#160;of<br/>the&#160;promises&#160;in&#160;the&#160;array&#160;to&#160;resolve&#160;and&#160;then&#160;resolves&#160;to&#160;an&#160;array&#160;of&#160;the&#160;values<br/>that&#160;these&#160;promises&#160;produced&#160;(in&#160;the&#160;same&#160;order&#160;as&#160;the&#160;original&#160;array).&#160;If&#160;any<br/>promise&#160;is&#160;rejected,&#160;the&#160;result&#160;of&#160;Promise.all&#160;is&#160;itself&#160;rejected.<br/>
requestType(&#34;ping&#34;,&#160;()&#160;=&gt;&#160;&#34;pong&#34;);<br/>
function&#160;availableNeighbors(nest)&#160;{<br/>
let&#160;requests&#160;=&#160;nest.neighbors.map(neighbor&#160;=&gt;&#160;{<br/>
return&#160;request(nest,&#160;neighbor,&#160;&#34;ping&#34;)<br/>
.then(()&#160;=&gt;&#160;true,&#160;()&#160;=&gt;&#160;false);<br/>
});<br/>return&#160;Promise.all(requests).then(result&#160;=&gt;&#160;{<br/>
return&#160;nest.neighbors.filter((_,&#160;i)&#160;=&gt;&#160;result[i]);<br/>
});<br/>
}<br/>
When&#160;a&#160;neighbor&#160;isn’t&#160;available,&#160;we&#160;don’t&#160;want&#160;the&#160;entire&#160;combined&#160;promise<br/>
to&#160;fail&#160;since&#160;then&#160;we&#160;still&#160;wouldn’t&#160;know&#160;anything.&#160;So&#160;the&#160;function&#160;that&#160;is<br/>mapped&#160;over&#160;the&#160;set&#160;of&#160;neighbors&#160;to&#160;turn&#160;them&#160;into&#160;request&#160;promises&#160;attaches<br/>handlers&#160;that&#160;make&#160;successful&#160;requests&#160;produce&#160;true&#160;and&#160;rejected&#160;ones&#160;produce<br/>false.<br/>
In&#160;the&#160;handler&#160;for&#160;the&#160;combined&#160;promise,&#160;filter&#160;is&#160;used&#160;to&#160;remove&#160;those<br/>
elements&#160;from&#160;the&#160;neighbors&#160;array&#160;whose&#160;corresponding&#160;value&#160;is&#160;false.&#160;This<br/>makes&#160;use&#160;of&#160;the&#160;fact&#160;that&#160;filter&#160;passes&#160;the&#160;array&#160;index&#160;of&#160;the&#160;current&#160;element<br/>
190<br/>
<hr/>
<a name=203></a>as&#160;a&#160;second&#160;argument&#160;to&#160;its&#160;filtering&#160;function&#160;(map,&#160;some,&#160;and&#160;similar&#160;higher-<br/>order&#160;array&#160;methods&#160;do&#160;the&#160;same).<br/>
<b>Network&#160;flooding</b><br/>
The&#160;fact&#160;that&#160;nests&#160;can&#160;talk&#160;only&#160;to&#160;their&#160;neighbors&#160;greatly&#160;inhibits&#160;the&#160;useful-<br/>ness&#160;of&#160;this&#160;network.<br/>
For&#160;broadcasting&#160;information&#160;to&#160;the&#160;whole&#160;network,&#160;one&#160;solution&#160;is&#160;to&#160;set&#160;up<br/>
a&#160;type&#160;of&#160;request&#160;that&#160;is&#160;automatically&#160;forwarded&#160;to&#160;neighbors.&#160;These&#160;neighbors<br/>then&#160;in&#160;turn&#160;forward&#160;it&#160;to&#160;their&#160;neighbors,&#160;until&#160;the&#160;whole&#160;network&#160;has&#160;received<br/>the&#160;message.<br/>
import&#160;{everywhere}&#160;from&#160;&#34;./crow-tech&#34;;<br/>
everywhere(nest&#160;=&gt;&#160;{<br/>
nest.state.gossip&#160;=&#160;[];<br/>
});<br/>
function&#160;sendGossip(nest,&#160;message,&#160;exceptFor&#160;=&#160;null)&#160;{<br/>
nest.state.gossip.push(message);<br/>for&#160;(let&#160;neighbor&#160;of&#160;nest.neighbors)&#160;{<br/>
if&#160;(neighbor&#160;==&#160;exceptFor)&#160;continue;<br/>request(nest,&#160;neighbor,&#160;&#34;gossip&#34;,&#160;message);<br/>
}<br/>
}<br/>
requestType(&#34;gossip&#34;,&#160;(nest,&#160;message,&#160;source)&#160;=&gt;&#160;{<br/>
if&#160;(nest.state.gossip.includes(message))&#160;return;<br/>console.log(`${nest.name}&#160;received&#160;gossip&#160;'${<br/>
message}'&#160;from&#160;${source}`);<br/>
sendGossip(nest,&#160;message,&#160;source);<br/>
});<br/>
To&#160;avoid&#160;sending&#160;the&#160;same&#160;message&#160;around&#160;the&#160;network&#160;forever,&#160;each&#160;nest<br/>
keeps&#160;an&#160;array&#160;of&#160;gossip&#160;strings&#160;that&#160;it&#160;has&#160;already&#160;seen.&#160;To&#160;define&#160;this&#160;array,<br/>we&#160;use&#160;the&#160;everywhere&#160;function—which&#160;runs&#160;code&#160;on&#160;every&#160;nest—to&#160;add&#160;a<br/>property&#160;to&#160;the&#160;nest’s&#160;state&#160;object,&#160;which&#160;is&#160;where&#160;we’ll&#160;keep&#160;nest-local&#160;state.<br/>
When&#160;a&#160;nest&#160;receives&#160;a&#160;duplicate&#160;gossip&#160;message,&#160;which&#160;is&#160;very&#160;likely&#160;to<br/>
happen&#160;with&#160;everybody&#160;blindly&#160;resending&#160;them,&#160;it&#160;ignores&#160;it.&#160;But&#160;when&#160;it<br/>receives&#160;a&#160;new&#160;message,&#160;it&#160;excitedly&#160;tells&#160;all&#160;its&#160;neighbors&#160;except&#160;for&#160;the&#160;one<br/>who&#160;sent&#160;it&#160;the&#160;message.<br/>
This&#160;will&#160;cause&#160;a&#160;new&#160;piece&#160;of&#160;gossip&#160;to&#160;spread&#160;through&#160;the&#160;network&#160;like&#160;an<br/>
191<br/>
<hr/>
<a name=204></a>ink&#160;stain&#160;in&#160;water.&#160;Even&#160;when&#160;some&#160;connections&#160;aren’t&#160;currently&#160;working,&#160;if<br/>there&#160;is&#160;an&#160;alternative&#160;route&#160;to&#160;a&#160;given&#160;nest,&#160;the&#160;gossip&#160;will&#160;reach&#160;it&#160;through<br/>there.<br/>
This&#160;style&#160;of&#160;network&#160;communication&#160;is&#160;called&#160;<i>flooding</i>—it&#160;floods&#160;the&#160;network<br/>
with&#160;a&#160;piece&#160;of&#160;information&#160;until&#160;all&#160;nodes&#160;have&#160;it.<br/>
<b>Message&#160;routing</b><br/>
If&#160;a&#160;given&#160;node&#160;wants&#160;to&#160;talk&#160;to&#160;a&#160;single&#160;other&#160;node,&#160;flooding&#160;is&#160;not&#160;a&#160;very<br/>efficient&#160;approach.&#160;Especially&#160;when&#160;the&#160;network&#160;is&#160;big,&#160;that&#160;would&#160;lead&#160;to&#160;a&#160;lot<br/>of&#160;useless&#160;data&#160;transfers.<br/>
An&#160;alternative&#160;approach&#160;is&#160;to&#160;set&#160;up&#160;a&#160;way&#160;for&#160;messages&#160;to&#160;hop&#160;from&#160;node&#160;to<br/>
node&#160;until&#160;they&#160;reach&#160;their&#160;destination.&#160;The&#160;difficulty&#160;with&#160;that&#160;is&#160;it&#160;requires<br/>knowledge&#160;about&#160;the&#160;layout&#160;of&#160;the&#160;network.&#160;To&#160;send&#160;a&#160;request&#160;in&#160;the&#160;direction<br/>of&#160;a&#160;faraway&#160;nest,&#160;it&#160;is&#160;necessary&#160;to&#160;know&#160;which&#160;neighboring&#160;nest&#160;gets&#160;it&#160;closer<br/>to&#160;its&#160;destination.&#160;Sending&#160;it&#160;in&#160;the&#160;wrong&#160;direction&#160;will&#160;not&#160;do&#160;much&#160;good.<br/>
Since&#160;each&#160;nest&#160;knows&#160;only&#160;about&#160;its&#160;direct&#160;neighbors,&#160;it&#160;doesn’t&#160;have&#160;the<br/>
information&#160;it&#160;needs&#160;to&#160;compute&#160;a&#160;route.&#160;We&#160;must&#160;somehow&#160;spread&#160;the&#160;infor-<br/>mation&#160;about&#160;these&#160;connections&#160;to&#160;all&#160;nests,&#160;preferably&#160;in&#160;a&#160;way&#160;that&#160;allows&#160;it<br/>to&#160;change&#160;over&#160;time,&#160;when&#160;nests&#160;are&#160;abandoned&#160;or&#160;new&#160;nests&#160;are&#160;built.<br/>
We&#160;can&#160;use&#160;flooding&#160;again,&#160;but&#160;instead&#160;of&#160;checking&#160;whether&#160;a&#160;given&#160;message<br/>
has&#160;already&#160;been&#160;received,&#160;we&#160;now&#160;check&#160;whether&#160;the&#160;new&#160;set&#160;of&#160;neighbors&#160;for<br/>a&#160;given&#160;nest&#160;matches&#160;the&#160;current&#160;set&#160;we&#160;have&#160;for&#160;it.<br/>
requestType(&#34;connections&#34;,&#160;(nest,&#160;{name,&#160;neighbors},<br/>
source)&#160;=&gt;&#160;{<br/>
let&#160;connections&#160;=&#160;nest.state.connections;<br/>if&#160;(JSON.stringify(connections.get(name))&#160;==<br/>
JSON.stringify(neighbors))&#160;return;<br/>
connections.set(name,&#160;neighbors);<br/>broadcastConnections(nest,&#160;name,&#160;source);<br/>
});<br/>
function&#160;broadcastConnections(nest,&#160;name,&#160;exceptFor&#160;=&#160;null)&#160;{<br/>
for&#160;(let&#160;neighbor&#160;of&#160;nest.neighbors)&#160;{<br/>
if&#160;(neighbor&#160;==&#160;exceptFor)&#160;continue;<br/>request(nest,&#160;neighbor,&#160;&#34;connections&#34;,&#160;{<br/>
name,<br/>neighbors:&#160;nest.state.connections.get(name)<br/>
});<br/>
}<br/>
}<br/>
192<br/>
<hr/>
<a name=205></a>everywhere(nest&#160;=&gt;&#160;{<br/>
nest.state.connections&#160;=&#160;new&#160;Map;<br/>nest.state.connections.set(nest.name,&#160;nest.neighbors);<br/>broadcastConnections(nest,&#160;nest.name);<br/>
});<br/>
The&#160;comparison&#160;uses&#160;JSON.stringify&#160;because&#160;==,&#160;on&#160;objects&#160;or&#160;arrays,&#160;will<br/>
return&#160;true&#160;only&#160;when&#160;the&#160;two&#160;are&#160;the&#160;exact&#160;same&#160;value,&#160;which&#160;is&#160;not&#160;what<br/>we&#160;need&#160;here.&#160;Comparing&#160;the&#160;JSON&#160;strings&#160;is&#160;a&#160;crude&#160;but&#160;effective&#160;way&#160;to<br/>compare&#160;their&#160;content.<br/>
The&#160;nodes&#160;immediately&#160;start&#160;broadcasting&#160;their&#160;connections,&#160;which&#160;should,<br/>
unless&#160;some&#160;nests&#160;are&#160;completely&#160;unreachable,&#160;quickly&#160;give&#160;every&#160;nest&#160;a&#160;map&#160;of<br/>the&#160;current&#160;network&#160;graph.<br/>
A&#160;thing&#160;you&#160;can&#160;do&#160;with&#160;graphs&#160;is&#160;find&#160;routes&#160;in&#160;them,&#160;as&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#129">Chapter</a><br/>
<a href="eloquent-javascripts.html#129">7</a>.&#160;If&#160;we&#160;have&#160;a&#160;route&#160;toward&#160;a&#160;message’s&#160;destination,&#160;we&#160;know&#160;which&#160;direction<br/>to&#160;send&#160;it&#160;in.<br/>
This&#160;findRoute&#160;function,&#160;which&#160;greatly&#160;resembles&#160;the&#160;findRoute&#160;from&#160;<a href="eloquent-javascripts.html#136">Chap-</a><br/>
<a href="eloquent-javascripts.html#136">ter&#160;7</a>,&#160;searches&#160;for&#160;a&#160;way&#160;to&#160;reach&#160;a&#160;given&#160;node&#160;in&#160;the&#160;network.&#160;But&#160;instead&#160;of<br/>returning&#160;the&#160;whole&#160;route,&#160;it&#160;just&#160;returns&#160;the&#160;next&#160;step.&#160;That&#160;next&#160;nest&#160;will<br/>itself,&#160;using&#160;its&#160;current&#160;information&#160;about&#160;the&#160;network,&#160;decide&#160;where&#160;<i>it&#160;</i>sends<br/>the&#160;message.<br/>
function&#160;findRoute(from,&#160;to,&#160;connections)&#160;{<br/>
let&#160;work&#160;=&#160;[{at:&#160;from,&#160;via:&#160;null}];<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;work.length;&#160;i++)&#160;{<br/>
let&#160;{at,&#160;via}&#160;=&#160;work[i];<br/>for&#160;(let&#160;next&#160;of&#160;connections.get(at)&#160;||&#160;[])&#160;{<br/>
if&#160;(next&#160;==&#160;to)&#160;return&#160;via;<br/>if&#160;(!work.some(w&#160;=&gt;&#160;w.at&#160;==&#160;next))&#160;{<br/>
work.push({at:&#160;next,&#160;via:&#160;via&#160;||&#160;next});<br/>
}<br/>
}<br/>
}<br/>return&#160;null;<br/>
}<br/>
Now&#160;we&#160;can&#160;build&#160;a&#160;function&#160;that&#160;can&#160;send&#160;long-distance&#160;messages.&#160;If&#160;the<br/>
message&#160;is&#160;addressed&#160;to&#160;a&#160;direct&#160;neighbor,&#160;it&#160;is&#160;delivered&#160;as&#160;usual.&#160;If&#160;not,&#160;it&#160;is<br/>packaged&#160;in&#160;an&#160;object&#160;and&#160;sent&#160;to&#160;a&#160;neighbor&#160;that&#160;is&#160;closer&#160;to&#160;the&#160;target,&#160;using<br/>the&#160;&#34;route&#34;&#160;request&#160;type,&#160;which&#160;will&#160;cause&#160;that&#160;neighbor&#160;to&#160;repeat&#160;the&#160;same<br/>
193<br/>
<hr/>
<a name=206></a>behavior.<br/>
function&#160;routeRequest(nest,&#160;target,&#160;type,&#160;content)&#160;{<br/>
if&#160;(nest.neighbors.includes(target))&#160;{<br/>
return&#160;request(nest,&#160;target,&#160;type,&#160;content);<br/>
}&#160;else&#160;{<br/>
let&#160;via&#160;=&#160;findRoute(nest.name,&#160;target,<br/>
nest.state.connections);<br/>
if&#160;(!via)&#160;throw&#160;new&#160;Error(`No&#160;route&#160;to&#160;${target}`);<br/>return&#160;request(nest,&#160;via,&#160;&#34;route&#34;,<br/>
{target,&#160;type,&#160;content});<br/>
}<br/>
}<br/>
requestType(&#34;route&#34;,&#160;(nest,&#160;{target,&#160;type,&#160;content})&#160;=&gt;&#160;{<br/>
return&#160;routeRequest(nest,&#160;target,&#160;type,&#160;content);<br/>
});<br/>
We’ve&#160;constructed&#160;several&#160;layers&#160;of&#160;functionality&#160;on&#160;top&#160;of&#160;a&#160;primitive&#160;com-<br/>
munication&#160;system&#160;to&#160;make&#160;it&#160;convenient&#160;to&#160;use.&#160;This&#160;is&#160;a&#160;nice&#160;(though&#160;sim-<br/>plified)&#160;model&#160;of&#160;how&#160;real&#160;computer&#160;networks&#160;work.<br/>
A&#160;distinguishing&#160;property&#160;of&#160;computer&#160;networks&#160;is&#160;that&#160;they&#160;aren’t&#160;reliable—<br/>
abstractions&#160;built&#160;on&#160;top&#160;of&#160;them&#160;can&#160;help,&#160;but&#160;you&#160;can’t&#160;abstract&#160;away&#160;network<br/>failure.&#160;So&#160;network&#160;programming&#160;is&#160;typically&#160;very&#160;much&#160;about&#160;anticipating&#160;and<br/>dealing&#160;with&#160;failures.<br/>
<b>Async&#160;functions</b><br/>
To&#160;store&#160;important&#160;information,&#160;crows&#160;are&#160;known&#160;to&#160;duplicate&#160;it&#160;across&#160;nests.<br/>That&#160;way,&#160;when&#160;a&#160;hawk&#160;destroys&#160;a&#160;nest,&#160;the&#160;information&#160;isn’t&#160;lost.<br/>
To&#160;retrieve&#160;a&#160;given&#160;piece&#160;of&#160;information&#160;that&#160;it&#160;doesn’t&#160;have&#160;in&#160;its&#160;own&#160;storage<br/>
bulb,&#160;a&#160;nest&#160;computer&#160;might&#160;consult&#160;random&#160;other&#160;nests&#160;in&#160;the&#160;network&#160;until<br/>it&#160;finds&#160;one&#160;that&#160;has&#160;it.<br/>
requestType(&#34;storage&#34;,&#160;(nest,&#160;name)&#160;=&gt;&#160;storage(nest,&#160;name));<br/>
function&#160;findInStorage(nest,&#160;name)&#160;{<br/>
return&#160;storage(nest,&#160;name).then(found&#160;=&gt;&#160;{<br/>
if&#160;(found&#160;!=&#160;null)&#160;return&#160;found;<br/>else&#160;return&#160;findInRemoteStorage(nest,&#160;name);<br/>
});<br/>
}<br/>
194<br/>
<hr/>
<a name=207></a>function&#160;network(nest)&#160;{<br/>
return&#160;Array.from(nest.state.connections.keys());<br/>
}<br/>
function&#160;findInRemoteStorage(nest,&#160;name)&#160;{<br/>
let&#160;sources&#160;=&#160;network(nest).filter(n&#160;=&gt;&#160;n&#160;!=&#160;nest.name);<br/>function&#160;next()&#160;{<br/>
if&#160;(sources.length&#160;==&#160;0)&#160;{<br/>
return&#160;Promise.reject(new&#160;Error(&#34;Not&#160;found&#34;));<br/>
}&#160;else&#160;{<br/>
let&#160;source&#160;=&#160;sources[Math.floor(Math.random()&#160;*<br/>
sources.length)];<br/>
sources&#160;=&#160;sources.filter(n&#160;=&gt;&#160;n&#160;!=&#160;source);<br/>return&#160;routeRequest(nest,&#160;source,&#160;&#34;storage&#34;,&#160;name)<br/>
.then(value&#160;=&gt;&#160;value&#160;!=&#160;null&#160;?&#160;value&#160;:&#160;next(),<br/>
next);<br/>
}<br/>
}<br/>return&#160;next();<br/>
}<br/>
Because&#160;connections&#160;is&#160;a&#160;Map,&#160;Object.keys&#160;doesn’t&#160;work&#160;on&#160;it.&#160;It&#160;has&#160;a&#160;keys<br/>
<i>method</i>,&#160;but&#160;that&#160;returns&#160;an&#160;iterator&#160;rather&#160;than&#160;an&#160;array.&#160;An&#160;iterator&#160;(or<br/>iterable&#160;value)&#160;can&#160;be&#160;converted&#160;to&#160;an&#160;array&#160;with&#160;the&#160;Array.from&#160;function.<br/>
Even&#160;with&#160;promises&#160;this&#160;is&#160;some&#160;rather&#160;awkward&#160;code.&#160;Multiple&#160;asynchronous<br/>
actions&#160;are&#160;chained&#160;together&#160;in&#160;non-obvious&#160;ways.&#160;We&#160;again&#160;need&#160;a&#160;recursive<br/>function&#160;(next)&#160;to&#160;model&#160;looping&#160;through&#160;the&#160;nests.<br/>
And&#160;the&#160;thing&#160;the&#160;code&#160;actually&#160;does&#160;is&#160;completely&#160;linear—it&#160;always&#160;waits&#160;for<br/>
the&#160;previous&#160;action&#160;to&#160;complete&#160;before&#160;starting&#160;the&#160;next&#160;one.&#160;In&#160;a&#160;synchronous<br/>programming&#160;model,&#160;it’d&#160;be&#160;simpler&#160;to&#160;express.<br/>
The&#160;good&#160;news&#160;is&#160;that&#160;JavaScript&#160;allows&#160;you&#160;to&#160;write&#160;pseudo-synchronous<br/>
code&#160;to&#160;describe&#160;asynchronous&#160;computation.&#160;An&#160;async&#160;function&#160;is&#160;a&#160;function<br/>that&#160;implicitly&#160;returns&#160;a&#160;promise&#160;and&#160;that&#160;can,&#160;in&#160;its&#160;body,&#160;await&#160;other&#160;promises<br/>in&#160;a&#160;way&#160;that&#160;<i>looks&#160;</i>synchronous.<br/>
We&#160;can&#160;rewrite&#160;findInStorage&#160;like&#160;this:<br/>
async&#160;function&#160;findInStorage(nest,&#160;name)&#160;{<br/>
let&#160;local&#160;=&#160;await&#160;storage(nest,&#160;name);<br/>if&#160;(local&#160;!=&#160;null)&#160;return&#160;local;<br/>
let&#160;sources&#160;=&#160;network(nest).filter(n&#160;=&gt;&#160;n&#160;!=&#160;nest.name);<br/>while&#160;(sources.length&#160;&gt;&#160;0)&#160;{<br/>
let&#160;source&#160;=&#160;sources[Math.floor(Math.random()&#160;*<br/>
195<br/>
<hr/>
<a name=208></a>sources.length)];<br/>
sources&#160;=&#160;sources.filter(n&#160;=&gt;&#160;n&#160;!=&#160;source);<br/>try&#160;{<br/>
let&#160;found&#160;=&#160;await&#160;routeRequest(nest,&#160;source,&#160;&#34;storage&#34;,<br/>
name);<br/>
if&#160;(found&#160;!=&#160;null)&#160;return&#160;found;<br/>
}&#160;catch&#160;(_)&#160;{}<br/>
}<br/>throw&#160;new&#160;Error(&#34;Not&#160;found&#34;);<br/>
}<br/>
An&#160;async&#160;function&#160;is&#160;marked&#160;by&#160;the&#160;word&#160;async&#160;before&#160;the&#160;function&#160;keyword.<br/>
Methods&#160;can&#160;also&#160;be&#160;made&#160;async&#160;by&#160;writing&#160;async&#160;before&#160;their&#160;name.&#160;When<br/>such&#160;a&#160;function&#160;or&#160;method&#160;is&#160;called,&#160;it&#160;returns&#160;a&#160;promise.&#160;As&#160;soon&#160;as&#160;the&#160;body<br/>returns&#160;something,&#160;that&#160;promise&#160;is&#160;resolved.&#160;If&#160;it&#160;throws&#160;an&#160;exception,&#160;the<br/>promise&#160;is&#160;rejected.<br/>
Inside&#160;an&#160;async&#160;function,&#160;the&#160;word&#160;await&#160;can&#160;be&#160;put&#160;in&#160;front&#160;of&#160;an&#160;expression<br/>
to&#160;wait&#160;for&#160;a&#160;promise&#160;to&#160;resolve&#160;and&#160;only&#160;then&#160;continue&#160;the&#160;execution&#160;of&#160;the<br/>function.<br/>
Such&#160;a&#160;function&#160;no&#160;longer,&#160;like&#160;a&#160;regular&#160;JavaScript&#160;function,&#160;runs&#160;from&#160;start<br/>
to&#160;completion&#160;in&#160;one&#160;go.&#160;Instead,&#160;it&#160;can&#160;be&#160;<i>frozen&#160;</i>at&#160;any&#160;point&#160;that&#160;has&#160;an<br/>await,&#160;and&#160;can&#160;be&#160;resumed&#160;at&#160;a&#160;later&#160;time.<br/>
For&#160;non-trivial&#160;asynchronous&#160;code,&#160;this&#160;notation&#160;is&#160;usually&#160;more&#160;convenient<br/>
than&#160;directly&#160;using&#160;promises.&#160;Even&#160;if&#160;you&#160;need&#160;to&#160;do&#160;something&#160;that&#160;doesn’t<br/>fit&#160;the&#160;synchronous&#160;model,&#160;such&#160;as&#160;perform&#160;multiple&#160;actions&#160;at&#160;the&#160;same&#160;time,<br/>it&#160;is&#160;easy&#160;to&#160;combine&#160;await&#160;with&#160;the&#160;direct&#160;use&#160;of&#160;promises.<br/>
<b>Generators</b><br/>
This&#160;ability&#160;of&#160;functions&#160;to&#160;be&#160;paused&#160;and&#160;then&#160;resumed&#160;again&#160;is&#160;not&#160;exclusive<br/>to&#160;async&#160;functions.&#160;JavaScript&#160;also&#160;has&#160;a&#160;feature&#160;called&#160;<i>generator&#160;</i>functions.<br/>These&#160;are&#160;similar,&#160;but&#160;without&#160;the&#160;promises.<br/>
When&#160;you&#160;define&#160;a&#160;function&#160;with&#160;function*&#160;(placing&#160;an&#160;asterisk&#160;after&#160;the<br/>
word&#160;function),&#160;it&#160;becomes&#160;a&#160;generator.&#160;When&#160;you&#160;call&#160;a&#160;generator,&#160;it&#160;returns<br/>an&#160;iterator,&#160;which&#160;we&#160;already&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#109">Chapter&#160;6.</a><br/>
function*&#160;powers(n)&#160;{<br/>
for&#160;(let&#160;current&#160;=&#160;n;;&#160;current&#160;*=&#160;n)&#160;{<br/>
yield&#160;current;<br/>
}<br/>
}<br/>
196<br/>
<hr/>
<a name=209></a>for&#160;(let&#160;power&#160;of&#160;powers(3))&#160;{<br/>
if&#160;(power&#160;&gt;&#160;50)&#160;break;<br/>console.log(power);<br/>
}<br/>//&#160;→&#160;3<br/>//&#160;→&#160;9<br/>//&#160;→&#160;27<br/>
Initially,&#160;when&#160;you&#160;call&#160;powers,&#160;the&#160;function&#160;is&#160;frozen&#160;at&#160;its&#160;start.&#160;Every&#160;time<br/>
you&#160;call&#160;next&#160;on&#160;the&#160;iterator,&#160;the&#160;function&#160;runs&#160;until&#160;it&#160;hits&#160;a&#160;yield&#160;expression,<br/>which&#160;pauses&#160;it&#160;and&#160;causes&#160;the&#160;yielded&#160;value&#160;to&#160;become&#160;the&#160;next&#160;value&#160;produced<br/>by&#160;the&#160;iterator.&#160;When&#160;the&#160;function&#160;returns&#160;(the&#160;one&#160;in&#160;the&#160;example&#160;never&#160;does),<br/>the&#160;iterator&#160;is&#160;done.<br/>
Writing&#160;iterators&#160;is&#160;often&#160;much&#160;easier&#160;when&#160;you&#160;use&#160;generator&#160;functions.&#160;The<br/>
iterator&#160;for&#160;the&#160;Group&#160;class&#160;(from&#160;the&#160;exercise&#160;in&#160;<a href="eloquent-javascripts.html#127">Chapter&#160;6</a>)&#160;can&#160;be&#160;written&#160;with<br/>this&#160;generator:<br/>
Group.prototype[Symbol.iterator]&#160;=&#160;function*()&#160;{<br/>
for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;this.members.length;&#160;i++)&#160;{<br/>
yield&#160;this.members[i];<br/>
}<br/>
};<br/>
There’s&#160;no&#160;longer&#160;a&#160;need&#160;to&#160;create&#160;an&#160;object&#160;to&#160;hold&#160;the&#160;iteration&#160;state—<br/>
generators&#160;automatically&#160;save&#160;their&#160;local&#160;state&#160;every&#160;time&#160;they&#160;yield.<br/>
Such&#160;yield&#160;expressions&#160;may&#160;occur&#160;only&#160;directly&#160;in&#160;the&#160;generator&#160;function<br/>
itself&#160;and&#160;not&#160;in&#160;an&#160;inner&#160;function&#160;you&#160;define&#160;inside&#160;of&#160;it.&#160;The&#160;state&#160;a&#160;generator<br/>saves,&#160;when&#160;yielding,&#160;is&#160;only&#160;its&#160;<i>local&#160;</i>environment&#160;and&#160;the&#160;position&#160;where&#160;it<br/>yielded.<br/>
An&#160;async&#160;function&#160;is&#160;a&#160;special&#160;type&#160;of&#160;generator.&#160;It&#160;produces&#160;a&#160;promise&#160;when<br/>
called,&#160;which&#160;is&#160;resolved&#160;when&#160;it&#160;returns&#160;(finishes)&#160;and&#160;rejected&#160;when&#160;it&#160;throws<br/>an&#160;exception.&#160;Whenever&#160;it&#160;yields&#160;(awaits)&#160;a&#160;promise,&#160;the&#160;result&#160;of&#160;that&#160;promise<br/>(value&#160;or&#160;thrown&#160;exception)&#160;is&#160;the&#160;result&#160;of&#160;the&#160;await&#160;expression.<br/>
<b>The&#160;event&#160;loop</b><br/>
Asynchronous&#160;programs&#160;are&#160;executed&#160;piece&#160;by&#160;piece.&#160;Each&#160;piece&#160;may&#160;start&#160;some<br/>actions&#160;and&#160;schedule&#160;code&#160;to&#160;be&#160;executed&#160;when&#160;the&#160;action&#160;finishes&#160;or&#160;fails.&#160;In<br/>between&#160;these&#160;pieces,&#160;the&#160;program&#160;sits&#160;idle,&#160;waiting&#160;for&#160;the&#160;next&#160;action.<br/>
197<br/>
<hr/>
<a name=210></a>So&#160;callbacks&#160;are&#160;not&#160;directly&#160;called&#160;by&#160;the&#160;code&#160;that&#160;scheduled&#160;them.&#160;If&#160;I<br/>
call&#160;setTimeout&#160;from&#160;within&#160;a&#160;function,&#160;that&#160;function&#160;will&#160;have&#160;returned&#160;by&#160;the<br/>time&#160;the&#160;callback&#160;function&#160;is&#160;called.&#160;And&#160;when&#160;the&#160;callback&#160;returns,&#160;control<br/>does&#160;not&#160;go&#160;back&#160;to&#160;the&#160;function&#160;that&#160;scheduled&#160;it.<br/>
Asynchronous&#160;behavior&#160;happens&#160;on&#160;its&#160;own&#160;empty&#160;function&#160;call&#160;stack.&#160;This<br/>
is&#160;one&#160;of&#160;the&#160;reasons&#160;that,&#160;without&#160;promises,&#160;managing&#160;exceptions&#160;across&#160;asyn-<br/>chronous&#160;code&#160;is&#160;hard.&#160;Since&#160;each&#160;callback&#160;starts&#160;with&#160;a&#160;mostly&#160;empty&#160;stack,<br/>your&#160;catch&#160;handlers&#160;won’t&#160;be&#160;on&#160;the&#160;stack&#160;when&#160;they&#160;throw&#160;an&#160;exception.<br/>
try&#160;{<br/>
setTimeout(()&#160;=&gt;&#160;{<br/>
throw&#160;new&#160;Error(&#34;Woosh&#34;);<br/>
},&#160;20);<br/>
}&#160;catch&#160;(_)&#160;{<br/>
//&#160;This&#160;will&#160;not&#160;run<br/>console.log(&#34;Caught!&#34;);<br/>
}<br/>
No&#160;matter&#160;how&#160;closely&#160;together&#160;events—such&#160;as&#160;timeouts&#160;or&#160;incoming&#160;requests—<br/>
happen,&#160;a&#160;JavaScript&#160;environment&#160;will&#160;run&#160;only&#160;one&#160;program&#160;at&#160;a&#160;time.&#160;You<br/>can&#160;think&#160;of&#160;this&#160;as&#160;it&#160;running&#160;a&#160;big&#160;loop&#160;<i>around&#160;</i>your&#160;program,&#160;called&#160;the&#160;<i>event<br/>loop</i>.&#160;When&#160;there’s&#160;nothing&#160;to&#160;be&#160;done,&#160;that&#160;loop&#160;is&#160;stopped.&#160;But&#160;as&#160;events<br/>come&#160;in,&#160;they&#160;are&#160;added&#160;to&#160;a&#160;queue,&#160;and&#160;their&#160;code&#160;is&#160;executed&#160;one&#160;after&#160;the<br/>other.&#160;Because&#160;no&#160;two&#160;things&#160;run&#160;at&#160;the&#160;same&#160;time,&#160;slow-running&#160;code&#160;might<br/>delay&#160;the&#160;handling&#160;of&#160;other&#160;events.<br/>
This&#160;example&#160;sets&#160;a&#160;timeout&#160;but&#160;then&#160;dallies&#160;until&#160;after&#160;the&#160;timeout’s&#160;in-<br/>
tended&#160;point&#160;of&#160;time,&#160;causing&#160;the&#160;timeout&#160;to&#160;be&#160;late.<br/>
let&#160;start&#160;=&#160;Date.now();<br/>setTimeout(()&#160;=&gt;&#160;{<br/>
console.log(&#34;Timeout&#160;ran&#160;at&#34;,&#160;Date.now()&#160;-&#160;start);<br/>
},&#160;20);<br/>while&#160;(Date.now()&#160;&lt;&#160;start&#160;+&#160;50)&#160;{}<br/>console.log(&#34;Wasted&#160;time&#160;until&#34;,&#160;Date.now()&#160;-&#160;start);<br/>//&#160;→&#160;Wasted&#160;time&#160;until&#160;50<br/>//&#160;→&#160;Timeout&#160;ran&#160;at&#160;55<br/>
Promises&#160;always&#160;resolve&#160;or&#160;reject&#160;as&#160;a&#160;new&#160;event.&#160;Even&#160;if&#160;a&#160;promise&#160;is&#160;already<br/>
resolved,&#160;waiting&#160;for&#160;it&#160;will&#160;cause&#160;your&#160;callback&#160;to&#160;run&#160;after&#160;the&#160;current&#160;script<br/>finishes,&#160;rather&#160;than&#160;right&#160;away.<br/>
Promise.resolve(&#34;Done&#34;).then(console.log);<br/>
198<br/>
<hr/>
<a name=211></a>console.log(&#34;Me&#160;first!&#34;);<br/>//&#160;→&#160;Me&#160;first!<br/>//&#160;→&#160;Done<br/>
In&#160;later&#160;chapters&#160;we’ll&#160;see&#160;various&#160;other&#160;types&#160;of&#160;events&#160;that&#160;run&#160;on&#160;the&#160;event<br/>
loop.<br/>
<b>Asynchronous&#160;bugs</b><br/>
When&#160;your&#160;program&#160;runs&#160;synchronously,&#160;in&#160;a&#160;single&#160;go,&#160;there&#160;are&#160;no&#160;state<br/>changes&#160;happening&#160;except&#160;those&#160;that&#160;the&#160;program&#160;itself&#160;makes.&#160;For&#160;asyn-<br/>chronous&#160;programs&#160;this&#160;is&#160;different—they&#160;may&#160;have&#160;<i>gaps&#160;</i>in&#160;their&#160;execution<br/>during&#160;which&#160;other&#160;code&#160;can&#160;run.<br/>
Let’s&#160;look&#160;at&#160;an&#160;example.&#160;One&#160;of&#160;the&#160;hobbies&#160;of&#160;our&#160;crows&#160;is&#160;to&#160;count&#160;the<br/>
number&#160;of&#160;chicks&#160;that&#160;hatch&#160;throughout&#160;the&#160;village&#160;every&#160;year.&#160;Nests&#160;store&#160;this<br/>count&#160;in&#160;their&#160;storage&#160;bulbs.&#160;The&#160;following&#160;code&#160;tries&#160;to&#160;enumerate&#160;the&#160;counts<br/>from&#160;all&#160;the&#160;nests&#160;for&#160;a&#160;given&#160;year:<br/>
function&#160;anyStorage(nest,&#160;source,&#160;name)&#160;{<br/>
if&#160;(source&#160;==&#160;nest.name)&#160;return&#160;storage(nest,&#160;name);<br/>else&#160;return&#160;routeRequest(nest,&#160;source,&#160;&#34;storage&#34;,&#160;name);<br/>
}<br/>
async&#160;function&#160;chicks(nest,&#160;year)&#160;{<br/>
let&#160;list&#160;=&#160;&#34;&#34;;<br/>await&#160;Promise.all(network(nest).map(async&#160;name&#160;=&gt;&#160;{<br/>
list&#160;+=&#160;`${name}:&#160;${<br/>
await&#160;anyStorage(nest,&#160;name,&#160;`chicks&#160;in&#160;${year}`)<br/>
}\n`;<br/>
}));<br/>return&#160;list;<br/>
}<br/>
The&#160;async&#160;name&#160;=&gt;&#160;part&#160;shows&#160;that&#160;arrow&#160;functions&#160;can&#160;also&#160;be&#160;made&#160;async<br/>
by&#160;putting&#160;the&#160;word&#160;async&#160;in&#160;front&#160;of&#160;them.<br/>
The&#160;code&#160;doesn’t&#160;immediately&#160;look&#160;suspicious...it&#160;maps&#160;the&#160;async&#160;arrow&#160;func-<br/>
tion&#160;over&#160;the&#160;set&#160;of&#160;nests,&#160;creating&#160;an&#160;array&#160;of&#160;promises,&#160;and&#160;then&#160;uses&#160;Promise<br/>.all&#160;to&#160;wait&#160;for&#160;all&#160;of&#160;these&#160;before&#160;returning&#160;the&#160;list&#160;they&#160;build&#160;up.<br/>
But&#160;it&#160;is&#160;seriously&#160;broken.&#160;It’ll&#160;always&#160;return&#160;only&#160;a&#160;single&#160;line&#160;of&#160;output,<br/>
listing&#160;the&#160;nest&#160;that&#160;was&#160;slowest&#160;to&#160;respond.<br/>
Can&#160;you&#160;work&#160;out&#160;why?<br/>
199<br/>
<hr/>
<a name=212></a>The&#160;problem&#160;lies&#160;in&#160;the&#160;+=&#160;operator,&#160;which&#160;takes&#160;the&#160;<i>current&#160;</i>value&#160;of&#160;list<br/>
at&#160;the&#160;time&#160;where&#160;the&#160;statement&#160;starts&#160;executing&#160;and&#160;then,&#160;when&#160;the&#160;await<br/>finishes,&#160;sets&#160;the&#160;list&#160;binding&#160;to&#160;be&#160;that&#160;value&#160;plus&#160;the&#160;added&#160;string.<br/>
But&#160;between&#160;the&#160;time&#160;where&#160;the&#160;statement&#160;starts&#160;executing&#160;and&#160;the&#160;time<br/>
where&#160;it&#160;finishes&#160;there’s&#160;an&#160;asynchronous&#160;gap.&#160;The&#160;map&#160;expression&#160;runs&#160;before<br/>anything&#160;has&#160;been&#160;added&#160;to&#160;the&#160;list,&#160;so&#160;each&#160;of&#160;the&#160;+=&#160;operators&#160;starts&#160;from&#160;an<br/>empty&#160;string&#160;and&#160;ends&#160;up,&#160;when&#160;its&#160;storage&#160;retrieval&#160;finishes,&#160;setting&#160;list&#160;to&#160;a<br/>single-line&#160;list—the&#160;result&#160;of&#160;adding&#160;its&#160;line&#160;to&#160;the&#160;empty&#160;string.<br/>
This&#160;could&#160;have&#160;easily&#160;been&#160;avoided&#160;by&#160;returning&#160;the&#160;lines&#160;from&#160;the&#160;mapped<br/>
promises&#160;and&#160;calling&#160;join&#160;on&#160;the&#160;result&#160;of&#160;Promise.all,&#160;instead&#160;of&#160;building<br/>up&#160;the&#160;list&#160;by&#160;changing&#160;a&#160;binding.&#160;As&#160;usual,&#160;computing&#160;new&#160;values&#160;is&#160;less<br/>error-prone&#160;than&#160;changing&#160;existing&#160;values.<br/>
async&#160;function&#160;chicks(nest,&#160;year)&#160;{<br/>
let&#160;lines&#160;=&#160;network(nest).map(async&#160;name&#160;=&gt;&#160;{<br/>
return&#160;name&#160;+&#160;&#34;:&#160;&#34;&#160;+<br/>
await&#160;anyStorage(nest,&#160;name,&#160;`chicks&#160;in&#160;${year}`);<br/>
});<br/>return&#160;(await&#160;Promise.all(lines)).join(&#34;\n&#34;);<br/>
}<br/>
Mistakes&#160;like&#160;this&#160;are&#160;easy&#160;to&#160;make,&#160;especially&#160;when&#160;using&#160;await,&#160;and&#160;you<br/>
should&#160;be&#160;aware&#160;of&#160;where&#160;the&#160;gaps&#160;in&#160;your&#160;code&#160;occur.&#160;An&#160;advantage&#160;of<br/>JavaScript’s&#160;<i>explicit&#160;</i>asynchronicity&#160;(whether&#160;through&#160;callbacks,&#160;promises,&#160;or<br/>await)&#160;is&#160;that&#160;spotting&#160;these&#160;gaps&#160;is&#160;relatively&#160;easy.<br/>
<b>Summary</b><br/>
Asynchronous&#160;programming&#160;makes&#160;it&#160;possible&#160;to&#160;express&#160;waiting&#160;for&#160;long-<br/>running&#160;actions&#160;without&#160;freezing&#160;the&#160;program&#160;during&#160;these&#160;actions.&#160;JavaScript<br/>environments&#160;typically&#160;implement&#160;this&#160;style&#160;of&#160;programming&#160;using&#160;callbacks,<br/>functions&#160;that&#160;are&#160;called&#160;when&#160;the&#160;actions&#160;complete.&#160;An&#160;event&#160;loop&#160;schedules<br/>such&#160;callbacks&#160;to&#160;be&#160;called&#160;when&#160;appropriate,&#160;one&#160;after&#160;the&#160;other,&#160;so&#160;that&#160;their<br/>execution&#160;does&#160;not&#160;overlap.<br/>
Programming&#160;asynchronously&#160;is&#160;made&#160;easier&#160;by&#160;promises,&#160;objects&#160;that&#160;rep-<br/>
resent&#160;actions&#160;that&#160;might&#160;complete&#160;in&#160;the&#160;future,&#160;and&#160;async&#160;functions,&#160;which<br/>allow&#160;you&#160;to&#160;write&#160;an&#160;asynchronous&#160;program&#160;as&#160;if&#160;it&#160;were&#160;synchronous.<br/>
200<br/>
<hr/>
<a name=213></a><b>Exercises</b><br/>
<b>Tracking&#160;the&#160;scalpel</b><br/>
The&#160;village&#160;crows&#160;own&#160;an&#160;old&#160;scalpel&#160;that&#160;they&#160;occasionally&#160;use&#160;on&#160;special<br/>missions—say,&#160;to&#160;cut&#160;through&#160;screen&#160;doors&#160;or&#160;packaging.&#160;To&#160;be&#160;able&#160;to&#160;quickly<br/>track&#160;it&#160;down,&#160;every&#160;time&#160;the&#160;scalpel&#160;is&#160;moved&#160;to&#160;another&#160;nest,&#160;an&#160;entry&#160;is<br/>added&#160;to&#160;the&#160;storage&#160;of&#160;both&#160;the&#160;nest&#160;that&#160;had&#160;it&#160;and&#160;the&#160;nest&#160;that&#160;took&#160;it,<br/>under&#160;the&#160;name&#160;&#34;scalpel&#34;,&#160;with&#160;its&#160;new&#160;location&#160;as&#160;the&#160;value.<br/>
This&#160;means&#160;that&#160;finding&#160;the&#160;scalpel&#160;is&#160;a&#160;matter&#160;of&#160;following&#160;the&#160;breadcrumb<br/>
trail&#160;of&#160;storage&#160;entries,&#160;until&#160;you&#160;find&#160;a&#160;nest&#160;where&#160;that&#160;points&#160;at&#160;the&#160;nest&#160;itself.<br/>
Write&#160;an&#160;async&#160;function&#160;locateScalpel&#160;that&#160;does&#160;this,&#160;starting&#160;at&#160;the&#160;nest<br/>
on&#160;which&#160;it&#160;runs.&#160;You&#160;can&#160;use&#160;the&#160;anyStorage&#160;function&#160;defined&#160;earlier&#160;to&#160;access<br/>storage&#160;in&#160;arbitrary&#160;nests.&#160;The&#160;scalpel&#160;has&#160;been&#160;going&#160;around&#160;long&#160;enough&#160;that<br/>you&#160;may&#160;assume&#160;that&#160;every&#160;nest&#160;has&#160;a&#160;&#34;scalpel&#34;&#160;entry&#160;in&#160;its&#160;data&#160;storage.<br/>
Next,&#160;write&#160;the&#160;same&#160;function&#160;again&#160;without&#160;using&#160;async&#160;and&#160;await.<br/>Do&#160;request&#160;failures&#160;properly&#160;show&#160;up&#160;as&#160;rejections&#160;of&#160;the&#160;returned&#160;promise<br/>
in&#160;both&#160;versions?&#160;How?<br/>
<b>Building&#160;Promise.all</b><br/>
Given&#160;an&#160;array&#160;of&#160;promises,&#160;Promise.all&#160;returns&#160;a&#160;promise&#160;that&#160;waits&#160;for&#160;all&#160;of<br/>the&#160;promises&#160;in&#160;the&#160;array&#160;to&#160;finish.&#160;It&#160;then&#160;succeeds,&#160;yielding&#160;an&#160;array&#160;of&#160;result<br/>values.&#160;If&#160;a&#160;promise&#160;in&#160;the&#160;array&#160;fails,&#160;the&#160;promise&#160;returned&#160;by&#160;all&#160;fails&#160;too,<br/>with&#160;the&#160;failure&#160;reason&#160;from&#160;the&#160;failing&#160;promise.<br/>
Implement&#160;something&#160;like&#160;this&#160;yourself&#160;as&#160;a&#160;regular&#160;function&#160;called&#160;Promise_all<br/>
.<br/>
Remember&#160;that&#160;after&#160;a&#160;promise&#160;has&#160;succeeded&#160;or&#160;failed,&#160;it&#160;can’t&#160;succeed&#160;or<br/>
fail&#160;again,&#160;and&#160;further&#160;calls&#160;to&#160;the&#160;functions&#160;that&#160;resolve&#160;it&#160;are&#160;ignored.&#160;This<br/>can&#160;simplify&#160;the&#160;way&#160;you&#160;handle&#160;failure&#160;of&#160;your&#160;promise.<br/>
201<br/>
<hr/>
<a name=214></a><i>“The&#160;evaluator,&#160;which&#160;determines&#160;the&#160;meaning&#160;of&#160;expressions&#160;in&#160;a</i><br/>
<i>programming&#160;language,&#160;is&#160;just&#160;another&#160;program.”<br/></i>—Hal&#160;Abelson&#160;and&#160;Gerald&#160;Sussman,&#160;Structure&#160;and&#160;Interpretation&#160;of<br/>
Computer&#160;Programs<br/>
<b>Chapter&#160;12<br/>Project:&#160;A&#160;Programming&#160;Language</b><br/>
Building&#160;your&#160;own&#160;programming&#160;language&#160;is&#160;surprisingly&#160;easy&#160;(as&#160;long&#160;as&#160;you<br/>do&#160;not&#160;aim&#160;too&#160;high)&#160;and&#160;very&#160;enlightening.<br/>
The&#160;main&#160;thing&#160;I&#160;want&#160;to&#160;show&#160;in&#160;this&#160;chapter&#160;is&#160;that&#160;there&#160;is&#160;no&#160;magic<br/>
involved&#160;in&#160;building&#160;your&#160;own&#160;language.&#160;I’ve&#160;often&#160;felt&#160;that&#160;some&#160;human&#160;in-<br/>ventions&#160;were&#160;so&#160;immensely&#160;clever&#160;and&#160;complicated&#160;that&#160;I’d&#160;never&#160;be&#160;able&#160;to<br/>understand&#160;them.&#160;But&#160;with&#160;a&#160;little&#160;reading&#160;and&#160;experimenting,&#160;they&#160;often&#160;turn<br/>out&#160;to&#160;be&#160;quite&#160;mundane.<br/>
We&#160;will&#160;build&#160;a&#160;programming&#160;language&#160;called&#160;Egg.&#160;It&#160;will&#160;be&#160;a&#160;tiny,&#160;simple<br/>
language—but&#160;one&#160;that&#160;is&#160;powerful&#160;enough&#160;to&#160;express&#160;any&#160;computation&#160;you<br/>can&#160;think&#160;of.&#160;It&#160;will&#160;allow&#160;simple&#160;abstraction&#160;based&#160;on&#160;functions.<br/>
<b>Parsing</b><br/>
The&#160;most&#160;immediately&#160;visible&#160;part&#160;of&#160;a&#160;programming&#160;language&#160;is&#160;its&#160;<i>syntax</i>,&#160;or<br/>notation.&#160;A&#160;<i>parser&#160;</i>is&#160;a&#160;program&#160;that&#160;reads&#160;a&#160;piece&#160;of&#160;text&#160;and&#160;produces&#160;a&#160;data<br/>structure&#160;that&#160;reflects&#160;the&#160;structure&#160;of&#160;the&#160;program&#160;contained&#160;in&#160;that&#160;text.&#160;If<br/>the&#160;text&#160;does&#160;not&#160;form&#160;a&#160;valid&#160;program,&#160;the&#160;parser&#160;should&#160;point&#160;out&#160;the&#160;error.<br/>
Our&#160;language&#160;will&#160;have&#160;a&#160;simple&#160;and&#160;uniform&#160;syntax.&#160;Everything&#160;in&#160;Egg&#160;is&#160;an<br/>
expression.&#160;An&#160;expression&#160;can&#160;be&#160;the&#160;name&#160;of&#160;a&#160;binding,&#160;a&#160;number,&#160;a&#160;string,&#160;or<br/>an&#160;<i>application</i>.&#160;Applications&#160;are&#160;used&#160;for&#160;function&#160;calls&#160;but&#160;also&#160;for&#160;constructs<br/>such&#160;as&#160;if&#160;or&#160;while.<br/>
To&#160;keep&#160;the&#160;parser&#160;simple,&#160;strings&#160;in&#160;Egg&#160;do&#160;not&#160;support&#160;anything&#160;like&#160;back-<br/>
slash&#160;escapes.&#160;A&#160;string&#160;is&#160;simply&#160;a&#160;sequence&#160;of&#160;characters&#160;that&#160;are&#160;not&#160;double<br/>quotes,&#160;wrapped&#160;in&#160;double&#160;quotes.&#160;A&#160;number&#160;is&#160;a&#160;sequence&#160;of&#160;digits.&#160;Binding<br/>names&#160;can&#160;consist&#160;of&#160;any&#160;character&#160;that&#160;is&#160;not&#160;whitespace&#160;and&#160;that&#160;does&#160;not<br/>have&#160;a&#160;special&#160;meaning&#160;in&#160;the&#160;syntax.<br/>
Applications&#160;are&#160;written&#160;the&#160;way&#160;they&#160;are&#160;in&#160;JavaScript,&#160;by&#160;putting&#160;paren-<br/>
theses&#160;after&#160;an&#160;expression&#160;and&#160;having&#160;any&#160;number&#160;of&#160;arguments&#160;between&#160;those<br/>parentheses,&#160;separated&#160;by&#160;commas.<br/>
do(define(x,&#160;10),<br/>
202<br/>
<hr/>
<a name=215></a>if(&gt;(x,&#160;5),<br/>
print(&#34;large&#34;),<br/>print(&#34;small&#34;)))<br/>
The&#160;uniformity&#160;of&#160;the&#160;Egg&#160;language&#160;means&#160;that&#160;things&#160;that&#160;are&#160;operators&#160;in<br/>
JavaScript&#160;(such&#160;as&#160;&gt;)&#160;are&#160;normal&#160;bindings&#160;in&#160;this&#160;language,&#160;applied&#160;just&#160;like<br/>other&#160;functions.&#160;And&#160;since&#160;the&#160;syntax&#160;has&#160;no&#160;concept&#160;of&#160;a&#160;block,&#160;we&#160;need&#160;a&#160;do<br/>construct&#160;to&#160;represent&#160;doing&#160;multiple&#160;things&#160;in&#160;sequence.<br/>
The&#160;data&#160;structure&#160;that&#160;the&#160;parser&#160;will&#160;use&#160;to&#160;describe&#160;a&#160;program&#160;consists<br/>
of&#160;expression&#160;objects,&#160;each&#160;of&#160;which&#160;has&#160;a&#160;type&#160;property&#160;indicating&#160;the&#160;kind&#160;of<br/>expression&#160;it&#160;is&#160;and&#160;other&#160;properties&#160;to&#160;describe&#160;its&#160;content.<br/>
Expressions&#160;of&#160;type&#160;&#34;value&#34;&#160;represent&#160;literal&#160;strings&#160;or&#160;numbers.&#160;Their&#160;value<br/>
property&#160;contains&#160;the&#160;string&#160;or&#160;number&#160;value&#160;that&#160;they&#160;represent.&#160;Expressions<br/>of&#160;type&#160;&#34;word&#34;&#160;are&#160;used&#160;for&#160;identifiers&#160;(names).&#160;Such&#160;objects&#160;have&#160;a&#160;name&#160;prop-<br/>erty&#160;that&#160;holds&#160;the&#160;identifier’s&#160;name&#160;as&#160;a&#160;string.&#160;Finally,&#160;&#34;apply&#34;&#160;expressions<br/>represent&#160;applications.&#160;They&#160;have&#160;an&#160;operator&#160;property&#160;that&#160;refers&#160;to&#160;the&#160;ex-<br/>pression&#160;that&#160;is&#160;being&#160;applied,&#160;as&#160;well&#160;as&#160;an&#160;args&#160;property&#160;that&#160;holds&#160;an&#160;array<br/>of&#160;argument&#160;expressions.<br/>
The&#160;&gt;(x,&#160;5)&#160;part&#160;of&#160;the&#160;previous&#160;program&#160;would&#160;be&#160;represented&#160;like&#160;this:<br/>
{<br/>
type:&#160;&#34;apply&#34;,<br/>operator:&#160;{type:&#160;&#34;word&#34;,&#160;name:&#160;&#34;&gt;&#34;},<br/>args:&#160;[<br/>
{type:&#160;&#34;word&#34;,&#160;name:&#160;&#34;x&#34;},<br/>{type:&#160;&#34;value&#34;,&#160;value:&#160;5}<br/>
]<br/>
}<br/>
Such&#160;a&#160;data&#160;structure&#160;is&#160;called&#160;a&#160;<i>syntax&#160;tree</i>.&#160;If&#160;you&#160;imagine&#160;the&#160;objects&#160;as<br/>
dots&#160;and&#160;the&#160;links&#160;between&#160;them&#160;as&#160;lines&#160;between&#160;those&#160;dots,&#160;it&#160;has&#160;a&#160;treelike<br/>shape.&#160;The&#160;fact&#160;that&#160;expressions&#160;contain&#160;other&#160;expressions,&#160;which&#160;in&#160;turn<br/>might&#160;contain&#160;more&#160;expressions,&#160;is&#160;similar&#160;to&#160;the&#160;way&#160;tree&#160;branches&#160;split&#160;and<br/>split&#160;again.<br/>
203<br/>
<hr/>
<a name=216></a>do<br/>
deﬁne<br/>
x<br/>10<br/>
if<br/>
&gt;<br/>
x<br/>5<br/>
print<br/>
&#34;large&#34;<br/>
print<br/>
&#34;small&#34;<br/>
Contrast&#160;this&#160;to&#160;the&#160;parser&#160;we&#160;wrote&#160;for&#160;the&#160;configuration&#160;file&#160;format&#160;in<br/>
<a href="eloquent-javascripts.html#172">Chapter&#160;9</a>,&#160;which&#160;had&#160;a&#160;simple&#160;structure:&#160;it&#160;split&#160;the&#160;input&#160;into&#160;lines&#160;and<br/>handled&#160;those&#160;lines&#160;one&#160;at&#160;a&#160;time.&#160;There&#160;were&#160;only&#160;a&#160;few&#160;simple&#160;forms&#160;that&#160;a<br/>line&#160;was&#160;allowed&#160;to&#160;have.<br/>
Here&#160;we&#160;must&#160;find&#160;a&#160;different&#160;approach.&#160;Expressions&#160;are&#160;not&#160;separated&#160;into<br/>
lines,&#160;and&#160;they&#160;have&#160;a&#160;recursive&#160;structure.&#160;Application&#160;expressions&#160;<i>contain<br/></i>other&#160;expressions.<br/>
Fortunately,&#160;this&#160;problem&#160;can&#160;be&#160;solved&#160;very&#160;well&#160;by&#160;writing&#160;a&#160;parser&#160;function<br/>
that&#160;is&#160;recursive&#160;in&#160;a&#160;way&#160;that&#160;reflects&#160;the&#160;recursive&#160;nature&#160;of&#160;the&#160;language.<br/>
We&#160;define&#160;a&#160;function&#160;parseExpression,&#160;which&#160;takes&#160;a&#160;string&#160;as&#160;input&#160;and<br/>
returns&#160;an&#160;object&#160;containing&#160;the&#160;data&#160;structure&#160;for&#160;the&#160;expression&#160;at&#160;the&#160;start<br/>of&#160;the&#160;string,&#160;along&#160;with&#160;the&#160;part&#160;of&#160;the&#160;string&#160;left&#160;after&#160;parsing&#160;this&#160;expression.<br/>When&#160;parsing&#160;subexpressions&#160;(the&#160;argument&#160;to&#160;an&#160;application,&#160;for&#160;example),<br/>this&#160;function&#160;can&#160;be&#160;called&#160;again,&#160;yielding&#160;the&#160;argument&#160;expression&#160;as&#160;well&#160;as<br/>the&#160;text&#160;that&#160;remains.&#160;This&#160;text&#160;may&#160;in&#160;turn&#160;contain&#160;more&#160;arguments&#160;or&#160;may<br/>be&#160;the&#160;closing&#160;parenthesis&#160;that&#160;ends&#160;the&#160;list&#160;of&#160;arguments.<br/>
This&#160;is&#160;the&#160;first&#160;part&#160;of&#160;the&#160;parser:<br/>
function&#160;parseExpression(program)&#160;{<br/>
program&#160;=&#160;skipSpace(program);<br/>let&#160;match,&#160;expr;<br/>if&#160;(match&#160;=&#160;/^&#34;([^&#34;]*)&#34;/.exec(program))&#160;{<br/>
expr&#160;=&#160;{type:&#160;&#34;value&#34;,&#160;value:&#160;match[1]};<br/>
}&#160;else&#160;if&#160;(match&#160;=&#160;/^\d+\b/.exec(program))&#160;{<br/>
expr&#160;=&#160;{type:&#160;&#34;value&#34;,&#160;value:&#160;Number(match[0])};<br/>
}&#160;else&#160;if&#160;(match&#160;=&#160;/^[^\s(),#&#34;]+/.exec(program))&#160;{<br/>
expr&#160;=&#160;{type:&#160;&#34;word&#34;,&#160;name:&#160;match[0]};<br/>
}&#160;else&#160;{<br/>
204<br/>
<hr/>
<a name=217></a>throw&#160;new&#160;SyntaxError(&#34;Unexpected&#160;syntax:&#160;&#34;&#160;+&#160;program);<br/>
}<br/>
return&#160;parseApply(expr,&#160;program.slice(match[0].length));<br/>
}<br/>
function&#160;skipSpace(string)&#160;{<br/>
let&#160;first&#160;=&#160;string.search(/\S/);<br/>if&#160;(first&#160;==&#160;-1)&#160;return&#160;&#34;&#34;;<br/>return&#160;string.slice(first);<br/>
}<br/>
Because&#160;Egg,&#160;like&#160;JavaScript,&#160;allows&#160;any&#160;amount&#160;of&#160;whitespace&#160;between&#160;its<br/>
elements,&#160;we&#160;have&#160;to&#160;repeatedly&#160;cut&#160;the&#160;whitespace&#160;off&#160;the&#160;start&#160;of&#160;the&#160;program<br/>string.&#160;That&#160;is&#160;what&#160;the&#160;skipSpace&#160;function&#160;helps&#160;with.<br/>
After&#160;skipping&#160;any&#160;leading&#160;space,&#160;parseExpression&#160;uses&#160;three&#160;regular&#160;expres-<br/>
sions&#160;to&#160;spot&#160;the&#160;three&#160;atomic&#160;elements&#160;that&#160;Egg&#160;supports:&#160;strings,&#160;numbers,<br/>and&#160;words.&#160;The&#160;parser&#160;constructs&#160;a&#160;different&#160;kind&#160;of&#160;data&#160;structure&#160;depending<br/>on&#160;which&#160;one&#160;matches.&#160;If&#160;the&#160;input&#160;does&#160;not&#160;match&#160;one&#160;of&#160;these&#160;three&#160;forms,&#160;it<br/>is&#160;not&#160;a&#160;valid&#160;expression,&#160;and&#160;the&#160;parser&#160;throws&#160;an&#160;error.&#160;We&#160;use&#160;SyntaxError<br/>instead&#160;of&#160;Error&#160;as&#160;the&#160;exception&#160;constructor,&#160;which&#160;is&#160;another&#160;standard&#160;error<br/>type,&#160;because&#160;it&#160;is&#160;a&#160;little&#160;more&#160;specific—it&#160;is&#160;also&#160;the&#160;error&#160;type&#160;thrown&#160;when<br/>an&#160;attempt&#160;is&#160;made&#160;to&#160;run&#160;an&#160;invalid&#160;JavaScript&#160;program.<br/>
We&#160;then&#160;cut&#160;off&#160;the&#160;part&#160;that&#160;was&#160;matched&#160;from&#160;the&#160;program&#160;string&#160;and&#160;pass<br/>
that,&#160;along&#160;with&#160;the&#160;object&#160;for&#160;the&#160;expression,&#160;to&#160;parseApply,&#160;which&#160;checks<br/>whether&#160;the&#160;expression&#160;is&#160;an&#160;application.&#160;If&#160;so,&#160;it&#160;parses&#160;a&#160;parenthesized&#160;list&#160;of<br/>arguments.<br/>
function&#160;parseApply(expr,&#160;program)&#160;{<br/>
program&#160;=&#160;skipSpace(program);<br/>if&#160;(program[0]&#160;!=&#160;&#34;(&#34;)&#160;{<br/>
return&#160;{expr:&#160;expr,&#160;rest:&#160;program};<br/>
}<br/>
program&#160;=&#160;skipSpace(program.slice(1));<br/>expr&#160;=&#160;{type:&#160;&#34;apply&#34;,&#160;operator:&#160;expr,&#160;args:&#160;[]};<br/>while&#160;(program[0]&#160;!=&#160;&#34;)&#34;)&#160;{<br/>
let&#160;arg&#160;=&#160;parseExpression(program);<br/>expr.args.push(arg.expr);<br/>program&#160;=&#160;skipSpace(arg.rest);<br/>if&#160;(program[0]&#160;==&#160;&#34;,&#34;)&#160;{<br/>
program&#160;=&#160;skipSpace(program.slice(1));<br/>
}&#160;else&#160;if&#160;(program[0]&#160;!=&#160;&#34;)&#34;)&#160;{<br/>
205<br/>
<hr/>
<a name=218></a>throw&#160;new&#160;SyntaxError(&#34;Expected&#160;','&#160;or&#160;')'&#34;);<br/>
}<br/>
}<br/>return&#160;parseApply(expr,&#160;program.slice(1));<br/>
}<br/>
If&#160;the&#160;next&#160;character&#160;in&#160;the&#160;program&#160;is&#160;not&#160;an&#160;opening&#160;parenthesis,&#160;this&#160;is<br/>
not&#160;an&#160;application,&#160;and&#160;parseApply&#160;returns&#160;the&#160;expression&#160;it&#160;was&#160;given.<br/>
Otherwise,&#160;it&#160;skips&#160;the&#160;opening&#160;parenthesis&#160;and&#160;creates&#160;the&#160;syntax&#160;tree&#160;object<br/>
for&#160;this&#160;application&#160;expression.&#160;It&#160;then&#160;recursively&#160;calls&#160;parseExpression&#160;to<br/>parse&#160;each&#160;argument&#160;until&#160;a&#160;closing&#160;parenthesis&#160;is&#160;found.&#160;The&#160;recursion&#160;is<br/>indirect,&#160;through&#160;parseApply&#160;and&#160;parseExpression&#160;calling&#160;each&#160;other.<br/>
Because&#160;an&#160;application&#160;expression&#160;can&#160;itself&#160;be&#160;applied&#160;(such&#160;as&#160;in&#160;multiplier<br/>
(2)(1)),&#160;parseApply&#160;must,&#160;after&#160;it&#160;has&#160;parsed&#160;an&#160;application,&#160;call&#160;itself&#160;again<br/>to&#160;check&#160;whether&#160;another&#160;pair&#160;of&#160;parentheses&#160;follows.<br/>
This&#160;is&#160;all&#160;we&#160;need&#160;to&#160;parse&#160;Egg.&#160;We&#160;wrap&#160;it&#160;in&#160;a&#160;convenient&#160;parse&#160;func-<br/>
tion&#160;that&#160;verifies&#160;that&#160;it&#160;has&#160;reached&#160;the&#160;end&#160;of&#160;the&#160;input&#160;string&#160;after&#160;parsing<br/>the&#160;expression&#160;(an&#160;Egg&#160;program&#160;is&#160;a&#160;single&#160;expression),&#160;and&#160;that&#160;gives&#160;us&#160;the<br/>program’s&#160;data&#160;structure.<br/>
function&#160;parse(program)&#160;{<br/>
let&#160;{expr,&#160;rest}&#160;=&#160;parseExpression(program);<br/>if&#160;(skipSpace(rest).length&#160;&gt;&#160;0)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Unexpected&#160;text&#160;after&#160;program&#34;);<br/>
}<br/>return&#160;expr;<br/>
}<br/>
console.log(parse(&#34;+(a,&#160;10)&#34;));<br/>//&#160;→&#160;{type:&#160;&#34;apply&#34;,<br/>//<br/>
operator:&#160;{type:&#160;&#34;word&#34;,&#160;name:&#160;&#34;+&#34;},<br/>
//<br/>
args:&#160;[{type:&#160;&#34;word&#34;,&#160;name:&#160;&#34;a&#34;},<br/>
//<br/>
{type:&#160;&#34;value&#34;,&#160;value:&#160;10}]}<br/>
It&#160;works!&#160;It&#160;doesn’t&#160;give&#160;us&#160;very&#160;helpful&#160;information&#160;when&#160;it&#160;fails&#160;and&#160;doesn’t<br/>
store&#160;the&#160;line&#160;and&#160;column&#160;on&#160;which&#160;each&#160;expression&#160;starts,&#160;which&#160;might&#160;be<br/>helpful&#160;when&#160;reporting&#160;errors&#160;later,&#160;but&#160;it’s&#160;good&#160;enough&#160;for&#160;our&#160;purposes.<br/>
206<br/>
<hr/>
<a name=219></a><b>The&#160;evaluator</b><br/>
What&#160;can&#160;we&#160;do&#160;with&#160;the&#160;syntax&#160;tree&#160;for&#160;a&#160;program?&#160;Run&#160;it,&#160;of&#160;course!&#160;And<br/>that&#160;is&#160;what&#160;the&#160;evaluator&#160;does.&#160;You&#160;give&#160;it&#160;a&#160;syntax&#160;tree&#160;and&#160;a&#160;scope&#160;object<br/>that&#160;associates&#160;names&#160;with&#160;values,&#160;and&#160;it&#160;will&#160;evaluate&#160;the&#160;expression&#160;that&#160;the<br/>tree&#160;represents&#160;and&#160;return&#160;the&#160;value&#160;that&#160;this&#160;produces.<br/>
const&#160;specialForms&#160;=&#160;Object.create(null);<br/>
function&#160;evaluate(expr,&#160;scope)&#160;{<br/>
if&#160;(expr.type&#160;==&#160;&#34;value&#34;)&#160;{<br/>
return&#160;expr.value;<br/>
}&#160;else&#160;if&#160;(expr.type&#160;==&#160;&#34;word&#34;)&#160;{<br/>
if&#160;(expr.name&#160;in&#160;scope)&#160;{<br/>
return&#160;scope[expr.name];<br/>
}&#160;else&#160;{<br/>
throw&#160;new&#160;ReferenceError(<br/>
`Undefined&#160;binding:&#160;${expr.name}`);<br/>
}<br/>
}&#160;else&#160;if&#160;(expr.type&#160;==&#160;&#34;apply&#34;)&#160;{<br/>
let&#160;{operator,&#160;args}&#160;=&#160;expr;<br/>if&#160;(operator.type&#160;==&#160;&#34;word&#34;&#160;&amp;&amp;<br/>
operator.name&#160;in&#160;specialForms)&#160;{<br/>
return&#160;specialForms[operator.name](expr.args,&#160;scope);<br/>
}&#160;else&#160;{<br/>
let&#160;op&#160;=&#160;evaluate(operator,&#160;scope);<br/>if&#160;(typeof&#160;op&#160;==&#160;&#34;function&#34;)&#160;{<br/>
return&#160;op(...args.map(arg&#160;=&gt;&#160;evaluate(arg,&#160;scope)));<br/>
}&#160;else&#160;{<br/>
throw&#160;new&#160;TypeError(&#34;Applying&#160;a&#160;non-function.&#34;);<br/>
}<br/>
}<br/>
}<br/>
}<br/>
The&#160;evaluator&#160;has&#160;code&#160;for&#160;each&#160;of&#160;the&#160;expression&#160;types.&#160;A&#160;literal&#160;value<br/>
expression&#160;produces&#160;its&#160;value.&#160;(For&#160;example,&#160;the&#160;expression&#160;100&#160;just&#160;evaluates<br/>to&#160;the&#160;number&#160;100.)&#160;For&#160;a&#160;binding,&#160;we&#160;must&#160;check&#160;whether&#160;it&#160;is&#160;actually&#160;defined<br/>in&#160;the&#160;scope&#160;and,&#160;if&#160;it&#160;is,&#160;fetch&#160;the&#160;binding’s&#160;value.<br/>
Applications&#160;are&#160;more&#160;involved.&#160;If&#160;they&#160;are&#160;a&#160;special&#160;form,&#160;like&#160;if,&#160;we&#160;do&#160;not<br/>
evaluate&#160;anything&#160;and&#160;pass&#160;the&#160;argument&#160;expressions,&#160;along&#160;with&#160;the&#160;scope,<br/>to&#160;the&#160;function&#160;that&#160;handles&#160;this&#160;form.&#160;If&#160;it&#160;is&#160;a&#160;normal&#160;call,&#160;we&#160;evaluate&#160;the<br/>operator,&#160;verify&#160;that&#160;it&#160;is&#160;a&#160;function,&#160;and&#160;call&#160;it&#160;with&#160;the&#160;evaluated&#160;arguments.<br/>
207<br/>
<hr/>
<a name=220></a>We&#160;use&#160;plain&#160;JavaScript&#160;function&#160;values&#160;to&#160;represent&#160;Egg’s&#160;function&#160;values.<br/>
We&#160;will&#160;come&#160;back&#160;to&#160;this&#160;<a href="eloquent-javascripts.html#223">later,&#160;</a>when&#160;the&#160;special&#160;form&#160;called&#160;fun&#160;is&#160;defined.<br/>
The&#160;recursive&#160;structure&#160;of&#160;evaluate&#160;resembles&#160;the&#160;similar&#160;structure&#160;of&#160;the<br/>
parser,&#160;and&#160;both&#160;mirror&#160;the&#160;structure&#160;of&#160;the&#160;language&#160;itself.&#160;It&#160;would&#160;also&#160;be<br/>possible&#160;to&#160;integrate&#160;the&#160;parser&#160;with&#160;the&#160;evaluator&#160;and&#160;evaluate&#160;during&#160;parsing,<br/>but&#160;splitting&#160;them&#160;up&#160;this&#160;way&#160;makes&#160;the&#160;program&#160;clearer.<br/>
This&#160;is&#160;really&#160;all&#160;that&#160;is&#160;needed&#160;to&#160;interpret&#160;Egg.&#160;It&#160;is&#160;that&#160;simple.&#160;But<br/>
without&#160;defining&#160;a&#160;few&#160;special&#160;forms&#160;and&#160;adding&#160;some&#160;useful&#160;values&#160;to&#160;the<br/>environment,&#160;you&#160;can’t&#160;do&#160;much&#160;with&#160;this&#160;language&#160;yet.<br/>
<b>Special&#160;forms</b><br/>
The&#160;specialForms&#160;object&#160;is&#160;used&#160;to&#160;define&#160;special&#160;syntax&#160;in&#160;Egg.&#160;It&#160;associates<br/>words&#160;with&#160;functions&#160;that&#160;evaluate&#160;such&#160;forms.&#160;It&#160;is&#160;currently&#160;empty.&#160;Let’s&#160;add<br/>if.<br/>
specialForms.if&#160;=&#160;(args,&#160;scope)&#160;=&gt;&#160;{<br/>
if&#160;(args.length&#160;!=&#160;3)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Wrong&#160;number&#160;of&#160;args&#160;to&#160;if&#34;);<br/>
}&#160;else&#160;if&#160;(evaluate(args[0],&#160;scope)&#160;!==&#160;false)&#160;{<br/>
return&#160;evaluate(args[1],&#160;scope);<br/>
}&#160;else&#160;{<br/>
return&#160;evaluate(args[2],&#160;scope);<br/>
}<br/>
};<br/>
Egg’s&#160;if&#160;construct&#160;expects&#160;exactly&#160;three&#160;arguments.&#160;It&#160;will&#160;evaluate&#160;the&#160;first,<br/>
and&#160;if&#160;the&#160;result&#160;isn’t&#160;the&#160;value&#160;false,&#160;it&#160;will&#160;evaluate&#160;the&#160;second.&#160;Otherwise,<br/>the&#160;third&#160;gets&#160;evaluated.&#160;This&#160;if&#160;form&#160;is&#160;more&#160;similar&#160;to&#160;JavaScript’s&#160;ternary<br/>?:&#160;operator&#160;than&#160;to&#160;JavaScript’s&#160;if.&#160;It&#160;is&#160;an&#160;expression,&#160;not&#160;a&#160;statement,&#160;and<br/>it&#160;produces&#160;a&#160;value,&#160;namely,&#160;the&#160;result&#160;of&#160;the&#160;second&#160;or&#160;third&#160;argument.<br/>
Egg&#160;also&#160;differs&#160;from&#160;JavaScript&#160;in&#160;how&#160;it&#160;handles&#160;the&#160;condition&#160;value&#160;to&#160;if.<br/>
It&#160;will&#160;not&#160;treat&#160;things&#160;like&#160;zero&#160;or&#160;the&#160;empty&#160;string&#160;as&#160;false,&#160;only&#160;the&#160;precise<br/>value&#160;false.<br/>
The&#160;reason&#160;we&#160;need&#160;to&#160;represent&#160;if&#160;as&#160;a&#160;special&#160;form,&#160;rather&#160;than&#160;a&#160;regular<br/>
function,&#160;is&#160;that&#160;all&#160;arguments&#160;to&#160;functions&#160;are&#160;evaluated&#160;before&#160;the&#160;function&#160;is<br/>called,&#160;whereas&#160;if&#160;should&#160;evaluate&#160;only&#160;<i>either&#160;</i>its&#160;second&#160;or&#160;its&#160;third&#160;argument,<br/>depending&#160;on&#160;the&#160;value&#160;of&#160;the&#160;first.<br/>
The&#160;while&#160;form&#160;is&#160;similar.<br/>
specialForms.while&#160;=&#160;(args,&#160;scope)&#160;=&gt;&#160;{<br/>
208<br/>
<hr/>
<a name=221></a>if&#160;(args.length&#160;!=&#160;2)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Wrong&#160;number&#160;of&#160;args&#160;to&#160;while&#34;);<br/>
}<br/>while&#160;(evaluate(args[0],&#160;scope)&#160;!==&#160;false)&#160;{<br/>
evaluate(args[1],&#160;scope);<br/>
}<br/>
//&#160;Since&#160;undefined&#160;does&#160;not&#160;exist&#160;in&#160;Egg,&#160;we&#160;return&#160;false,<br/>//&#160;for&#160;lack&#160;of&#160;a&#160;meaningful&#160;result.<br/>return&#160;false;<br/>
};<br/>
Another&#160;basic&#160;building&#160;block&#160;is&#160;do,&#160;which&#160;executes&#160;all&#160;its&#160;arguments&#160;from&#160;top<br/>
to&#160;bottom.&#160;Its&#160;value&#160;is&#160;the&#160;value&#160;produced&#160;by&#160;the&#160;last&#160;argument.<br/>
specialForms.do&#160;=&#160;(args,&#160;scope)&#160;=&gt;&#160;{<br/>
let&#160;value&#160;=&#160;false;<br/>for&#160;(let&#160;arg&#160;of&#160;args)&#160;{<br/>
value&#160;=&#160;evaluate(arg,&#160;scope);<br/>
}<br/>return&#160;value;<br/>
};<br/>
To&#160;be&#160;able&#160;to&#160;create&#160;bindings&#160;and&#160;give&#160;them&#160;new&#160;values,&#160;we&#160;also&#160;create&#160;a<br/>
form&#160;called&#160;define.&#160;It&#160;expects&#160;a&#160;word&#160;as&#160;its&#160;first&#160;argument&#160;and&#160;an&#160;expression<br/>producing&#160;the&#160;value&#160;to&#160;assign&#160;to&#160;that&#160;word&#160;as&#160;its&#160;second&#160;argument.&#160;Since<br/>define,&#160;like&#160;everything,&#160;is&#160;an&#160;expression,&#160;it&#160;must&#160;return&#160;a&#160;value.&#160;We’ll&#160;make&#160;it<br/>return&#160;the&#160;value&#160;that&#160;was&#160;assigned&#160;(just&#160;like&#160;JavaScript’s&#160;=&#160;operator).<br/>
specialForms.define&#160;=&#160;(args,&#160;scope)&#160;=&gt;&#160;{<br/>
if&#160;(args.length&#160;!=&#160;2&#160;||&#160;args[0].type&#160;!=&#160;&#34;word&#34;)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Incorrect&#160;use&#160;of&#160;define&#34;);<br/>
}<br/>let&#160;value&#160;=&#160;evaluate(args[1],&#160;scope);<br/>scope[args[0].name]&#160;=&#160;value;<br/>return&#160;value;<br/>
};<br/>
209<br/>
<hr/>
<a name=222></a><b>The&#160;environment</b><br/>
The&#160;scope&#160;accepted&#160;by&#160;evaluate&#160;is&#160;an&#160;object&#160;with&#160;properties&#160;whose&#160;names<br/>correspond&#160;to&#160;binding&#160;names&#160;and&#160;whose&#160;values&#160;correspond&#160;to&#160;the&#160;values&#160;those<br/>bindings&#160;are&#160;bound&#160;to.&#160;Let’s&#160;define&#160;an&#160;object&#160;to&#160;represent&#160;the&#160;global&#160;scope.<br/>
To&#160;be&#160;able&#160;to&#160;use&#160;the&#160;if&#160;construct&#160;we&#160;just&#160;defined,&#160;we&#160;must&#160;have&#160;access&#160;to<br/>
Boolean&#160;values.&#160;Since&#160;there&#160;are&#160;only&#160;two&#160;Boolean&#160;values,&#160;we&#160;do&#160;not&#160;need&#160;special<br/>syntax&#160;for&#160;them.&#160;We&#160;simply&#160;bind&#160;two&#160;names&#160;to&#160;the&#160;values&#160;true&#160;and&#160;false&#160;and<br/>use&#160;them.<br/>
const&#160;topScope&#160;=&#160;Object.create(null);<br/>
topScope.true&#160;=&#160;true;<br/>topScope.false&#160;=&#160;false;<br/>
We&#160;can&#160;now&#160;evaluate&#160;a&#160;simple&#160;expression&#160;that&#160;negates&#160;a&#160;Boolean&#160;value.<br/>
let&#160;prog&#160;=&#160;parse(`if(true,&#160;false,&#160;true)`);<br/>console.log(evaluate(prog,&#160;topScope));<br/>//&#160;→&#160;false<br/>
To&#160;supply&#160;basic&#160;arithmetic&#160;and&#160;comparison&#160;operators,&#160;we&#160;will&#160;also&#160;add&#160;some<br/>
function&#160;values&#160;to&#160;the&#160;scope.&#160;In&#160;the&#160;interest&#160;of&#160;keeping&#160;the&#160;code&#160;short,&#160;we’ll<br/>use&#160;Function&#160;to&#160;synthesize&#160;a&#160;bunch&#160;of&#160;operator&#160;functions&#160;in&#160;a&#160;loop,&#160;instead&#160;of<br/>defining&#160;them&#160;individually.<br/>
for&#160;(let&#160;op&#160;of&#160;[&#34;+&#34;,&#160;&#34;-&#34;,&#160;&#34;*&#34;,&#160;&#34;/&#34;,&#160;&#34;==&#34;,&#160;&#34;&lt;&#34;,&#160;&#34;&gt;&#34;])&#160;{<br/>
topScope[op]&#160;=&#160;Function(&#34;a,&#160;b&#34;,&#160;`return&#160;a&#160;${op}&#160;b;`);<br/>
}<br/>
A&#160;way&#160;to&#160;output&#160;values&#160;is&#160;also&#160;useful,&#160;so&#160;we’ll&#160;wrap&#160;console.log&#160;in&#160;a&#160;function<br/>
and&#160;call&#160;it&#160;print.<br/>
topScope.print&#160;=&#160;value&#160;=&gt;&#160;{<br/>
console.log(value);<br/>return&#160;value;<br/>
};<br/>
That&#160;gives&#160;us&#160;enough&#160;elementary&#160;tools&#160;to&#160;write&#160;simple&#160;programs.&#160;The&#160;fol-<br/>
lowing&#160;function&#160;provides&#160;a&#160;convenient&#160;way&#160;to&#160;parse&#160;a&#160;program&#160;and&#160;run&#160;it&#160;in&#160;a<br/>fresh&#160;scope:<br/>
210<br/>
<hr/>
<a name=223></a>function&#160;run(program)&#160;{<br/>
return&#160;evaluate(parse(program),&#160;Object.create(topScope));<br/>
}<br/>
We’ll&#160;use&#160;object&#160;prototype&#160;chains&#160;to&#160;represent&#160;nested&#160;scopes&#160;so&#160;that&#160;the<br/>
program&#160;can&#160;add&#160;bindings&#160;to&#160;its&#160;local&#160;scope&#160;without&#160;changing&#160;the&#160;top-level<br/>scope.<br/>
run(`<br/>do(define(total,&#160;0),<br/>
define(count,&#160;1),<br/>while(&lt;(count,&#160;11),<br/>
do(define(total,&#160;+(total,&#160;count)),<br/>
define(count,&#160;+(count,&#160;1)))),<br/>
print(total))<br/>
`);<br/>//&#160;→&#160;55<br/>
This&#160;is&#160;the&#160;program&#160;we’ve&#160;seen&#160;several&#160;times&#160;before,&#160;which&#160;computes&#160;the&#160;sum<br/>
of&#160;the&#160;numbers&#160;1&#160;to&#160;10,&#160;expressed&#160;in&#160;Egg.&#160;It&#160;is&#160;clearly&#160;uglier&#160;than&#160;the&#160;equivalent<br/>JavaScript&#160;program—but&#160;not&#160;bad&#160;for&#160;a&#160;language&#160;implemented&#160;in&#160;less&#160;than&#160;150<br/>lines&#160;of&#160;code.<br/>
<b>Functions</b><br/>
A&#160;programming&#160;language&#160;without&#160;functions&#160;is&#160;a&#160;poor&#160;programming&#160;language<br/>indeed.<br/>
Fortunately,&#160;it&#160;isn’t&#160;hard&#160;to&#160;add&#160;a&#160;fun&#160;construct,&#160;which&#160;treats&#160;its&#160;last&#160;argu-<br/>
ment&#160;as&#160;the&#160;function’s&#160;body&#160;and&#160;uses&#160;all&#160;arguments&#160;before&#160;that&#160;as&#160;the&#160;names<br/>of&#160;the&#160;function’s&#160;parameters.<br/>
specialForms.fun&#160;=&#160;(args,&#160;scope)&#160;=&gt;&#160;{<br/>
if&#160;(!args.length)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Functions&#160;need&#160;a&#160;body&#34;);<br/>
}<br/>let&#160;body&#160;=&#160;args[args.length&#160;-&#160;1];<br/>let&#160;params&#160;=&#160;args.slice(0,&#160;args.length&#160;-&#160;1).map(expr&#160;=&gt;&#160;{<br/>
if&#160;(expr.type&#160;!=&#160;&#34;word&#34;)&#160;{<br/>
throw&#160;new&#160;SyntaxError(&#34;Parameter&#160;names&#160;must&#160;be&#160;words&#34;);<br/>
}<br/>return&#160;expr.name;<br/>
});<br/>
211<br/>
<hr/>
<a name=224></a>return&#160;function()&#160;{<br/>
if&#160;(arguments.length&#160;!=&#160;params.length)&#160;{<br/>
throw&#160;new&#160;TypeError(&#34;Wrong&#160;number&#160;of&#160;arguments&#34;);<br/>
}<br/>let&#160;localScope&#160;=&#160;Object.create(scope);<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;arguments.length;&#160;i++)&#160;{<br/>
localScope[params[i]]&#160;=&#160;arguments[i];<br/>
}<br/>return&#160;evaluate(body,&#160;localScope);<br/>
};<br/>
};<br/>
Functions&#160;in&#160;Egg&#160;get&#160;their&#160;own&#160;local&#160;scope.&#160;The&#160;function&#160;produced&#160;by&#160;the<br/>
fun&#160;form&#160;creates&#160;this&#160;local&#160;scope&#160;and&#160;adds&#160;the&#160;argument&#160;bindings&#160;to&#160;it.&#160;It&#160;then<br/>evaluates&#160;the&#160;function&#160;body&#160;in&#160;this&#160;scope&#160;and&#160;returns&#160;the&#160;result.<br/>
run(`<br/>do(define(plusOne,&#160;fun(a,&#160;+(a,&#160;1))),<br/>
print(plusOne(10)))<br/>
`);<br/>//&#160;→&#160;11<br/>
run(`<br/>do(define(pow,&#160;fun(base,&#160;exp,<br/>
if(==(exp,&#160;0),<br/>
1,<br/>*(base,&#160;pow(base,&#160;-(exp,&#160;1)))))),<br/>
print(pow(2,&#160;10)))<br/>
`);<br/>//&#160;→&#160;1024<br/>
<b>Compilation</b><br/>
What&#160;we&#160;have&#160;built&#160;is&#160;an&#160;interpreter.&#160;During&#160;evaluation,&#160;it&#160;acts&#160;directly&#160;on&#160;the<br/>representation&#160;of&#160;the&#160;program&#160;produced&#160;by&#160;the&#160;parser.<br/>
<i>Compilation&#160;</i>is&#160;the&#160;process&#160;of&#160;adding&#160;another&#160;step&#160;between&#160;the&#160;parsing&#160;and<br/>
the&#160;running&#160;of&#160;a&#160;program,&#160;which&#160;transforms&#160;the&#160;program&#160;into&#160;something&#160;that<br/>can&#160;be&#160;evaluated&#160;more&#160;efficiently&#160;by&#160;doing&#160;as&#160;much&#160;work&#160;as&#160;possible&#160;in&#160;advance.<br/>For&#160;example,&#160;in&#160;well-designed&#160;languages&#160;it&#160;is&#160;obvious,&#160;for&#160;each&#160;use&#160;of&#160;a&#160;binding,<br/>which&#160;binding&#160;is&#160;being&#160;referred&#160;to,&#160;without&#160;actually&#160;running&#160;the&#160;program.&#160;This<br/>
212<br/>
<hr/>
<a name=225></a>can&#160;be&#160;used&#160;to&#160;avoid&#160;looking&#160;up&#160;the&#160;binding&#160;by&#160;name&#160;every&#160;time&#160;it&#160;is&#160;accessed,<br/>instead&#160;directly&#160;fetching&#160;it&#160;from&#160;some&#160;predetermined&#160;memory&#160;location.<br/>
Traditionally,&#160;compilation&#160;involves&#160;converting&#160;the&#160;program&#160;to&#160;machine&#160;code,<br/>
the&#160;raw&#160;format&#160;that&#160;a&#160;computer’s&#160;processor&#160;can&#160;execute.&#160;But&#160;any&#160;process<br/>that&#160;converts&#160;a&#160;program&#160;to&#160;a&#160;different&#160;representation&#160;can&#160;be&#160;thought&#160;of&#160;as<br/>compilation.<br/>
It&#160;would&#160;be&#160;possible&#160;to&#160;write&#160;an&#160;alternative&#160;evaluation&#160;strategy&#160;for&#160;Egg,<br/>
one&#160;that&#160;first&#160;converts&#160;the&#160;program&#160;to&#160;a&#160;JavaScript&#160;program,&#160;uses&#160;Function<br/>
to&#160;invoke&#160;the&#160;JavaScript&#160;compiler&#160;on&#160;it,&#160;and&#160;then&#160;runs&#160;the&#160;result.&#160;When<br/>
done&#160;right,&#160;this&#160;would&#160;make&#160;Egg&#160;run&#160;very&#160;fast&#160;while&#160;still&#160;being&#160;quite&#160;simple&#160;to<br/>implement.<br/>
If&#160;you&#160;are&#160;interested&#160;in&#160;this&#160;topic&#160;and&#160;willing&#160;to&#160;spend&#160;some&#160;time&#160;on&#160;it,&#160;I<br/>
encourage&#160;you&#160;to&#160;try&#160;to&#160;implement&#160;such&#160;a&#160;compiler&#160;as&#160;an&#160;exercise.<br/>
<b>Cheating</b><br/>
When&#160;we&#160;defined&#160;if&#160;and&#160;while,&#160;you&#160;probably&#160;noticed&#160;that&#160;they&#160;were&#160;more<br/>or&#160;less&#160;trivial&#160;wrappers&#160;around&#160;JavaScript’s&#160;own&#160;if&#160;and&#160;while.&#160;Similarly,&#160;the<br/>values&#160;in&#160;Egg&#160;are&#160;just&#160;regular&#160;old&#160;JavaScript&#160;values.<br/>
If&#160;you&#160;compare&#160;the&#160;implementation&#160;of&#160;Egg,&#160;built&#160;on&#160;top&#160;of&#160;JavaScript,&#160;with<br/>
the&#160;amount&#160;of&#160;work&#160;and&#160;complexity&#160;required&#160;to&#160;build&#160;a&#160;programming&#160;language<br/>directly&#160;on&#160;the&#160;raw&#160;functionality&#160;provided&#160;by&#160;a&#160;machine,&#160;the&#160;difference&#160;is&#160;huge.<br/>Regardless,&#160;this&#160;example&#160;ideally&#160;gave&#160;you&#160;an&#160;impression&#160;of&#160;the&#160;way&#160;program-<br/>ming&#160;languages&#160;work.<br/>
And&#160;when&#160;it&#160;comes&#160;to&#160;getting&#160;something&#160;done,&#160;cheating&#160;is&#160;more&#160;effective&#160;than<br/>
doing&#160;everything&#160;yourself.&#160;Though&#160;the&#160;toy&#160;language&#160;in&#160;this&#160;chapter&#160;doesn’t&#160;do<br/>anything&#160;that&#160;couldn’t&#160;be&#160;done&#160;better&#160;in&#160;JavaScript,&#160;there&#160;<i>are&#160;</i>situations&#160;where<br/>writing&#160;small&#160;languages&#160;helps&#160;get&#160;real&#160;work&#160;done.<br/>
Such&#160;a&#160;language&#160;does&#160;not&#160;have&#160;to&#160;resemble&#160;a&#160;typical&#160;programming&#160;language.<br/>
If&#160;JavaScript&#160;didn’t&#160;come&#160;equipped&#160;with&#160;regular&#160;expressions,&#160;for&#160;example,&#160;you<br/>could&#160;write&#160;your&#160;own&#160;parser&#160;and&#160;evaluator&#160;for&#160;regular&#160;expressions.<br/>
Or&#160;imagine&#160;you&#160;are&#160;building&#160;a&#160;giant&#160;robotic&#160;dinosaur&#160;and&#160;need&#160;to&#160;program<br/>
its&#160;behavior.&#160;JavaScript&#160;might&#160;not&#160;be&#160;the&#160;most&#160;effective&#160;way&#160;to&#160;do&#160;this.&#160;You<br/>might&#160;instead&#160;opt&#160;for&#160;a&#160;language&#160;that&#160;looks&#160;like&#160;this:<br/>
behavior&#160;walk<br/>
perform&#160;when<br/>
destination&#160;ahead<br/>
actions<br/>
move&#160;left-foot<br/>
213<br/>
<hr/>
<a name=226></a>move&#160;right-foot<br/>
behavior&#160;attack<br/>
perform&#160;when<br/>
Godzilla&#160;in-view<br/>
actions<br/>
fire&#160;laser-eyes<br/>launch&#160;arm-rockets<br/>
This&#160;is&#160;what&#160;is&#160;usually&#160;called&#160;a&#160;<i>domain-specific&#160;language</i>,&#160;a&#160;language&#160;tailored<br/>
to&#160;express&#160;a&#160;narrow&#160;domain&#160;of&#160;knowledge.&#160;Such&#160;a&#160;language&#160;can&#160;be&#160;more&#160;expres-<br/>sive&#160;than&#160;a&#160;general-purpose&#160;language&#160;because&#160;it&#160;is&#160;designed&#160;to&#160;describe&#160;exactly<br/>the&#160;things&#160;that&#160;need&#160;to&#160;be&#160;described&#160;in&#160;its&#160;domain,&#160;and&#160;nothing&#160;else.<br/>
<b>Exercises</b><br/>
<b>Arrays</b><br/>
Add&#160;support&#160;for&#160;arrays&#160;to&#160;Egg&#160;by&#160;adding&#160;the&#160;following&#160;three&#160;functions&#160;to&#160;the<br/>top&#160;scope:&#160;array(...values)&#160;to&#160;construct&#160;an&#160;array&#160;containing&#160;the&#160;argument<br/>values,&#160;length(array)&#160;to&#160;get&#160;an&#160;array’s&#160;length,&#160;and&#160;element(array,&#160;n)&#160;to&#160;fetch<br/>the&#160;nth&#160;element&#160;from&#160;an&#160;array.<br/>
<b>Closure</b><br/>
The&#160;way&#160;we&#160;have&#160;defined&#160;fun&#160;allows&#160;functions&#160;in&#160;Egg&#160;to&#160;reference&#160;the&#160;surround-<br/>ing&#160;scope,&#160;allowing&#160;the&#160;function’s&#160;body&#160;to&#160;use&#160;local&#160;values&#160;that&#160;were&#160;visible&#160;at<br/>the&#160;time&#160;the&#160;function&#160;was&#160;defined,&#160;just&#160;like&#160;JavaScript&#160;functions&#160;do.<br/>
The&#160;following&#160;program&#160;illustrates&#160;this:&#160;function&#160;f&#160;returns&#160;a&#160;function&#160;that<br/>
adds&#160;its&#160;argument&#160;to&#160;f’s&#160;argument,&#160;meaning&#160;that&#160;it&#160;needs&#160;access&#160;to&#160;the&#160;local<br/>scope&#160;inside&#160;f&#160;to&#160;be&#160;able&#160;to&#160;use&#160;binding&#160;a.<br/>
run(`<br/>do(define(f,&#160;fun(a,&#160;fun(b,&#160;+(a,&#160;b)))),<br/>
print(f(4)(5)))<br/>
`);<br/>//&#160;→&#160;9<br/>
Go&#160;back&#160;to&#160;the&#160;definition&#160;of&#160;the&#160;fun&#160;form&#160;and&#160;explain&#160;which&#160;mechanism<br/>
causes&#160;this&#160;to&#160;work.<br/>
214<br/>
<hr/>
<a name=227></a><b>Comments</b><br/>
It&#160;would&#160;be&#160;nice&#160;if&#160;we&#160;could&#160;write&#160;comments&#160;in&#160;Egg.&#160;For&#160;example,&#160;whenever<br/>we&#160;find&#160;a&#160;hash&#160;sign&#160;(#),&#160;we&#160;could&#160;treat&#160;the&#160;rest&#160;of&#160;the&#160;line&#160;as&#160;a&#160;comment&#160;and<br/>ignore&#160;it,&#160;similar&#160;to&#160;//&#160;in&#160;JavaScript.<br/>
We&#160;do&#160;not&#160;have&#160;to&#160;make&#160;any&#160;big&#160;changes&#160;to&#160;the&#160;parser&#160;to&#160;support&#160;this.&#160;We<br/>
can&#160;simply&#160;change&#160;skipSpace&#160;to&#160;skip&#160;comments&#160;as&#160;if&#160;they&#160;are&#160;whitespace&#160;so&#160;that<br/>all&#160;the&#160;points&#160;where&#160;skipSpace&#160;is&#160;called&#160;will&#160;now&#160;also&#160;skip&#160;comments.&#160;Make<br/>this&#160;change.<br/>
<b>Fixing&#160;scope</b><br/>
Currently,&#160;the&#160;only&#160;way&#160;to&#160;assign&#160;a&#160;binding&#160;a&#160;value&#160;is&#160;define.&#160;This&#160;construct<br/>acts&#160;as&#160;a&#160;way&#160;both&#160;to&#160;define&#160;new&#160;bindings&#160;and&#160;to&#160;give&#160;existing&#160;ones&#160;a&#160;new&#160;value.<br/>
This&#160;ambiguity&#160;causes&#160;a&#160;problem.&#160;When&#160;you&#160;try&#160;to&#160;give&#160;a&#160;nonlocal&#160;binding<br/>
a&#160;new&#160;value,&#160;you&#160;will&#160;end&#160;up&#160;defining&#160;a&#160;local&#160;one&#160;with&#160;the&#160;same&#160;name&#160;instead.<br/>Some&#160;languages&#160;work&#160;like&#160;this&#160;by&#160;design,&#160;but&#160;I’ve&#160;always&#160;found&#160;it&#160;an&#160;awkward<br/>way&#160;to&#160;handle&#160;scope.<br/>
Add&#160;a&#160;special&#160;form&#160;set,&#160;similar&#160;to&#160;define,&#160;which&#160;gives&#160;a&#160;binding&#160;a&#160;new&#160;value,<br/>
updating&#160;the&#160;binding&#160;in&#160;an&#160;outer&#160;scope&#160;if&#160;it&#160;doesn’t&#160;already&#160;exist&#160;in&#160;the&#160;inner<br/>scope.&#160;If&#160;the&#160;binding&#160;is&#160;not&#160;defined&#160;at&#160;all,&#160;throw&#160;a&#160;ReferenceError&#160;(another<br/>standard&#160;error&#160;type).<br/>
The&#160;technique&#160;of&#160;representing&#160;scopes&#160;as&#160;simple&#160;objects,&#160;which&#160;has&#160;made<br/>
things&#160;convenient&#160;so&#160;far,&#160;will&#160;get&#160;in&#160;your&#160;way&#160;a&#160;little&#160;at&#160;this&#160;point.&#160;You&#160;might<br/>want&#160;to&#160;use&#160;the&#160;Object.getPrototypeOf&#160;function,&#160;which&#160;returns&#160;the&#160;prototype<br/>of&#160;an&#160;object.&#160;Also&#160;remember&#160;that&#160;scopes&#160;do&#160;not&#160;derive&#160;from&#160;Object.prototype,<br/>so&#160;if&#160;you&#160;want&#160;to&#160;call&#160;hasOwnProperty&#160;on&#160;them,&#160;you&#160;have&#160;to&#160;use&#160;this&#160;clumsy<br/>expression:<br/>
Object.prototype.hasOwnProperty.call(scope,&#160;name);<br/>
215<br/>
<hr/>
<a name=228></a><i>“The&#160;dream&#160;behind&#160;the&#160;Web&#160;is&#160;of&#160;a&#160;common&#160;information&#160;space&#160;in</i><br/>
<i>which&#160;we&#160;communicate&#160;by&#160;sharing&#160;information.&#160;Its&#160;universality&#160;is<br/>essential:&#160;the&#160;fact&#160;that&#160;a&#160;hypertext&#160;link&#160;can&#160;point&#160;to&#160;anything,&#160;be&#160;it<br/>personal,&#160;local&#160;or&#160;global,&#160;be&#160;it&#160;draft&#160;or&#160;highly&#160;polished.”</i><br/>
—Tim&#160;Berners-Lee,&#160;The&#160;World&#160;Wide&#160;Web:&#160;A&#160;very&#160;short&#160;personal<br/>
history<br/>
<b>Chapter&#160;13<br/>JavaScript&#160;and&#160;the&#160;Browser</b><br/>
The&#160;next&#160;chapters&#160;of&#160;this&#160;book&#160;will&#160;talk&#160;about&#160;web&#160;browsers.&#160;Without&#160;web<br/>browsers,&#160;there&#160;would&#160;be&#160;no&#160;JavaScript.&#160;Or&#160;even&#160;if&#160;there&#160;were,&#160;no&#160;one&#160;would<br/>ever&#160;have&#160;paid&#160;any&#160;attention&#160;to&#160;it.<br/>
Web&#160;technology&#160;has&#160;been&#160;decentralized&#160;from&#160;the&#160;start,&#160;not&#160;just&#160;technically<br/>
but&#160;also&#160;in&#160;the&#160;way&#160;it&#160;evolved.&#160;Various&#160;browser&#160;vendors&#160;have&#160;added&#160;new&#160;func-<br/>tionality&#160;in&#160;ad&#160;hoc&#160;and&#160;sometimes&#160;poorly&#160;thought-out&#160;ways,&#160;which&#160;then,&#160;some-<br/>times,&#160;ended&#160;up&#160;being&#160;adopted&#160;by&#160;others—and&#160;finally&#160;set&#160;down&#160;as&#160;in&#160;standards.<br/>
This&#160;is&#160;both&#160;a&#160;blessing&#160;and&#160;a&#160;curse.&#160;On&#160;the&#160;one&#160;hand,&#160;it&#160;is&#160;empowering&#160;to<br/>
not&#160;have&#160;a&#160;central&#160;party&#160;control&#160;a&#160;system&#160;but&#160;have&#160;it&#160;be&#160;improved&#160;by&#160;various<br/>parties&#160;working&#160;in&#160;loose&#160;collaboration&#160;(or&#160;occasionally&#160;open&#160;hostility).&#160;On&#160;the<br/>other&#160;hand,&#160;the&#160;haphazard&#160;way&#160;in&#160;which&#160;the&#160;Web&#160;was&#160;developed&#160;means&#160;that<br/>the&#160;resulting&#160;system&#160;is&#160;not&#160;exactly&#160;a&#160;shining&#160;example&#160;of&#160;internal&#160;consistency.<br/>Some&#160;parts&#160;of&#160;it&#160;are&#160;downright&#160;confusing&#160;and&#160;poorly&#160;conceived.<br/>
<b>Networks&#160;and&#160;the&#160;Internet</b><br/>
Computer&#160;networks&#160;have&#160;been&#160;around&#160;since&#160;the&#160;1950s.&#160;If&#160;you&#160;put&#160;cables&#160;be-<br/>tween&#160;two&#160;or&#160;more&#160;computers&#160;and&#160;allow&#160;them&#160;to&#160;send&#160;data&#160;back&#160;and&#160;forth<br/>through&#160;these&#160;cables,&#160;you&#160;can&#160;do&#160;all&#160;kinds&#160;of&#160;wonderful&#160;things.<br/>
And&#160;if&#160;connecting&#160;two&#160;machines&#160;in&#160;the&#160;same&#160;building&#160;allows&#160;us&#160;to&#160;do&#160;won-<br/>
derful&#160;things,&#160;connecting&#160;machines&#160;all&#160;over&#160;the&#160;planet&#160;should&#160;be&#160;even&#160;better.<br/>The&#160;technology&#160;to&#160;start&#160;implementing&#160;this&#160;vision&#160;was&#160;developed&#160;in&#160;the&#160;1980s,<br/>and&#160;the&#160;resulting&#160;network&#160;is&#160;called&#160;the&#160;<i>Internet</i>.&#160;It&#160;has&#160;lived&#160;up&#160;to&#160;its&#160;promise.<br/>
A&#160;computer&#160;can&#160;use&#160;this&#160;network&#160;to&#160;shoot&#160;bits&#160;at&#160;another&#160;computer.&#160;For<br/>
any&#160;effective&#160;communication&#160;to&#160;arise&#160;out&#160;of&#160;this&#160;bit-shooting,&#160;the&#160;computers&#160;on<br/>both&#160;ends&#160;must&#160;know&#160;what&#160;the&#160;bits&#160;are&#160;supposed&#160;to&#160;represent.&#160;The&#160;meaning<br/>of&#160;any&#160;given&#160;sequence&#160;of&#160;bits&#160;depends&#160;entirely&#160;on&#160;the&#160;kind&#160;of&#160;thing&#160;that&#160;it&#160;is<br/>trying&#160;to&#160;express&#160;and&#160;on&#160;the&#160;encoding&#160;mechanism&#160;used.<br/>
A&#160;<i>network&#160;protocol&#160;</i>describes&#160;a&#160;style&#160;of&#160;communication&#160;over&#160;a&#160;network.&#160;There<br/>
are&#160;protocols&#160;for&#160;sending&#160;email,&#160;for&#160;fetching&#160;email,&#160;for&#160;sharing&#160;files,&#160;and&#160;even<br/>
216<br/>
<hr/>
<a name=229></a>for&#160;controlling&#160;computers&#160;that&#160;happen&#160;to&#160;be&#160;infected&#160;by&#160;malicious&#160;software.<br/>
For&#160;example,&#160;the&#160;<i>Hypertext&#160;Transfer&#160;Protocol&#160;</i>(HTTP)&#160;is&#160;a&#160;protocol&#160;for&#160;re-<br/>
trieving&#160;named&#160;resources&#160;(chunks&#160;of&#160;information,&#160;such&#160;as&#160;web&#160;pages&#160;or&#160;pictures).<br/>It&#160;specifies&#160;that&#160;the&#160;side&#160;making&#160;the&#160;request&#160;should&#160;start&#160;with&#160;a&#160;line&#160;like&#160;this,<br/>naming&#160;the&#160;resource&#160;and&#160;the&#160;version&#160;of&#160;the&#160;protocol&#160;that&#160;it&#160;is&#160;trying&#160;to&#160;use:<br/>
GET&#160;/index.html&#160;HTTP/1.1<br/>
There&#160;are&#160;a&#160;lot&#160;more&#160;rules&#160;about&#160;the&#160;way&#160;the&#160;requester&#160;can&#160;include&#160;more<br/>
information&#160;in&#160;the&#160;request&#160;and&#160;the&#160;way&#160;the&#160;other&#160;side,&#160;which&#160;returns&#160;the&#160;re-<br/>source,&#160;packages&#160;up&#160;its&#160;content.&#160;We’ll&#160;look&#160;at&#160;HTTP&#160;in&#160;a&#160;little&#160;more&#160;detail&#160;in<br/><a href="eloquent-javascripts.html#320">Chapter&#160;18.</a><br/>
Most&#160;protocols&#160;are&#160;built&#160;on&#160;top&#160;of&#160;other&#160;protocols.&#160;HTTP&#160;treats&#160;the&#160;network<br/>
as&#160;a&#160;streamlike&#160;device&#160;into&#160;which&#160;you&#160;can&#160;put&#160;bits&#160;and&#160;have&#160;them&#160;arrive&#160;at&#160;the<br/>correct&#160;destination&#160;in&#160;the&#160;correct&#160;order.&#160;As&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#192">Chapter&#160;11,&#160;</a>ensuring<br/>those&#160;things&#160;is&#160;already&#160;a&#160;rather&#160;difficult&#160;problem.<br/>
The&#160;<i>Transmission&#160;Control&#160;Protocol&#160;</i>(TCP)&#160;is&#160;a&#160;protocol&#160;that&#160;addresses&#160;this<br/>
problem.&#160;All&#160;Internet-connected&#160;devices&#160;“speak”&#160;it,&#160;and&#160;most&#160;communication<br/>on&#160;the&#160;Internet&#160;is&#160;built&#160;on&#160;top&#160;of&#160;it.<br/>
A&#160;TCP&#160;connection&#160;works&#160;as&#160;follows:&#160;one&#160;computer&#160;must&#160;be&#160;waiting,&#160;or<br/>
<i>listening</i>,&#160;for&#160;other&#160;computers&#160;to&#160;start&#160;talking&#160;to&#160;it.&#160;To&#160;be&#160;able&#160;to&#160;listen&#160;for<br/>different&#160;kinds&#160;of&#160;communication&#160;at&#160;the&#160;same&#160;time&#160;on&#160;a&#160;single&#160;machine,&#160;each<br/>listener&#160;has&#160;a&#160;number&#160;(called&#160;a&#160;<i>port</i>)&#160;associated&#160;with&#160;it.&#160;Most&#160;protocols&#160;specify<br/>which&#160;port&#160;should&#160;be&#160;used&#160;by&#160;default.&#160;For&#160;example,&#160;when&#160;we&#160;want&#160;to&#160;send<br/>an&#160;email&#160;using&#160;the&#160;SMTP&#160;protocol,&#160;the&#160;machine&#160;through&#160;which&#160;we&#160;send&#160;it&#160;is<br/>expected&#160;to&#160;be&#160;listening&#160;on&#160;port&#160;25.<br/>
Another&#160;computer&#160;can&#160;then&#160;establish&#160;a&#160;connection&#160;by&#160;connecting&#160;to&#160;the&#160;tar-<br/>
get&#160;machine&#160;using&#160;the&#160;correct&#160;port&#160;number.&#160;If&#160;the&#160;target&#160;machine&#160;can&#160;be<br/>reached&#160;and&#160;is&#160;listening&#160;on&#160;that&#160;port,&#160;the&#160;connection&#160;is&#160;successfully&#160;created.<br/>The&#160;listening&#160;computer&#160;is&#160;called&#160;the&#160;<i>server</i>,&#160;and&#160;the&#160;connecting&#160;computer&#160;is<br/>called&#160;the&#160;<i>client</i>.<br/>
Such&#160;a&#160;connection&#160;acts&#160;as&#160;a&#160;two-way&#160;pipe&#160;through&#160;which&#160;bits&#160;can&#160;flow—the<br/>
machines&#160;on&#160;both&#160;ends&#160;can&#160;put&#160;data&#160;into&#160;it.&#160;Once&#160;the&#160;bits&#160;are&#160;successfully<br/>transmitted,&#160;they&#160;can&#160;be&#160;read&#160;out&#160;again&#160;by&#160;the&#160;machine&#160;on&#160;the&#160;other&#160;side.<br/>This&#160;is&#160;a&#160;convenient&#160;model.&#160;You&#160;could&#160;say&#160;that&#160;TCP&#160;provides&#160;an&#160;abstraction<br/>of&#160;the&#160;network.<br/>
217<br/>
<hr/>
<a name=230></a><b>The&#160;Web</b><br/>
The&#160;<i>World&#160;Wide&#160;Web&#160;</i>(not&#160;to&#160;be&#160;confused&#160;with&#160;the&#160;Internet&#160;as&#160;a&#160;whole)&#160;is&#160;a<br/>set&#160;of&#160;protocols&#160;and&#160;formats&#160;that&#160;allow&#160;us&#160;to&#160;visit&#160;web&#160;pages&#160;in&#160;a&#160;browser.&#160;The<br/>“Web”&#160;part&#160;in&#160;the&#160;name&#160;refers&#160;to&#160;the&#160;fact&#160;that&#160;such&#160;pages&#160;can&#160;easily&#160;link&#160;to<br/>each&#160;other,&#160;thus&#160;connecting&#160;into&#160;a&#160;huge&#160;mesh&#160;that&#160;users&#160;can&#160;move&#160;through.<br/>
To&#160;become&#160;part&#160;of&#160;the&#160;Web,&#160;all&#160;you&#160;need&#160;to&#160;do&#160;is&#160;connect&#160;a&#160;machine&#160;to&#160;the<br/>
Internet&#160;and&#160;have&#160;it&#160;listen&#160;on&#160;port&#160;80&#160;with&#160;the&#160;HTTP&#160;protocol&#160;so&#160;that&#160;other<br/>computers&#160;can&#160;ask&#160;it&#160;for&#160;documents.<br/>
Each&#160;document&#160;on&#160;the&#160;Web&#160;is&#160;named&#160;by&#160;a&#160;<i>Uniform&#160;Resource&#160;Locator&#160;</i>(URL),<br/>
which&#160;looks&#160;something&#160;like&#160;this:<br/>
http://eloquentjavascript.net/13_browser.html<br/>
|<br/>
|<br/>
|<br/>
|<br/>
protocol<br/>
server<br/>
path<br/>
The&#160;first&#160;part&#160;tells&#160;us&#160;that&#160;this&#160;URL&#160;uses&#160;the&#160;HTTP&#160;protocol&#160;(as&#160;opposed&#160;to,<br/>
for&#160;example,&#160;encrypted&#160;HTTP,&#160;which&#160;would&#160;be&#160;<i>https://&#160;</i>).&#160;Then&#160;comes&#160;the&#160;part<br/>that&#160;identifies&#160;which&#160;server&#160;we&#160;are&#160;requesting&#160;the&#160;document&#160;from.&#160;Last&#160;is&#160;a<br/>path&#160;string&#160;that&#160;identifies&#160;the&#160;specific&#160;document&#160;(or&#160;<i>resource</i>)&#160;we&#160;are&#160;interested<br/>in.<br/>
Machines&#160;connected&#160;to&#160;the&#160;Internet&#160;get&#160;an&#160;<i>IP&#160;address</i>,&#160;which&#160;is&#160;a&#160;number<br/>
that&#160;can&#160;be&#160;used&#160;to&#160;send&#160;messages&#160;to&#160;that&#160;machine,&#160;and&#160;looks&#160;something&#160;like<br/>149.210.142.219&#160;or&#160;2001:4860:4860::8888.&#160;But&#160;lists&#160;of&#160;more&#160;or&#160;less&#160;random<br/>numbers&#160;are&#160;hard&#160;to&#160;remember&#160;and&#160;awkward&#160;to&#160;type,&#160;so&#160;you&#160;can&#160;instead&#160;reg-<br/>ister&#160;a&#160;<i>domain&#160;name&#160;</i>for&#160;a&#160;specific&#160;address&#160;or&#160;set&#160;of&#160;addresses.&#160;I&#160;registered<br/><i>eloquentjavascript.net&#160;</i>to&#160;point&#160;at&#160;the&#160;IP&#160;address&#160;of&#160;a&#160;machine&#160;I&#160;control&#160;and<br/>can&#160;thus&#160;use&#160;that&#160;domain&#160;name&#160;to&#160;serve&#160;web&#160;pages.<br/>
If&#160;you&#160;type&#160;this&#160;URL&#160;into&#160;your&#160;browser’s&#160;address&#160;bar,&#160;the&#160;browser&#160;will&#160;try<br/>
to&#160;retrieve&#160;and&#160;display&#160;the&#160;document&#160;at&#160;that&#160;URL.&#160;First,&#160;your&#160;browser&#160;has&#160;to<br/>find&#160;out&#160;what&#160;address&#160;<i>eloquentjavascript.net&#160;</i>refers&#160;to.&#160;Then,&#160;using&#160;the&#160;HTTP<br/>protocol,&#160;it&#160;will&#160;make&#160;a&#160;connection&#160;to&#160;the&#160;server&#160;at&#160;that&#160;address&#160;and&#160;ask&#160;for&#160;the<br/>resource&#160;<i>/13_browser.html</i>.&#160;If&#160;all&#160;goes&#160;well,&#160;the&#160;server&#160;sends&#160;back&#160;a&#160;document,<br/>which&#160;your&#160;browser&#160;then&#160;displays&#160;on&#160;your&#160;screen.<br/>
<b>HTML</b><br/>
HTML,&#160;which&#160;stands&#160;for&#160;<i>Hypertext&#160;Markup&#160;Language</i>,&#160;is&#160;the&#160;document&#160;format<br/>used&#160;for&#160;web&#160;pages.&#160;An&#160;HTML&#160;document&#160;contains&#160;text,&#160;as&#160;well&#160;as&#160;<i>tags&#160;</i>that<br/>
218<br/>
<hr/>
<a name=231></a><img src="eloquent-javascript-231_1.png"/><br/>
give&#160;structure&#160;to&#160;the&#160;text,&#160;describing&#160;things&#160;such&#160;as&#160;links,&#160;paragraphs,&#160;and<br/>headings.<br/>
A&#160;short&#160;HTML&#160;document&#160;might&#160;look&#160;like&#160;this:<br/>
&lt;!doctype&#160;html&gt;<br/>&lt;html&gt;<br/>
&lt;head&gt;<br/>
&lt;meta&#160;charset=&#34;utf-8&#34;&gt;<br/>&lt;title&gt;My&#160;home&#160;page&lt;/title&gt;<br/>
&lt;/head&gt;<br/>&lt;body&gt;<br/>
&lt;h1&gt;My&#160;home&#160;page&lt;/h1&gt;<br/>&lt;p&gt;Hello,&#160;I&#160;am&#160;Marijn&#160;and&#160;this&#160;is&#160;my&#160;home&#160;page.&lt;/p&gt;<br/>&lt;p&gt;I&#160;also&#160;wrote&#160;a&#160;book!&#160;Read&#160;it<br/>
&lt;a&#160;href=&#34;http://eloquentjavascript.net&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;<br/>
&lt;/body&gt;<br/>
&lt;/html&gt;<br/>
This&#160;is&#160;what&#160;such&#160;a&#160;document&#160;would&#160;look&#160;like&#160;in&#160;the&#160;browser:<br/>
The&#160;tags,&#160;wrapped&#160;in&#160;angle&#160;brackets&#160;(&lt;&#160;and&#160;&gt;,&#160;the&#160;symbols&#160;for&#160;<i>less&#160;than&#160;</i>and<br/>
<i>greater&#160;than</i>),&#160;provide&#160;information&#160;about&#160;the&#160;structure&#160;of&#160;the&#160;document.&#160;The<br/>other&#160;text&#160;is&#160;just&#160;plain&#160;text.<br/>
The&#160;document&#160;starts&#160;with&#160;&lt;!doctype&#160;html&gt;,&#160;which&#160;tells&#160;the&#160;browser&#160;to&#160;in-<br/>
terpret&#160;the&#160;page&#160;as&#160;<i>modern&#160;</i>HTML,&#160;as&#160;opposed&#160;to&#160;various&#160;dialects&#160;that&#160;were&#160;in<br/>use&#160;in&#160;the&#160;past.<br/>
HTML&#160;documents&#160;have&#160;a&#160;head&#160;and&#160;a&#160;body.&#160;The&#160;head&#160;contains&#160;information<br/>
<i>about&#160;</i>the&#160;document,&#160;and&#160;the&#160;body&#160;contains&#160;the&#160;document&#160;itself.&#160;In&#160;this&#160;case,<br/>the&#160;head&#160;declares&#160;that&#160;the&#160;title&#160;of&#160;this&#160;document&#160;is&#160;“My&#160;home&#160;page”&#160;and&#160;that&#160;it<br/>uses&#160;the&#160;UTF-8&#160;encoding,&#160;which&#160;is&#160;a&#160;way&#160;to&#160;encode&#160;Unicode&#160;text&#160;as&#160;binary&#160;data.<br/>The&#160;document’s&#160;body&#160;contains&#160;a&#160;heading&#160;(&lt;h1&gt;,&#160;meaning&#160;“heading&#160;1”—&lt;h2&gt;&#160;to<br/>&lt;h6&gt;&#160;produce&#160;subheadings)&#160;and&#160;two&#160;paragraphs&#160;(&lt;p&gt;).<br/>
Tags&#160;come&#160;in&#160;several&#160;forms.&#160;An&#160;element,&#160;such&#160;as&#160;the&#160;body,&#160;a&#160;paragraph,&#160;or&#160;a<br/>
link,&#160;is&#160;started&#160;by&#160;an&#160;<i>opening&#160;tag&#160;</i>like&#160;&lt;p&gt;&#160;and&#160;ended&#160;by&#160;a&#160;<i>closing&#160;tag&#160;</i>like&#160;&lt;/p&gt;.<br/>Some&#160;opening&#160;tags,&#160;such&#160;as&#160;the&#160;one&#160;for&#160;the&#160;link&#160;(&lt;a&gt;),&#160;contain&#160;extra&#160;information<br/>in&#160;the&#160;form&#160;of&#160;name=&#34;value&#34;&#160;pairs.&#160;These&#160;are&#160;called&#160;<i>attributes</i>.&#160;In&#160;this&#160;case,<br/>
219<br/>
<hr/>
<a name=232></a>the&#160;destination&#160;of&#160;the&#160;link&#160;is&#160;indicated&#160;with&#160;href=&#34;http://eloquentjavascript<br/>.net&#34;,&#160;where&#160;href&#160;stands&#160;for&#160;“hypertext&#160;reference”.<br/>
Some&#160;kinds&#160;of&#160;tags&#160;do&#160;not&#160;enclose&#160;anything&#160;and&#160;thus&#160;do&#160;not&#160;need&#160;to&#160;be&#160;closed.<br/>
The&#160;metadata&#160;tag&#160;&lt;meta&#160;charset=&#34;utf-8&#34;&gt;&#160;is&#160;an&#160;example&#160;of&#160;this.<br/>
To&#160;be&#160;able&#160;to&#160;include&#160;angle&#160;brackets&#160;in&#160;the&#160;text&#160;of&#160;a&#160;document,&#160;even&#160;though<br/>
they&#160;have&#160;a&#160;special&#160;meaning&#160;in&#160;HTML,&#160;yet&#160;another&#160;form&#160;of&#160;special&#160;notation<br/>has&#160;to&#160;be&#160;introduced.&#160;A&#160;plain&#160;opening&#160;angle&#160;bracket&#160;is&#160;written&#160;as&#160;&amp;lt;&#160;(“less<br/>than”),&#160;and&#160;a&#160;closing&#160;bracket&#160;is&#160;written&#160;as&#160;&amp;gt;&#160;(“greater&#160;than”).&#160;In&#160;HTML,&#160;an<br/>ampersand&#160;(&amp;)&#160;character&#160;followed&#160;by&#160;a&#160;name&#160;or&#160;character&#160;code&#160;and&#160;a&#160;semicolon<br/>(;)&#160;is&#160;called&#160;an&#160;<i>entity&#160;</i>and&#160;will&#160;be&#160;replaced&#160;by&#160;the&#160;character&#160;it&#160;encodes.<br/>
This&#160;is&#160;analogous&#160;to&#160;the&#160;way&#160;backslashes&#160;are&#160;used&#160;in&#160;JavaScript&#160;strings.&#160;Since<br/>
this&#160;mechanism&#160;gives&#160;ampersand&#160;characters&#160;a&#160;special&#160;meaning,&#160;too,&#160;they&#160;need<br/>to&#160;be&#160;escaped&#160;as&#160;&amp;amp;.&#160;Inside&#160;attribute&#160;values,&#160;which&#160;are&#160;wrapped&#160;in&#160;double<br/>quotes,&#160;&amp;quot;&#160;can&#160;be&#160;used&#160;to&#160;insert&#160;an&#160;actual&#160;quote&#160;character.<br/>
HTML&#160;is&#160;parsed&#160;in&#160;a&#160;remarkably&#160;error-tolerant&#160;way.&#160;When&#160;tags&#160;that&#160;should<br/>
be&#160;there&#160;are&#160;missing,&#160;the&#160;browser&#160;reconstructs&#160;them.&#160;The&#160;way&#160;in&#160;which&#160;this&#160;is<br/>done&#160;has&#160;been&#160;standardized,&#160;and&#160;you&#160;can&#160;rely&#160;on&#160;all&#160;modern&#160;browsers&#160;to&#160;do&#160;it<br/>in&#160;the&#160;same&#160;way.<br/>
The&#160;following&#160;document&#160;will&#160;be&#160;treated&#160;just&#160;like&#160;the&#160;one&#160;shown&#160;previously:<br/>
&lt;!doctype&#160;html&gt;<br/>
&lt;meta&#160;charset=utf-8&gt;<br/>&lt;title&gt;My&#160;home&#160;page&lt;/title&gt;<br/>
&lt;h1&gt;My&#160;home&#160;page&lt;/h1&gt;<br/>&lt;p&gt;Hello,&#160;I&#160;am&#160;Marijn&#160;and&#160;this&#160;is&#160;my&#160;home&#160;page.<br/>&lt;p&gt;I&#160;also&#160;wrote&#160;a&#160;book!&#160;Read&#160;it<br/>
&lt;a&#160;href=http://eloquentjavascript.net&gt;here&lt;/a&gt;.<br/>
The&#160;&lt;html&gt;,&#160;&lt;head&gt;,&#160;and&#160;&lt;body&gt;&#160;tags&#160;are&#160;gone&#160;completely.&#160;The&#160;browser<br/>
knows&#160;that&#160;&lt;meta&gt;&#160;and&#160;&lt;title&gt;&#160;belong&#160;in&#160;the&#160;head&#160;and&#160;that&#160;&lt;h1&gt;&#160;means&#160;the<br/>body&#160;has&#160;started.&#160;Furthermore,&#160;I&#160;am&#160;no&#160;longer&#160;explicitly&#160;closing&#160;the&#160;para-<br/>graphs&#160;since&#160;opening&#160;a&#160;new&#160;paragraph&#160;or&#160;ending&#160;the&#160;document&#160;will&#160;close&#160;them<br/>implicitly.&#160;The&#160;quotes&#160;around&#160;the&#160;attribute&#160;values&#160;are&#160;also&#160;gone.<br/>
This&#160;book&#160;will&#160;usually&#160;omit&#160;the&#160;&lt;html&gt;,&#160;&lt;head&gt;,&#160;and&#160;&lt;body&gt;&#160;tags&#160;from&#160;exam-<br/>
ples&#160;to&#160;keep&#160;them&#160;short&#160;and&#160;free&#160;of&#160;clutter.&#160;But&#160;I&#160;<i>will&#160;</i>close&#160;tags&#160;and&#160;include<br/>quotes&#160;around&#160;attributes.<br/>
I&#160;will&#160;also&#160;usually&#160;omit&#160;the&#160;doctype&#160;and&#160;charset&#160;declaration.&#160;This&#160;is&#160;not&#160;to<br/>
be&#160;taken&#160;as&#160;an&#160;encouragement&#160;to&#160;drop&#160;these&#160;from&#160;HTML&#160;documents.&#160;Browsers<br/>will&#160;often&#160;do&#160;ridiculous&#160;things&#160;when&#160;you&#160;forget&#160;them.&#160;You&#160;should&#160;consider&#160;the<br/>
220<br/>
<hr/>
<a name=233></a>doctype&#160;and&#160;the&#160;charset&#160;metadata&#160;to&#160;be&#160;implicitly&#160;present&#160;in&#160;examples,&#160;even<br/>when&#160;they&#160;are&#160;not&#160;actually&#160;shown&#160;in&#160;the&#160;text.<br/>
<b>HTML&#160;and&#160;JavaScript</b><br/>
In&#160;the&#160;context&#160;of&#160;this&#160;book,&#160;the&#160;most&#160;important&#160;HTML&#160;tag&#160;is&#160;&lt;script&gt;.&#160;This<br/>tag&#160;allows&#160;us&#160;to&#160;include&#160;a&#160;piece&#160;of&#160;JavaScript&#160;in&#160;a&#160;document.<br/>
&lt;h1&gt;Testing&#160;alert&lt;/h1&gt;<br/>&lt;script&gt;alert(&#34;hello!&#34;);&lt;/script&gt;<br/>
Such&#160;a&#160;script&#160;will&#160;run&#160;as&#160;soon&#160;as&#160;its&#160;&lt;script&gt;&#160;tag&#160;is&#160;encountered&#160;while&#160;the<br/>
browser&#160;reads&#160;the&#160;HTML.&#160;This&#160;page&#160;will&#160;pop&#160;up&#160;a&#160;dialog&#160;when&#160;opened—the<br/>alert&#160;function&#160;resembles&#160;prompt,&#160;in&#160;that&#160;it&#160;pops&#160;up&#160;a&#160;little&#160;window,&#160;but&#160;only<br/>shows&#160;a&#160;message&#160;without&#160;asking&#160;for&#160;input.<br/>
Including&#160;large&#160;programs&#160;directly&#160;in&#160;HTML&#160;documents&#160;is&#160;often&#160;impractical.<br/>
The&#160;&lt;script&gt;&#160;tag&#160;can&#160;be&#160;given&#160;an&#160;src&#160;attribute&#160;to&#160;fetch&#160;a&#160;script&#160;file&#160;(a&#160;text&#160;file<br/>containing&#160;a&#160;JavaScript&#160;program)&#160;from&#160;a&#160;URL.<br/>
&lt;h1&gt;Testing&#160;alert&lt;/h1&gt;<br/>&lt;script&#160;src=&#34;code/hello.js&#34;&gt;&lt;/script&gt;<br/>
The&#160;<i>code/hello.js&#160;</i>file&#160;included&#160;here&#160;contains&#160;the&#160;same&#160;program—alert(&#34;<br/>
hello!&#34;).&#160;When&#160;an&#160;HTML&#160;page&#160;references&#160;other&#160;URLs&#160;as&#160;part&#160;of&#160;itself—for<br/>example,&#160;an&#160;image&#160;file&#160;or&#160;a&#160;script—web&#160;browsers&#160;will&#160;retrieve&#160;them&#160;immediately<br/>and&#160;include&#160;them&#160;in&#160;the&#160;page.<br/>
A&#160;script&#160;tag&#160;must&#160;always&#160;be&#160;closed&#160;with&#160;&lt;/script&gt;,&#160;even&#160;if&#160;it&#160;refers&#160;to&#160;a<br/>
script&#160;file&#160;and&#160;doesn’t&#160;contain&#160;any&#160;code.&#160;If&#160;you&#160;forget&#160;this,&#160;the&#160;rest&#160;of&#160;the&#160;page<br/>will&#160;be&#160;interpreted&#160;as&#160;part&#160;of&#160;the&#160;script.<br/>
You&#160;can&#160;load&#160;ES&#160;modules&#160;(see&#160;<a href="eloquent-javascripts.html#185">Chapter&#160;10)&#160;</a>in&#160;the&#160;browser&#160;by&#160;giving&#160;your<br/>
script&#160;tag&#160;a&#160;type=&#34;module&#34;&#160;attribute.&#160;Such&#160;modules&#160;can&#160;depend&#160;on&#160;other&#160;mod-<br/>ules&#160;by&#160;using&#160;URLs&#160;relative&#160;to&#160;themselves&#160;as&#160;module&#160;names&#160;in&#160;import&#160;declara-<br/>tions.<br/>
Some&#160;attributes&#160;can&#160;also&#160;contain&#160;a&#160;JavaScript&#160;program.&#160;The&#160;&lt;button&gt;&#160;tag<br/>
shown&#160;next&#160;(which&#160;shows&#160;up&#160;as&#160;a&#160;button)&#160;has&#160;an&#160;onclick&#160;attribute.&#160;The<br/>attribute’s&#160;value&#160;will&#160;be&#160;run&#160;whenever&#160;the&#160;button&#160;is&#160;clicked.<br/>
&lt;button&#160;onclick=&#34;alert('Boom!');&#34;&gt;DO&#160;NOT&#160;PRESS&lt;/button&gt;<br/>
221<br/>
<hr/>
<a name=234></a>Note&#160;that&#160;I&#160;had&#160;to&#160;use&#160;single&#160;quotes&#160;for&#160;the&#160;string&#160;in&#160;the&#160;onclick&#160;attribute<br/>
because&#160;double&#160;quotes&#160;are&#160;already&#160;used&#160;to&#160;quote&#160;the&#160;whole&#160;attribute.&#160;I&#160;could<br/>also&#160;have&#160;used&#160;&amp;quot;.<br/>
<b>In&#160;the&#160;sandbox</b><br/>
Running&#160;programs&#160;downloaded&#160;from&#160;the&#160;Internet&#160;is&#160;potentially&#160;dangerous.&#160;You<br/>do&#160;not&#160;know&#160;much&#160;about&#160;the&#160;people&#160;behind&#160;most&#160;sites&#160;you&#160;visit,&#160;and&#160;they&#160;do<br/>not&#160;necessarily&#160;mean&#160;well.&#160;Running&#160;programs&#160;by&#160;people&#160;who&#160;do&#160;not&#160;mean&#160;well<br/>is&#160;how&#160;you&#160;get&#160;your&#160;computer&#160;infected&#160;by&#160;viruses,&#160;your&#160;data&#160;stolen,&#160;and&#160;your<br/>accounts&#160;hacked.<br/>
Yet&#160;the&#160;attraction&#160;of&#160;the&#160;Web&#160;is&#160;that&#160;you&#160;can&#160;browse&#160;it&#160;without&#160;necessarily<br/>
trusting&#160;all&#160;the&#160;pages&#160;you&#160;visit.&#160;This&#160;is&#160;why&#160;browsers&#160;severely&#160;limit&#160;the&#160;things<br/>a&#160;JavaScript&#160;program&#160;may&#160;do:&#160;it&#160;can’t&#160;look&#160;at&#160;the&#160;files&#160;on&#160;your&#160;computer&#160;or<br/>modify&#160;anything&#160;not&#160;related&#160;to&#160;the&#160;web&#160;page&#160;it&#160;was&#160;embedded&#160;in.<br/>
Isolating&#160;a&#160;programming&#160;environment&#160;in&#160;this&#160;way&#160;is&#160;called&#160;<i>sandboxing</i>,&#160;the<br/>
idea&#160;being&#160;that&#160;the&#160;program&#160;is&#160;harmlessly&#160;playing&#160;in&#160;a&#160;sandbox.&#160;But&#160;you&#160;should<br/>imagine&#160;this&#160;particular&#160;kind&#160;of&#160;sandbox&#160;as&#160;having&#160;a&#160;cage&#160;of&#160;thick&#160;steel&#160;bars&#160;over<br/>it&#160;so&#160;that&#160;the&#160;programs&#160;playing&#160;in&#160;it&#160;can’t&#160;actually&#160;get&#160;out.<br/>
The&#160;hard&#160;part&#160;of&#160;sandboxing&#160;is&#160;allowing&#160;the&#160;programs&#160;enough&#160;room&#160;to&#160;be<br/>
useful&#160;yet&#160;at&#160;the&#160;same&#160;time&#160;restricting&#160;them&#160;from&#160;doing&#160;anything&#160;dangerous.<br/>Lots&#160;of&#160;useful&#160;functionality,&#160;such&#160;as&#160;communicating&#160;with&#160;other&#160;servers&#160;or&#160;read-<br/>ing&#160;the&#160;content&#160;of&#160;the&#160;copy-paste&#160;clipboard,&#160;can&#160;also&#160;be&#160;used&#160;to&#160;do&#160;problematic,<br/>privacy-invading&#160;things.<br/>
Every&#160;now&#160;and&#160;then,&#160;someone&#160;comes&#160;up&#160;with&#160;a&#160;new&#160;way&#160;to&#160;circumvent&#160;the<br/>
limitations&#160;of&#160;a&#160;browser&#160;and&#160;do&#160;something&#160;harmful,&#160;ranging&#160;from&#160;leaking&#160;minor<br/>private&#160;information&#160;to&#160;taking&#160;over&#160;the&#160;whole&#160;machine&#160;that&#160;the&#160;browser&#160;runs&#160;on.<br/>The&#160;browser&#160;developers&#160;respond&#160;by&#160;fixing&#160;the&#160;hole,&#160;and&#160;all&#160;is&#160;well&#160;again—until<br/>the&#160;next&#160;problem&#160;is&#160;discovered,&#160;and&#160;hopefully&#160;publicized,&#160;rather&#160;than&#160;secretly<br/>exploited&#160;by&#160;some&#160;government&#160;agency&#160;or&#160;mafia.<br/>
<b>Compatibility&#160;and&#160;the&#160;browser&#160;wars</b><br/>
In&#160;the&#160;early&#160;stages&#160;of&#160;the&#160;Web,&#160;a&#160;browser&#160;called&#160;Mosaic&#160;dominated&#160;the&#160;mar-<br/>ket.&#160;After&#160;a&#160;few&#160;years,&#160;the&#160;balance&#160;shifted&#160;to&#160;Netscape,&#160;which&#160;was&#160;then,&#160;in<br/>turn,&#160;largely&#160;supplanted&#160;by&#160;Microsoft’s&#160;Internet&#160;Explorer.&#160;At&#160;any&#160;point&#160;where<br/>a&#160;single&#160;browser&#160;was&#160;dominant,&#160;that&#160;browser’s&#160;vendor&#160;would&#160;feel&#160;entitled&#160;to<br/>unilaterally&#160;invent&#160;new&#160;features&#160;for&#160;the&#160;Web.&#160;Since&#160;most&#160;users&#160;used&#160;the&#160;most<br/>
222<br/>
<hr/>
<a name=235></a>popular&#160;browser,&#160;websites&#160;would&#160;simply&#160;start&#160;using&#160;those&#160;features—never&#160;mind<br/>the&#160;other&#160;browsers.<br/>
This&#160;was&#160;the&#160;dark&#160;age&#160;of&#160;compatibility,&#160;often&#160;called&#160;the&#160;<i>browser&#160;wars</i>.&#160;Web<br/>
developers&#160;were&#160;left&#160;with&#160;not&#160;one&#160;unified&#160;Web&#160;but&#160;two&#160;or&#160;three&#160;incompatible<br/>platforms.&#160;To&#160;make&#160;things&#160;worse,&#160;the&#160;browsers&#160;in&#160;use&#160;around&#160;2003&#160;were&#160;all&#160;full<br/>of&#160;bugs,&#160;and&#160;of&#160;course&#160;the&#160;bugs&#160;were&#160;different&#160;for&#160;each&#160;browser.&#160;Life&#160;was&#160;hard<br/>for&#160;people&#160;writing&#160;web&#160;pages.<br/>
Mozilla&#160;Firefox,&#160;a&#160;not-for-profit&#160;offshoot&#160;of&#160;Netscape,&#160;challenged&#160;Internet<br/>
Explorer’s&#160;position&#160;in&#160;the&#160;late&#160;2000s.&#160;Because&#160;Microsoft&#160;was&#160;not&#160;particularly<br/>interested&#160;in&#160;staying&#160;competitive&#160;at&#160;the&#160;time,&#160;Firefox&#160;took&#160;a&#160;lot&#160;of&#160;market&#160;share<br/>away&#160;from&#160;it.&#160;Around&#160;the&#160;same&#160;time,&#160;Google&#160;introduced&#160;its&#160;Chrome&#160;browser,<br/>and&#160;Apple’s&#160;Safari&#160;browser&#160;gained&#160;popularity,&#160;leading&#160;to&#160;a&#160;situation&#160;where&#160;there<br/>were&#160;four&#160;major&#160;players,&#160;rather&#160;than&#160;one.<br/>
The&#160;new&#160;players&#160;had&#160;a&#160;more&#160;serious&#160;attitude&#160;toward&#160;standards&#160;and&#160;better<br/>
engineering&#160;practices,&#160;giving&#160;us&#160;less&#160;incompatibility&#160;and&#160;fewer&#160;bugs.&#160;Microsoft,<br/>seeing&#160;its&#160;market&#160;share&#160;crumble,&#160;came&#160;around&#160;and&#160;adopted&#160;these&#160;attitudes&#160;in<br/>its&#160;Edge&#160;browser,&#160;which&#160;replaces&#160;Internet&#160;Explorer.&#160;If&#160;you&#160;are&#160;starting&#160;to&#160;learn<br/>web&#160;development&#160;today,&#160;consider&#160;yourself&#160;lucky.&#160;The&#160;latest&#160;versions&#160;of&#160;the<br/>major&#160;browsers&#160;behave&#160;quite&#160;uniformly&#160;and&#160;have&#160;relatively&#160;few&#160;bugs.<br/>
223<br/>
<hr/>
<a name=236></a><i>“Too&#160;bad!&#160;Same&#160;old&#160;story!&#160;Once&#160;you’ve&#160;finished&#160;building&#160;your&#160;house</i><br/>
<i>you&#160;notice&#160;you’ve&#160;accidentally&#160;learned&#160;something&#160;that&#160;you&#160;really<br/>should&#160;have&#160;known—before&#160;you&#160;started.”</i><br/>
—Friedrich&#160;Nietzsche,&#160;Beyond&#160;Good&#160;and&#160;Evil<br/>
<b>Chapter&#160;14<br/>The&#160;Document&#160;Object&#160;Model</b><br/>
When&#160;you&#160;open&#160;a&#160;web&#160;page&#160;in&#160;your&#160;browser,&#160;the&#160;browser&#160;retrieves&#160;the&#160;page’s<br/>HTML&#160;text&#160;and&#160;parses&#160;it,&#160;much&#160;like&#160;the&#160;way&#160;our&#160;parser&#160;from&#160;<a href="eloquent-javascripts.html#214">Chapter&#160;12&#160;</a>parsed<br/>programs.&#160;The&#160;browser&#160;builds&#160;up&#160;a&#160;model&#160;of&#160;the&#160;document’s&#160;structure&#160;and&#160;uses<br/>this&#160;model&#160;to&#160;draw&#160;the&#160;page&#160;on&#160;the&#160;screen.<br/>
This&#160;representation&#160;of&#160;the&#160;document&#160;is&#160;one&#160;of&#160;the&#160;toys&#160;that&#160;a&#160;JavaScript<br/>
program&#160;has&#160;available&#160;in&#160;its&#160;sandbox.&#160;It&#160;is&#160;a&#160;data&#160;structure&#160;that&#160;you&#160;can&#160;read<br/>or&#160;modify.&#160;It&#160;acts&#160;as&#160;a&#160;<i>live&#160;</i>data&#160;structure:&#160;when&#160;it’s&#160;modified,&#160;the&#160;page&#160;on&#160;the<br/>screen&#160;is&#160;updated&#160;to&#160;reflect&#160;the&#160;changes.<br/>
<b>Document&#160;structure</b><br/>
You&#160;can&#160;imagine&#160;an&#160;HTML&#160;document&#160;as&#160;a&#160;nested&#160;set&#160;of&#160;boxes.&#160;Tags&#160;such&#160;as<br/>&lt;body&gt;&#160;and&#160;&lt;/body&gt;&#160;enclose&#160;other&#160;tags,&#160;which&#160;in&#160;turn&#160;contain&#160;other&#160;tags&#160;or<br/>text.&#160;Here’s&#160;the&#160;example&#160;document&#160;from&#160;the&#160;<a href="eloquent-javascripts.html#228">previous&#160;chapter:</a><br/>
&lt;!doctype&#160;html&gt;<br/>&lt;html&gt;<br/>
&lt;head&gt;<br/>
&lt;title&gt;My&#160;home&#160;page&lt;/title&gt;<br/>
&lt;/head&gt;<br/>&lt;body&gt;<br/>
&lt;h1&gt;My&#160;home&#160;page&lt;/h1&gt;<br/>&lt;p&gt;Hello,&#160;I&#160;am&#160;Marijn&#160;and&#160;this&#160;is&#160;my&#160;home&#160;page.&lt;/p&gt;<br/>&lt;p&gt;I&#160;also&#160;wrote&#160;a&#160;book!&#160;Read&#160;it<br/>
&lt;a&#160;href=&#34;http://eloquentjavascript.net&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;<br/>
&lt;/body&gt;<br/>
&lt;/html&gt;<br/>
This&#160;page&#160;has&#160;the&#160;following&#160;structure:<br/>
224<br/>
<hr/>
<a name=237></a>html<br/>
head<br/>
title<br/>
My home page<br/>
body<br/>
h1<br/>
My home page<br/>
p<br/>
Hello, I am&#160;Marijn and&#160;this is...<br/>
p<br/>
a<br/>
I also wrote a book! Read it<br/>
here<br/>
.<br/>
The&#160;data&#160;structure&#160;the&#160;browser&#160;uses&#160;to&#160;represent&#160;the&#160;document&#160;follows&#160;this<br/>
shape.&#160;For&#160;each&#160;box,&#160;there&#160;is&#160;an&#160;object,&#160;which&#160;we&#160;can&#160;interact&#160;with&#160;to&#160;find<br/>out&#160;things&#160;such&#160;as&#160;what&#160;HTML&#160;tag&#160;it&#160;represents&#160;and&#160;which&#160;boxes&#160;and&#160;text&#160;it<br/>contains.&#160;This&#160;representation&#160;is&#160;called&#160;the&#160;<i>Document&#160;Object&#160;Model</i>,&#160;or&#160;DOM<br/>for&#160;short.<br/>
The&#160;global&#160;binding&#160;document&#160;gives&#160;us&#160;access&#160;to&#160;these&#160;objects.&#160;Its&#160;documentElement<br/>
property&#160;refers&#160;to&#160;the&#160;object&#160;representing&#160;the&#160;&lt;html&gt;&#160;tag.&#160;Since&#160;every&#160;HTML<br/>
document&#160;has&#160;a&#160;head&#160;and&#160;a&#160;body,&#160;it&#160;also&#160;has&#160;head&#160;and&#160;body&#160;properties,&#160;pointing<br/>at&#160;those&#160;elements.<br/>
<b>Trees</b><br/>
Think&#160;back&#160;to&#160;the&#160;syntax&#160;trees&#160;from&#160;<a href="eloquent-javascripts.html#214">Chapter&#160;12&#160;</a>for&#160;a&#160;moment.&#160;Their&#160;structures<br/>are&#160;strikingly&#160;similar&#160;to&#160;the&#160;structure&#160;of&#160;a&#160;browser’s&#160;document.&#160;Each&#160;<i>node&#160;</i>may<br/>refer&#160;to&#160;other&#160;nodes,&#160;<i>children</i>,&#160;which&#160;in&#160;turn&#160;may&#160;have&#160;their&#160;own&#160;children.&#160;This<br/>shape&#160;is&#160;typical&#160;of&#160;nested&#160;structures&#160;where&#160;elements&#160;can&#160;contain&#160;subelements<br/>that&#160;are&#160;similar&#160;to&#160;themselves.<br/>
We&#160;call&#160;a&#160;data&#160;structure&#160;a&#160;<i>tree&#160;</i>when&#160;it&#160;has&#160;a&#160;branching&#160;structure,&#160;has&#160;no<br/>
cycles&#160;(a&#160;node&#160;may&#160;not&#160;contain&#160;itself,&#160;directly&#160;or&#160;indirectly),&#160;and&#160;has&#160;a&#160;single,<br/>well-defined&#160;<i>root</i>.&#160;In&#160;the&#160;case&#160;of&#160;the&#160;DOM,&#160;document.documentElement&#160;serves<br/>as&#160;the&#160;root.<br/>
Trees&#160;come&#160;up&#160;a&#160;lot&#160;in&#160;computer&#160;science.&#160;In&#160;addition&#160;to&#160;representing&#160;recur-<br/>
sive&#160;structures&#160;such&#160;as&#160;HTML&#160;documents&#160;or&#160;programs,&#160;they&#160;are&#160;often&#160;used&#160;to<br/>maintain&#160;sorted&#160;sets&#160;of&#160;data&#160;because&#160;elements&#160;can&#160;usually&#160;be&#160;found&#160;or&#160;inserted<br/>
225<br/>
<hr/>
<a name=238></a>more&#160;efficiently&#160;in&#160;a&#160;tree&#160;than&#160;in&#160;a&#160;flat&#160;array.<br/>
A&#160;typical&#160;tree&#160;has&#160;different&#160;kinds&#160;of&#160;nodes.&#160;The&#160;syntax&#160;tree&#160;for&#160;<a href="eloquent-javascripts.html#214">the&#160;Egg</a><br/>
<a href="eloquent-javascripts.html#214">language&#160;</a>had&#160;identifiers,&#160;values,&#160;and&#160;application&#160;nodes.&#160;Application&#160;nodes<br/>may&#160;have&#160;children,&#160;whereas&#160;identifiers&#160;and&#160;values&#160;are&#160;<i>leaves</i>,&#160;or&#160;nodes&#160;without<br/>children.<br/>
The&#160;same&#160;goes&#160;for&#160;the&#160;DOM.&#160;Nodes&#160;for&#160;<i>elements</i>,&#160;which&#160;represent&#160;HTML<br/>
tags,&#160;determine&#160;the&#160;structure&#160;of&#160;the&#160;document.&#160;These&#160;can&#160;have&#160;child&#160;nodes.<br/>An&#160;example&#160;of&#160;such&#160;a&#160;node&#160;is&#160;document.body.&#160;Some&#160;of&#160;these&#160;children&#160;can&#160;be<br/>leaf&#160;nodes,&#160;such&#160;as&#160;pieces&#160;of&#160;text&#160;or&#160;comment&#160;nodes.<br/>
Each&#160;DOM&#160;node&#160;object&#160;has&#160;a&#160;nodeType&#160;property,&#160;which&#160;contains&#160;a&#160;code<br/>
(number)&#160;that&#160;identifies&#160;the&#160;type&#160;of&#160;node.&#160;Elements&#160;have&#160;code&#160;1,&#160;which&#160;is&#160;also<br/>defined&#160;as&#160;the&#160;constant&#160;property&#160;Node.ELEMENT_NODE.&#160;Text&#160;nodes,&#160;representing<br/>a&#160;section&#160;of&#160;text&#160;in&#160;the&#160;document,&#160;get&#160;code&#160;3&#160;(Node.TEXT_NODE).&#160;Comments<br/>have&#160;code&#160;8&#160;(Node.COMMENT_NODE).<br/>
Another&#160;way&#160;to&#160;visualize&#160;our&#160;document&#160;tree&#160;is&#160;as&#160;follows:<br/>
html<br/>
head<br/>
title<br/>
My home page<br/>
body<br/>
h1<br/>
My home page<br/>
p<br/>
Hello! I am...<br/>
p<br/>
I also wrote...<br/>
a<br/>
here<br/>
.<br/>
The&#160;leaves&#160;are&#160;text&#160;nodes,&#160;and&#160;the&#160;arrows&#160;indicate&#160;parent-child&#160;relationships<br/>
between&#160;nodes.<br/>
<b>The&#160;standard</b><br/>
Using&#160;cryptic&#160;numeric&#160;codes&#160;to&#160;represent&#160;node&#160;types&#160;is&#160;not&#160;a&#160;very&#160;JavaScript-<br/>like&#160;thing&#160;to&#160;do.&#160;Later&#160;in&#160;this&#160;chapter,&#160;we’ll&#160;see&#160;that&#160;other&#160;parts&#160;of&#160;the&#160;DOM<br/>interface&#160;also&#160;feel&#160;cumbersome&#160;and&#160;alien.&#160;The&#160;reason&#160;for&#160;this&#160;is&#160;that&#160;the&#160;DOM<br/>wasn’t&#160;designed&#160;for&#160;just&#160;JavaScript.&#160;Rather,&#160;it&#160;tries&#160;to&#160;be&#160;a&#160;language-neutral<br/>interface&#160;that&#160;can&#160;be&#160;used&#160;in&#160;other&#160;systems&#160;as&#160;well—not&#160;just&#160;for&#160;HTML&#160;but<br/>also&#160;for&#160;XML,&#160;which&#160;is&#160;a&#160;generic&#160;data&#160;format&#160;with&#160;an&#160;HTML-like&#160;syntax.<br/>
This&#160;is&#160;unfortunate.&#160;Standards&#160;are&#160;often&#160;useful.&#160;But&#160;in&#160;this&#160;case,&#160;the&#160;advan-<br/>
tage&#160;(cross-language&#160;consistency)&#160;isn’t&#160;all&#160;that&#160;compelling.&#160;Having&#160;an&#160;interface<br/>that&#160;is&#160;properly&#160;integrated&#160;with&#160;the&#160;language&#160;you&#160;are&#160;using&#160;will&#160;save&#160;you&#160;more<br/>
226<br/>
<hr/>
<a name=239></a>time&#160;than&#160;having&#160;a&#160;familiar&#160;interface&#160;across&#160;languages.<br/>
As&#160;an&#160;example&#160;of&#160;this&#160;poor&#160;integration,&#160;consider&#160;the&#160;childNodes&#160;property<br/>
that&#160;element&#160;nodes&#160;in&#160;the&#160;DOM&#160;have.&#160;This&#160;property&#160;holds&#160;an&#160;array-like&#160;object,<br/>with&#160;a&#160;length&#160;property&#160;and&#160;properties&#160;labeled&#160;by&#160;numbers&#160;to&#160;access&#160;the&#160;child<br/>nodes.&#160;But&#160;it&#160;is&#160;an&#160;instance&#160;of&#160;the&#160;NodeList&#160;type,&#160;not&#160;a&#160;real&#160;array,&#160;so&#160;it&#160;does<br/>not&#160;have&#160;methods&#160;such&#160;as&#160;slice&#160;and&#160;map.<br/>
Then&#160;there&#160;are&#160;issues&#160;that&#160;are&#160;simply&#160;poor&#160;design.&#160;For&#160;example,&#160;there&#160;is&#160;no<br/>
way&#160;to&#160;create&#160;a&#160;new&#160;node&#160;and&#160;immediately&#160;add&#160;children&#160;or&#160;attributes&#160;to&#160;it.<br/>Instead,&#160;you&#160;have&#160;to&#160;first&#160;create&#160;it&#160;and&#160;then&#160;add&#160;the&#160;children&#160;and&#160;attributes<br/>one&#160;by&#160;one,&#160;using&#160;side&#160;effects.&#160;Code&#160;that&#160;interacts&#160;heavily&#160;with&#160;the&#160;DOM&#160;tends<br/>to&#160;get&#160;long,&#160;repetitive,&#160;and&#160;ugly.<br/>
But&#160;these&#160;flaws&#160;aren’t&#160;fatal.&#160;Since&#160;JavaScript&#160;allows&#160;us&#160;to&#160;create&#160;our&#160;own<br/>
abstractions,&#160;it&#160;is&#160;possible&#160;to&#160;design&#160;improved&#160;ways&#160;to&#160;express&#160;the&#160;operations<br/>you&#160;are&#160;performing.&#160;Many&#160;libraries&#160;intended&#160;for&#160;browser&#160;programming&#160;come<br/>with&#160;such&#160;tools.<br/>
<b>Moving&#160;through&#160;the&#160;tree</b><br/>
DOM&#160;nodes&#160;contain&#160;a&#160;wealth&#160;of&#160;links&#160;to&#160;other&#160;nearby&#160;nodes.&#160;The&#160;following<br/>diagram&#160;illustrates&#160;these:<br/>
childNodes<br/>
ﬁrstChild<br/>
body<br/>
0<br/>
h1<br/>My home page<br/>
previousSibling<br/>
1<br/>
p<br/>Hello, I am&#160;Marijn...<br/>
parentNode<br/>
nextSibling<br/>
2<br/>
p<br/>I also wrote a book! ...<br/>
lastChild<br/>
Although&#160;the&#160;diagram&#160;shows&#160;only&#160;one&#160;link&#160;of&#160;each&#160;type,&#160;every&#160;node&#160;has&#160;a<br/>
parentNode&#160;property&#160;that&#160;points&#160;to&#160;the&#160;node&#160;it&#160;is&#160;part&#160;of,&#160;if&#160;any.&#160;Likewise,<br/>every&#160;element&#160;node&#160;(node&#160;type&#160;1)&#160;has&#160;a&#160;childNodes&#160;property&#160;that&#160;points&#160;to&#160;an<br/>array-like&#160;object&#160;holding&#160;its&#160;children.<br/>
In&#160;theory,&#160;you&#160;could&#160;move&#160;anywhere&#160;in&#160;the&#160;tree&#160;using&#160;just&#160;these&#160;parent&#160;and<br/>
child&#160;links.&#160;But&#160;JavaScript&#160;also&#160;gives&#160;you&#160;access&#160;to&#160;a&#160;number&#160;of&#160;additional<br/>convenience&#160;links.&#160;The&#160;firstChild&#160;and&#160;lastChild&#160;properties&#160;point&#160;to&#160;the&#160;first<br/>and&#160;last&#160;child&#160;elements&#160;or&#160;have&#160;the&#160;value&#160;null&#160;for&#160;nodes&#160;without&#160;children.<br/>
227<br/>
<hr/>
<a name=240></a>Similarly,&#160;previousSibling&#160;and&#160;nextSibling&#160;point&#160;to&#160;adjacent&#160;nodes,&#160;which<br/>are&#160;nodes&#160;with&#160;the&#160;same&#160;parent&#160;that&#160;appear&#160;immediately&#160;before&#160;or&#160;after&#160;the<br/>node&#160;itself.&#160;For&#160;a&#160;first&#160;child,&#160;previousSibling&#160;will&#160;be&#160;null,&#160;and&#160;for&#160;a&#160;last&#160;child,<br/>nextSibling&#160;will&#160;be&#160;null.<br/>
There’s&#160;also&#160;the&#160;children&#160;property,&#160;which&#160;is&#160;like&#160;childNodes&#160;but&#160;contains<br/>
only&#160;element&#160;(type&#160;1)&#160;children,&#160;not&#160;other&#160;types&#160;of&#160;child&#160;nodes.&#160;This&#160;can&#160;be<br/>useful&#160;when&#160;you&#160;aren’t&#160;interested&#160;in&#160;text&#160;nodes.<br/>
When&#160;dealing&#160;with&#160;a&#160;nested&#160;data&#160;structure&#160;like&#160;this&#160;one,&#160;recursive&#160;functions<br/>
are&#160;often&#160;useful.&#160;The&#160;following&#160;function&#160;scans&#160;a&#160;document&#160;for&#160;text&#160;nodes&#160;con-<br/>taining&#160;a&#160;given&#160;string&#160;and&#160;returns&#160;true&#160;when&#160;it&#160;has&#160;found&#160;one:<br/>
function&#160;talksAbout(node,&#160;string)&#160;{<br/>
if&#160;(node.nodeType&#160;==&#160;Node.ELEMENT_NODE)&#160;{<br/>
for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;node.childNodes.length;&#160;i++)&#160;{<br/>
if&#160;(talksAbout(node.childNodes[i],&#160;string))&#160;{<br/>
return&#160;true;<br/>
}<br/>
}<br/>return&#160;false;<br/>
}&#160;else&#160;if&#160;(node.nodeType&#160;==&#160;Node.TEXT_NODE)&#160;{<br/>
return&#160;node.nodeValue.indexOf(string)&#160;&gt;&#160;-1;<br/>
}<br/>
}<br/>
console.log(talksAbout(document.body,&#160;&#34;book&#34;));<br/>//&#160;→&#160;true<br/>
Because&#160;childNodes&#160;is&#160;not&#160;a&#160;real&#160;array,&#160;we&#160;cannot&#160;loop&#160;over&#160;it&#160;with&#160;for/of<br/>
and&#160;have&#160;to&#160;run&#160;over&#160;the&#160;index&#160;range&#160;using&#160;a&#160;regular&#160;for&#160;loop&#160;or&#160;use&#160;Array.from.<br/>
The&#160;nodeValue&#160;property&#160;of&#160;a&#160;text&#160;node&#160;holds&#160;the&#160;string&#160;of&#160;text&#160;that&#160;it&#160;repre-<br/>
sents.<br/>
<b>Finding&#160;elements</b><br/>
Navigating&#160;these&#160;links&#160;among&#160;parents,&#160;children,&#160;and&#160;siblings&#160;is&#160;often&#160;useful.<br/>But&#160;if&#160;we&#160;want&#160;to&#160;find&#160;a&#160;specific&#160;node&#160;in&#160;the&#160;document,&#160;reaching&#160;it&#160;by&#160;starting<br/>at&#160;document.body&#160;and&#160;following&#160;a&#160;fixed&#160;path&#160;of&#160;properties&#160;is&#160;a&#160;bad&#160;idea.&#160;Do-<br/>ing&#160;so&#160;bakes&#160;assumptions&#160;into&#160;our&#160;program&#160;about&#160;the&#160;precise&#160;structure&#160;of&#160;the<br/>document—a&#160;structure&#160;you&#160;might&#160;want&#160;to&#160;change&#160;later.&#160;Another&#160;complicating<br/>factor&#160;is&#160;that&#160;text&#160;nodes&#160;are&#160;created&#160;even&#160;for&#160;the&#160;whitespace&#160;between&#160;nodes.<br/>The&#160;example&#160;document’s&#160;&lt;body&gt;&#160;tag&#160;does&#160;not&#160;have&#160;just&#160;three&#160;children&#160;(&lt;h1&gt;<br/>
228<br/>
<hr/>
<a name=241></a>and&#160;two&#160;&lt;p&gt;&#160;elements)&#160;but&#160;actually&#160;has&#160;seven:&#160;those&#160;three,&#160;plus&#160;the&#160;spaces<br/>before,&#160;after,&#160;and&#160;between&#160;them.<br/>
So&#160;if&#160;we&#160;want&#160;to&#160;get&#160;the&#160;href&#160;attribute&#160;of&#160;the&#160;link&#160;in&#160;that&#160;document,&#160;we<br/>
don’t&#160;want&#160;to&#160;say&#160;something&#160;like&#160;“Get&#160;the&#160;second&#160;child&#160;of&#160;the&#160;sixth&#160;child&#160;of<br/>the&#160;document&#160;body”.&#160;It’d&#160;be&#160;better&#160;if&#160;we&#160;could&#160;say&#160;“Get&#160;the&#160;first&#160;link&#160;in&#160;the<br/>document”.&#160;And&#160;we&#160;can.<br/>
let&#160;link&#160;=&#160;document.body.getElementsByTagName(&#34;a&#34;)[0];<br/>console.log(link.href);<br/>
All&#160;element&#160;nodes&#160;have&#160;a&#160;getElementsByTagName&#160;method,&#160;which&#160;collects&#160;all<br/>
elements&#160;with&#160;the&#160;given&#160;tag&#160;name&#160;that&#160;are&#160;descendants&#160;(direct&#160;or&#160;indirect&#160;chil-<br/>dren)&#160;of&#160;that&#160;node&#160;and&#160;returns&#160;them&#160;as&#160;an&#160;array-like&#160;object.<br/>
To&#160;find&#160;a&#160;specific&#160;<i>single&#160;</i>node,&#160;you&#160;can&#160;give&#160;it&#160;an&#160;id&#160;attribute&#160;and&#160;use&#160;document<br/>
.getElementById&#160;instead.<br/>
&lt;p&gt;My&#160;ostrich&#160;Gertrude:&lt;/p&gt;<br/>&lt;p&gt;&lt;img&#160;id=&#34;gertrude&#34;&#160;src=&#34;img/ostrich.png&#34;&gt;&lt;/p&gt;<br/>
&lt;script&gt;<br/>
let&#160;ostrich&#160;=&#160;document.getElementById(&#34;gertrude&#34;);<br/>console.log(ostrich.src);<br/>
&lt;/script&gt;<br/>
A&#160;third,&#160;similar&#160;method&#160;is&#160;getElementsByClassName,&#160;which,&#160;like&#160;getElementsByTagName<br/>
,&#160;searches&#160;through&#160;the&#160;contents&#160;of&#160;an&#160;element&#160;node&#160;and&#160;retrieves&#160;all&#160;elements<br/>that&#160;have&#160;the&#160;given&#160;string&#160;in&#160;their&#160;class&#160;attribute.<br/>
<b>Changing&#160;the&#160;document</b><br/>
Almost&#160;everything&#160;about&#160;the&#160;DOM&#160;data&#160;structure&#160;can&#160;be&#160;changed.&#160;The&#160;shape<br/>of&#160;the&#160;document&#160;tree&#160;can&#160;be&#160;modified&#160;by&#160;changing&#160;parent-child&#160;relationships.<br/>Nodes&#160;have&#160;a&#160;remove&#160;method&#160;to&#160;remove&#160;them&#160;from&#160;their&#160;current&#160;parent&#160;node.<br/>To&#160;add&#160;a&#160;child&#160;node&#160;to&#160;an&#160;element&#160;node,&#160;we&#160;can&#160;use&#160;appendChild,&#160;which&#160;puts<br/>it&#160;at&#160;the&#160;end&#160;of&#160;the&#160;list&#160;of&#160;children,&#160;or&#160;insertBefore,&#160;which&#160;inserts&#160;the&#160;node<br/>given&#160;as&#160;the&#160;first&#160;argument&#160;before&#160;the&#160;node&#160;given&#160;as&#160;the&#160;second&#160;argument.<br/>
&lt;p&gt;One&lt;/p&gt;<br/>&lt;p&gt;Two&lt;/p&gt;<br/>&lt;p&gt;Three&lt;/p&gt;<br/>
229<br/>
<hr/>
<a name=242></a>&lt;script&gt;<br/>
let&#160;paragraphs&#160;=&#160;document.body.getElementsByTagName(&#34;p&#34;);<br/>document.body.insertBefore(paragraphs[2],&#160;paragraphs[0]);<br/>
&lt;/script&gt;<br/>
A&#160;node&#160;can&#160;exist&#160;in&#160;the&#160;document&#160;in&#160;only&#160;one&#160;place.&#160;Thus,&#160;inserting&#160;para-<br/>
graph&#160;<i>Three&#160;</i>in&#160;front&#160;of&#160;paragraph&#160;<i>One&#160;</i>will&#160;first&#160;remove&#160;it&#160;from&#160;the&#160;end&#160;of&#160;the<br/>document&#160;and&#160;then&#160;insert&#160;it&#160;at&#160;the&#160;front,&#160;resulting&#160;in&#160;<i>Three</i>/<i>One</i>/<i>Two</i>.&#160;All<br/>operations&#160;that&#160;insert&#160;a&#160;node&#160;somewhere&#160;will,&#160;as&#160;a&#160;side&#160;effect,&#160;cause&#160;it&#160;to&#160;be<br/>removed&#160;from&#160;its&#160;current&#160;position&#160;(if&#160;it&#160;has&#160;one).<br/>
The&#160;replaceChild&#160;method&#160;is&#160;used&#160;to&#160;replace&#160;a&#160;child&#160;node&#160;with&#160;another&#160;one.<br/>
It&#160;takes&#160;as&#160;arguments&#160;two&#160;nodes:&#160;a&#160;new&#160;node&#160;and&#160;the&#160;node&#160;to&#160;be&#160;replaced.&#160;The<br/>replaced&#160;node&#160;must&#160;be&#160;a&#160;child&#160;of&#160;the&#160;element&#160;the&#160;method&#160;is&#160;called&#160;on.&#160;Note<br/>that&#160;both&#160;replaceChild&#160;and&#160;insertBefore&#160;expect&#160;the&#160;<i>new&#160;</i>node&#160;as&#160;their&#160;first<br/>argument.<br/>
<b>Creating&#160;nodes</b><br/>
Say&#160;we&#160;want&#160;to&#160;write&#160;a&#160;script&#160;that&#160;replaces&#160;all&#160;images&#160;(&lt;img&gt;&#160;tags)&#160;in&#160;the&#160;doc-<br/>ument&#160;with&#160;the&#160;text&#160;held&#160;in&#160;their&#160;alt&#160;attributes,&#160;which&#160;specifies&#160;an&#160;alternative<br/>textual&#160;representation&#160;of&#160;the&#160;image.<br/>
This&#160;involves&#160;not&#160;only&#160;removing&#160;the&#160;images&#160;but&#160;adding&#160;a&#160;new&#160;text&#160;node<br/>
to&#160;replace&#160;them.&#160;Text&#160;nodes&#160;are&#160;created&#160;with&#160;the&#160;document.createTextNode<br/>method.<br/>
&lt;p&gt;The&#160;&lt;img&#160;src=&#34;img/cat.png&#34;&#160;alt=&#34;Cat&#34;&gt;&#160;in&#160;the<br/>
&lt;img&#160;src=&#34;img/hat.png&#34;&#160;alt=&#34;Hat&#34;&gt;.&lt;/p&gt;<br/>
&lt;p&gt;&lt;button&#160;onclick=&#34;replaceImages()&#34;&gt;Replace&lt;/button&gt;&lt;/p&gt;<br/>
&lt;script&gt;<br/>
function&#160;replaceImages()&#160;{<br/>
let&#160;images&#160;=&#160;document.body.getElementsByTagName(&#34;img&#34;);<br/>for&#160;(let&#160;i&#160;=&#160;images.length&#160;-&#160;1;&#160;i&#160;&gt;=&#160;0;&#160;i--)&#160;{<br/>
let&#160;image&#160;=&#160;images[i];<br/>if&#160;(image.alt)&#160;{<br/>
let&#160;text&#160;=&#160;document.createTextNode(image.alt);<br/>image.parentNode.replaceChild(text,&#160;image);<br/>
}<br/>
}<br/>
}<br/>
&lt;/script&gt;<br/>
230<br/>
<hr/>
<a name=243></a>Given&#160;a&#160;string,&#160;createTextNode&#160;gives&#160;us&#160;a&#160;text&#160;node&#160;that&#160;we&#160;can&#160;insert&#160;into<br/>
the&#160;document&#160;to&#160;make&#160;it&#160;show&#160;up&#160;on&#160;the&#160;screen.<br/>
The&#160;loop&#160;that&#160;goes&#160;over&#160;the&#160;images&#160;starts&#160;at&#160;the&#160;end&#160;of&#160;the&#160;list.&#160;This&#160;is&#160;nec-<br/>
essary&#160;because&#160;the&#160;node&#160;list&#160;returned&#160;by&#160;a&#160;method&#160;like&#160;getElementsByTagName<br/>(or&#160;a&#160;property&#160;like&#160;childNodes)&#160;is&#160;<i>live</i>.&#160;That&#160;is,&#160;it&#160;is&#160;updated&#160;as&#160;the&#160;document<br/>changes.&#160;If&#160;we&#160;started&#160;from&#160;the&#160;front,&#160;removing&#160;the&#160;first&#160;image&#160;would&#160;cause&#160;the<br/>list&#160;to&#160;lose&#160;its&#160;first&#160;element&#160;so&#160;that&#160;the&#160;second&#160;time&#160;the&#160;loop&#160;repeats,&#160;where&#160;i<br/>is&#160;1,&#160;it&#160;would&#160;stop&#160;because&#160;the&#160;length&#160;of&#160;the&#160;collection&#160;is&#160;now&#160;also&#160;1.<br/>
If&#160;you&#160;want&#160;a&#160;<i>solid&#160;</i>collection&#160;of&#160;nodes,&#160;as&#160;opposed&#160;to&#160;a&#160;live&#160;one,&#160;you&#160;can<br/>
convert&#160;the&#160;collection&#160;to&#160;a&#160;real&#160;array&#160;by&#160;calling&#160;Array.from.<br/>
let&#160;arrayish&#160;=&#160;{0:&#160;&#34;one&#34;,&#160;1:&#160;&#34;two&#34;,&#160;length:&#160;2};<br/>let&#160;array&#160;=&#160;Array.from(arrayish);<br/>console.log(array.map(s&#160;=&gt;&#160;s.toUpperCase()));<br/>//&#160;→&#160;[&#34;ONE&#34;,&#160;&#34;TWO&#34;]<br/>
To&#160;create&#160;element&#160;nodes,&#160;you&#160;can&#160;use&#160;the&#160;document.createElement&#160;method.<br/>
This&#160;method&#160;takes&#160;a&#160;tag&#160;name&#160;and&#160;returns&#160;a&#160;new&#160;empty&#160;node&#160;of&#160;the&#160;given&#160;type.<br/>
The&#160;following&#160;example&#160;defines&#160;a&#160;utility&#160;elt,&#160;which&#160;creates&#160;an&#160;element&#160;node<br/>
and&#160;treats&#160;the&#160;rest&#160;of&#160;its&#160;arguments&#160;as&#160;children&#160;to&#160;that&#160;node.&#160;This&#160;function&#160;is<br/>then&#160;used&#160;to&#160;add&#160;an&#160;attribution&#160;to&#160;a&#160;quote.<br/>
&lt;blockquote&#160;id=&#34;quote&#34;&gt;<br/>
No&#160;book&#160;can&#160;ever&#160;be&#160;finished.&#160;While&#160;working&#160;on&#160;it&#160;we&#160;learn<br/>just&#160;enough&#160;to&#160;find&#160;it&#160;immature&#160;the&#160;moment&#160;we&#160;turn&#160;away<br/>from&#160;it.<br/>
&lt;/blockquote&gt;<br/>
&lt;script&gt;<br/>
function&#160;elt(type,&#160;...children)&#160;{<br/>
let&#160;node&#160;=&#160;document.createElement(type);<br/>for&#160;(let&#160;child&#160;of&#160;children)&#160;{<br/>
if&#160;(typeof&#160;child&#160;!=&#160;&#34;string&#34;)&#160;node.appendChild(child);<br/>else&#160;node.appendChild(document.createTextNode(child));<br/>
}<br/>return&#160;node;<br/>
}<br/>
document.getElementById(&#34;quote&#34;).appendChild(<br/>
elt(&#34;footer&#34;,&#160;&#34;—&#34;,<br/>
elt(&#34;strong&#34;,&#160;&#34;Karl&#160;Popper&#34;),<br/>&#34;,&#160;preface&#160;to&#160;the&#160;second&#160;edition&#160;of&#160;&#34;,<br/>
231<br/>
<hr/>
<a name=244></a><img src="eloquent-javascript-244_1.png"/><br/>
elt(&#34;em&#34;,&#160;&#34;The&#160;Open&#160;Society&#160;and&#160;Its&#160;Enemies&#34;),<br/>&#34;,&#160;1950&#34;));<br/>
&lt;/script&gt;<br/>
This&#160;is&#160;what&#160;the&#160;resulting&#160;document&#160;looks&#160;like:<br/>
<b>Attributes</b><br/>
Some&#160;element&#160;attributes,&#160;such&#160;as&#160;href&#160;for&#160;links,&#160;can&#160;be&#160;accessed&#160;through&#160;a<br/>property&#160;of&#160;the&#160;same&#160;name&#160;on&#160;the&#160;element’s&#160;DOM&#160;object.&#160;This&#160;is&#160;the&#160;case&#160;for<br/>most&#160;commonly&#160;used&#160;standard&#160;attributes.<br/>
But&#160;HTML&#160;allows&#160;you&#160;to&#160;set&#160;any&#160;attribute&#160;you&#160;want&#160;on&#160;nodes.&#160;This&#160;can&#160;be<br/>
useful&#160;because&#160;it&#160;allows&#160;you&#160;to&#160;store&#160;extra&#160;information&#160;in&#160;a&#160;document.&#160;If&#160;you<br/>make&#160;up&#160;your&#160;own&#160;attribute&#160;names,&#160;though,&#160;such&#160;attributes&#160;will&#160;not&#160;be&#160;present<br/>as&#160;properties&#160;on&#160;the&#160;element’s&#160;node.&#160;Instead,&#160;you&#160;have&#160;to&#160;use&#160;the&#160;getAttribute<br/>and&#160;setAttribute&#160;methods&#160;to&#160;work&#160;with&#160;them.<br/>
&lt;p&#160;data-classified=&#34;secret&#34;&gt;The&#160;launch&#160;code&#160;is&#160;00000000.&lt;/p&gt;<br/>&lt;p&#160;data-classified=&#34;unclassified&#34;&gt;I&#160;have&#160;two&#160;feet.&lt;/p&gt;<br/>
&lt;script&gt;<br/>
let&#160;paras&#160;=&#160;document.body.getElementsByTagName(&#34;p&#34;);<br/>for&#160;(let&#160;para&#160;of&#160;Array.from(paras))&#160;{<br/>
if&#160;(para.getAttribute(&#34;data-classified&#34;)&#160;==&#160;&#34;secret&#34;)&#160;{<br/>
para.remove();<br/>
}<br/>
}<br/>
&lt;/script&gt;<br/>
It&#160;is&#160;recommended&#160;to&#160;prefix&#160;the&#160;names&#160;of&#160;such&#160;made-up&#160;attributes&#160;with&#160;data-<br/>
to&#160;ensure&#160;they&#160;do&#160;not&#160;conflict&#160;with&#160;any&#160;other&#160;attributes.<br/>
There&#160;is&#160;a&#160;commonly&#160;used&#160;attribute,&#160;class,&#160;which&#160;is&#160;a&#160;keyword&#160;in&#160;the<br/>
JavaScript&#160;language.&#160;For&#160;historical&#160;reasons—some&#160;old&#160;JavaScript&#160;implementa-<br/>tions&#160;could&#160;not&#160;handle&#160;property&#160;names&#160;that&#160;matched&#160;keywords—the&#160;property<br/>used&#160;to&#160;access&#160;this&#160;attribute&#160;is&#160;called&#160;className.&#160;You&#160;can&#160;also&#160;access&#160;it&#160;under<br/>its&#160;real&#160;name,&#160;&#34;class&#34;,&#160;by&#160;using&#160;the&#160;getAttribute&#160;and&#160;setAttribute&#160;methods.<br/>
232<br/>
<hr/>
<a name=245></a><img src="eloquent-javascript-245_1.png"/><br/>
<b>Layout</b><br/>
You&#160;may&#160;have&#160;noticed&#160;that&#160;different&#160;types&#160;of&#160;elements&#160;are&#160;laid&#160;out&#160;differently.<br/>Some,&#160;such&#160;as&#160;paragraphs&#160;(&lt;p&gt;)&#160;or&#160;headings&#160;(&lt;h1&gt;),&#160;take&#160;up&#160;the&#160;whole&#160;width<br/>of&#160;the&#160;document&#160;and&#160;are&#160;rendered&#160;on&#160;separate&#160;lines.&#160;These&#160;are&#160;called&#160;<i>block<br/></i>elements.&#160;Others,&#160;such&#160;as&#160;links&#160;(&lt;a&gt;)&#160;or&#160;the&#160;&lt;strong&gt;&#160;element,&#160;are&#160;rendered<br/>on&#160;the&#160;same&#160;line&#160;with&#160;their&#160;surrounding&#160;text.&#160;Such&#160;elements&#160;are&#160;called&#160;<i>inline<br/></i>elements.<br/>
For&#160;any&#160;given&#160;document,&#160;browsers&#160;are&#160;able&#160;to&#160;compute&#160;a&#160;layout,&#160;which&#160;gives<br/>
each&#160;element&#160;a&#160;size&#160;and&#160;position&#160;based&#160;on&#160;its&#160;type&#160;and&#160;content.&#160;This&#160;layout&#160;is<br/>then&#160;used&#160;to&#160;actually&#160;draw&#160;the&#160;document.<br/>
The&#160;size&#160;and&#160;position&#160;of&#160;an&#160;element&#160;can&#160;be&#160;accessed&#160;from&#160;JavaScript.&#160;The<br/>
offsetWidth&#160;and&#160;offsetHeight&#160;properties&#160;give&#160;you&#160;the&#160;space&#160;the&#160;element&#160;takes<br/>up&#160;in&#160;<i>pixels</i>.&#160;A&#160;pixel&#160;is&#160;the&#160;basic&#160;unit&#160;of&#160;measurement&#160;in&#160;the&#160;browser.&#160;It<br/>traditionally&#160;corresponds&#160;to&#160;the&#160;smallest&#160;dot&#160;that&#160;the&#160;screen&#160;can&#160;draw,&#160;but&#160;on<br/>modern&#160;displays,&#160;which&#160;can&#160;draw&#160;<i>very&#160;</i>small&#160;dots,&#160;that&#160;may&#160;no&#160;longer&#160;be&#160;the<br/>case,&#160;and&#160;a&#160;browser&#160;pixel&#160;may&#160;span&#160;multiple&#160;display&#160;dots.<br/>
Similarly,&#160;clientWidth&#160;and&#160;clientHeight&#160;give&#160;you&#160;the&#160;size&#160;of&#160;the&#160;space&#160;<i>inside</i><br/>
the&#160;element,&#160;ignoring&#160;border&#160;width.<br/>
&lt;p&#160;style=&#34;border:&#160;3px&#160;solid&#160;red&#34;&gt;<br/>
I'm&#160;boxed&#160;in<br/>
&lt;/p&gt;<br/>
&lt;script&gt;<br/>
let&#160;para&#160;=&#160;document.body.getElementsByTagName(&#34;p&#34;)[0];<br/>console.log(&#34;clientHeight:&#34;,&#160;para.clientHeight);<br/>console.log(&#34;offsetHeight:&#34;,&#160;para.offsetHeight);<br/>
&lt;/script&gt;<br/>
Giving&#160;a&#160;paragraph&#160;a&#160;border&#160;causes&#160;a&#160;rectangle&#160;to&#160;be&#160;drawn&#160;around&#160;it.<br/>
The&#160;most&#160;effective&#160;way&#160;to&#160;find&#160;the&#160;precise&#160;position&#160;of&#160;an&#160;element&#160;on&#160;the<br/>
screen&#160;is&#160;the&#160;getBoundingClientRect&#160;method.&#160;It&#160;returns&#160;an&#160;object&#160;with&#160;top,<br/>bottom,&#160;left,&#160;and&#160;right&#160;properties,&#160;indicating&#160;the&#160;pixel&#160;positions&#160;of&#160;the&#160;sides<br/>of&#160;the&#160;element&#160;relative&#160;to&#160;the&#160;top&#160;left&#160;of&#160;the&#160;screen.&#160;If&#160;you&#160;want&#160;them&#160;relative<br/>to&#160;the&#160;whole&#160;document,&#160;you&#160;must&#160;add&#160;the&#160;current&#160;scroll&#160;position,&#160;which&#160;you<br/>can&#160;find&#160;in&#160;the&#160;pageXOffset&#160;and&#160;pageYOffset&#160;bindings.<br/>
Laying&#160;out&#160;a&#160;document&#160;can&#160;be&#160;quite&#160;a&#160;lot&#160;of&#160;work.<br/>
In&#160;the&#160;interest&#160;of<br/>
233<br/>
<hr/>
<a name=246></a>speed,&#160;browser&#160;engines&#160;do&#160;not&#160;immediately&#160;re-layout&#160;a&#160;document&#160;every&#160;time<br/>you&#160;change&#160;it&#160;but&#160;wait&#160;as&#160;long&#160;as&#160;they&#160;can.&#160;When&#160;a&#160;JavaScript&#160;program&#160;that<br/>changed&#160;the&#160;document&#160;finishes&#160;running,&#160;the&#160;browser&#160;will&#160;have&#160;to&#160;compute&#160;a&#160;new<br/>layout&#160;to&#160;draw&#160;the&#160;changed&#160;document&#160;to&#160;the&#160;screen.&#160;When&#160;a&#160;program&#160;<i>asks&#160;</i>for<br/>the&#160;position&#160;or&#160;size&#160;of&#160;something&#160;by&#160;reading&#160;properties&#160;such&#160;as&#160;offsetHeight<br/>or&#160;calling&#160;getBoundingClientRect,&#160;providing&#160;correct&#160;information&#160;also&#160;requires<br/>computing&#160;a&#160;layout.<br/>
A&#160;program&#160;that&#160;repeatedly&#160;alternates&#160;between&#160;reading&#160;DOM&#160;layout&#160;infor-<br/>
mation&#160;and&#160;changing&#160;the&#160;DOM&#160;forces&#160;a&#160;lot&#160;of&#160;layout&#160;computations&#160;to&#160;happen<br/>and&#160;will&#160;consequently&#160;run&#160;very&#160;slowly.&#160;The&#160;following&#160;code&#160;is&#160;an&#160;example&#160;of<br/>this.&#160;It&#160;contains&#160;two&#160;different&#160;programs&#160;that&#160;build&#160;up&#160;a&#160;line&#160;of&#160;<i>X&#160;</i>characters<br/>2,000&#160;pixels&#160;wide&#160;and&#160;measures&#160;the&#160;time&#160;each&#160;one&#160;takes.<br/>
&lt;p&gt;&lt;span&#160;id=&#34;one&#34;&gt;&lt;/span&gt;&lt;/p&gt;<br/>&lt;p&gt;&lt;span&#160;id=&#34;two&#34;&gt;&lt;/span&gt;&lt;/p&gt;<br/>
&lt;script&gt;<br/>
function&#160;time(name,&#160;action)&#160;{<br/>
let&#160;start&#160;=&#160;Date.now();&#160;//&#160;Current&#160;time&#160;in&#160;milliseconds<br/>action();<br/>console.log(name,&#160;&#34;took&#34;,&#160;Date.now()&#160;-&#160;start,&#160;&#34;ms&#34;);<br/>
}<br/>
time(&#34;naive&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;target&#160;=&#160;document.getElementById(&#34;one&#34;);<br/>while&#160;(target.offsetWidth&#160;&lt;&#160;2000)&#160;{<br/>
target.appendChild(document.createTextNode(&#34;X&#34;));<br/>
}<br/>
});<br/>//&#160;→&#160;naive&#160;took&#160;32&#160;ms<br/>
time(&#34;clever&#34;,&#160;function()&#160;{<br/>
let&#160;target&#160;=&#160;document.getElementById(&#34;two&#34;);<br/>target.appendChild(document.createTextNode(&#34;XXXXX&#34;));<br/>let&#160;total&#160;=&#160;Math.ceil(2000&#160;/&#160;(target.offsetWidth&#160;/&#160;5));<br/>target.firstChild.nodeValue&#160;=&#160;&#34;X&#34;.repeat(total);<br/>
});<br/>//&#160;→&#160;clever&#160;took&#160;1&#160;ms<br/>
&lt;/script&gt;<br/>
234<br/>
<hr/>
<a name=247></a><img src="eloquent-javascript-247_1.png"/><br/>
<img src="eloquent-javascript-247_2.png"/><br/>
<b>Styling</b><br/>
We&#160;have&#160;seen&#160;that&#160;different&#160;HTML&#160;elements&#160;are&#160;drawn&#160;differently.&#160;Some&#160;are<br/>displayed&#160;as&#160;blocks,&#160;others&#160;inline.&#160;Some&#160;add&#160;styling—&lt;strong&gt;&#160;makes&#160;its&#160;con-<br/>tent&#160;bold,&#160;and&#160;&lt;a&gt;&#160;makes&#160;it&#160;blue&#160;and&#160;underlines&#160;it.<br/>
The&#160;way&#160;an&#160;&lt;img&gt;&#160;tag&#160;shows&#160;an&#160;image&#160;or&#160;an&#160;&lt;a&gt;&#160;tag&#160;causes&#160;a&#160;link&#160;to&#160;be&#160;fol-<br/>
lowed&#160;when&#160;it&#160;is&#160;clicked&#160;is&#160;strongly&#160;tied&#160;to&#160;the&#160;element&#160;type.&#160;But&#160;we&#160;can&#160;change<br/>the&#160;styling&#160;associated&#160;with&#160;an&#160;element,&#160;such&#160;as&#160;the&#160;text&#160;color&#160;or&#160;underline.&#160;Here<br/>is&#160;an&#160;example&#160;that&#160;uses&#160;the&#160;style&#160;property:<br/>
&lt;p&gt;&lt;a&#160;href=&#34;.&#34;&gt;Normal&#160;link&lt;/a&gt;&lt;/p&gt;<br/>&lt;p&gt;&lt;a&#160;href=&#34;.&#34;&#160;style=&#34;color:&#160;green&#34;&gt;Green&#160;link&lt;/a&gt;&lt;/p&gt;<br/>
The&#160;second&#160;link&#160;will&#160;be&#160;green&#160;instead&#160;of&#160;the&#160;default&#160;link&#160;color.<br/>
A&#160;style&#160;attribute&#160;may&#160;contain&#160;one&#160;or&#160;more&#160;<i>declarations</i>,&#160;which&#160;are&#160;a&#160;property<br/>
(such&#160;as&#160;color)&#160;followed&#160;by&#160;a&#160;colon&#160;and&#160;a&#160;value&#160;(such&#160;as&#160;green).&#160;When&#160;there<br/>is&#160;more&#160;than&#160;one&#160;declaration,&#160;they&#160;must&#160;be&#160;separated&#160;by&#160;semicolons,&#160;as&#160;in<br/>&#34;color:&#160;red;&#160;border:&#160;none&#34;.<br/>
A&#160;lot&#160;of&#160;aspects&#160;of&#160;the&#160;document&#160;can&#160;be&#160;influenced&#160;by&#160;styling.&#160;For&#160;example,<br/>
the&#160;display&#160;property&#160;controls&#160;whether&#160;an&#160;element&#160;is&#160;displayed&#160;as&#160;a&#160;block&#160;or&#160;an<br/>inline&#160;element.<br/>
This&#160;text&#160;is&#160;displayed&#160;&lt;strong&gt;inline&lt;/strong&gt;,<br/>&lt;strong&#160;style=&#34;display:&#160;block&#34;&gt;as&#160;a&#160;block&lt;/strong&gt;,&#160;and<br/>&lt;strong&#160;style=&#34;display:&#160;none&#34;&gt;not&#160;at&#160;all&lt;/strong&gt;.<br/>
The&#160;block&#160;tag&#160;will&#160;end&#160;up&#160;on&#160;its&#160;own&#160;line&#160;since&#160;block&#160;elements&#160;are&#160;not<br/>
displayed&#160;inline&#160;with&#160;the&#160;text&#160;around&#160;them.&#160;The&#160;last&#160;tag&#160;is&#160;not&#160;displayed&#160;at<br/>all—display:&#160;none&#160;prevents&#160;an&#160;element&#160;from&#160;showing&#160;up&#160;on&#160;the&#160;screen.&#160;This<br/>is&#160;a&#160;way&#160;to&#160;hide&#160;elements.&#160;It&#160;is&#160;often&#160;preferable&#160;to&#160;removing&#160;them&#160;from&#160;the<br/>document&#160;entirely&#160;because&#160;it&#160;makes&#160;it&#160;easy&#160;to&#160;reveal&#160;them&#160;again&#160;later.<br/>
JavaScript&#160;code&#160;can&#160;directly&#160;manipulate&#160;the&#160;style&#160;of&#160;an&#160;element&#160;through&#160;the<br/>
235<br/>
<hr/>
<a name=248></a>element’s&#160;style&#160;property.&#160;This&#160;property&#160;holds&#160;an&#160;object&#160;that&#160;has&#160;properties&#160;for<br/>all&#160;possible&#160;style&#160;properties.&#160;The&#160;values&#160;of&#160;these&#160;properties&#160;are&#160;strings,&#160;which<br/>we&#160;can&#160;write&#160;to&#160;in&#160;order&#160;to&#160;change&#160;a&#160;particular&#160;aspect&#160;of&#160;the&#160;element’s&#160;style.<br/>
&lt;p&#160;id=&#34;para&#34;&#160;style=&#34;color:&#160;purple&#34;&gt;<br/>
Nice&#160;text<br/>
&lt;/p&gt;<br/>
&lt;script&gt;<br/>
let&#160;para&#160;=&#160;document.getElementById(&#34;para&#34;);<br/>console.log(para.style.color);<br/>para.style.color&#160;=&#160;&#34;magenta&#34;;<br/>
&lt;/script&gt;<br/>
Some&#160;style&#160;property&#160;names&#160;contain&#160;hyphens,&#160;such&#160;as&#160;font-family.&#160;Because<br/>
such&#160;property&#160;names&#160;are&#160;awkward&#160;to&#160;work&#160;with&#160;in&#160;JavaScript&#160;(you’d&#160;have&#160;to<br/>say&#160;style[&#34;font-family&#34;]),&#160;the&#160;property&#160;names&#160;in&#160;the&#160;style&#160;object&#160;for&#160;such<br/>properties&#160;have&#160;their&#160;hyphens&#160;removed&#160;and&#160;the&#160;letters&#160;after&#160;them&#160;capitalized<br/>(style.fontFamily).<br/>
<b>Cascading&#160;styles</b><br/>
The&#160;styling&#160;system&#160;for&#160;HTML&#160;is&#160;called&#160;CSS,&#160;for&#160;<i>Cascading&#160;Style&#160;Sheets</i>.&#160;A&#160;<i>style<br/>sheet&#160;</i>is&#160;a&#160;set&#160;of&#160;rules&#160;for&#160;how&#160;to&#160;style&#160;elements&#160;in&#160;a&#160;document.&#160;It&#160;can&#160;be&#160;given<br/>inside&#160;a&#160;&lt;style&gt;&#160;tag.<br/>
&lt;style&gt;<br/>
strong&#160;{<br/>
font-style:&#160;italic;<br/>color:&#160;gray;<br/>
}<br/>
&lt;/style&gt;<br/>&lt;p&gt;Now&#160;&lt;strong&gt;strong&#160;text&lt;/strong&gt;&#160;is&#160;italic&#160;and&#160;gray.&lt;/p&gt;<br/>
The&#160;<i>cascading&#160;</i>in&#160;the&#160;name&#160;refers&#160;to&#160;the&#160;fact&#160;that&#160;multiple&#160;such&#160;rules&#160;are<br/>
combined&#160;to&#160;produce&#160;the&#160;final&#160;style&#160;for&#160;an&#160;element.&#160;In&#160;the&#160;example,&#160;the&#160;default<br/>styling&#160;for&#160;&lt;strong&gt;&#160;tags,&#160;which&#160;gives&#160;them&#160;font-weight:&#160;bold,&#160;is&#160;overlaid&#160;by<br/>the&#160;rule&#160;in&#160;the&#160;&lt;style&gt;&#160;tag,&#160;which&#160;adds&#160;font-style&#160;and&#160;color.<br/>
When&#160;multiple&#160;rules&#160;define&#160;a&#160;value&#160;for&#160;the&#160;same&#160;property,&#160;the&#160;most&#160;recently<br/>
read&#160;rule&#160;gets&#160;a&#160;higher&#160;precedence&#160;and&#160;wins.&#160;So&#160;if&#160;the&#160;rule&#160;in&#160;the&#160;&lt;style&gt;&#160;tag<br/>included&#160;font-weight:&#160;normal,&#160;contradicting&#160;the&#160;default&#160;font-weight&#160;rule,&#160;the<br/>
236<br/>
<hr/>
<a name=249></a>text&#160;would&#160;be&#160;normal,&#160;<i>not&#160;</i>bold.&#160;Styles&#160;in&#160;a&#160;style&#160;attribute&#160;applied&#160;directly&#160;to<br/>the&#160;node&#160;have&#160;the&#160;highest&#160;precedence&#160;and&#160;always&#160;win.<br/>
It&#160;is&#160;possible&#160;to&#160;target&#160;things&#160;other&#160;than&#160;tag&#160;names&#160;in&#160;CSS&#160;rules.&#160;A&#160;rule&#160;for<br/>
.abc&#160;applies&#160;to&#160;all&#160;elements&#160;with&#160;&#34;abc&#34;&#160;in&#160;their&#160;class&#160;attribute.&#160;A&#160;rule&#160;for&#160;#xyz<br/>applies&#160;to&#160;the&#160;element&#160;with&#160;an&#160;id&#160;attribute&#160;of&#160;&#34;xyz&#34;&#160;(which&#160;should&#160;be&#160;unique<br/>within&#160;the&#160;document).<br/>
.subtle&#160;{<br/>
color:&#160;gray;<br/>font-size:&#160;80%;<br/>
}<br/>#header&#160;{<br/>
background:&#160;blue;<br/>color:&#160;white;<br/>
}<br/>/*&#160;p&#160;elements&#160;with&#160;id&#160;main&#160;and&#160;with&#160;classes&#160;a&#160;and&#160;b&#160;*/<br/>p#main.a.b&#160;{<br/>
margin-bottom:&#160;20px;<br/>
}<br/>
The&#160;precedence&#160;rule&#160;favoring&#160;the&#160;most&#160;recently&#160;defined&#160;rule&#160;applies&#160;only<br/>
when&#160;the&#160;rules&#160;have&#160;the&#160;same&#160;<i>specificity</i>.&#160;A&#160;rule’s&#160;specificity&#160;is&#160;a&#160;measure&#160;of<br/>how&#160;precisely&#160;it&#160;describes&#160;matching&#160;elements,&#160;determined&#160;by&#160;the&#160;number&#160;and<br/>kind&#160;(tag,&#160;class,&#160;or&#160;ID)&#160;of&#160;element&#160;aspects&#160;it&#160;requires.&#160;For&#160;example,&#160;a&#160;rule&#160;that<br/>targets&#160;p.a&#160;is&#160;more&#160;specific&#160;than&#160;rules&#160;that&#160;target&#160;p&#160;or&#160;just&#160;.a&#160;and&#160;would&#160;thus<br/>take&#160;precedence&#160;over&#160;them.<br/>
The&#160;notation&#160;p&#160;&gt;&#160;a&#160;…{}&#160;applies&#160;the&#160;given&#160;styles&#160;to&#160;all&#160;&lt;a&gt;&#160;tags&#160;that&#160;are&#160;direct<br/>
children&#160;of&#160;&lt;p&gt;&#160;tags.&#160;Similarly,&#160;p&#160;a&#160;…{}&#160;applies&#160;to&#160;all&#160;&lt;a&gt;&#160;tags&#160;inside&#160;&lt;p&gt;&#160;tags,<br/>whether&#160;they&#160;are&#160;direct&#160;or&#160;indirect&#160;children.<br/>
<b>Query&#160;selectors</b><br/>
We&#160;won’t&#160;be&#160;using&#160;style&#160;sheets&#160;all&#160;that&#160;much&#160;in&#160;this&#160;book.&#160;Understanding&#160;them<br/>is&#160;helpful&#160;when&#160;programming&#160;in&#160;the&#160;browser,&#160;but&#160;they&#160;are&#160;complicated&#160;enough<br/>to&#160;warrant&#160;a&#160;separate&#160;book.<br/>
The&#160;main&#160;reason&#160;I&#160;introduced&#160;<i>selector&#160;</i>syntax—the&#160;notation&#160;used&#160;in&#160;style<br/>
sheets&#160;to&#160;determine&#160;which&#160;elements&#160;a&#160;set&#160;of&#160;styles&#160;apply&#160;to—is&#160;that&#160;we&#160;can&#160;use<br/>this&#160;same&#160;mini-language&#160;as&#160;an&#160;effective&#160;way&#160;to&#160;find&#160;DOM&#160;elements.<br/>
The&#160;querySelectorAll&#160;method,&#160;which&#160;is&#160;defined&#160;both&#160;on&#160;the&#160;document&#160;object<br/>
and&#160;on&#160;element&#160;nodes,&#160;takes&#160;a&#160;selector&#160;string&#160;and&#160;returns&#160;a&#160;NodeList&#160;containing<br/>all&#160;the&#160;elements&#160;that&#160;it&#160;matches.<br/>
237<br/>
<hr/>
<a name=250></a>&lt;p&gt;And&#160;if&#160;you&#160;go&#160;chasing<br/>
&lt;span&#160;class=&#34;animal&#34;&gt;rabbits&lt;/span&gt;&lt;/p&gt;<br/>
&lt;p&gt;And&#160;you&#160;know&#160;you're&#160;going&#160;to&#160;fall&lt;/p&gt;<br/>&lt;p&gt;Tell&#160;'em&#160;a&#160;&lt;span&#160;class=&#34;character&#34;&gt;hookah&#160;smoking<br/>
&lt;span&#160;class=&#34;animal&#34;&gt;caterpillar&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br/>
&lt;p&gt;Has&#160;given&#160;you&#160;the&#160;call&lt;/p&gt;<br/>
&lt;script&gt;<br/>
function&#160;count(selector)&#160;{<br/>
return&#160;document.querySelectorAll(selector).length;<br/>
}<br/>console.log(count(&#34;p&#34;));<br/>
//&#160;All&#160;&lt;p&gt;&#160;elements<br/>
//&#160;→&#160;4<br/>console.log(count(&#34;.animal&#34;));<br/>
//&#160;Class&#160;animal<br/>
//&#160;→&#160;2<br/>console.log(count(&#34;p&#160;.animal&#34;));<br/>
//&#160;Animal&#160;inside&#160;of&#160;&lt;p&gt;<br/>
//&#160;→&#160;2<br/>console.log(count(&#34;p&#160;&gt;&#160;.animal&#34;));&#160;//&#160;Direct&#160;child&#160;of&#160;&lt;p&gt;<br/>//&#160;→&#160;1<br/>
&lt;/script&gt;<br/>
Unlike&#160;methods&#160;such&#160;as&#160;getElementsByTagName,&#160;the&#160;object&#160;returned&#160;by&#160;querySelectorAll<br/>
is&#160;<i>not&#160;</i>live.&#160;It&#160;won’t&#160;change&#160;when&#160;you&#160;change&#160;the&#160;document.&#160;It&#160;is&#160;still&#160;not&#160;a<br/>
real&#160;array,&#160;though,&#160;so&#160;you&#160;still&#160;need&#160;to&#160;call&#160;Array.from&#160;if&#160;you&#160;want&#160;to&#160;treat&#160;it<br/>like&#160;one.<br/>
The&#160;querySelector&#160;method&#160;(without&#160;the&#160;All&#160;part)&#160;works&#160;in&#160;a&#160;similar&#160;way.<br/>
This&#160;one&#160;is&#160;useful&#160;if&#160;you&#160;want&#160;a&#160;specific,&#160;single&#160;element.&#160;It&#160;will&#160;return&#160;only&#160;the<br/>first&#160;matching&#160;element&#160;or&#160;null&#160;when&#160;no&#160;element&#160;matches.<br/>
<b>Positioning&#160;and&#160;animating</b><br/>
The&#160;position&#160;style&#160;property&#160;influences&#160;layout&#160;in&#160;a&#160;powerful&#160;way.&#160;By&#160;default<br/>it&#160;has&#160;a&#160;value&#160;of&#160;static,&#160;meaning&#160;the&#160;element&#160;sits&#160;in&#160;its&#160;normal&#160;place&#160;in&#160;the<br/>document.&#160;When&#160;it&#160;is&#160;set&#160;to&#160;relative,&#160;the&#160;element&#160;still&#160;takes&#160;up&#160;space&#160;in&#160;the<br/>document,&#160;but&#160;now&#160;the&#160;top&#160;and&#160;left&#160;style&#160;properties&#160;can&#160;be&#160;used&#160;to&#160;move&#160;it<br/>relative&#160;to&#160;that&#160;normal&#160;place.&#160;When&#160;position&#160;is&#160;set&#160;to&#160;absolute,&#160;the&#160;element&#160;is<br/>removed&#160;from&#160;the&#160;normal&#160;document&#160;flow—that&#160;is,&#160;it&#160;no&#160;longer&#160;takes&#160;up&#160;space<br/>and&#160;may&#160;overlap&#160;with&#160;other&#160;elements.&#160;Also,&#160;its&#160;top&#160;and&#160;left&#160;properties&#160;can<br/>be&#160;used&#160;to&#160;absolutely&#160;position&#160;it&#160;relative&#160;to&#160;the&#160;top-left&#160;corner&#160;of&#160;the&#160;near-<br/>est&#160;enclosing&#160;element&#160;whose&#160;position&#160;property&#160;isn’t&#160;static,&#160;or&#160;relative&#160;to&#160;the<br/>document&#160;if&#160;no&#160;such&#160;enclosing&#160;element&#160;exists.<br/>
238<br/>
<hr/>
<a name=251></a><img src="eloquent-javascript-251_1.png"/><br/>
We&#160;can&#160;use&#160;this&#160;to&#160;create&#160;an&#160;animation.&#160;The&#160;following&#160;document&#160;displays&#160;a<br/>
picture&#160;of&#160;a&#160;cat&#160;that&#160;moves&#160;around&#160;in&#160;an&#160;ellipse:<br/>
&lt;p&#160;style=&#34;text-align:&#160;center&#34;&gt;<br/>
&lt;img&#160;src=&#34;img/cat.png&#34;&#160;style=&#34;position:&#160;relative&#34;&gt;<br/>
&lt;/p&gt;<br/>&lt;script&gt;<br/>
let&#160;cat&#160;=&#160;document.querySelector(&#34;img&#34;);<br/>let&#160;angle&#160;=&#160;Math.PI&#160;/&#160;2;<br/>function&#160;animate(time,&#160;lastTime)&#160;{<br/>
if&#160;(lastTime&#160;!=&#160;null)&#160;{<br/>
angle&#160;+=&#160;(time&#160;-&#160;lastTime)&#160;*&#160;0.001;<br/>
}<br/>cat.style.top&#160;=&#160;(Math.sin(angle)&#160;*&#160;20)&#160;+&#160;&#34;px&#34;;<br/>cat.style.left&#160;=&#160;(Math.cos(angle)&#160;*&#160;200)&#160;+&#160;&#34;px&#34;;<br/>requestAnimationFrame(newTime&#160;=&gt;&#160;animate(newTime,&#160;time));<br/>
}<br/>requestAnimationFrame(animate);<br/>
&lt;/script&gt;<br/>
The&#160;gray&#160;arrow&#160;shows&#160;the&#160;path&#160;along&#160;which&#160;the&#160;image&#160;moves.<br/>
Our&#160;picture&#160;is&#160;centered&#160;on&#160;the&#160;page&#160;and&#160;given&#160;a&#160;position&#160;of&#160;relative.&#160;We’ll<br/>
repeatedly&#160;update&#160;that&#160;picture’s&#160;top&#160;and&#160;left&#160;styles&#160;to&#160;move&#160;it.<br/>
The&#160;script&#160;uses&#160;requestAnimationFrame&#160;to&#160;schedule&#160;the&#160;animate&#160;function&#160;to<br/>
run&#160;whenever&#160;the&#160;browser&#160;is&#160;ready&#160;to&#160;repaint&#160;the&#160;screen.&#160;The&#160;animate&#160;function<br/>itself&#160;again&#160;calls&#160;requestAnimationFrame&#160;to&#160;schedule&#160;the&#160;next&#160;update.&#160;When<br/>the&#160;browser&#160;window&#160;(or&#160;tab)&#160;is&#160;active,&#160;this&#160;will&#160;cause&#160;updates&#160;to&#160;happen&#160;at&#160;a<br/>rate&#160;of&#160;about&#160;60&#160;per&#160;second,&#160;which&#160;tends&#160;to&#160;produce&#160;a&#160;good-looking&#160;animation.<br/>
If&#160;we&#160;just&#160;updated&#160;the&#160;DOM&#160;in&#160;a&#160;loop,&#160;the&#160;page&#160;would&#160;freeze,&#160;and&#160;nothing<br/>
would&#160;show&#160;up&#160;on&#160;the&#160;screen.&#160;Browsers&#160;do&#160;not&#160;update&#160;their&#160;display&#160;while&#160;a<br/>JavaScript&#160;program&#160;is&#160;running,&#160;nor&#160;do&#160;they&#160;allow&#160;any&#160;interaction&#160;with&#160;the&#160;page.<br/>This&#160;is&#160;why&#160;we&#160;need&#160;requestAnimationFrame—it&#160;lets&#160;the&#160;browser&#160;know&#160;that&#160;we<br/>are&#160;done&#160;for&#160;now,&#160;and&#160;it&#160;can&#160;go&#160;ahead&#160;and&#160;do&#160;the&#160;things&#160;that&#160;browsers&#160;do,&#160;such<br/>as&#160;updating&#160;the&#160;screen&#160;and&#160;responding&#160;to&#160;user&#160;actions.<br/>
The&#160;animation&#160;function&#160;is&#160;passed&#160;the&#160;current&#160;time&#160;as&#160;an&#160;argument.&#160;To&#160;ensure<br/>
that&#160;the&#160;motion&#160;of&#160;the&#160;cat&#160;per&#160;millisecond&#160;is&#160;stable,&#160;it&#160;bases&#160;the&#160;speed&#160;at&#160;which<br/>
239<br/>
<hr/>
<a name=252></a>the&#160;angle&#160;changes&#160;on&#160;the&#160;difference&#160;between&#160;the&#160;current&#160;time&#160;and&#160;the&#160;last&#160;time<br/>the&#160;function&#160;ran.&#160;If&#160;it&#160;just&#160;moved&#160;the&#160;angle&#160;by&#160;a&#160;fixed&#160;amount&#160;per&#160;step,&#160;the<br/>motion&#160;would&#160;stutter&#160;if,&#160;for&#160;example,&#160;another&#160;heavy&#160;task&#160;running&#160;on&#160;the&#160;same<br/>computer&#160;were&#160;to&#160;prevent&#160;the&#160;function&#160;from&#160;running&#160;for&#160;a&#160;fraction&#160;of&#160;a&#160;second.<br/>
Moving&#160;in&#160;circles&#160;is&#160;done&#160;using&#160;the&#160;trigonometry&#160;functions&#160;Math.cos&#160;and&#160;Math<br/>
.sin.&#160;For&#160;those&#160;who&#160;aren’t&#160;familiar&#160;with&#160;these,&#160;I’ll&#160;briefly&#160;introduce&#160;them&#160;since<br/>we&#160;will&#160;occasionally&#160;use&#160;them&#160;in&#160;this&#160;book.<br/>
Math.cos&#160;and&#160;Math.sin&#160;are&#160;useful&#160;for&#160;finding&#160;points&#160;that&#160;lie&#160;on&#160;a&#160;circle&#160;around<br/>
point&#160;(0,0)&#160;with&#160;a&#160;radius&#160;of&#160;one.&#160;Both&#160;functions&#160;interpret&#160;their&#160;argument&#160;as<br/>the&#160;position&#160;on&#160;this&#160;circle,&#160;with&#160;zero&#160;denoting&#160;the&#160;point&#160;on&#160;the&#160;far&#160;right&#160;of&#160;the<br/>circle,&#160;going&#160;clockwise&#160;until&#160;2<i>π&#160;</i>(about&#160;6.28)&#160;has&#160;taken&#160;us&#160;around&#160;the&#160;whole<br/>circle.&#160;Math.cos&#160;tells&#160;you&#160;the&#160;x-coordinate&#160;of&#160;the&#160;point&#160;that&#160;corresponds&#160;to<br/>the&#160;given&#160;position,&#160;and&#160;Math.sin&#160;yields&#160;the&#160;y-coordinate.&#160;Positions&#160;(or&#160;angles)<br/>greater&#160;than&#160;2<i>π&#160;</i>or&#160;less&#160;than&#160;0&#160;are&#160;valid—the&#160;rotation&#160;repeats&#160;so&#160;that&#160;<i>a</i>+2<i>π<br/></i>refers&#160;to&#160;the&#160;same&#160;angle&#160;as&#160;<i>a</i>.<br/>
This&#160;unit&#160;for&#160;measuring&#160;angles&#160;is&#160;called&#160;radians—a&#160;full&#160;circle&#160;is&#160;2<i>π&#160;</i>radians,<br/>
similar&#160;to&#160;how&#160;it&#160;is&#160;360&#160;degrees&#160;when&#160;measuring&#160;in&#160;degrees.&#160;The&#160;constant&#160;<i>π&#160;</i>is<br/>available&#160;as&#160;Math.PI&#160;in&#160;JavaScript.<br/>
cos(-⅔π)<br/>
sin(-⅔π)<br/>
sin(¼π)<br/>
cos(¼π)<br/>
The&#160;cat&#160;animation&#160;code&#160;keeps&#160;a&#160;counter,&#160;angle,&#160;for&#160;the&#160;current&#160;angle&#160;of&#160;the<br/>
animation&#160;and&#160;increments&#160;it&#160;every&#160;time&#160;the&#160;animate&#160;function&#160;is&#160;called.&#160;It&#160;can<br/>then&#160;use&#160;this&#160;angle&#160;to&#160;compute&#160;the&#160;current&#160;position&#160;of&#160;the&#160;image&#160;element.&#160;The<br/>top&#160;style&#160;is&#160;computed&#160;with&#160;Math.sin&#160;and&#160;multiplied&#160;by&#160;20,&#160;which&#160;is&#160;the&#160;vertical<br/>radius&#160;of&#160;our&#160;ellipse.&#160;The&#160;left&#160;style&#160;is&#160;based&#160;on&#160;Math.cos&#160;and&#160;multiplied&#160;by<br/>200&#160;so&#160;that&#160;the&#160;ellipse&#160;is&#160;much&#160;wider&#160;than&#160;it&#160;is&#160;high.<br/>
Note&#160;that&#160;styles&#160;usually&#160;need&#160;<i>units</i>.&#160;In&#160;this&#160;case,&#160;we&#160;have&#160;to&#160;append&#160;&#34;px&#34;<br/>
to&#160;the&#160;number&#160;to&#160;tell&#160;the&#160;browser&#160;that&#160;we&#160;are&#160;counting&#160;in&#160;pixels&#160;(as&#160;opposed<br/>to&#160;centimeters,&#160;“ems”,&#160;or&#160;other&#160;units).&#160;This&#160;is&#160;easy&#160;to&#160;forget.&#160;Using&#160;numbers<br/>without&#160;units&#160;will&#160;result&#160;in&#160;your&#160;style&#160;being&#160;ignored—unless&#160;the&#160;number&#160;is&#160;0,<br/>which&#160;always&#160;means&#160;the&#160;same&#160;thing,&#160;regardless&#160;of&#160;its&#160;unit.<br/>
240<br/>
<hr/>
<a name=253></a><b>Summary</b><br/>
JavaScript&#160;programs&#160;may&#160;inspect&#160;and&#160;interfere&#160;with&#160;the&#160;document&#160;that&#160;the<br/>browser&#160;is&#160;displaying&#160;through&#160;a&#160;data&#160;structure&#160;called&#160;the&#160;DOM.&#160;This&#160;data<br/>structure&#160;represents&#160;the&#160;browser’s&#160;model&#160;of&#160;the&#160;document,&#160;and&#160;a&#160;JavaScript<br/>program&#160;can&#160;modify&#160;it&#160;to&#160;change&#160;the&#160;visible&#160;document.<br/>
The&#160;DOM&#160;is&#160;organized&#160;like&#160;a&#160;tree,&#160;in&#160;which&#160;elements&#160;are&#160;arranged&#160;hierar-<br/>
chically&#160;according&#160;to&#160;the&#160;structure&#160;of&#160;the&#160;document.&#160;The&#160;objects&#160;representing<br/>elements&#160;have&#160;properties&#160;such&#160;as&#160;parentNode&#160;and&#160;childNodes,&#160;which&#160;can&#160;be<br/>used&#160;to&#160;navigate&#160;through&#160;this&#160;tree.<br/>
The&#160;way&#160;a&#160;document&#160;is&#160;displayed&#160;can&#160;be&#160;influenced&#160;by&#160;<i>styling</i>,&#160;both&#160;by&#160;at-<br/>
taching&#160;styles&#160;to&#160;nodes&#160;directly&#160;and&#160;by&#160;defining&#160;rules&#160;that&#160;match&#160;certain&#160;nodes.<br/>There&#160;are&#160;many&#160;different&#160;style&#160;properties,&#160;such&#160;as&#160;color&#160;or&#160;display.&#160;JavaScript<br/>code&#160;can&#160;manipulate&#160;an&#160;element’s&#160;style&#160;directly&#160;through&#160;its&#160;style&#160;property.<br/>
<b>Exercises</b><br/>
<b>Build&#160;a&#160;table</b><br/>
An&#160;HTML&#160;table&#160;is&#160;built&#160;with&#160;the&#160;following&#160;tag&#160;structure:<br/>
&lt;table&gt;<br/>
&lt;tr&gt;<br/>
&lt;th&gt;name&lt;/th&gt;<br/>&lt;th&gt;height&lt;/th&gt;<br/>&lt;th&gt;place&lt;/th&gt;<br/>
&lt;/tr&gt;<br/>&lt;tr&gt;<br/>
&lt;td&gt;Kilimanjaro&lt;/td&gt;<br/>&lt;td&gt;5895&lt;/td&gt;<br/>&lt;td&gt;Tanzania&lt;/td&gt;<br/>
&lt;/tr&gt;<br/>
&lt;/table&gt;<br/>
For&#160;each&#160;<i>row</i>,&#160;the&#160;&lt;table&gt;&#160;tag&#160;contains&#160;a&#160;&lt;tr&gt;&#160;tag.&#160;Inside&#160;of&#160;these&#160;&lt;tr&gt;&#160;tags,<br/>
we&#160;can&#160;put&#160;cell&#160;elements:&#160;either&#160;heading&#160;cells&#160;(&lt;th&gt;)&#160;or&#160;regular&#160;cells&#160;(&lt;td&gt;).<br/>
Given&#160;a&#160;data&#160;set&#160;of&#160;mountains,&#160;an&#160;array&#160;of&#160;objects&#160;with&#160;name,&#160;height,&#160;and<br/>
place&#160;properties,&#160;generate&#160;the&#160;DOM&#160;structure&#160;for&#160;a&#160;table&#160;that&#160;enumerates&#160;the<br/>objects.&#160;It&#160;should&#160;have&#160;one&#160;column&#160;per&#160;key&#160;and&#160;one&#160;row&#160;per&#160;object,&#160;plus&#160;a<br/>header&#160;row&#160;with&#160;&lt;th&gt;&#160;elements&#160;at&#160;the&#160;top,&#160;listing&#160;the&#160;column&#160;names.<br/>
Write&#160;this&#160;so&#160;that&#160;the&#160;columns&#160;are&#160;automatically&#160;derived&#160;from&#160;the&#160;objects,<br/>
241<br/>
<hr/>
<a name=254></a>by&#160;taking&#160;the&#160;property&#160;names&#160;of&#160;the&#160;first&#160;object&#160;in&#160;the&#160;data.<br/>
Add&#160;the&#160;resulting&#160;table&#160;to&#160;the&#160;element&#160;with&#160;an&#160;id&#160;attribute&#160;of&#160;&#34;mountains&#34;<br/>
so&#160;that&#160;it&#160;becomes&#160;visible&#160;in&#160;the&#160;document.<br/>
Once&#160;you&#160;have&#160;this&#160;working,&#160;right-align&#160;cells&#160;that&#160;contain&#160;number&#160;values&#160;by<br/>
setting&#160;their&#160;style.textAlign&#160;property&#160;to&#160;&#34;right&#34;.<br/>
<b>Elements&#160;by&#160;tag&#160;name</b><br/>
The&#160;document.getElementsByTagName&#160;method&#160;returns&#160;all&#160;child&#160;elements&#160;with&#160;a<br/>given&#160;tag&#160;name.&#160;Implement&#160;your&#160;own&#160;version&#160;of&#160;this&#160;as&#160;a&#160;function&#160;that&#160;takes&#160;a<br/>node&#160;and&#160;a&#160;string&#160;(the&#160;tag&#160;name)&#160;as&#160;arguments&#160;and&#160;returns&#160;an&#160;array&#160;containing<br/>all&#160;descendant&#160;element&#160;nodes&#160;with&#160;the&#160;given&#160;tag&#160;name.<br/>
To&#160;find&#160;the&#160;tag&#160;name&#160;of&#160;an&#160;element,&#160;use&#160;its&#160;nodeName&#160;property.&#160;But&#160;note<br/>
that&#160;this&#160;will&#160;return&#160;the&#160;tag&#160;name&#160;in&#160;all&#160;uppercase.&#160;Use&#160;the&#160;toLowerCase&#160;or<br/>toUpperCase&#160;string&#160;methods&#160;to&#160;compensate&#160;for&#160;this.<br/>
<b>The&#160;cat's&#160;hat</b><br/>
Extend&#160;the&#160;cat&#160;animation&#160;defined&#160;<a href="eloquent-javascripts.html#250">earlier&#160;</a>so&#160;that&#160;both&#160;the&#160;cat&#160;and&#160;his&#160;hat<br/>(&lt;img&#160;src=&#34;img/hat.png&#34;&gt;)&#160;orbit&#160;at&#160;opposite&#160;sides&#160;of&#160;the&#160;ellipse.<br/>
Or&#160;make&#160;the&#160;hat&#160;circle&#160;around&#160;the&#160;cat.&#160;Or&#160;alter&#160;the&#160;animation&#160;in&#160;some&#160;other<br/>
interesting&#160;way.<br/>
To&#160;make&#160;positioning&#160;multiple&#160;objects&#160;easier,&#160;it&#160;is&#160;probably&#160;a&#160;good&#160;idea&#160;to<br/>
switch&#160;to&#160;absolute&#160;positioning.&#160;This&#160;means&#160;that&#160;top&#160;and&#160;left&#160;are&#160;counted<br/>relative&#160;to&#160;the&#160;top&#160;left&#160;of&#160;the&#160;document.&#160;To&#160;avoid&#160;using&#160;negative&#160;coordinates,<br/>which&#160;would&#160;cause&#160;the&#160;image&#160;to&#160;move&#160;outside&#160;of&#160;the&#160;visible&#160;page,&#160;you&#160;can&#160;add<br/>a&#160;fixed&#160;number&#160;of&#160;pixels&#160;to&#160;the&#160;position&#160;values.<br/>
242<br/>
<hr/>
<a name=255></a><i>“You&#160;have&#160;power&#160;over&#160;your&#160;mind—not&#160;outside&#160;events.&#160;Realize&#160;this,</i><br/>
<i>and&#160;you&#160;will&#160;find&#160;strength.”</i><br/>
—Marcus&#160;Aurelius,&#160;Meditations<br/>
<b>Chapter&#160;15<br/>Handling&#160;Events</b><br/>
Some&#160;programs&#160;work&#160;with&#160;direct&#160;user&#160;input,&#160;such&#160;as&#160;mouse&#160;and&#160;keyboard&#160;ac-<br/>tions.&#160;That&#160;kind&#160;of&#160;input&#160;isn’t&#160;available&#160;as&#160;a&#160;well-organized&#160;data&#160;structure—it<br/>comes&#160;in&#160;piece&#160;by&#160;piece,&#160;in&#160;real&#160;time,&#160;and&#160;the&#160;program&#160;is&#160;expected&#160;to&#160;respond<br/>to&#160;it&#160;as&#160;it&#160;happens.<br/>
<b>Event&#160;handlers</b><br/>
Imagine&#160;an&#160;interface&#160;where&#160;the&#160;only&#160;way&#160;to&#160;find&#160;out&#160;whether&#160;a&#160;key&#160;on&#160;the<br/>keyboard&#160;is&#160;being&#160;pressed&#160;is&#160;to&#160;read&#160;the&#160;current&#160;state&#160;of&#160;that&#160;key.&#160;To&#160;be&#160;able<br/>to&#160;react&#160;to&#160;keypresses,&#160;you&#160;would&#160;have&#160;to&#160;constantly&#160;read&#160;the&#160;key’s&#160;state&#160;so<br/>that&#160;you’d&#160;catch&#160;it&#160;before&#160;it’s&#160;released&#160;again.&#160;It&#160;would&#160;be&#160;dangerous&#160;to&#160;perform<br/>other&#160;time-intensive&#160;computations&#160;since&#160;you&#160;might&#160;miss&#160;a&#160;keypress.<br/>
Some&#160;primitive&#160;machines&#160;do&#160;handle&#160;input&#160;like&#160;that.&#160;A&#160;step&#160;up&#160;from&#160;this<br/>
would&#160;be&#160;for&#160;the&#160;hardware&#160;or&#160;operating&#160;system&#160;to&#160;notice&#160;the&#160;keypress&#160;and&#160;put<br/>it&#160;in&#160;a&#160;queue.&#160;A&#160;program&#160;can&#160;then&#160;periodically&#160;check&#160;the&#160;queue&#160;for&#160;new&#160;events<br/>and&#160;react&#160;to&#160;what&#160;it&#160;finds&#160;there.<br/>
Of&#160;course,&#160;it&#160;has&#160;to&#160;remember&#160;to&#160;look&#160;at&#160;the&#160;queue,&#160;and&#160;to&#160;do&#160;it&#160;often,&#160;because<br/>
any&#160;time&#160;between&#160;the&#160;key&#160;being&#160;pressed&#160;and&#160;the&#160;program&#160;noticing&#160;the&#160;event<br/>will&#160;cause&#160;the&#160;software&#160;to&#160;feel&#160;unresponsive.&#160;This&#160;approach&#160;is&#160;called&#160;<i>polling</i>.<br/>Most&#160;programmers&#160;prefer&#160;to&#160;avoid&#160;it.<br/>
A&#160;better&#160;mechanism&#160;is&#160;for&#160;the&#160;system&#160;to&#160;actively&#160;notify&#160;our&#160;code&#160;when&#160;an<br/>
event&#160;occurs.&#160;Browsers&#160;do&#160;this&#160;by&#160;allowing&#160;us&#160;to&#160;register&#160;functions&#160;as&#160;<i>handlers<br/></i>for&#160;specific&#160;events.<br/>
&lt;p&gt;Click&#160;this&#160;document&#160;to&#160;activate&#160;the&#160;handler.&lt;/p&gt;<br/>&lt;script&gt;<br/>
window.addEventListener(&#34;click&#34;,&#160;()&#160;=&gt;&#160;{<br/>
console.log(&#34;You&#160;knocked?&#34;);<br/>
});<br/>
&lt;/script&gt;<br/>
243<br/>
<hr/>
<a name=256></a>The&#160;window&#160;binding&#160;refers&#160;to&#160;a&#160;built-in&#160;object&#160;provided&#160;by&#160;the&#160;browser.<br/>
It&#160;represents&#160;the&#160;browser&#160;window&#160;that&#160;contains&#160;the&#160;document.&#160;Calling&#160;its<br/>addEventListener&#160;method&#160;registers&#160;the&#160;second&#160;argument&#160;to&#160;be&#160;called&#160;when-<br/>ever&#160;the&#160;event&#160;described&#160;by&#160;its&#160;first&#160;argument&#160;occurs.<br/>
<b>Events&#160;and&#160;DOM&#160;nodes</b><br/>
Each&#160;browser&#160;event&#160;handler&#160;is&#160;registered&#160;in&#160;a&#160;context.&#160;In&#160;the&#160;previous&#160;example<br/>we&#160;called&#160;addEventListener&#160;on&#160;the&#160;window&#160;object&#160;to&#160;register&#160;a&#160;handler&#160;for&#160;the<br/>whole&#160;window.&#160;Such&#160;a&#160;method&#160;can&#160;also&#160;be&#160;found&#160;on&#160;DOM&#160;elements&#160;and&#160;some<br/>other&#160;types&#160;of&#160;objects.&#160;Event&#160;listeners&#160;are&#160;called&#160;only&#160;when&#160;the&#160;event&#160;happens<br/>in&#160;the&#160;context&#160;of&#160;the&#160;object&#160;they&#160;are&#160;registered&#160;on.<br/>
&lt;button&gt;Click&#160;me&lt;/button&gt;<br/>&lt;p&gt;No&#160;handler&#160;here.&lt;/p&gt;<br/>&lt;script&gt;<br/>
let&#160;button&#160;=&#160;document.querySelector(&#34;button&#34;);<br/>button.addEventListener(&#34;click&#34;,&#160;()&#160;=&gt;&#160;{<br/>
console.log(&#34;Button&#160;clicked.&#34;);<br/>
});<br/>
&lt;/script&gt;<br/>
That&#160;example&#160;attaches&#160;a&#160;handler&#160;to&#160;the&#160;button&#160;node.&#160;Clicks&#160;on&#160;the&#160;button<br/>
cause&#160;that&#160;handler&#160;to&#160;run,&#160;but&#160;clicks&#160;on&#160;the&#160;rest&#160;of&#160;the&#160;document&#160;do&#160;not.<br/>
Giving&#160;a&#160;node&#160;an&#160;onclick&#160;attribute&#160;has&#160;a&#160;similar&#160;effect.&#160;This&#160;works&#160;for&#160;most<br/>
types&#160;of&#160;events—you&#160;can&#160;attach&#160;a&#160;handler&#160;through&#160;the&#160;attribute&#160;whose&#160;name<br/>is&#160;the&#160;event&#160;name&#160;with&#160;on&#160;in&#160;front&#160;of&#160;it.<br/>
But&#160;a&#160;node&#160;can&#160;have&#160;only&#160;one&#160;onclick&#160;attribute,&#160;so&#160;you&#160;can&#160;register&#160;only<br/>
one&#160;handler&#160;per&#160;node&#160;that&#160;way.&#160;The&#160;addEventListener&#160;method&#160;allows&#160;you&#160;to<br/>add&#160;any&#160;number&#160;of&#160;handlers&#160;so&#160;that&#160;it&#160;is&#160;safe&#160;to&#160;add&#160;handlers&#160;even&#160;if&#160;there&#160;is<br/>already&#160;another&#160;handler&#160;on&#160;the&#160;element.<br/>
The&#160;removeEventListener&#160;method,&#160;called&#160;with&#160;arguments&#160;similar&#160;to&#160;addEventListener<br/>
,&#160;removes&#160;a&#160;handler.<br/>
&lt;button&gt;Act-once&#160;button&lt;/button&gt;<br/>&lt;script&gt;<br/>
let&#160;button&#160;=&#160;document.querySelector(&#34;button&#34;);<br/>function&#160;once()&#160;{<br/>
console.log(&#34;Done.&#34;);<br/>button.removeEventListener(&#34;click&#34;,&#160;once);<br/>
}<br/>button.addEventListener(&#34;click&#34;,&#160;once);<br/>
244<br/>
<hr/>
<a name=257></a>&lt;/script&gt;<br/>
The&#160;function&#160;given&#160;to&#160;removeEventListener&#160;has&#160;to&#160;be&#160;the&#160;same&#160;function&#160;value<br/>
that&#160;was&#160;given&#160;to&#160;addEventListener.&#160;So,&#160;to&#160;unregister&#160;a&#160;handler,&#160;you’ll&#160;want<br/>to&#160;give&#160;the&#160;function&#160;a&#160;name&#160;(once,&#160;in&#160;the&#160;example)&#160;to&#160;be&#160;able&#160;to&#160;pass&#160;the&#160;same<br/>function&#160;value&#160;to&#160;both&#160;methods.<br/>
<b>Event&#160;objects</b><br/>
Though&#160;we&#160;have&#160;ignored&#160;it&#160;so&#160;far,&#160;event&#160;handler&#160;functions&#160;are&#160;passed&#160;an&#160;ar-<br/>gument:&#160;the&#160;<i>event&#160;object</i>.&#160;This&#160;object&#160;holds&#160;additional&#160;information&#160;about&#160;the<br/>event.&#160;For&#160;example,&#160;if&#160;we&#160;want&#160;to&#160;know&#160;<i>which&#160;</i>mouse&#160;button&#160;was&#160;pressed,&#160;we<br/>can&#160;look&#160;at&#160;the&#160;event&#160;object’s&#160;button&#160;property.<br/>
&lt;button&gt;Click&#160;me&#160;any&#160;way&#160;you&#160;want&lt;/button&gt;<br/>&lt;script&gt;<br/>
let&#160;button&#160;=&#160;document.querySelector(&#34;button&#34;);<br/>button.addEventListener(&#34;mousedown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.button&#160;==&#160;0)&#160;{<br/>
console.log(&#34;Left&#160;button&#34;);<br/>
}&#160;else&#160;if&#160;(event.button&#160;==&#160;1)&#160;{<br/>
console.log(&#34;Middle&#160;button&#34;);<br/>
}&#160;else&#160;if&#160;(event.button&#160;==&#160;2)&#160;{<br/>
console.log(&#34;Right&#160;button&#34;);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
The&#160;information&#160;stored&#160;in&#160;an&#160;event&#160;object&#160;differs&#160;per&#160;type&#160;of&#160;event.&#160;We’ll<br/>
discuss&#160;different&#160;types&#160;later&#160;in&#160;the&#160;chapter.&#160;The&#160;object’s&#160;type&#160;property&#160;always<br/>holds&#160;a&#160;string&#160;identifying&#160;the&#160;event&#160;(such&#160;as&#160;&#34;click&#34;&#160;or&#160;&#34;mousedown&#34;).<br/>
<b>Propagation</b><br/>
For&#160;most&#160;event&#160;types,&#160;handlers&#160;registered&#160;on&#160;nodes&#160;with&#160;children&#160;will&#160;also&#160;re-<br/>ceive&#160;events&#160;that&#160;happen&#160;in&#160;the&#160;children.&#160;If&#160;a&#160;button&#160;inside&#160;a&#160;paragraph&#160;is<br/>clicked,&#160;event&#160;handlers&#160;on&#160;the&#160;paragraph&#160;will&#160;also&#160;see&#160;the&#160;click&#160;event.<br/>
But&#160;if&#160;both&#160;the&#160;paragraph&#160;and&#160;the&#160;button&#160;have&#160;a&#160;handler,&#160;the&#160;more&#160;specific<br/>
handler—the&#160;one&#160;on&#160;the&#160;button—gets&#160;to&#160;go&#160;first.&#160;The&#160;event&#160;is&#160;said&#160;to&#160;<i>propagate<br/></i>outward,&#160;from&#160;the&#160;node&#160;where&#160;it&#160;happened&#160;to&#160;that&#160;node’s&#160;parent&#160;node&#160;and&#160;on<br/>
245<br/>
<hr/>
<a name=258></a>to&#160;the&#160;root&#160;of&#160;the&#160;document.&#160;Finally,&#160;after&#160;all&#160;handlers&#160;registered&#160;on&#160;a&#160;specific<br/>node&#160;have&#160;had&#160;their&#160;turn,&#160;handlers&#160;registered&#160;on&#160;the&#160;whole&#160;window&#160;get&#160;a&#160;chance<br/>to&#160;respond&#160;to&#160;the&#160;event.<br/>
At&#160;any&#160;point,&#160;an&#160;event&#160;handler&#160;can&#160;call&#160;the&#160;stopPropagation&#160;method&#160;on&#160;the<br/>
event&#160;object&#160;to&#160;prevent&#160;handlers&#160;further&#160;up&#160;from&#160;receiving&#160;the&#160;event.&#160;This&#160;can<br/>be&#160;useful&#160;when,&#160;for&#160;example,&#160;you&#160;have&#160;a&#160;button&#160;inside&#160;another&#160;clickable&#160;element<br/>and&#160;you&#160;don’t&#160;want&#160;clicks&#160;on&#160;the&#160;button&#160;to&#160;activate&#160;the&#160;outer&#160;element’s&#160;click<br/>behavior.<br/>
The&#160;following&#160;example&#160;registers&#160;&#34;mousedown&#34;&#160;handlers&#160;on&#160;both&#160;a&#160;button&#160;and<br/>
the&#160;paragraph&#160;around&#160;it.&#160;When&#160;clicked&#160;with&#160;the&#160;right&#160;mouse&#160;button,&#160;the&#160;han-<br/>dler&#160;for&#160;the&#160;button&#160;calls&#160;stopPropagation,&#160;which&#160;will&#160;prevent&#160;the&#160;handler&#160;on<br/>the&#160;paragraph&#160;from&#160;running.&#160;When&#160;the&#160;button&#160;is&#160;clicked&#160;with&#160;another&#160;mouse<br/>button,&#160;both&#160;handlers&#160;will&#160;run.<br/>
&lt;p&gt;A&#160;paragraph&#160;with&#160;a&#160;&lt;button&gt;button&lt;/button&gt;.&lt;/p&gt;<br/>&lt;script&gt;<br/>
let&#160;para&#160;=&#160;document.querySelector(&#34;p&#34;);<br/>let&#160;button&#160;=&#160;document.querySelector(&#34;button&#34;);<br/>para.addEventListener(&#34;mousedown&#34;,&#160;()&#160;=&gt;&#160;{<br/>
console.log(&#34;Handler&#160;for&#160;paragraph.&#34;);<br/>
});<br/>button.addEventListener(&#34;mousedown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
console.log(&#34;Handler&#160;for&#160;button.&#34;);<br/>if&#160;(event.button&#160;==&#160;2)&#160;event.stopPropagation();<br/>
});<br/>
&lt;/script&gt;<br/>
Most&#160;event&#160;objects&#160;have&#160;a&#160;target&#160;property&#160;that&#160;refers&#160;to&#160;the&#160;node&#160;where&#160;they<br/>
originated.&#160;You&#160;can&#160;use&#160;this&#160;property&#160;to&#160;ensure&#160;that&#160;you’re&#160;not&#160;accidentally<br/>handling&#160;something&#160;that&#160;propagated&#160;up&#160;from&#160;a&#160;node&#160;you&#160;do&#160;not&#160;want&#160;to&#160;handle.<br/>
It&#160;is&#160;also&#160;possible&#160;to&#160;use&#160;the&#160;target&#160;property&#160;to&#160;cast&#160;a&#160;wide&#160;net&#160;for&#160;a&#160;specific<br/>
type&#160;of&#160;event.&#160;For&#160;example,&#160;if&#160;you&#160;have&#160;a&#160;node&#160;containing&#160;a&#160;long&#160;list&#160;of&#160;buttons,<br/>it&#160;may&#160;be&#160;more&#160;convenient&#160;to&#160;register&#160;a&#160;single&#160;click&#160;handler&#160;on&#160;the&#160;outer&#160;node<br/>and&#160;have&#160;it&#160;use&#160;the&#160;target&#160;property&#160;to&#160;figure&#160;out&#160;whether&#160;a&#160;button&#160;was&#160;clicked,<br/>rather&#160;than&#160;register&#160;individual&#160;handlers&#160;on&#160;all&#160;of&#160;the&#160;buttons.<br/>
&lt;button&gt;A&lt;/button&gt;<br/>&lt;button&gt;B&lt;/button&gt;<br/>&lt;button&gt;C&lt;/button&gt;<br/>&lt;script&gt;<br/>
document.body.addEventListener(&#34;click&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.target.nodeName&#160;==&#160;&#34;BUTTON&#34;)&#160;{<br/>
246<br/>
<hr/>
<a name=259></a>console.log(&#34;Clicked&#34;,&#160;event.target.textContent);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
<b>Default&#160;actions</b><br/>
Many&#160;events&#160;have&#160;a&#160;default&#160;action&#160;associated&#160;with&#160;them.&#160;If&#160;you&#160;click&#160;a&#160;link,<br/>you&#160;will&#160;be&#160;taken&#160;to&#160;the&#160;link’s&#160;target.&#160;If&#160;you&#160;press&#160;the&#160;down&#160;arrow,&#160;the&#160;browser<br/>will&#160;scroll&#160;the&#160;page&#160;down.&#160;If&#160;you&#160;right-click,&#160;you’ll&#160;get&#160;a&#160;context&#160;menu.&#160;And&#160;so<br/>on.<br/>
For&#160;most&#160;types&#160;of&#160;events,&#160;the&#160;JavaScript&#160;event&#160;handlers&#160;are&#160;called&#160;<i>before&#160;</i>the<br/>
default&#160;behavior&#160;takes&#160;place.&#160;If&#160;the&#160;handler&#160;doesn’t&#160;want&#160;this&#160;normal&#160;behavior<br/>to&#160;happen,&#160;typically&#160;because&#160;it&#160;has&#160;already&#160;taken&#160;care&#160;of&#160;handling&#160;the&#160;event,&#160;it<br/>can&#160;call&#160;the&#160;preventDefault&#160;method&#160;on&#160;the&#160;event&#160;object.<br/>
This&#160;can&#160;be&#160;used&#160;to&#160;implement&#160;your&#160;own&#160;keyboard&#160;shortcuts&#160;or&#160;context<br/>
menu.&#160;It&#160;can&#160;also&#160;be&#160;used&#160;to&#160;obnoxiously&#160;interfere&#160;with&#160;the&#160;behavior&#160;that&#160;users<br/>expect.&#160;For&#160;example,&#160;here&#160;is&#160;a&#160;link&#160;that&#160;cannot&#160;be&#160;followed:<br/>
&lt;a&#160;href=&#34;https://developer.mozilla.org/&#34;&gt;MDN&lt;/a&gt;<br/>&lt;script&gt;<br/>
let&#160;link&#160;=&#160;document.querySelector(&#34;a&#34;);<br/>link.addEventListener(&#34;click&#34;,&#160;event&#160;=&gt;&#160;{<br/>
console.log(&#34;Nope.&#34;);<br/>event.preventDefault();<br/>
});<br/>
&lt;/script&gt;<br/>
Try&#160;not&#160;to&#160;do&#160;such&#160;things&#160;unless&#160;you&#160;have&#160;a&#160;really&#160;good&#160;reason&#160;to.&#160;It’ll&#160;be<br/>
unpleasant&#160;for&#160;people&#160;who&#160;use&#160;your&#160;page&#160;when&#160;expected&#160;behavior&#160;is&#160;broken.<br/>
Depending&#160;on&#160;the&#160;browser,&#160;some&#160;events&#160;can’t&#160;be&#160;intercepted&#160;at&#160;all.&#160;On<br/>
Chrome,&#160;for&#160;example,&#160;the&#160;keyboard&#160;shortcut&#160;to&#160;close&#160;the&#160;current&#160;tab&#160;(control-<br/>W&#160;or&#160;command-W)&#160;cannot&#160;be&#160;handled&#160;by&#160;JavaScript.<br/>
<b>Key&#160;events</b><br/>
When&#160;a&#160;key&#160;on&#160;the&#160;keyboard&#160;is&#160;pressed,&#160;your&#160;browser&#160;fires&#160;a&#160;&#34;keydown&#34;&#160;event.<br/>When&#160;it&#160;is&#160;released,&#160;you&#160;get&#160;a&#160;&#34;keyup&#34;&#160;event.<br/>
247<br/>
<hr/>
<a name=260></a>&lt;p&gt;This&#160;page&#160;turns&#160;violet&#160;when&#160;you&#160;hold&#160;the&#160;V&#160;key.&lt;/p&gt;<br/>&lt;script&gt;<br/>
window.addEventListener(&#34;keydown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.key&#160;==&#160;&#34;v&#34;)&#160;{<br/>
document.body.style.background&#160;=&#160;&#34;violet&#34;;<br/>
}<br/>
});<br/>window.addEventListener(&#34;keyup&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.key&#160;==&#160;&#34;v&#34;)&#160;{<br/>
document.body.style.background&#160;=&#160;&#34;&#34;;<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
Despite&#160;its&#160;name,&#160;&#34;keydown&#34;&#160;fires&#160;not&#160;only&#160;when&#160;the&#160;key&#160;is&#160;physically&#160;pushed<br/>
down.&#160;When&#160;a&#160;key&#160;is&#160;pressed&#160;and&#160;held,&#160;the&#160;event&#160;fires&#160;again&#160;every&#160;time&#160;the<br/>key&#160;<i>repeats</i>.&#160;Sometimes&#160;you&#160;have&#160;to&#160;be&#160;careful&#160;about&#160;this.&#160;For&#160;example,&#160;if&#160;you<br/>add&#160;a&#160;button&#160;to&#160;the&#160;DOM&#160;when&#160;a&#160;key&#160;is&#160;pressed&#160;and&#160;remove&#160;it&#160;again&#160;when&#160;the<br/>key&#160;is&#160;released,&#160;you&#160;might&#160;accidentally&#160;add&#160;hundreds&#160;of&#160;buttons&#160;when&#160;the&#160;key<br/>is&#160;held&#160;down&#160;longer.<br/>
The&#160;example&#160;looked&#160;at&#160;the&#160;key&#160;property&#160;of&#160;the&#160;event&#160;object&#160;to&#160;see&#160;which<br/>
key&#160;the&#160;event&#160;is&#160;about.&#160;This&#160;property&#160;holds&#160;a&#160;string&#160;that,&#160;for&#160;most&#160;keys,<br/>corresponds&#160;to&#160;the&#160;thing&#160;that&#160;pressing&#160;that&#160;key&#160;would&#160;type.&#160;For&#160;special&#160;keys<br/>such&#160;as&#160;enter,&#160;it&#160;holds&#160;a&#160;string&#160;that&#160;names&#160;the&#160;key&#160;(&#34;Enter&#34;,&#160;in&#160;this&#160;case).<br/>If&#160;you&#160;hold&#160;shift&#160;while&#160;pressing&#160;a&#160;key,&#160;that&#160;might&#160;also&#160;influence&#160;the&#160;name&#160;of<br/>the&#160;key—&#34;v&#34;&#160;becomes&#160;&#34;V&#34;,&#160;and&#160;&#34;1&#34;&#160;may&#160;become&#160;&#34;!&#34;,&#160;if&#160;that&#160;is&#160;what&#160;pressing<br/>shift-1&#160;produces&#160;on&#160;your&#160;keyboard.<br/>
Modifier&#160;keys&#160;such&#160;as&#160;shift,&#160;control,&#160;alt,&#160;and&#160;meta&#160;(command&#160;on&#160;Mac)<br/>
generate&#160;key&#160;events&#160;just&#160;like&#160;normal&#160;keys.&#160;But&#160;when&#160;looking&#160;for&#160;key&#160;combina-<br/>tions,&#160;you&#160;can&#160;also&#160;find&#160;out&#160;whether&#160;these&#160;keys&#160;are&#160;held&#160;down&#160;by&#160;looking&#160;at<br/>the&#160;shiftKey,&#160;ctrlKey,&#160;altKey,&#160;and&#160;metaKey&#160;properties&#160;of&#160;keyboard&#160;and&#160;mouse<br/>events.<br/>
&lt;p&gt;Press&#160;Control-Space&#160;to&#160;continue.&lt;/p&gt;<br/>&lt;script&gt;<br/>
window.addEventListener(&#34;keydown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.key&#160;==&#160;&#34;&#160;&#34;&#160;&amp;&amp;&#160;event.ctrlKey)&#160;{<br/>
console.log(&#34;Continuing!&#34;);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
248<br/>
<hr/>
<a name=261></a>The&#160;DOM&#160;node&#160;where&#160;a&#160;key&#160;event&#160;originates&#160;depends&#160;on&#160;the&#160;element&#160;that<br/>
has&#160;focus&#160;when&#160;the&#160;key&#160;is&#160;pressed.&#160;Most&#160;nodes&#160;cannot&#160;have&#160;focus&#160;unless&#160;you<br/>give&#160;them&#160;a&#160;tabindex&#160;attribute,&#160;but&#160;things&#160;like&#160;links,&#160;buttons,&#160;and&#160;form&#160;fields<br/>can.&#160;We’ll&#160;come&#160;back&#160;to&#160;form&#160;fields&#160;in&#160;<a href="eloquent-javascripts.html#326">Chapter&#160;18</a>.&#160;When&#160;nothing&#160;in&#160;particular<br/>has&#160;focus,&#160;document.body&#160;acts&#160;as&#160;the&#160;target&#160;node&#160;of&#160;key&#160;events.<br/>
When&#160;the&#160;user&#160;is&#160;typing&#160;text,&#160;using&#160;key&#160;events&#160;to&#160;figure&#160;out&#160;what&#160;is&#160;being<br/>
typed&#160;is&#160;problematic.&#160;Some&#160;platforms,&#160;most&#160;notably&#160;the&#160;virtual&#160;keyboard&#160;on<br/>Android&#160;phones,&#160;don’t&#160;fire&#160;key&#160;events.&#160;But&#160;even&#160;when&#160;you&#160;have&#160;an&#160;old-fashioned<br/>keyboard,&#160;some&#160;types&#160;of&#160;text&#160;input&#160;don’t&#160;match&#160;key&#160;presses&#160;in&#160;a&#160;straightforward<br/>way,&#160;such&#160;as&#160;<i>input&#160;method&#160;editor&#160;</i>(IME)&#160;software&#160;used&#160;by&#160;people&#160;whose&#160;scripts<br/>don’t&#160;fit&#160;on&#160;a&#160;keyboard,&#160;where&#160;multiple&#160;key&#160;strokes&#160;are&#160;combined&#160;to&#160;create<br/>characters.<br/>
To&#160;notice&#160;when&#160;something&#160;was&#160;typed,&#160;elements&#160;that&#160;you&#160;can&#160;type&#160;into,&#160;such<br/>
as&#160;the&#160;&lt;input&gt;&#160;and&#160;&lt;textarea&gt;&#160;tags,&#160;fire&#160;&#34;input&#34;&#160;events&#160;whenever&#160;the&#160;user<br/>changes&#160;their&#160;content.&#160;To&#160;get&#160;the&#160;actual&#160;content&#160;that&#160;was&#160;typed,&#160;it&#160;is&#160;best&#160;to<br/>directly&#160;read&#160;it&#160;from&#160;the&#160;focused&#160;field.&#160;<a href="eloquent-javascripts.html#326">Chapter&#160;18&#160;</a>will&#160;show&#160;how.<br/>
<b>Pointer&#160;events</b><br/>
There&#160;are&#160;currently&#160;two&#160;widely&#160;used&#160;ways&#160;to&#160;point&#160;at&#160;things&#160;on&#160;a&#160;screen:&#160;mice<br/>(including&#160;devices&#160;that&#160;act&#160;like&#160;mice,&#160;such&#160;as&#160;touchpads&#160;and&#160;trackballs)&#160;and<br/>touchscreens.&#160;These&#160;produce&#160;different&#160;kinds&#160;of&#160;events.<br/>
<b>Mouse&#160;clicks</b><br/>
Pressing&#160;a&#160;mouse&#160;button&#160;causes&#160;a&#160;number&#160;of&#160;events&#160;to&#160;fire.&#160;The&#160;&#34;mousedown&#34;<br/>and&#160;&#34;mouseup&#34;&#160;events&#160;are&#160;similar&#160;to&#160;&#34;keydown&#34;&#160;and&#160;&#34;keyup&#34;&#160;and&#160;fire&#160;when&#160;the<br/>button&#160;is&#160;pressed&#160;and&#160;released.&#160;These&#160;happen&#160;on&#160;the&#160;DOM&#160;nodes&#160;that&#160;are<br/>immediately&#160;below&#160;the&#160;mouse&#160;pointer&#160;when&#160;the&#160;event&#160;occurs.<br/>
After&#160;the&#160;&#34;mouseup&#34;&#160;event,&#160;a&#160;&#34;click&#34;&#160;event&#160;fires&#160;on&#160;the&#160;most&#160;specific&#160;node<br/>
that&#160;contained&#160;both&#160;the&#160;press&#160;and&#160;the&#160;release&#160;of&#160;the&#160;button.&#160;For&#160;example,&#160;if&#160;I<br/>press&#160;down&#160;the&#160;mouse&#160;button&#160;on&#160;one&#160;paragraph&#160;and&#160;then&#160;move&#160;the&#160;pointer&#160;to<br/>another&#160;paragraph&#160;and&#160;release&#160;the&#160;button,&#160;the&#160;&#34;click&#34;&#160;event&#160;will&#160;happen&#160;on<br/>the&#160;element&#160;that&#160;contains&#160;both&#160;those&#160;paragraphs.<br/>
If&#160;two&#160;clicks&#160;happen&#160;close&#160;together,&#160;a&#160;&#34;dblclick&#34;&#160;(double-click)&#160;event&#160;also<br/>
fires,&#160;after&#160;the&#160;second&#160;click&#160;event.<br/>
To&#160;get&#160;precise&#160;information&#160;about&#160;the&#160;place&#160;where&#160;a&#160;mouse&#160;event&#160;happened,<br/>
you&#160;can&#160;look&#160;at&#160;its&#160;clientX&#160;and&#160;clientY&#160;properties,&#160;which&#160;contain&#160;the&#160;event’s<br/>coordinates&#160;(in&#160;pixels)&#160;relative&#160;to&#160;the&#160;top-left&#160;corner&#160;of&#160;the&#160;window,&#160;or&#160;pageX<br/>
249<br/>
<hr/>
<a name=262></a>and&#160;pageY,&#160;which&#160;are&#160;relative&#160;to&#160;the&#160;top-left&#160;corner&#160;of&#160;the&#160;whole&#160;document<br/>(which&#160;may&#160;be&#160;different&#160;when&#160;the&#160;window&#160;has&#160;been&#160;scrolled).<br/>
The&#160;following&#160;implements&#160;a&#160;primitive&#160;drawing&#160;program.&#160;Every&#160;time&#160;you&#160;click<br/>
the&#160;document,&#160;it&#160;adds&#160;a&#160;dot&#160;under&#160;your&#160;mouse&#160;pointer.&#160;See&#160;<a href="eloquent-javascripts.html#342">Chapter&#160;19&#160;</a>for&#160;a<br/>less&#160;primitive&#160;drawing&#160;program.<br/>
&lt;style&gt;<br/>
body&#160;{<br/>
height:&#160;200px;<br/>background:&#160;beige;<br/>
}<br/>.dot&#160;{<br/>
height:&#160;8px;&#160;width:&#160;8px;<br/>border-radius:&#160;4px;&#160;/*&#160;rounds&#160;corners&#160;*/<br/>background:&#160;blue;<br/>position:&#160;absolute;<br/>
}<br/>
&lt;/style&gt;<br/>&lt;script&gt;<br/>
window.addEventListener(&#34;click&#34;,&#160;event&#160;=&gt;&#160;{<br/>
let&#160;dot&#160;=&#160;document.createElement(&#34;div&#34;);<br/>dot.className&#160;=&#160;&#34;dot&#34;;<br/>dot.style.left&#160;=&#160;(event.pageX&#160;-&#160;4)&#160;+&#160;&#34;px&#34;;<br/>dot.style.top&#160;=&#160;(event.pageY&#160;-&#160;4)&#160;+&#160;&#34;px&#34;;<br/>document.body.appendChild(dot);<br/>
});<br/>
&lt;/script&gt;<br/>
<b>Mouse&#160;motion</b><br/>
Every&#160;time&#160;the&#160;mouse&#160;pointer&#160;moves,&#160;a&#160;&#34;mousemove&#34;&#160;event&#160;is&#160;fired.&#160;This&#160;event<br/>can&#160;be&#160;used&#160;to&#160;track&#160;the&#160;position&#160;of&#160;the&#160;mouse.&#160;A&#160;common&#160;situation&#160;in&#160;which<br/>this&#160;is&#160;useful&#160;is&#160;when&#160;implementing&#160;some&#160;form&#160;of&#160;mouse-dragging&#160;functionality.<br/>
As&#160;an&#160;example,&#160;the&#160;following&#160;program&#160;displays&#160;a&#160;bar&#160;and&#160;sets&#160;up&#160;event&#160;han-<br/>
dlers&#160;so&#160;that&#160;dragging&#160;to&#160;the&#160;left&#160;or&#160;right&#160;on&#160;this&#160;bar&#160;makes&#160;it&#160;narrower&#160;or<br/>wider:<br/>
&lt;p&gt;Drag&#160;the&#160;bar&#160;to&#160;change&#160;its&#160;width:&lt;/p&gt;<br/>&lt;div&#160;style=&#34;background:&#160;orange;&#160;width:&#160;60px;&#160;height:&#160;20px&#34;&gt;<br/>&lt;/div&gt;<br/>&lt;script&gt;<br/>
let&#160;lastX;&#160;//&#160;Tracks&#160;the&#160;last&#160;observed&#160;mouse&#160;X&#160;position<br/>let&#160;bar&#160;=&#160;document.querySelector(&#34;div&#34;);<br/>
250<br/>
<hr/>
<a name=263></a><img src="eloquent-javascript-263_1.png"/><br/>
bar.addEventListener(&#34;mousedown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(event.button&#160;==&#160;0)&#160;{<br/>
lastX&#160;=&#160;event.clientX;<br/>window.addEventListener(&#34;mousemove&#34;,&#160;moved);<br/>event.preventDefault();&#160;//&#160;Prevent&#160;selection<br/>
}<br/>
});<br/>
function&#160;moved(event)&#160;{<br/>
if&#160;(event.buttons&#160;==&#160;0)&#160;{<br/>
window.removeEventListener(&#34;mousemove&#34;,&#160;moved);<br/>
}&#160;else&#160;{<br/>
let&#160;dist&#160;=&#160;event.clientX&#160;-&#160;lastX;<br/>let&#160;newWidth&#160;=&#160;Math.max(10,&#160;bar.offsetWidth&#160;+&#160;dist);<br/>bar.style.width&#160;=&#160;newWidth&#160;+&#160;&#34;px&#34;;<br/>lastX&#160;=&#160;event.clientX;<br/>
}<br/>
}<br/>
&lt;/script&gt;<br/>
The&#160;resulting&#160;page&#160;looks&#160;like&#160;this:<br/>
Note&#160;that&#160;the&#160;&#34;mousemove&#34;&#160;handler&#160;is&#160;registered&#160;on&#160;the&#160;whole&#160;window.&#160;Even<br/>
if&#160;the&#160;mouse&#160;goes&#160;outside&#160;of&#160;the&#160;bar&#160;during&#160;resizing,&#160;as&#160;long&#160;as&#160;the&#160;button&#160;is<br/>held&#160;we&#160;still&#160;want&#160;to&#160;update&#160;its&#160;size.<br/>
We&#160;must&#160;stop&#160;resizing&#160;the&#160;bar&#160;when&#160;the&#160;mouse&#160;button&#160;is&#160;released.&#160;For&#160;that,<br/>
we&#160;can&#160;use&#160;the&#160;buttons&#160;property&#160;(note&#160;the&#160;plural),&#160;which&#160;tells&#160;us&#160;about&#160;the<br/>buttons&#160;that&#160;are&#160;currently&#160;held&#160;down.&#160;When&#160;this&#160;is&#160;zero,&#160;no&#160;buttons&#160;are&#160;down.<br/>When&#160;buttons&#160;are&#160;held,&#160;its&#160;value&#160;is&#160;the&#160;sum&#160;of&#160;the&#160;codes&#160;for&#160;those&#160;buttons—the<br/>left&#160;button&#160;has&#160;code&#160;1,&#160;the&#160;right&#160;button&#160;2,&#160;and&#160;the&#160;middle&#160;one&#160;4.&#160;That&#160;way,<br/>you&#160;can&#160;check&#160;whether&#160;a&#160;given&#160;button&#160;is&#160;pressed&#160;by&#160;taking&#160;the&#160;remainder&#160;of<br/>the&#160;value&#160;of&#160;buttons&#160;and&#160;its&#160;code.<br/>
Note&#160;that&#160;the&#160;order&#160;of&#160;these&#160;codes&#160;is&#160;different&#160;from&#160;the&#160;one&#160;used&#160;by&#160;button,<br/>
where&#160;the&#160;middle&#160;button&#160;came&#160;before&#160;the&#160;right&#160;one.&#160;As&#160;mentioned,&#160;consistency<br/>isn’t&#160;really&#160;a&#160;strong&#160;point&#160;of&#160;the&#160;browser’s&#160;programming&#160;interface.<br/>
251<br/>
<hr/>
<a name=264></a><b>Touch&#160;events</b><br/>
The&#160;style&#160;of&#160;graphical&#160;browser&#160;that&#160;we&#160;use&#160;was&#160;designed&#160;with&#160;mouse&#160;interfaces<br/>in&#160;mind,&#160;at&#160;a&#160;time&#160;where&#160;touchscreens&#160;were&#160;rare.&#160;To&#160;make&#160;the&#160;Web&#160;“work”<br/>on&#160;early&#160;touchscreen&#160;phones,&#160;browsers&#160;for&#160;those&#160;devices&#160;pretended,&#160;to&#160;a&#160;certain<br/>extent,&#160;that&#160;touch&#160;events&#160;were&#160;mouse&#160;events.&#160;If&#160;you&#160;tap&#160;your&#160;screen,&#160;you’ll&#160;get<br/>&#34;mousedown&#34;,&#160;&#34;mouseup&#34;,&#160;and&#160;&#34;click&#34;&#160;events.<br/>
But&#160;this&#160;illusion&#160;isn’t&#160;very&#160;robust.&#160;A&#160;touchscreen&#160;works&#160;differently&#160;from&#160;a<br/>
mouse:&#160;it&#160;doesn’t&#160;have&#160;multiple&#160;buttons,&#160;you&#160;can’t&#160;track&#160;the&#160;finger&#160;when&#160;it<br/>isn’t&#160;on&#160;the&#160;screen&#160;(to&#160;simulate&#160;&#34;mousemove&#34;),&#160;and&#160;it&#160;allows&#160;multiple&#160;fingers&#160;to<br/>be&#160;on&#160;the&#160;screen&#160;at&#160;the&#160;same&#160;time.<br/>
Mouse&#160;events&#160;cover&#160;touch&#160;interaction&#160;only&#160;in&#160;straightforward&#160;cases—if&#160;you<br/>
add&#160;a&#160;&#34;click&#34;&#160;handler&#160;to&#160;a&#160;button,&#160;touch&#160;users&#160;will&#160;still&#160;be&#160;able&#160;to&#160;use&#160;it.&#160;But<br/>something&#160;like&#160;the&#160;resizeable&#160;bar&#160;in&#160;the&#160;previous&#160;example&#160;does&#160;not&#160;work&#160;on&#160;a<br/>touchscreen.<br/>
There&#160;are&#160;specific&#160;event&#160;types&#160;fired&#160;by&#160;touch&#160;interaction.&#160;When&#160;a&#160;finger&#160;starts<br/>
touching&#160;the&#160;screen,&#160;you&#160;get&#160;a&#160;&#34;touchstart&#34;&#160;event.&#160;When&#160;it&#160;is&#160;moved&#160;while<br/>touching,&#160;&#34;touchmove&#34;&#160;events&#160;fire.&#160;Finally,&#160;when&#160;it&#160;stops&#160;touching&#160;the&#160;screen,<br/>you’ll&#160;see&#160;a&#160;&#34;touchend&#34;&#160;event.<br/>
Because&#160;many&#160;touchscreens&#160;can&#160;detect&#160;multiple&#160;fingers&#160;at&#160;the&#160;same&#160;time,<br/>
these&#160;events&#160;don’t&#160;have&#160;a&#160;single&#160;set&#160;of&#160;coordinates&#160;associated&#160;with&#160;them.&#160;Rather,<br/>their&#160;event&#160;objects&#160;have&#160;a&#160;touches&#160;property,&#160;which&#160;holds&#160;an&#160;array-like&#160;object&#160;of<br/>points,&#160;each&#160;of&#160;which&#160;has&#160;its&#160;own&#160;clientX,&#160;clientY,&#160;pageX,&#160;and&#160;pageY&#160;properties.<br/>
You&#160;could&#160;do&#160;something&#160;like&#160;this&#160;to&#160;show&#160;red&#160;circles&#160;around&#160;every&#160;touching<br/>
finger:<br/>
&lt;style&gt;<br/>
dot&#160;{&#160;position:&#160;absolute;&#160;display:&#160;block;<br/>
border:&#160;2px&#160;solid&#160;red;&#160;border-radius:&#160;50px;<br/>height:&#160;100px;&#160;width:&#160;100px;&#160;}<br/>
&lt;/style&gt;<br/>&lt;p&gt;Touch&#160;this&#160;page&lt;/p&gt;<br/>&lt;script&gt;<br/>
function&#160;update(event)&#160;{<br/>
for&#160;(let&#160;dot;&#160;dot&#160;=&#160;document.querySelector(&#34;dot&#34;);)&#160;{<br/>
dot.remove();<br/>
}<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;event.touches.length;&#160;i++)&#160;{<br/>
let&#160;{pageX,&#160;pageY}&#160;=&#160;event.touches[i];<br/>let&#160;dot&#160;=&#160;document.createElement(&#34;dot&#34;);<br/>dot.style.left&#160;=&#160;(pageX&#160;-&#160;50)&#160;+&#160;&#34;px&#34;;<br/>dot.style.top&#160;=&#160;(pageY&#160;-&#160;50)&#160;+&#160;&#34;px&#34;;<br/>document.body.appendChild(dot);<br/>
252<br/>
<hr/>
<a name=265></a>}<br/>
}<br/>window.addEventListener(&#34;touchstart&#34;,&#160;update);<br/>window.addEventListener(&#34;touchmove&#34;,&#160;update);<br/>window.addEventListener(&#34;touchend&#34;,&#160;update);<br/>
&lt;/script&gt;<br/>
You’ll&#160;often&#160;want&#160;to&#160;call&#160;preventDefault&#160;in&#160;touch&#160;event&#160;handlers&#160;to&#160;override<br/>
the&#160;browser’s&#160;default&#160;behavior&#160;(which&#160;may&#160;include&#160;scrolling&#160;the&#160;page&#160;on&#160;swip-<br/>ing)&#160;and&#160;to&#160;prevent&#160;the&#160;mouse&#160;events&#160;from&#160;being&#160;fired,&#160;for&#160;which&#160;you&#160;may&#160;<i>also<br/></i>have&#160;a&#160;handler.<br/>
<b>Scroll&#160;events</b><br/>
Whenever&#160;an&#160;element&#160;is&#160;scrolled,&#160;a&#160;&#34;scroll&#34;&#160;event&#160;is&#160;fired&#160;on&#160;it.&#160;This&#160;has&#160;var-<br/>ious&#160;uses,&#160;such&#160;as&#160;knowing&#160;what&#160;the&#160;user&#160;is&#160;currently&#160;looking&#160;at&#160;(for&#160;disabling<br/>off-screen&#160;animations&#160;or&#160;sending&#160;spy&#160;reports&#160;to&#160;your&#160;evil&#160;headquarters)&#160;or&#160;show-<br/>ing&#160;some&#160;indication&#160;of&#160;progress&#160;(by&#160;highlighting&#160;part&#160;of&#160;a&#160;table&#160;of&#160;contents&#160;or<br/>showing&#160;a&#160;page&#160;number).<br/>
The&#160;following&#160;example&#160;draws&#160;a&#160;progress&#160;bar&#160;above&#160;the&#160;document&#160;and&#160;updates<br/>
it&#160;to&#160;fill&#160;up&#160;as&#160;you&#160;scroll&#160;down:<br/>
&lt;style&gt;<br/>
#progress&#160;{<br/>
border-bottom:&#160;2px&#160;solid&#160;blue;<br/>width:&#160;0;<br/>position:&#160;fixed;<br/>top:&#160;0;&#160;left:&#160;0;<br/>
}<br/>
&lt;/style&gt;<br/>&lt;div&#160;id=&#34;progress&#34;&gt;&lt;/div&gt;<br/>&lt;script&gt;<br/>
//&#160;Create&#160;some&#160;content<br/>document.body.appendChild(document.createTextNode(<br/>
&#34;supercalifragilisticexpialidocious&#160;&#34;.repeat(1000)));<br/>
let&#160;bar&#160;=&#160;document.querySelector(&#34;#progress&#34;);<br/>window.addEventListener(&#34;scroll&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;max&#160;=&#160;document.body.scrollHeight&#160;-&#160;innerHeight;<br/>bar.style.width&#160;=&#160;`${(pageYOffset&#160;/&#160;max)&#160;*&#160;100}%`;<br/>
});<br/>
&lt;/script&gt;<br/>
253<br/>
<hr/>
<a name=266></a>Giving&#160;an&#160;element&#160;a&#160;position&#160;of&#160;fixed&#160;acts&#160;much&#160;like&#160;an&#160;absolute&#160;position<br/>
but&#160;also&#160;prevents&#160;it&#160;from&#160;scrolling&#160;along&#160;with&#160;the&#160;rest&#160;of&#160;the&#160;document.&#160;The<br/>effect&#160;is&#160;to&#160;make&#160;our&#160;progress&#160;bar&#160;stay&#160;at&#160;the&#160;top.&#160;Its&#160;width&#160;is&#160;changed&#160;to<br/>indicate&#160;the&#160;current&#160;progress.&#160;We&#160;use&#160;%,&#160;rather&#160;than&#160;px,&#160;as&#160;a&#160;unit&#160;when&#160;setting<br/>the&#160;width&#160;so&#160;that&#160;the&#160;element&#160;is&#160;sized&#160;relative&#160;to&#160;the&#160;page&#160;width.<br/>
The&#160;global&#160;innerHeight&#160;binding&#160;gives&#160;us&#160;the&#160;height&#160;of&#160;the&#160;window,&#160;which<br/>
we&#160;have&#160;to&#160;subtract&#160;from&#160;the&#160;total&#160;scrollable&#160;height—you&#160;can’t&#160;keep&#160;scrolling<br/>when&#160;you&#160;hit&#160;the&#160;bottom&#160;of&#160;the&#160;document.&#160;There’s&#160;also&#160;an&#160;innerWidth&#160;for&#160;the<br/>window&#160;width.&#160;By&#160;dividing&#160;pageYOffset,&#160;the&#160;current&#160;scroll&#160;position,&#160;by&#160;the<br/>maximum&#160;scroll&#160;position&#160;and&#160;multiplying&#160;by&#160;100,&#160;we&#160;get&#160;the&#160;percentage&#160;for&#160;the<br/>progress&#160;bar.<br/>
Calling&#160;preventDefault&#160;on&#160;a&#160;scroll&#160;event&#160;does&#160;not&#160;prevent&#160;the&#160;scrolling&#160;from<br/>
happening.&#160;In&#160;fact,&#160;the&#160;event&#160;handler&#160;is&#160;called&#160;only&#160;<i>after&#160;</i>the&#160;scrolling&#160;takes<br/>place.<br/>
<b>Focus&#160;events</b><br/>
When&#160;an&#160;element&#160;gains&#160;focus,&#160;the&#160;browser&#160;fires&#160;a&#160;&#34;focus&#34;&#160;event&#160;on&#160;it.&#160;When<br/>it&#160;loses&#160;focus,&#160;the&#160;element&#160;gets&#160;a&#160;&#34;blur&#34;&#160;event.<br/>
Unlike&#160;the&#160;events&#160;discussed&#160;earlier,&#160;these&#160;two&#160;events&#160;do&#160;not&#160;propagate.&#160;A<br/>
handler&#160;on&#160;a&#160;parent&#160;element&#160;is&#160;not&#160;notified&#160;when&#160;a&#160;child&#160;element&#160;gains&#160;or&#160;loses<br/>focus.<br/>
The&#160;following&#160;example&#160;displays&#160;help&#160;text&#160;for&#160;the&#160;text&#160;field&#160;that&#160;currently&#160;has<br/>
focus:<br/>
&lt;p&gt;Name:&#160;&lt;input&#160;type=&#34;text&#34;&#160;data-help=&#34;Your&#160;full&#160;name&#34;&gt;&lt;/p&gt;<br/>&lt;p&gt;Age:&#160;&lt;input&#160;type=&#34;text&#34;&#160;data-help=&#34;Your&#160;age&#160;in&#160;years&#34;&gt;&lt;/p&gt;<br/>&lt;p&#160;id=&#34;help&#34;&gt;&lt;/p&gt;<br/>
&lt;script&gt;<br/>
let&#160;help&#160;=&#160;document.querySelector(&#34;#help&#34;);<br/>let&#160;fields&#160;=&#160;document.querySelectorAll(&#34;input&#34;);<br/>for&#160;(let&#160;field&#160;of&#160;Array.from(fields))&#160;{<br/>
field.addEventListener(&#34;focus&#34;,&#160;event&#160;=&gt;&#160;{<br/>
let&#160;text&#160;=&#160;event.target.getAttribute(&#34;data-help&#34;);<br/>help.textContent&#160;=&#160;text;<br/>
});<br/>field.addEventListener(&#34;blur&#34;,&#160;event&#160;=&gt;&#160;{<br/>
help.textContent&#160;=&#160;&#34;&#34;;<br/>
});<br/>
}<br/>
254<br/>
<hr/>
<a name=267></a><img src="eloquent-javascript-267_1.png"/><br/>
&lt;/script&gt;<br/>
This&#160;screenshot&#160;shows&#160;the&#160;help&#160;text&#160;for&#160;the&#160;age&#160;field.<br/>
The&#160;window&#160;object&#160;will&#160;receive&#160;&#34;focus&#34;&#160;and&#160;&#34;blur&#34;&#160;events&#160;when&#160;the&#160;user<br/>
moves&#160;from&#160;or&#160;to&#160;the&#160;browser&#160;tab&#160;or&#160;window&#160;in&#160;which&#160;the&#160;document&#160;is&#160;shown.<br/>
<b>Load&#160;event</b><br/>
When&#160;a&#160;page&#160;finishes&#160;loading,&#160;the&#160;&#34;load&#34;&#160;event&#160;fires&#160;on&#160;the&#160;window&#160;and&#160;the<br/>document&#160;body&#160;objects.&#160;This&#160;is&#160;often&#160;used&#160;to&#160;schedule&#160;initialization&#160;actions&#160;that<br/>require&#160;the&#160;whole&#160;document&#160;to&#160;have&#160;been&#160;built.&#160;Remember&#160;that&#160;the&#160;content&#160;of<br/>&lt;script&gt;&#160;tags&#160;is&#160;run&#160;immediately&#160;when&#160;the&#160;tag&#160;is&#160;encountered.&#160;This&#160;may&#160;be<br/>too&#160;soon,&#160;for&#160;example&#160;when&#160;the&#160;script&#160;needs&#160;to&#160;do&#160;something&#160;with&#160;parts&#160;of&#160;the<br/>document&#160;that&#160;appear&#160;after&#160;the&#160;&lt;script&gt;&#160;tag.<br/>
Elements&#160;such&#160;as&#160;images&#160;and&#160;script&#160;tags&#160;that&#160;load&#160;an&#160;external&#160;file&#160;also&#160;have<br/>
a&#160;&#34;load&#34;&#160;event&#160;that&#160;indicates&#160;the&#160;files&#160;they&#160;reference&#160;were&#160;loaded.&#160;Like&#160;the<br/>focus-related&#160;events,&#160;loading&#160;events&#160;do&#160;not&#160;propagate.<br/>
When&#160;a&#160;page&#160;is&#160;closed&#160;or&#160;navigated&#160;away&#160;from&#160;(for&#160;example,&#160;by&#160;following&#160;a<br/>
link),&#160;a&#160;&#34;beforeunload&#34;&#160;event&#160;fires.&#160;The&#160;main&#160;use&#160;of&#160;this&#160;event&#160;is&#160;to&#160;prevent&#160;the<br/>user&#160;from&#160;accidentally&#160;losing&#160;work&#160;by&#160;closing&#160;a&#160;document.&#160;If&#160;you&#160;prevent&#160;the<br/>default&#160;behavior&#160;on&#160;this&#160;event&#160;<i>and&#160;</i>set&#160;the&#160;returnValue&#160;property&#160;on&#160;the&#160;event<br/>object&#160;to&#160;a&#160;string,&#160;the&#160;browser&#160;will&#160;show&#160;the&#160;user&#160;a&#160;dialog&#160;asking&#160;if&#160;they&#160;really<br/>want&#160;to&#160;leave&#160;the&#160;page.&#160;That&#160;dialog&#160;might&#160;include&#160;your&#160;string,&#160;but&#160;because<br/>some&#160;malicious&#160;sites&#160;try&#160;to&#160;use&#160;these&#160;dialogs&#160;to&#160;confuse&#160;people&#160;into&#160;staying&#160;on<br/>their&#160;page&#160;to&#160;look&#160;at&#160;dodgy&#160;weight&#160;loss&#160;ads,&#160;most&#160;browsers&#160;no&#160;longer&#160;display<br/>them.<br/>
<b>Events&#160;and&#160;the&#160;event&#160;loop</b><br/>
In&#160;the&#160;context&#160;of&#160;the&#160;event&#160;loop,&#160;as&#160;discussed&#160;in&#160;<a href="eloquent-javascripts.html#192">Chapter&#160;11,&#160;</a>browser&#160;event<br/>handlers&#160;behave&#160;like&#160;other&#160;asynchronous&#160;notifications.&#160;They&#160;are&#160;scheduled<br/>when&#160;the&#160;event&#160;occurs&#160;but&#160;must&#160;wait&#160;for&#160;other&#160;scripts&#160;that&#160;are&#160;running&#160;to<br/>finish&#160;before&#160;they&#160;get&#160;a&#160;chance&#160;to&#160;run.<br/>
255<br/>
<hr/>
<a name=268></a>The&#160;fact&#160;that&#160;events&#160;can&#160;be&#160;processed&#160;only&#160;when&#160;nothing&#160;else&#160;is&#160;running<br/>
means&#160;that,&#160;if&#160;the&#160;event&#160;loop&#160;is&#160;tied&#160;up&#160;with&#160;other&#160;work,&#160;any&#160;interaction&#160;with<br/>the&#160;page&#160;(which&#160;happens&#160;through&#160;events)&#160;will&#160;be&#160;delayed&#160;until&#160;there’s&#160;time&#160;to<br/>process&#160;it.&#160;So&#160;if&#160;you&#160;schedule&#160;too&#160;much&#160;work,&#160;either&#160;with&#160;long-running&#160;event<br/>handlers&#160;or&#160;with&#160;lots&#160;of&#160;short-running&#160;ones,&#160;the&#160;page&#160;will&#160;become&#160;slow&#160;and<br/>cumbersome&#160;to&#160;use.<br/>
For&#160;cases&#160;where&#160;you&#160;<i>really&#160;</i>do&#160;want&#160;to&#160;do&#160;some&#160;time-consuming&#160;thing&#160;in&#160;the<br/>
background&#160;without&#160;freezing&#160;the&#160;page,&#160;browsers&#160;provide&#160;something&#160;called&#160;<i>web<br/>workers</i>.&#160;A&#160;worker&#160;is&#160;a&#160;JavaScript&#160;process&#160;that&#160;runs&#160;alongside&#160;the&#160;main&#160;script,<br/>on&#160;its&#160;own&#160;timeline.<br/>
Imagine&#160;that&#160;squaring&#160;a&#160;number&#160;is&#160;a&#160;heavy,&#160;long-running&#160;computation&#160;that<br/>
we&#160;want&#160;to&#160;perform&#160;in&#160;a&#160;separate&#160;thread.&#160;We&#160;could&#160;write&#160;a&#160;file&#160;called&#160;code/<br/>squareworker.js&#160;that&#160;responds&#160;to&#160;messages&#160;by&#160;computing&#160;a&#160;square&#160;and&#160;sending<br/>a&#160;message&#160;back.<br/>
addEventListener(&#34;message&#34;,&#160;event&#160;=&gt;&#160;{<br/>
postMessage(event.data&#160;*&#160;event.data);<br/>
});<br/>
To&#160;avoid&#160;the&#160;problems&#160;of&#160;having&#160;multiple&#160;threads&#160;touching&#160;the&#160;same&#160;data,<br/>
workers&#160;do&#160;not&#160;share&#160;their&#160;global&#160;scope&#160;or&#160;any&#160;other&#160;data&#160;with&#160;the&#160;main&#160;script’s<br/>environment.&#160;Instead,&#160;you&#160;have&#160;to&#160;communicate&#160;with&#160;them&#160;by&#160;sending&#160;mes-<br/>sages&#160;back&#160;and&#160;forth.<br/>
This&#160;code&#160;spawns&#160;a&#160;worker&#160;running&#160;that&#160;script,&#160;sends&#160;it&#160;a&#160;few&#160;messages,&#160;and<br/>
outputs&#160;the&#160;responses.<br/>
let&#160;squareWorker&#160;=&#160;new&#160;Worker(&#34;code/squareworker.js&#34;);<br/>squareWorker.addEventListener(&#34;message&#34;,&#160;event&#160;=&gt;&#160;{<br/>
console.log(&#34;The&#160;worker&#160;responded:&#34;,&#160;event.data);<br/>
});<br/>squareWorker.postMessage(10);<br/>squareWorker.postMessage(24);<br/>
The&#160;postMessage&#160;function&#160;sends&#160;a&#160;message,&#160;which&#160;will&#160;cause&#160;a&#160;&#34;message&#34;<br/>
event&#160;to&#160;fire&#160;in&#160;the&#160;receiver.&#160;The&#160;script&#160;that&#160;created&#160;the&#160;worker&#160;sends&#160;and<br/>receives&#160;messages&#160;through&#160;the&#160;Worker&#160;object,&#160;whereas&#160;the&#160;worker&#160;talks&#160;to&#160;the<br/>script&#160;that&#160;created&#160;it&#160;by&#160;sending&#160;and&#160;listening&#160;directly&#160;on&#160;its&#160;global&#160;scope.&#160;Only<br/>values&#160;that&#160;can&#160;be&#160;represented&#160;as&#160;JSON&#160;can&#160;be&#160;sent&#160;as&#160;messages—the&#160;other<br/>side&#160;will&#160;receive&#160;a&#160;<i>copy&#160;</i>of&#160;them,&#160;rather&#160;than&#160;the&#160;value&#160;itself.<br/>
256<br/>
<hr/>
<a name=269></a><b>Timers</b><br/>
We&#160;saw&#160;the&#160;setTimeout&#160;function&#160;in&#160;<a href="eloquent-javascripts.html#192">Chapter&#160;11</a>.&#160;It&#160;schedules&#160;another&#160;function<br/>to&#160;be&#160;called&#160;later,&#160;after&#160;a&#160;given&#160;number&#160;of&#160;milliseconds.<br/>
Sometimes&#160;you&#160;need&#160;to&#160;cancel&#160;a&#160;function&#160;you&#160;have&#160;scheduled.&#160;This&#160;is&#160;done<br/>
by&#160;storing&#160;the&#160;value&#160;returned&#160;by&#160;setTimeout&#160;and&#160;calling&#160;clearTimeout&#160;on&#160;it.<br/>
let&#160;bombTimer&#160;=&#160;setTimeout(()&#160;=&gt;&#160;{<br/>
console.log(&#34;BOOM!&#34;);<br/>
},&#160;500);<br/>
if&#160;(Math.random()&#160;&lt;&#160;0.5)&#160;{&#160;//&#160;50%&#160;chance<br/>
console.log(&#34;Defused.&#34;);<br/>clearTimeout(bombTimer);<br/>
}<br/>
The&#160;cancelAnimationFrame&#160;function&#160;works&#160;in&#160;the&#160;same&#160;way&#160;as&#160;clearTimeout<br/>
—calling&#160;it&#160;on&#160;a&#160;value&#160;returned&#160;by&#160;requestAnimationFrame&#160;will&#160;cancel&#160;that<br/>frame&#160;(assuming&#160;it&#160;hasn’t&#160;already&#160;been&#160;called).<br/>
A&#160;similar&#160;set&#160;of&#160;functions,&#160;setInterval&#160;and&#160;clearInterval,&#160;are&#160;used&#160;to&#160;set<br/>
timers&#160;that&#160;should&#160;<i>repeat&#160;</i>every&#160;<i>X&#160;</i>milliseconds.<br/>
let&#160;ticks&#160;=&#160;0;<br/>let&#160;clock&#160;=&#160;setInterval(()&#160;=&gt;&#160;{<br/>
console.log(&#34;tick&#34;,&#160;ticks++);<br/>if&#160;(ticks&#160;==&#160;10)&#160;{<br/>
clearInterval(clock);<br/>console.log(&#34;stop.&#34;);<br/>
}<br/>
},&#160;200);<br/>
<b>Debouncing</b><br/>
Some&#160;types&#160;of&#160;events&#160;have&#160;the&#160;potential&#160;to&#160;fire&#160;rapidly,&#160;many&#160;times&#160;in&#160;a&#160;row&#160;(the<br/>&#34;mousemove&#34;&#160;and&#160;&#34;scroll&#34;&#160;events,&#160;for&#160;example).&#160;When&#160;handling&#160;such&#160;events,<br/>you&#160;must&#160;be&#160;careful&#160;not&#160;to&#160;do&#160;anything&#160;too&#160;time-consuming&#160;or&#160;your&#160;handler<br/>will&#160;take&#160;up&#160;so&#160;much&#160;time&#160;that&#160;interaction&#160;with&#160;the&#160;document&#160;starts&#160;to&#160;feel<br/>slow.<br/>
If&#160;you&#160;do&#160;need&#160;to&#160;do&#160;something&#160;nontrivial&#160;in&#160;such&#160;a&#160;handler,&#160;you&#160;can&#160;use<br/>
setTimeout&#160;to&#160;make&#160;sure&#160;you&#160;are&#160;not&#160;doing&#160;it&#160;too&#160;often.&#160;This&#160;is&#160;usually&#160;called<br/>
257<br/>
<hr/>
<a name=270></a><i>debouncing&#160;</i>the&#160;event.&#160;There&#160;are&#160;several&#160;slightly&#160;different&#160;approaches&#160;to&#160;this.<br/>
In&#160;the&#160;first&#160;example,&#160;we&#160;want&#160;to&#160;react&#160;when&#160;the&#160;user&#160;has&#160;typed&#160;something,&#160;but<br/>
we&#160;don’t&#160;want&#160;to&#160;do&#160;it&#160;immediately&#160;for&#160;every&#160;input&#160;event.&#160;When&#160;they&#160;are&#160;typing<br/>quickly,&#160;we&#160;just&#160;want&#160;to&#160;wait&#160;until&#160;a&#160;pause&#160;occurs.&#160;Instead&#160;of&#160;immediately<br/>performing&#160;an&#160;action&#160;in&#160;the&#160;event&#160;handler,&#160;we&#160;set&#160;a&#160;timeout.&#160;We&#160;also&#160;clear&#160;the<br/>previous&#160;timeout&#160;(if&#160;any)&#160;so&#160;that&#160;when&#160;events&#160;occur&#160;close&#160;together&#160;(closer&#160;than<br/>our&#160;timeout&#160;delay),&#160;the&#160;timeout&#160;from&#160;the&#160;previous&#160;event&#160;will&#160;be&#160;canceled.<br/>
&lt;textarea&gt;Type&#160;something&#160;here...&lt;/textarea&gt;<br/>&lt;script&gt;<br/>
let&#160;textarea&#160;=&#160;document.querySelector(&#34;textarea&#34;);<br/>let&#160;timeout;<br/>textarea.addEventListener(&#34;input&#34;,&#160;()&#160;=&gt;&#160;{<br/>
clearTimeout(timeout);<br/>timeout&#160;=&#160;setTimeout(()&#160;=&gt;&#160;console.log(&#34;Typed!&#34;),&#160;500);<br/>
});<br/>
&lt;/script&gt;<br/>
Giving&#160;an&#160;undefined&#160;value&#160;to&#160;clearTimeout&#160;or&#160;calling&#160;it&#160;on&#160;a&#160;timeout&#160;that<br/>
has&#160;already&#160;fired&#160;has&#160;no&#160;effect.&#160;Thus,&#160;we&#160;don’t&#160;have&#160;to&#160;be&#160;careful&#160;about&#160;when<br/>to&#160;call&#160;it,&#160;and&#160;we&#160;simply&#160;do&#160;so&#160;for&#160;every&#160;event.<br/>
We&#160;can&#160;use&#160;a&#160;slightly&#160;different&#160;pattern&#160;if&#160;we&#160;want&#160;to&#160;space&#160;responses&#160;so&#160;that<br/>
they’re&#160;separated&#160;by&#160;at&#160;least&#160;a&#160;certain&#160;length&#160;of&#160;time&#160;but&#160;want&#160;to&#160;fire&#160;them<br/><i>during&#160;</i>a&#160;series&#160;of&#160;events,&#160;not&#160;just&#160;afterward.&#160;For&#160;example,&#160;we&#160;might&#160;want&#160;to<br/>respond&#160;to&#160;&#34;mousemove&#34;&#160;events&#160;by&#160;showing&#160;the&#160;current&#160;coordinates&#160;of&#160;the&#160;mouse<br/>but&#160;only&#160;every&#160;250&#160;milliseconds.<br/>
&lt;script&gt;<br/>
let&#160;scheduled&#160;=&#160;null;<br/>window.addEventListener(&#34;mousemove&#34;,&#160;event&#160;=&gt;&#160;{<br/>
if&#160;(!scheduled)&#160;{<br/>
setTimeout(()&#160;=&gt;&#160;{<br/>
document.body.textContent&#160;=<br/>
`Mouse&#160;at&#160;${scheduled.pageX},&#160;${scheduled.pageY}`;<br/>
scheduled&#160;=&#160;null;<br/>
},&#160;250);<br/>
}<br/>scheduled&#160;=&#160;event;<br/>
});<br/>
&lt;/script&gt;<br/>
258<br/>
<hr/>
<a name=271></a><b>Summary</b><br/>
Event&#160;handlers&#160;make&#160;it&#160;possible&#160;to&#160;detect&#160;and&#160;react&#160;to&#160;events&#160;happening&#160;in&#160;our<br/>web&#160;page.&#160;The&#160;addEventListener&#160;method&#160;is&#160;used&#160;to&#160;register&#160;such&#160;a&#160;handler.<br/>
Each&#160;event&#160;has&#160;a&#160;type&#160;(&#34;keydown&#34;,&#160;&#34;focus&#34;,&#160;and&#160;so&#160;on)&#160;that&#160;identifies&#160;it.<br/>
Most&#160;events&#160;are&#160;called&#160;on&#160;a&#160;specific&#160;DOM&#160;element&#160;and&#160;then&#160;<i>propagate&#160;</i>to&#160;that<br/>element’s&#160;ancestors,&#160;allowing&#160;handlers&#160;associated&#160;with&#160;those&#160;elements&#160;to&#160;handle<br/>them.<br/>
When&#160;an&#160;event&#160;handler&#160;is&#160;called,&#160;it&#160;is&#160;passed&#160;an&#160;event&#160;object&#160;with&#160;additional<br/>
information&#160;about&#160;the&#160;event.&#160;This&#160;object&#160;also&#160;has&#160;methods&#160;that&#160;allow&#160;us&#160;to<br/>stop&#160;further&#160;propagation&#160;(stopPropagation)&#160;and&#160;prevent&#160;the&#160;browser’s&#160;default<br/>handling&#160;of&#160;the&#160;event&#160;(preventDefault).<br/>
Pressing&#160;a&#160;key&#160;fires&#160;&#34;keydown&#34;&#160;and&#160;&#34;keyup&#34;&#160;events.&#160;Pressing&#160;a&#160;mouse&#160;button<br/>
fires&#160;&#34;mousedown&#34;,&#160;&#34;mouseup&#34;,&#160;and&#160;&#34;click&#34;&#160;events.&#160;Moving&#160;the&#160;mouse&#160;fires<br/>&#34;mousemove&#34;&#160;events.&#160;Touchscreen&#160;interaction&#160;will&#160;result&#160;in&#160;&#34;touchstart&#34;,&#160;&#34;<br/>touchmove&#34;,&#160;and&#160;&#34;touchend&#34;&#160;events.<br/>
Scrolling&#160;can&#160;be&#160;detected&#160;with&#160;the&#160;&#34;scroll&#34;&#160;event,&#160;and&#160;focus&#160;changes&#160;can<br/>
be&#160;detected&#160;with&#160;the&#160;&#34;focus&#34;&#160;and&#160;&#34;blur&#34;&#160;events.&#160;When&#160;the&#160;document&#160;finishes<br/>loading,&#160;a&#160;&#34;load&#34;&#160;event&#160;fires&#160;on&#160;the&#160;window.<br/>
<b>Exercises</b><br/>
<b>Balloon</b><br/>
Write&#160;a&#160;page&#160;that&#160;displays&#160;a&#160;balloon&#160;(using&#160;the&#160;balloon&#160;emoji,&#160;🎈).&#160;When&#160;you<br/>press&#160;the&#160;up&#160;arrow,&#160;it&#160;should&#160;inflate&#160;(grow)&#160;10&#160;percent,&#160;and&#160;when&#160;you&#160;press&#160;the<br/>down&#160;arrow,&#160;it&#160;should&#160;deflate&#160;(shrink)&#160;10&#160;percent.<br/>
You&#160;can&#160;control&#160;the&#160;size&#160;of&#160;text&#160;(emoji&#160;are&#160;text)&#160;by&#160;setting&#160;the&#160;font-size<br/>
CSS&#160;property&#160;(style.fontSize)&#160;on&#160;its&#160;parent&#160;element.&#160;Remember&#160;to&#160;include&#160;a<br/>unit&#160;in&#160;the&#160;value—for&#160;example,&#160;pixels&#160;(10px).<br/>
The&#160;key&#160;names&#160;of&#160;the&#160;arrow&#160;keys&#160;are&#160;&#34;ArrowUp&#34;&#160;and&#160;&#34;ArrowDown&#34;.&#160;Make&#160;sure<br/>
the&#160;keys&#160;change&#160;only&#160;the&#160;balloon,&#160;without&#160;scrolling&#160;the&#160;page.<br/>
When&#160;that&#160;works,&#160;add&#160;a&#160;feature&#160;where,&#160;if&#160;you&#160;blow&#160;up&#160;the&#160;balloon&#160;past&#160;a<br/>
certain&#160;size,&#160;it&#160;explodes.&#160;In&#160;this&#160;case,&#160;exploding&#160;means&#160;that&#160;it&#160;is&#160;replaced&#160;with<br/>an&#160;💥&#160;emoji,&#160;and&#160;the&#160;event&#160;handler&#160;is&#160;removed&#160;(so&#160;that&#160;you&#160;can’t&#160;inflate&#160;or<br/>deflate&#160;the&#160;explosion).<br/>
259<br/>
<hr/>
<a name=272></a><b>Mouse&#160;trail</b><br/>
In&#160;JavaScript’s&#160;early&#160;days,&#160;which&#160;was&#160;the&#160;high&#160;time&#160;of&#160;gaudy&#160;home&#160;pages&#160;with<br/>lots&#160;of&#160;animated&#160;images,&#160;people&#160;came&#160;up&#160;with&#160;some&#160;truly&#160;inspiring&#160;ways&#160;to&#160;use<br/>the&#160;language.<br/>
One&#160;of&#160;these&#160;was&#160;the&#160;<i>mouse&#160;trail</i>—a&#160;series&#160;of&#160;elements&#160;that&#160;would&#160;follow&#160;the<br/>
mouse&#160;pointer&#160;as&#160;you&#160;moved&#160;it&#160;across&#160;the&#160;page.<br/>
In&#160;this&#160;exercise,&#160;I&#160;want&#160;you&#160;to&#160;implement&#160;a&#160;mouse&#160;trail.&#160;Use&#160;absolutely<br/>
positioned&#160;&lt;div&gt;&#160;elements&#160;with&#160;a&#160;fixed&#160;size&#160;and&#160;background&#160;color&#160;(refer&#160;to&#160;the<br/><a href="eloquent-javascripts.html#261">code&#160;</a>in&#160;the&#160;“Mouse&#160;Clicks”&#160;section&#160;for&#160;an&#160;example).&#160;Create&#160;a&#160;bunch&#160;of&#160;such<br/>elements&#160;and,&#160;when&#160;the&#160;mouse&#160;moves,&#160;display&#160;them&#160;in&#160;the&#160;wake&#160;of&#160;the&#160;mouse<br/>pointer.<br/>
There&#160;are&#160;various&#160;possible&#160;approaches&#160;here.&#160;You&#160;can&#160;make&#160;your&#160;solution&#160;as<br/>
simple&#160;or&#160;as&#160;complex&#160;as&#160;you&#160;want.&#160;A&#160;simple&#160;solution&#160;to&#160;start&#160;with&#160;is&#160;to&#160;keep<br/>a&#160;fixed&#160;number&#160;of&#160;trail&#160;elements&#160;and&#160;cycle&#160;through&#160;them,&#160;moving&#160;the&#160;next&#160;one<br/>to&#160;the&#160;mouse’s&#160;current&#160;position&#160;every&#160;time&#160;a&#160;&#34;mousemove&#34;&#160;event&#160;occurs.<br/>
<b>Tabs</b><br/>
Tabbed&#160;panels&#160;are&#160;widely&#160;used&#160;in&#160;user&#160;interfaces.&#160;They&#160;allow&#160;you&#160;to&#160;select<br/>an&#160;interface&#160;panel&#160;by&#160;choosing&#160;from&#160;a&#160;number&#160;of&#160;tabs&#160;“sticking&#160;out”&#160;above&#160;an<br/>element.<br/>
In&#160;this&#160;exercise&#160;you&#160;must&#160;implement&#160;a&#160;simple&#160;tabbed&#160;interface.&#160;Write&#160;a&#160;func-<br/>
tion,&#160;asTabs,&#160;that&#160;takes&#160;a&#160;DOM&#160;node&#160;and&#160;creates&#160;a&#160;tabbed&#160;interface&#160;showing<br/>the&#160;child&#160;elements&#160;of&#160;that&#160;node.&#160;It&#160;should&#160;insert&#160;a&#160;list&#160;of&#160;&lt;button&gt;&#160;elements&#160;at<br/>the&#160;top&#160;of&#160;the&#160;node,&#160;one&#160;for&#160;each&#160;child&#160;element,&#160;containing&#160;text&#160;retrieved&#160;from<br/>the&#160;data-tabname&#160;attribute&#160;of&#160;the&#160;child.&#160;All&#160;but&#160;one&#160;of&#160;the&#160;original&#160;children<br/>should&#160;be&#160;hidden&#160;(given&#160;a&#160;display&#160;style&#160;of&#160;none).&#160;The&#160;currently&#160;visible&#160;node<br/>can&#160;be&#160;selected&#160;by&#160;clicking&#160;the&#160;buttons.<br/>
When&#160;that&#160;works,&#160;extend&#160;it&#160;to&#160;style&#160;the&#160;button&#160;for&#160;the&#160;currently&#160;selected&#160;tab<br/>
differently&#160;so&#160;that&#160;it&#160;is&#160;obvious&#160;which&#160;tab&#160;is&#160;selected.<br/>
260<br/>
<hr/>
<a name=273></a><img src="eloquent-javascript-273_1.png"/><br/>
<i>“All&#160;reality&#160;is&#160;a&#160;game.”</i><br/>
—Iain&#160;Banks,&#160;The&#160;Player&#160;of&#160;Games<br/>
<b>Chapter&#160;16<br/>Project:&#160;A&#160;Platform&#160;Game</b><br/>
Much&#160;of&#160;my&#160;initial&#160;fascination&#160;with&#160;computers,&#160;like&#160;that&#160;of&#160;many&#160;nerdy&#160;kids,<br/>had&#160;to&#160;do&#160;with&#160;computer&#160;games.&#160;I&#160;was&#160;drawn&#160;into&#160;the&#160;tiny&#160;simulated&#160;worlds<br/>that&#160;I&#160;could&#160;manipulate&#160;and&#160;in&#160;which&#160;stories&#160;(sort&#160;of)&#160;unfolded—more,&#160;I&#160;sup-<br/>pose,&#160;because&#160;of&#160;the&#160;way&#160;I&#160;projected&#160;my&#160;imagination&#160;into&#160;them&#160;than&#160;because<br/>of&#160;the&#160;possibilities&#160;they&#160;actually&#160;offered.<br/>
I&#160;don’t&#160;wish&#160;a&#160;career&#160;in&#160;game&#160;programming&#160;on&#160;anyone.&#160;Much&#160;like&#160;the&#160;music<br/>
industry,&#160;the&#160;discrepancy&#160;between&#160;the&#160;number&#160;of&#160;eager&#160;young&#160;people&#160;wanting<br/>to&#160;work&#160;in&#160;it&#160;and&#160;the&#160;actual&#160;demand&#160;for&#160;such&#160;people&#160;creates&#160;a&#160;rather&#160;unhealthy<br/>environment.&#160;But&#160;writing&#160;games&#160;for&#160;fun&#160;is&#160;amusing.<br/>
This&#160;chapter&#160;will&#160;walk&#160;through&#160;the&#160;implementation&#160;of&#160;a&#160;small&#160;platform&#160;game.<br/>
Platform&#160;games&#160;(or&#160;“jump&#160;and&#160;run”&#160;games)&#160;are&#160;games&#160;that&#160;expect&#160;the&#160;player<br/>to&#160;move&#160;a&#160;figure&#160;through&#160;a&#160;world,&#160;which&#160;is&#160;usually&#160;two-dimensional&#160;and&#160;viewed<br/>from&#160;the&#160;side,&#160;while&#160;jumping&#160;over&#160;and&#160;onto&#160;things.<br/>
<b>The&#160;game</b><br/>
Our&#160;game&#160;will&#160;be&#160;roughly&#160;based&#160;on&#160;<a href="http://www.lessmilk.com/games/10">Dark&#160;Blue&#160;</a>(<i>www.lessmilk.com/games/10</i>)&#160;by<br/>Thomas&#160;Palef.&#160;I&#160;chose&#160;that&#160;game&#160;because&#160;it&#160;is&#160;both&#160;entertaining&#160;and&#160;minimalist<br/>and&#160;because&#160;it&#160;can&#160;be&#160;built&#160;without&#160;too&#160;much&#160;code.&#160;It&#160;looks&#160;like&#160;this:<br/>
The&#160;dark&#160;box&#160;represents&#160;the&#160;player,&#160;whose&#160;task&#160;is&#160;to&#160;collect&#160;the&#160;yellow&#160;boxes<br/>
261<br/>
<hr/>
<a name=274></a>(coins)&#160;while&#160;avoiding&#160;the&#160;red&#160;stuff&#160;(lava).&#160;A&#160;level&#160;is&#160;completed&#160;when&#160;all&#160;coins<br/>have&#160;been&#160;collected.<br/>
The&#160;player&#160;can&#160;walk&#160;around&#160;with&#160;the&#160;left&#160;and&#160;right&#160;arrow&#160;keys&#160;and&#160;can&#160;jump<br/>
with&#160;the&#160;up&#160;arrow.&#160;Jumping&#160;is&#160;a&#160;specialty&#160;of&#160;this&#160;game&#160;character.&#160;It&#160;can&#160;reach<br/>several&#160;times&#160;its&#160;own&#160;height&#160;and&#160;can&#160;change&#160;direction&#160;in&#160;midair.&#160;This&#160;may&#160;not<br/>be&#160;entirely&#160;realistic,&#160;but&#160;it&#160;helps&#160;give&#160;the&#160;player&#160;the&#160;feeling&#160;of&#160;being&#160;in&#160;direct<br/>control&#160;of&#160;the&#160;on-screen&#160;avatar.<br/>
The&#160;game&#160;consists&#160;of&#160;a&#160;static&#160;background,&#160;laid&#160;out&#160;like&#160;a&#160;grid,&#160;with&#160;the&#160;moving<br/>
elements&#160;overlaid&#160;on&#160;that&#160;background.&#160;Each&#160;field&#160;on&#160;the&#160;grid&#160;is&#160;either&#160;empty,<br/>solid,&#160;or&#160;lava.&#160;The&#160;moving&#160;elements&#160;are&#160;the&#160;player,&#160;coins,&#160;and&#160;certain&#160;pieces<br/>of&#160;lava.&#160;The&#160;positions&#160;of&#160;these&#160;elements&#160;are&#160;not&#160;constrained&#160;to&#160;the&#160;grid—their<br/>coordinates&#160;may&#160;be&#160;fractional,&#160;allowing&#160;smooth&#160;motion.<br/>
<b>The&#160;technology</b><br/>
We&#160;will&#160;use&#160;the&#160;browser&#160;DOM&#160;to&#160;display&#160;the&#160;game,&#160;and&#160;we’ll&#160;read&#160;user&#160;input<br/>by&#160;handling&#160;key&#160;events.<br/>
The&#160;screen-&#160;and&#160;keyboard-related&#160;code&#160;is&#160;only&#160;a&#160;small&#160;part&#160;of&#160;the&#160;work&#160;we<br/>
need&#160;to&#160;do&#160;to&#160;build&#160;this&#160;game.&#160;Since&#160;everything&#160;looks&#160;like&#160;colored&#160;boxes,&#160;draw-<br/>ing&#160;is&#160;uncomplicated:&#160;we&#160;create&#160;DOM&#160;elements&#160;and&#160;use&#160;styling&#160;to&#160;give&#160;them&#160;a<br/>background&#160;color,&#160;size,&#160;and&#160;position.<br/>
We&#160;can&#160;represent&#160;the&#160;background&#160;as&#160;a&#160;table&#160;since&#160;it&#160;is&#160;an&#160;unchanging&#160;grid&#160;of<br/>
squares.&#160;The&#160;free-moving&#160;elements&#160;can&#160;be&#160;overlaid&#160;using&#160;absolutely&#160;positioned<br/>elements.<br/>
In&#160;games&#160;and&#160;other&#160;programs&#160;that&#160;should&#160;animate&#160;graphics&#160;and&#160;respond<br/>
to&#160;user&#160;input&#160;without&#160;noticeable&#160;delay,&#160;efficiency&#160;is&#160;important.&#160;Although&#160;the<br/>DOM&#160;was&#160;not&#160;originally&#160;designed&#160;for&#160;high-performance&#160;graphics,&#160;it&#160;is&#160;actually<br/>better&#160;at&#160;this&#160;than&#160;you&#160;would&#160;expect.&#160;You&#160;saw&#160;some&#160;animations&#160;in&#160;<a href="eloquent-javascripts.html#250">Chapter<br/>14.&#160;</a>On&#160;a&#160;modern&#160;machine,&#160;a&#160;simple&#160;game&#160;like&#160;this&#160;performs&#160;well,&#160;even&#160;if&#160;we<br/>don’t&#160;worry&#160;about&#160;optimization&#160;very&#160;much.<br/>
In&#160;the&#160;<a href="eloquent-javascripts.html#296">next&#160;chapter,&#160;</a>we&#160;will&#160;explore&#160;another&#160;browser&#160;technology,&#160;the&#160;&lt;canvas&gt;<br/>
tag,&#160;which&#160;provides&#160;a&#160;more&#160;traditional&#160;way&#160;to&#160;draw&#160;graphics,&#160;working&#160;in&#160;terms<br/>of&#160;shapes&#160;and&#160;pixels&#160;rather&#160;than&#160;DOM&#160;elements.<br/>
<b>Levels</b><br/>
We’ll&#160;want&#160;a&#160;human-readable,&#160;human-editable&#160;way&#160;to&#160;specify&#160;levels.&#160;Since&#160;it<br/>is&#160;okay&#160;for&#160;everything&#160;to&#160;start&#160;out&#160;on&#160;a&#160;grid,&#160;we&#160;could&#160;use&#160;big&#160;strings&#160;in&#160;which<br/>
262<br/>
<hr/>
<a name=275></a>each&#160;character&#160;represents&#160;an&#160;element—either&#160;a&#160;part&#160;of&#160;the&#160;background&#160;grid&#160;or<br/>a&#160;moving&#160;element.<br/>
The&#160;plan&#160;for&#160;a&#160;small&#160;level&#160;might&#160;look&#160;like&#160;this:<br/>
let&#160;simpleLevelPlan&#160;=&#160;`<br/>......................<br/>..#................#..<br/>..#..............=.#..<br/>..#.........o.o....#..<br/>..#.@......#####...#..<br/>..#####............#..<br/>......#++++++++++++#..<br/>......##############..<br/>......................`;<br/>
Periods&#160;are&#160;empty&#160;space,&#160;hash&#160;(#)&#160;characters&#160;are&#160;walls,&#160;and&#160;plus&#160;signs&#160;are<br/>
lava.&#160;The&#160;player’s&#160;starting&#160;position&#160;is&#160;the&#160;at&#160;sign&#160;(@).&#160;Every&#160;O&#160;character&#160;is&#160;a<br/>coin,&#160;and&#160;the&#160;equal&#160;sign&#160;(=)&#160;at&#160;the&#160;top&#160;is&#160;a&#160;block&#160;of&#160;lava&#160;that&#160;moves&#160;back&#160;and<br/>forth&#160;horizontally.<br/>
We’ll&#160;support&#160;two&#160;additional&#160;kinds&#160;of&#160;moving&#160;lava:&#160;the&#160;pipe&#160;character&#160;(|)<br/>
creates&#160;vertically&#160;moving&#160;blobs,&#160;and&#160;v&#160;indicates&#160;<i>dripping&#160;</i>lava—vertically&#160;mov-<br/>ing&#160;lava&#160;that&#160;doesn’t&#160;bounce&#160;back&#160;and&#160;forth&#160;but&#160;only&#160;moves&#160;down,&#160;jumping<br/>back&#160;to&#160;its&#160;start&#160;position&#160;when&#160;it&#160;hits&#160;the&#160;floor.<br/>
A&#160;whole&#160;game&#160;consists&#160;of&#160;multiple&#160;levels&#160;that&#160;the&#160;player&#160;must&#160;complete.&#160;A<br/>
level&#160;is&#160;completed&#160;when&#160;all&#160;coins&#160;have&#160;been&#160;collected.&#160;If&#160;the&#160;player&#160;touches<br/>lava,&#160;the&#160;current&#160;level&#160;is&#160;restored&#160;to&#160;its&#160;starting&#160;position,&#160;and&#160;the&#160;player&#160;may<br/>try&#160;again.<br/>
<b>Reading&#160;a&#160;level</b><br/>
The&#160;following&#160;class&#160;stores&#160;a&#160;level&#160;object.&#160;Its&#160;argument&#160;should&#160;be&#160;the&#160;string&#160;that<br/>defines&#160;the&#160;level.<br/>
class&#160;Level&#160;{<br/>
constructor(plan)&#160;{<br/>
let&#160;rows&#160;=&#160;plan.trim().split(&#34;\n&#34;).map(l&#160;=&gt;&#160;[...l]);<br/>this.height&#160;=&#160;rows.length;<br/>this.width&#160;=&#160;rows[0].length;<br/>this.startActors&#160;=&#160;[];<br/>
this.rows&#160;=&#160;rows.map((row,&#160;y)&#160;=&gt;&#160;{<br/>
return&#160;row.map((ch,&#160;x)&#160;=&gt;&#160;{<br/>
263<br/>
<hr/>
<a name=276></a>let&#160;type&#160;=&#160;levelChars[ch];<br/>if&#160;(typeof&#160;type&#160;==&#160;&#34;string&#34;)&#160;return&#160;type;<br/>this.startActors.push(<br/>
type.create(new&#160;Vec(x,&#160;y),&#160;ch));<br/>
return&#160;&#34;empty&#34;;<br/>
});<br/>
});<br/>
}<br/>
}<br/>
The&#160;trim&#160;method&#160;is&#160;used&#160;to&#160;remove&#160;whitespace&#160;at&#160;the&#160;start&#160;and&#160;end&#160;of&#160;the<br/>
plan&#160;string.&#160;This&#160;allows&#160;our&#160;example&#160;plan&#160;to&#160;start&#160;with&#160;a&#160;newline&#160;so&#160;that&#160;all<br/>the&#160;lines&#160;are&#160;directly&#160;below&#160;each&#160;other.&#160;The&#160;remaining&#160;string&#160;is&#160;split&#160;on&#160;newline<br/>characters,&#160;and&#160;each&#160;line&#160;is&#160;spread&#160;into&#160;an&#160;array,&#160;producing&#160;arrays&#160;of&#160;characters.<br/>
So&#160;rows&#160;holds&#160;an&#160;array&#160;of&#160;arrays&#160;of&#160;characters,&#160;the&#160;rows&#160;of&#160;the&#160;plan.&#160;We&#160;can<br/>
derive&#160;the&#160;level’s&#160;width&#160;and&#160;height&#160;from&#160;these.&#160;But&#160;we&#160;must&#160;still&#160;separate&#160;the<br/>moving&#160;elements&#160;from&#160;the&#160;background&#160;grid.&#160;We’ll&#160;call&#160;moving&#160;elements&#160;<i>actors</i>.<br/>They’ll&#160;be&#160;stored&#160;in&#160;an&#160;array&#160;of&#160;objects.&#160;The&#160;background&#160;will&#160;be&#160;an&#160;array&#160;of<br/>arrays&#160;of&#160;strings,&#160;holding&#160;field&#160;types&#160;such&#160;as&#160;&#34;empty&#34;,&#160;&#34;wall&#34;,&#160;or&#160;&#34;lava&#34;.<br/>
To&#160;create&#160;these&#160;arrays,&#160;we&#160;map&#160;over&#160;the&#160;rows&#160;and&#160;then&#160;over&#160;their&#160;content.<br/>
Remember&#160;that&#160;map&#160;passes&#160;the&#160;array&#160;index&#160;as&#160;a&#160;second&#160;argument&#160;to&#160;the&#160;mapping<br/>function,&#160;which&#160;tells&#160;us&#160;the&#160;x-&#160;and&#160;y-coordinates&#160;of&#160;a&#160;given&#160;character.&#160;Positions<br/>in&#160;the&#160;game&#160;will&#160;be&#160;stored&#160;as&#160;pairs&#160;of&#160;coordinates,&#160;with&#160;the&#160;top&#160;left&#160;being&#160;0,0<br/>and&#160;each&#160;background&#160;square&#160;being&#160;1&#160;unit&#160;high&#160;and&#160;wide.<br/>
To&#160;interpret&#160;the&#160;characters&#160;in&#160;the&#160;plan,&#160;the&#160;Level&#160;constructor&#160;uses&#160;the<br/>
levelChars&#160;object,&#160;which&#160;maps&#160;background&#160;elements&#160;to&#160;strings&#160;and&#160;actor&#160;char-<br/>acters&#160;to&#160;classes.&#160;When&#160;type&#160;is&#160;an&#160;actor&#160;class,&#160;its&#160;static&#160;create&#160;method&#160;is&#160;used<br/>to&#160;create&#160;an&#160;object,&#160;which&#160;is&#160;added&#160;to&#160;startActors,&#160;and&#160;the&#160;mapping&#160;function<br/>returns&#160;&#34;empty&#34;&#160;for&#160;this&#160;background&#160;square.<br/>
The&#160;position&#160;of&#160;the&#160;actor&#160;is&#160;stored&#160;as&#160;a&#160;Vec&#160;object.&#160;This&#160;is&#160;a&#160;two-dimensional<br/>
vector,&#160;an&#160;object&#160;with&#160;x&#160;and&#160;y&#160;properties,&#160;as&#160;seen&#160;in&#160;the&#160;exercises&#160;of&#160;<a href="eloquent-javascripts.html#127">Chapter&#160;6.</a><br/>
As&#160;the&#160;game&#160;runs,&#160;actors&#160;will&#160;end&#160;up&#160;in&#160;different&#160;places&#160;or&#160;even&#160;disappear<br/>
entirely&#160;(as&#160;coins&#160;do&#160;when&#160;collected).&#160;We’ll&#160;use&#160;a&#160;State&#160;class&#160;to&#160;track&#160;the&#160;state<br/>of&#160;a&#160;running&#160;game.<br/>
class&#160;State&#160;{<br/>
constructor(level,&#160;actors,&#160;status)&#160;{<br/>
this.level&#160;=&#160;level;<br/>this.actors&#160;=&#160;actors;<br/>this.status&#160;=&#160;status;<br/>
}<br/>
264<br/>
<hr/>
<a name=277></a>static&#160;start(level)&#160;{<br/>
return&#160;new&#160;State(level,&#160;level.startActors,&#160;&#34;playing&#34;);<br/>
}<br/>
get&#160;player()&#160;{<br/>
return&#160;this.actors.find(a&#160;=&gt;&#160;a.type&#160;==&#160;&#34;player&#34;);<br/>
}<br/>
}<br/>
The&#160;status&#160;property&#160;will&#160;switch&#160;to&#160;&#34;lost&#34;&#160;or&#160;&#34;won&#34;&#160;when&#160;the&#160;game&#160;has<br/>
ended.<br/>
This&#160;is&#160;again&#160;a&#160;persistent&#160;data&#160;structure—updating&#160;the&#160;game&#160;state&#160;creates&#160;a<br/>
new&#160;state&#160;and&#160;leaves&#160;the&#160;old&#160;one&#160;intact.<br/>
<b>Actors</b><br/>
Actor&#160;objects&#160;represent&#160;the&#160;current&#160;position&#160;and&#160;state&#160;of&#160;a&#160;given&#160;moving&#160;element<br/>in&#160;our&#160;game.&#160;All&#160;actor&#160;objects&#160;conform&#160;to&#160;the&#160;same&#160;interface.&#160;Their&#160;pos<br/>property&#160;holds&#160;the&#160;coordinates&#160;of&#160;the&#160;element’s&#160;top-left&#160;corner,&#160;and&#160;their&#160;size<br/>property&#160;holds&#160;its&#160;size.<br/>
Then&#160;they&#160;have&#160;an&#160;update&#160;method,&#160;which&#160;is&#160;used&#160;to&#160;compute&#160;their&#160;new&#160;state<br/>
and&#160;position&#160;after&#160;a&#160;given&#160;time&#160;step.&#160;It&#160;simulates&#160;the&#160;thing&#160;the&#160;actor&#160;does—<br/>moving&#160;in&#160;response&#160;to&#160;the&#160;arrow&#160;keys&#160;for&#160;the&#160;player&#160;and&#160;bouncing&#160;back&#160;and<br/>forth&#160;for&#160;the&#160;lava—and&#160;returns&#160;a&#160;new,&#160;updated&#160;actor&#160;object.<br/>
A&#160;type&#160;property&#160;contains&#160;a&#160;string&#160;that&#160;identifies&#160;the&#160;type&#160;of&#160;the&#160;actor—&#34;<br/>
player&#34;,&#160;&#34;coin&#34;,&#160;or&#160;&#34;lava&#34;.&#160;This&#160;is&#160;useful&#160;when&#160;drawing&#160;the&#160;game—the&#160;look<br/>of&#160;the&#160;rectangle&#160;drawn&#160;for&#160;an&#160;actor&#160;is&#160;based&#160;on&#160;its&#160;type.<br/>
Actor&#160;classes&#160;have&#160;a&#160;static&#160;create&#160;method&#160;that&#160;is&#160;used&#160;by&#160;the&#160;Level&#160;con-<br/>
structor&#160;to&#160;create&#160;an&#160;actor&#160;from&#160;a&#160;character&#160;in&#160;the&#160;level&#160;plan.&#160;It&#160;is&#160;given&#160;the<br/>coordinates&#160;of&#160;the&#160;character&#160;and&#160;the&#160;character&#160;itself,&#160;which&#160;is&#160;needed&#160;because<br/>the&#160;Lava&#160;class&#160;handles&#160;several&#160;different&#160;characters.<br/>
This&#160;is&#160;the&#160;Vec&#160;class&#160;that&#160;we’ll&#160;use&#160;for&#160;our&#160;two-dimensional&#160;values,&#160;such&#160;as<br/>
the&#160;position&#160;and&#160;size&#160;of&#160;actors.<br/>
class&#160;Vec&#160;{<br/>
constructor(x,&#160;y)&#160;{<br/>
this.x&#160;=&#160;x;&#160;this.y&#160;=&#160;y;<br/>
}<br/>plus(other)&#160;{<br/>
return&#160;new&#160;Vec(this.x&#160;+&#160;other.x,&#160;this.y&#160;+&#160;other.y);<br/>
265<br/>
<hr/>
<a name=278></a>}<br/>times(factor)&#160;{<br/>
return&#160;new&#160;Vec(this.x&#160;*&#160;factor,&#160;this.y&#160;*&#160;factor);<br/>
}<br/>
}<br/>
The&#160;times&#160;method&#160;scales&#160;a&#160;vector&#160;by&#160;a&#160;given&#160;number.&#160;It&#160;will&#160;be&#160;useful<br/>
when&#160;we&#160;need&#160;to&#160;multiply&#160;a&#160;speed&#160;vector&#160;by&#160;a&#160;time&#160;interval&#160;to&#160;get&#160;the&#160;distance<br/>traveled&#160;during&#160;that&#160;time.<br/>
The&#160;different&#160;types&#160;of&#160;actors&#160;get&#160;their&#160;own&#160;classes&#160;since&#160;their&#160;behavior&#160;is&#160;very<br/>
different.&#160;Let’s&#160;define&#160;these&#160;classes.&#160;We’ll&#160;get&#160;to&#160;their&#160;update&#160;methods&#160;later.<br/>
The&#160;player&#160;class&#160;has&#160;a&#160;property&#160;speed&#160;that&#160;stores&#160;its&#160;current&#160;speed&#160;to&#160;simulate<br/>
momentum&#160;and&#160;gravity.<br/>
class&#160;Player&#160;{<br/>
constructor(pos,&#160;speed)&#160;{<br/>
this.pos&#160;=&#160;pos;<br/>this.speed&#160;=&#160;speed;<br/>
}<br/>
get&#160;type()&#160;{&#160;return&#160;&#34;player&#34;;&#160;}<br/>
static&#160;create(pos)&#160;{<br/>
return&#160;new&#160;Player(pos.plus(new&#160;Vec(0,&#160;-0.5)),<br/>
new&#160;Vec(0,&#160;0));<br/>
}<br/>
}<br/>
Player.prototype.size&#160;=&#160;new&#160;Vec(0.8,&#160;1.5);<br/>
Because&#160;a&#160;player&#160;is&#160;one-and-a-half&#160;squares&#160;high,&#160;its&#160;initial&#160;position&#160;is&#160;set&#160;to<br/>
be&#160;half&#160;a&#160;square&#160;above&#160;the&#160;position&#160;where&#160;the&#160;@&#160;character&#160;appeared.&#160;This&#160;way,<br/>its&#160;bottom&#160;aligns&#160;with&#160;the&#160;bottom&#160;of&#160;the&#160;square&#160;it&#160;appeared&#160;in.<br/>
The&#160;size&#160;property&#160;is&#160;the&#160;same&#160;for&#160;all&#160;instances&#160;of&#160;Player,&#160;so&#160;we&#160;store&#160;it&#160;on<br/>
the&#160;prototype&#160;rather&#160;than&#160;on&#160;the&#160;instances&#160;themselves.&#160;We&#160;could&#160;have&#160;used<br/>a&#160;getter&#160;like&#160;type,&#160;but&#160;that&#160;would&#160;create&#160;and&#160;return&#160;a&#160;new&#160;Vec&#160;object&#160;every<br/>time&#160;the&#160;property&#160;is&#160;read,&#160;which&#160;would&#160;be&#160;wasteful.&#160;(Strings,&#160;being&#160;immutable,<br/>don’t&#160;have&#160;to&#160;be&#160;re-created&#160;every&#160;time&#160;they&#160;are&#160;evaluated.)<br/>
When&#160;constructing&#160;a&#160;Lava&#160;actor,&#160;we&#160;need&#160;to&#160;initialize&#160;the&#160;object&#160;differently<br/>
depending&#160;on&#160;the&#160;character&#160;it&#160;is&#160;based&#160;on.&#160;Dynamic&#160;lava&#160;moves&#160;along&#160;at&#160;its<br/>current&#160;speed&#160;until&#160;it&#160;hits&#160;an&#160;obstacle.&#160;At&#160;that&#160;point,&#160;if&#160;it&#160;has&#160;a&#160;reset&#160;property,<br/>
266<br/>
<hr/>
<a name=279></a>it&#160;will&#160;jump&#160;back&#160;to&#160;its&#160;start&#160;position&#160;(dripping).&#160;If&#160;it&#160;does&#160;not,&#160;it&#160;will&#160;invert<br/>its&#160;speed&#160;and&#160;continue&#160;in&#160;the&#160;other&#160;direction&#160;(bouncing).<br/>
The&#160;create&#160;method&#160;looks&#160;at&#160;the&#160;character&#160;that&#160;the&#160;Level&#160;constructor&#160;passes<br/>
and&#160;creates&#160;the&#160;appropriate&#160;lava&#160;actor.<br/>
class&#160;Lava&#160;{<br/>
constructor(pos,&#160;speed,&#160;reset)&#160;{<br/>
this.pos&#160;=&#160;pos;<br/>this.speed&#160;=&#160;speed;<br/>this.reset&#160;=&#160;reset;<br/>
}<br/>
get&#160;type()&#160;{&#160;return&#160;&#34;lava&#34;;&#160;}<br/>
static&#160;create(pos,&#160;ch)&#160;{<br/>
if&#160;(ch&#160;==&#160;&#34;=&#34;)&#160;{<br/>
return&#160;new&#160;Lava(pos,&#160;new&#160;Vec(2,&#160;0));<br/>
}&#160;else&#160;if&#160;(ch&#160;==&#160;&#34;|&#34;)&#160;{<br/>
return&#160;new&#160;Lava(pos,&#160;new&#160;Vec(0,&#160;2));<br/>
}&#160;else&#160;if&#160;(ch&#160;==&#160;&#34;v&#34;)&#160;{<br/>
return&#160;new&#160;Lava(pos,&#160;new&#160;Vec(0,&#160;3),&#160;pos);<br/>
}<br/>
}<br/>
}<br/>
Lava.prototype.size&#160;=&#160;new&#160;Vec(1,&#160;1);<br/>
Coin&#160;actors&#160;are&#160;relatively&#160;simple.&#160;They&#160;mostly&#160;just&#160;sit&#160;in&#160;their&#160;place.&#160;But<br/>
to&#160;liven&#160;up&#160;the&#160;game&#160;a&#160;little,&#160;they&#160;are&#160;given&#160;a&#160;“wobble”,&#160;a&#160;slight&#160;vertical&#160;back-<br/>and-forth&#160;motion.&#160;To&#160;track&#160;this,&#160;a&#160;coin&#160;object&#160;stores&#160;a&#160;base&#160;position&#160;as&#160;well<br/>as&#160;a&#160;wobble&#160;property&#160;that&#160;tracks&#160;the&#160;phase&#160;of&#160;the&#160;bouncing&#160;motion.&#160;Together,<br/>these&#160;determine&#160;the&#160;coin’s&#160;actual&#160;position&#160;(stored&#160;in&#160;the&#160;pos&#160;property).<br/>
class&#160;Coin&#160;{<br/>
constructor(pos,&#160;basePos,&#160;wobble)&#160;{<br/>
this.pos&#160;=&#160;pos;<br/>this.basePos&#160;=&#160;basePos;<br/>this.wobble&#160;=&#160;wobble;<br/>
}<br/>
get&#160;type()&#160;{&#160;return&#160;&#34;coin&#34;;&#160;}<br/>
static&#160;create(pos)&#160;{<br/>
let&#160;basePos&#160;=&#160;pos.plus(new&#160;Vec(0.2,&#160;0.1));<br/>
267<br/>
<hr/>
<a name=280></a>return&#160;new&#160;Coin(basePos,&#160;basePos,<br/>
Math.random()&#160;*&#160;Math.PI&#160;*&#160;2);<br/>
}<br/>
}<br/>
Coin.prototype.size&#160;=&#160;new&#160;Vec(0.6,&#160;0.6);<br/>
In&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14</a>,&#160;we&#160;saw&#160;that&#160;Math.sin&#160;gives&#160;us&#160;the&#160;y-coordinate&#160;of&#160;a&#160;point<br/>
on&#160;a&#160;circle.&#160;That&#160;coordinate&#160;goes&#160;back&#160;and&#160;forth&#160;in&#160;a&#160;smooth&#160;waveform&#160;as<br/>we&#160;move&#160;along&#160;the&#160;circle,&#160;which&#160;makes&#160;the&#160;sine&#160;function&#160;useful&#160;for&#160;modeling&#160;a<br/>wavy&#160;motion.<br/>
To&#160;avoid&#160;a&#160;situation&#160;where&#160;all&#160;coins&#160;move&#160;up&#160;and&#160;down&#160;synchronously,&#160;the<br/>
starting&#160;phase&#160;of&#160;each&#160;coin&#160;is&#160;randomized.&#160;The&#160;<i>phase&#160;</i>of&#160;Math.sin’s&#160;wave,&#160;the<br/>width&#160;of&#160;a&#160;wave&#160;it&#160;produces,&#160;is&#160;2<i>π</i>.&#160;We&#160;multiply&#160;the&#160;value&#160;returned&#160;by&#160;Math<br/>.random&#160;by&#160;that&#160;number&#160;to&#160;give&#160;the&#160;coin&#160;a&#160;random&#160;starting&#160;position&#160;on&#160;the<br/>wave.<br/>
We&#160;can&#160;now&#160;define&#160;the&#160;levelChars&#160;object&#160;that&#160;maps&#160;plan&#160;characters&#160;to&#160;either<br/>
background&#160;grid&#160;types&#160;or&#160;actor&#160;classes.<br/>
const&#160;levelChars&#160;=&#160;{<br/>
&#34;.&#34;:&#160;&#34;empty&#34;,&#160;&#34;#&#34;:&#160;&#34;wall&#34;,&#160;&#34;+&#34;:&#160;&#34;lava&#34;,<br/>&#34;@&#34;:&#160;Player,&#160;&#34;o&#34;:&#160;Coin,<br/>&#34;=&#34;:&#160;Lava,&#160;&#34;|&#34;:&#160;Lava,&#160;&#34;v&#34;:&#160;Lava<br/>
};<br/>
That&#160;gives&#160;us&#160;all&#160;the&#160;parts&#160;needed&#160;to&#160;create&#160;a&#160;Level&#160;instance.<br/>
let&#160;simpleLevel&#160;=&#160;new&#160;Level(simpleLevelPlan);<br/>console.log(`${simpleLevel.width}&#160;by&#160;${simpleLevel.height}`);<br/>//&#160;→&#160;22&#160;by&#160;9<br/>
The&#160;task&#160;ahead&#160;is&#160;to&#160;display&#160;such&#160;levels&#160;on&#160;the&#160;screen&#160;and&#160;to&#160;model&#160;time&#160;and<br/>
motion&#160;inside&#160;them.<br/>
<b>Encapsulation&#160;as&#160;a&#160;burden</b><br/>
Most&#160;of&#160;the&#160;code&#160;in&#160;this&#160;chapter&#160;does&#160;not&#160;worry&#160;about&#160;encapsulation&#160;very&#160;much<br/>for&#160;two&#160;reasons.&#160;First,&#160;encapsulation&#160;takes&#160;extra&#160;effort.&#160;It&#160;makes&#160;programs<br/>bigger&#160;and&#160;requires&#160;additional&#160;concepts&#160;and&#160;interfaces&#160;to&#160;be&#160;introduced.&#160;Since<br/>there&#160;is&#160;only&#160;so&#160;much&#160;code&#160;you&#160;can&#160;throw&#160;at&#160;a&#160;reader&#160;before&#160;their&#160;eyes&#160;glaze<br/>
268<br/>
<hr/>
<a name=281></a>over,&#160;I’ve&#160;made&#160;an&#160;effort&#160;to&#160;keep&#160;the&#160;program&#160;small.<br/>
Second,&#160;the&#160;various&#160;elements&#160;in&#160;this&#160;game&#160;are&#160;so&#160;closely&#160;tied&#160;together&#160;that<br/>
if&#160;the&#160;behavior&#160;of&#160;one&#160;of&#160;them&#160;changed,&#160;it&#160;is&#160;unlikely&#160;that&#160;any&#160;of&#160;the&#160;others<br/>would&#160;be&#160;able&#160;to&#160;stay&#160;the&#160;same.&#160;Interfaces&#160;between&#160;the&#160;elements&#160;would&#160;end<br/>up&#160;encoding&#160;a&#160;lot&#160;of&#160;assumptions&#160;about&#160;the&#160;way&#160;the&#160;game&#160;works.&#160;This&#160;makes<br/>them&#160;a&#160;lot&#160;less&#160;effective—whenever&#160;you&#160;change&#160;one&#160;part&#160;of&#160;the&#160;system,&#160;you&#160;still<br/>have&#160;to&#160;worry&#160;about&#160;the&#160;way&#160;it&#160;impacts&#160;the&#160;other&#160;parts&#160;because&#160;their&#160;interfaces<br/>wouldn’t&#160;cover&#160;the&#160;new&#160;situation.<br/>
Some&#160;<i>cutting&#160;points&#160;</i>in&#160;a&#160;system&#160;lend&#160;themselves&#160;well&#160;to&#160;separation&#160;through<br/>
rigorous&#160;interfaces,&#160;but&#160;others&#160;don’t.&#160;Trying&#160;to&#160;encapsulate&#160;something&#160;that<br/>isn’t&#160;a&#160;suitable&#160;boundary&#160;is&#160;a&#160;sure&#160;way&#160;to&#160;waste&#160;a&#160;lot&#160;of&#160;energy.&#160;When&#160;you<br/>are&#160;making&#160;this&#160;mistake,&#160;you’ll&#160;usually&#160;notice&#160;that&#160;your&#160;interfaces&#160;are&#160;getting<br/>awkwardly&#160;large&#160;and&#160;detailed&#160;and&#160;that&#160;they&#160;need&#160;to&#160;be&#160;changed&#160;often,&#160;as&#160;the<br/>program&#160;evolves.<br/>
There&#160;is&#160;one&#160;thing&#160;that&#160;we&#160;<i>will&#160;</i>encapsulate,&#160;and&#160;that&#160;is&#160;the&#160;drawing&#160;subsys-<br/>
tem.&#160;The&#160;reason&#160;for&#160;this&#160;is&#160;that&#160;we’ll&#160;display&#160;the&#160;same&#160;game&#160;in&#160;a&#160;different&#160;way<br/>in&#160;the&#160;<a href="eloquent-javascripts.html#310">next&#160;chapter</a>.&#160;By&#160;putting&#160;the&#160;drawing&#160;behind&#160;an&#160;interface,&#160;we&#160;can&#160;load<br/>the&#160;same&#160;game&#160;program&#160;there&#160;and&#160;plug&#160;in&#160;a&#160;new&#160;display&#160;module.<br/>
<b>Drawing</b><br/>
The&#160;encapsulation&#160;of&#160;the&#160;drawing&#160;code&#160;is&#160;done&#160;by&#160;defining&#160;a&#160;<i>display&#160;</i>object,<br/>which&#160;displays&#160;a&#160;given&#160;level&#160;and&#160;state.&#160;The&#160;display&#160;type&#160;we&#160;define&#160;in&#160;this<br/>chapter&#160;is&#160;called&#160;DOMDisplay&#160;because&#160;it&#160;uses&#160;DOM&#160;elements&#160;to&#160;show&#160;the&#160;level.<br/>
We’ll&#160;be&#160;using&#160;a&#160;style&#160;sheet&#160;to&#160;set&#160;the&#160;actual&#160;colors&#160;and&#160;other&#160;fixed&#160;properties<br/>
of&#160;the&#160;elements&#160;that&#160;make&#160;up&#160;the&#160;game.&#160;It&#160;would&#160;also&#160;be&#160;possible&#160;to&#160;directly<br/>assign&#160;to&#160;the&#160;elements’&#160;style&#160;property&#160;when&#160;we&#160;create&#160;them,&#160;but&#160;that&#160;would<br/>produce&#160;more&#160;verbose&#160;programs.<br/>
The&#160;following&#160;helper&#160;function&#160;provides&#160;a&#160;succinct&#160;way&#160;to&#160;create&#160;an&#160;element<br/>
and&#160;give&#160;it&#160;some&#160;attributes&#160;and&#160;child&#160;nodes:<br/>
function&#160;elt(name,&#160;attrs,&#160;...children)&#160;{<br/>
let&#160;dom&#160;=&#160;document.createElement(name);<br/>for&#160;(let&#160;attr&#160;of&#160;Object.keys(attrs))&#160;{<br/>
dom.setAttribute(attr,&#160;attrs[attr]);<br/>
}<br/>for&#160;(let&#160;child&#160;of&#160;children)&#160;{<br/>
dom.appendChild(child);<br/>
}<br/>return&#160;dom;<br/>
}<br/>
269<br/>
<hr/>
<a name=282></a>A&#160;display&#160;is&#160;created&#160;by&#160;giving&#160;it&#160;a&#160;parent&#160;element&#160;to&#160;which&#160;it&#160;should&#160;append<br/>
itself&#160;and&#160;a&#160;level&#160;object.<br/>
class&#160;DOMDisplay&#160;{<br/>
constructor(parent,&#160;level)&#160;{<br/>
this.dom&#160;=&#160;elt(&#34;div&#34;,&#160;{class:&#160;&#34;game&#34;},&#160;drawGrid(level));<br/>this.actorLayer&#160;=&#160;null;<br/>parent.appendChild(this.dom);<br/>
}<br/>
clear()&#160;{&#160;this.dom.remove();&#160;}<br/>
}<br/>
The&#160;level’s&#160;background&#160;grid,&#160;which&#160;never&#160;changes,&#160;is&#160;drawn&#160;once.&#160;Actors&#160;are<br/>
redrawn&#160;every&#160;time&#160;the&#160;display&#160;is&#160;updated&#160;with&#160;a&#160;given&#160;state.&#160;The&#160;actorLayer<br/>property&#160;will&#160;be&#160;used&#160;to&#160;track&#160;the&#160;element&#160;that&#160;holds&#160;the&#160;actors&#160;so&#160;that&#160;they<br/>can&#160;be&#160;easily&#160;removed&#160;and&#160;replaced.<br/>
Our&#160;coordinates&#160;and&#160;sizes&#160;are&#160;tracked&#160;in&#160;grid&#160;units,&#160;where&#160;a&#160;size&#160;or&#160;distance<br/>
of&#160;1&#160;means&#160;one&#160;grid&#160;block.&#160;When&#160;setting&#160;pixel&#160;sizes,&#160;we&#160;will&#160;have&#160;to&#160;scale&#160;these<br/>coordinates&#160;up—everything&#160;in&#160;the&#160;game&#160;would&#160;be&#160;ridiculously&#160;small&#160;at&#160;a&#160;single<br/>pixel&#160;per&#160;square.&#160;The&#160;scale&#160;constant&#160;gives&#160;the&#160;number&#160;of&#160;pixels&#160;that&#160;a&#160;single<br/>unit&#160;takes&#160;up&#160;on&#160;the&#160;screen.<br/>
const&#160;scale&#160;=&#160;20;<br/>
function&#160;drawGrid(level)&#160;{<br/>
return&#160;elt(&#34;table&#34;,&#160;{<br/>
class:&#160;&#34;background&#34;,<br/>style:&#160;`width:&#160;${level.width&#160;*&#160;scale}px`<br/>
},&#160;...level.rows.map(row&#160;=&gt;<br/>
elt(&#34;tr&#34;,&#160;{style:&#160;`height:&#160;${scale}px`},<br/>
...row.map(type&#160;=&gt;&#160;elt(&#34;td&#34;,&#160;{class:&#160;type})))<br/>
));<br/>
}<br/>
As&#160;mentioned,&#160;the&#160;background&#160;is&#160;drawn&#160;as&#160;a&#160;&lt;table&gt;&#160;element.&#160;This&#160;nicely<br/>
corresponds&#160;to&#160;the&#160;structure&#160;of&#160;the&#160;rows&#160;property&#160;of&#160;the&#160;level—each&#160;row&#160;of&#160;the<br/>grid&#160;is&#160;turned&#160;into&#160;a&#160;table&#160;row&#160;(&lt;tr&gt;&#160;element).&#160;The&#160;strings&#160;in&#160;the&#160;grid&#160;are<br/>used&#160;as&#160;class&#160;names&#160;for&#160;the&#160;table&#160;cell&#160;(&lt;td&gt;)&#160;elements.&#160;The&#160;spread&#160;(triple&#160;dot)<br/>operator&#160;is&#160;used&#160;to&#160;pass&#160;arrays&#160;of&#160;child&#160;nodes&#160;to&#160;elt&#160;as&#160;separate&#160;arguments.<br/>
The&#160;following&#160;CSS&#160;makes&#160;the&#160;table&#160;look&#160;like&#160;the&#160;background&#160;we&#160;want:<br/>
270<br/>
<hr/>
<a name=283></a>.background<br/>
{&#160;background:&#160;rgb(52,&#160;166,&#160;251);<br/>
table-layout:&#160;fixed;<br/>border-spacing:&#160;0;<br/>
}<br/>
.background&#160;td&#160;{&#160;padding:&#160;0;<br/>
}<br/>
.lava<br/>
{&#160;background:&#160;rgb(255,&#160;100,&#160;100);&#160;}<br/>
.wall<br/>
{&#160;background:&#160;white;<br/>
}<br/>
Some&#160;of&#160;these&#160;(table-layout,&#160;border-spacing,&#160;and&#160;padding)&#160;are&#160;used&#160;to<br/>
suppress&#160;unwanted&#160;default&#160;behavior.&#160;We&#160;don’t&#160;want&#160;the&#160;layout&#160;of&#160;the&#160;table&#160;to<br/>depend&#160;upon&#160;the&#160;contents&#160;of&#160;its&#160;cells,&#160;and&#160;we&#160;don’t&#160;want&#160;space&#160;between&#160;the<br/>table&#160;cells&#160;or&#160;padding&#160;inside&#160;them.<br/>
The&#160;background&#160;rule&#160;sets&#160;the&#160;background&#160;color.&#160;CSS&#160;allows&#160;colors&#160;to&#160;be&#160;spec-<br/>
ified&#160;both&#160;as&#160;words&#160;(white)&#160;or&#160;with&#160;a&#160;format&#160;such&#160;as&#160;rgb(R,&#160;G,&#160;B),&#160;where&#160;the<br/>red,&#160;green,&#160;and&#160;blue&#160;components&#160;of&#160;the&#160;color&#160;are&#160;separated&#160;into&#160;three&#160;numbers<br/>from&#160;0&#160;to&#160;255.&#160;So,&#160;in&#160;rgb(52,&#160;166,&#160;251),&#160;the&#160;red&#160;component&#160;is&#160;52,&#160;green&#160;is<br/>166,&#160;and&#160;blue&#160;is&#160;251.&#160;Since&#160;the&#160;blue&#160;component&#160;is&#160;the&#160;largest,&#160;the&#160;resulting<br/>color&#160;will&#160;be&#160;bluish.&#160;You&#160;can&#160;see&#160;that&#160;in&#160;the&#160;.lava&#160;rule,&#160;the&#160;first&#160;number&#160;(red)<br/>is&#160;the&#160;largest.<br/>
We&#160;draw&#160;each&#160;actor&#160;by&#160;creating&#160;a&#160;DOM&#160;element&#160;for&#160;it&#160;and&#160;setting&#160;that<br/>
element’s&#160;position&#160;and&#160;size&#160;based&#160;on&#160;the&#160;actor’s&#160;properties.&#160;The&#160;values&#160;have&#160;to<br/>be&#160;multiplied&#160;by&#160;scale&#160;to&#160;go&#160;from&#160;game&#160;units&#160;to&#160;pixels.<br/>
function&#160;drawActors(actors)&#160;{<br/>
return&#160;elt(&#34;div&#34;,&#160;{},&#160;...actors.map(actor&#160;=&gt;&#160;{<br/>
let&#160;rect&#160;=&#160;elt(&#34;div&#34;,&#160;{class:&#160;`actor&#160;${actor.type}`});<br/>rect.style.width&#160;=&#160;`${actor.size.x&#160;*&#160;scale}px`;<br/>rect.style.height&#160;=&#160;`${actor.size.y&#160;*&#160;scale}px`;<br/>rect.style.left&#160;=&#160;`${actor.pos.x&#160;*&#160;scale}px`;<br/>rect.style.top&#160;=&#160;`${actor.pos.y&#160;*&#160;scale}px`;<br/>return&#160;rect;<br/>
}));<br/>
}<br/>
To&#160;give&#160;an&#160;element&#160;more&#160;than&#160;one&#160;class,&#160;we&#160;separate&#160;the&#160;class&#160;names&#160;by<br/>
spaces.&#160;In&#160;the&#160;CSS&#160;code&#160;shown&#160;next,&#160;the&#160;actor&#160;class&#160;gives&#160;the&#160;actors&#160;their<br/>absolute&#160;position.&#160;Their&#160;type&#160;name&#160;is&#160;used&#160;as&#160;an&#160;extra&#160;class&#160;to&#160;give&#160;them&#160;a<br/>color.&#160;We&#160;don’t&#160;have&#160;to&#160;define&#160;the&#160;lava&#160;class&#160;again&#160;because&#160;we’re&#160;reusing&#160;the<br/>class&#160;for&#160;the&#160;lava&#160;grid&#160;squares&#160;we&#160;defined&#160;earlier.<br/>
.actor<br/>
{&#160;position:&#160;absolute;<br/>
}<br/>
.coin<br/>
{&#160;background:&#160;rgb(241,&#160;229,&#160;89);&#160;}<br/>
.player&#160;{&#160;background:&#160;rgb(64,&#160;64,&#160;64);<br/>
}<br/>
271<br/>
<hr/>
<a name=284></a>The&#160;syncState&#160;method&#160;is&#160;used&#160;to&#160;make&#160;the&#160;display&#160;show&#160;a&#160;given&#160;state.&#160;It<br/>
first&#160;removes&#160;the&#160;old&#160;actor&#160;graphics,&#160;if&#160;any,&#160;and&#160;then&#160;redraws&#160;the&#160;actors&#160;in<br/>their&#160;new&#160;positions.&#160;It&#160;may&#160;be&#160;tempting&#160;to&#160;try&#160;to&#160;reuse&#160;the&#160;DOM&#160;elements&#160;for<br/>actors,&#160;but&#160;to&#160;make&#160;that&#160;work,&#160;we&#160;would&#160;need&#160;a&#160;lot&#160;of&#160;additional&#160;bookkeeping<br/>to&#160;associate&#160;actors&#160;with&#160;DOM&#160;elements&#160;and&#160;to&#160;make&#160;sure&#160;we&#160;remove&#160;elements<br/>when&#160;their&#160;actors&#160;vanish.&#160;Since&#160;there&#160;will&#160;typically&#160;be&#160;only&#160;a&#160;handful&#160;of&#160;actors<br/>in&#160;the&#160;game,&#160;redrawing&#160;all&#160;of&#160;them&#160;is&#160;not&#160;expensive.<br/>
DOMDisplay.prototype.syncState&#160;=&#160;function(state)&#160;{<br/>
if&#160;(this.actorLayer)&#160;this.actorLayer.remove();<br/>this.actorLayer&#160;=&#160;drawActors(state.actors);<br/>this.dom.appendChild(this.actorLayer);<br/>this.dom.className&#160;=&#160;`game&#160;${state.status}`;<br/>this.scrollPlayerIntoView(state);<br/>
};<br/>
By&#160;adding&#160;the&#160;level’s&#160;current&#160;status&#160;as&#160;a&#160;class&#160;name&#160;to&#160;the&#160;wrapper,&#160;we&#160;can<br/>
style&#160;the&#160;player&#160;actor&#160;slightly&#160;differently&#160;when&#160;the&#160;game&#160;is&#160;won&#160;or&#160;lost&#160;by&#160;adding<br/>a&#160;CSS&#160;rule&#160;that&#160;takes&#160;effect&#160;only&#160;when&#160;the&#160;player&#160;has&#160;an&#160;ancestor&#160;element&#160;with<br/>a&#160;given&#160;class.<br/>
.lost&#160;.player&#160;{<br/>
background:&#160;rgb(160,&#160;64,&#160;64);<br/>
}<br/>.won&#160;.player&#160;{<br/>
box-shadow:&#160;-4px&#160;-7px&#160;8px&#160;white,&#160;4px&#160;-7px&#160;8px&#160;white;<br/>
}<br/>
After&#160;touching&#160;lava,&#160;the&#160;player’s&#160;color&#160;turns&#160;dark&#160;red,&#160;suggesting&#160;scorching.<br/>
When&#160;the&#160;last&#160;coin&#160;has&#160;been&#160;collected,&#160;we&#160;add&#160;two&#160;blurred&#160;white&#160;shadows—one<br/>to&#160;the&#160;top&#160;left&#160;and&#160;one&#160;to&#160;the&#160;top&#160;right—to&#160;create&#160;a&#160;white&#160;halo&#160;effect.<br/>
We&#160;can’t&#160;assume&#160;that&#160;the&#160;level&#160;always&#160;fits&#160;in&#160;the&#160;<i>viewport</i>—the&#160;element&#160;into<br/>
which&#160;we&#160;draw&#160;the&#160;game.&#160;That&#160;is&#160;why&#160;the&#160;scrollPlayerIntoView&#160;call&#160;is&#160;needed.<br/>It&#160;ensures&#160;that&#160;if&#160;the&#160;level&#160;is&#160;protruding&#160;outside&#160;the&#160;viewport,&#160;we&#160;scroll&#160;that<br/>viewport&#160;to&#160;make&#160;sure&#160;the&#160;player&#160;is&#160;near&#160;its&#160;center.&#160;The&#160;following&#160;CSS&#160;gives<br/>the&#160;game’s&#160;wrapping&#160;DOM&#160;element&#160;a&#160;maximum&#160;size&#160;and&#160;ensures&#160;that&#160;anything<br/>that&#160;sticks&#160;out&#160;of&#160;the&#160;element’s&#160;box&#160;is&#160;not&#160;visible.&#160;We&#160;also&#160;give&#160;it&#160;a&#160;relative<br/>position&#160;so&#160;that&#160;the&#160;actors&#160;inside&#160;it&#160;are&#160;positioned&#160;relative&#160;to&#160;the&#160;level’s&#160;top-left<br/>corner.<br/>
272<br/>
<hr/>
<a name=285></a>.game&#160;{<br/>
overflow:&#160;hidden;<br/>max-width:&#160;600px;<br/>max-height:&#160;450px;<br/>position:&#160;relative;<br/>
}<br/>
In&#160;the&#160;scrollPlayerIntoView&#160;method,&#160;we&#160;find&#160;the&#160;player’s&#160;position&#160;and&#160;up-<br/>
date&#160;the&#160;wrapping&#160;element’s&#160;scroll&#160;position.&#160;We&#160;change&#160;the&#160;scroll&#160;position&#160;by<br/>manipulating&#160;that&#160;element’s&#160;scrollLeft&#160;and&#160;scrollTop&#160;properties&#160;when&#160;the<br/>player&#160;is&#160;too&#160;close&#160;to&#160;the&#160;edge.<br/>
DOMDisplay.prototype.scrollPlayerIntoView&#160;=&#160;function(state)&#160;{<br/>
let&#160;width&#160;=&#160;this.dom.clientWidth;<br/>let&#160;height&#160;=&#160;this.dom.clientHeight;<br/>let&#160;margin&#160;=&#160;width&#160;/&#160;3;<br/>
//&#160;The&#160;viewport<br/>let&#160;left&#160;=&#160;this.dom.scrollLeft,&#160;right&#160;=&#160;left&#160;+&#160;width;<br/>let&#160;top&#160;=&#160;this.dom.scrollTop,&#160;bottom&#160;=&#160;top&#160;+&#160;height;<br/>
let&#160;player&#160;=&#160;state.player;<br/>let&#160;center&#160;=&#160;player.pos.plus(player.size.times(0.5))<br/>
.times(scale);<br/>
if&#160;(center.x&#160;&lt;&#160;left&#160;+&#160;margin)&#160;{<br/>
this.dom.scrollLeft&#160;=&#160;center.x&#160;-&#160;margin;<br/>
}&#160;else&#160;if&#160;(center.x&#160;&gt;&#160;right&#160;-&#160;margin)&#160;{<br/>
this.dom.scrollLeft&#160;=&#160;center.x&#160;+&#160;margin&#160;-&#160;width;<br/>
}<br/>if&#160;(center.y&#160;&lt;&#160;top&#160;+&#160;margin)&#160;{<br/>
this.dom.scrollTop&#160;=&#160;center.y&#160;-&#160;margin;<br/>
}&#160;else&#160;if&#160;(center.y&#160;&gt;&#160;bottom&#160;-&#160;margin)&#160;{<br/>
this.dom.scrollTop&#160;=&#160;center.y&#160;+&#160;margin&#160;-&#160;height;<br/>
}<br/>
};<br/>
The&#160;way&#160;the&#160;player’s&#160;center&#160;is&#160;found&#160;shows&#160;how&#160;the&#160;methods&#160;on&#160;our&#160;Vec&#160;type<br/>
allow&#160;computations&#160;with&#160;objects&#160;to&#160;be&#160;written&#160;in&#160;a&#160;relatively&#160;readable&#160;way.&#160;To<br/>find&#160;the&#160;actor’s&#160;center,&#160;we&#160;add&#160;its&#160;position&#160;(its&#160;top-left&#160;corner)&#160;and&#160;half&#160;its&#160;size.<br/>That&#160;is&#160;the&#160;center&#160;in&#160;level&#160;coordinates,&#160;but&#160;we&#160;need&#160;it&#160;in&#160;pixel&#160;coordinates,&#160;so<br/>we&#160;then&#160;multiply&#160;the&#160;resulting&#160;vector&#160;by&#160;our&#160;display&#160;scale.<br/>
Next,&#160;a&#160;series&#160;of&#160;checks&#160;verifies&#160;that&#160;the&#160;player&#160;position&#160;isn’t&#160;outside&#160;of&#160;the<br/>
273<br/>
<hr/>
<a name=286></a><img src="eloquent-javascript-286_1.png"/><br/>
allowed&#160;range.&#160;Note&#160;that&#160;sometimes&#160;this&#160;will&#160;set&#160;nonsense&#160;scroll&#160;coordinates<br/>that&#160;are&#160;below&#160;zero&#160;or&#160;beyond&#160;the&#160;element’s&#160;scrollable&#160;area.&#160;This&#160;is&#160;okay—the<br/>DOM&#160;will&#160;constrain&#160;them&#160;to&#160;acceptable&#160;values.&#160;Setting&#160;scrollLeft&#160;to&#160;-10&#160;will<br/>cause&#160;it&#160;to&#160;become&#160;0.<br/>
It&#160;would&#160;have&#160;been&#160;slightly&#160;simpler&#160;to&#160;always&#160;try&#160;to&#160;scroll&#160;the&#160;player&#160;to&#160;the<br/>
center&#160;of&#160;the&#160;viewport.&#160;But&#160;this&#160;creates&#160;a&#160;rather&#160;jarring&#160;effect.&#160;As&#160;you&#160;are<br/>jumping,&#160;the&#160;view&#160;will&#160;constantly&#160;shift&#160;up&#160;and&#160;down.&#160;It&#160;is&#160;more&#160;pleasant&#160;to<br/>have&#160;a&#160;“neutral”&#160;area&#160;in&#160;the&#160;middle&#160;of&#160;the&#160;screen&#160;where&#160;you&#160;can&#160;move&#160;around<br/>without&#160;causing&#160;any&#160;scrolling.<br/>
We&#160;are&#160;now&#160;able&#160;to&#160;display&#160;our&#160;tiny&#160;level.<br/>
&lt;link&#160;rel=&#34;stylesheet&#34;&#160;href=&#34;css/game.css&#34;&gt;<br/>
&lt;script&gt;<br/>
let&#160;simpleLevel&#160;=&#160;new&#160;Level(simpleLevelPlan);<br/>let&#160;display&#160;=&#160;new&#160;DOMDisplay(document.body,&#160;simpleLevel);<br/>display.syncState(State.start(simpleLevel));<br/>
&lt;/script&gt;<br/>
The&#160;&lt;link&gt;&#160;tag,&#160;when&#160;used&#160;with&#160;rel=&#34;stylesheet&#34;,&#160;is&#160;a&#160;way&#160;to&#160;load&#160;a&#160;CSS<br/>
file&#160;into&#160;a&#160;page.&#160;The&#160;file&#160;game.css&#160;contains&#160;the&#160;styles&#160;necessary&#160;for&#160;our&#160;game.<br/>
<b>Motion&#160;and&#160;collision</b><br/>
Now&#160;we’re&#160;at&#160;the&#160;point&#160;where&#160;we&#160;can&#160;start&#160;adding&#160;motion—the&#160;most&#160;interesting<br/>aspect&#160;of&#160;the&#160;game.&#160;The&#160;basic&#160;approach,&#160;taken&#160;by&#160;most&#160;games&#160;like&#160;this,&#160;is&#160;to<br/>split&#160;time&#160;into&#160;small&#160;steps&#160;and,&#160;for&#160;each&#160;step,&#160;move&#160;the&#160;actors&#160;by&#160;a&#160;distance<br/>corresponding&#160;to&#160;their&#160;speed&#160;multiplied&#160;by&#160;the&#160;size&#160;of&#160;the&#160;time&#160;step.&#160;We’ll<br/>measure&#160;time&#160;in&#160;seconds,&#160;so&#160;speeds&#160;are&#160;expressed&#160;in&#160;units&#160;per&#160;second.<br/>
Moving&#160;things&#160;is&#160;easy.&#160;The&#160;difficult&#160;part&#160;is&#160;dealing&#160;with&#160;the&#160;interactions<br/>
between&#160;the&#160;elements.&#160;When&#160;the&#160;player&#160;hits&#160;a&#160;wall&#160;or&#160;floor,&#160;they&#160;should&#160;not<br/>simply&#160;move&#160;through&#160;it.&#160;The&#160;game&#160;must&#160;notice&#160;when&#160;a&#160;given&#160;motion&#160;causes<br/>an&#160;object&#160;to&#160;hit&#160;another&#160;object&#160;and&#160;respond&#160;accordingly.&#160;For&#160;walls,&#160;the&#160;motion<br/>must&#160;be&#160;stopped.&#160;When&#160;hitting&#160;a&#160;coin,&#160;it&#160;must&#160;be&#160;collected.&#160;When&#160;touching<br/>
274<br/>
<hr/>
<a name=287></a>lava,&#160;the&#160;game&#160;should&#160;be&#160;lost.<br/>
Solving&#160;this&#160;for&#160;the&#160;general&#160;case&#160;is&#160;a&#160;big&#160;task.&#160;You&#160;can&#160;find&#160;libraries,&#160;usually<br/>
called&#160;<i>physics&#160;engines</i>,&#160;that&#160;simulate&#160;interaction&#160;between&#160;physical&#160;objects&#160;in<br/>two&#160;or&#160;three&#160;dimensions.&#160;We’ll&#160;take&#160;a&#160;more&#160;modest&#160;approach&#160;in&#160;this&#160;chapter,<br/>handling&#160;only&#160;collisions&#160;between&#160;rectangular&#160;objects&#160;and&#160;handling&#160;them&#160;in&#160;a<br/>rather&#160;simplistic&#160;way.<br/>
Before&#160;moving&#160;the&#160;player&#160;or&#160;a&#160;block&#160;of&#160;lava,&#160;we&#160;test&#160;whether&#160;the&#160;motion&#160;would<br/>
take&#160;it&#160;inside&#160;of&#160;a&#160;wall.&#160;If&#160;it&#160;does,&#160;we&#160;simply&#160;cancel&#160;the&#160;motion&#160;altogether.&#160;The<br/>response&#160;to&#160;such&#160;a&#160;collision&#160;depends&#160;on&#160;the&#160;type&#160;of&#160;actor—the&#160;player&#160;will&#160;stop,<br/>whereas&#160;a&#160;lava&#160;block&#160;will&#160;bounce&#160;back.<br/>
This&#160;approach&#160;requires&#160;our&#160;time&#160;steps&#160;to&#160;be&#160;rather&#160;small&#160;since&#160;it&#160;will&#160;cause<br/>
motion&#160;to&#160;stop&#160;before&#160;the&#160;objects&#160;actually&#160;touch.&#160;If&#160;the&#160;time&#160;steps&#160;(and&#160;thus<br/>the&#160;motion&#160;steps)&#160;are&#160;too&#160;big,&#160;the&#160;player&#160;would&#160;end&#160;up&#160;hovering&#160;a&#160;noticeable<br/>distance&#160;above&#160;the&#160;ground.&#160;Another&#160;approach,&#160;arguably&#160;better&#160;but&#160;more&#160;com-<br/>plicated,&#160;would&#160;be&#160;to&#160;find&#160;the&#160;exact&#160;collision&#160;spot&#160;and&#160;move&#160;there.&#160;We&#160;will&#160;take<br/>the&#160;simple&#160;approach&#160;and&#160;hide&#160;its&#160;problems&#160;by&#160;ensuring&#160;the&#160;animation&#160;proceeds<br/>in&#160;small&#160;steps.<br/>
This&#160;method&#160;tells&#160;us&#160;whether&#160;a&#160;rectangle&#160;(specified&#160;by&#160;a&#160;position&#160;and&#160;a&#160;size)<br/>
touches&#160;a&#160;grid&#160;element&#160;of&#160;the&#160;given&#160;type.<br/>
Level.prototype.touches&#160;=&#160;function(pos,&#160;size,&#160;type)&#160;{<br/>
var&#160;xStart&#160;=&#160;Math.floor(pos.x);<br/>var&#160;xEnd&#160;=&#160;Math.ceil(pos.x&#160;+&#160;size.x);<br/>var&#160;yStart&#160;=&#160;Math.floor(pos.y);<br/>var&#160;yEnd&#160;=&#160;Math.ceil(pos.y&#160;+&#160;size.y);<br/>
for&#160;(var&#160;y&#160;=&#160;yStart;&#160;y&#160;&lt;&#160;yEnd;&#160;y++)&#160;{<br/>
for&#160;(var&#160;x&#160;=&#160;xStart;&#160;x&#160;&lt;&#160;xEnd;&#160;x++)&#160;{<br/>
let&#160;isOutside&#160;=&#160;x&#160;&lt;&#160;0&#160;||&#160;x&#160;&gt;=&#160;this.width&#160;||<br/>
y&#160;&lt;&#160;0&#160;||&#160;y&#160;&gt;=&#160;this.height;<br/>
let&#160;here&#160;=&#160;isOutside&#160;?&#160;&#34;wall&#34;&#160;:&#160;this.rows[y][x];<br/>if&#160;(here&#160;==&#160;type)&#160;return&#160;true;<br/>
}<br/>
}<br/>return&#160;false;<br/>
};<br/>
The&#160;method&#160;computes&#160;the&#160;set&#160;of&#160;grid&#160;squares&#160;that&#160;the&#160;body&#160;overlaps&#160;with<br/>
by&#160;using&#160;Math.floor&#160;and&#160;Math.ceil&#160;on&#160;its&#160;coordinates.&#160;Remember&#160;that&#160;grid<br/>squares&#160;are&#160;1&#160;by&#160;1&#160;units&#160;in&#160;size.&#160;By&#160;rounding&#160;the&#160;sides&#160;of&#160;a&#160;box&#160;up&#160;and&#160;down,<br/>we&#160;get&#160;the&#160;range&#160;of&#160;background&#160;squares&#160;that&#160;the&#160;box&#160;touches.<br/>
275<br/>
<hr/>
<a name=288></a>We&#160;loop&#160;over&#160;the&#160;block&#160;of&#160;grid&#160;squares&#160;found&#160;by&#160;rounding&#160;the&#160;coordinates<br/>
and&#160;return&#160;true&#160;when&#160;a&#160;matching&#160;square&#160;is&#160;found.&#160;Squares&#160;outside&#160;of&#160;the&#160;level<br/>are&#160;always&#160;treated&#160;as&#160;&#34;wall&#34;&#160;to&#160;ensure&#160;that&#160;the&#160;player&#160;can’t&#160;leave&#160;the&#160;world<br/>and&#160;that&#160;we&#160;won’t&#160;accidentally&#160;try&#160;to&#160;read&#160;outside&#160;of&#160;the&#160;bounds&#160;of&#160;our&#160;rows<br/>array.<br/>
The&#160;state&#160;update&#160;method&#160;uses&#160;touches&#160;to&#160;figure&#160;out&#160;whether&#160;the&#160;player&#160;is<br/>
touching&#160;lava.<br/>
State.prototype.update&#160;=&#160;function(time,&#160;keys)&#160;{<br/>
let&#160;actors&#160;=&#160;this.actors<br/>
.map(actor&#160;=&gt;&#160;actor.update(time,&#160;this,&#160;keys));<br/>
let&#160;newState&#160;=&#160;new&#160;State(this.level,&#160;actors,&#160;this.status);<br/>
if&#160;(newState.status&#160;!=&#160;&#34;playing&#34;)&#160;return&#160;newState;<br/>
let&#160;player&#160;=&#160;newState.player;<br/>if&#160;(this.level.touches(player.pos,&#160;player.size,&#160;&#34;lava&#34;))&#160;{<br/>
return&#160;new&#160;State(this.level,&#160;actors,&#160;&#34;lost&#34;);<br/>
}<br/>
for&#160;(let&#160;actor&#160;of&#160;actors)&#160;{<br/>
if&#160;(actor&#160;!=&#160;player&#160;&amp;&amp;&#160;overlap(actor,&#160;player))&#160;{<br/>
newState&#160;=&#160;actor.collide(newState);<br/>
}<br/>
}<br/>return&#160;newState;<br/>
};<br/>
The&#160;method&#160;is&#160;passed&#160;a&#160;time&#160;step&#160;and&#160;a&#160;data&#160;structure&#160;that&#160;tells&#160;it&#160;which<br/>
keys&#160;are&#160;being&#160;held&#160;down.&#160;The&#160;first&#160;thing&#160;it&#160;does&#160;is&#160;call&#160;the&#160;update&#160;method&#160;on<br/>all&#160;actors,&#160;producing&#160;an&#160;array&#160;of&#160;updated&#160;actors.&#160;The&#160;actors&#160;also&#160;get&#160;the&#160;time<br/>step,&#160;the&#160;keys,&#160;and&#160;the&#160;state,&#160;so&#160;that&#160;they&#160;can&#160;base&#160;their&#160;update&#160;on&#160;those.&#160;Only<br/>the&#160;player&#160;will&#160;actually&#160;read&#160;keys,&#160;since&#160;that’s&#160;the&#160;only&#160;actor&#160;that’s&#160;controlled<br/>by&#160;the&#160;keyboard.<br/>
If&#160;the&#160;game&#160;is&#160;already&#160;over,&#160;no&#160;further&#160;processing&#160;has&#160;to&#160;be&#160;done&#160;(the&#160;game<br/>
can’t&#160;be&#160;won&#160;after&#160;being&#160;lost,&#160;or&#160;vice&#160;versa).&#160;Otherwise,&#160;the&#160;method&#160;tests<br/>whether&#160;the&#160;player&#160;is&#160;touching&#160;background&#160;lava.&#160;If&#160;so,&#160;the&#160;game&#160;is&#160;lost,&#160;and<br/>
276<br/>
<hr/>
<a name=289></a>we’re&#160;done.&#160;Finally,&#160;if&#160;the&#160;game&#160;really&#160;is&#160;still&#160;going&#160;on,&#160;it&#160;sees&#160;whether&#160;any<br/>other&#160;actors&#160;overlap&#160;the&#160;player.<br/>
Overlap&#160;between&#160;actors&#160;is&#160;detected&#160;with&#160;the&#160;overlap&#160;function.&#160;It&#160;takes&#160;two<br/>
actor&#160;objects&#160;and&#160;returns&#160;true&#160;when&#160;they&#160;touch—which&#160;is&#160;the&#160;case&#160;when&#160;they<br/>overlap&#160;both&#160;along&#160;the&#160;x-axis&#160;and&#160;along&#160;the&#160;y-axis.<br/>
function&#160;overlap(actor1,&#160;actor2)&#160;{<br/>
return&#160;actor1.pos.x&#160;+&#160;actor1.size.x&#160;&gt;&#160;actor2.pos.x&#160;&amp;&amp;<br/>
actor1.pos.x&#160;&lt;&#160;actor2.pos.x&#160;+&#160;actor2.size.x&#160;&amp;&amp;<br/>actor1.pos.y&#160;+&#160;actor1.size.y&#160;&gt;&#160;actor2.pos.y&#160;&amp;&amp;<br/>actor1.pos.y&#160;&lt;&#160;actor2.pos.y&#160;+&#160;actor2.size.y;<br/>
}<br/>
If&#160;any&#160;actor&#160;does&#160;overlap,&#160;its&#160;collide&#160;method&#160;gets&#160;a&#160;chance&#160;to&#160;update&#160;the<br/>
state.&#160;Touching&#160;a&#160;lava&#160;actor&#160;sets&#160;the&#160;game&#160;status&#160;to&#160;&#34;lost&#34;.&#160;Coins&#160;vanish&#160;when<br/>you&#160;touch&#160;them&#160;and&#160;set&#160;the&#160;status&#160;to&#160;&#34;won&#34;&#160;when&#160;they&#160;are&#160;the&#160;last&#160;coin&#160;of&#160;the<br/>level.<br/>
Lava.prototype.collide&#160;=&#160;function(state)&#160;{<br/>
return&#160;new&#160;State(state.level,&#160;state.actors,&#160;&#34;lost&#34;);<br/>
};<br/>
Coin.prototype.collide&#160;=&#160;function(state)&#160;{<br/>
let&#160;filtered&#160;=&#160;state.actors.filter(a&#160;=&gt;&#160;a&#160;!=&#160;this);<br/>let&#160;status&#160;=&#160;state.status;<br/>if&#160;(!filtered.some(a&#160;=&gt;&#160;a.type&#160;==&#160;&#34;coin&#34;))&#160;status&#160;=&#160;&#34;won&#34;;<br/>return&#160;new&#160;State(state.level,&#160;filtered,&#160;status);<br/>
};<br/>
<b>Actor&#160;updates</b><br/>
Actor&#160;objects’&#160;update&#160;methods&#160;take&#160;as&#160;arguments&#160;the&#160;time&#160;step,&#160;the&#160;state&#160;ob-<br/>ject,&#160;and&#160;a&#160;keys&#160;object.&#160;The&#160;one&#160;for&#160;the&#160;Lava&#160;actor&#160;type&#160;ignores&#160;the&#160;keys<br/>object.<br/>
Lava.prototype.update&#160;=&#160;function(time,&#160;state)&#160;{<br/>
let&#160;newPos&#160;=&#160;this.pos.plus(this.speed.times(time));<br/>if&#160;(!state.level.touches(newPos,&#160;this.size,&#160;&#34;wall&#34;))&#160;{<br/>
return&#160;new&#160;Lava(newPos,&#160;this.speed,&#160;this.reset);<br/>
}&#160;else&#160;if&#160;(this.reset)&#160;{<br/>
return&#160;new&#160;Lava(this.reset,&#160;this.speed,&#160;this.reset);<br/>
277<br/>
<hr/>
<a name=290></a>}&#160;else&#160;{<br/>
return&#160;new&#160;Lava(this.pos,&#160;this.speed.times(-1));<br/>
}<br/>
};<br/>
This&#160;update&#160;method&#160;computes&#160;a&#160;new&#160;position&#160;by&#160;adding&#160;the&#160;product&#160;of&#160;the<br/>
time&#160;step&#160;and&#160;the&#160;current&#160;speed&#160;to&#160;its&#160;old&#160;position.&#160;If&#160;no&#160;obstacle&#160;blocks&#160;that<br/>new&#160;position,&#160;it&#160;moves&#160;there.&#160;If&#160;there&#160;is&#160;an&#160;obstacle,&#160;the&#160;behavior&#160;depends&#160;on<br/>the&#160;type&#160;of&#160;the&#160;lava&#160;block—dripping&#160;lava&#160;has&#160;a&#160;reset&#160;position,&#160;to&#160;which&#160;it&#160;jumps<br/>back&#160;when&#160;it&#160;hits&#160;something.&#160;Bouncing&#160;lava&#160;inverts&#160;its&#160;speed&#160;by&#160;multiplying&#160;it<br/>by&#160;-1&#160;so&#160;that&#160;it&#160;starts&#160;moving&#160;in&#160;the&#160;opposite&#160;direction.<br/>
Coins&#160;use&#160;their&#160;update&#160;method&#160;to&#160;wobble.&#160;They&#160;ignore&#160;collisions&#160;with&#160;the<br/>
grid&#160;since&#160;they&#160;are&#160;simply&#160;wobbling&#160;around&#160;inside&#160;of&#160;their&#160;own&#160;square.<br/>
const&#160;wobbleSpeed&#160;=&#160;8,&#160;wobbleDist&#160;=&#160;0.07;<br/>
Coin.prototype.update&#160;=&#160;function(time)&#160;{<br/>
let&#160;wobble&#160;=&#160;this.wobble&#160;+&#160;time&#160;*&#160;wobbleSpeed;<br/>let&#160;wobblePos&#160;=&#160;Math.sin(wobble)&#160;*&#160;wobbleDist;<br/>return&#160;new&#160;Coin(this.basePos.plus(new&#160;Vec(0,&#160;wobblePos)),<br/>
this.basePos,&#160;wobble);<br/>
};<br/>
The&#160;wobble&#160;property&#160;is&#160;incremented&#160;to&#160;track&#160;time&#160;and&#160;then&#160;used&#160;as&#160;an&#160;ar-<br/>
gument&#160;to&#160;Math.sin&#160;to&#160;find&#160;the&#160;new&#160;position&#160;on&#160;the&#160;wave.&#160;The&#160;coin’s&#160;current<br/>position&#160;is&#160;then&#160;computed&#160;from&#160;its&#160;base&#160;position&#160;and&#160;an&#160;offset&#160;based&#160;on&#160;this<br/>wave.<br/>
That&#160;leaves&#160;the&#160;player&#160;itself.&#160;Player&#160;motion&#160;is&#160;handled&#160;separately&#160;per&#160;axis<br/>
because&#160;hitting&#160;the&#160;floor&#160;should&#160;not&#160;prevent&#160;horizontal&#160;motion,&#160;and&#160;hitting&#160;a<br/>wall&#160;should&#160;not&#160;stop&#160;falling&#160;or&#160;jumping&#160;motion.<br/>
const&#160;playerXSpeed&#160;=&#160;7;<br/>const&#160;gravity&#160;=&#160;30;<br/>const&#160;jumpSpeed&#160;=&#160;17;<br/>
Player.prototype.update&#160;=&#160;function(time,&#160;state,&#160;keys)&#160;{<br/>
let&#160;xSpeed&#160;=&#160;0;<br/>if&#160;(keys.ArrowLeft)&#160;xSpeed&#160;-=&#160;playerXSpeed;<br/>if&#160;(keys.ArrowRight)&#160;xSpeed&#160;+=&#160;playerXSpeed;<br/>let&#160;pos&#160;=&#160;this.pos;<br/>let&#160;movedX&#160;=&#160;pos.plus(new&#160;Vec(xSpeed&#160;*&#160;time,&#160;0));<br/>if&#160;(!state.level.touches(movedX,&#160;this.size,&#160;&#34;wall&#34;))&#160;{<br/>
278<br/>
<hr/>
<a name=291></a>pos&#160;=&#160;movedX;<br/>
}<br/>
let&#160;ySpeed&#160;=&#160;this.speed.y&#160;+&#160;time&#160;*&#160;gravity;<br/>let&#160;movedY&#160;=&#160;pos.plus(new&#160;Vec(0,&#160;ySpeed&#160;*&#160;time));<br/>if&#160;(!state.level.touches(movedY,&#160;this.size,&#160;&#34;wall&#34;))&#160;{<br/>
pos&#160;=&#160;movedY;<br/>
}&#160;else&#160;if&#160;(keys.ArrowUp&#160;&amp;&amp;&#160;ySpeed&#160;&gt;&#160;0)&#160;{<br/>
ySpeed&#160;=&#160;-jumpSpeed;<br/>
}&#160;else&#160;{<br/>
ySpeed&#160;=&#160;0;<br/>
}<br/>return&#160;new&#160;Player(pos,&#160;new&#160;Vec(xSpeed,&#160;ySpeed));<br/>
};<br/>
The&#160;horizontal&#160;motion&#160;is&#160;computed&#160;based&#160;on&#160;the&#160;state&#160;of&#160;the&#160;left&#160;and&#160;right<br/>
arrow&#160;keys.&#160;When&#160;there’s&#160;no&#160;wall&#160;blocking&#160;the&#160;new&#160;position&#160;created&#160;by&#160;this<br/>motion,&#160;it&#160;is&#160;used.&#160;Otherwise,&#160;the&#160;old&#160;position&#160;is&#160;kept.<br/>
Vertical&#160;motion&#160;works&#160;in&#160;a&#160;similar&#160;way&#160;but&#160;has&#160;to&#160;simulate&#160;jumping&#160;and<br/>
gravity.&#160;The&#160;player’s&#160;vertical&#160;speed&#160;(ySpeed)&#160;is&#160;first&#160;accelerated&#160;to&#160;account&#160;for<br/>gravity.<br/>
We&#160;check&#160;for&#160;walls&#160;again.&#160;If&#160;we&#160;don’t&#160;hit&#160;any,&#160;the&#160;new&#160;position&#160;is&#160;used.&#160;If<br/>
there&#160;<i>is&#160;</i>a&#160;wall,&#160;there&#160;are&#160;two&#160;possible&#160;outcomes.&#160;When&#160;the&#160;up&#160;arrow&#160;is&#160;pressed<br/><i>and&#160;</i>we&#160;are&#160;moving&#160;down&#160;(meaning&#160;the&#160;thing&#160;we&#160;hit&#160;is&#160;below&#160;us),&#160;the&#160;speed&#160;is<br/>set&#160;to&#160;a&#160;relatively&#160;large,&#160;negative&#160;value.&#160;This&#160;causes&#160;the&#160;player&#160;to&#160;jump.&#160;If&#160;that<br/>is&#160;not&#160;the&#160;case,&#160;the&#160;player&#160;simply&#160;bumped&#160;into&#160;something,&#160;and&#160;the&#160;speed&#160;is&#160;set<br/>to&#160;zero.<br/>
The&#160;gravity&#160;strength,&#160;jumping&#160;speed,&#160;and&#160;pretty&#160;much&#160;all&#160;other&#160;constants<br/>
in&#160;this&#160;game&#160;have&#160;been&#160;set&#160;by&#160;trial&#160;and&#160;error.&#160;I&#160;tested&#160;values&#160;until&#160;I&#160;found&#160;a<br/>combination&#160;I&#160;liked.<br/>
<b>Tracking&#160;keys</b><br/>
For&#160;a&#160;game&#160;like&#160;this,&#160;we&#160;do&#160;not&#160;want&#160;keys&#160;to&#160;take&#160;effect&#160;once&#160;per&#160;keypress.<br/>Rather,&#160;we&#160;want&#160;their&#160;effect&#160;(moving&#160;the&#160;player&#160;figure)&#160;to&#160;stay&#160;active&#160;as&#160;long<br/>as&#160;they&#160;are&#160;held.<br/>
We&#160;need&#160;to&#160;set&#160;up&#160;a&#160;key&#160;handler&#160;that&#160;stores&#160;the&#160;current&#160;state&#160;of&#160;the&#160;left,<br/>
right,&#160;and&#160;up&#160;arrow&#160;keys.&#160;We&#160;will&#160;also&#160;want&#160;to&#160;call&#160;preventDefault&#160;for&#160;those<br/>keys&#160;so&#160;that&#160;they&#160;don’t&#160;end&#160;up&#160;scrolling&#160;the&#160;page.<br/>
The&#160;following&#160;function,&#160;when&#160;given&#160;an&#160;array&#160;of&#160;key&#160;names,&#160;will&#160;return&#160;an<br/>
object&#160;that&#160;tracks&#160;the&#160;current&#160;position&#160;of&#160;those&#160;keys.&#160;It&#160;registers&#160;event&#160;handlers<br/>
279<br/>
<hr/>
<a name=292></a>for&#160;&#34;keydown&#34;&#160;and&#160;&#34;keyup&#34;&#160;events&#160;and,&#160;when&#160;the&#160;key&#160;code&#160;in&#160;the&#160;event&#160;is&#160;present<br/>in&#160;the&#160;set&#160;of&#160;codes&#160;that&#160;it&#160;is&#160;tracking,&#160;updates&#160;the&#160;object.<br/>
function&#160;trackKeys(keys)&#160;{<br/>
let&#160;down&#160;=&#160;Object.create(null);<br/>function&#160;track(event)&#160;{<br/>
if&#160;(keys.includes(event.key))&#160;{<br/>
down[event.key]&#160;=&#160;event.type&#160;==&#160;&#34;keydown&#34;;<br/>event.preventDefault();<br/>
}<br/>
}<br/>window.addEventListener(&#34;keydown&#34;,&#160;track);<br/>window.addEventListener(&#34;keyup&#34;,&#160;track);<br/>return&#160;down;<br/>
}<br/>
const&#160;arrowKeys&#160;=<br/>
trackKeys([&#34;ArrowLeft&#34;,&#160;&#34;ArrowRight&#34;,&#160;&#34;ArrowUp&#34;]);<br/>
The&#160;same&#160;handler&#160;function&#160;is&#160;used&#160;for&#160;both&#160;event&#160;types.&#160;It&#160;looks&#160;at&#160;the&#160;event<br/>
object’s&#160;type&#160;property&#160;to&#160;determine&#160;whether&#160;the&#160;key&#160;state&#160;should&#160;be&#160;updated<br/>to&#160;true&#160;(&#34;keydown&#34;)&#160;or&#160;false&#160;(&#34;keyup&#34;).<br/>
<b>Running&#160;the&#160;game</b><br/>
The&#160;requestAnimationFrame&#160;function,&#160;which&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14,&#160;</a>provides<br/>a&#160;good&#160;way&#160;to&#160;animate&#160;a&#160;game.&#160;But&#160;its&#160;interface&#160;is&#160;quite&#160;primitive—using&#160;it<br/>requires&#160;us&#160;to&#160;track&#160;the&#160;time&#160;at&#160;which&#160;our&#160;function&#160;was&#160;called&#160;the&#160;last&#160;time<br/>around&#160;and&#160;call&#160;requestAnimationFrame&#160;again&#160;after&#160;every&#160;frame.<br/>
Let’s&#160;define&#160;a&#160;helper&#160;function&#160;that&#160;wraps&#160;those&#160;boring&#160;parts&#160;in&#160;a&#160;convenient<br/>
interface&#160;and&#160;allows&#160;us&#160;to&#160;simply&#160;call&#160;runAnimation,&#160;giving&#160;it&#160;a&#160;function&#160;that<br/>expects&#160;a&#160;time&#160;difference&#160;as&#160;an&#160;argument&#160;and&#160;draws&#160;a&#160;single&#160;frame.&#160;When&#160;the<br/>frame&#160;function&#160;returns&#160;the&#160;value&#160;false,&#160;the&#160;animation&#160;stops.<br/>
function&#160;runAnimation(frameFunc)&#160;{<br/>
let&#160;lastTime&#160;=&#160;null;<br/>function&#160;frame(time)&#160;{<br/>
if&#160;(lastTime&#160;!=&#160;null)&#160;{<br/>
let&#160;timeStep&#160;=&#160;Math.min(time&#160;-&#160;lastTime,&#160;100)&#160;/&#160;1000;<br/>if&#160;(frameFunc(timeStep)&#160;===&#160;false)&#160;return;<br/>
}<br/>lastTime&#160;=&#160;time;<br/>requestAnimationFrame(frame);<br/>
280<br/>
<hr/>
<a name=293></a>}<br/>requestAnimationFrame(frame);<br/>
}<br/>
I&#160;have&#160;set&#160;a&#160;maximum&#160;frame&#160;step&#160;of&#160;100&#160;milliseconds&#160;(one-tenth&#160;of&#160;a&#160;second).<br/>
When&#160;the&#160;browser&#160;tab&#160;or&#160;window&#160;with&#160;our&#160;page&#160;is&#160;hidden,&#160;requestAnimationFrame<br/>
calls&#160;will&#160;be&#160;suspended&#160;until&#160;the&#160;tab&#160;or&#160;window&#160;is&#160;shown&#160;again.&#160;In&#160;this&#160;case,<br/>
the&#160;difference&#160;between&#160;lastTime&#160;and&#160;time&#160;will&#160;be&#160;the&#160;entire&#160;time&#160;in&#160;which&#160;the<br/>page&#160;was&#160;hidden.&#160;Advancing&#160;the&#160;game&#160;by&#160;that&#160;much&#160;in&#160;a&#160;single&#160;step&#160;would<br/>look&#160;silly&#160;and&#160;might&#160;cause&#160;weird&#160;side&#160;effects,&#160;such&#160;as&#160;the&#160;player&#160;falling&#160;through<br/>the&#160;floor.<br/>
The&#160;function&#160;also&#160;converts&#160;the&#160;time&#160;steps&#160;to&#160;seconds,&#160;which&#160;are&#160;an&#160;easier<br/>
quantity&#160;to&#160;think&#160;about&#160;than&#160;milliseconds.<br/>
The&#160;runLevel&#160;function&#160;takes&#160;a&#160;Level&#160;object&#160;and&#160;a&#160;display&#160;constructor&#160;and<br/>
returns&#160;a&#160;promise.&#160;It&#160;displays&#160;the&#160;level&#160;(in&#160;document.body)&#160;and&#160;lets&#160;the&#160;user<br/>play&#160;through&#160;it.&#160;When&#160;the&#160;level&#160;is&#160;finished&#160;(lost&#160;or&#160;won),&#160;runLevel&#160;waits&#160;one<br/>more&#160;second&#160;(to&#160;let&#160;the&#160;user&#160;see&#160;what&#160;happens)&#160;and&#160;then&#160;clears&#160;the&#160;display,<br/>stops&#160;the&#160;animation,&#160;and&#160;resolves&#160;the&#160;promise&#160;to&#160;the&#160;game’s&#160;end&#160;status.<br/>
function&#160;runLevel(level,&#160;Display)&#160;{<br/>
let&#160;display&#160;=&#160;new&#160;Display(document.body,&#160;level);<br/>let&#160;state&#160;=&#160;State.start(level);<br/>let&#160;ending&#160;=&#160;1;<br/>return&#160;new&#160;Promise(resolve&#160;=&gt;&#160;{<br/>
runAnimation(time&#160;=&gt;&#160;{<br/>
state&#160;=&#160;state.update(time,&#160;arrowKeys);<br/>display.syncState(state);<br/>if&#160;(state.status&#160;==&#160;&#34;playing&#34;)&#160;{<br/>
return&#160;true;<br/>
}&#160;else&#160;if&#160;(ending&#160;&gt;&#160;0)&#160;{<br/>
ending&#160;-=&#160;time;<br/>return&#160;true;<br/>
}&#160;else&#160;{<br/>
display.clear();<br/>resolve(state.status);<br/>return&#160;false;<br/>
}<br/>
});<br/>
});<br/>
}<br/>
A&#160;game&#160;is&#160;a&#160;sequence&#160;of&#160;levels.&#160;Whenever&#160;the&#160;player&#160;dies,&#160;the&#160;current&#160;level<br/>
281<br/>
<hr/>
<a name=294></a>is&#160;restarted.&#160;When&#160;a&#160;level&#160;is&#160;completed,&#160;we&#160;move&#160;on&#160;to&#160;the&#160;next&#160;level.&#160;This<br/>can&#160;be&#160;expressed&#160;by&#160;the&#160;following&#160;function,&#160;which&#160;takes&#160;an&#160;array&#160;of&#160;level&#160;plans<br/>(strings)&#160;and&#160;a&#160;display&#160;constructor:<br/>
async&#160;function&#160;runGame(plans,&#160;Display)&#160;{<br/>
for&#160;(let&#160;level&#160;=&#160;0;&#160;level&#160;&lt;&#160;plans.length;)&#160;{<br/>
let&#160;status&#160;=&#160;await&#160;runLevel(new&#160;Level(plans[level]),<br/>
Display);<br/>
if&#160;(status&#160;==&#160;&#34;won&#34;)&#160;level++;<br/>
}<br/>console.log(&#34;You've&#160;won!&#34;);<br/>
}<br/>
Because&#160;we&#160;made&#160;runLevel&#160;return&#160;a&#160;promise,&#160;runGame&#160;can&#160;be&#160;written&#160;using<br/>
an&#160;async&#160;function,&#160;as&#160;shown&#160;in&#160;<a href="eloquent-javascripts.html#192">Chapter&#160;11</a>.&#160;It&#160;returns&#160;another&#160;promise,&#160;which<br/>resolves&#160;when&#160;the&#160;player&#160;finishes&#160;the&#160;game.<br/>
There&#160;is&#160;a&#160;set&#160;of&#160;level&#160;plans&#160;available&#160;in&#160;the&#160;GAME_LEVELS&#160;binding&#160;in&#160;<a href="https://eloquentjavascript.net/code#16">this</a><br/>
<a href="https://eloquentjavascript.net/code#16">chapter’s&#160;sandbox&#160;(<i>https://eloquentjavascript.net/code#16</i></a>).&#160;This&#160;page&#160;feeds<br/>them&#160;to&#160;runGame,&#160;starting&#160;an&#160;actual&#160;game.<br/>
&lt;link&#160;rel=&#34;stylesheet&#34;&#160;href=&#34;css/game.css&#34;&gt;<br/>
&lt;body&gt;<br/>
&lt;script&gt;<br/>
runGame(GAME_LEVELS,&#160;DOMDisplay);<br/>
&lt;/script&gt;<br/>
&lt;/body&gt;<br/>
<b>Exercises</b><br/>
<b>Game&#160;over</b><br/>
It’s&#160;traditional&#160;for&#160;platform&#160;games&#160;to&#160;have&#160;the&#160;player&#160;start&#160;with&#160;a&#160;limited&#160;num-<br/>ber&#160;of&#160;<i>lives&#160;</i>and&#160;subtract&#160;one&#160;life&#160;each&#160;time&#160;they&#160;die.&#160;When&#160;the&#160;player&#160;is&#160;out&#160;of<br/>lives,&#160;the&#160;game&#160;restarts&#160;from&#160;the&#160;beginning.<br/>
Adjust&#160;runGame&#160;to&#160;implement&#160;lives.&#160;Have&#160;the&#160;player&#160;start&#160;with&#160;three.&#160;Output<br/>
the&#160;current&#160;number&#160;of&#160;lives&#160;(using&#160;console.log)&#160;every&#160;time&#160;a&#160;level&#160;starts.<br/>
282<br/>
<hr/>
<a name=295></a><b>Pausing&#160;the&#160;game</b><br/>
Make&#160;it&#160;possible&#160;to&#160;pause&#160;(suspend)&#160;and&#160;unpause&#160;the&#160;game&#160;by&#160;pressing&#160;the&#160;Esc<br/>key.<br/>
This&#160;can&#160;be&#160;done&#160;by&#160;changing&#160;the&#160;runLevel&#160;function&#160;to&#160;use&#160;another&#160;keyboard<br/>
event&#160;handler&#160;and&#160;interrupting&#160;or&#160;resuming&#160;the&#160;animation&#160;whenever&#160;the&#160;Esc<br/>key&#160;is&#160;hit.<br/>
The&#160;runAnimation&#160;interface&#160;may&#160;not&#160;look&#160;like&#160;it&#160;is&#160;suitable&#160;for&#160;this&#160;at&#160;first<br/>
glance,&#160;but&#160;it&#160;is&#160;if&#160;you&#160;rearrange&#160;the&#160;way&#160;runLevel&#160;calls&#160;it.<br/>
When&#160;you&#160;have&#160;that&#160;working,&#160;there&#160;is&#160;something&#160;else&#160;you&#160;could&#160;try.&#160;The&#160;way<br/>
we&#160;have&#160;been&#160;registering&#160;keyboard&#160;event&#160;handlers&#160;is&#160;somewhat&#160;problematic.<br/>The&#160;arrowKeys&#160;object&#160;is&#160;currently&#160;a&#160;global&#160;binding,&#160;and&#160;its&#160;event&#160;handlers&#160;are<br/>kept&#160;around&#160;even&#160;when&#160;no&#160;game&#160;is&#160;running.&#160;You&#160;could&#160;say&#160;they&#160;<i>leak&#160;</i>out&#160;of&#160;our<br/>system.&#160;Extend&#160;trackKeys&#160;to&#160;provide&#160;a&#160;way&#160;to&#160;unregister&#160;its&#160;handlers&#160;and&#160;then<br/>change&#160;runLevel&#160;to&#160;register&#160;its&#160;handlers&#160;when&#160;it&#160;starts&#160;and&#160;unregister&#160;them<br/>again&#160;when&#160;it&#160;is&#160;finished.<br/>
<b>A&#160;monster</b><br/>
It&#160;is&#160;traditional&#160;for&#160;platform&#160;games&#160;to&#160;have&#160;enemies&#160;that&#160;you&#160;can&#160;jump&#160;on&#160;top<br/>of&#160;to&#160;defeat.&#160;This&#160;exercise&#160;asks&#160;you&#160;to&#160;add&#160;such&#160;an&#160;actor&#160;type&#160;to&#160;the&#160;game.<br/>
We’ll&#160;call&#160;it&#160;a&#160;monster.&#160;Monsters&#160;move&#160;only&#160;horizontally.&#160;You&#160;can&#160;make<br/>
them&#160;move&#160;in&#160;the&#160;direction&#160;of&#160;the&#160;player,&#160;bounce&#160;back&#160;and&#160;forth&#160;like&#160;horizontal<br/>lava,&#160;or&#160;have&#160;any&#160;movement&#160;pattern&#160;you&#160;want.&#160;The&#160;class&#160;doesn’t&#160;have&#160;to&#160;handle<br/>falling,&#160;but&#160;it&#160;should&#160;make&#160;sure&#160;the&#160;monster&#160;doesn’t&#160;walk&#160;through&#160;walls.<br/>
When&#160;a&#160;monster&#160;touches&#160;the&#160;player,&#160;the&#160;effect&#160;depends&#160;on&#160;whether&#160;the&#160;player<br/>
is&#160;jumping&#160;on&#160;top&#160;of&#160;them&#160;or&#160;not.&#160;You&#160;can&#160;approximate&#160;this&#160;by&#160;checking<br/>whether&#160;the&#160;player’s&#160;bottom&#160;is&#160;near&#160;the&#160;monster’s&#160;top.&#160;If&#160;this&#160;is&#160;the&#160;case,&#160;the<br/>monster&#160;disappears.&#160;If&#160;not,&#160;the&#160;game&#160;is&#160;lost.<br/>
283<br/>
<hr/>
<a name=296></a><i>“Drawing&#160;is&#160;deception.”</i><br/>
—M.C.&#160;Escher,&#160;cited&#160;by&#160;Bruno&#160;Ernst&#160;in&#160;The&#160;Magic&#160;Mirror&#160;of&#160;M.C.<br/>
Escher<br/>
<b>Chapter&#160;17<br/>Drawing&#160;on&#160;Canvas</b><br/>
Browsers&#160;give&#160;us&#160;several&#160;ways&#160;to&#160;display&#160;graphics.&#160;The&#160;simplest&#160;way&#160;is&#160;to&#160;use<br/>styles&#160;to&#160;position&#160;and&#160;color&#160;regular&#160;DOM&#160;elements.&#160;This&#160;can&#160;get&#160;you&#160;quite&#160;far,<br/>as&#160;the&#160;game&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#273">previous&#160;chapter&#160;</a>showed.&#160;By&#160;adding&#160;partially&#160;transparent<br/>background&#160;images&#160;to&#160;the&#160;nodes,&#160;we&#160;can&#160;make&#160;them&#160;look&#160;exactly&#160;the&#160;way&#160;we<br/>want.&#160;It&#160;is&#160;even&#160;possible&#160;to&#160;rotate&#160;or&#160;skew&#160;nodes&#160;with&#160;the&#160;transform&#160;style.<br/>
But&#160;we’d&#160;be&#160;using&#160;the&#160;DOM&#160;for&#160;something&#160;that&#160;it&#160;wasn’t&#160;originally&#160;designed<br/>
for.&#160;Some&#160;tasks,&#160;such&#160;as&#160;drawing&#160;a&#160;line&#160;between&#160;arbitrary&#160;points,&#160;are&#160;extremely<br/>awkward&#160;to&#160;do&#160;with&#160;regular&#160;HTML&#160;elements.<br/>
There&#160;are&#160;two&#160;alternatives.&#160;The&#160;first&#160;is&#160;DOM-based&#160;but&#160;utilizes&#160;<i>Scalable</i><br/>
<i>Vector&#160;Graphics&#160;</i>(SVG),&#160;rather&#160;than&#160;HTML.&#160;Think&#160;of&#160;SVG&#160;as&#160;a&#160;document-<br/>markup&#160;dialect&#160;that&#160;focuses&#160;on&#160;shapes&#160;rather&#160;than&#160;text.&#160;You&#160;can&#160;embed&#160;an<br/>SVG&#160;document&#160;directly&#160;in&#160;an&#160;HTML&#160;document&#160;or&#160;include&#160;it&#160;with&#160;an&#160;&lt;img&gt;&#160;tag.<br/>
The&#160;second&#160;alternative&#160;is&#160;called&#160;a&#160;<i>canvas</i>.&#160;A&#160;canvas&#160;is&#160;a&#160;single&#160;DOM&#160;element<br/>
that&#160;encapsulates&#160;a&#160;picture.&#160;It&#160;provides&#160;a&#160;programming&#160;interface&#160;for&#160;drawing<br/>shapes&#160;onto&#160;the&#160;space&#160;taken&#160;up&#160;by&#160;the&#160;node.&#160;The&#160;main&#160;difference&#160;between&#160;a<br/>canvas&#160;and&#160;an&#160;SVG&#160;picture&#160;is&#160;that&#160;in&#160;SVG&#160;the&#160;original&#160;description&#160;of&#160;the&#160;shapes<br/>is&#160;preserved&#160;so&#160;that&#160;they&#160;can&#160;be&#160;moved&#160;or&#160;resized&#160;at&#160;any&#160;time.&#160;A&#160;canvas,&#160;on<br/>the&#160;other&#160;hand,&#160;converts&#160;the&#160;shapes&#160;to&#160;pixels&#160;(colored&#160;dots&#160;on&#160;a&#160;raster)&#160;as&#160;soon<br/>as&#160;they&#160;are&#160;drawn&#160;and&#160;does&#160;not&#160;remember&#160;what&#160;these&#160;pixels&#160;represent.&#160;The<br/>only&#160;way&#160;to&#160;move&#160;a&#160;shape&#160;on&#160;a&#160;canvas&#160;is&#160;to&#160;clear&#160;the&#160;canvas&#160;(or&#160;the&#160;part&#160;of&#160;the<br/>canvas&#160;around&#160;the&#160;shape)&#160;and&#160;redraw&#160;it&#160;with&#160;the&#160;shape&#160;in&#160;a&#160;new&#160;position.<br/>
<b>SVG</b><br/>
This&#160;book&#160;will&#160;not&#160;go&#160;into&#160;SVG&#160;in&#160;detail,&#160;but&#160;I&#160;will&#160;briefly&#160;explain&#160;how&#160;it<br/>works.&#160;At&#160;the&#160;<a href="eloquent-javascripts.html#315">end&#160;of&#160;the&#160;chapter,&#160;</a>I’ll&#160;come&#160;back&#160;to&#160;the&#160;trade-offs&#160;that&#160;you<br/>must&#160;consider&#160;when&#160;deciding&#160;which&#160;drawing&#160;mechanism&#160;is&#160;appropriate&#160;for&#160;a<br/>given&#160;application.<br/>
This&#160;is&#160;an&#160;HTML&#160;document&#160;with&#160;a&#160;simple&#160;SVG&#160;picture&#160;in&#160;it:<br/>
&lt;p&gt;Normal&#160;HTML&#160;here.&lt;/p&gt;<br/>
284<br/>
<hr/>
<a name=297></a><img src="eloquent-javascript-297_1.png"/><br/>
&lt;svg&#160;xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;<br/>
&lt;circle&#160;r=&#34;50&#34;&#160;cx=&#34;50&#34;&#160;cy=&#34;50&#34;&#160;fill=&#34;red&#34;/&gt;<br/>&lt;rect&#160;x=&#34;120&#34;&#160;y=&#34;5&#34;&#160;width=&#34;90&#34;&#160;height=&#34;90&#34;<br/>
stroke=&#34;blue&#34;&#160;fill=&#34;none&#34;/&gt;<br/>
&lt;/svg&gt;<br/>
The&#160;xmlns&#160;attribute&#160;changes&#160;an&#160;element&#160;(and&#160;its&#160;children)&#160;to&#160;a&#160;different&#160;<i>XML</i><br/>
<i>namespace</i>.&#160;This&#160;namespace,&#160;identified&#160;by&#160;a&#160;URL,&#160;specifies&#160;the&#160;dialect&#160;that&#160;we<br/>are&#160;currently&#160;speaking.&#160;The&#160;&lt;circle&gt;&#160;and&#160;&lt;rect&gt;&#160;tags,&#160;which&#160;do&#160;not&#160;exist&#160;in<br/>HTML,&#160;do&#160;have&#160;a&#160;meaning&#160;in&#160;SVG—they&#160;draw&#160;shapes&#160;using&#160;the&#160;style&#160;and<br/>position&#160;specified&#160;by&#160;their&#160;attributes.<br/>
The&#160;document&#160;is&#160;displayed&#160;like&#160;this:<br/>
These&#160;tags&#160;create&#160;DOM&#160;elements,&#160;just&#160;like&#160;HTML&#160;tags,&#160;that&#160;scripts&#160;can<br/>
interact&#160;with.&#160;For&#160;example,&#160;this&#160;changes&#160;the&#160;&lt;circle&gt;&#160;element&#160;to&#160;be&#160;colored<br/>cyan&#160;instead:<br/>
let&#160;circle&#160;=&#160;document.querySelector(&#34;circle&#34;);<br/>circle.setAttribute(&#34;fill&#34;,&#160;&#34;cyan&#34;);<br/>
<b>The&#160;canvas&#160;element</b><br/>
Canvas&#160;graphics&#160;can&#160;be&#160;drawn&#160;onto&#160;a&#160;&lt;canvas&gt;&#160;element.&#160;You&#160;can&#160;give&#160;such&#160;an<br/>element&#160;width&#160;and&#160;height&#160;attributes&#160;to&#160;determine&#160;its&#160;size&#160;in&#160;pixels.<br/>
A&#160;new&#160;canvas&#160;is&#160;empty,&#160;meaning&#160;it&#160;is&#160;entirely&#160;transparent&#160;and&#160;thus&#160;shows&#160;up<br/>
as&#160;empty&#160;space&#160;in&#160;the&#160;document.<br/>
The&#160;&lt;canvas&gt;&#160;tag&#160;is&#160;intended&#160;to&#160;allow&#160;different&#160;styles&#160;of&#160;drawing.&#160;To&#160;get<br/>
access&#160;to&#160;an&#160;actual&#160;drawing&#160;interface,&#160;we&#160;first&#160;need&#160;to&#160;create&#160;a&#160;<i>context</i>,&#160;an&#160;object<br/>whose&#160;methods&#160;provide&#160;the&#160;drawing&#160;interface.&#160;There&#160;are&#160;currently&#160;two&#160;widely<br/>supported&#160;drawing&#160;styles:&#160;&#34;2d&#34;&#160;for&#160;two-dimensional&#160;graphics&#160;and&#160;&#34;webgl&#34;&#160;for<br/>three-dimensional&#160;graphics&#160;through&#160;the&#160;OpenGL&#160;interface.<br/>
This&#160;book&#160;won’t&#160;discuss&#160;WebGL—we’ll&#160;stick&#160;to&#160;two&#160;dimensions.&#160;But&#160;if&#160;you<br/>
are&#160;interested&#160;in&#160;three-dimensional&#160;graphics,&#160;I&#160;do&#160;encourage&#160;you&#160;to&#160;look&#160;into<br/>
285<br/>
<hr/>
<a name=298></a><img src="eloquent-javascript-298_1.png"/><br/>
WebGL.&#160;It&#160;provides&#160;a&#160;direct&#160;interface&#160;to&#160;graphics&#160;hardware&#160;and&#160;allows&#160;you&#160;to<br/>render&#160;even&#160;complicated&#160;scenes&#160;efficiently,&#160;using&#160;JavaScript.<br/>
You&#160;create&#160;a&#160;context&#160;with&#160;the&#160;getContext&#160;method&#160;on&#160;the&#160;&lt;canvas&gt;&#160;DOM<br/>
element.<br/>
&lt;p&gt;Before&#160;canvas.&lt;/p&gt;<br/>&lt;canvas&#160;width=&#34;120&#34;&#160;height=&#34;60&#34;&gt;&lt;/canvas&gt;<br/>&lt;p&gt;After&#160;canvas.&lt;/p&gt;<br/>&lt;script&gt;<br/>
let&#160;canvas&#160;=&#160;document.querySelector(&#34;canvas&#34;);<br/>let&#160;context&#160;=&#160;canvas.getContext(&#34;2d&#34;);<br/>context.fillStyle&#160;=&#160;&#34;red&#34;;<br/>context.fillRect(10,&#160;10,&#160;100,&#160;50);<br/>
&lt;/script&gt;<br/>
After&#160;creating&#160;the&#160;context&#160;object,&#160;the&#160;example&#160;draws&#160;a&#160;red&#160;rectangle&#160;100<br/>
pixels&#160;wide&#160;and&#160;50&#160;pixels&#160;high,&#160;with&#160;its&#160;top-left&#160;corner&#160;at&#160;coordinates&#160;(10,10).<br/>
Just&#160;like&#160;in&#160;HTML&#160;(and&#160;SVG),&#160;the&#160;coordinate&#160;system&#160;that&#160;the&#160;canvas&#160;uses<br/>
puts&#160;(0,0)&#160;at&#160;the&#160;top-left&#160;corner,&#160;and&#160;the&#160;positive&#160;y-axis&#160;goes&#160;down&#160;from&#160;there.<br/>So&#160;(10,10)&#160;is&#160;10&#160;pixels&#160;below&#160;and&#160;to&#160;the&#160;right&#160;of&#160;the&#160;top-left&#160;corner.<br/>
<b>Lines&#160;and&#160;surfaces</b><br/>
In&#160;the&#160;canvas&#160;interface,&#160;a&#160;shape&#160;can&#160;be&#160;<i>filled</i>,&#160;meaning&#160;its&#160;area&#160;is&#160;given&#160;a&#160;certain<br/>color&#160;or&#160;pattern,&#160;or&#160;it&#160;can&#160;be&#160;<i>stroked</i>,&#160;which&#160;means&#160;a&#160;line&#160;is&#160;drawn&#160;along&#160;its<br/>edge.&#160;The&#160;same&#160;terminology&#160;is&#160;used&#160;by&#160;SVG.<br/>
The&#160;fillRect&#160;method&#160;fills&#160;a&#160;rectangle.&#160;It&#160;takes&#160;first&#160;the&#160;x-&#160;and&#160;y-coordinates<br/>
of&#160;the&#160;rectangle’s&#160;top-left&#160;corner,&#160;then&#160;its&#160;width,&#160;and&#160;then&#160;its&#160;height.&#160;A&#160;similar<br/>method,&#160;strokeRect,&#160;draws&#160;the&#160;outline&#160;of&#160;a&#160;rectangle.<br/>
Neither&#160;method&#160;takes&#160;any&#160;further&#160;parameters.&#160;The&#160;color&#160;of&#160;the&#160;fill,&#160;thickness<br/>
of&#160;the&#160;stroke,&#160;and&#160;so&#160;on,&#160;are&#160;not&#160;determined&#160;by&#160;an&#160;argument&#160;to&#160;the&#160;method&#160;(as<br/>you&#160;might&#160;reasonably&#160;expect)&#160;but&#160;rather&#160;by&#160;properties&#160;of&#160;the&#160;context&#160;object.<br/>
The&#160;fillStyle&#160;property&#160;controls&#160;the&#160;way&#160;shapes&#160;are&#160;filled.&#160;It&#160;can&#160;be&#160;set&#160;to<br/>
a&#160;string&#160;that&#160;specifies&#160;a&#160;color,&#160;using&#160;the&#160;color&#160;notation&#160;used&#160;by&#160;CSS.<br/>
286<br/>
<hr/>
<a name=299></a><img src="eloquent-javascript-299_1.png"/><br/>
The&#160;strokeStyle&#160;property&#160;works&#160;similarly&#160;but&#160;determines&#160;the&#160;color&#160;used&#160;for<br/>
a&#160;stroked&#160;line.&#160;The&#160;width&#160;of&#160;that&#160;line&#160;is&#160;determined&#160;by&#160;the&#160;lineWidth&#160;property,<br/>which&#160;may&#160;contain&#160;any&#160;positive&#160;number.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.strokeStyle&#160;=&#160;&#34;blue&#34;;<br/>cx.strokeRect(5,&#160;5,&#160;50,&#160;50);<br/>cx.lineWidth&#160;=&#160;5;<br/>cx.strokeRect(135,&#160;5,&#160;50,&#160;50);<br/>
&lt;/script&gt;<br/>
This&#160;code&#160;draws&#160;two&#160;blue&#160;squares,&#160;using&#160;a&#160;thicker&#160;line&#160;for&#160;the&#160;second&#160;one.<br/>
When&#160;no&#160;width&#160;or&#160;height&#160;attribute&#160;is&#160;specified,&#160;as&#160;in&#160;the&#160;example,&#160;a&#160;canvas<br/>
element&#160;gets&#160;a&#160;default&#160;width&#160;of&#160;300&#160;pixels&#160;and&#160;height&#160;of&#160;150&#160;pixels.<br/>
<b>Paths</b><br/>
A&#160;path&#160;is&#160;a&#160;sequence&#160;of&#160;lines.&#160;The&#160;2D&#160;canvas&#160;interface&#160;takes&#160;a&#160;peculiar&#160;approach<br/>to&#160;describing&#160;such&#160;a&#160;path.&#160;It&#160;is&#160;done&#160;entirely&#160;through&#160;side&#160;effects.&#160;Paths&#160;are<br/>not&#160;values&#160;that&#160;can&#160;be&#160;stored&#160;and&#160;passed&#160;around.&#160;Instead,&#160;if&#160;you&#160;want&#160;to&#160;do<br/>something&#160;with&#160;a&#160;path,&#160;you&#160;make&#160;a&#160;sequence&#160;of&#160;method&#160;calls&#160;to&#160;describe&#160;its<br/>shape.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.beginPath();<br/>for&#160;(let&#160;y&#160;=&#160;10;&#160;y&#160;&lt;&#160;100;&#160;y&#160;+=&#160;10)&#160;{<br/>
cx.moveTo(10,&#160;y);<br/>cx.lineTo(90,&#160;y);<br/>
}<br/>cx.stroke();<br/>
&lt;/script&gt;<br/>
This&#160;example&#160;creates&#160;a&#160;path&#160;with&#160;a&#160;number&#160;of&#160;horizontal&#160;line&#160;segments&#160;and<br/>
287<br/>
<hr/>
<a name=300></a><img src="eloquent-javascript-300_1.png"/><br/>
<img src="eloquent-javascript-300_2.png"/><br/>
then&#160;strokes&#160;it&#160;using&#160;the&#160;stroke&#160;method.&#160;Each&#160;segment&#160;created&#160;with&#160;lineTo<br/>starts&#160;at&#160;the&#160;path’s&#160;<i>current&#160;</i>position.&#160;That&#160;position&#160;is&#160;usually&#160;the&#160;end&#160;of&#160;the<br/>last&#160;segment,&#160;unless&#160;moveTo&#160;was&#160;called.&#160;In&#160;that&#160;case,&#160;the&#160;next&#160;segment&#160;would<br/>start&#160;at&#160;the&#160;position&#160;passed&#160;to&#160;moveTo.<br/>
The&#160;path&#160;described&#160;by&#160;the&#160;previous&#160;program&#160;looks&#160;like&#160;this:<br/>
When&#160;filling&#160;a&#160;path&#160;(using&#160;the&#160;fill&#160;method),&#160;each&#160;shape&#160;is&#160;filled&#160;separately.<br/>
A&#160;path&#160;can&#160;contain&#160;multiple&#160;shapes—each&#160;moveTo&#160;motion&#160;starts&#160;a&#160;new&#160;one.<br/>But&#160;the&#160;path&#160;needs&#160;to&#160;be&#160;<i>closed&#160;</i>(meaning&#160;its&#160;start&#160;and&#160;end&#160;are&#160;in&#160;the&#160;same<br/>position)&#160;before&#160;it&#160;can&#160;be&#160;filled.&#160;If&#160;the&#160;path&#160;is&#160;not&#160;already&#160;closed,&#160;a&#160;line&#160;is&#160;added<br/>from&#160;its&#160;end&#160;to&#160;its&#160;start,&#160;and&#160;the&#160;shape&#160;enclosed&#160;by&#160;the&#160;completed&#160;path&#160;is&#160;filled.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.beginPath();<br/>cx.moveTo(50,&#160;10);<br/>cx.lineTo(10,&#160;70);<br/>cx.lineTo(90,&#160;70);<br/>cx.fill();<br/>
&lt;/script&gt;<br/>
This&#160;example&#160;draws&#160;a&#160;filled&#160;triangle.&#160;Note&#160;that&#160;only&#160;two&#160;of&#160;the&#160;triangle’s<br/>
sides&#160;are&#160;explicitly&#160;drawn.&#160;The&#160;third,&#160;from&#160;the&#160;bottom-right&#160;corner&#160;back&#160;to&#160;the<br/>top,&#160;is&#160;implied&#160;and&#160;wouldn’t&#160;be&#160;there&#160;when&#160;you&#160;stroke&#160;the&#160;path.<br/>
You&#160;could&#160;also&#160;use&#160;the&#160;closePath&#160;method&#160;to&#160;explicitly&#160;close&#160;a&#160;path&#160;by&#160;adding<br/>
an&#160;actual&#160;line&#160;segment&#160;back&#160;to&#160;the&#160;path’s&#160;start.&#160;This&#160;segment&#160;<i>is&#160;</i>drawn&#160;when<br/>stroking&#160;the&#160;path.<br/>
288<br/>
<hr/>
<a name=301></a><img src="eloquent-javascript-301_1.png"/><br/>
<b>Curves</b><br/>
A&#160;path&#160;may&#160;also&#160;contain&#160;curved&#160;lines.&#160;These&#160;are&#160;unfortunately&#160;a&#160;bit&#160;more<br/>involved&#160;to&#160;draw.<br/>
The&#160;quadraticCurveTo&#160;method&#160;draws&#160;a&#160;curve&#160;to&#160;a&#160;given&#160;point.&#160;To&#160;determine<br/>
the&#160;curvature&#160;of&#160;the&#160;line,&#160;the&#160;method&#160;is&#160;given&#160;a&#160;control&#160;point&#160;as&#160;well&#160;as&#160;a<br/>destination&#160;point.&#160;Imagine&#160;this&#160;control&#160;point&#160;as&#160;<i>attracting&#160;</i>the&#160;line,&#160;giving&#160;it<br/>its&#160;curve.&#160;The&#160;line&#160;won’t&#160;go&#160;through&#160;the&#160;control&#160;point,&#160;but&#160;its&#160;direction&#160;at&#160;the<br/>start&#160;and&#160;end&#160;points&#160;will&#160;be&#160;such&#160;that&#160;a&#160;straight&#160;line&#160;in&#160;that&#160;direction&#160;would<br/>point&#160;toward&#160;the&#160;control&#160;point.&#160;The&#160;following&#160;example&#160;illustrates&#160;this:<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.beginPath();<br/>cx.moveTo(10,&#160;90);<br/>//&#160;control=(60,10)&#160;goal=(90,90)<br/>cx.quadraticCurveTo(60,&#160;10,&#160;90,&#160;90);<br/>cx.lineTo(60,&#160;10);<br/>cx.closePath();<br/>cx.stroke();<br/>
&lt;/script&gt;<br/>
It&#160;produces&#160;a&#160;path&#160;that&#160;looks&#160;like&#160;this:<br/>
We&#160;draw&#160;a&#160;quadratic&#160;curve&#160;from&#160;the&#160;left&#160;to&#160;the&#160;right,&#160;with&#160;(60,10)&#160;as&#160;control<br/>
point,&#160;and&#160;then&#160;draw&#160;two&#160;line&#160;segments&#160;going&#160;through&#160;that&#160;control&#160;point&#160;and<br/>back&#160;to&#160;the&#160;start&#160;of&#160;the&#160;line.&#160;The&#160;result&#160;somewhat&#160;resembles&#160;a&#160;<i>Star&#160;Trek<br/></i>insignia.&#160;You&#160;can&#160;see&#160;the&#160;effect&#160;of&#160;the&#160;control&#160;point:&#160;the&#160;lines&#160;leaving&#160;the&#160;lower<br/>corners&#160;start&#160;off&#160;in&#160;the&#160;direction&#160;of&#160;the&#160;control&#160;point&#160;and&#160;then&#160;curve&#160;toward<br/>their&#160;target.<br/>
The&#160;bezierCurveTo&#160;method&#160;draws&#160;a&#160;similar&#160;kind&#160;of&#160;curve.&#160;Instead&#160;of&#160;a&#160;single<br/>
control&#160;point,&#160;this&#160;one&#160;has&#160;two—one&#160;for&#160;each&#160;of&#160;the&#160;line’s&#160;endpoints.&#160;Here&#160;is&#160;a<br/>similar&#160;sketch&#160;to&#160;illustrate&#160;the&#160;behavior&#160;of&#160;such&#160;a&#160;curve:<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
289<br/>
<hr/>
<a name=302></a><img src="eloquent-javascript-302_1.png"/><br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.beginPath();<br/>cx.moveTo(10,&#160;90);<br/>//&#160;control1=(10,10)&#160;control2=(90,10)&#160;goal=(50,90)<br/>cx.bezierCurveTo(10,&#160;10,&#160;90,&#160;10,&#160;50,&#160;90);<br/>cx.lineTo(90,&#160;10);<br/>cx.lineTo(10,&#160;10);<br/>cx.closePath();<br/>cx.stroke();<br/>
&lt;/script&gt;<br/>
The&#160;two&#160;control&#160;points&#160;specify&#160;the&#160;direction&#160;at&#160;both&#160;ends&#160;of&#160;the&#160;curve.&#160;The<br/>
farther&#160;they&#160;are&#160;away&#160;from&#160;their&#160;corresponding&#160;point,&#160;the&#160;more&#160;the&#160;curve&#160;will<br/>“bulge”&#160;in&#160;that&#160;direction.<br/>
Such&#160;curves&#160;can&#160;be&#160;hard&#160;to&#160;work&#160;with—it’s&#160;not&#160;always&#160;clear&#160;how&#160;to&#160;find&#160;the<br/>
control&#160;points&#160;that&#160;provide&#160;the&#160;shape&#160;you&#160;are&#160;looking&#160;for.&#160;Sometimes&#160;you&#160;can<br/>compute&#160;them,&#160;and&#160;sometimes&#160;you’ll&#160;just&#160;have&#160;to&#160;find&#160;a&#160;suitable&#160;value&#160;by&#160;trial<br/>and&#160;error.<br/>
The&#160;arc&#160;method&#160;is&#160;a&#160;way&#160;to&#160;draw&#160;a&#160;line&#160;that&#160;curves&#160;along&#160;the&#160;edge&#160;of&#160;a&#160;circle.<br/>
It&#160;takes&#160;a&#160;pair&#160;of&#160;coordinates&#160;for&#160;the&#160;arc’s&#160;center,&#160;a&#160;radius,&#160;and&#160;then&#160;a&#160;start<br/>angle&#160;and&#160;end&#160;angle.<br/>
Those&#160;last&#160;two&#160;parameters&#160;make&#160;it&#160;possible&#160;to&#160;draw&#160;only&#160;part&#160;of&#160;the&#160;circle.<br/>
The&#160;angles&#160;are&#160;measured&#160;in&#160;radians,&#160;not&#160;degrees.&#160;This&#160;means&#160;a&#160;full&#160;circle&#160;has<br/>an&#160;angle&#160;of&#160;2<i>π</i>,&#160;or&#160;2&#160;*&#160;Math.PI,&#160;which&#160;is&#160;about&#160;6.28.&#160;The&#160;angle&#160;starts&#160;counting<br/>at&#160;the&#160;point&#160;to&#160;the&#160;right&#160;of&#160;the&#160;circle’s&#160;center&#160;and&#160;goes&#160;clockwise&#160;from&#160;there.<br/>You&#160;can&#160;use&#160;a&#160;start&#160;of&#160;0&#160;and&#160;an&#160;end&#160;bigger&#160;than&#160;2<i>π&#160;</i>(say,&#160;7)&#160;to&#160;draw&#160;a&#160;full&#160;circle.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.beginPath();<br/>//&#160;center=(50,50)&#160;radius=40&#160;angle=0&#160;to&#160;7<br/>cx.arc(50,&#160;50,&#160;40,&#160;0,&#160;7);<br/>//&#160;center=(150,50)&#160;radius=40&#160;angle=0&#160;to&#160;<i>π</i>½<br/>cx.arc(150,&#160;50,&#160;40,&#160;0,&#160;0.5&#160;*&#160;Math.PI);<br/>cx.stroke();<br/>
290<br/>
<hr/>
<a name=303></a><img src="eloquent-javascript-303_1.png"/><br/>
&lt;/script&gt;<br/>
The&#160;resulting&#160;picture&#160;contains&#160;a&#160;line&#160;from&#160;the&#160;right&#160;of&#160;the&#160;full&#160;circle&#160;(first&#160;call<br/>
to&#160;arc)&#160;to&#160;the&#160;right&#160;of&#160;the&#160;quarter-circle&#160;(second&#160;call).&#160;Like&#160;other&#160;path-drawing<br/>methods,&#160;a&#160;line&#160;drawn&#160;with&#160;arc&#160;is&#160;connected&#160;to&#160;the&#160;previous&#160;path&#160;segment.<br/>You&#160;can&#160;call&#160;moveTo&#160;or&#160;start&#160;a&#160;new&#160;path&#160;to&#160;avoid&#160;this.<br/>
<b>Drawing&#160;a&#160;pie&#160;chart</b><br/>
Imagine&#160;you’ve&#160;just&#160;taken&#160;a&#160;job&#160;at&#160;EconomiCorp,&#160;Inc.,&#160;and&#160;your&#160;first&#160;assignment<br/>is&#160;to&#160;draw&#160;a&#160;pie&#160;chart&#160;of&#160;its&#160;customer&#160;satisfaction&#160;survey&#160;results.<br/>
The&#160;results&#160;binding&#160;contains&#160;an&#160;array&#160;of&#160;objects&#160;that&#160;represent&#160;the&#160;survey<br/>
responses.<br/>
const&#160;results&#160;=&#160;[<br/>
{name:&#160;&#34;Satisfied&#34;,&#160;count:&#160;1043,&#160;color:&#160;&#34;lightblue&#34;},<br/>{name:&#160;&#34;Neutral&#34;,&#160;count:&#160;563,&#160;color:&#160;&#34;lightgreen&#34;},<br/>{name:&#160;&#34;Unsatisfied&#34;,&#160;count:&#160;510,&#160;color:&#160;&#34;pink&#34;},<br/>{name:&#160;&#34;No&#160;comment&#34;,&#160;count:&#160;175,&#160;color:&#160;&#34;silver&#34;}<br/>
];<br/>
To&#160;draw&#160;a&#160;pie&#160;chart,&#160;we&#160;draw&#160;a&#160;number&#160;of&#160;pie&#160;slices,&#160;each&#160;made&#160;up&#160;of&#160;an&#160;arc<br/>
and&#160;a&#160;pair&#160;of&#160;lines&#160;to&#160;the&#160;center&#160;of&#160;that&#160;arc.&#160;We&#160;can&#160;compute&#160;the&#160;angle&#160;taken<br/>up&#160;by&#160;each&#160;arc&#160;by&#160;dividing&#160;a&#160;full&#160;circle&#160;(2<i>π</i>)&#160;by&#160;the&#160;total&#160;number&#160;of&#160;responses<br/>and&#160;then&#160;multiplying&#160;that&#160;number&#160;(the&#160;angle&#160;per&#160;response)&#160;by&#160;the&#160;number&#160;of<br/>people&#160;who&#160;picked&#160;a&#160;given&#160;choice.<br/>
&lt;canvas&#160;width=&#34;200&#34;&#160;height=&#34;200&#34;&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>let&#160;total&#160;=&#160;results<br/>
.reduce((sum,&#160;{count})&#160;=&gt;&#160;sum&#160;+&#160;count,&#160;0);<br/>
//&#160;Start&#160;at&#160;the&#160;top<br/>let&#160;currentAngle&#160;=&#160;-0.5&#160;*&#160;Math.PI;<br/>for&#160;(let&#160;result&#160;of&#160;results)&#160;{<br/>
291<br/>
<hr/>
<a name=304></a><img src="eloquent-javascript-304_1.png"/><br/>
let&#160;sliceAngle&#160;=&#160;(result.count&#160;/&#160;total)&#160;*&#160;2&#160;*&#160;Math.PI;<br/>cx.beginPath();<br/>//&#160;center=100,100,&#160;radius=100<br/>//&#160;from&#160;current&#160;angle,&#160;clockwise&#160;by&#160;slice's&#160;angle<br/>cx.arc(100,&#160;100,&#160;100,<br/>
currentAngle,&#160;currentAngle&#160;+&#160;sliceAngle);<br/>
currentAngle&#160;+=&#160;sliceAngle;<br/>cx.lineTo(100,&#160;100);<br/>cx.fillStyle&#160;=&#160;result.color;<br/>cx.fill();<br/>
}<br/>
&lt;/script&gt;<br/>
This&#160;draws&#160;the&#160;following&#160;chart:<br/>
But&#160;a&#160;chart&#160;that&#160;doesn’t&#160;tell&#160;us&#160;what&#160;the&#160;slices&#160;mean&#160;isn’t&#160;very&#160;helpful.&#160;We<br/>
need&#160;a&#160;way&#160;to&#160;draw&#160;text&#160;to&#160;the&#160;canvas.<br/>
<b>Text</b><br/>
A&#160;2D&#160;canvas&#160;drawing&#160;context&#160;provides&#160;the&#160;methods&#160;fillText&#160;and&#160;strokeText.<br/>The&#160;latter&#160;can&#160;be&#160;useful&#160;for&#160;outlining&#160;letters,&#160;but&#160;usually&#160;fillText&#160;is&#160;what&#160;you<br/>need.&#160;It&#160;will&#160;fill&#160;the&#160;outline&#160;of&#160;the&#160;given&#160;text&#160;with&#160;the&#160;current&#160;fillStyle.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.font&#160;=&#160;&#34;28px&#160;Georgia&#34;;<br/>cx.fillStyle&#160;=&#160;&#34;fuchsia&#34;;<br/>cx.fillText(&#34;I&#160;can&#160;draw&#160;text,&#160;too!&#34;,&#160;10,&#160;50);<br/>
&lt;/script&gt;<br/>
292<br/>
<hr/>
<a name=305></a>You&#160;can&#160;specify&#160;the&#160;size,&#160;style,&#160;and&#160;font&#160;of&#160;the&#160;text&#160;with&#160;the&#160;font&#160;property.<br/>
This&#160;example&#160;just&#160;gives&#160;a&#160;font&#160;size&#160;and&#160;family&#160;name.&#160;It&#160;is&#160;also&#160;possible&#160;to&#160;add<br/>italic&#160;or&#160;bold&#160;to&#160;the&#160;start&#160;of&#160;the&#160;string&#160;to&#160;select&#160;a&#160;style.<br/>
The&#160;last&#160;two&#160;arguments&#160;to&#160;fillText&#160;and&#160;strokeText&#160;provide&#160;the&#160;position&#160;at<br/>
which&#160;the&#160;font&#160;is&#160;drawn.&#160;By&#160;default,&#160;they&#160;indicate&#160;the&#160;position&#160;of&#160;the&#160;start<br/>of&#160;the&#160;text’s&#160;alphabetic&#160;baseline,&#160;which&#160;is&#160;the&#160;line&#160;that&#160;letters&#160;“stand”&#160;on,&#160;not<br/>counting&#160;hanging&#160;parts&#160;in&#160;letters&#160;such&#160;as&#160;<i>j&#160;</i>or&#160;<i>p</i>.&#160;You&#160;can&#160;change&#160;the&#160;horizontal<br/>position&#160;by&#160;setting&#160;the&#160;textAlign&#160;property&#160;to&#160;&#34;end&#34;&#160;or&#160;&#34;center&#34;&#160;and&#160;the&#160;vertical<br/>position&#160;by&#160;setting&#160;textBaseline&#160;to&#160;&#34;top&#34;,&#160;&#34;middle&#34;,&#160;or&#160;&#34;bottom&#34;.<br/>
We’ll&#160;come&#160;back&#160;to&#160;our&#160;pie&#160;chart,&#160;and&#160;the&#160;problem&#160;of&#160;labeling&#160;the&#160;slices,&#160;in<br/>
the&#160;<a href="eloquent-javascripts.html#318">exercises&#160;</a>at&#160;the&#160;end&#160;of&#160;the&#160;chapter.<br/>
<b>Images</b><br/>
In&#160;computer&#160;graphics,&#160;a&#160;distinction&#160;is&#160;often&#160;made&#160;between&#160;<i>vector&#160;</i>graphics&#160;and<br/><i>bitmap&#160;</i>graphics.&#160;The&#160;first&#160;is&#160;what&#160;we&#160;have&#160;been&#160;doing&#160;so&#160;far&#160;in&#160;this&#160;chapter—<br/>specifying&#160;a&#160;picture&#160;by&#160;giving&#160;a&#160;logical&#160;description&#160;of&#160;shapes.&#160;Bitmap&#160;graphics,<br/>on&#160;the&#160;other&#160;hand,&#160;don’t&#160;specify&#160;actual&#160;shapes&#160;but&#160;rather&#160;work&#160;with&#160;pixel&#160;data<br/>(rasters&#160;of&#160;colored&#160;dots).<br/>
The&#160;drawImage&#160;method&#160;allows&#160;us&#160;to&#160;draw&#160;pixel&#160;data&#160;onto&#160;a&#160;canvas.&#160;This<br/>
pixel&#160;data&#160;can&#160;originate&#160;from&#160;an&#160;&lt;img&gt;&#160;element&#160;or&#160;from&#160;another&#160;canvas.&#160;The<br/>following&#160;example&#160;creates&#160;a&#160;detached&#160;&lt;img&gt;&#160;element&#160;and&#160;loads&#160;an&#160;image&#160;file<br/>into&#160;it.&#160;But&#160;it&#160;cannot&#160;immediately&#160;start&#160;drawing&#160;from&#160;this&#160;picture&#160;because&#160;the<br/>browser&#160;may&#160;not&#160;have&#160;loaded&#160;it&#160;yet.&#160;To&#160;deal&#160;with&#160;this,&#160;we&#160;register&#160;a&#160;&#34;load&#34;<br/>event&#160;handler&#160;and&#160;do&#160;the&#160;drawing&#160;after&#160;the&#160;image&#160;has&#160;loaded.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>let&#160;img&#160;=&#160;document.createElement(&#34;img&#34;);<br/>img.src&#160;=&#160;&#34;img/hat.png&#34;;<br/>img.addEventListener(&#34;load&#34;,&#160;()&#160;=&gt;&#160;{<br/>
for&#160;(let&#160;x&#160;=&#160;10;&#160;x&#160;&lt;&#160;200;&#160;x&#160;+=&#160;30)&#160;{<br/>
cx.drawImage(img,&#160;x,&#160;10);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
By&#160;default,&#160;drawImage&#160;will&#160;draw&#160;the&#160;image&#160;at&#160;its&#160;original&#160;size.&#160;You&#160;can&#160;also<br/>
give&#160;it&#160;two&#160;additional&#160;arguments&#160;to&#160;set&#160;a&#160;different&#160;width&#160;and&#160;height.<br/>
293<br/>
<hr/>
<a name=306></a><img src="eloquent-javascript-306_1.png"/><br/>
When&#160;drawImage&#160;is&#160;given&#160;<i>nine&#160;</i>arguments,&#160;it&#160;can&#160;be&#160;used&#160;to&#160;draw&#160;only&#160;a&#160;frag-<br/>
ment&#160;of&#160;an&#160;image.&#160;The&#160;second&#160;through&#160;fifth&#160;arguments&#160;indicate&#160;the&#160;rectangle<br/>(x,&#160;y,&#160;width,&#160;and&#160;height)&#160;in&#160;the&#160;source&#160;image&#160;that&#160;should&#160;be&#160;copied,&#160;and&#160;the<br/>sixth&#160;to&#160;ninth&#160;arguments&#160;give&#160;the&#160;rectangle&#160;(on&#160;the&#160;canvas)&#160;into&#160;which&#160;it&#160;should<br/>be&#160;copied.<br/>
This&#160;can&#160;be&#160;used&#160;to&#160;pack&#160;multiple&#160;<i>sprites&#160;</i>(image&#160;elements)&#160;into&#160;a&#160;single<br/>
image&#160;file&#160;and&#160;then&#160;draw&#160;only&#160;the&#160;part&#160;you&#160;need.&#160;For&#160;example,&#160;we&#160;have&#160;this<br/>picture&#160;containing&#160;a&#160;game&#160;character&#160;in&#160;multiple&#160;poses:<br/>
By&#160;alternating&#160;which&#160;pose&#160;we&#160;draw,&#160;we&#160;can&#160;show&#160;an&#160;animation&#160;that&#160;looks<br/>
like&#160;a&#160;walking&#160;character.<br/>
To&#160;animate&#160;a&#160;picture&#160;on&#160;a&#160;canvas,&#160;the&#160;clearRect&#160;method&#160;is&#160;useful.&#160;It&#160;resem-<br/>
bles&#160;fillRect,&#160;but&#160;instead&#160;of&#160;coloring&#160;the&#160;rectangle,&#160;it&#160;makes&#160;it&#160;transparent,<br/>removing&#160;the&#160;previously&#160;drawn&#160;pixels.<br/>
We&#160;know&#160;that&#160;each&#160;<i>sprite</i>,&#160;each&#160;subpicture,&#160;is&#160;24&#160;pixels&#160;wide&#160;and&#160;30&#160;pixels<br/>
high.&#160;The&#160;following&#160;code&#160;loads&#160;the&#160;image&#160;and&#160;then&#160;sets&#160;up&#160;an&#160;interval&#160;(repeated<br/>timer)&#160;to&#160;draw&#160;the&#160;next&#160;frame:<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>let&#160;img&#160;=&#160;document.createElement(&#34;img&#34;);<br/>img.src&#160;=&#160;&#34;img/player.png&#34;;<br/>let&#160;spriteW&#160;=&#160;24,&#160;spriteH&#160;=&#160;30;<br/>img.addEventListener(&#34;load&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;cycle&#160;=&#160;0;<br/>setInterval(()&#160;=&gt;&#160;{<br/>
cx.clearRect(0,&#160;0,&#160;spriteW,&#160;spriteH);<br/>cx.drawImage(img,<br/>
//&#160;source&#160;rectangle<br/>cycle&#160;*&#160;spriteW,&#160;0,&#160;spriteW,&#160;spriteH,<br/>//&#160;destination&#160;rectangle<br/>0,<br/>
0,&#160;spriteW,&#160;spriteH);<br/>
cycle&#160;=&#160;(cycle&#160;+&#160;1)&#160;%&#160;8;<br/>
},&#160;120);<br/>
});<br/>
&lt;/script&gt;<br/>
The&#160;cycle&#160;binding&#160;tracks&#160;our&#160;position&#160;in&#160;the&#160;animation.&#160;For&#160;each&#160;frame,&#160;it&#160;is<br/>
incremented&#160;and&#160;then&#160;clipped&#160;back&#160;to&#160;the&#160;0&#160;to&#160;7&#160;range&#160;by&#160;using&#160;the&#160;remainder<br/>
294<br/>
<hr/>
<a name=307></a><img src="eloquent-javascript-307_1.png"/><br/>
operator.&#160;This&#160;binding&#160;is&#160;then&#160;used&#160;to&#160;compute&#160;the&#160;x-coordinate&#160;that&#160;the&#160;sprite<br/>for&#160;the&#160;current&#160;pose&#160;has&#160;in&#160;the&#160;picture.<br/>
<b>Transformation</b><br/>
But&#160;what&#160;if&#160;we&#160;want&#160;our&#160;character&#160;to&#160;walk&#160;to&#160;the&#160;left&#160;instead&#160;of&#160;to&#160;the&#160;right?<br/>We&#160;could&#160;draw&#160;another&#160;set&#160;of&#160;sprites,&#160;of&#160;course.&#160;But&#160;we&#160;can&#160;also&#160;instruct&#160;the<br/>canvas&#160;to&#160;draw&#160;the&#160;picture&#160;the&#160;other&#160;way&#160;round.<br/>
Calling&#160;the&#160;scale&#160;method&#160;will&#160;cause&#160;anything&#160;drawn&#160;after&#160;it&#160;to&#160;be&#160;scaled.<br/>
This&#160;method&#160;takes&#160;two&#160;parameters,&#160;one&#160;to&#160;set&#160;a&#160;horizontal&#160;scale&#160;and&#160;one&#160;to&#160;set<br/>a&#160;vertical&#160;scale.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>cx.scale(3,&#160;.5);<br/>cx.beginPath();<br/>cx.arc(50,&#160;50,&#160;40,&#160;0,&#160;7);<br/>cx.lineWidth&#160;=&#160;3;<br/>cx.stroke();<br/>
&lt;/script&gt;<br/>
Because&#160;of&#160;the&#160;call&#160;to&#160;scale,&#160;the&#160;circle&#160;is&#160;drawn&#160;three&#160;times&#160;as&#160;wide&#160;and&#160;half<br/>
as&#160;high.<br/>
Scaling&#160;will&#160;cause&#160;everything&#160;about&#160;the&#160;drawn&#160;image,&#160;including&#160;the&#160;line<br/>
width,&#160;to&#160;be&#160;stretched&#160;out&#160;or&#160;squeezed&#160;together&#160;as&#160;specified.&#160;Scaling&#160;by&#160;a<br/>negative&#160;amount&#160;will&#160;flip&#160;the&#160;picture&#160;around.&#160;The&#160;flipping&#160;happens&#160;around<br/>point&#160;(0,0),&#160;which&#160;means&#160;it&#160;will&#160;also&#160;flip&#160;the&#160;direction&#160;of&#160;the&#160;coordinate&#160;system.<br/>When&#160;a&#160;horizontal&#160;scaling&#160;of&#160;-1&#160;is&#160;applied,&#160;a&#160;shape&#160;drawn&#160;at&#160;x&#160;position&#160;100&#160;will<br/>end&#160;up&#160;at&#160;what&#160;used&#160;to&#160;be&#160;position&#160;-100.<br/>
So&#160;to&#160;turn&#160;a&#160;picture&#160;around,&#160;we&#160;can’t&#160;simply&#160;add&#160;cx.scale(-1,&#160;1)&#160;before&#160;the<br/>
call&#160;to&#160;drawImage&#160;because&#160;that&#160;would&#160;move&#160;our&#160;picture&#160;outside&#160;of&#160;the&#160;canvas,<br/>where&#160;it&#160;won’t&#160;be&#160;visible.&#160;You&#160;could&#160;adjust&#160;the&#160;coordinates&#160;given&#160;to&#160;drawImage<br/>
to&#160;compensate&#160;for&#160;this&#160;by&#160;drawing&#160;the&#160;image&#160;at&#160;x&#160;position&#160;-50&#160;instead&#160;of&#160;0.<br/>
Another&#160;solution,&#160;which&#160;doesn’t&#160;require&#160;the&#160;code&#160;that&#160;does&#160;the&#160;drawing&#160;to&#160;know<br/>about&#160;the&#160;scale&#160;change,&#160;is&#160;to&#160;adjust&#160;the&#160;axis&#160;around&#160;which&#160;the&#160;scaling&#160;happens.<br/>
There&#160;are&#160;several&#160;other&#160;methods&#160;besides&#160;scale&#160;that&#160;influence&#160;the&#160;coordinate<br/>
295<br/>
<hr/>
<a name=308></a>system&#160;for&#160;a&#160;canvas.&#160;You&#160;can&#160;rotate&#160;subsequently&#160;drawn&#160;shapes&#160;with&#160;the&#160;rotate<br/>method&#160;and&#160;move&#160;them&#160;with&#160;the&#160;translate&#160;method.&#160;The&#160;interesting—and<br/>confusing—thing&#160;is&#160;that&#160;these&#160;transformations&#160;<i>stack</i>,&#160;meaning&#160;that&#160;each&#160;one<br/>happens&#160;relative&#160;to&#160;the&#160;previous&#160;transformations.<br/>
So&#160;if&#160;we&#160;translate&#160;by&#160;10&#160;horizontal&#160;pixels&#160;twice,&#160;everything&#160;will&#160;be&#160;drawn<br/>
20&#160;pixels&#160;to&#160;the&#160;right.&#160;If&#160;we&#160;first&#160;move&#160;the&#160;center&#160;of&#160;the&#160;coordinate&#160;system&#160;to<br/>(50,50)&#160;and&#160;then&#160;rotate&#160;by&#160;20&#160;degrees&#160;(about&#160;0.1<i>π&#160;</i>radians),&#160;that&#160;rotation&#160;will<br/>happen&#160;<i>around&#160;</i>point&#160;(50,50).<br/>
rotate(0.1*Math.PI)<br/>
translate(50,&#160;50)<br/>
translate(50,&#160;50)<br/>
rotate(0.1*Math.PI)<br/>
But&#160;if&#160;we&#160;<i>first&#160;</i>rotate&#160;by&#160;20&#160;degrees&#160;and&#160;<i>then&#160;</i>translate&#160;by&#160;(50,50),&#160;the&#160;transla-<br/>
tion&#160;will&#160;happen&#160;in&#160;the&#160;rotated&#160;coordinate&#160;system&#160;and&#160;thus&#160;produce&#160;a&#160;different<br/>orientation.&#160;The&#160;order&#160;in&#160;which&#160;transformations&#160;are&#160;applied&#160;matters.<br/>
To&#160;flip&#160;a&#160;picture&#160;around&#160;the&#160;vertical&#160;line&#160;at&#160;a&#160;given&#160;x&#160;position,&#160;we&#160;can&#160;do&#160;the<br/>
following:<br/>
function&#160;flipHorizontally(context,&#160;around)&#160;{<br/>
context.translate(around,&#160;0);<br/>context.scale(-1,&#160;1);<br/>context.translate(-around,&#160;0);<br/>
}<br/>
We&#160;move&#160;the&#160;y-axis&#160;to&#160;where&#160;we&#160;want&#160;our&#160;mirror&#160;to&#160;be,&#160;apply&#160;the&#160;mirroring,<br/>
and&#160;finally&#160;move&#160;the&#160;y-axis&#160;back&#160;to&#160;its&#160;proper&#160;place&#160;in&#160;the&#160;mirrored&#160;universe.<br/>The&#160;following&#160;picture&#160;explains&#160;why&#160;this&#160;works:<br/>
mirror<br/>
3<br/>
1<br/>
4<br/>
2<br/>
This&#160;shows&#160;the&#160;coordinate&#160;systems&#160;before&#160;and&#160;after&#160;mirroring&#160;across&#160;the<br/>
central&#160;line.&#160;The&#160;triangles&#160;are&#160;numbered&#160;to&#160;illustrate&#160;each&#160;step.&#160;If&#160;we&#160;draw&#160;a<br/>
296<br/>
<hr/>
<a name=309></a>triangle&#160;at&#160;a&#160;positive&#160;x&#160;position,&#160;it&#160;would,&#160;by&#160;default,&#160;be&#160;in&#160;the&#160;place&#160;where<br/>triangle&#160;1&#160;is.&#160;A&#160;call&#160;to&#160;flipHorizontally&#160;first&#160;does&#160;a&#160;translation&#160;to&#160;the&#160;right,<br/>which&#160;gets&#160;us&#160;to&#160;triangle&#160;2.&#160;It&#160;then&#160;scales,&#160;flipping&#160;the&#160;triangle&#160;over&#160;to&#160;position<br/>3.&#160;This&#160;is&#160;not&#160;where&#160;it&#160;should&#160;be,&#160;if&#160;it&#160;were&#160;mirrored&#160;in&#160;the&#160;given&#160;line.&#160;The<br/>second&#160;translate&#160;call&#160;fixes&#160;this—it&#160;“cancels”&#160;the&#160;initial&#160;translation&#160;and&#160;makes<br/>triangle&#160;4&#160;appear&#160;exactly&#160;where&#160;it&#160;should.<br/>
We&#160;can&#160;now&#160;draw&#160;a&#160;mirrored&#160;character&#160;at&#160;position&#160;(100,0)&#160;by&#160;flipping&#160;the<br/>
world&#160;around&#160;the&#160;character’s&#160;vertical&#160;center.<br/>
&lt;canvas&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>let&#160;img&#160;=&#160;document.createElement(&#34;img&#34;);<br/>img.src&#160;=&#160;&#34;img/player.png&#34;;<br/>let&#160;spriteW&#160;=&#160;24,&#160;spriteH&#160;=&#160;30;<br/>img.addEventListener(&#34;load&#34;,&#160;()&#160;=&gt;&#160;{<br/>
flipHorizontally(cx,&#160;100&#160;+&#160;spriteW&#160;/&#160;2);<br/>cx.drawImage(img,&#160;0,&#160;0,&#160;spriteW,&#160;spriteH,<br/>
100,&#160;0,&#160;spriteW,&#160;spriteH);<br/>
});<br/>
&lt;/script&gt;<br/>
<b>Storing&#160;and&#160;clearing&#160;transformations</b><br/>
Transformations&#160;stick&#160;around.&#160;Everything&#160;else&#160;we&#160;draw&#160;after&#160;drawing&#160;that<br/>mirrored&#160;character&#160;would&#160;also&#160;be&#160;mirrored.&#160;That&#160;might&#160;be&#160;inconvenient.<br/>
It&#160;is&#160;possible&#160;to&#160;save&#160;the&#160;current&#160;transformation,&#160;do&#160;some&#160;drawing&#160;and&#160;trans-<br/>
forming,&#160;and&#160;then&#160;restore&#160;the&#160;old&#160;transformation.&#160;This&#160;is&#160;usually&#160;the&#160;proper<br/>thing&#160;to&#160;do&#160;for&#160;a&#160;function&#160;that&#160;needs&#160;to&#160;temporarily&#160;transform&#160;the&#160;coordinate<br/>system.&#160;First,&#160;we&#160;save&#160;whatever&#160;transformation&#160;the&#160;code&#160;that&#160;called&#160;the&#160;func-<br/>tion&#160;was&#160;using.&#160;Then&#160;the&#160;function&#160;does&#160;its&#160;thing,&#160;adding&#160;more&#160;transformations<br/>on&#160;top&#160;of&#160;the&#160;current&#160;transformation.&#160;Finally,&#160;we&#160;revert&#160;to&#160;the&#160;transformation<br/>we&#160;started&#160;with.<br/>
The&#160;save&#160;and&#160;restore&#160;methods&#160;on&#160;the&#160;2D&#160;canvas&#160;context&#160;do&#160;this&#160;transfor-<br/>
mation&#160;management.&#160;They&#160;conceptually&#160;keep&#160;a&#160;stack&#160;of&#160;transformation&#160;states.<br/>When&#160;you&#160;call&#160;save,&#160;the&#160;current&#160;state&#160;is&#160;pushed&#160;onto&#160;the&#160;stack,&#160;and&#160;when&#160;you<br/>call&#160;restore,&#160;the&#160;state&#160;on&#160;top&#160;of&#160;the&#160;stack&#160;is&#160;taken&#160;off&#160;and&#160;used&#160;as&#160;the&#160;context’s<br/>current&#160;transformation.&#160;You&#160;can&#160;also&#160;call&#160;resetTransform&#160;to&#160;fully&#160;reset&#160;the<br/>transformation.<br/>
The&#160;branch&#160;function&#160;in&#160;the&#160;following&#160;example&#160;illustrates&#160;what&#160;you&#160;can&#160;do<br/>
297<br/>
<hr/>
<a name=310></a><img src="eloquent-javascript-310_1.png"/><br/>
with&#160;a&#160;function&#160;that&#160;changes&#160;the&#160;transformation&#160;and&#160;then&#160;calls&#160;a&#160;function&#160;(in<br/>this&#160;case&#160;itself),&#160;which&#160;continues&#160;drawing&#160;with&#160;the&#160;given&#160;transformation.<br/>
This&#160;function&#160;draws&#160;a&#160;treelike&#160;shape&#160;by&#160;drawing&#160;a&#160;line,&#160;moving&#160;the&#160;center<br/>
of&#160;the&#160;coordinate&#160;system&#160;to&#160;the&#160;end&#160;of&#160;the&#160;line,&#160;and&#160;calling&#160;itself&#160;twice—first<br/>rotated&#160;to&#160;the&#160;left&#160;and&#160;then&#160;rotated&#160;to&#160;the&#160;right.&#160;Every&#160;call&#160;reduces&#160;the&#160;length<br/>of&#160;the&#160;branch&#160;drawn,&#160;and&#160;the&#160;recursion&#160;stops&#160;when&#160;the&#160;length&#160;drops&#160;below&#160;8.<br/>
&lt;canvas&#160;width=&#34;600&#34;&#160;height=&#34;300&#34;&gt;&lt;/canvas&gt;<br/>&lt;script&gt;<br/>
let&#160;cx&#160;=&#160;document.querySelector(&#34;canvas&#34;).getContext(&#34;2d&#34;);<br/>function&#160;branch(length,&#160;angle,&#160;scale)&#160;{<br/>
cx.fillRect(0,&#160;0,&#160;1,&#160;length);<br/>if&#160;(length&#160;&lt;&#160;8)&#160;return;<br/>cx.save();<br/>cx.translate(0,&#160;length);<br/>cx.rotate(-angle);<br/>branch(length&#160;*&#160;scale,&#160;angle,&#160;scale);<br/>cx.rotate(2&#160;*&#160;angle);<br/>branch(length&#160;*&#160;scale,&#160;angle,&#160;scale);<br/>cx.restore();<br/>
}<br/>cx.translate(300,&#160;0);<br/>branch(60,&#160;0.5,&#160;0.8);<br/>
&lt;/script&gt;<br/>
The&#160;result&#160;is&#160;a&#160;simple&#160;fractal.<br/>
If&#160;the&#160;calls&#160;to&#160;save&#160;and&#160;restore&#160;were&#160;not&#160;there,&#160;the&#160;second&#160;recursive&#160;call&#160;to<br/>
branch&#160;would&#160;end&#160;up&#160;with&#160;the&#160;position&#160;and&#160;rotation&#160;created&#160;by&#160;the&#160;first&#160;call.<br/>It&#160;wouldn’t&#160;be&#160;connected&#160;to&#160;the&#160;current&#160;branch&#160;but&#160;rather&#160;to&#160;the&#160;innermost,<br/>rightmost&#160;branch&#160;drawn&#160;by&#160;the&#160;first&#160;call.&#160;The&#160;resulting&#160;shape&#160;might&#160;also&#160;be<br/>interesting,&#160;but&#160;it&#160;is&#160;definitely&#160;not&#160;a&#160;tree.<br/>
298<br/>
<hr/>
<a name=311></a><b>Back&#160;to&#160;the&#160;game</b><br/>
We&#160;now&#160;know&#160;enough&#160;about&#160;canvas&#160;drawing&#160;to&#160;start&#160;working&#160;on&#160;a&#160;canvas-based<br/>display&#160;system&#160;for&#160;the&#160;game&#160;from&#160;the&#160;<a href="eloquent-javascripts.html#273">previous&#160;chapter</a>.&#160;The&#160;new&#160;display&#160;will<br/>no&#160;longer&#160;be&#160;showing&#160;just&#160;colored&#160;boxes.&#160;Instead,&#160;we’ll&#160;use&#160;drawImage&#160;to&#160;draw<br/>pictures&#160;that&#160;represent&#160;the&#160;game’s&#160;elements.<br/>
We&#160;define&#160;another&#160;display&#160;object&#160;type&#160;called&#160;CanvasDisplay,&#160;supporting&#160;the<br/>
same&#160;interface&#160;as&#160;DOMDisplay&#160;from&#160;<a href="eloquent-javascripts.html#280">Chapter&#160;16,&#160;</a>namely,&#160;the&#160;methods&#160;syncState<br/>and&#160;clear.<br/>
This&#160;object&#160;keeps&#160;a&#160;little&#160;more&#160;information&#160;than&#160;DOMDisplay.&#160;Rather&#160;than<br/>
using&#160;the&#160;scroll&#160;position&#160;of&#160;its&#160;DOM&#160;element,&#160;it&#160;tracks&#160;its&#160;own&#160;viewport,&#160;which<br/>tells&#160;us&#160;what&#160;part&#160;of&#160;the&#160;level&#160;we&#160;are&#160;currently&#160;looking&#160;at.&#160;Finally,&#160;it&#160;keeps<br/>a&#160;flipPlayer&#160;property&#160;so&#160;that&#160;even&#160;when&#160;the&#160;player&#160;is&#160;standing&#160;still,&#160;it&#160;keeps<br/>facing&#160;the&#160;direction&#160;it&#160;last&#160;moved&#160;in.<br/>
class&#160;CanvasDisplay&#160;{<br/>
constructor(parent,&#160;level)&#160;{<br/>
this.canvas&#160;=&#160;document.createElement(&#34;canvas&#34;);<br/>this.canvas.width&#160;=&#160;Math.min(600,&#160;level.width&#160;*&#160;scale);<br/>this.canvas.height&#160;=&#160;Math.min(450,&#160;level.height&#160;*&#160;scale);<br/>parent.appendChild(this.canvas);<br/>this.cx&#160;=&#160;this.canvas.getContext(&#34;2d&#34;);<br/>
this.flipPlayer&#160;=&#160;false;<br/>
this.viewport&#160;=&#160;{<br/>
left:&#160;0,<br/>top:&#160;0,<br/>width:&#160;this.canvas.width&#160;/&#160;scale,<br/>height:&#160;this.canvas.height&#160;/&#160;scale<br/>
};<br/>
}<br/>
clear()&#160;{<br/>
this.canvas.remove();<br/>
}<br/>
}<br/>
The&#160;syncState&#160;method&#160;first&#160;computes&#160;a&#160;new&#160;viewport&#160;and&#160;then&#160;draws&#160;the<br/>
game&#160;scene&#160;at&#160;the&#160;appropriate&#160;position.<br/>
CanvasDisplay.prototype.syncState&#160;=&#160;function(state)&#160;{<br/>
this.updateViewport(state);<br/>
299<br/>
<hr/>
<a name=312></a>this.clearDisplay(state.status);<br/>this.drawBackground(state.level);<br/>this.drawActors(state.actors);<br/>
};<br/>
Contrary&#160;to&#160;DOMDisplay,&#160;this&#160;display&#160;style&#160;<i>does&#160;</i>have&#160;to&#160;redraw&#160;the&#160;back-<br/>
ground&#160;on&#160;every&#160;update.&#160;Because&#160;shapes&#160;on&#160;a&#160;canvas&#160;are&#160;just&#160;pixels,&#160;after&#160;we<br/>draw&#160;them&#160;there&#160;is&#160;no&#160;good&#160;way&#160;to&#160;move&#160;them&#160;(or&#160;remove&#160;them).&#160;The&#160;only<br/>way&#160;to&#160;update&#160;the&#160;canvas&#160;display&#160;is&#160;to&#160;clear&#160;it&#160;and&#160;redraw&#160;the&#160;scene.&#160;We&#160;may<br/>also&#160;have&#160;scrolled,&#160;which&#160;requires&#160;the&#160;background&#160;to&#160;be&#160;in&#160;a&#160;different&#160;position.<br/>
The&#160;updateViewport&#160;method&#160;is&#160;similar&#160;to&#160;DOMDisplay’s&#160;scrollPlayerIntoView<br/>
method.&#160;It&#160;checks&#160;whether&#160;the&#160;player&#160;is&#160;too&#160;close&#160;to&#160;the&#160;edge&#160;of&#160;the&#160;screen<br/>
and&#160;moves&#160;the&#160;viewport&#160;when&#160;this&#160;is&#160;the&#160;case.<br/>
CanvasDisplay.prototype.updateViewport&#160;=&#160;function(state)&#160;{<br/>
let&#160;view&#160;=&#160;this.viewport,&#160;margin&#160;=&#160;view.width&#160;/&#160;3;<br/>let&#160;player&#160;=&#160;state.player;<br/>let&#160;center&#160;=&#160;player.pos.plus(player.size.times(0.5));<br/>
if&#160;(center.x&#160;&lt;&#160;view.left&#160;+&#160;margin)&#160;{<br/>
view.left&#160;=&#160;Math.max(center.x&#160;-&#160;margin,&#160;0);<br/>
}&#160;else&#160;if&#160;(center.x&#160;&gt;&#160;view.left&#160;+&#160;view.width&#160;-&#160;margin)&#160;{<br/>
view.left&#160;=&#160;Math.min(center.x&#160;+&#160;margin&#160;-&#160;view.width,<br/>
state.level.width&#160;-&#160;view.width);<br/>
}<br/>if&#160;(center.y&#160;&lt;&#160;view.top&#160;+&#160;margin)&#160;{<br/>
view.top&#160;=&#160;Math.max(center.y&#160;-&#160;margin,&#160;0);<br/>
}&#160;else&#160;if&#160;(center.y&#160;&gt;&#160;view.top&#160;+&#160;view.height&#160;-&#160;margin)&#160;{<br/>
view.top&#160;=&#160;Math.min(center.y&#160;+&#160;margin&#160;-&#160;view.height,<br/>
state.level.height&#160;-&#160;view.height);<br/>
}<br/>
};<br/>
The&#160;calls&#160;to&#160;Math.max&#160;and&#160;Math.min&#160;ensure&#160;that&#160;the&#160;viewport&#160;does&#160;not&#160;end<br/>
up&#160;showing&#160;space&#160;outside&#160;of&#160;the&#160;level.&#160;Math.max(x,&#160;0)&#160;makes&#160;sure&#160;the&#160;resulting<br/>number&#160;is&#160;not&#160;less&#160;than&#160;zero.&#160;Math.min&#160;similarly&#160;guarantees&#160;that&#160;a&#160;value&#160;stays<br/>below&#160;a&#160;given&#160;bound.<br/>
When&#160;clearing&#160;the&#160;display,&#160;we’ll&#160;use&#160;a&#160;slightly&#160;different&#160;color&#160;depending&#160;on<br/>
whether&#160;the&#160;game&#160;is&#160;won&#160;(brighter)&#160;or&#160;lost&#160;(darker).<br/>
CanvasDisplay.prototype.clearDisplay&#160;=&#160;function(status)&#160;{<br/>
if&#160;(status&#160;==&#160;&#34;won&#34;)&#160;{<br/>
300<br/>
<hr/>
<a name=313></a><img src="eloquent-javascript-313_1.png"/><br/>
this.cx.fillStyle&#160;=&#160;&#34;rgb(68,&#160;191,&#160;255)&#34;;<br/>
}&#160;else&#160;if&#160;(status&#160;==&#160;&#34;lost&#34;)&#160;{<br/>
this.cx.fillStyle&#160;=&#160;&#34;rgb(44,&#160;136,&#160;214)&#34;;<br/>
}&#160;else&#160;{<br/>
this.cx.fillStyle&#160;=&#160;&#34;rgb(52,&#160;166,&#160;251)&#34;;<br/>
}<br/>this.cx.fillRect(0,&#160;0,<br/>
this.canvas.width,&#160;this.canvas.height);<br/>
};<br/>
To&#160;draw&#160;the&#160;background,&#160;we&#160;run&#160;through&#160;the&#160;tiles&#160;that&#160;are&#160;visible&#160;in&#160;the<br/>
current&#160;viewport,&#160;using&#160;the&#160;same&#160;trick&#160;used&#160;in&#160;the&#160;touches&#160;method&#160;from&#160;the<br/><a href="eloquent-javascripts.html#286">previous&#160;chapter</a>.<br/>
let&#160;otherSprites&#160;=&#160;document.createElement(&#34;img&#34;);<br/>otherSprites.src&#160;=&#160;&#34;img/sprites.png&#34;;<br/>
CanvasDisplay.prototype.drawBackground&#160;=&#160;function(level)&#160;{<br/>
let&#160;{left,&#160;top,&#160;width,&#160;height}&#160;=&#160;this.viewport;<br/>let&#160;xStart&#160;=&#160;Math.floor(left);<br/>let&#160;xEnd&#160;=&#160;Math.ceil(left&#160;+&#160;width);<br/>let&#160;yStart&#160;=&#160;Math.floor(top);<br/>let&#160;yEnd&#160;=&#160;Math.ceil(top&#160;+&#160;height);<br/>
for&#160;(let&#160;y&#160;=&#160;yStart;&#160;y&#160;&lt;&#160;yEnd;&#160;y++)&#160;{<br/>
for&#160;(let&#160;x&#160;=&#160;xStart;&#160;x&#160;&lt;&#160;xEnd;&#160;x++)&#160;{<br/>
let&#160;tile&#160;=&#160;level.rows[y][x];<br/>if&#160;(tile&#160;==&#160;&#34;empty&#34;)&#160;continue;<br/>let&#160;screenX&#160;=&#160;(x&#160;-&#160;left)&#160;*&#160;scale;<br/>let&#160;screenY&#160;=&#160;(y&#160;-&#160;top)&#160;*&#160;scale;<br/>let&#160;tileX&#160;=&#160;tile&#160;==&#160;&#34;lava&#34;&#160;?&#160;scale&#160;:&#160;0;<br/>this.cx.drawImage(otherSprites,<br/>
tileX,<br/>
0,&#160;scale,&#160;scale,<br/>
screenX,&#160;screenY,&#160;scale,&#160;scale);<br/>
}<br/>
}<br/>
};<br/>
Tiles&#160;that&#160;are&#160;not&#160;empty&#160;are&#160;drawn&#160;with&#160;drawImage.&#160;The&#160;otherSprites&#160;image<br/>
contains&#160;the&#160;pictures&#160;used&#160;for&#160;elements&#160;other&#160;than&#160;the&#160;player.&#160;It&#160;contains,&#160;from<br/>left&#160;to&#160;right,&#160;the&#160;wall&#160;tile,&#160;the&#160;lava&#160;tile,&#160;and&#160;the&#160;sprite&#160;for&#160;a&#160;coin.<br/>
301<br/>
<hr/>
<a name=314></a>Background&#160;tiles&#160;are&#160;20&#160;by&#160;20&#160;pixels&#160;since&#160;we&#160;will&#160;use&#160;the&#160;same&#160;scale&#160;that&#160;we<br/>
used&#160;in&#160;DOMDisplay.&#160;Thus,&#160;the&#160;offset&#160;for&#160;lava&#160;tiles&#160;is&#160;20&#160;(the&#160;value&#160;of&#160;the&#160;scale<br/>binding),&#160;and&#160;the&#160;offset&#160;for&#160;walls&#160;is&#160;0.<br/>
We&#160;don’t&#160;bother&#160;waiting&#160;for&#160;the&#160;sprite&#160;image&#160;to&#160;load.&#160;Calling&#160;drawImage&#160;with<br/>
an&#160;image&#160;that&#160;hasn’t&#160;been&#160;loaded&#160;yet&#160;will&#160;simply&#160;do&#160;nothing.&#160;Thus,&#160;we&#160;might<br/>fail&#160;to&#160;draw&#160;the&#160;game&#160;properly&#160;for&#160;the&#160;first&#160;few&#160;frames,&#160;while&#160;the&#160;image&#160;is&#160;still<br/>loading,&#160;but&#160;that&#160;is&#160;not&#160;a&#160;serious&#160;problem.&#160;Since&#160;we&#160;keep&#160;updating&#160;the&#160;screen,<br/>the&#160;correct&#160;scene&#160;will&#160;appear&#160;as&#160;soon&#160;as&#160;the&#160;loading&#160;finishes.<br/>
The&#160;walking&#160;character&#160;shown&#160;earlier&#160;will&#160;be&#160;used&#160;to&#160;represent&#160;the&#160;player.&#160;The<br/>
code&#160;that&#160;draws&#160;it&#160;needs&#160;to&#160;pick&#160;the&#160;right&#160;sprite&#160;and&#160;direction&#160;based&#160;on&#160;the<br/>player’s&#160;current&#160;motion.&#160;The&#160;first&#160;eight&#160;sprites&#160;contain&#160;a&#160;walking&#160;animation.<br/>When&#160;the&#160;player&#160;is&#160;moving&#160;along&#160;a&#160;floor,&#160;we&#160;cycle&#160;through&#160;them&#160;based&#160;on&#160;the<br/>current&#160;time.&#160;We&#160;want&#160;to&#160;switch&#160;frames&#160;every&#160;60&#160;milliseconds,&#160;so&#160;the&#160;time&#160;is<br/>divided&#160;by&#160;60&#160;first.&#160;When&#160;the&#160;player&#160;is&#160;standing&#160;still,&#160;we&#160;draw&#160;the&#160;ninth&#160;sprite.<br/>During&#160;jumps,&#160;which&#160;are&#160;recognized&#160;by&#160;the&#160;fact&#160;that&#160;the&#160;vertical&#160;speed&#160;is&#160;not<br/>zero,&#160;we&#160;use&#160;the&#160;tenth,&#160;rightmost&#160;sprite.<br/>
Because&#160;the&#160;sprites&#160;are&#160;slightly&#160;wider&#160;than&#160;the&#160;player&#160;object—24&#160;instead&#160;of<br/>
16&#160;pixels&#160;to&#160;allow&#160;some&#160;space&#160;for&#160;feet&#160;and&#160;arms—the&#160;method&#160;has&#160;to&#160;adjust&#160;the<br/>x-coordinate&#160;and&#160;width&#160;by&#160;a&#160;given&#160;amount&#160;(playerXOverlap).<br/>
let&#160;playerSprites&#160;=&#160;document.createElement(&#34;img&#34;);<br/>playerSprites.src&#160;=&#160;&#34;img/player.png&#34;;<br/>const&#160;playerXOverlap&#160;=&#160;4;<br/>
CanvasDisplay.prototype.drawPlayer&#160;=&#160;function(player,&#160;x,&#160;y,<br/>
width,&#160;height){<br/>
width&#160;+=&#160;playerXOverlap&#160;*&#160;2;<br/>x&#160;-=&#160;playerXOverlap;<br/>if&#160;(player.speed.x&#160;!=&#160;0)&#160;{<br/>
this.flipPlayer&#160;=&#160;player.speed.x&#160;&lt;&#160;0;<br/>
}<br/>
let&#160;tile&#160;=&#160;8;<br/>if&#160;(player.speed.y&#160;!=&#160;0)&#160;{<br/>
tile&#160;=&#160;9;<br/>
}&#160;else&#160;if&#160;(player.speed.x&#160;!=&#160;0)&#160;{<br/>
tile&#160;=&#160;Math.floor(Date.now()&#160;/&#160;60)&#160;%&#160;8;<br/>
}<br/>
this.cx.save();<br/>if&#160;(this.flipPlayer)&#160;{<br/>
flipHorizontally(this.cx,&#160;x&#160;+&#160;width&#160;/&#160;2);<br/>
}<br/>
302<br/>
<hr/>
<a name=315></a>let&#160;tileX&#160;=&#160;tile&#160;*&#160;width;<br/>this.cx.drawImage(playerSprites,&#160;tileX,&#160;0,&#160;width,&#160;height,<br/>
x,<br/>
y,&#160;width,&#160;height);<br/>
this.cx.restore();<br/>
};<br/>
The&#160;drawPlayer&#160;method&#160;is&#160;called&#160;by&#160;drawActors,&#160;which&#160;is&#160;responsible&#160;for<br/>
drawing&#160;all&#160;the&#160;actors&#160;in&#160;the&#160;game.<br/>
CanvasDisplay.prototype.drawActors&#160;=&#160;function(actors)&#160;{<br/>
for&#160;(let&#160;actor&#160;of&#160;actors)&#160;{<br/>
let&#160;width&#160;=&#160;actor.size.x&#160;*&#160;scale;<br/>let&#160;height&#160;=&#160;actor.size.y&#160;*&#160;scale;<br/>let&#160;x&#160;=&#160;(actor.pos.x&#160;-&#160;this.viewport.left)&#160;*&#160;scale;<br/>let&#160;y&#160;=&#160;(actor.pos.y&#160;-&#160;this.viewport.top)&#160;*&#160;scale;<br/>if&#160;(actor.type&#160;==&#160;&#34;player&#34;)&#160;{<br/>
this.drawPlayer(actor,&#160;x,&#160;y,&#160;width,&#160;height);<br/>
}&#160;else&#160;{<br/>
let&#160;tileX&#160;=&#160;(actor.type&#160;==&#160;&#34;coin&#34;&#160;?&#160;2&#160;:&#160;1)&#160;*&#160;scale;<br/>this.cx.drawImage(otherSprites,<br/>
tileX,&#160;0,&#160;width,&#160;height,<br/>x,<br/>
y,&#160;width,&#160;height);<br/>
}<br/>
}<br/>
};<br/>
When&#160;drawing&#160;something&#160;that&#160;is&#160;not&#160;the&#160;player,&#160;we&#160;look&#160;at&#160;its&#160;type&#160;to&#160;find<br/>
the&#160;offset&#160;of&#160;the&#160;correct&#160;sprite.&#160;The&#160;lava&#160;tile&#160;is&#160;found&#160;at&#160;offset&#160;20,&#160;and&#160;the&#160;coin<br/>sprite&#160;is&#160;found&#160;at&#160;40&#160;(two&#160;times&#160;scale).<br/>
We&#160;have&#160;to&#160;subtract&#160;the&#160;viewport’s&#160;position&#160;when&#160;computing&#160;the&#160;actor’s<br/>
position&#160;since&#160;(0,0)&#160;on&#160;our&#160;canvas&#160;corresponds&#160;to&#160;the&#160;top&#160;left&#160;of&#160;the&#160;viewport,<br/>not&#160;the&#160;top&#160;left&#160;of&#160;the&#160;level.&#160;We&#160;could&#160;also&#160;have&#160;used&#160;translate&#160;for&#160;this.&#160;Either<br/>way&#160;works.<br/>
That&#160;concludes&#160;the&#160;new&#160;display&#160;system.&#160;The&#160;resulting&#160;game&#160;looks&#160;something<br/>
like&#160;this:<br/>
303<br/>
<hr/>
<a name=316></a><img src="eloquent-javascript-316_1.png"/><br/>
<b>Choosing&#160;a&#160;graphics&#160;interface</b><br/>
So&#160;when&#160;you&#160;need&#160;to&#160;generate&#160;graphics&#160;in&#160;the&#160;browser,&#160;you&#160;can&#160;choose&#160;between<br/>plain&#160;HTML,&#160;SVG,&#160;and&#160;canvas.&#160;There&#160;is&#160;no&#160;single&#160;<i>best&#160;</i>approach&#160;that&#160;works&#160;in<br/>all&#160;situations.&#160;Each&#160;option&#160;has&#160;strengths&#160;and&#160;weaknesses.<br/>
Plain&#160;HTML&#160;has&#160;the&#160;advantage&#160;of&#160;being&#160;simple.&#160;It&#160;also&#160;integrates&#160;well&#160;with<br/>
text.&#160;Both&#160;SVG&#160;and&#160;canvas&#160;allow&#160;you&#160;to&#160;draw&#160;text,&#160;but&#160;they&#160;won’t&#160;help&#160;you<br/>position&#160;that&#160;text&#160;or&#160;wrap&#160;it&#160;when&#160;it&#160;takes&#160;up&#160;more&#160;than&#160;one&#160;line.&#160;In&#160;an<br/>HTML-based&#160;picture,&#160;it&#160;is&#160;much&#160;easier&#160;to&#160;include&#160;blocks&#160;of&#160;text.<br/>
SVG&#160;can&#160;be&#160;used&#160;to&#160;produce&#160;crisp&#160;graphics&#160;that&#160;look&#160;good&#160;at&#160;any&#160;zoom<br/>
level.&#160;Unlike&#160;HTML,&#160;it&#160;is&#160;designed&#160;for&#160;drawing&#160;and&#160;is&#160;thus&#160;more&#160;suitable&#160;for<br/>that&#160;purpose.<br/>
Both&#160;SVG&#160;and&#160;HTML&#160;build&#160;up&#160;a&#160;data&#160;structure&#160;(the&#160;DOM)&#160;that&#160;represents<br/>
your&#160;picture.&#160;This&#160;makes&#160;it&#160;possible&#160;to&#160;modify&#160;elements&#160;after&#160;they&#160;are&#160;drawn.<br/>If&#160;you&#160;need&#160;to&#160;repeatedly&#160;change&#160;a&#160;small&#160;part&#160;of&#160;a&#160;big&#160;picture&#160;in&#160;response&#160;to<br/>what&#160;the&#160;user&#160;is&#160;doing&#160;or&#160;as&#160;part&#160;of&#160;an&#160;animation,&#160;doing&#160;it&#160;in&#160;a&#160;canvas&#160;can&#160;be<br/>needlessly&#160;expensive.&#160;The&#160;DOM&#160;also&#160;allows&#160;us&#160;to&#160;register&#160;mouse&#160;event&#160;handlers<br/>on&#160;every&#160;element&#160;in&#160;the&#160;picture&#160;(even&#160;on&#160;shapes&#160;drawn&#160;with&#160;SVG).&#160;You&#160;can’t<br/>do&#160;that&#160;with&#160;canvas.<br/>
But&#160;canvas’s&#160;pixel-oriented&#160;approach&#160;can&#160;be&#160;an&#160;advantage&#160;when&#160;drawing<br/>
a&#160;huge&#160;number&#160;of&#160;tiny&#160;elements.&#160;The&#160;fact&#160;that&#160;it&#160;does&#160;not&#160;build&#160;up&#160;a&#160;data<br/>structure&#160;but&#160;only&#160;repeatedly&#160;draws&#160;onto&#160;the&#160;same&#160;pixel&#160;surface&#160;gives&#160;canvas&#160;a<br/>lower&#160;cost&#160;per&#160;shape.<br/>
There&#160;are&#160;also&#160;effects,&#160;such&#160;as&#160;rendering&#160;a&#160;scene&#160;one&#160;pixel&#160;at&#160;a&#160;time&#160;(for<br/>
example,&#160;using&#160;a&#160;ray&#160;tracer)&#160;or&#160;postprocessing&#160;an&#160;image&#160;with&#160;JavaScript&#160;(blur-<br/>ring&#160;or&#160;distorting&#160;it),&#160;that&#160;can&#160;be&#160;realistically&#160;handled&#160;only&#160;by&#160;a&#160;pixel-based<br/>approach.<br/>
In&#160;some&#160;cases,&#160;you&#160;may&#160;want&#160;to&#160;combine&#160;several&#160;of&#160;these&#160;techniques.&#160;For<br/>
304<br/>
<hr/>
<a name=317></a>example,&#160;you&#160;might&#160;draw&#160;a&#160;graph&#160;with&#160;SVG&#160;or&#160;canvas&#160;but&#160;show&#160;textual&#160;infor-<br/>mation&#160;by&#160;positioning&#160;an&#160;HTML&#160;element&#160;on&#160;top&#160;of&#160;the&#160;picture.<br/>
For&#160;nondemanding&#160;applications,&#160;it&#160;really&#160;doesn’t&#160;matter&#160;much&#160;which&#160;inter-<br/>
face&#160;you&#160;choose.&#160;The&#160;display&#160;we&#160;built&#160;for&#160;our&#160;game&#160;in&#160;this&#160;chapter&#160;could&#160;have<br/>been&#160;implemented&#160;using&#160;any&#160;of&#160;these&#160;three&#160;graphics&#160;technologies&#160;since&#160;it&#160;does<br/>not&#160;need&#160;to&#160;draw&#160;text,&#160;handle&#160;mouse&#160;interaction,&#160;or&#160;work&#160;with&#160;an&#160;extraordi-<br/>narily&#160;large&#160;number&#160;of&#160;elements.<br/>
<b>Summary</b><br/>
In&#160;this&#160;chapter&#160;we&#160;discussed&#160;techniques&#160;for&#160;drawing&#160;graphics&#160;in&#160;the&#160;browser,<br/>focusing&#160;on&#160;the&#160;&lt;canvas&gt;&#160;element.<br/>
A&#160;canvas&#160;node&#160;represents&#160;an&#160;area&#160;in&#160;a&#160;document&#160;that&#160;our&#160;program&#160;may&#160;draw<br/>
on.&#160;This&#160;drawing&#160;is&#160;done&#160;through&#160;a&#160;drawing&#160;context&#160;object,&#160;created&#160;with&#160;the<br/>getContext&#160;method.<br/>
The&#160;2D&#160;drawing&#160;interface&#160;allows&#160;us&#160;to&#160;fill&#160;and&#160;stroke&#160;various&#160;shapes.&#160;The&#160;con-<br/>
text’s&#160;fillStyle&#160;property&#160;determines&#160;how&#160;shapes&#160;are&#160;filled.&#160;The&#160;strokeStyle<br/>and&#160;lineWidth&#160;properties&#160;control&#160;the&#160;way&#160;lines&#160;are&#160;drawn.<br/>
Rectangles&#160;and&#160;pieces&#160;of&#160;text&#160;can&#160;be&#160;drawn&#160;with&#160;a&#160;single&#160;method&#160;call.&#160;The<br/>
fillRect&#160;and&#160;strokeRect&#160;methods&#160;draw&#160;rectangles,&#160;and&#160;the&#160;fillText&#160;and<br/>strokeText&#160;methods&#160;draw&#160;text.&#160;To&#160;create&#160;custom&#160;shapes,&#160;we&#160;must&#160;first&#160;build<br/>up&#160;a&#160;path.<br/>
Calling&#160;beginPath&#160;starts&#160;a&#160;new&#160;path.&#160;A&#160;number&#160;of&#160;other&#160;methods&#160;add&#160;lines<br/>
and&#160;curves&#160;to&#160;the&#160;current&#160;path.&#160;For&#160;example,&#160;lineTo&#160;can&#160;add&#160;a&#160;straight&#160;line.<br/>When&#160;a&#160;path&#160;is&#160;finished,&#160;it&#160;can&#160;be&#160;filled&#160;with&#160;the&#160;fill&#160;method&#160;or&#160;stroked&#160;with<br/>the&#160;stroke&#160;method.<br/>
Moving&#160;pixels&#160;from&#160;an&#160;image&#160;or&#160;another&#160;canvas&#160;onto&#160;our&#160;canvas&#160;is&#160;done&#160;with<br/>
the&#160;drawImage&#160;method.&#160;By&#160;default,&#160;this&#160;method&#160;draws&#160;the&#160;whole&#160;source&#160;image,<br/>but&#160;by&#160;giving&#160;it&#160;more&#160;parameters,&#160;you&#160;can&#160;copy&#160;a&#160;specific&#160;area&#160;of&#160;the&#160;image.<br/>We&#160;used&#160;this&#160;for&#160;our&#160;game&#160;by&#160;copying&#160;individual&#160;poses&#160;of&#160;the&#160;game&#160;character<br/>out&#160;of&#160;an&#160;image&#160;that&#160;contained&#160;many&#160;such&#160;poses.<br/>
Transformations&#160;allow&#160;you&#160;to&#160;draw&#160;a&#160;shape&#160;in&#160;multiple&#160;orientations.&#160;A&#160;2D<br/>
drawing&#160;context&#160;has&#160;a&#160;current&#160;transformation&#160;that&#160;can&#160;be&#160;changed&#160;with&#160;the<br/>translate,&#160;scale,&#160;and&#160;rotate&#160;methods.&#160;These&#160;will&#160;affect&#160;all&#160;subsequent&#160;draw-<br/>ing&#160;operations.&#160;A&#160;transformation&#160;state&#160;can&#160;be&#160;saved&#160;with&#160;the&#160;save&#160;method&#160;and<br/>restored&#160;with&#160;the&#160;restore&#160;method.<br/>
When&#160;showing&#160;an&#160;animation&#160;on&#160;a&#160;canvas,&#160;the&#160;clearRect&#160;method&#160;can&#160;be&#160;used<br/>
to&#160;clear&#160;part&#160;of&#160;the&#160;canvas&#160;before&#160;redrawing&#160;it.<br/>
305<br/>
<hr/>
<a name=318></a><img src="eloquent-javascript-318_1.png"/><br/>
<b>Exercises</b><br/>
<b>Shapes</b><br/>
Write&#160;a&#160;program&#160;that&#160;draws&#160;the&#160;following&#160;shapes&#160;on&#160;a&#160;canvas:<br/>
1.&#160;A&#160;trapezoid&#160;(a&#160;rectangle&#160;that&#160;is&#160;wider&#160;on&#160;one&#160;side)<br/>
2.&#160;A&#160;red&#160;diamond&#160;(a&#160;rectangle&#160;rotated&#160;45&#160;degrees&#160;or&#160;¼<i>π&#160;</i>radians)<br/>
3.&#160;A&#160;zigzagging&#160;line<br/>
4.&#160;A&#160;spiral&#160;made&#160;up&#160;of&#160;100&#160;straight&#160;line&#160;segments<br/>
5.&#160;A&#160;yellow&#160;star<br/>
When&#160;drawing&#160;the&#160;last&#160;two,&#160;you&#160;may&#160;want&#160;to&#160;refer&#160;to&#160;the&#160;explanation&#160;of<br/>
Math.cos&#160;and&#160;Math.sin&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14</a>,&#160;which&#160;describes&#160;how&#160;to&#160;get&#160;coordinates<br/>on&#160;a&#160;circle&#160;using&#160;these&#160;functions.<br/>
I&#160;recommend&#160;creating&#160;a&#160;function&#160;for&#160;each&#160;shape.&#160;Pass&#160;the&#160;position,&#160;and<br/>
optionally&#160;other&#160;properties&#160;such&#160;as&#160;the&#160;size&#160;or&#160;the&#160;number&#160;of&#160;points,&#160;as&#160;param-<br/>eters.&#160;The&#160;alternative,&#160;which&#160;is&#160;to&#160;hard-code&#160;numbers&#160;all&#160;over&#160;your&#160;code,&#160;tends<br/>to&#160;make&#160;the&#160;code&#160;needlessly&#160;hard&#160;to&#160;read&#160;and&#160;modify.<br/>
<b>The&#160;pie&#160;chart</b><br/>
<a href="eloquent-javascripts.html#303">Earlier&#160;</a>in&#160;the&#160;chapter,&#160;we&#160;saw&#160;an&#160;example&#160;program&#160;that&#160;drew&#160;a&#160;pie&#160;chart.<br/>Modify&#160;this&#160;program&#160;so&#160;that&#160;the&#160;name&#160;of&#160;each&#160;category&#160;is&#160;shown&#160;next&#160;to&#160;the<br/>slice&#160;that&#160;represents&#160;it.&#160;Try&#160;to&#160;find&#160;a&#160;pleasing-looking&#160;way&#160;to&#160;automatically<br/>position&#160;this&#160;text&#160;that&#160;would&#160;work&#160;for&#160;other&#160;data&#160;sets&#160;as&#160;well.&#160;You&#160;may&#160;assume<br/>that&#160;categories&#160;are&#160;big&#160;enough&#160;to&#160;leave&#160;ample&#160;room&#160;for&#160;their&#160;labels.<br/>
You&#160;might&#160;need&#160;Math.sin&#160;and&#160;Math.cos&#160;again,&#160;which&#160;are&#160;described&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter</a><br/>
<a href="eloquent-javascripts.html#251">14.</a><br/>
<b>A&#160;bouncing&#160;ball</b><br/>
Use&#160;the&#160;requestAnimationFrame&#160;technique&#160;that&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14&#160;</a>and&#160;<a href="eloquent-javascripts.html#292">Chap-<br/>ter&#160;16&#160;</a>to&#160;draw&#160;a&#160;box&#160;with&#160;a&#160;bouncing&#160;ball&#160;in&#160;it.&#160;The&#160;ball&#160;moves&#160;at&#160;a&#160;constant<br/>speed&#160;and&#160;bounces&#160;off&#160;the&#160;box’s&#160;sides&#160;when&#160;it&#160;hits&#160;them.<br/>
306<br/>
<hr/>
<a name=319></a><b>Precomputed&#160;mirroring</b><br/>
One&#160;unfortunate&#160;thing&#160;about&#160;transformations&#160;is&#160;that&#160;they&#160;slow&#160;down&#160;the&#160;draw-<br/>ing&#160;of&#160;bitmaps.&#160;The&#160;position&#160;and&#160;size&#160;of&#160;each&#160;pixel&#160;has&#160;to&#160;be&#160;transformed,&#160;and<br/>though&#160;it&#160;is&#160;possible&#160;that&#160;browsers&#160;will&#160;get&#160;cleverer&#160;about&#160;transformation&#160;in<br/>the&#160;future,&#160;they&#160;currently&#160;cause&#160;a&#160;measurable&#160;increase&#160;in&#160;the&#160;time&#160;it&#160;takes&#160;to<br/>draw&#160;a&#160;bitmap.<br/>
In&#160;a&#160;game&#160;like&#160;ours,&#160;where&#160;we&#160;are&#160;drawing&#160;only&#160;a&#160;single&#160;transformed&#160;sprite,<br/>
this&#160;is&#160;a&#160;nonissue.&#160;But&#160;imagine&#160;that&#160;we&#160;need&#160;to&#160;draw&#160;hundreds&#160;of&#160;characters<br/>or&#160;thousands&#160;of&#160;rotating&#160;particles&#160;from&#160;an&#160;explosion.<br/>
Think&#160;of&#160;a&#160;way&#160;to&#160;allow&#160;us&#160;to&#160;draw&#160;an&#160;inverted&#160;character&#160;without&#160;loading<br/>
additional&#160;image&#160;files&#160;and&#160;without&#160;having&#160;to&#160;make&#160;transformed&#160;drawImage&#160;calls<br/>every&#160;frame.<br/>
307<br/>
<hr/>
<a name=320></a><i>“Communication&#160;must&#160;be&#160;stateless&#160;in&#160;nature&#160;[...]&#160;such&#160;that&#160;each</i><br/>
<i>request&#160;from&#160;client&#160;to&#160;server&#160;must&#160;contain&#160;all&#160;of&#160;the&#160;information<br/>necessary&#160;to&#160;understand&#160;the&#160;request,&#160;and&#160;cannot&#160;take&#160;advantage&#160;of<br/>any&#160;stored&#160;context&#160;on&#160;the&#160;server.”</i><br/>
—Roy&#160;Fielding,&#160;Architectural&#160;Styles&#160;and&#160;the&#160;Design&#160;of<br/>
Network-based&#160;Software&#160;Architectures<br/>
<b>Chapter&#160;18<br/>HTTP&#160;and&#160;Forms</b><br/>
The&#160;<i>Hypertext&#160;Transfer&#160;Protocol</i>,&#160;already&#160;mentioned&#160;in&#160;<a href="eloquent-javascripts.html#229">Chapter&#160;13</a>,&#160;is&#160;the&#160;mech-<br/>anism&#160;through&#160;which&#160;data&#160;is&#160;requested&#160;and&#160;provided&#160;on&#160;the&#160;World&#160;Wide&#160;Web.<br/>This&#160;chapter&#160;describes&#160;the&#160;protocol&#160;in&#160;more&#160;detail&#160;and&#160;explains&#160;the&#160;way&#160;browser<br/>JavaScript&#160;has&#160;access&#160;to&#160;it.<br/>
<b>The&#160;protocol</b><br/>
If&#160;you&#160;type&#160;<i>eloquentjavascript.net/18_http.html&#160;</i>into&#160;your&#160;browser’s&#160;address<br/>bar,&#160;the&#160;browser&#160;first&#160;looks&#160;up&#160;the&#160;address&#160;of&#160;the&#160;server&#160;associated&#160;with&#160;<i>elo-<br/>quentjavascript.net&#160;</i>and&#160;tries&#160;to&#160;open&#160;a&#160;TCP&#160;connection&#160;to&#160;it&#160;on&#160;port&#160;80,&#160;the<br/>default&#160;port&#160;for&#160;HTTP&#160;traffic.&#160;If&#160;the&#160;server&#160;exists&#160;and&#160;accepts&#160;the&#160;connection,<br/>the&#160;browser&#160;might&#160;send&#160;something&#160;like&#160;this:<br/>
GET&#160;/18_http.html&#160;HTTP/1.1<br/>Host:&#160;eloquentjavascript.net<br/>User-Agent:&#160;Your&#160;browser's&#160;name<br/>
Then&#160;the&#160;server&#160;responds,&#160;through&#160;that&#160;same&#160;connection.<br/>
HTTP/1.1&#160;200&#160;OK<br/>Content-Length:&#160;65585<br/>Content-Type:&#160;text/html<br/>Last-Modified:&#160;Mon,&#160;08&#160;Jan&#160;2018&#160;10:29:45&#160;GMT<br/>
&lt;!doctype&#160;html&gt;<br/>...&#160;the&#160;rest&#160;of&#160;the&#160;document<br/>
The&#160;browser&#160;takes&#160;the&#160;part&#160;of&#160;the&#160;response&#160;after&#160;the&#160;blank&#160;line,&#160;its&#160;<i>body</i><br/>
(not&#160;to&#160;be&#160;confused&#160;with&#160;the&#160;HTML&#160;&lt;body&gt;&#160;tag),&#160;and&#160;displays&#160;it&#160;as&#160;an&#160;HTML<br/>document.<br/>
The&#160;information&#160;sent&#160;by&#160;the&#160;client&#160;is&#160;called&#160;the&#160;<i>request</i>.&#160;It&#160;starts&#160;with&#160;this<br/>
308<br/>
<hr/>
<a name=321></a>line:<br/>
GET&#160;/18_http.html&#160;HTTP/1.1<br/>
The&#160;first&#160;word&#160;is&#160;the&#160;<i>method&#160;</i>of&#160;the&#160;request.&#160;GET&#160;means&#160;that&#160;we&#160;want&#160;to&#160;<i>get</i><br/>
the&#160;specified&#160;resource.&#160;Other&#160;common&#160;methods&#160;are&#160;DELETE&#160;to&#160;delete&#160;a&#160;resource,<br/>PUT&#160;to&#160;create&#160;or&#160;replace&#160;it,&#160;and&#160;POST&#160;to&#160;send&#160;information&#160;to&#160;it.&#160;Note&#160;that&#160;the<br/>server&#160;is&#160;not&#160;obliged&#160;to&#160;carry&#160;out&#160;every&#160;request&#160;it&#160;gets.&#160;If&#160;you&#160;walk&#160;up&#160;to&#160;a<br/>random&#160;website&#160;and&#160;tell&#160;it&#160;to&#160;DELETE&#160;its&#160;main&#160;page,&#160;it’ll&#160;probably&#160;refuse.<br/>
The&#160;part&#160;after&#160;the&#160;method&#160;name&#160;is&#160;the&#160;path&#160;of&#160;the&#160;<i>resource&#160;</i>the&#160;request<br/>
applies&#160;to.&#160;In&#160;the&#160;simplest&#160;case,&#160;a&#160;resource&#160;is&#160;simply&#160;a&#160;file&#160;on&#160;the&#160;server,&#160;but<br/>the&#160;protocol&#160;doesn’t&#160;require&#160;it&#160;to&#160;be.&#160;A&#160;resource&#160;may&#160;be&#160;anything&#160;that&#160;can&#160;be<br/>transferred&#160;<i>as&#160;if&#160;</i>it&#160;is&#160;a&#160;file.&#160;Many&#160;servers&#160;generate&#160;the&#160;responses&#160;they&#160;produce<br/>on&#160;the&#160;fly.&#160;For&#160;example,&#160;if&#160;you&#160;open&#160;<a href="https://github.com/marijnh"><i>https://github.com/marijnh</i></a>,&#160;the&#160;server<br/>looks&#160;in&#160;its&#160;database&#160;for&#160;a&#160;user&#160;named&#160;“marijnh”,&#160;and&#160;if&#160;it&#160;finds&#160;one,&#160;it&#160;will<br/>generate&#160;a&#160;profile&#160;page&#160;for&#160;that&#160;user.<br/>
After&#160;the&#160;resource&#160;path,&#160;the&#160;first&#160;line&#160;of&#160;the&#160;request&#160;mentions&#160;HTTP/1.1&#160;to<br/>
indicate&#160;the&#160;version&#160;of&#160;the&#160;HTTP&#160;protocol&#160;it&#160;is&#160;using.<br/>
In&#160;practice,&#160;many&#160;sites&#160;use&#160;HTTP&#160;version&#160;2,&#160;which&#160;supports&#160;the&#160;same&#160;con-<br/>
cepts&#160;as&#160;version&#160;1.1&#160;but&#160;is&#160;a&#160;lot&#160;more&#160;complicated&#160;so&#160;that&#160;it&#160;can&#160;be&#160;faster.<br/>Browsers&#160;will&#160;automatically&#160;switch&#160;to&#160;the&#160;appropriate&#160;protocol&#160;version&#160;when<br/>talking&#160;to&#160;a&#160;given&#160;server,&#160;and&#160;the&#160;outcome&#160;of&#160;a&#160;request&#160;is&#160;the&#160;same&#160;regardless&#160;of<br/>which&#160;version&#160;is&#160;used.&#160;Because&#160;version&#160;1.1&#160;is&#160;more&#160;straightforward&#160;and&#160;easier<br/>to&#160;play&#160;around&#160;with,&#160;we’ll&#160;focus&#160;on&#160;that.<br/>
The&#160;server’s&#160;response&#160;will&#160;start&#160;with&#160;a&#160;version&#160;as&#160;well,&#160;followed&#160;by&#160;the&#160;status<br/>
of&#160;the&#160;response,&#160;first&#160;as&#160;a&#160;three-digit&#160;status&#160;code&#160;and&#160;then&#160;as&#160;a&#160;human-readable<br/>string.<br/>
HTTP/1.1&#160;200&#160;OK<br/>
Status&#160;codes&#160;starting&#160;with&#160;a&#160;2&#160;indicate&#160;that&#160;the&#160;request&#160;succeeded.&#160;Codes<br/>
starting&#160;with&#160;4&#160;mean&#160;there&#160;was&#160;something&#160;wrong&#160;with&#160;the&#160;request.&#160;404&#160;is<br/>probably&#160;the&#160;most&#160;famous&#160;HTTP&#160;status&#160;code—it&#160;means&#160;that&#160;the&#160;resource&#160;could<br/>not&#160;be&#160;found.&#160;Codes&#160;that&#160;start&#160;with&#160;5&#160;mean&#160;an&#160;error&#160;happened&#160;on&#160;the&#160;server<br/>and&#160;the&#160;request&#160;is&#160;not&#160;to&#160;blame.<br/>
The&#160;first&#160;line&#160;of&#160;a&#160;request&#160;or&#160;response&#160;may&#160;be&#160;followed&#160;by&#160;any&#160;number&#160;of<br/>
<i>headers</i>.&#160;These&#160;are&#160;lines&#160;in&#160;the&#160;form&#160;name:&#160;value&#160;that&#160;specify&#160;extra&#160;informa-<br/>tion&#160;about&#160;the&#160;request&#160;or&#160;response.&#160;These&#160;headers&#160;were&#160;part&#160;of&#160;the&#160;example<br/>response:<br/>
309<br/>
<hr/>
<a name=322></a>Content-Length:&#160;65585<br/>Content-Type:&#160;text/html<br/>Last-Modified:&#160;Thu,&#160;04&#160;Jan&#160;2018&#160;14:05:30&#160;GMT<br/>
This&#160;tells&#160;us&#160;the&#160;size&#160;and&#160;type&#160;of&#160;the&#160;response&#160;document.&#160;In&#160;this&#160;case,&#160;it&#160;is<br/>
an&#160;HTML&#160;document&#160;of&#160;65,585&#160;bytes.&#160;It&#160;also&#160;tells&#160;us&#160;when&#160;that&#160;document&#160;was<br/>last&#160;modified.<br/>
For&#160;most&#160;headers,&#160;the&#160;client&#160;and&#160;server&#160;are&#160;free&#160;to&#160;decide&#160;whether&#160;to&#160;include<br/>
them&#160;in&#160;a&#160;request&#160;or&#160;response.&#160;But&#160;a&#160;few&#160;are&#160;required.&#160;For&#160;example,&#160;the&#160;Host<br/>header,&#160;which&#160;specifies&#160;the&#160;hostname,&#160;should&#160;be&#160;included&#160;in&#160;a&#160;request&#160;because&#160;a<br/>server&#160;might&#160;be&#160;serving&#160;multiple&#160;hostnames&#160;on&#160;a&#160;single&#160;IP&#160;address,&#160;and&#160;without<br/>that&#160;header,&#160;the&#160;server&#160;won’t&#160;know&#160;which&#160;hostname&#160;the&#160;client&#160;is&#160;trying&#160;to&#160;talk<br/>to.<br/>
After&#160;the&#160;headers,&#160;both&#160;requests&#160;and&#160;responses&#160;may&#160;include&#160;a&#160;blank&#160;line<br/>
followed&#160;by&#160;a&#160;body,&#160;which&#160;contains&#160;the&#160;data&#160;being&#160;sent.&#160;GET&#160;and&#160;DELETE&#160;requests<br/>don’t&#160;send&#160;along&#160;any&#160;data,&#160;but&#160;PUT&#160;and&#160;POST&#160;requests&#160;do.&#160;Similarly,&#160;some<br/>response&#160;types,&#160;such&#160;as&#160;error&#160;responses,&#160;do&#160;not&#160;require&#160;a&#160;body.<br/>
<b>Browsers&#160;and&#160;HTTP</b><br/>
As&#160;we&#160;saw&#160;in&#160;the&#160;example,&#160;a&#160;browser&#160;will&#160;make&#160;a&#160;request&#160;when&#160;we&#160;enter&#160;a&#160;URL<br/>in&#160;its&#160;address&#160;bar.&#160;When&#160;the&#160;resulting&#160;HTML&#160;page&#160;references&#160;other&#160;files,&#160;such<br/>as&#160;images&#160;and&#160;JavaScript&#160;files,&#160;those&#160;are&#160;also&#160;retrieved.<br/>
A&#160;moderately&#160;complicated&#160;website&#160;can&#160;easily&#160;include&#160;anywhere&#160;from&#160;10&#160;to<br/>
200&#160;resources.&#160;To&#160;be&#160;able&#160;to&#160;fetch&#160;those&#160;quickly,&#160;browsers&#160;will&#160;make&#160;several&#160;GET<br/>requests&#160;simultaneously,&#160;rather&#160;than&#160;waiting&#160;for&#160;the&#160;responses&#160;one&#160;at&#160;a&#160;time.<br/>
HTML&#160;pages&#160;may&#160;include&#160;<i>forms</i>,&#160;which&#160;allow&#160;the&#160;user&#160;to&#160;fill&#160;out&#160;information<br/>
and&#160;send&#160;it&#160;to&#160;the&#160;server.&#160;This&#160;is&#160;an&#160;example&#160;of&#160;a&#160;form:<br/>
&lt;form&#160;method=&#34;GET&#34;&#160;action=&#34;example/message.html&#34;&gt;<br/>
&lt;p&gt;Name:&#160;&lt;input&#160;type=&#34;text&#34;&#160;name=&#34;name&#34;&gt;&lt;/p&gt;<br/>&lt;p&gt;Message:&lt;br&gt;&lt;textarea&#160;name=&#34;message&#34;&gt;&lt;/textarea&gt;&lt;/p&gt;<br/>&lt;p&gt;&lt;button&#160;type=&#34;submit&#34;&gt;Send&lt;/button&gt;&lt;/p&gt;<br/>
&lt;/form&gt;<br/>
This&#160;code&#160;describes&#160;a&#160;form&#160;with&#160;two&#160;fields:&#160;a&#160;small&#160;one&#160;asking&#160;for&#160;a&#160;name<br/>
and&#160;a&#160;larger&#160;one&#160;to&#160;write&#160;a&#160;message&#160;in.&#160;When&#160;you&#160;click&#160;the&#160;Send&#160;button,&#160;the<br/>form&#160;is&#160;<i>submitted</i>,&#160;meaning&#160;that&#160;the&#160;content&#160;of&#160;its&#160;field&#160;is&#160;packed&#160;into&#160;an&#160;HTTP<br/>request&#160;and&#160;the&#160;browser&#160;navigates&#160;to&#160;the&#160;result&#160;of&#160;that&#160;request.<br/>
310<br/>
<hr/>
<a name=323></a>When&#160;the&#160;&lt;form&gt;&#160;element’s&#160;method&#160;attribute&#160;is&#160;GET&#160;(or&#160;is&#160;omitted),&#160;the&#160;in-<br/>
formation&#160;in&#160;the&#160;form&#160;is&#160;added&#160;to&#160;the&#160;end&#160;of&#160;the&#160;action&#160;URL&#160;as&#160;a&#160;<i>query&#160;string</i>.<br/>The&#160;browser&#160;might&#160;make&#160;a&#160;request&#160;to&#160;this&#160;URL:<br/>
GET&#160;/example/message.html?name=Jean&amp;message=Yes%3F&#160;HTTP/1.1<br/>
The&#160;question&#160;mark&#160;indicates&#160;the&#160;end&#160;of&#160;the&#160;path&#160;part&#160;of&#160;the&#160;URL&#160;and&#160;the<br/>
start&#160;of&#160;the&#160;query.&#160;It&#160;is&#160;followed&#160;by&#160;pairs&#160;of&#160;names&#160;and&#160;values,&#160;corresponding&#160;to<br/>the&#160;name&#160;attribute&#160;on&#160;the&#160;form&#160;field&#160;elements&#160;and&#160;the&#160;content&#160;of&#160;those&#160;elements,<br/>respectively.&#160;An&#160;ampersand&#160;character&#160;(&amp;)&#160;is&#160;used&#160;to&#160;separate&#160;the&#160;pairs.<br/>
The&#160;actual&#160;message&#160;encoded&#160;in&#160;the&#160;URL&#160;is&#160;“Yes?”,&#160;but&#160;the&#160;question&#160;mark&#160;is<br/>
replaced&#160;by&#160;a&#160;strange&#160;code.&#160;Some&#160;characters&#160;in&#160;query&#160;strings&#160;must&#160;be&#160;escaped.<br/>The&#160;question&#160;mark,&#160;represented&#160;as&#160;%3F,&#160;is&#160;one&#160;of&#160;those.&#160;There&#160;seems&#160;to&#160;be<br/>an&#160;unwritten&#160;rule&#160;that&#160;every&#160;format&#160;needs&#160;its&#160;own&#160;way&#160;of&#160;escaping&#160;characters.<br/>This&#160;one,&#160;called&#160;<i>URL&#160;encoding</i>,&#160;uses&#160;a&#160;percent&#160;sign&#160;followed&#160;by&#160;two&#160;hexadecimal<br/>(base&#160;16)&#160;digits&#160;that&#160;encode&#160;the&#160;character&#160;code.&#160;In&#160;this&#160;case,&#160;3F,&#160;which&#160;is&#160;63<br/>in&#160;decimal&#160;notation,&#160;is&#160;the&#160;code&#160;of&#160;a&#160;question&#160;mark&#160;character.&#160;JavaScript<br/>provides&#160;the&#160;encodeURIComponent&#160;and&#160;decodeURIComponent&#160;functions&#160;to&#160;encode<br/>and&#160;decode&#160;this&#160;format.<br/>
console.log(encodeURIComponent(&#34;Yes?&#34;));<br/>//&#160;→&#160;Yes%3F<br/>console.log(decodeURIComponent(&#34;Yes%3F&#34;));<br/>//&#160;→&#160;Yes?<br/>
If&#160;we&#160;change&#160;the&#160;method&#160;attribute&#160;of&#160;the&#160;HTML&#160;form&#160;in&#160;the&#160;example&#160;we&#160;saw<br/>
earlier&#160;to&#160;POST,&#160;the&#160;HTTP&#160;request&#160;made&#160;to&#160;submit&#160;the&#160;form&#160;will&#160;use&#160;the&#160;POST<br/>method&#160;and&#160;put&#160;the&#160;query&#160;string&#160;in&#160;the&#160;body&#160;of&#160;the&#160;request,&#160;rather&#160;than&#160;adding<br/>it&#160;to&#160;the&#160;URL.<br/>
POST&#160;/example/message.html&#160;HTTP/1.1<br/>Content-length:&#160;24<br/>Content-type:&#160;application/x-www-form-urlencoded<br/>
name=Jean&amp;message=Yes%3F<br/>
GET&#160;requests&#160;should&#160;be&#160;used&#160;for&#160;requests&#160;that&#160;do&#160;not&#160;have&#160;side&#160;effects&#160;but<br/>
simply&#160;ask&#160;for&#160;information.&#160;Requests&#160;that&#160;change&#160;something&#160;on&#160;the&#160;server,<br/>for&#160;example&#160;creating&#160;a&#160;new&#160;account&#160;or&#160;posting&#160;a&#160;message,&#160;should&#160;be&#160;expressed<br/>with&#160;other&#160;methods,&#160;such&#160;as&#160;POST.&#160;Client-side&#160;software&#160;such&#160;as&#160;a&#160;browser&#160;knows<br/>
311<br/>
<hr/>
<a name=324></a>that&#160;it&#160;shouldn’t&#160;blindly&#160;make&#160;POST&#160;requests&#160;but&#160;will&#160;often&#160;implicitly&#160;make&#160;GET<br/>requests—for&#160;example&#160;to&#160;prefetch&#160;a&#160;resource&#160;it&#160;believes&#160;the&#160;user&#160;will&#160;soon&#160;need.<br/>
We’ll&#160;come&#160;back&#160;to&#160;forms&#160;and&#160;how&#160;to&#160;interact&#160;with&#160;them&#160;from&#160;JavaScript<br/>
<a href="eloquent-javascripts.html#326">later&#160;in&#160;the&#160;chapter.</a><br/>
<b>Fetch</b><br/>
The&#160;interface&#160;through&#160;which&#160;browser&#160;JavaScript&#160;can&#160;make&#160;HTTP&#160;requests&#160;is<br/>called&#160;fetch.&#160;Since&#160;it&#160;is&#160;relatively&#160;new,&#160;it&#160;conveniently&#160;uses&#160;promises&#160;(which&#160;is<br/>rare&#160;for&#160;browser&#160;interfaces).<br/>
fetch(&#34;example/data.txt&#34;).then(response&#160;=&gt;&#160;{<br/>
console.log(response.status);<br/>//&#160;→&#160;200<br/>console.log(response.headers.get(&#34;Content-Type&#34;));<br/>//&#160;→&#160;text/plain<br/>
});<br/>
Calling&#160;fetch&#160;returns&#160;a&#160;promise&#160;that&#160;resolves&#160;to&#160;a&#160;Response&#160;object&#160;holding<br/>
information&#160;about&#160;the&#160;server’s&#160;response,&#160;such&#160;as&#160;its&#160;status&#160;code&#160;and&#160;its&#160;head-<br/>ers.&#160;The&#160;headers&#160;are&#160;wrapped&#160;in&#160;a&#160;Map-like&#160;object&#160;that&#160;treats&#160;its&#160;keys&#160;(the<br/>header&#160;names)&#160;as&#160;case&#160;insensitive&#160;because&#160;header&#160;names&#160;are&#160;not&#160;supposed&#160;to<br/>be&#160;case&#160;sensitive.&#160;This&#160;means&#160;headers.get(&#34;Content-Type&#34;)&#160;and&#160;headers.get<br/>(&#34;content-TYPE&#34;)&#160;will&#160;return&#160;the&#160;same&#160;value.<br/>
Note&#160;that&#160;the&#160;promise&#160;returned&#160;by&#160;fetch&#160;resolves&#160;successfully&#160;even&#160;if&#160;the<br/>
server&#160;responded&#160;with&#160;an&#160;error&#160;code.&#160;It&#160;<i>might&#160;</i>also&#160;be&#160;rejected&#160;if&#160;there&#160;is&#160;a<br/>network&#160;error&#160;or&#160;if&#160;the&#160;server&#160;that&#160;the&#160;request&#160;is&#160;addressed&#160;to&#160;can’t&#160;be&#160;found.<br/>
The&#160;first&#160;argument&#160;to&#160;fetch&#160;is&#160;the&#160;URL&#160;that&#160;should&#160;be&#160;requested.&#160;When<br/>
that&#160;URL&#160;doesn’t&#160;start&#160;with&#160;a&#160;protocol&#160;name&#160;(such&#160;as&#160;<i>http:</i>),&#160;it&#160;is&#160;treated&#160;as<br/><i>relative</i>,&#160;which&#160;means&#160;it&#160;is&#160;interpreted&#160;relative&#160;to&#160;the&#160;current&#160;document.&#160;When<br/>it&#160;starts&#160;with&#160;a&#160;slash&#160;(/),&#160;it&#160;replaces&#160;the&#160;current&#160;path,&#160;which&#160;is&#160;the&#160;part&#160;after<br/>the&#160;server&#160;name.&#160;When&#160;it&#160;does&#160;not,&#160;the&#160;part&#160;of&#160;the&#160;current&#160;path&#160;up&#160;to&#160;and<br/>including&#160;its&#160;last&#160;slash&#160;character&#160;is&#160;put&#160;in&#160;front&#160;of&#160;the&#160;relative&#160;URL.<br/>
To&#160;get&#160;at&#160;the&#160;actual&#160;content&#160;of&#160;a&#160;response,&#160;you&#160;can&#160;use&#160;its&#160;text&#160;method.<br/>
Because&#160;the&#160;initial&#160;promise&#160;is&#160;resolved&#160;as&#160;soon&#160;as&#160;the&#160;response’s&#160;headers&#160;have<br/>been&#160;received&#160;and&#160;because&#160;reading&#160;the&#160;response&#160;body&#160;might&#160;take&#160;a&#160;while&#160;longer,<br/>this&#160;again&#160;returns&#160;a&#160;promise.<br/>
fetch(&#34;example/data.txt&#34;)<br/>
.then(resp&#160;=&gt;&#160;resp.text())<br/>.then(text&#160;=&gt;&#160;console.log(text));<br/>
312<br/>
<hr/>
<a name=325></a>//&#160;→&#160;This&#160;is&#160;the&#160;content&#160;of&#160;data.txt<br/>
A&#160;similar&#160;method,&#160;called&#160;json,&#160;returns&#160;a&#160;promise&#160;that&#160;resolves&#160;to&#160;the&#160;value<br/>
you&#160;get&#160;when&#160;parsing&#160;the&#160;body&#160;as&#160;JSON&#160;or&#160;rejects&#160;if&#160;it’s&#160;not&#160;valid&#160;JSON.<br/>
By&#160;default,&#160;fetch&#160;uses&#160;the&#160;GET&#160;method&#160;to&#160;make&#160;its&#160;request&#160;and&#160;does&#160;not<br/>
include&#160;a&#160;request&#160;body.&#160;You&#160;can&#160;configure&#160;it&#160;differently&#160;by&#160;passing&#160;an&#160;object<br/>with&#160;extra&#160;options&#160;as&#160;a&#160;second&#160;argument.&#160;For&#160;example,&#160;this&#160;request&#160;tries&#160;to<br/>delete&#160;example/data.txt:<br/>
fetch(&#34;example/data.txt&#34;,&#160;{method:&#160;&#34;DELETE&#34;}).then(resp&#160;=&gt;&#160;{<br/>
console.log(resp.status);<br/>//&#160;→&#160;405<br/>
});<br/>
The&#160;405&#160;status&#160;code&#160;means&#160;“method&#160;not&#160;allowed”,&#160;an&#160;HTTP&#160;server’s&#160;way&#160;of<br/>
saying&#160;“I&#160;can’t&#160;do&#160;that”.<br/>
To&#160;add&#160;a&#160;request&#160;body,&#160;you&#160;can&#160;include&#160;a&#160;body&#160;option.&#160;To&#160;set&#160;headers,&#160;there’s<br/>
the&#160;headers&#160;option.&#160;For&#160;example,&#160;this&#160;request&#160;includes&#160;a&#160;Range&#160;header,&#160;which<br/>instructs&#160;the&#160;server&#160;to&#160;return&#160;only&#160;part&#160;of&#160;a&#160;response.<br/>
fetch(&#34;example/data.txt&#34;,&#160;{headers:&#160;{Range:&#160;&#34;bytes=8-19&#34;}})<br/>
.then(resp&#160;=&gt;&#160;resp.text())<br/>.then(console.log);<br/>
//&#160;→&#160;the&#160;content<br/>
The&#160;browser&#160;will&#160;automatically&#160;add&#160;some&#160;request&#160;headers,&#160;such&#160;as&#160;“Host”&#160;and<br/>
those&#160;needed&#160;for&#160;the&#160;server&#160;to&#160;figure&#160;out&#160;the&#160;size&#160;of&#160;the&#160;body.&#160;But&#160;adding&#160;your<br/>own&#160;headers&#160;is&#160;often&#160;useful&#160;to&#160;include&#160;things&#160;such&#160;as&#160;authentication&#160;information<br/>or&#160;to&#160;tell&#160;the&#160;server&#160;which&#160;file&#160;format&#160;you’d&#160;like&#160;to&#160;receive.<br/>
<b>HTTP&#160;sandboxing</b><br/>
Making&#160;HTTP&#160;requests&#160;in&#160;web&#160;page&#160;scripts&#160;once&#160;again&#160;raises&#160;concerns&#160;about<br/>security.&#160;The&#160;person&#160;who&#160;controls&#160;the&#160;script&#160;might&#160;not&#160;have&#160;the&#160;same&#160;interests<br/>as&#160;the&#160;person&#160;on&#160;whose&#160;computer&#160;it&#160;is&#160;running.&#160;More&#160;specifically,&#160;if&#160;I&#160;visit&#160;<i>the-<br/>mafia.org</i>,&#160;I&#160;do&#160;not&#160;want&#160;its&#160;scripts&#160;to&#160;be&#160;able&#160;to&#160;make&#160;a&#160;request&#160;to&#160;<i>mybank.com</i>,<br/>using&#160;identifying&#160;information&#160;from&#160;my&#160;browser,&#160;with&#160;instructions&#160;to&#160;transfer&#160;all<br/>my&#160;money&#160;to&#160;some&#160;random&#160;account.<br/>
For&#160;this&#160;reason,&#160;browsers&#160;protect&#160;us&#160;by&#160;disallowing&#160;scripts&#160;to&#160;make&#160;HTTP<br/>
313<br/>
<hr/>
<a name=326></a>requests&#160;to&#160;other&#160;domains&#160;(names&#160;such&#160;as&#160;<i>themafia.org&#160;</i>and&#160;<i>mybank.com</i>).<br/>
This&#160;can&#160;be&#160;an&#160;annoying&#160;problem&#160;when&#160;building&#160;systems&#160;that&#160;want&#160;to&#160;ac-<br/>
cess&#160;several&#160;domains&#160;for&#160;legitimate&#160;reasons.&#160;Fortunately,&#160;servers&#160;can&#160;include&#160;a<br/>header&#160;like&#160;this&#160;in&#160;their&#160;response&#160;to&#160;explicitly&#160;indicate&#160;to&#160;the&#160;browser&#160;that&#160;it&#160;is<br/>okay&#160;for&#160;the&#160;request&#160;to&#160;come&#160;from&#160;another&#160;domain:<br/>
Access-Control-Allow-Origin:&#160;*<br/>
<b>Appreciating&#160;HTTP</b><br/>
When&#160;building&#160;a&#160;system&#160;that&#160;requires&#160;communication&#160;between&#160;a&#160;JavaScript<br/>program&#160;running&#160;in&#160;the&#160;browser&#160;(client-side)&#160;and&#160;a&#160;program&#160;on&#160;a&#160;server&#160;(server-<br/>side),&#160;there&#160;are&#160;several&#160;different&#160;ways&#160;to&#160;model&#160;this&#160;communication.<br/>
A&#160;commonly&#160;used&#160;model&#160;is&#160;that&#160;of&#160;<i>remote&#160;procedure&#160;calls</i>.&#160;In&#160;this&#160;model,<br/>
communication&#160;follows&#160;the&#160;patterns&#160;of&#160;normal&#160;function&#160;calls,&#160;except&#160;that&#160;the<br/>function&#160;is&#160;actually&#160;running&#160;on&#160;another&#160;machine.&#160;Calling&#160;it&#160;involves&#160;making&#160;a<br/>request&#160;to&#160;the&#160;server&#160;that&#160;includes&#160;the&#160;function’s&#160;name&#160;and&#160;arguments.&#160;The<br/>response&#160;to&#160;that&#160;request&#160;contains&#160;the&#160;returned&#160;value.<br/>
When&#160;thinking&#160;in&#160;terms&#160;of&#160;remote&#160;procedure&#160;calls,&#160;HTTP&#160;is&#160;just&#160;a&#160;vehicle&#160;for<br/>
communication,&#160;and&#160;you&#160;will&#160;most&#160;likely&#160;write&#160;an&#160;abstraction&#160;layer&#160;that&#160;hides<br/>it&#160;entirely.<br/>
Another&#160;approach&#160;is&#160;to&#160;build&#160;your&#160;communication&#160;around&#160;the&#160;concept&#160;of<br/>
resources&#160;and&#160;HTTP&#160;methods.&#160;Instead&#160;of&#160;a&#160;remote&#160;procedure&#160;called&#160;addUser,<br/>you&#160;use&#160;a&#160;PUT&#160;request&#160;to&#160;/users/larry.&#160;Instead&#160;of&#160;encoding&#160;that&#160;user’s&#160;prop-<br/>erties&#160;in&#160;function&#160;arguments,&#160;you&#160;define&#160;a&#160;JSON&#160;document&#160;format&#160;(or&#160;use&#160;an<br/>existing&#160;format)&#160;that&#160;represents&#160;a&#160;user.&#160;The&#160;body&#160;of&#160;the&#160;PUT&#160;request&#160;to&#160;create<br/>a&#160;new&#160;resource&#160;is&#160;then&#160;such&#160;a&#160;document.&#160;A&#160;resource&#160;is&#160;fetched&#160;by&#160;making&#160;a&#160;GET<br/>request&#160;to&#160;the&#160;resource’s&#160;URL&#160;(for&#160;example,&#160;/user/larry),&#160;which&#160;again&#160;returns<br/>the&#160;document&#160;representing&#160;the&#160;resource.<br/>
This&#160;second&#160;approach&#160;makes&#160;it&#160;easier&#160;to&#160;use&#160;some&#160;of&#160;the&#160;features&#160;that&#160;HTTP<br/>
provides,&#160;such&#160;as&#160;support&#160;for&#160;caching&#160;resources&#160;(keeping&#160;a&#160;copy&#160;on&#160;the&#160;client&#160;for<br/>fast&#160;access).&#160;The&#160;concepts&#160;used&#160;in&#160;HTTP,&#160;which&#160;are&#160;well&#160;designed,&#160;can&#160;provide<br/>a&#160;helpful&#160;set&#160;of&#160;principles&#160;to&#160;design&#160;your&#160;server&#160;interface&#160;around.<br/>
<b>Security&#160;and&#160;HTTPS</b><br/>
Data&#160;traveling&#160;over&#160;the&#160;Internet&#160;tends&#160;to&#160;follow&#160;a&#160;long,&#160;dangerous&#160;road.&#160;To<br/>get&#160;to&#160;its&#160;destination,&#160;it&#160;must&#160;hop&#160;through&#160;anything&#160;from&#160;coffee&#160;shop&#160;Wi-Fi<br/>
314<br/>
<hr/>
<a name=327></a>hotspots&#160;to&#160;networks&#160;controlled&#160;by&#160;various&#160;companies&#160;and&#160;states.&#160;At&#160;any&#160;point<br/>along&#160;its&#160;route&#160;it&#160;may&#160;be&#160;inspected&#160;or&#160;even&#160;modified.<br/>
If&#160;it&#160;is&#160;important&#160;that&#160;something&#160;remain&#160;secret,&#160;such&#160;as&#160;the&#160;password&#160;to<br/>
your&#160;email&#160;account,&#160;or&#160;that&#160;it&#160;arrive&#160;at&#160;its&#160;destination&#160;unmodified,&#160;such&#160;as&#160;the<br/>account&#160;number&#160;you&#160;transfer&#160;money&#160;to&#160;via&#160;your&#160;bank’s&#160;website,&#160;plain&#160;HTTP<br/>is&#160;not&#160;good&#160;enough.<br/>
The&#160;secure&#160;HTTP&#160;protocol,&#160;used&#160;for&#160;URLs&#160;starting&#160;with&#160;<i>https://</i>,&#160;wraps<br/>
HTTP&#160;traffic&#160;in&#160;a&#160;way&#160;that&#160;makes&#160;it&#160;harder&#160;to&#160;read&#160;and&#160;tamper&#160;with.&#160;Before<br/>exchanging&#160;data,&#160;the&#160;client&#160;verifies&#160;that&#160;the&#160;server&#160;is&#160;who&#160;it&#160;claims&#160;to&#160;be&#160;by<br/>asking&#160;it&#160;to&#160;prove&#160;that&#160;it&#160;has&#160;a&#160;cryptographic&#160;certificate&#160;issued&#160;by&#160;a&#160;certificate<br/>authority&#160;that&#160;the&#160;browser&#160;recognizes.&#160;Next,&#160;all&#160;data&#160;going&#160;over&#160;the&#160;connection<br/>is&#160;encrypted&#160;in&#160;a&#160;way&#160;that&#160;should&#160;prevent&#160;eavesdropping&#160;and&#160;tampering.<br/>
Thus,&#160;when&#160;it&#160;works&#160;right,&#160;HTTPS&#160;prevents&#160;other&#160;people&#160;from&#160;impersonating<br/>
the&#160;website&#160;you&#160;are&#160;trying&#160;to&#160;talk&#160;to&#160;and&#160;from&#160;snooping&#160;on&#160;your&#160;communication.<br/>It&#160;is&#160;not&#160;perfect,&#160;and&#160;there&#160;have&#160;been&#160;various&#160;incidents&#160;where&#160;HTTPS&#160;failed<br/>because&#160;of&#160;forged&#160;or&#160;stolen&#160;certificates&#160;and&#160;broken&#160;software,&#160;but&#160;it&#160;is&#160;a&#160;<i>lot&#160;</i>safer<br/>than&#160;plain&#160;HTTP.<br/>
<b>Form&#160;fields</b><br/>
Forms&#160;were&#160;originally&#160;designed&#160;for&#160;the&#160;pre-JavaScript&#160;Web&#160;to&#160;allow&#160;web&#160;sites<br/>to&#160;send&#160;user-submitted&#160;information&#160;in&#160;an&#160;HTTP&#160;request.&#160;This&#160;design&#160;assumes<br/>that&#160;interaction&#160;with&#160;the&#160;server&#160;always&#160;happens&#160;by&#160;navigating&#160;to&#160;a&#160;new&#160;page.<br/>
But&#160;their&#160;elements&#160;are&#160;part&#160;of&#160;the&#160;DOM&#160;like&#160;the&#160;rest&#160;of&#160;the&#160;page,&#160;and&#160;the<br/>
DOM&#160;elements&#160;that&#160;represent&#160;form&#160;fields&#160;support&#160;a&#160;number&#160;of&#160;properties&#160;and<br/>events&#160;that&#160;are&#160;not&#160;present&#160;on&#160;other&#160;elements.&#160;These&#160;make&#160;it&#160;possible&#160;to&#160;inspect<br/>and&#160;control&#160;such&#160;input&#160;fields&#160;with&#160;JavaScript&#160;programs&#160;and&#160;do&#160;things&#160;such&#160;as<br/>adding&#160;new&#160;functionality&#160;to&#160;a&#160;form&#160;or&#160;using&#160;forms&#160;and&#160;fields&#160;as&#160;building&#160;blocks<br/>in&#160;a&#160;JavaScript&#160;application.<br/>
A&#160;web&#160;form&#160;consists&#160;of&#160;any&#160;number&#160;of&#160;input&#160;fields&#160;grouped&#160;in&#160;a&#160;&lt;form&gt;<br/>
tag.&#160;HTML&#160;allows&#160;several&#160;different&#160;styles&#160;of&#160;fields,&#160;ranging&#160;from&#160;simple&#160;on/off<br/>checkboxes&#160;to&#160;drop-down&#160;menus&#160;and&#160;fields&#160;for&#160;text&#160;input.&#160;This&#160;book&#160;won’t&#160;try<br/>to&#160;comprehensively&#160;discuss&#160;all&#160;field&#160;types,&#160;but&#160;we’ll&#160;start&#160;with&#160;a&#160;rough&#160;overview.<br/>
A&#160;lot&#160;of&#160;field&#160;types&#160;use&#160;the&#160;&lt;input&gt;&#160;tag.&#160;This&#160;tag’s&#160;type&#160;attribute&#160;is&#160;used&#160;to<br/>
select&#160;the&#160;field’s&#160;style.&#160;These&#160;are&#160;some&#160;commonly&#160;used&#160;&lt;input&gt;&#160;types:<br/>
315<br/>
<hr/>
<a name=328></a><img src="eloquent-javascript-328_1.png"/><br/>
text<br/>
A&#160;single-line&#160;text&#160;field<br/>
password<br/>
Same&#160;as&#160;text&#160;but&#160;hides&#160;the&#160;text&#160;that&#160;is&#160;typed<br/>
checkbox<br/>
An&#160;on/off&#160;switch<br/>
radio<br/>
(Part&#160;of)&#160;a&#160;multiple-choice&#160;field<br/>
file<br/>
Allows&#160;the&#160;user&#160;to&#160;choose&#160;a&#160;file&#160;from&#160;their&#160;computer<br/>
Form&#160;fields&#160;do&#160;not&#160;necessarily&#160;have&#160;to&#160;appear&#160;in&#160;a&#160;&lt;form&gt;&#160;tag.&#160;You&#160;can&#160;put<br/>
them&#160;anywhere&#160;in&#160;a&#160;page.&#160;Such&#160;form-less&#160;fields&#160;cannot&#160;be&#160;submitted&#160;(only&#160;a<br/>form&#160;as&#160;a&#160;whole&#160;can),&#160;but&#160;when&#160;responding&#160;to&#160;input&#160;with&#160;JavaScript,&#160;we&#160;often<br/>don’t&#160;want&#160;to&#160;submit&#160;our&#160;fields&#160;normally&#160;anyway.<br/>
&lt;p&gt;&lt;input&#160;type=&#34;text&#34;&#160;value=&#34;abc&#34;&gt;&#160;(text)&lt;/p&gt;<br/>&lt;p&gt;&lt;input&#160;type=&#34;password&#34;&#160;value=&#34;abc&#34;&gt;&#160;(password)&lt;/p&gt;<br/>&lt;p&gt;&lt;input&#160;type=&#34;checkbox&#34;&#160;checked&gt;&#160;(checkbox)&lt;/p&gt;<br/>&lt;p&gt;&lt;input&#160;type=&#34;radio&#34;&#160;value=&#34;A&#34;&#160;name=&#34;choice&#34;&gt;<br/>
&lt;input&#160;type=&#34;radio&#34;&#160;value=&#34;B&#34;&#160;name=&#34;choice&#34;&#160;checked&gt;<br/>&lt;input&#160;type=&#34;radio&#34;&#160;value=&#34;C&#34;&#160;name=&#34;choice&#34;&gt;&#160;(radio)&lt;/p&gt;<br/>
&lt;p&gt;&lt;input&#160;type=&#34;file&#34;&gt;&#160;(file)&lt;/p&gt;<br/>
The&#160;fields&#160;created&#160;with&#160;this&#160;HTML&#160;code&#160;look&#160;like&#160;this:<br/>
The&#160;JavaScript&#160;interface&#160;for&#160;such&#160;elements&#160;differs&#160;with&#160;the&#160;type&#160;of&#160;the&#160;ele-<br/>
ment.<br/>
Multiline&#160;text&#160;fields&#160;have&#160;their&#160;own&#160;tag,&#160;&lt;textarea&gt;,&#160;mostly&#160;because&#160;using<br/>
an&#160;attribute&#160;to&#160;specify&#160;a&#160;multiline&#160;starting&#160;value&#160;would&#160;be&#160;awkward.&#160;The&#160;&lt;<br/>textarea&gt;&#160;tag&#160;requires&#160;a&#160;matching&#160;&lt;/textarea&gt;&#160;closing&#160;tag&#160;and&#160;uses&#160;the&#160;text<br/>between&#160;those&#160;two,&#160;instead&#160;of&#160;the&#160;value&#160;attribute,&#160;as&#160;starting&#160;text.<br/>
&lt;textarea&gt;<br/>one<br/>two<br/>three<br/>&lt;/textarea&gt;<br/>
Finally,&#160;the&#160;&lt;select&gt;&#160;tag&#160;is&#160;used&#160;to&#160;create&#160;a&#160;field&#160;that&#160;allows&#160;the&#160;user&#160;to<br/>
select&#160;from&#160;a&#160;number&#160;of&#160;predefined&#160;options.<br/>
316<br/>
<hr/>
<a name=329></a><img src="eloquent-javascript-329_1.png"/><br/>
&lt;select&gt;<br/>
&lt;option&gt;Pancakes&lt;/option&gt;<br/>&lt;option&gt;Pudding&lt;/option&gt;<br/>&lt;option&gt;Ice&#160;cream&lt;/option&gt;<br/>
&lt;/select&gt;<br/>
Such&#160;a&#160;field&#160;looks&#160;like&#160;this:<br/>
Whenever&#160;the&#160;value&#160;of&#160;a&#160;form&#160;field&#160;changes,&#160;it&#160;will&#160;fire&#160;a&#160;&#34;change&#34;&#160;event.<br/>
<b>Focus</b><br/>
Unlike&#160;most&#160;elements&#160;in&#160;HTML&#160;documents,&#160;form&#160;fields&#160;can&#160;get&#160;<i>keyboard&#160;focus</i>.<br/>When&#160;clicked&#160;or&#160;activated&#160;in&#160;some&#160;other&#160;way,&#160;they&#160;become&#160;the&#160;currently&#160;active<br/>element&#160;and&#160;the&#160;recipient&#160;of&#160;keyboard&#160;input.<br/>
Thus,&#160;you&#160;can&#160;type&#160;into&#160;a&#160;text&#160;field&#160;only&#160;when&#160;it&#160;is&#160;focused.&#160;Other&#160;fields<br/>
respond&#160;differently&#160;to&#160;keyboard&#160;events.&#160;For&#160;example,&#160;a&#160;&lt;select&gt;&#160;menu&#160;tries&#160;to<br/>move&#160;to&#160;the&#160;option&#160;that&#160;contains&#160;the&#160;text&#160;the&#160;user&#160;typed&#160;and&#160;responds&#160;to&#160;the<br/>arrow&#160;keys&#160;by&#160;moving&#160;its&#160;selection&#160;up&#160;and&#160;down.<br/>
We&#160;can&#160;control&#160;focus&#160;from&#160;JavaScript&#160;with&#160;the&#160;focus&#160;and&#160;blur&#160;methods.&#160;The<br/>
first&#160;moves&#160;focus&#160;to&#160;the&#160;DOM&#160;element&#160;it&#160;is&#160;called&#160;on,&#160;and&#160;the&#160;second&#160;removes<br/>focus.&#160;The&#160;value&#160;in&#160;document.activeElement&#160;corresponds&#160;to&#160;the&#160;currently&#160;fo-<br/>cused&#160;element.<br/>
&lt;input&#160;type=&#34;text&#34;&gt;<br/>&lt;script&gt;<br/>
document.querySelector(&#34;input&#34;).focus();<br/>console.log(document.activeElement.tagName);<br/>//&#160;→&#160;INPUT<br/>document.querySelector(&#34;input&#34;).blur();<br/>console.log(document.activeElement.tagName);<br/>//&#160;→&#160;BODY<br/>
&lt;/script&gt;<br/>
For&#160;some&#160;pages,&#160;the&#160;user&#160;is&#160;expected&#160;to&#160;want&#160;to&#160;interact&#160;with&#160;a&#160;form&#160;field<br/>
immediately.&#160;JavaScript&#160;can&#160;be&#160;used&#160;to&#160;focus&#160;this&#160;field&#160;when&#160;the&#160;document&#160;is<br/>loaded,&#160;but&#160;HTML&#160;also&#160;provides&#160;the&#160;autofocus&#160;attribute,&#160;which&#160;produces&#160;the<br/>same&#160;effect&#160;while&#160;letting&#160;the&#160;browser&#160;know&#160;what&#160;we&#160;are&#160;trying&#160;to&#160;achieve.&#160;This<br/>
317<br/>
<hr/>
<a name=330></a><img src="eloquent-javascript-330_1.png"/><br/>
gives&#160;the&#160;browser&#160;the&#160;option&#160;to&#160;disable&#160;the&#160;behavior&#160;when&#160;it&#160;is&#160;not&#160;appropriate,<br/>such&#160;as&#160;when&#160;the&#160;user&#160;has&#160;put&#160;the&#160;focus&#160;on&#160;something&#160;else.<br/>
Browsers&#160;traditionally&#160;also&#160;allow&#160;the&#160;user&#160;to&#160;move&#160;the&#160;focus&#160;through&#160;the&#160;doc-<br/>
ument&#160;by&#160;pressing&#160;the&#160;tab&#160;key.&#160;We&#160;can&#160;influence&#160;the&#160;order&#160;in&#160;which&#160;elements<br/>receive&#160;focus&#160;with&#160;the&#160;tabindex&#160;attribute.&#160;The&#160;following&#160;example&#160;document<br/>will&#160;let&#160;the&#160;focus&#160;jump&#160;from&#160;the&#160;text&#160;input&#160;to&#160;the&#160;OK&#160;button,&#160;rather&#160;than<br/>going&#160;through&#160;the&#160;help&#160;link&#160;first:<br/>
&lt;input&#160;type=&#34;text&#34;&#160;tabindex=1&gt;&#160;&lt;a&#160;href=&#34;.&#34;&gt;(help)&lt;/a&gt;<br/>&lt;button&#160;onclick=&#34;console.log('ok')&#34;&#160;tabindex=2&gt;OK&lt;/button&gt;<br/>
By&#160;default,&#160;most&#160;types&#160;of&#160;HTML&#160;elements&#160;cannot&#160;be&#160;focused.&#160;But&#160;you&#160;can<br/>
add&#160;a&#160;tabindex&#160;attribute&#160;to&#160;any&#160;element&#160;that&#160;will&#160;make&#160;it&#160;focusable.&#160;A&#160;tabindex<br/>of&#160;-1&#160;makes&#160;tabbing&#160;skip&#160;over&#160;an&#160;element,&#160;even&#160;if&#160;it&#160;is&#160;normally&#160;focusable.<br/>
<b>Disabled&#160;fields</b><br/>
All&#160;form&#160;fields&#160;can&#160;be&#160;<i>disabled&#160;</i>through&#160;their&#160;disabled&#160;attribute.&#160;It&#160;is&#160;an&#160;at-<br/>tribute&#160;that&#160;can&#160;be&#160;specified&#160;without&#160;value—the&#160;fact&#160;that&#160;it&#160;is&#160;present&#160;at&#160;all<br/>disables&#160;the&#160;element.<br/>
&lt;button&gt;I'm&#160;all&#160;right&lt;/button&gt;<br/>&lt;button&#160;disabled&gt;I'm&#160;out&lt;/button&gt;<br/>
Disabled&#160;fields&#160;cannot&#160;be&#160;focused&#160;or&#160;changed,&#160;and&#160;browsers&#160;make&#160;them&#160;look<br/>
gray&#160;and&#160;faded.<br/>
When&#160;a&#160;program&#160;is&#160;in&#160;the&#160;process&#160;of&#160;handling&#160;an&#160;action&#160;caused&#160;by&#160;some<br/>
button&#160;or&#160;other&#160;control&#160;that&#160;might&#160;require&#160;communication&#160;with&#160;the&#160;server&#160;and<br/>thus&#160;take&#160;a&#160;while,&#160;it&#160;can&#160;be&#160;a&#160;good&#160;idea&#160;to&#160;disable&#160;the&#160;control&#160;until&#160;the&#160;action<br/>finishes.&#160;That&#160;way,&#160;when&#160;the&#160;user&#160;gets&#160;impatient&#160;and&#160;clicks&#160;it&#160;again,&#160;they&#160;don’t<br/>accidentally&#160;repeat&#160;their&#160;action.<br/>
<b>The&#160;form&#160;as&#160;a&#160;whole</b><br/>
When&#160;a&#160;field&#160;is&#160;contained&#160;in&#160;a&#160;&lt;form&gt;&#160;element,&#160;its&#160;DOM&#160;element&#160;will&#160;have&#160;a<br/>form&#160;property&#160;linking&#160;back&#160;to&#160;the&#160;form’s&#160;DOM&#160;element.&#160;The&#160;&lt;form&gt;&#160;element,<br/>
318<br/>
<hr/>
<a name=331></a>in&#160;turn,&#160;has&#160;a&#160;property&#160;called&#160;elements&#160;that&#160;contains&#160;an&#160;array-like&#160;collection<br/>of&#160;the&#160;fields&#160;inside&#160;it.<br/>
The&#160;name&#160;attribute&#160;of&#160;a&#160;form&#160;field&#160;determines&#160;the&#160;way&#160;its&#160;value&#160;will&#160;be&#160;identi-<br/>
fied&#160;when&#160;the&#160;form&#160;is&#160;submitted.&#160;It&#160;can&#160;also&#160;be&#160;used&#160;as&#160;a&#160;property&#160;name&#160;when<br/>accessing&#160;the&#160;form’s&#160;elements&#160;property,&#160;which&#160;acts&#160;both&#160;as&#160;an&#160;array-like&#160;object<br/>(accessible&#160;by&#160;number)&#160;and&#160;a&#160;map&#160;(accessible&#160;by&#160;name).<br/>
&lt;form&#160;action=&#34;example/submit.html&#34;&gt;<br/>
Name:&#160;&lt;input&#160;type=&#34;text&#34;&#160;name=&#34;name&#34;&gt;&lt;br&gt;<br/>Password:&#160;&lt;input&#160;type=&#34;password&#34;&#160;name=&#34;password&#34;&gt;&lt;br&gt;<br/>&lt;button&#160;type=&#34;submit&#34;&gt;Log&#160;in&lt;/button&gt;<br/>
&lt;/form&gt;<br/>&lt;script&gt;<br/>
let&#160;form&#160;=&#160;document.querySelector(&#34;form&#34;);<br/>console.log(form.elements[1].type);<br/>//&#160;→&#160;password<br/>console.log(form.elements.password.type);<br/>//&#160;→&#160;password<br/>console.log(form.elements.name.form&#160;==&#160;form);<br/>//&#160;→&#160;true<br/>
&lt;/script&gt;<br/>
A&#160;button&#160;with&#160;a&#160;type&#160;attribute&#160;of&#160;submit&#160;will,&#160;when&#160;pressed,&#160;cause&#160;the&#160;form<br/>
to&#160;be&#160;submitted.&#160;Pressing&#160;enter&#160;when&#160;a&#160;form&#160;field&#160;is&#160;focused&#160;has&#160;the&#160;same<br/>effect.<br/>
Submitting&#160;a&#160;form&#160;normally&#160;means&#160;that&#160;the&#160;browser&#160;navigates&#160;to&#160;the&#160;page<br/>
indicated&#160;by&#160;the&#160;form’s&#160;action&#160;attribute,&#160;using&#160;either&#160;a&#160;GET&#160;or&#160;a&#160;POST&#160;request.<br/>But&#160;before&#160;that&#160;happens,&#160;a&#160;&#34;submit&#34;&#160;event&#160;is&#160;fired.&#160;You&#160;can&#160;handle&#160;this&#160;event<br/>with&#160;JavaScript&#160;and&#160;prevent&#160;this&#160;default&#160;behavior&#160;by&#160;calling&#160;preventDefault<br/>on&#160;the&#160;event&#160;object.<br/>
&lt;form&#160;action=&#34;example/submit.html&#34;&gt;<br/>
Value:&#160;&lt;input&#160;type=&#34;text&#34;&#160;name=&#34;value&#34;&gt;<br/>&lt;button&#160;type=&#34;submit&#34;&gt;Save&lt;/button&gt;<br/>
&lt;/form&gt;<br/>&lt;script&gt;<br/>
let&#160;form&#160;=&#160;document.querySelector(&#34;form&#34;);<br/>form.addEventListener(&#34;submit&#34;,&#160;event&#160;=&gt;&#160;{<br/>
console.log(&#34;Saving&#160;value&#34;,&#160;form.elements.value.value);<br/>event.preventDefault();<br/>
});<br/>
&lt;/script&gt;<br/>
319<br/>
<hr/>
<a name=332></a>Intercepting&#160;&#34;submit&#34;&#160;events&#160;in&#160;JavaScript&#160;has&#160;various&#160;uses.&#160;We&#160;can&#160;write<br/>
code&#160;to&#160;verify&#160;that&#160;the&#160;values&#160;the&#160;user&#160;entered&#160;make&#160;sense&#160;and&#160;immediately<br/>show&#160;an&#160;error&#160;message&#160;instead&#160;of&#160;submitting&#160;the&#160;form.&#160;Or&#160;we&#160;can&#160;disable&#160;the<br/>regular&#160;way&#160;of&#160;submitting&#160;the&#160;form&#160;entirely,&#160;as&#160;in&#160;the&#160;example,&#160;and&#160;have&#160;our<br/>program&#160;handle&#160;the&#160;input,&#160;possibly&#160;using&#160;fetch&#160;to&#160;send&#160;it&#160;to&#160;a&#160;server&#160;without<br/>reloading&#160;the&#160;page.<br/>
<b>Text&#160;fields</b><br/>
Fields&#160;created&#160;by&#160;&lt;textarea&gt;&#160;tags,&#160;or&#160;&lt;input&gt;&#160;tags&#160;with&#160;a&#160;type&#160;of&#160;text&#160;or<br/>password,&#160;share&#160;a&#160;common&#160;interface.&#160;Their&#160;DOM&#160;elements&#160;have&#160;a&#160;value&#160;prop-<br/>erty&#160;that&#160;holds&#160;their&#160;current&#160;content&#160;as&#160;a&#160;string&#160;value.&#160;Setting&#160;this&#160;property&#160;to<br/>another&#160;string&#160;changes&#160;the&#160;field’s&#160;content.<br/>
The&#160;selectionStart&#160;and&#160;selectionEnd&#160;properties&#160;of&#160;text&#160;fields&#160;give&#160;us&#160;infor-<br/>
mation&#160;about&#160;the&#160;cursor&#160;and&#160;selection&#160;in&#160;the&#160;text.&#160;When&#160;nothing&#160;is&#160;selected,<br/>these&#160;two&#160;properties&#160;hold&#160;the&#160;same&#160;number,&#160;indicating&#160;the&#160;position&#160;of&#160;the&#160;cur-<br/>sor.&#160;For&#160;example,&#160;0&#160;indicates&#160;the&#160;start&#160;of&#160;the&#160;text,&#160;and&#160;10&#160;indicates&#160;the&#160;cursor<br/>is&#160;after&#160;the&#160;10th&#160;character.&#160;When&#160;part&#160;of&#160;the&#160;field&#160;is&#160;selected,&#160;the&#160;two&#160;properties<br/>will&#160;differ,&#160;giving&#160;us&#160;the&#160;start&#160;and&#160;end&#160;of&#160;the&#160;selected&#160;text.&#160;Like&#160;value,&#160;these<br/>properties&#160;may&#160;also&#160;be&#160;written&#160;to.<br/>
Imagine&#160;you&#160;are&#160;writing&#160;an&#160;article&#160;about&#160;Khasekhemwy&#160;but&#160;have&#160;some&#160;trou-<br/>
ble&#160;spelling&#160;his&#160;name.&#160;The&#160;following&#160;code&#160;wires&#160;up&#160;a&#160;&lt;textarea&gt;&#160;tag&#160;with&#160;an<br/>event&#160;handler&#160;that,&#160;when&#160;you&#160;press&#160;F2,&#160;inserts&#160;the&#160;string&#160;“Khasekhemwy”&#160;for<br/>you.<br/>
&lt;textarea&gt;&lt;/textarea&gt;<br/>&lt;script&gt;<br/>
let&#160;textarea&#160;=&#160;document.querySelector(&#34;textarea&#34;);<br/>textarea.addEventListener(&#34;keydown&#34;,&#160;event&#160;=&gt;&#160;{<br/>
//&#160;The&#160;key&#160;code&#160;for&#160;F2&#160;happens&#160;to&#160;be&#160;113<br/>if&#160;(event.keyCode&#160;==&#160;113)&#160;{<br/>
replaceSelection(textarea,&#160;&#34;Khasekhemwy&#34;);<br/>event.preventDefault();<br/>
}<br/>
});<br/>function&#160;replaceSelection(field,&#160;word)&#160;{<br/>
let&#160;from&#160;=&#160;field.selectionStart,&#160;to&#160;=&#160;field.selectionEnd;<br/>field.value&#160;=&#160;field.value.slice(0,&#160;from)&#160;+&#160;word&#160;+<br/>
field.value.slice(to);<br/>
//&#160;Put&#160;the&#160;cursor&#160;after&#160;the&#160;word<br/>field.selectionStart&#160;=&#160;from&#160;+&#160;word.length;<br/>field.selectionEnd&#160;=&#160;from&#160;+&#160;word.length;<br/>
320<br/>
<hr/>
<a name=333></a>}<br/>
&lt;/script&gt;<br/>
The&#160;replaceSelection&#160;function&#160;replaces&#160;the&#160;currently&#160;selected&#160;part&#160;of&#160;a&#160;text<br/>
field’s&#160;content&#160;with&#160;the&#160;given&#160;word&#160;and&#160;then&#160;moves&#160;the&#160;cursor&#160;after&#160;that&#160;word<br/>so&#160;that&#160;the&#160;user&#160;can&#160;continue&#160;typing.<br/>
The&#160;&#34;change&#34;&#160;event&#160;for&#160;a&#160;text&#160;field&#160;does&#160;not&#160;fire&#160;every&#160;time&#160;something&#160;is<br/>
typed.&#160;Rather,&#160;it&#160;fires&#160;when&#160;the&#160;field&#160;loses&#160;focus&#160;after&#160;its&#160;content&#160;was&#160;changed.<br/>To&#160;respond&#160;immediately&#160;to&#160;changes&#160;in&#160;a&#160;text&#160;field,&#160;you&#160;should&#160;register&#160;a&#160;han-<br/>dler&#160;for&#160;the&#160;&#34;input&#34;&#160;event&#160;instead,&#160;which&#160;fires&#160;for&#160;every&#160;time&#160;the&#160;user&#160;types&#160;a<br/>character,&#160;deletes&#160;text,&#160;or&#160;otherwise&#160;manipulates&#160;the&#160;field’s&#160;content.<br/>
The&#160;following&#160;example&#160;shows&#160;a&#160;text&#160;field&#160;and&#160;a&#160;counter&#160;displaying&#160;the&#160;current<br/>
length&#160;of&#160;the&#160;text&#160;in&#160;the&#160;field:<br/>
&lt;input&#160;type=&#34;text&#34;&gt;&#160;length:&#160;&lt;span&#160;id=&#34;length&#34;&gt;0&lt;/span&gt;<br/>&lt;script&gt;<br/>
let&#160;text&#160;=&#160;document.querySelector(&#34;input&#34;);<br/>let&#160;output&#160;=&#160;document.querySelector(&#34;#length&#34;);<br/>text.addEventListener(&#34;input&#34;,&#160;()&#160;=&gt;&#160;{<br/>
output.textContent&#160;=&#160;text.value.length;<br/>
});<br/>
&lt;/script&gt;<br/>
<b>Checkboxes&#160;and&#160;radio&#160;buttons</b><br/>
A&#160;checkbox&#160;field&#160;is&#160;a&#160;binary&#160;toggle.&#160;Its&#160;value&#160;can&#160;be&#160;extracted&#160;or&#160;changed<br/>through&#160;its&#160;checked&#160;property,&#160;which&#160;holds&#160;a&#160;Boolean&#160;value.<br/>
&lt;label&gt;<br/>
&lt;input&#160;type=&#34;checkbox&#34;&#160;id=&#34;purple&#34;&gt;&#160;Make&#160;this&#160;page&#160;purple<br/>
&lt;/label&gt;<br/>&lt;script&gt;<br/>
let&#160;checkbox&#160;=&#160;document.querySelector(&#34;#purple&#34;);<br/>checkbox.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
document.body.style.background&#160;=<br/>
checkbox.checked&#160;?&#160;&#34;mediumpurple&#34;&#160;:&#160;&#34;&#34;;<br/>
});<br/>
&lt;/script&gt;<br/>
The&#160;&lt;label&gt;&#160;tag&#160;associates&#160;a&#160;piece&#160;of&#160;document&#160;with&#160;an&#160;input&#160;field.&#160;Clicking<br/>
321<br/>
<hr/>
<a name=334></a>anywhere&#160;on&#160;the&#160;label&#160;will&#160;activate&#160;the&#160;field,&#160;which&#160;focuses&#160;it&#160;and&#160;toggles&#160;its<br/>value&#160;when&#160;it&#160;is&#160;a&#160;checkbox&#160;or&#160;radio&#160;button.<br/>
A&#160;radio&#160;button&#160;is&#160;similar&#160;to&#160;a&#160;checkbox,&#160;but&#160;it’s&#160;implicitly&#160;linked&#160;to&#160;other<br/>
radio&#160;buttons&#160;with&#160;the&#160;same&#160;name&#160;attribute&#160;so&#160;that&#160;only&#160;one&#160;of&#160;them&#160;can&#160;be<br/>active&#160;at&#160;any&#160;time.<br/>
Color:<br/>&lt;label&gt;<br/>
&lt;input&#160;type=&#34;radio&#34;&#160;name=&#34;color&#34;&#160;value=&#34;orange&#34;&gt;&#160;Orange<br/>
&lt;/label&gt;<br/>&lt;label&gt;<br/>
&lt;input&#160;type=&#34;radio&#34;&#160;name=&#34;color&#34;&#160;value=&#34;lightgreen&#34;&gt;&#160;Green<br/>
&lt;/label&gt;<br/>&lt;label&gt;<br/>
&lt;input&#160;type=&#34;radio&#34;&#160;name=&#34;color&#34;&#160;value=&#34;lightblue&#34;&gt;&#160;Blue<br/>
&lt;/label&gt;<br/>&lt;script&gt;<br/>
let&#160;buttons&#160;=&#160;document.querySelectorAll(&#34;[name=color]&#34;);<br/>for&#160;(let&#160;button&#160;of&#160;Array.from(buttons))&#160;{<br/>
button.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
document.body.style.background&#160;=&#160;button.value;<br/>
});<br/>
}<br/>
&lt;/script&gt;<br/>
The&#160;square&#160;brackets&#160;in&#160;the&#160;CSS&#160;query&#160;given&#160;to&#160;querySelectorAll&#160;are&#160;used<br/>
to&#160;match&#160;attributes.&#160;It&#160;selects&#160;elements&#160;whose&#160;name&#160;attribute&#160;is&#160;&#34;color&#34;.<br/>
<b>Select&#160;fields</b><br/>
Select&#160;fields&#160;are&#160;conceptually&#160;similar&#160;to&#160;radio&#160;buttons—they&#160;also&#160;allow&#160;the&#160;user<br/>to&#160;choose&#160;from&#160;a&#160;set&#160;of&#160;options.&#160;But&#160;where&#160;a&#160;radio&#160;button&#160;puts&#160;the&#160;layout&#160;of<br/>the&#160;options&#160;under&#160;our&#160;control,&#160;the&#160;appearance&#160;of&#160;a&#160;&lt;select&gt;&#160;tag&#160;is&#160;determined<br/>by&#160;the&#160;browser.<br/>
Select&#160;fields&#160;also&#160;have&#160;a&#160;variant&#160;that&#160;is&#160;more&#160;akin&#160;to&#160;a&#160;list&#160;of&#160;checkboxes,<br/>
rather&#160;than&#160;radio&#160;boxes.&#160;When&#160;given&#160;the&#160;multiple&#160;attribute,&#160;a&#160;&lt;select&gt;&#160;tag<br/>will&#160;allow&#160;the&#160;user&#160;to&#160;select&#160;any&#160;number&#160;of&#160;options,&#160;rather&#160;than&#160;just&#160;a&#160;single<br/>option.&#160;This&#160;will,&#160;in&#160;most&#160;browsers,&#160;show&#160;up&#160;differently&#160;than&#160;a&#160;normal&#160;select<br/>field,&#160;which&#160;is&#160;typically&#160;drawn&#160;as&#160;a&#160;<i>drop-down&#160;</i>control&#160;that&#160;shows&#160;the&#160;options<br/>only&#160;when&#160;you&#160;open&#160;it.<br/>
Each&#160;&lt;option&gt;&#160;tag&#160;has&#160;a&#160;value.&#160;This&#160;value&#160;can&#160;be&#160;defined&#160;with&#160;a&#160;value<br/>
attribute.&#160;When&#160;that&#160;is&#160;not&#160;given,&#160;the&#160;text&#160;inside&#160;the&#160;option&#160;will&#160;count&#160;as&#160;its<br/>
322<br/>
<hr/>
<a name=335></a>value.&#160;The&#160;value&#160;property&#160;of&#160;a&#160;&lt;select&gt;&#160;element&#160;reflects&#160;the&#160;currently&#160;selected<br/>option.&#160;For&#160;a&#160;multiple&#160;field,&#160;though,&#160;this&#160;property&#160;doesn’t&#160;mean&#160;much&#160;since&#160;it<br/>will&#160;give&#160;the&#160;value&#160;of&#160;only&#160;<i>one&#160;</i>of&#160;the&#160;currently&#160;selected&#160;options.<br/>
The&#160;&lt;option&gt;&#160;tags&#160;for&#160;a&#160;&lt;select&gt;&#160;field&#160;can&#160;be&#160;accessed&#160;as&#160;an&#160;array-like&#160;ob-<br/>
ject&#160;through&#160;the&#160;field’s&#160;options&#160;property.&#160;Each&#160;option&#160;has&#160;a&#160;property&#160;called<br/>selected,&#160;which&#160;indicates&#160;whether&#160;that&#160;option&#160;is&#160;currently&#160;selected.&#160;The&#160;prop-<br/>erty&#160;can&#160;also&#160;be&#160;written&#160;to&#160;select&#160;or&#160;deselect&#160;an&#160;option.<br/>
This&#160;example&#160;extracts&#160;the&#160;selected&#160;values&#160;from&#160;a&#160;multiple&#160;select&#160;field&#160;and<br/>
uses&#160;them&#160;to&#160;compose&#160;a&#160;binary&#160;number&#160;from&#160;individual&#160;bits.&#160;Hold&#160;control<br/>(or&#160;command&#160;on&#160;a&#160;Mac)&#160;to&#160;select&#160;multiple&#160;options.<br/>
&lt;select&#160;multiple&gt;<br/>
&lt;option&#160;value=&#34;1&#34;&gt;0001&lt;/option&gt;<br/>&lt;option&#160;value=&#34;2&#34;&gt;0010&lt;/option&gt;<br/>&lt;option&#160;value=&#34;4&#34;&gt;0100&lt;/option&gt;<br/>&lt;option&#160;value=&#34;8&#34;&gt;1000&lt;/option&gt;<br/>
&lt;/select&gt;&#160;=&#160;&lt;span&#160;id=&#34;output&#34;&gt;0&lt;/span&gt;<br/>&lt;script&gt;<br/>
let&#160;select&#160;=&#160;document.querySelector(&#34;select&#34;);<br/>let&#160;output&#160;=&#160;document.querySelector(&#34;#output&#34;);<br/>select.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;number&#160;=&#160;0;<br/>for&#160;(let&#160;option&#160;of&#160;Array.from(select.options))&#160;{<br/>
if&#160;(option.selected)&#160;{<br/>
number&#160;+=&#160;Number(option.value);<br/>
}<br/>
}<br/>output.textContent&#160;=&#160;number;<br/>
});<br/>
&lt;/script&gt;<br/>
<b>File&#160;fields</b><br/>
File&#160;fields&#160;were&#160;originally&#160;designed&#160;as&#160;a&#160;way&#160;to&#160;upload&#160;files&#160;from&#160;the&#160;user’s<br/>machine&#160;through&#160;a&#160;form.&#160;In&#160;modern&#160;browsers,&#160;they&#160;also&#160;provide&#160;a&#160;way&#160;to&#160;read<br/>such&#160;files&#160;from&#160;JavaScript&#160;programs.&#160;The&#160;field&#160;acts&#160;as&#160;a&#160;kind&#160;of&#160;gatekeeper.<br/>The&#160;script&#160;cannot&#160;simply&#160;start&#160;reading&#160;private&#160;files&#160;from&#160;the&#160;user’s&#160;computer,<br/>but&#160;if&#160;the&#160;user&#160;selects&#160;a&#160;file&#160;in&#160;such&#160;a&#160;field,&#160;the&#160;browser&#160;interprets&#160;that&#160;action<br/>to&#160;mean&#160;that&#160;the&#160;script&#160;may&#160;read&#160;the&#160;file.<br/>
A&#160;file&#160;field&#160;usually&#160;looks&#160;like&#160;a&#160;button&#160;labeled&#160;with&#160;something&#160;like&#160;“choose<br/>
file”&#160;or&#160;“browse”,&#160;with&#160;information&#160;about&#160;the&#160;chosen&#160;file&#160;next&#160;to&#160;it.<br/>
323<br/>
<hr/>
<a name=336></a>&lt;input&#160;type=&#34;file&#34;&gt;<br/>&lt;script&gt;<br/>
let&#160;input&#160;=&#160;document.querySelector(&#34;input&#34;);<br/>input.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
if&#160;(input.files.length&#160;&gt;&#160;0)&#160;{<br/>
let&#160;file&#160;=&#160;input.files[0];<br/>console.log(&#34;You&#160;chose&#34;,&#160;file.name);<br/>if&#160;(file.type)&#160;console.log(&#34;It&#160;has&#160;type&#34;,&#160;file.type);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
The&#160;files&#160;property&#160;of&#160;a&#160;file&#160;field&#160;element&#160;is&#160;an&#160;array-like&#160;object&#160;(again,<br/>
not&#160;a&#160;real&#160;array)&#160;containing&#160;the&#160;files&#160;chosen&#160;in&#160;the&#160;field.&#160;It&#160;is&#160;initially&#160;empty.<br/>The&#160;reason&#160;there&#160;isn’t&#160;simply&#160;a&#160;file&#160;property&#160;is&#160;that&#160;file&#160;fields&#160;also&#160;support&#160;a<br/>multiple&#160;attribute,&#160;which&#160;makes&#160;it&#160;possible&#160;to&#160;select&#160;multiple&#160;files&#160;at&#160;the&#160;same<br/>time.<br/>
Objects&#160;in&#160;the&#160;files&#160;object&#160;have&#160;properties&#160;such&#160;as&#160;name&#160;(the&#160;filename),&#160;size<br/>
(the&#160;file’s&#160;size&#160;in&#160;bytes,&#160;which&#160;are&#160;chunks&#160;of&#160;8&#160;bits),&#160;and&#160;type&#160;(the&#160;media&#160;type<br/>of&#160;the&#160;file,&#160;such&#160;as&#160;text/plain&#160;or&#160;image/jpeg).<br/>
What&#160;it&#160;does&#160;not&#160;have&#160;is&#160;a&#160;property&#160;that&#160;contains&#160;the&#160;content&#160;of&#160;the&#160;file.<br/>
Getting&#160;at&#160;that&#160;is&#160;a&#160;little&#160;more&#160;involved.&#160;Since&#160;reading&#160;a&#160;file&#160;from&#160;disk&#160;can&#160;take<br/>time,&#160;the&#160;interface&#160;must&#160;be&#160;asynchronous&#160;to&#160;avoid&#160;freezing&#160;the&#160;document.<br/>
&lt;input&#160;type=&#34;file&#34;&#160;multiple&gt;<br/>&lt;script&gt;<br/>
let&#160;input&#160;=&#160;document.querySelector(&#34;input&#34;);<br/>input.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
for&#160;(let&#160;file&#160;of&#160;Array.from(input.files))&#160;{<br/>
let&#160;reader&#160;=&#160;new&#160;FileReader();<br/>reader.addEventListener(&#34;load&#34;,&#160;()&#160;=&gt;&#160;{<br/>
console.log(&#34;File&#34;,&#160;file.name,&#160;&#34;starts&#160;with&#34;,<br/>
reader.result.slice(0,&#160;20));<br/>
});<br/>reader.readAsText(file);<br/>
}<br/>
});<br/>
&lt;/script&gt;<br/>
Reading&#160;a&#160;file&#160;is&#160;done&#160;by&#160;creating&#160;a&#160;FileReader&#160;object,&#160;registering&#160;a&#160;&#34;load&#34;<br/>
event&#160;handler&#160;for&#160;it,&#160;and&#160;calling&#160;its&#160;readAsText&#160;method,&#160;giving&#160;it&#160;the&#160;file&#160;we<br/>want&#160;to&#160;read.&#160;Once&#160;loading&#160;finishes,&#160;the&#160;reader’s&#160;result&#160;property&#160;contains&#160;the<br/>
324<br/>
<hr/>
<a name=337></a>file’s&#160;content.<br/>
FileReaders&#160;also&#160;fire&#160;an&#160;&#34;error&#34;&#160;event&#160;when&#160;reading&#160;the&#160;file&#160;fails&#160;for&#160;any<br/>
reason.&#160;The&#160;error&#160;object&#160;itself&#160;will&#160;end&#160;up&#160;in&#160;the&#160;reader’s&#160;error&#160;property.&#160;This<br/>interface&#160;was&#160;designed&#160;before&#160;promises&#160;became&#160;part&#160;of&#160;the&#160;language.&#160;You&#160;could<br/>wrap&#160;it&#160;in&#160;a&#160;promise&#160;like&#160;this:<br/>
function&#160;readFileText(file)&#160;{<br/>
return&#160;new&#160;Promise((resolve,&#160;reject)&#160;=&gt;&#160;{<br/>
let&#160;reader&#160;=&#160;new&#160;FileReader();<br/>reader.addEventListener(<br/>
&#34;load&#34;,&#160;()&#160;=&gt;&#160;resolve(reader.result));<br/>
reader.addEventListener(<br/>
&#34;error&#34;,&#160;()&#160;=&gt;&#160;reject(reader.error));<br/>
reader.readAsText(file);<br/>
});<br/>
}<br/>
<b>Storing&#160;data&#160;client-side</b><br/>
Simple&#160;HTML&#160;pages&#160;with&#160;a&#160;bit&#160;of&#160;JavaScript&#160;can&#160;be&#160;a&#160;great&#160;format&#160;for&#160;“mini<br/>applications”—small&#160;helper&#160;programs&#160;that&#160;automate&#160;basic&#160;tasks.&#160;By&#160;connect-<br/>ing&#160;a&#160;few&#160;form&#160;fields&#160;with&#160;event&#160;handlers,&#160;you&#160;can&#160;do&#160;anything&#160;from&#160;converting<br/>between&#160;centimeters&#160;and&#160;inches&#160;to&#160;computing&#160;passwords&#160;from&#160;a&#160;master&#160;pass-<br/>word&#160;and&#160;a&#160;website&#160;name.<br/>
When&#160;such&#160;an&#160;application&#160;needs&#160;to&#160;remember&#160;something&#160;between&#160;sessions,<br/>
you&#160;cannot&#160;use&#160;JavaScript&#160;bindings—those&#160;are&#160;thrown&#160;away&#160;every&#160;time&#160;the<br/>page&#160;is&#160;closed.&#160;You&#160;could&#160;set&#160;up&#160;a&#160;server,&#160;connect&#160;it&#160;to&#160;the&#160;Internet,&#160;and&#160;have<br/>your&#160;application&#160;store&#160;something&#160;there.&#160;We&#160;will&#160;see&#160;how&#160;to&#160;do&#160;that&#160;in&#160;<a href="eloquent-javascripts.html#362">Chapter<br/>20.&#160;</a>But&#160;that’s&#160;a&#160;lot&#160;of&#160;extra&#160;work&#160;and&#160;complexity.&#160;Sometimes&#160;it&#160;is&#160;enough&#160;to<br/>just&#160;keep&#160;the&#160;data&#160;in&#160;the&#160;browser.<br/>
The&#160;localStorage&#160;object&#160;can&#160;be&#160;used&#160;to&#160;store&#160;data&#160;in&#160;a&#160;way&#160;that&#160;survives<br/>
page&#160;reloads.&#160;This&#160;object&#160;allows&#160;you&#160;to&#160;file&#160;string&#160;values&#160;under&#160;names.<br/>
localStorage.setItem(&#34;username&#34;,&#160;&#34;marijn&#34;);<br/>console.log(localStorage.getItem(&#34;username&#34;));<br/>//&#160;→&#160;marijn<br/>localStorage.removeItem(&#34;username&#34;);<br/>
A&#160;value&#160;in&#160;localStorage&#160;sticks&#160;around&#160;until&#160;it&#160;is&#160;overwritten,&#160;it&#160;is&#160;removed<br/>
with&#160;removeItem,&#160;or&#160;the&#160;user&#160;clears&#160;their&#160;local&#160;data.<br/>
325<br/>
<hr/>
<a name=338></a>Sites&#160;from&#160;different&#160;domains&#160;get&#160;different&#160;storage&#160;compartments.&#160;That&#160;means<br/>
data&#160;stored&#160;in&#160;localStorage&#160;by&#160;a&#160;given&#160;website&#160;can,&#160;in&#160;principle,&#160;be&#160;read&#160;(and<br/>overwritten)&#160;only&#160;by&#160;scripts&#160;on&#160;that&#160;same&#160;site.<br/>
Browsers&#160;do&#160;enforce&#160;a&#160;limit&#160;on&#160;the&#160;size&#160;of&#160;the&#160;data&#160;a&#160;site&#160;can&#160;store&#160;in<br/>
localStorage.&#160;That&#160;restriction,&#160;along&#160;with&#160;the&#160;fact&#160;that&#160;filling&#160;up&#160;people’s<br/>hard&#160;drives&#160;with&#160;junk&#160;is&#160;not&#160;really&#160;profitable,&#160;prevents&#160;the&#160;feature&#160;from&#160;eating<br/>up&#160;too&#160;much&#160;space.<br/>
The&#160;following&#160;code&#160;implements&#160;a&#160;crude&#160;note-taking&#160;application.&#160;It&#160;keeps&#160;a<br/>
set&#160;of&#160;named&#160;notes&#160;and&#160;allows&#160;the&#160;user&#160;to&#160;edit&#160;notes&#160;and&#160;create&#160;new&#160;ones.<br/>
Notes:&#160;&lt;select&gt;&lt;/select&gt;&#160;&lt;button&gt;Add&lt;/button&gt;&lt;br&gt;<br/>&lt;textarea&#160;style=&#34;width:&#160;100%&#34;&gt;&lt;/textarea&gt;<br/>
&lt;script&gt;<br/>
let&#160;list&#160;=&#160;document.querySelector(&#34;select&#34;);<br/>let&#160;note&#160;=&#160;document.querySelector(&#34;textarea&#34;);<br/>
let&#160;state;<br/>function&#160;setState(newState)&#160;{<br/>
list.textContent&#160;=&#160;&#34;&#34;;<br/>for&#160;(let&#160;name&#160;of&#160;Object.keys(newState.notes))&#160;{<br/>
let&#160;option&#160;=&#160;document.createElement(&#34;option&#34;);<br/>option.textContent&#160;=&#160;name;<br/>if&#160;(newState.selected&#160;==&#160;name)&#160;option.selected&#160;=&#160;true;<br/>list.appendChild(option);<br/>
}<br/>note.value&#160;=&#160;newState.notes[newState.selected];<br/>
localStorage.setItem(&#34;Notes&#34;,&#160;JSON.stringify(newState));<br/>state&#160;=&#160;newState;<br/>
}<br/>setState(JSON.parse(localStorage.getItem(&#34;Notes&#34;))&#160;||&#160;{<br/>
notes:&#160;{&#34;shopping&#160;list&#34;:&#160;&#34;Carrots\nRaisins&#34;},<br/>selected:&#160;&#34;shopping&#160;list&#34;<br/>
});<br/>
list.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
setState({notes:&#160;state.notes,&#160;selected:&#160;list.value});<br/>
});<br/>note.addEventListener(&#34;change&#34;,&#160;()&#160;=&gt;&#160;{<br/>
setState({<br/>
notes:&#160;Object.assign({},&#160;state.notes,<br/>
{[state.selected]:&#160;note.value}),<br/>
selected:&#160;state.selected<br/>
});<br/>
326<br/>
<hr/>
<a name=339></a>});<br/>document.querySelector(&#34;button&#34;)<br/>
.addEventListener(&#34;click&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;name&#160;=&#160;prompt(&#34;Note&#160;name&#34;);<br/>if&#160;(name)&#160;setState({<br/>
notes:&#160;Object.assign({},&#160;state.notes,&#160;{[name]:&#160;&#34;&#34;}),<br/>selected:&#160;name<br/>
});<br/>
});<br/>
&lt;/script&gt;<br/>
The&#160;script&#160;gets&#160;its&#160;starting&#160;state&#160;from&#160;the&#160;&#34;Notes&#34;&#160;value&#160;stored&#160;in&#160;localStorage<br/>
or,&#160;if&#160;that&#160;is&#160;missing,&#160;creates&#160;an&#160;example&#160;state&#160;that&#160;has&#160;only&#160;a&#160;shopping&#160;list&#160;in<br/>
it.&#160;Reading&#160;a&#160;field&#160;that&#160;does&#160;not&#160;exist&#160;from&#160;localStorage&#160;will&#160;yield&#160;null.&#160;Pass-<br/>ing&#160;null&#160;to&#160;JSON.parse&#160;will&#160;make&#160;it&#160;parse&#160;the&#160;string&#160;&#34;null&#34;&#160;and&#160;return&#160;null.<br/>Thus,&#160;the&#160;||&#160;operator&#160;can&#160;be&#160;used&#160;to&#160;provide&#160;a&#160;default&#160;value&#160;in&#160;a&#160;situation&#160;like<br/>this.<br/>
The&#160;setState&#160;method&#160;makes&#160;sure&#160;the&#160;DOM&#160;is&#160;showing&#160;a&#160;given&#160;state&#160;and<br/>
stores&#160;the&#160;new&#160;state&#160;to&#160;localStorage.&#160;Event&#160;handlers&#160;call&#160;this&#160;function&#160;to<br/>move&#160;to&#160;a&#160;new&#160;state.<br/>
The&#160;use&#160;of&#160;Object.assign&#160;in&#160;the&#160;example&#160;is&#160;intended&#160;to&#160;create&#160;a&#160;new&#160;object<br/>
that&#160;is&#160;a&#160;clone&#160;of&#160;the&#160;old&#160;state.notes,&#160;but&#160;with&#160;one&#160;property&#160;added&#160;or&#160;over-<br/>written.&#160;Object.assign&#160;takes&#160;its&#160;first&#160;argument&#160;and&#160;adds&#160;all&#160;properties&#160;from<br/>any&#160;further&#160;arguments&#160;to&#160;it.&#160;Thus,&#160;giving&#160;it&#160;an&#160;empty&#160;object&#160;will&#160;cause&#160;it&#160;to<br/>fill&#160;a&#160;fresh&#160;object.&#160;The&#160;square&#160;brackets&#160;notation&#160;in&#160;the&#160;third&#160;argument&#160;is&#160;used<br/>to&#160;create&#160;a&#160;property&#160;whose&#160;name&#160;is&#160;based&#160;on&#160;some&#160;dynamic&#160;value.<br/>
There&#160;is&#160;another&#160;object,&#160;similar&#160;to&#160;localStorage,&#160;called&#160;sessionStorage.&#160;The<br/>
difference&#160;between&#160;the&#160;two&#160;is&#160;that&#160;the&#160;content&#160;of&#160;sessionStorage&#160;is&#160;forgotten&#160;at<br/>the&#160;end&#160;of&#160;each&#160;<i>session</i>,&#160;which&#160;for&#160;most&#160;browsers&#160;means&#160;whenever&#160;the&#160;browser<br/>is&#160;closed.<br/>
<b>Summary</b><br/>
In&#160;this&#160;chapter,&#160;we&#160;discussed&#160;how&#160;the&#160;HTTP&#160;protocol&#160;works.&#160;A&#160;<i>client&#160;</i>sends<br/>a&#160;request,&#160;which&#160;contains&#160;a&#160;method&#160;(usually&#160;GET)&#160;and&#160;a&#160;path&#160;that&#160;identifies&#160;a<br/>resource.&#160;The&#160;<i>server&#160;</i>then&#160;decides&#160;what&#160;to&#160;do&#160;with&#160;the&#160;request&#160;and&#160;responds<br/>with&#160;a&#160;status&#160;code&#160;and&#160;a&#160;response&#160;body.&#160;Both&#160;requests&#160;and&#160;responses&#160;may<br/>contain&#160;headers&#160;that&#160;provide&#160;additional&#160;information.<br/>
The&#160;interface&#160;through&#160;which&#160;browser&#160;JavaScript&#160;can&#160;make&#160;HTTP&#160;requests&#160;is<br/>
called&#160;fetch.&#160;Making&#160;a&#160;request&#160;looks&#160;like&#160;this:<br/>
327<br/>
<hr/>
<a name=340></a>fetch(&#34;/18_http.html&#34;).then(r&#160;=&gt;&#160;r.text()).then(text&#160;=&gt;&#160;{<br/>
console.log(`The&#160;page&#160;starts&#160;with&#160;${text.slice(0,&#160;15)}`);<br/>
});<br/>
Browsers&#160;make&#160;GET&#160;requests&#160;to&#160;fetch&#160;the&#160;resources&#160;needed&#160;to&#160;display&#160;a&#160;web<br/>
page.&#160;A&#160;page&#160;may&#160;also&#160;contain&#160;forms,&#160;which&#160;allow&#160;information&#160;entered&#160;by&#160;the<br/>user&#160;to&#160;be&#160;sent&#160;as&#160;a&#160;request&#160;for&#160;a&#160;new&#160;page&#160;when&#160;the&#160;form&#160;is&#160;submitted.<br/>
HTML&#160;can&#160;represent&#160;various&#160;types&#160;of&#160;form&#160;fields,&#160;such&#160;as&#160;text&#160;fields,&#160;check-<br/>
boxes,&#160;multiple-choice&#160;fields,&#160;and&#160;file&#160;pickers.<br/>
Such&#160;fields&#160;can&#160;be&#160;inspected&#160;and&#160;manipulated&#160;with&#160;JavaScript.&#160;They&#160;fire&#160;the<br/>
&#34;change&#34;&#160;event&#160;when&#160;changed,&#160;fire&#160;the&#160;&#34;input&#34;&#160;event&#160;when&#160;text&#160;is&#160;typed,&#160;and<br/>receive&#160;keyboard&#160;events&#160;when&#160;they&#160;have&#160;keyboard&#160;focus.&#160;Properties&#160;like&#160;value<br/>(for&#160;text&#160;and&#160;select&#160;fields)&#160;or&#160;checked&#160;(for&#160;checkboxes&#160;and&#160;radio&#160;buttons)&#160;are<br/>used&#160;to&#160;read&#160;or&#160;set&#160;the&#160;field’s&#160;content.<br/>
When&#160;a&#160;form&#160;is&#160;submitted,&#160;a&#160;&#34;submit&#34;&#160;event&#160;is&#160;fired&#160;on&#160;it.&#160;A&#160;JavaScript<br/>
handler&#160;can&#160;call&#160;preventDefault&#160;on&#160;that&#160;event&#160;to&#160;disable&#160;the&#160;browser’s&#160;default<br/>behavior.&#160;Form&#160;field&#160;elements&#160;may&#160;also&#160;occur&#160;outside&#160;of&#160;a&#160;form&#160;tag.<br/>
When&#160;the&#160;user&#160;has&#160;selected&#160;a&#160;file&#160;from&#160;their&#160;local&#160;file&#160;system&#160;in&#160;a&#160;file&#160;picker<br/>
field,&#160;the&#160;FileReader&#160;interface&#160;can&#160;be&#160;used&#160;to&#160;access&#160;the&#160;content&#160;of&#160;this&#160;file&#160;from<br/>a&#160;JavaScript&#160;program.<br/>
The&#160;localStorage&#160;and&#160;sessionStorage&#160;objects&#160;can&#160;be&#160;used&#160;to&#160;save&#160;informa-<br/>
tion&#160;in&#160;a&#160;way&#160;that&#160;survives&#160;page&#160;reloads.&#160;The&#160;first&#160;object&#160;saves&#160;the&#160;data&#160;forever<br/>(or&#160;until&#160;the&#160;user&#160;decides&#160;to&#160;clear&#160;it),&#160;and&#160;the&#160;second&#160;saves&#160;it&#160;until&#160;the&#160;browser<br/>is&#160;closed.<br/>
<b>Exercises</b><br/>
<b>Content&#160;negotiation</b><br/>
One&#160;of&#160;the&#160;things&#160;HTTP&#160;can&#160;do&#160;is&#160;called&#160;<i>content&#160;negotiation</i>.&#160;The&#160;Accept<br/>
request&#160;header&#160;is&#160;used&#160;to&#160;tell&#160;the&#160;server&#160;what&#160;type&#160;of&#160;document&#160;the&#160;client<br/>
would&#160;like&#160;to&#160;get.&#160;Many&#160;servers&#160;ignore&#160;this&#160;header,&#160;but&#160;when&#160;a&#160;server&#160;knows&#160;of<br/>various&#160;ways&#160;to&#160;encode&#160;a&#160;resource,&#160;it&#160;can&#160;look&#160;at&#160;this&#160;header&#160;and&#160;send&#160;the&#160;one<br/>that&#160;the&#160;client&#160;prefers.<br/>
The&#160;URL&#160;<a href="https://eloquentjavascript.net/author"><i>https://eloquentjavascript.net/author&#160;</i></a>is&#160;configured&#160;to&#160;respond&#160;with<br/>
either&#160;plaintext,&#160;HTML,&#160;or&#160;JSON,&#160;depending&#160;on&#160;what&#160;the&#160;client&#160;asks&#160;for.&#160;These<br/>formats&#160;are&#160;identified&#160;by&#160;the&#160;standardized&#160;<i>media&#160;types&#160;</i>text/plain,&#160;text/html,<br/>and&#160;application/json.<br/>
Send&#160;requests&#160;to&#160;fetch&#160;all&#160;three&#160;formats&#160;of&#160;this&#160;resource.&#160;Use&#160;the&#160;headers<br/>
328<br/>
<hr/>
<a name=341></a>property&#160;in&#160;the&#160;options&#160;object&#160;passed&#160;to&#160;fetch&#160;to&#160;set&#160;the&#160;header&#160;named&#160;Accept<br/>to&#160;the&#160;desired&#160;media&#160;type.<br/>
Finally,&#160;try&#160;asking&#160;for&#160;the&#160;media&#160;type&#160;application/rainbows+unicorns&#160;and<br/>
see&#160;which&#160;status&#160;code&#160;that&#160;produces.<br/>
<b>A&#160;JavaScript&#160;workbench</b><br/>
Build&#160;an&#160;interface&#160;that&#160;allows&#160;people&#160;to&#160;type&#160;and&#160;run&#160;pieces&#160;of&#160;JavaScript&#160;code.<br/>
Put&#160;a&#160;button&#160;next&#160;to&#160;a&#160;&lt;textarea&gt;&#160;field&#160;that,&#160;when&#160;pressed,&#160;uses&#160;the&#160;Function<br/>
constructor&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#182">Chapter&#160;10&#160;</a>to&#160;wrap&#160;the&#160;text&#160;in&#160;a&#160;function&#160;and&#160;call&#160;it.<br/>Convert&#160;the&#160;return&#160;value&#160;of&#160;the&#160;function,&#160;or&#160;any&#160;error&#160;it&#160;raises,&#160;to&#160;a&#160;string&#160;and<br/>display&#160;it&#160;below&#160;the&#160;text&#160;field.<br/>
<b>Conway's&#160;Game&#160;of&#160;Life</b><br/>
Conway’s&#160;Game&#160;of&#160;Life&#160;is&#160;a&#160;simple&#160;simulation&#160;that&#160;creates&#160;artificial&#160;“life”&#160;on<br/>a&#160;grid,&#160;each&#160;cell&#160;of&#160;which&#160;is&#160;either&#160;alive&#160;or&#160;not.&#160;Each&#160;generation&#160;(turn),&#160;the<br/>following&#160;rules&#160;are&#160;applied:<br/>
•&#160;Any&#160;live&#160;cell&#160;with&#160;fewer&#160;than&#160;two&#160;or&#160;more&#160;than&#160;three&#160;live&#160;neighbors&#160;dies.<br/>
•&#160;Any&#160;live&#160;cell&#160;with&#160;two&#160;or&#160;three&#160;live&#160;neighbors&#160;lives&#160;on&#160;to&#160;the&#160;next&#160;gener-<br/>
ation.<br/>
•&#160;Any&#160;dead&#160;cell&#160;with&#160;exactly&#160;three&#160;live&#160;neighbors&#160;becomes&#160;a&#160;live&#160;cell.<br/>
A&#160;<i>neighbor&#160;</i>is&#160;defined&#160;as&#160;any&#160;adjacent&#160;cell,&#160;including&#160;diagonally&#160;adjacent&#160;ones.<br/>Note&#160;that&#160;these&#160;rules&#160;are&#160;applied&#160;to&#160;the&#160;whole&#160;grid&#160;at&#160;once,&#160;not&#160;one&#160;square&#160;at<br/>
a&#160;time.&#160;That&#160;means&#160;the&#160;counting&#160;of&#160;neighbors&#160;is&#160;based&#160;on&#160;the&#160;situation&#160;at&#160;the<br/>start&#160;of&#160;the&#160;generation,&#160;and&#160;changes&#160;happening&#160;to&#160;neighbor&#160;cells&#160;during&#160;this<br/>generation&#160;should&#160;not&#160;influence&#160;the&#160;new&#160;state&#160;of&#160;a&#160;given&#160;cell.<br/>
Implement&#160;this&#160;game&#160;using&#160;whichever&#160;data&#160;structure&#160;you&#160;find&#160;appropriate.<br/>
Use&#160;Math.random&#160;to&#160;populate&#160;the&#160;grid&#160;with&#160;a&#160;random&#160;pattern&#160;initially.&#160;Display<br/>it&#160;as&#160;a&#160;grid&#160;of&#160;checkbox&#160;fields,&#160;with&#160;a&#160;button&#160;next&#160;to&#160;it&#160;to&#160;advance&#160;to&#160;the&#160;next<br/>generation.&#160;When&#160;the&#160;user&#160;checks&#160;or&#160;unchecks&#160;the&#160;checkboxes,&#160;their&#160;changes<br/>should&#160;be&#160;included&#160;when&#160;computing&#160;the&#160;next&#160;generation.<br/>
329<br/>
<hr/>
<a name=342></a><img src="eloquent-javascript-342_1.png"/><br/>
<i>“I&#160;look&#160;at&#160;the&#160;many&#160;colors&#160;before&#160;me.&#160;I&#160;look&#160;at&#160;my&#160;blank&#160;canvas.</i><br/>
<i>Then,&#160;I&#160;try&#160;to&#160;apply&#160;colors&#160;like&#160;words&#160;that&#160;shape&#160;poems,&#160;like&#160;notes<br/>that&#160;shape&#160;music.”</i><br/>
—Joan&#160;Miro<br/>
<b>Chapter&#160;19<br/>Project:&#160;A&#160;Pixel&#160;Art&#160;Editor</b><br/>
The&#160;material&#160;from&#160;the&#160;previous&#160;chapters&#160;gives&#160;you&#160;all&#160;the&#160;elements&#160;you&#160;need<br/>to&#160;build&#160;a&#160;basic&#160;web&#160;application.&#160;In&#160;this&#160;chapter,&#160;we&#160;will&#160;do&#160;just&#160;that.<br/>
Our&#160;application&#160;will&#160;be&#160;a&#160;pixel&#160;drawing&#160;program,&#160;where&#160;you&#160;can&#160;modify&#160;a<br/>
picture&#160;pixel&#160;by&#160;pixel&#160;by&#160;manipulating&#160;a&#160;zoomed-in&#160;view&#160;of&#160;it,&#160;shown&#160;as&#160;a&#160;grid<br/>of&#160;colored&#160;squares.&#160;You&#160;can&#160;use&#160;the&#160;program&#160;to&#160;open&#160;image&#160;files,&#160;scribble&#160;on<br/>them&#160;with&#160;your&#160;mouse&#160;or&#160;other&#160;pointer&#160;device,&#160;and&#160;save&#160;them.&#160;This&#160;is&#160;what&#160;it<br/>will&#160;look&#160;like:<br/>
Painting&#160;on&#160;a&#160;computer&#160;is&#160;great.&#160;You&#160;don’t&#160;need&#160;to&#160;worry&#160;about&#160;materials,<br/>
skill,&#160;or&#160;talent.&#160;You&#160;just&#160;start&#160;smearing.<br/>
<b>Components</b><br/>
The&#160;interface&#160;for&#160;the&#160;application&#160;shows&#160;a&#160;big&#160;&lt;canvas&gt;&#160;element&#160;on&#160;top,&#160;with&#160;a<br/>number&#160;of&#160;form&#160;fields&#160;below&#160;it.&#160;The&#160;user&#160;draws&#160;on&#160;the&#160;picture&#160;by&#160;selecting&#160;a<br/>tool&#160;from&#160;a&#160;&lt;select&gt;&#160;field&#160;and&#160;then&#160;clicking,&#160;touching,&#160;or&#160;dragging&#160;across&#160;the<br/>canvas.&#160;There&#160;are&#160;tools&#160;for&#160;drawing&#160;single&#160;pixels&#160;or&#160;rectangles,&#160;for&#160;filling&#160;an<br/>area,&#160;and&#160;for&#160;picking&#160;a&#160;color&#160;from&#160;the&#160;picture.<br/>
We&#160;will&#160;structure&#160;the&#160;editor&#160;interface&#160;as&#160;a&#160;number&#160;of&#160;<i>components</i>,&#160;objects&#160;that<br/>
are&#160;responsible&#160;for&#160;a&#160;piece&#160;of&#160;the&#160;DOM&#160;and&#160;that&#160;may&#160;contain&#160;other&#160;components<br/>inside&#160;them.<br/>
The&#160;state&#160;of&#160;the&#160;application&#160;consists&#160;of&#160;the&#160;current&#160;picture,&#160;the&#160;selected&#160;tool,<br/>
and&#160;the&#160;selected&#160;color.&#160;We’ll&#160;set&#160;things&#160;up&#160;so&#160;that&#160;the&#160;state&#160;lives&#160;in&#160;a&#160;single<br/>
330<br/>
<hr/>
<a name=343></a>value,&#160;and&#160;the&#160;interface&#160;components&#160;always&#160;base&#160;the&#160;way&#160;they&#160;look&#160;on&#160;the<br/>current&#160;state.<br/>
To&#160;see&#160;why&#160;this&#160;is&#160;important,&#160;let’s&#160;consider&#160;the&#160;alternative—distributing<br/>
pieces&#160;of&#160;state&#160;throughout&#160;the&#160;interface.&#160;Up&#160;to&#160;a&#160;certain&#160;point,&#160;this&#160;is&#160;easier&#160;to<br/>program.&#160;We&#160;can&#160;just&#160;put&#160;in&#160;a&#160;color&#160;field&#160;and&#160;read&#160;its&#160;value&#160;when&#160;we&#160;need&#160;to<br/>know&#160;the&#160;current&#160;color.<br/>
But&#160;then&#160;we&#160;add&#160;the&#160;color&#160;picker—a&#160;tool&#160;that&#160;lets&#160;you&#160;click&#160;the&#160;picture&#160;to<br/>
select&#160;the&#160;color&#160;of&#160;a&#160;given&#160;pixel.&#160;To&#160;keep&#160;the&#160;color&#160;field&#160;showing&#160;the&#160;correct&#160;color,<br/>that&#160;tool&#160;would&#160;have&#160;to&#160;know&#160;that&#160;it&#160;exists&#160;and&#160;update&#160;it&#160;whenever&#160;it&#160;picks&#160;a<br/>new&#160;color.&#160;If&#160;you&#160;ever&#160;add&#160;another&#160;place&#160;that&#160;makes&#160;the&#160;color&#160;visible&#160;(maybe<br/>the&#160;mouse&#160;cursor&#160;could&#160;show&#160;it),&#160;you&#160;have&#160;to&#160;update&#160;your&#160;color-changing&#160;code<br/>to&#160;keep&#160;that&#160;synchronized.<br/>
In&#160;effect,&#160;this&#160;creates&#160;a&#160;problem&#160;where&#160;each&#160;part&#160;of&#160;the&#160;interface&#160;needs&#160;to<br/>
know&#160;about&#160;all&#160;other&#160;parts,&#160;which&#160;is&#160;not&#160;very&#160;modular.&#160;For&#160;small&#160;applications<br/>like&#160;the&#160;one&#160;in&#160;this&#160;chapter,&#160;that&#160;may&#160;not&#160;be&#160;a&#160;problem.&#160;For&#160;bigger&#160;projects,&#160;it<br/>can&#160;turn&#160;into&#160;a&#160;real&#160;nightmare.<br/>
To&#160;avoid&#160;this&#160;nightmare&#160;on&#160;principle,&#160;we’re&#160;going&#160;to&#160;be&#160;strict&#160;about&#160;<i>data&#160;flow</i>.<br/>
There&#160;is&#160;a&#160;state,&#160;and&#160;the&#160;interface&#160;is&#160;drawn&#160;based&#160;on&#160;that&#160;state.&#160;An&#160;interface<br/>component&#160;may&#160;respond&#160;to&#160;user&#160;actions&#160;by&#160;updating&#160;the&#160;state,&#160;at&#160;which&#160;point<br/>the&#160;components&#160;get&#160;a&#160;chance&#160;to&#160;synchronize&#160;themselves&#160;with&#160;this&#160;new&#160;state.<br/>
In&#160;practice,&#160;each&#160;component&#160;is&#160;set&#160;up&#160;so&#160;that&#160;when&#160;it&#160;is&#160;given&#160;a&#160;new&#160;state,&#160;it<br/>
also&#160;notifies&#160;its&#160;child&#160;components,&#160;insofar&#160;as&#160;those&#160;need&#160;to&#160;be&#160;updated.&#160;Setting<br/>this&#160;up&#160;is&#160;a&#160;bit&#160;of&#160;a&#160;hassle.&#160;Making&#160;this&#160;more&#160;convenient&#160;is&#160;the&#160;main&#160;selling<br/>point&#160;of&#160;many&#160;browser&#160;programming&#160;libraries.&#160;But&#160;for&#160;a&#160;small&#160;application&#160;like<br/>this,&#160;we&#160;can&#160;do&#160;it&#160;without&#160;such&#160;infrastructure.<br/>
Updates&#160;to&#160;the&#160;state&#160;are&#160;represented&#160;as&#160;objects,&#160;which&#160;we’ll&#160;call&#160;<i>actions</i>.<br/>
Components&#160;may&#160;create&#160;such&#160;actions&#160;and&#160;<i>dispatch&#160;</i>them—give&#160;them&#160;to&#160;a&#160;central<br/>state&#160;management&#160;function.&#160;That&#160;function&#160;computes&#160;the&#160;next&#160;state,&#160;after&#160;which<br/>the&#160;interface&#160;components&#160;update&#160;themselves&#160;to&#160;this&#160;new&#160;state.<br/>
We’re&#160;taking&#160;the&#160;messy&#160;task&#160;of&#160;running&#160;a&#160;user&#160;interface&#160;and&#160;applying&#160;some<br/>
structure&#160;to&#160;it.&#160;Though&#160;the&#160;DOM-related&#160;pieces&#160;are&#160;still&#160;full&#160;of&#160;side&#160;effects,<br/>they&#160;are&#160;held&#160;up&#160;by&#160;a&#160;conceptually&#160;simple&#160;backbone:&#160;the&#160;state&#160;update&#160;cycle.<br/>The&#160;state&#160;determines&#160;what&#160;the&#160;DOM&#160;looks&#160;like,&#160;and&#160;the&#160;only&#160;way&#160;DOM&#160;events<br/>can&#160;change&#160;the&#160;state&#160;is&#160;by&#160;dispatching&#160;actions&#160;to&#160;the&#160;state.<br/>
There&#160;are&#160;<i>many&#160;</i>variants&#160;of&#160;this&#160;approach,&#160;each&#160;with&#160;its&#160;own&#160;benefits&#160;and<br/>
problems,&#160;but&#160;their&#160;central&#160;idea&#160;is&#160;the&#160;same:&#160;state&#160;changes&#160;should&#160;go&#160;through<br/>a&#160;single&#160;well-defined&#160;channel,&#160;not&#160;happen&#160;all&#160;over&#160;the&#160;place.<br/>
Our&#160;components&#160;will&#160;be&#160;classes&#160;conforming&#160;to&#160;an&#160;interface.&#160;Their&#160;constructor<br/>
is&#160;given&#160;a&#160;state—which&#160;may&#160;be&#160;the&#160;whole&#160;application&#160;state&#160;or&#160;some&#160;smaller<br/>value&#160;if&#160;it&#160;doesn’t&#160;need&#160;access&#160;to&#160;everything—and&#160;uses&#160;that&#160;to&#160;build&#160;up&#160;a&#160;dom<br/>
331<br/>
<hr/>
<a name=344></a>property.&#160;This&#160;is&#160;the&#160;DOM&#160;element&#160;that&#160;represents&#160;the&#160;component.&#160;Most<br/>
constructors&#160;will&#160;also&#160;take&#160;some&#160;other&#160;values&#160;that&#160;won’t&#160;change&#160;over&#160;time,&#160;such<br/>as&#160;the&#160;function&#160;they&#160;can&#160;use&#160;to&#160;dispatch&#160;an&#160;action.<br/>
Each&#160;component&#160;has&#160;a&#160;syncState&#160;method&#160;that&#160;is&#160;used&#160;to&#160;synchronize&#160;it&#160;to<br/>
a&#160;new&#160;state&#160;value.&#160;The&#160;method&#160;takes&#160;one&#160;argument,&#160;the&#160;state,&#160;which&#160;is&#160;of&#160;the<br/>same&#160;type&#160;as&#160;the&#160;first&#160;argument&#160;to&#160;its&#160;constructor.<br/>
<b>The&#160;state</b><br/>
The&#160;application&#160;state&#160;will&#160;be&#160;an&#160;object&#160;with&#160;picture,&#160;tool,&#160;and&#160;color&#160;prop-<br/>erties.&#160;The&#160;picture&#160;is&#160;itself&#160;an&#160;object&#160;that&#160;stores&#160;the&#160;width,&#160;height,&#160;and&#160;pixel<br/>content&#160;of&#160;the&#160;picture.&#160;The&#160;pixels&#160;are&#160;stored&#160;in&#160;an&#160;array,&#160;in&#160;the&#160;same&#160;way&#160;as<br/>the&#160;matrix&#160;class&#160;from&#160;<a href="eloquent-javascripts.html#109">Chapter&#160;6</a>—row&#160;by&#160;row,&#160;from&#160;top&#160;to&#160;bottom.<br/>
class&#160;Picture&#160;{<br/>
constructor(width,&#160;height,&#160;pixels)&#160;{<br/>
this.width&#160;=&#160;width;<br/>this.height&#160;=&#160;height;<br/>this.pixels&#160;=&#160;pixels;<br/>
}<br/>static&#160;empty(width,&#160;height,&#160;color)&#160;{<br/>
let&#160;pixels&#160;=&#160;new&#160;Array(width&#160;*&#160;height).fill(color);<br/>return&#160;new&#160;Picture(width,&#160;height,&#160;pixels);<br/>
}<br/>pixel(x,&#160;y)&#160;{<br/>
return&#160;this.pixels[x&#160;+&#160;y&#160;*&#160;this.width];<br/>
}<br/>draw(pixels)&#160;{<br/>
let&#160;copy&#160;=&#160;this.pixels.slice();<br/>for&#160;(let&#160;{x,&#160;y,&#160;color}&#160;of&#160;pixels)&#160;{<br/>
copy[x&#160;+&#160;y&#160;*&#160;this.width]&#160;=&#160;color;<br/>
}<br/>return&#160;new&#160;Picture(this.width,&#160;this.height,&#160;copy);<br/>
}<br/>
}<br/>
We&#160;want&#160;to&#160;be&#160;able&#160;to&#160;treat&#160;a&#160;picture&#160;as&#160;an&#160;immutable&#160;value,&#160;for&#160;reasons<br/>
that&#160;we’ll&#160;get&#160;back&#160;to&#160;later&#160;in&#160;the&#160;chapter.&#160;But&#160;we&#160;also&#160;sometimes&#160;need&#160;to<br/>update&#160;a&#160;whole&#160;bunch&#160;of&#160;pixels&#160;at&#160;a&#160;time.&#160;To&#160;be&#160;able&#160;to&#160;do&#160;that,&#160;the&#160;class<br/>has&#160;a&#160;draw&#160;method&#160;that&#160;expects&#160;an&#160;array&#160;of&#160;updated&#160;pixels—objects&#160;with&#160;x,&#160;y,<br/>and&#160;color&#160;properties—and&#160;creates&#160;a&#160;new&#160;picture&#160;with&#160;those&#160;pixels&#160;overwritten.<br/>This&#160;method&#160;uses&#160;slice&#160;without&#160;arguments&#160;to&#160;copy&#160;the&#160;entire&#160;pixel&#160;array—the<br/>
332<br/>
<hr/>
<a name=345></a>start&#160;of&#160;the&#160;slice&#160;defaults&#160;to&#160;0,&#160;and&#160;the&#160;end&#160;defaults&#160;to&#160;the&#160;array’s&#160;length.<br/>
The&#160;empty&#160;method&#160;uses&#160;two&#160;pieces&#160;of&#160;array&#160;functionality&#160;that&#160;we&#160;haven’t&#160;seen<br/>
before.&#160;The&#160;Array&#160;constructor&#160;can&#160;be&#160;called&#160;with&#160;a&#160;number&#160;to&#160;create&#160;an&#160;empty<br/>array&#160;of&#160;the&#160;given&#160;length.&#160;The&#160;fill&#160;method&#160;can&#160;then&#160;be&#160;used&#160;to&#160;fill&#160;this&#160;array<br/>with&#160;a&#160;given&#160;value.&#160;These&#160;are&#160;used&#160;to&#160;create&#160;an&#160;array&#160;in&#160;which&#160;all&#160;pixels&#160;have<br/>the&#160;same&#160;color.<br/>
Colors&#160;are&#160;stored&#160;as&#160;strings&#160;containing&#160;traditional&#160;CSS&#160;color&#160;codes&#160;made&#160;up<br/>
of&#160;a&#160;hash&#160;sign&#160;(#)&#160;followed&#160;by&#160;six&#160;hexadecimal&#160;(base-16)&#160;digits—two&#160;for&#160;the<br/>red&#160;component,&#160;two&#160;for&#160;the&#160;green&#160;component,&#160;and&#160;two&#160;for&#160;the&#160;blue&#160;component.<br/>This&#160;is&#160;a&#160;somewhat&#160;cryptic&#160;and&#160;inconvenient&#160;way&#160;to&#160;write&#160;colors,&#160;but&#160;it&#160;is&#160;the<br/>format&#160;the&#160;HTML&#160;color&#160;input&#160;field&#160;uses,&#160;and&#160;it&#160;can&#160;be&#160;used&#160;in&#160;the&#160;fillColor<br/>property&#160;of&#160;a&#160;canvas&#160;drawing&#160;context,&#160;so&#160;for&#160;the&#160;ways&#160;we’ll&#160;use&#160;colors&#160;in&#160;this<br/>program,&#160;it&#160;is&#160;practical&#160;enough.<br/>
Black,&#160;where&#160;all&#160;components&#160;are&#160;zero,&#160;is&#160;written&#160;&#34;#000000&#34;,&#160;and&#160;bright&#160;pink<br/>
looks&#160;like&#160;&#34;#ff00ff&#34;,&#160;where&#160;the&#160;red&#160;and&#160;blue&#160;components&#160;have&#160;the&#160;maximum<br/>value&#160;of&#160;255,&#160;written&#160;ff&#160;in&#160;hexadecimal&#160;digits&#160;(which&#160;use&#160;<i>a&#160;</i>to&#160;<i>f&#160;</i>to&#160;represent<br/>digits&#160;10&#160;to&#160;15).<br/>
We’ll&#160;allow&#160;the&#160;interface&#160;to&#160;dispatch&#160;actions&#160;as&#160;objects&#160;whose&#160;properties<br/>
overwrite&#160;the&#160;properties&#160;of&#160;the&#160;previous&#160;state.&#160;The&#160;color&#160;field,&#160;when&#160;the&#160;user<br/>changes&#160;it,&#160;could&#160;dispatch&#160;an&#160;object&#160;like&#160;{color:&#160;field.value},&#160;from&#160;which<br/>this&#160;update&#160;function&#160;can&#160;compute&#160;a&#160;new&#160;state.<br/>
function&#160;updateState(state,&#160;action)&#160;{<br/>
return&#160;Object.assign({},&#160;state,&#160;action);<br/>
}<br/>
This&#160;rather&#160;cumbersome&#160;pattern,&#160;in&#160;which&#160;Object.assign&#160;is&#160;used&#160;to&#160;first<br/>
add&#160;the&#160;properties&#160;of&#160;state&#160;to&#160;an&#160;empty&#160;object&#160;and&#160;then&#160;overwrite&#160;some&#160;of<br/>those&#160;with&#160;the&#160;properties&#160;from&#160;action,&#160;is&#160;common&#160;in&#160;JavaScript&#160;code&#160;that&#160;uses<br/>immutable&#160;objects.&#160;A&#160;more&#160;convenient&#160;notation&#160;for&#160;this,&#160;in&#160;which&#160;the&#160;triple-<br/>dot&#160;operator&#160;is&#160;used&#160;to&#160;include&#160;all&#160;properties&#160;from&#160;another&#160;object&#160;in&#160;an&#160;object<br/>expression,&#160;is&#160;in&#160;the&#160;final&#160;stages&#160;of&#160;being&#160;standardized.&#160;With&#160;that&#160;addition,<br/>you&#160;could&#160;write&#160;{...state,&#160;...action}&#160;instead.&#160;At&#160;the&#160;time&#160;of&#160;writing,&#160;this<br/>doesn’t&#160;yet&#160;work&#160;in&#160;all&#160;browsers.<br/>
<b>DOM&#160;building</b><br/>
One&#160;of&#160;the&#160;main&#160;things&#160;that&#160;interface&#160;components&#160;do&#160;is&#160;creating&#160;DOM&#160;structure.<br/>We&#160;again&#160;don’t&#160;want&#160;to&#160;directly&#160;use&#160;the&#160;verbose&#160;DOM&#160;methods&#160;for&#160;that,&#160;so<br/>
333<br/>
<hr/>
<a name=346></a>here’s&#160;a&#160;slightly&#160;expanded&#160;version&#160;of&#160;the&#160;elt&#160;function:<br/>
function&#160;elt(type,&#160;props,&#160;...children)&#160;{<br/>
let&#160;dom&#160;=&#160;document.createElement(type);<br/>if&#160;(props)&#160;Object.assign(dom,&#160;props);<br/>for&#160;(let&#160;child&#160;of&#160;children)&#160;{<br/>
if&#160;(typeof&#160;child&#160;!=&#160;&#34;string&#34;)&#160;dom.appendChild(child);<br/>else&#160;dom.appendChild(document.createTextNode(child));<br/>
}<br/>return&#160;dom;<br/>
}<br/>
The&#160;main&#160;difference&#160;between&#160;this&#160;version&#160;and&#160;the&#160;one&#160;we&#160;used&#160;in&#160;<a href="eloquent-javascripts.html#280">Chapter</a><br/>
<a href="eloquent-javascripts.html#280">16&#160;</a>is&#160;that&#160;it&#160;assigns&#160;<i>properties&#160;</i>to&#160;DOM&#160;nodes,&#160;not&#160;<i>attributes</i>.&#160;This&#160;means&#160;we<br/>can’t&#160;use&#160;it&#160;to&#160;set&#160;arbitrary&#160;attributes,&#160;but&#160;we&#160;<i>can&#160;</i>use&#160;it&#160;to&#160;set&#160;properties&#160;whose<br/>value&#160;isn’t&#160;a&#160;string,&#160;such&#160;as&#160;onclick,&#160;which&#160;can&#160;be&#160;set&#160;to&#160;a&#160;function&#160;to&#160;register<br/>a&#160;click&#160;event&#160;handler.<br/>
This&#160;allows&#160;the&#160;following&#160;style&#160;of&#160;registering&#160;event&#160;handlers:<br/>
&lt;body&gt;<br/>
&lt;script&gt;<br/>
document.body.appendChild(elt(&#34;button&#34;,&#160;{<br/>
onclick:&#160;()&#160;=&gt;&#160;console.log(&#34;click&#34;)<br/>
},&#160;&#34;The&#160;button&#34;));<br/>
&lt;/script&gt;<br/>
&lt;/body&gt;<br/>
<b>The&#160;canvas</b><br/>
The&#160;first&#160;component&#160;we’ll&#160;define&#160;is&#160;the&#160;part&#160;of&#160;the&#160;interface&#160;that&#160;displays&#160;the<br/>picture&#160;as&#160;a&#160;grid&#160;of&#160;colored&#160;boxes.&#160;This&#160;component&#160;is&#160;responsible&#160;for&#160;two&#160;things:<br/>showing&#160;a&#160;picture&#160;and&#160;communicating&#160;pointer&#160;events&#160;on&#160;that&#160;picture&#160;to&#160;the&#160;rest<br/>of&#160;the&#160;application.<br/>
As&#160;such,&#160;we&#160;can&#160;define&#160;it&#160;as&#160;a&#160;component&#160;that&#160;knows&#160;about&#160;only&#160;the&#160;current<br/>
picture,&#160;not&#160;the&#160;whole&#160;application&#160;state.&#160;Because&#160;it&#160;doesn’t&#160;know&#160;how&#160;the<br/>application&#160;as&#160;a&#160;whole&#160;works,&#160;it&#160;cannot&#160;directly&#160;dispatch&#160;actions.&#160;Rather,<br/>when&#160;responding&#160;to&#160;pointer&#160;events,&#160;it&#160;calls&#160;a&#160;callback&#160;function&#160;provided&#160;by&#160;the<br/>code&#160;that&#160;created&#160;it,&#160;which&#160;will&#160;handle&#160;the&#160;application-specific&#160;parts.<br/>
const&#160;scale&#160;=&#160;10;<br/>
334<br/>
<hr/>
<a name=347></a>class&#160;PictureCanvas&#160;{<br/>
constructor(picture,&#160;pointerDown)&#160;{<br/>
this.dom&#160;=&#160;elt(&#34;canvas&#34;,&#160;{<br/>
onmousedown:&#160;event&#160;=&gt;&#160;this.mouse(event,&#160;pointerDown),<br/>ontouchstart:&#160;event&#160;=&gt;&#160;this.touch(event,&#160;pointerDown)<br/>
});<br/>this.syncState(picture);<br/>
}<br/>syncState(picture)&#160;{<br/>
if&#160;(this.picture&#160;==&#160;picture)&#160;return;<br/>this.picture&#160;=&#160;picture;<br/>drawPicture(this.picture,&#160;this.dom,&#160;scale);<br/>
}<br/>
}<br/>
We&#160;draw&#160;each&#160;pixel&#160;as&#160;a&#160;10-by-10&#160;square,&#160;as&#160;determined&#160;by&#160;the&#160;scale&#160;con-<br/>
stant.&#160;To&#160;avoid&#160;unnecessary&#160;work,&#160;the&#160;component&#160;keeps&#160;track&#160;of&#160;its&#160;current<br/>picture&#160;and&#160;does&#160;a&#160;redraw&#160;only&#160;when&#160;syncState&#160;is&#160;given&#160;a&#160;new&#160;picture.<br/>
The&#160;actual&#160;drawing&#160;function&#160;sets&#160;the&#160;size&#160;of&#160;the&#160;canvas&#160;based&#160;on&#160;the&#160;scale<br/>
and&#160;picture&#160;size&#160;and&#160;fills&#160;it&#160;with&#160;a&#160;series&#160;of&#160;squares,&#160;one&#160;for&#160;each&#160;pixel.<br/>
function&#160;drawPicture(picture,&#160;canvas,&#160;scale)&#160;{<br/>
canvas.width&#160;=&#160;picture.width&#160;*&#160;scale;<br/>canvas.height&#160;=&#160;picture.height&#160;*&#160;scale;<br/>let&#160;cx&#160;=&#160;canvas.getContext(&#34;2d&#34;);<br/>
for&#160;(let&#160;y&#160;=&#160;0;&#160;y&#160;&lt;&#160;picture.height;&#160;y++)&#160;{<br/>
for&#160;(let&#160;x&#160;=&#160;0;&#160;x&#160;&lt;&#160;picture.width;&#160;x++)&#160;{<br/>
cx.fillStyle&#160;=&#160;picture.pixel(x,&#160;y);<br/>cx.fillRect(x&#160;*&#160;scale,&#160;y&#160;*&#160;scale,&#160;scale,&#160;scale);<br/>
}<br/>
}<br/>
}<br/>
When&#160;the&#160;left&#160;mouse&#160;button&#160;is&#160;pressed&#160;while&#160;the&#160;mouse&#160;is&#160;over&#160;the&#160;picture<br/>
canvas,&#160;the&#160;component&#160;calls&#160;the&#160;pointerDown&#160;callback,&#160;giving&#160;it&#160;the&#160;position<br/>of&#160;the&#160;pixel&#160;that&#160;was&#160;clicked—in&#160;picture&#160;coordinates.&#160;This&#160;will&#160;be&#160;used&#160;to&#160;im-<br/>plement&#160;mouse&#160;interaction&#160;with&#160;the&#160;picture.&#160;The&#160;callback&#160;may&#160;return&#160;another<br/>callback&#160;function&#160;to&#160;be&#160;notified&#160;when&#160;the&#160;pointer&#160;is&#160;moved&#160;to&#160;a&#160;different&#160;pixel<br/>while&#160;the&#160;button&#160;is&#160;held&#160;down.<br/>
PictureCanvas.prototype.mouse&#160;=&#160;function(downEvent,&#160;onDown)&#160;{<br/>
if&#160;(downEvent.button&#160;!=&#160;0)&#160;return;<br/>
335<br/>
<hr/>
<a name=348></a>let&#160;pos&#160;=&#160;pointerPosition(downEvent,&#160;this.dom);<br/>let&#160;onMove&#160;=&#160;onDown(pos);<br/>if&#160;(!onMove)&#160;return;<br/>let&#160;move&#160;=&#160;moveEvent&#160;=&gt;&#160;{<br/>
if&#160;(moveEvent.buttons&#160;==&#160;0)&#160;{<br/>
this.dom.removeEventListener(&#34;mousemove&#34;,&#160;move);<br/>
}&#160;else&#160;{<br/>
let&#160;newPos&#160;=&#160;pointerPosition(moveEvent,&#160;this.dom);<br/>if&#160;(newPos.x&#160;==&#160;pos.x&#160;&amp;&amp;&#160;newPos.y&#160;==&#160;pos.y)&#160;return;<br/>pos&#160;=&#160;newPos;<br/>onMove(newPos);<br/>
}<br/>
};<br/>this.dom.addEventListener(&#34;mousemove&#34;,&#160;move);<br/>
};<br/>
function&#160;pointerPosition(pos,&#160;domNode)&#160;{<br/>
let&#160;rect&#160;=&#160;domNode.getBoundingClientRect();<br/>return&#160;{x:&#160;Math.floor((pos.clientX&#160;-&#160;rect.left)&#160;/&#160;scale),<br/>
y:&#160;Math.floor((pos.clientY&#160;-&#160;rect.top)&#160;/&#160;scale)};<br/>
}<br/>
Since&#160;we&#160;know&#160;the&#160;size&#160;of&#160;the&#160;pixels&#160;and&#160;we&#160;can&#160;use&#160;getBoundingClientRect<br/>
to&#160;find&#160;the&#160;position&#160;of&#160;the&#160;canvas&#160;on&#160;the&#160;screen,&#160;it&#160;is&#160;possible&#160;to&#160;go&#160;from&#160;mouse<br/>event&#160;coordinates&#160;(clientX&#160;and&#160;clientY)&#160;to&#160;picture&#160;coordinates.&#160;These&#160;are<br/>always&#160;rounded&#160;down&#160;so&#160;that&#160;they&#160;refer&#160;to&#160;a&#160;specific&#160;pixel.<br/>
With&#160;touch&#160;events,&#160;we&#160;have&#160;to&#160;do&#160;something&#160;similar,&#160;but&#160;using&#160;different<br/>
events&#160;and&#160;making&#160;sure&#160;we&#160;call&#160;preventDefault&#160;on&#160;the&#160;&#34;touchstart&#34;&#160;event&#160;to<br/>prevent&#160;panning.<br/>
PictureCanvas.prototype.touch&#160;=&#160;function(startEvent,<br/>
onDown)&#160;{<br/>
let&#160;pos&#160;=&#160;pointerPosition(startEvent.touches[0],&#160;this.dom);<br/>let&#160;onMove&#160;=&#160;onDown(pos);<br/>startEvent.preventDefault();<br/>if&#160;(!onMove)&#160;return;<br/>let&#160;move&#160;=&#160;moveEvent&#160;=&gt;&#160;{<br/>
let&#160;newPos&#160;=&#160;pointerPosition(moveEvent.touches[0],<br/>
this.dom);<br/>
if&#160;(newPos.x&#160;==&#160;pos.x&#160;&amp;&amp;&#160;newPos.y&#160;==&#160;pos.y)&#160;return;<br/>pos&#160;=&#160;newPos;<br/>onMove(newPos);<br/>
};<br/>let&#160;end&#160;=&#160;()&#160;=&gt;&#160;{<br/>
336<br/>
<hr/>
<a name=349></a>this.dom.removeEventListener(&#34;touchmove&#34;,&#160;move);<br/>this.dom.removeEventListener(&#34;touchend&#34;,&#160;end);<br/>
};<br/>this.dom.addEventListener(&#34;touchmove&#34;,&#160;move);<br/>this.dom.addEventListener(&#34;touchend&#34;,&#160;end);<br/>
};<br/>
For&#160;touch&#160;events,&#160;clientX&#160;and&#160;clientY&#160;aren’t&#160;available&#160;directly&#160;on&#160;the&#160;event<br/>
object,&#160;but&#160;we&#160;can&#160;use&#160;the&#160;coordinates&#160;of&#160;the&#160;first&#160;touch&#160;object&#160;in&#160;the&#160;touches<br/>property.<br/>
<b>The&#160;application</b><br/>
To&#160;make&#160;it&#160;possible&#160;to&#160;build&#160;the&#160;application&#160;piece&#160;by&#160;piece,&#160;we’ll&#160;implement&#160;the<br/>main&#160;component&#160;as&#160;a&#160;shell&#160;around&#160;a&#160;picture&#160;canvas&#160;and&#160;a&#160;dynamic&#160;set&#160;of&#160;tools<br/>and&#160;controls&#160;that&#160;we&#160;pass&#160;to&#160;its&#160;constructor.<br/>
The&#160;<i>controls&#160;</i>are&#160;the&#160;interface&#160;elements&#160;that&#160;appear&#160;below&#160;the&#160;picture.&#160;They’ll<br/>
be&#160;provided&#160;as&#160;an&#160;array&#160;of&#160;component&#160;constructors.<br/>
The&#160;<i>tools&#160;</i>do&#160;things&#160;like&#160;drawing&#160;pixels&#160;or&#160;filling&#160;in&#160;an&#160;area.&#160;The&#160;application<br/>
shows&#160;the&#160;set&#160;of&#160;available&#160;tools&#160;as&#160;a&#160;&lt;select&gt;&#160;field.&#160;The&#160;currently&#160;selected<br/>tool&#160;determines&#160;what&#160;happens&#160;when&#160;the&#160;user&#160;interacts&#160;with&#160;the&#160;picture&#160;with&#160;a<br/>pointer&#160;device.&#160;The&#160;set&#160;of&#160;available&#160;tools&#160;is&#160;provided&#160;as&#160;an&#160;object&#160;that&#160;maps<br/>the&#160;names&#160;that&#160;appear&#160;in&#160;the&#160;drop-down&#160;field&#160;to&#160;functions&#160;that&#160;implement&#160;the<br/>tools.&#160;Such&#160;functions&#160;get&#160;a&#160;picture&#160;position,&#160;a&#160;current&#160;application&#160;state,&#160;and<br/>a&#160;dispatch&#160;function&#160;as&#160;arguments.&#160;They&#160;may&#160;return&#160;a&#160;move&#160;handler&#160;function<br/>that&#160;gets&#160;called&#160;with&#160;a&#160;new&#160;position&#160;and&#160;a&#160;current&#160;state&#160;when&#160;the&#160;pointer&#160;moves<br/>to&#160;a&#160;different&#160;pixel.<br/>
class&#160;PixelEditor&#160;{<br/>
constructor(state,&#160;config)&#160;{<br/>
let&#160;{tools,&#160;controls,&#160;dispatch}&#160;=&#160;config;<br/>this.state&#160;=&#160;state;<br/>
this.canvas&#160;=&#160;new&#160;PictureCanvas(state.picture,&#160;pos&#160;=&gt;&#160;{<br/>
let&#160;tool&#160;=&#160;tools[this.state.tool];<br/>let&#160;onMove&#160;=&#160;tool(pos,&#160;this.state,&#160;dispatch);<br/>if&#160;(onMove)&#160;return&#160;pos&#160;=&gt;&#160;onMove(pos,&#160;this.state);<br/>
});<br/>this.controls&#160;=&#160;controls.map(<br/>
Control&#160;=&gt;&#160;new&#160;Control(state,&#160;config));<br/>
this.dom&#160;=&#160;elt(&#34;div&#34;,&#160;{},&#160;this.canvas.dom,&#160;elt(&#34;br&#34;),<br/>
...this.controls.reduce(<br/>
337<br/>
<hr/>
<a name=350></a>(a,&#160;c)&#160;=&gt;&#160;a.concat(&#34;&#160;&#34;,&#160;c.dom),&#160;[]));<br/>
}<br/>syncState(state)&#160;{<br/>
this.state&#160;=&#160;state;<br/>this.canvas.syncState(state.picture);<br/>for&#160;(let&#160;ctrl&#160;of&#160;this.controls)&#160;ctrl.syncState(state);<br/>
}<br/>
}<br/>
The&#160;pointer&#160;handler&#160;given&#160;to&#160;PictureCanvas&#160;calls&#160;the&#160;currently&#160;selected&#160;tool<br/>
with&#160;the&#160;appropriate&#160;arguments&#160;and,&#160;if&#160;that&#160;returns&#160;a&#160;move&#160;handler,&#160;adapts&#160;it<br/>to&#160;also&#160;receive&#160;the&#160;state.<br/>
All&#160;controls&#160;are&#160;constructed&#160;and&#160;stored&#160;in&#160;this.controls&#160;so&#160;that&#160;they&#160;can<br/>
be&#160;updated&#160;when&#160;the&#160;application&#160;state&#160;changes.&#160;The&#160;call&#160;to&#160;reduce&#160;introduces<br/>spaces&#160;between&#160;the&#160;controls’&#160;DOM&#160;elements.&#160;That&#160;way&#160;they&#160;don’t&#160;look&#160;so<br/>pressed&#160;together.<br/>
The&#160;first&#160;control&#160;is&#160;the&#160;tool&#160;selection&#160;menu.&#160;It&#160;creates&#160;a&#160;&lt;select&gt;&#160;element<br/>
with&#160;an&#160;option&#160;for&#160;each&#160;tool&#160;and&#160;sets&#160;up&#160;a&#160;&#34;change&#34;&#160;event&#160;handler&#160;that&#160;updates<br/>the&#160;application&#160;state&#160;when&#160;the&#160;user&#160;selects&#160;a&#160;different&#160;tool.<br/>
class&#160;ToolSelect&#160;{<br/>
constructor(state,&#160;{tools,&#160;dispatch})&#160;{<br/>
this.select&#160;=&#160;elt(&#34;select&#34;,&#160;{<br/>
onchange:&#160;()&#160;=&gt;&#160;dispatch({tool:&#160;this.select.value})<br/>
},&#160;...Object.keys(tools).map(name&#160;=&gt;&#160;elt(&#34;option&#34;,&#160;{<br/>
selected:&#160;name&#160;==&#160;state.tool<br/>
},&#160;name)));<br/>
this.dom&#160;=&#160;elt(&#34;label&#34;,&#160;null,&#160;&#34;🖌&#160;Tool:&#160;&#34;,&#160;this.select);<br/>
}<br/>syncState(state)&#160;{&#160;this.select.value&#160;=&#160;state.tool;&#160;}<br/>
}<br/>
By&#160;wrapping&#160;the&#160;label&#160;text&#160;and&#160;the&#160;field&#160;in&#160;a&#160;&lt;label&gt;&#160;element,&#160;we&#160;tell&#160;the<br/>
browser&#160;that&#160;the&#160;label&#160;belongs&#160;to&#160;that&#160;field&#160;so&#160;that&#160;you&#160;can,&#160;for&#160;example,&#160;click<br/>the&#160;label&#160;to&#160;focus&#160;the&#160;field.<br/>
We&#160;also&#160;need&#160;to&#160;be&#160;able&#160;to&#160;change&#160;the&#160;color,&#160;so&#160;let’s&#160;add&#160;a&#160;control&#160;for&#160;that.<br/>
An&#160;HTML&#160;&lt;input&gt;&#160;element&#160;with&#160;a&#160;type&#160;attribute&#160;of&#160;color&#160;gives&#160;us&#160;a&#160;form<br/>field&#160;that&#160;is&#160;specialized&#160;for&#160;selecting&#160;colors.&#160;Such&#160;a&#160;field’s&#160;value&#160;is&#160;always&#160;a<br/>CSS&#160;color&#160;code&#160;in&#160;&#34;#RRGGBB&#34;&#160;format&#160;(red,&#160;green,&#160;and&#160;blue&#160;components,&#160;two<br/>digits&#160;per&#160;color).&#160;The&#160;browser&#160;will&#160;show&#160;a&#160;color&#160;picker&#160;interface&#160;when&#160;the&#160;user<br/>interacts&#160;with&#160;it.<br/>
338<br/>
<hr/>
<a name=351></a><img src="eloquent-javascript-351_1.png"/><br/>
Depending&#160;on&#160;the&#160;browser,&#160;the&#160;color&#160;picker&#160;might&#160;look&#160;like&#160;this:<br/>
This&#160;control&#160;creates&#160;such&#160;a&#160;field&#160;and&#160;wires&#160;it&#160;up&#160;to&#160;stay&#160;synchronized&#160;with<br/>
the&#160;application&#160;state’s&#160;color&#160;property.<br/>
class&#160;ColorSelect&#160;{<br/>
constructor(state,&#160;{dispatch})&#160;{<br/>
this.input&#160;=&#160;elt(&#34;input&#34;,&#160;{<br/>
type:&#160;&#34;color&#34;,<br/>value:&#160;state.color,<br/>onchange:&#160;()&#160;=&gt;&#160;dispatch({color:&#160;this.input.value})<br/>
});<br/>this.dom&#160;=&#160;elt(&#34;label&#34;,&#160;null,&#160;&#34;🎨&#160;Color:&#160;&#34;,&#160;this.input);<br/>
}<br/>syncState(state)&#160;{&#160;this.input.value&#160;=&#160;state.color;&#160;}<br/>
}<br/>
<b>Drawing&#160;tools</b><br/>
Before&#160;we&#160;can&#160;draw&#160;anything,&#160;we&#160;need&#160;to&#160;implement&#160;the&#160;tools&#160;that&#160;will&#160;control<br/>the&#160;functionality&#160;of&#160;mouse&#160;or&#160;touch&#160;events&#160;on&#160;the&#160;canvas.<br/>
The&#160;most&#160;basic&#160;tool&#160;is&#160;the&#160;draw&#160;tool,&#160;which&#160;changes&#160;any&#160;pixel&#160;you&#160;click&#160;or<br/>
tap&#160;to&#160;the&#160;currently&#160;selected&#160;color.&#160;It&#160;dispatches&#160;an&#160;action&#160;that&#160;updates&#160;the<br/>picture&#160;to&#160;a&#160;version&#160;in&#160;which&#160;the&#160;pointed-at&#160;pixel&#160;is&#160;given&#160;the&#160;currently&#160;selected<br/>color.<br/>
function&#160;draw(pos,&#160;state,&#160;dispatch)&#160;{<br/>
function&#160;drawPixel({x,&#160;y},&#160;state)&#160;{<br/>
339<br/>
<hr/>
<a name=352></a>let&#160;drawn&#160;=&#160;{x,&#160;y,&#160;color:&#160;state.color};<br/>dispatch({picture:&#160;state.picture.draw([drawn])});<br/>
}<br/>drawPixel(pos,&#160;state);<br/>return&#160;drawPixel;<br/>
}<br/>
The&#160;function&#160;immediately&#160;calls&#160;the&#160;drawPixel&#160;function&#160;but&#160;then&#160;also&#160;returns<br/>
it&#160;so&#160;that&#160;it&#160;is&#160;called&#160;again&#160;for&#160;newly&#160;touched&#160;pixels&#160;when&#160;the&#160;user&#160;drags&#160;or<br/>swipes&#160;over&#160;the&#160;picture.<br/>
To&#160;draw&#160;larger&#160;shapes,&#160;it&#160;can&#160;be&#160;useful&#160;to&#160;quickly&#160;create&#160;rectangles.&#160;The<br/>
rectangle&#160;tool&#160;draws&#160;a&#160;rectangle&#160;between&#160;the&#160;point&#160;where&#160;you&#160;start&#160;dragging<br/>and&#160;the&#160;point&#160;that&#160;you&#160;drag&#160;to.<br/>
function&#160;rectangle(start,&#160;state,&#160;dispatch)&#160;{<br/>
function&#160;drawRectangle(pos)&#160;{<br/>
let&#160;xStart&#160;=&#160;Math.min(start.x,&#160;pos.x);<br/>let&#160;yStart&#160;=&#160;Math.min(start.y,&#160;pos.y);<br/>let&#160;xEnd&#160;=&#160;Math.max(start.x,&#160;pos.x);<br/>let&#160;yEnd&#160;=&#160;Math.max(start.y,&#160;pos.y);<br/>let&#160;drawn&#160;=&#160;[];<br/>for&#160;(let&#160;y&#160;=&#160;yStart;&#160;y&#160;&lt;=&#160;yEnd;&#160;y++)&#160;{<br/>
for&#160;(let&#160;x&#160;=&#160;xStart;&#160;x&#160;&lt;=&#160;xEnd;&#160;x++)&#160;{<br/>
drawn.push({x,&#160;y,&#160;color:&#160;state.color});<br/>
}<br/>
}<br/>dispatch({picture:&#160;state.picture.draw(drawn)});<br/>
}<br/>drawRectangle(start);<br/>return&#160;drawRectangle;<br/>
}<br/>
An&#160;important&#160;detail&#160;in&#160;this&#160;implementation&#160;is&#160;that&#160;when&#160;dragging,&#160;the&#160;rect-<br/>
angle&#160;is&#160;redrawn&#160;on&#160;the&#160;picture&#160;from&#160;the&#160;<i>original&#160;</i>state.&#160;That&#160;way,&#160;you&#160;can<br/>make&#160;the&#160;rectangle&#160;larger&#160;and&#160;smaller&#160;again&#160;while&#160;creating&#160;it,&#160;without&#160;the&#160;in-<br/>termediate&#160;rectangles&#160;sticking&#160;around&#160;in&#160;the&#160;final&#160;picture.&#160;This&#160;is&#160;one&#160;of&#160;the<br/>reasons&#160;why&#160;immutable&#160;picture&#160;objects&#160;are&#160;useful—we’ll&#160;see&#160;another&#160;reason<br/>later.<br/>
Implementing&#160;flood&#160;fill&#160;is&#160;somewhat&#160;more&#160;involved.&#160;This&#160;is&#160;a&#160;tool&#160;that&#160;fills<br/>
the&#160;pixel&#160;under&#160;the&#160;pointer&#160;and&#160;all&#160;adjacent&#160;pixels&#160;that&#160;have&#160;the&#160;same&#160;color.<br/>“Adjacent”&#160;means&#160;directly&#160;horizontally&#160;or&#160;vertically&#160;adjacent,&#160;not&#160;diagonally.<br/>This&#160;picture&#160;illustrates&#160;the&#160;set&#160;of&#160;pixels&#160;colored&#160;when&#160;the&#160;flood&#160;fill&#160;tool&#160;is&#160;used<br/>
340<br/>
<hr/>
<a name=353></a>at&#160;the&#160;marked&#160;pixel:<br/>
Interestingly,&#160;the&#160;way&#160;we’ll&#160;do&#160;this&#160;looks&#160;a&#160;bit&#160;like&#160;the&#160;pathfinding&#160;code&#160;from<br/>
<a href="eloquent-javascripts.html#129">Chapter&#160;7.&#160;</a>Whereas&#160;that&#160;code&#160;searched&#160;through&#160;a&#160;graph&#160;to&#160;find&#160;a&#160;route,&#160;this<br/>code&#160;searches&#160;through&#160;a&#160;grid&#160;to&#160;find&#160;all&#160;“connected”&#160;pixels.&#160;The&#160;problem&#160;of<br/>keeping&#160;track&#160;of&#160;a&#160;branching&#160;set&#160;of&#160;possible&#160;routes&#160;is&#160;similar.<br/>
const&#160;around&#160;=&#160;[{dx:&#160;-1,&#160;dy:&#160;0},&#160;{dx:&#160;1,&#160;dy:&#160;0},<br/>
{dx:&#160;0,&#160;dy:&#160;-1},&#160;{dx:&#160;0,&#160;dy:&#160;1}];<br/>
function&#160;fill({x,&#160;y},&#160;state,&#160;dispatch)&#160;{<br/>
let&#160;targetColor&#160;=&#160;state.picture.pixel(x,&#160;y);<br/>let&#160;drawn&#160;=&#160;[{x,&#160;y,&#160;color:&#160;state.color}];<br/>for&#160;(let&#160;done&#160;=&#160;0;&#160;done&#160;&lt;&#160;drawn.length;&#160;done++)&#160;{<br/>
for&#160;(let&#160;{dx,&#160;dy}&#160;of&#160;around)&#160;{<br/>
let&#160;x&#160;=&#160;drawn[done].x&#160;+&#160;dx,&#160;y&#160;=&#160;drawn[done].y&#160;+&#160;dy;<br/>if&#160;(x&#160;&gt;=&#160;0&#160;&amp;&amp;&#160;x&#160;&lt;&#160;state.picture.width&#160;&amp;&amp;<br/>
y&#160;&gt;=&#160;0&#160;&amp;&amp;&#160;y&#160;&lt;&#160;state.picture.height&#160;&amp;&amp;<br/>state.picture.pixel(x,&#160;y)&#160;==&#160;targetColor&#160;&amp;&amp;<br/>!drawn.some(p&#160;=&gt;&#160;p.x&#160;==&#160;x&#160;&amp;&amp;&#160;p.y&#160;==&#160;y))&#160;{<br/>
drawn.push({x,&#160;y,&#160;color:&#160;state.color});<br/>
}<br/>
}<br/>
}<br/>dispatch({picture:&#160;state.picture.draw(drawn)});<br/>
}<br/>
The&#160;array&#160;of&#160;drawn&#160;pixels&#160;doubles&#160;as&#160;the&#160;function’s&#160;work&#160;list.&#160;For&#160;each&#160;pixel<br/>
reached,&#160;we&#160;have&#160;to&#160;see&#160;whether&#160;any&#160;adjacent&#160;pixels&#160;have&#160;the&#160;same&#160;color&#160;and<br/>haven’t&#160;already&#160;been&#160;painted&#160;over.&#160;The&#160;loop&#160;counter&#160;lags&#160;behind&#160;the&#160;length&#160;of<br/>the&#160;drawn&#160;array&#160;as&#160;new&#160;pixels&#160;are&#160;added.&#160;Any&#160;pixels&#160;ahead&#160;of&#160;it&#160;still&#160;need&#160;to<br/>be&#160;explored.&#160;When&#160;it&#160;catches&#160;up&#160;with&#160;the&#160;length,&#160;no&#160;unexplored&#160;pixels&#160;remain,<br/>and&#160;the&#160;function&#160;is&#160;done.<br/>
The&#160;final&#160;tool&#160;is&#160;a&#160;color&#160;picker,&#160;which&#160;allows&#160;you&#160;to&#160;point&#160;at&#160;a&#160;color&#160;in&#160;the<br/>
picture&#160;to&#160;use&#160;it&#160;as&#160;the&#160;current&#160;drawing&#160;color.<br/>
function&#160;pick(pos,&#160;state,&#160;dispatch)&#160;{<br/>
341<br/>
<hr/>
<a name=354></a>dispatch({color:&#160;state.picture.pixel(pos.x,&#160;pos.y)});<br/>
}<br/>
<b>Saving&#160;and&#160;loading</b><br/>
When&#160;we’ve&#160;drawn&#160;our&#160;masterpiece,&#160;we’ll&#160;want&#160;to&#160;save&#160;it&#160;for&#160;later.&#160;We&#160;should<br/>add&#160;a&#160;button&#160;for&#160;downloading&#160;the&#160;current&#160;picture&#160;as&#160;an&#160;image&#160;file.&#160;This&#160;control<br/>provides&#160;that&#160;button:<br/>
class&#160;SaveButton&#160;{<br/>
constructor(state)&#160;{<br/>
this.picture&#160;=&#160;state.picture;<br/>this.dom&#160;=&#160;elt(&#34;button&#34;,&#160;{<br/>
onclick:&#160;()&#160;=&gt;&#160;this.save()<br/>
},&#160;&#34;💾&#160;Save&#34;);<br/>
}<br/>save()&#160;{<br/>
let&#160;canvas&#160;=&#160;elt(&#34;canvas&#34;);<br/>drawPicture(this.picture,&#160;canvas,&#160;1);<br/>let&#160;link&#160;=&#160;elt(&#34;a&#34;,&#160;{<br/>
href:&#160;canvas.toDataURL(),<br/>download:&#160;&#34;pixelart.png&#34;<br/>
});<br/>document.body.appendChild(link);<br/>link.click();<br/>link.remove();<br/>
}<br/>syncState(state)&#160;{&#160;this.picture&#160;=&#160;state.picture;&#160;}<br/>
}<br/>
The&#160;component&#160;keeps&#160;track&#160;of&#160;the&#160;current&#160;picture&#160;so&#160;that&#160;it&#160;can&#160;access&#160;it<br/>
when&#160;saving.&#160;To&#160;create&#160;the&#160;image&#160;file,&#160;it&#160;uses&#160;a&#160;&lt;canvas&gt;&#160;element&#160;that&#160;it&#160;draws<br/>the&#160;picture&#160;on&#160;(at&#160;a&#160;scale&#160;of&#160;one&#160;pixel&#160;per&#160;pixel).<br/>
The&#160;toDataURL&#160;method&#160;on&#160;a&#160;canvas&#160;element&#160;creates&#160;a&#160;URL&#160;that&#160;starts&#160;with<br/>
data:.&#160;Unlike&#160;http:&#160;and&#160;https:&#160;URLs,&#160;data&#160;URLs&#160;contain&#160;the&#160;whole&#160;resource<br/>in&#160;the&#160;URL.&#160;They&#160;are&#160;usually&#160;very&#160;long,&#160;but&#160;they&#160;allow&#160;us&#160;to&#160;create&#160;working<br/>links&#160;to&#160;arbitrary&#160;pictures,&#160;right&#160;here&#160;in&#160;the&#160;browser.<br/>
To&#160;actually&#160;get&#160;the&#160;browser&#160;to&#160;download&#160;the&#160;picture,&#160;we&#160;then&#160;create&#160;a&#160;link<br/>
element&#160;that&#160;points&#160;at&#160;this&#160;URL&#160;and&#160;has&#160;a&#160;download&#160;attribute.&#160;Such&#160;links,<br/>when&#160;clicked,&#160;make&#160;the&#160;browser&#160;show&#160;a&#160;file&#160;save&#160;dialog.&#160;We&#160;add&#160;that&#160;link&#160;to<br/>
342<br/>
<hr/>
<a name=355></a>the&#160;document,&#160;simulate&#160;a&#160;click&#160;on&#160;it,&#160;and&#160;remove&#160;it&#160;again.<br/>
You&#160;can&#160;do&#160;a&#160;lot&#160;with&#160;browser&#160;technology,&#160;but&#160;sometimes&#160;the&#160;way&#160;to&#160;do&#160;it&#160;is<br/>
rather&#160;odd.<br/>
And&#160;it&#160;gets&#160;worse.&#160;We’ll&#160;also&#160;want&#160;to&#160;be&#160;able&#160;to&#160;load&#160;existing&#160;image&#160;files&#160;into<br/>
our&#160;application.&#160;To&#160;do&#160;that,&#160;we&#160;again&#160;define&#160;a&#160;button&#160;component.<br/>
class&#160;LoadButton&#160;{<br/>
constructor(_,&#160;{dispatch})&#160;{<br/>
this.dom&#160;=&#160;elt(&#34;button&#34;,&#160;{<br/>
onclick:&#160;()&#160;=&gt;&#160;startLoad(dispatch)<br/>
},&#160;&#34;📁&#160;Load&#34;);<br/>
}<br/>syncState()&#160;{}<br/>
}<br/>
function&#160;startLoad(dispatch)&#160;{<br/>
let&#160;input&#160;=&#160;elt(&#34;input&#34;,&#160;{<br/>
type:&#160;&#34;file&#34;,<br/>onchange:&#160;()&#160;=&gt;&#160;finishLoad(input.files[0],&#160;dispatch)<br/>
});<br/>document.body.appendChild(input);<br/>input.click();<br/>input.remove();<br/>
}<br/>
To&#160;get&#160;access&#160;to&#160;a&#160;file&#160;on&#160;the&#160;user’s&#160;computer,&#160;we&#160;need&#160;the&#160;user&#160;to&#160;select&#160;the<br/>
file&#160;through&#160;a&#160;file&#160;input&#160;field.&#160;But&#160;I&#160;don’t&#160;want&#160;the&#160;load&#160;button&#160;to&#160;look&#160;like&#160;a<br/>file&#160;input&#160;field,&#160;so&#160;we&#160;create&#160;the&#160;file&#160;input&#160;when&#160;the&#160;button&#160;is&#160;clicked&#160;and&#160;then<br/>pretend&#160;that&#160;this&#160;file&#160;input&#160;itself&#160;was&#160;clicked.<br/>
When&#160;the&#160;user&#160;has&#160;selected&#160;a&#160;file,&#160;we&#160;can&#160;use&#160;FileReader&#160;to&#160;get&#160;access&#160;to<br/>
its&#160;contents,&#160;again&#160;as&#160;a&#160;data&#160;URL.&#160;That&#160;URL&#160;can&#160;be&#160;used&#160;to&#160;create&#160;an&#160;&lt;img&gt;<br/>element,&#160;but&#160;because&#160;we&#160;can’t&#160;get&#160;direct&#160;access&#160;to&#160;the&#160;pixels&#160;in&#160;such&#160;an&#160;image,<br/>we&#160;can’t&#160;create&#160;a&#160;Picture&#160;object&#160;from&#160;that.<br/>
function&#160;finishLoad(file,&#160;dispatch)&#160;{<br/>
if&#160;(file&#160;==&#160;null)&#160;return;<br/>let&#160;reader&#160;=&#160;new&#160;FileReader();<br/>reader.addEventListener(&#34;load&#34;,&#160;()&#160;=&gt;&#160;{<br/>
let&#160;image&#160;=&#160;elt(&#34;img&#34;,&#160;{<br/>
onload:&#160;()&#160;=&gt;&#160;dispatch({<br/>
picture:&#160;pictureFromImage(image)<br/>
}),<br/>src:&#160;reader.result<br/>
343<br/>
<hr/>
<a name=356></a>});<br/>
});<br/>reader.readAsDataURL(file);<br/>
}<br/>
To&#160;get&#160;access&#160;to&#160;the&#160;pixels,&#160;we&#160;must&#160;first&#160;draw&#160;the&#160;picture&#160;to&#160;a&#160;&lt;canvas&gt;<br/>
element.&#160;The&#160;canvas&#160;context&#160;has&#160;a&#160;getImageData&#160;method&#160;that&#160;allows&#160;a&#160;script<br/>to&#160;read&#160;its&#160;pixels.&#160;So,&#160;once&#160;the&#160;picture&#160;is&#160;on&#160;the&#160;canvas,&#160;we&#160;can&#160;access&#160;it&#160;and<br/>construct&#160;a&#160;Picture&#160;object.<br/>
function&#160;pictureFromImage(image)&#160;{<br/>
let&#160;width&#160;=&#160;Math.min(100,&#160;image.width);<br/>let&#160;height&#160;=&#160;Math.min(100,&#160;image.height);<br/>let&#160;canvas&#160;=&#160;elt(&#34;canvas&#34;,&#160;{width,&#160;height});<br/>let&#160;cx&#160;=&#160;canvas.getContext(&#34;2d&#34;);<br/>cx.drawImage(image,&#160;0,&#160;0);<br/>let&#160;pixels&#160;=&#160;[];<br/>let&#160;{data}&#160;=&#160;cx.getImageData(0,&#160;0,&#160;width,&#160;height);<br/>
function&#160;hex(n)&#160;{<br/>
return&#160;n.toString(16).padStart(2,&#160;&#34;0&#34;);<br/>
}<br/>for&#160;(let&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;data.length;&#160;i&#160;+=&#160;4)&#160;{<br/>
let&#160;[r,&#160;g,&#160;b]&#160;=&#160;data.slice(i,&#160;i&#160;+&#160;3);<br/>pixels.push(&#34;#&#34;&#160;+&#160;hex(r)&#160;+&#160;hex(g)&#160;+&#160;hex(b));<br/>
}<br/>return&#160;new&#160;Picture(width,&#160;height,&#160;pixels);<br/>
}<br/>
We’ll&#160;limit&#160;the&#160;size&#160;of&#160;images&#160;to&#160;100&#160;by&#160;100&#160;pixels&#160;since&#160;anything&#160;bigger&#160;will<br/>
look&#160;<i>huge&#160;</i>on&#160;our&#160;display&#160;and&#160;might&#160;slow&#160;down&#160;the&#160;interface.<br/>
The&#160;data&#160;property&#160;of&#160;the&#160;object&#160;returned&#160;by&#160;getImageData&#160;is&#160;an&#160;array&#160;of&#160;color<br/>
components.&#160;For&#160;each&#160;pixel&#160;in&#160;the&#160;rectangle&#160;specified&#160;by&#160;the&#160;arguments,&#160;it&#160;con-<br/>tains&#160;four&#160;values,&#160;which&#160;represent&#160;the&#160;red,&#160;green,&#160;blue,&#160;and&#160;<i>alpha&#160;</i>components<br/>of&#160;the&#160;pixel’s&#160;color,&#160;as&#160;numbers&#160;between&#160;0&#160;and&#160;255.&#160;The&#160;alpha&#160;part&#160;represents<br/>opacity—when&#160;it&#160;is&#160;zero,&#160;the&#160;pixel&#160;is&#160;fully&#160;transparent,&#160;and&#160;when&#160;it&#160;is&#160;255,&#160;it<br/>is&#160;fully&#160;opaque.&#160;For&#160;our&#160;purpose,&#160;we&#160;can&#160;ignore&#160;it.<br/>
The&#160;two&#160;hexadecimal&#160;digits&#160;per&#160;component,&#160;as&#160;used&#160;in&#160;our&#160;color&#160;notation,<br/>
correspond&#160;precisely&#160;to&#160;the&#160;0&#160;to&#160;255&#160;range—two&#160;base-16&#160;digits&#160;can&#160;express&#160;162<br/>=&#160;256&#160;different&#160;numbers.&#160;The&#160;toString&#160;method&#160;of&#160;numbers&#160;can&#160;be&#160;given&#160;a<br/>base&#160;as&#160;argument,&#160;so&#160;n.toString(16)&#160;will&#160;produce&#160;a&#160;string&#160;representation&#160;in<br/>base&#160;16.&#160;We&#160;have&#160;to&#160;make&#160;sure&#160;that&#160;each&#160;number&#160;takes&#160;up&#160;two&#160;digits,&#160;so&#160;the<br/>
344<br/>
<hr/>
<a name=357></a>hex&#160;helper&#160;function&#160;calls&#160;padStart&#160;to&#160;add&#160;a&#160;leading&#160;zero&#160;when&#160;necessary.<br/>
We&#160;can&#160;load&#160;and&#160;save&#160;now!&#160;That&#160;leaves&#160;one&#160;more&#160;feature&#160;before&#160;we’re&#160;done.<br/>
<b>Undo&#160;history</b><br/>
Half&#160;of&#160;the&#160;process&#160;of&#160;editing&#160;is&#160;making&#160;little&#160;mistakes&#160;and&#160;correcting&#160;them.&#160;So<br/>an&#160;important&#160;feature&#160;in&#160;a&#160;drawing&#160;program&#160;is&#160;an&#160;undo&#160;history.<br/>
To&#160;be&#160;able&#160;to&#160;undo&#160;changes,&#160;we&#160;need&#160;to&#160;store&#160;previous&#160;versions&#160;of&#160;the&#160;picture.<br/>
Since&#160;it’s&#160;an&#160;immutable&#160;value,&#160;that&#160;is&#160;easy.&#160;But&#160;it&#160;does&#160;require&#160;an&#160;additional<br/>field&#160;in&#160;the&#160;application&#160;state.<br/>
We’ll&#160;add&#160;a&#160;done&#160;array&#160;to&#160;keep&#160;previous&#160;versions&#160;of&#160;the&#160;picture.&#160;Maintaining<br/>
this&#160;property&#160;requires&#160;a&#160;more&#160;complicated&#160;state&#160;update&#160;function&#160;that&#160;adds<br/>pictures&#160;to&#160;the&#160;array.<br/>
But&#160;we&#160;don’t&#160;want&#160;to&#160;store&#160;<i>every&#160;</i>change,&#160;only&#160;changes&#160;a&#160;certain&#160;amount<br/>
of&#160;time&#160;apart.&#160;To&#160;be&#160;able&#160;to&#160;do&#160;that,&#160;we’ll&#160;need&#160;a&#160;second&#160;property,&#160;doneAt,<br/>tracking&#160;the&#160;time&#160;at&#160;which&#160;we&#160;last&#160;stored&#160;a&#160;picture&#160;in&#160;the&#160;history.<br/>
function&#160;historyUpdateState(state,&#160;action)&#160;{<br/>
if&#160;(action.undo&#160;==&#160;true)&#160;{<br/>
if&#160;(state.done.length&#160;==&#160;0)&#160;return&#160;state;<br/>return&#160;Object.assign({},&#160;state,&#160;{<br/>
picture:&#160;state.done[0],<br/>done:&#160;state.done.slice(1),<br/>doneAt:&#160;0<br/>
});<br/>
}&#160;else&#160;if&#160;(action.picture&#160;&amp;&amp;<br/>
state.doneAt&#160;&lt;&#160;Date.now()&#160;-&#160;1000)&#160;{<br/>
return&#160;Object.assign({},&#160;state,&#160;action,&#160;{<br/>
done:&#160;[state.picture,&#160;...state.done],<br/>doneAt:&#160;Date.now()<br/>
});<br/>
}&#160;else&#160;{<br/>
return&#160;Object.assign({},&#160;state,&#160;action);<br/>
}<br/>
}<br/>
When&#160;the&#160;action&#160;is&#160;an&#160;undo&#160;action,&#160;the&#160;function&#160;takes&#160;the&#160;most&#160;recent&#160;picture<br/>
from&#160;the&#160;history&#160;and&#160;makes&#160;that&#160;the&#160;current&#160;picture.&#160;It&#160;sets&#160;doneAt&#160;to&#160;zero&#160;so<br/>that&#160;the&#160;next&#160;change&#160;is&#160;guaranteed&#160;to&#160;store&#160;the&#160;picture&#160;back&#160;in&#160;the&#160;history,<br/>allowing&#160;you&#160;to&#160;revert&#160;to&#160;it&#160;another&#160;time&#160;if&#160;you&#160;want.<br/>
Otherwise,&#160;if&#160;the&#160;action&#160;contains&#160;a&#160;new&#160;picture&#160;and&#160;the&#160;last&#160;time&#160;we&#160;stored<br/>
something&#160;is&#160;more&#160;than&#160;a&#160;second&#160;(1000&#160;milliseconds)&#160;ago,&#160;the&#160;done&#160;and&#160;doneAt<br/>
345<br/>
<hr/>
<a name=358></a>properties&#160;are&#160;updated&#160;to&#160;store&#160;the&#160;previous&#160;picture.<br/>
The&#160;undo&#160;button&#160;component&#160;doesn’t&#160;do&#160;much.&#160;It&#160;dispatches&#160;undo&#160;actions<br/>
when&#160;clicked&#160;and&#160;disables&#160;itself&#160;when&#160;there&#160;is&#160;nothing&#160;to&#160;undo.<br/>
class&#160;UndoButton&#160;{<br/>
constructor(state,&#160;{dispatch})&#160;{<br/>
this.dom&#160;=&#160;elt(&#34;button&#34;,&#160;{<br/>
onclick:&#160;()&#160;=&gt;&#160;dispatch({undo:&#160;true}),<br/>disabled:&#160;state.done.length&#160;==&#160;0<br/>
},&#160;&#34;⮪&#160;Undo&#34;);<br/>
}<br/>syncState(state)&#160;{<br/>
this.dom.disabled&#160;=&#160;state.done.length&#160;==&#160;0;<br/>
}<br/>
}<br/>
<b>Let's&#160;draw</b><br/>
To&#160;set&#160;up&#160;the&#160;application,&#160;we&#160;need&#160;to&#160;create&#160;a&#160;state,&#160;a&#160;set&#160;of&#160;tools,&#160;a&#160;set<br/>of&#160;controls,&#160;and&#160;a&#160;dispatch&#160;function.&#160;We&#160;can&#160;pass&#160;them&#160;to&#160;the&#160;PixelEditor<br/>constructor&#160;to&#160;create&#160;the&#160;main&#160;component.&#160;Since&#160;we’ll&#160;need&#160;to&#160;create&#160;several<br/>editors&#160;in&#160;the&#160;exercises,&#160;we&#160;first&#160;define&#160;some&#160;bindings.<br/>
const&#160;startState&#160;=&#160;{<br/>
tool:&#160;&#34;draw&#34;,<br/>color:&#160;&#34;#000000&#34;,<br/>picture:&#160;Picture.empty(60,&#160;30,&#160;&#34;#f0f0f0&#34;),<br/>done:&#160;[],<br/>doneAt:&#160;0<br/>
};<br/>
const&#160;baseTools&#160;=&#160;{draw,&#160;fill,&#160;rectangle,&#160;pick};<br/>
const&#160;baseControls&#160;=&#160;[<br/>
ToolSelect,&#160;ColorSelect,&#160;SaveButton,&#160;LoadButton,&#160;UndoButton<br/>
];<br/>
function&#160;startPixelEditor({state&#160;=&#160;startState,<br/>
tools&#160;=&#160;baseTools,<br/>controls&#160;=&#160;baseControls})&#160;{<br/>
let&#160;app&#160;=&#160;new&#160;PixelEditor(state,&#160;{<br/>
tools,<br/>controls,<br/>
346<br/>
<hr/>
<a name=359></a>dispatch(action)&#160;{<br/>
state&#160;=&#160;historyUpdateState(state,&#160;action);<br/>app.syncState(state);<br/>
}<br/>
});<br/>return&#160;app.dom;<br/>
}<br/>
When&#160;destructuring&#160;an&#160;object&#160;or&#160;array,&#160;you&#160;can&#160;use&#160;=&#160;after&#160;a&#160;binding&#160;name&#160;to<br/>
give&#160;the&#160;binding&#160;a&#160;default&#160;value,&#160;which&#160;is&#160;used&#160;when&#160;the&#160;property&#160;is&#160;missing&#160;or<br/>holds&#160;undefined.&#160;The&#160;startPixelEditor&#160;function&#160;makes&#160;use&#160;of&#160;this&#160;to&#160;accept<br/>an&#160;object&#160;with&#160;a&#160;number&#160;of&#160;optional&#160;properties&#160;as&#160;an&#160;argument.&#160;If&#160;you&#160;don’t<br/>provide&#160;a&#160;tools&#160;property,&#160;for&#160;example,&#160;tools&#160;will&#160;be&#160;bound&#160;to&#160;baseTools.<br/>
This&#160;is&#160;how&#160;we&#160;get&#160;an&#160;actual&#160;editor&#160;on&#160;the&#160;screen:<br/>
&lt;div&gt;&lt;/div&gt;<br/>&lt;script&gt;<br/>
document.querySelector(&#34;div&#34;)<br/>
.appendChild(startPixelEditor({}));<br/>
&lt;/script&gt;<br/>
<b>Why&#160;is&#160;this&#160;so&#160;hard?</b><br/>
Browser&#160;technology&#160;is&#160;amazing.&#160;It&#160;provides&#160;a&#160;powerful&#160;set&#160;of&#160;interface&#160;building<br/>blocks,&#160;ways&#160;to&#160;style&#160;and&#160;manipulate&#160;them,&#160;and&#160;tools&#160;to&#160;inspect&#160;and&#160;debug&#160;your<br/>applications.&#160;The&#160;software&#160;you&#160;write&#160;for&#160;the&#160;browser&#160;can&#160;be&#160;run&#160;on&#160;almost&#160;every<br/>computer&#160;and&#160;phone&#160;on&#160;the&#160;planet.<br/>
At&#160;the&#160;same&#160;time,&#160;browser&#160;technology&#160;is&#160;ridiculous.&#160;You&#160;have&#160;to&#160;learn&#160;a<br/>
large&#160;number&#160;of&#160;silly&#160;tricks&#160;and&#160;obscure&#160;facts&#160;to&#160;master&#160;it,&#160;and&#160;the&#160;default<br/>programming&#160;model&#160;it&#160;provides&#160;is&#160;so&#160;problematic&#160;that&#160;most&#160;programmers&#160;prefer<br/>to&#160;cover&#160;it&#160;in&#160;several&#160;layers&#160;of&#160;abstraction&#160;rather&#160;than&#160;deal&#160;with&#160;it&#160;directly.<br/>
And&#160;though&#160;the&#160;situation&#160;is&#160;definitely&#160;improving,&#160;it&#160;mostly&#160;does&#160;so&#160;in&#160;the<br/>
form&#160;of&#160;more&#160;elements&#160;being&#160;added&#160;to&#160;address&#160;shortcomings—creating&#160;even<br/>more&#160;complexity.&#160;A&#160;feature&#160;used&#160;by&#160;a&#160;million&#160;websites&#160;can’t&#160;really&#160;be&#160;replaced.<br/>Even&#160;if&#160;it&#160;could,&#160;it&#160;would&#160;be&#160;hard&#160;to&#160;decide&#160;what&#160;it&#160;should&#160;be&#160;replaced&#160;with.<br/>
Technology&#160;never&#160;exists&#160;in&#160;a&#160;vacuum—we’re&#160;constrained&#160;by&#160;our&#160;tools&#160;and<br/>
the&#160;social,&#160;economic,&#160;and&#160;historical&#160;factors&#160;that&#160;produced&#160;them.&#160;This&#160;can&#160;be<br/>annoying,&#160;but&#160;it&#160;is&#160;generally&#160;more&#160;productive&#160;to&#160;try&#160;to&#160;build&#160;a&#160;good&#160;under-<br/>standing&#160;of&#160;how&#160;the&#160;<i>existing&#160;</i>technical&#160;reality&#160;works—and&#160;why&#160;it&#160;is&#160;the&#160;way&#160;it<br/>
347<br/>
<hr/>
<a name=360></a>is—than&#160;to&#160;rage&#160;against&#160;it&#160;or&#160;hold&#160;out&#160;for&#160;another&#160;reality.<br/>
New&#160;abstractions&#160;<i>can&#160;</i>be&#160;helpful.&#160;The&#160;component&#160;model&#160;and&#160;data&#160;flow&#160;con-<br/>
vention&#160;I&#160;used&#160;in&#160;this&#160;chapter&#160;is&#160;a&#160;crude&#160;form&#160;of&#160;that.&#160;As&#160;mentioned,&#160;there&#160;are<br/>libraries&#160;that&#160;try&#160;to&#160;make&#160;user&#160;interface&#160;programming&#160;more&#160;pleasant.&#160;At&#160;the<br/>time&#160;of&#160;writing,&#160;<a href="https://reactjs.org/">React&#160;</a>and&#160;<a href="https://angular.io/">Angular&#160;</a>are&#160;popular&#160;choices,&#160;but&#160;there’s&#160;a&#160;whole<br/>cottage&#160;industry&#160;of&#160;such&#160;frameworks.&#160;If&#160;you’re&#160;interested&#160;in&#160;programming&#160;web<br/>applications,&#160;I&#160;recommend&#160;investigating&#160;a&#160;few&#160;of&#160;them&#160;to&#160;understand&#160;how&#160;they<br/>work&#160;and&#160;what&#160;benefits&#160;they&#160;provide.<br/>
<b>Exercises</b><br/>
There&#160;is&#160;still&#160;room&#160;for&#160;improvement&#160;in&#160;our&#160;program.&#160;Let’s&#160;add&#160;a&#160;few&#160;more<br/>features&#160;as&#160;exercises.<br/>
<b>Keyboard&#160;bindings</b><br/>
Add&#160;keyboard&#160;shortcuts&#160;to&#160;the&#160;application.&#160;The&#160;first&#160;letter&#160;of&#160;a&#160;tool’s&#160;name<br/>selects&#160;the&#160;tool,&#160;and&#160;control-Z&#160;or&#160;command-Z&#160;activates&#160;undo.<br/>
Do&#160;this&#160;by&#160;modifying&#160;the&#160;PixelEditor&#160;component.&#160;Add&#160;a&#160;tabIndex&#160;property<br/>
of&#160;0&#160;to&#160;the&#160;wrapping&#160;&lt;div&gt;&#160;element&#160;so&#160;that&#160;it&#160;can&#160;receive&#160;keyboard&#160;focus.&#160;Note<br/>that&#160;the&#160;<i>property&#160;</i>corresponding&#160;to&#160;the&#160;tabindex&#160;<i>attribute&#160;</i>is&#160;called&#160;tabIndex,<br/>with&#160;a&#160;capital&#160;I,&#160;and&#160;our&#160;elt&#160;function&#160;expects&#160;property&#160;names.&#160;Register&#160;the&#160;key<br/>event&#160;handlers&#160;directly&#160;on&#160;that&#160;element.&#160;This&#160;means&#160;you&#160;have&#160;to&#160;click,&#160;touch,<br/>or&#160;tab&#160;to&#160;the&#160;application&#160;before&#160;you&#160;can&#160;interact&#160;with&#160;it&#160;with&#160;the&#160;keyboard.<br/>
Remember&#160;that&#160;keyboard&#160;events&#160;have&#160;ctrlKey&#160;and&#160;metaKey&#160;(for&#160;the&#160;com-<br/>
mand&#160;key&#160;on&#160;Mac)&#160;properties&#160;that&#160;you&#160;can&#160;use&#160;to&#160;see&#160;whether&#160;those&#160;keys&#160;are<br/>held&#160;down.<br/>
<b>Efficient&#160;drawing</b><br/>
During&#160;drawing,&#160;the&#160;majority&#160;of&#160;work&#160;that&#160;our&#160;application&#160;does&#160;happens&#160;in<br/>drawPicture.&#160;Creating&#160;a&#160;new&#160;state&#160;and&#160;updating&#160;the&#160;rest&#160;of&#160;the&#160;DOM&#160;isn’t<br/>very&#160;expensive,&#160;but&#160;repainting&#160;all&#160;the&#160;pixels&#160;on&#160;the&#160;canvas&#160;is&#160;quite&#160;a&#160;bit&#160;of<br/>work.<br/>
Find&#160;a&#160;way&#160;to&#160;make&#160;the&#160;syncState&#160;method&#160;of&#160;PictureCanvas&#160;faster&#160;by&#160;re-<br/>
drawing&#160;only&#160;the&#160;pixels&#160;that&#160;actually&#160;changed.<br/>
Remember&#160;that&#160;drawPicture&#160;is&#160;also&#160;used&#160;by&#160;the&#160;save&#160;button,&#160;so&#160;if&#160;you&#160;change<br/>
it,&#160;either&#160;make&#160;sure&#160;the&#160;changes&#160;don’t&#160;break&#160;the&#160;old&#160;use&#160;or&#160;create&#160;a&#160;new&#160;version<br/>with&#160;a&#160;different&#160;name.<br/>
348<br/>
<hr/>
<a name=361></a>Also&#160;note&#160;that&#160;changing&#160;the&#160;size&#160;of&#160;a&#160;&lt;canvas&gt;&#160;element,&#160;by&#160;setting&#160;its&#160;width<br/>
or&#160;height&#160;properties,&#160;clears&#160;it,&#160;making&#160;it&#160;entirely&#160;transparent&#160;again.<br/>
<b>Circles</b><br/>
Define&#160;a&#160;tool&#160;called&#160;circle&#160;that&#160;draws&#160;a&#160;filled&#160;circle&#160;when&#160;you&#160;drag.&#160;The&#160;center<br/>of&#160;the&#160;circle&#160;lies&#160;at&#160;the&#160;point&#160;where&#160;the&#160;drag&#160;or&#160;touch&#160;gesture&#160;starts,&#160;and&#160;its<br/>radius&#160;is&#160;determined&#160;by&#160;the&#160;distance&#160;dragged.<br/>
<b>Proper&#160;lines</b><br/>
This&#160;is&#160;a&#160;more&#160;advanced&#160;exercise&#160;than&#160;the&#160;preceding&#160;two,&#160;and&#160;it&#160;will&#160;require<br/>you&#160;to&#160;design&#160;a&#160;solution&#160;to&#160;a&#160;nontrivial&#160;problem.&#160;Make&#160;sure&#160;you&#160;have&#160;plenty<br/>of&#160;time&#160;and&#160;patience&#160;before&#160;starting&#160;to&#160;work&#160;on&#160;this&#160;exercise,&#160;and&#160;do&#160;not&#160;get<br/>discouraged&#160;by&#160;initial&#160;failures.<br/>
On&#160;most&#160;browsers,&#160;when&#160;you&#160;select&#160;the&#160;draw&#160;tool&#160;and&#160;quickly&#160;drag&#160;across<br/>
the&#160;picture,&#160;you&#160;don’t&#160;get&#160;a&#160;closed&#160;line.&#160;Rather,&#160;you&#160;get&#160;dots&#160;with&#160;gaps&#160;be-<br/>tween&#160;them&#160;because&#160;the&#160;&#34;mousemove&#34;&#160;or&#160;&#34;touchmove&#34;&#160;events&#160;did&#160;not&#160;fire&#160;quickly<br/>enough&#160;to&#160;hit&#160;every&#160;pixel.<br/>
Improve&#160;the&#160;draw&#160;tool&#160;to&#160;make&#160;it&#160;draw&#160;a&#160;full&#160;line.&#160;This&#160;means&#160;you&#160;have&#160;to<br/>
make&#160;the&#160;motion&#160;handler&#160;function&#160;remember&#160;the&#160;previous&#160;position&#160;and&#160;connect<br/>that&#160;to&#160;the&#160;current&#160;one.<br/>
To&#160;do&#160;this,&#160;since&#160;the&#160;pixels&#160;can&#160;be&#160;an&#160;arbitrary&#160;distance&#160;apart,&#160;you’ll&#160;have<br/>
to&#160;write&#160;a&#160;general&#160;line&#160;drawing&#160;function.<br/>
A&#160;line&#160;between&#160;two&#160;pixels&#160;is&#160;a&#160;connected&#160;chain&#160;of&#160;pixels,&#160;as&#160;straight&#160;as&#160;pos-<br/>
sible,&#160;going&#160;from&#160;the&#160;start&#160;to&#160;the&#160;end.&#160;Diagonally&#160;adjacent&#160;pixels&#160;count&#160;as&#160;a<br/>connected.&#160;So&#160;a&#160;slanted&#160;line&#160;should&#160;look&#160;like&#160;the&#160;picture&#160;on&#160;the&#160;left,&#160;not&#160;the<br/>picture&#160;on&#160;the&#160;right.<br/>
Finally,&#160;if&#160;we&#160;have&#160;code&#160;that&#160;draws&#160;a&#160;line&#160;between&#160;two&#160;arbitrary&#160;points,&#160;we<br/>
might&#160;as&#160;well&#160;use&#160;it&#160;to&#160;also&#160;define&#160;a&#160;line&#160;tool,&#160;which&#160;draws&#160;a&#160;straight&#160;line<br/>between&#160;the&#160;start&#160;and&#160;end&#160;of&#160;a&#160;drag.<br/>
349<br/>
<hr/>
<a name=362></a><i>“A&#160;student&#160;asked,&#160;‘The&#160;programmers&#160;of&#160;old&#160;used&#160;only&#160;simple</i><br/>
<i>machines&#160;and&#160;no&#160;programming&#160;languages,&#160;yet&#160;they&#160;made&#160;beautiful<br/>programs.&#160;Why&#160;do&#160;we&#160;use&#160;complicated&#160;machines&#160;and&#160;programming<br/>languages?’.&#160;Fu-Tzu&#160;replied,&#160;‘The&#160;builders&#160;of&#160;old&#160;used&#160;only&#160;sticks&#160;and<br/>clay,&#160;yet&#160;they&#160;made&#160;beautiful&#160;huts.”’</i><br/>
—Master&#160;Yuan-Ma,&#160;The&#160;Book&#160;of&#160;Programming<br/>
<b>Chapter&#160;20<br/>Node.js</b><br/>
So&#160;far,&#160;we&#160;have&#160;used&#160;the&#160;JavaScript&#160;language&#160;in&#160;a&#160;single&#160;environment:&#160;the<br/>browser.&#160;This&#160;chapter&#160;and&#160;the&#160;<a href="eloquent-javascripts.html#381">next&#160;one&#160;</a>will&#160;briefly&#160;introduce&#160;Node.js,&#160;a&#160;pro-<br/>gram&#160;that&#160;allows&#160;you&#160;to&#160;apply&#160;your&#160;JavaScript&#160;skills&#160;outside&#160;of&#160;the&#160;browser.<br/>With&#160;it,&#160;you&#160;can&#160;build&#160;anything&#160;from&#160;small&#160;command&#160;line&#160;tools&#160;to&#160;HTTP<br/>servers&#160;that&#160;power&#160;dynamic&#160;websites.<br/>
These&#160;chapters&#160;aim&#160;to&#160;teach&#160;you&#160;the&#160;main&#160;concepts&#160;that&#160;Node.js&#160;uses&#160;and&#160;to<br/>
give&#160;you&#160;enough&#160;information&#160;to&#160;write&#160;useful&#160;programs&#160;for&#160;it.&#160;They&#160;do&#160;not&#160;try<br/>to&#160;be&#160;a&#160;complete,&#160;or&#160;even&#160;a&#160;thorough,&#160;treatment&#160;of&#160;the&#160;platform.<br/>
If&#160;you&#160;want&#160;to&#160;follow&#160;along&#160;and&#160;run&#160;the&#160;code&#160;in&#160;this&#160;chapter,&#160;you’ll&#160;need&#160;to<br/>
install&#160;Node.js&#160;version&#160;10.1&#160;or&#160;higher.&#160;To&#160;do&#160;so,&#160;go&#160;to&#160;<a href="https://nodejs.org"><i>https://nodejs.org&#160;</i></a>and<br/>follow&#160;the&#160;installation&#160;instructions&#160;for&#160;your&#160;operating&#160;system.&#160;You&#160;can&#160;also&#160;find<br/>further&#160;documentation&#160;for&#160;Node.js&#160;there.<br/>
<b>Background</b><br/>
One&#160;of&#160;the&#160;more&#160;difficult&#160;problems&#160;with&#160;writing&#160;systems&#160;that&#160;communicate&#160;over<br/>the&#160;network&#160;is&#160;managing&#160;input&#160;and&#160;output—that&#160;is,&#160;the&#160;reading&#160;and&#160;writing&#160;of<br/>data&#160;to&#160;and&#160;from&#160;the&#160;network&#160;and&#160;hard&#160;drive.&#160;Moving&#160;data&#160;around&#160;takes&#160;time,<br/>and&#160;scheduling&#160;it&#160;cleverly&#160;can&#160;make&#160;a&#160;big&#160;difference&#160;in&#160;how&#160;quickly&#160;a&#160;system<br/>responds&#160;to&#160;the&#160;user&#160;or&#160;to&#160;network&#160;requests.<br/>
In&#160;such&#160;programs,&#160;asynchronous&#160;programming&#160;is&#160;often&#160;helpful.&#160;It&#160;allows&#160;the<br/>
program&#160;to&#160;send&#160;and&#160;receive&#160;data&#160;from&#160;and&#160;to&#160;multiple&#160;devices&#160;at&#160;the&#160;same<br/>time&#160;without&#160;complicated&#160;thread&#160;management&#160;and&#160;synchronization.<br/>
Node&#160;was&#160;initially&#160;conceived&#160;for&#160;the&#160;purpose&#160;of&#160;making&#160;asynchronous&#160;pro-<br/>
gramming&#160;easy&#160;and&#160;convenient.&#160;JavaScript&#160;lends&#160;itself&#160;well&#160;to&#160;a&#160;system&#160;like<br/>Node.&#160;It&#160;is&#160;one&#160;of&#160;the&#160;few&#160;programming&#160;languages&#160;that&#160;does&#160;not&#160;have&#160;a&#160;built-in<br/>way&#160;to&#160;do&#160;in-&#160;and&#160;output.&#160;Thus,&#160;JavaScript&#160;could&#160;be&#160;fit&#160;onto&#160;Node’s&#160;rather<br/>eccentric&#160;approach&#160;to&#160;in-&#160;and&#160;output&#160;without&#160;ending&#160;up&#160;with&#160;two&#160;inconsistent<br/>interfaces.&#160;In&#160;2009,&#160;when&#160;Node&#160;was&#160;being&#160;designed,&#160;people&#160;were&#160;already&#160;do-<br/>ing&#160;callback-based&#160;programming&#160;in&#160;the&#160;browser,&#160;so&#160;the&#160;community&#160;around&#160;the<br/>
350<br/>
<hr/>
<a name=363></a>language&#160;was&#160;used&#160;to&#160;an&#160;asynchronous&#160;programming&#160;style.<br/>
<b>The&#160;node&#160;command</b><br/>
When&#160;Node.js&#160;is&#160;installed&#160;on&#160;a&#160;system,&#160;it&#160;provides&#160;a&#160;program&#160;called&#160;node,&#160;which<br/>is&#160;used&#160;to&#160;run&#160;JavaScript&#160;files.&#160;Say&#160;you&#160;have&#160;a&#160;file&#160;hello.js,&#160;containing&#160;this<br/>code:<br/>
let&#160;message&#160;=&#160;&#34;Hello&#160;world&#34;;<br/>console.log(message);<br/>
You&#160;can&#160;then&#160;run&#160;node&#160;from&#160;the&#160;command&#160;line&#160;like&#160;this&#160;to&#160;execute&#160;the&#160;pro-<br/>
gram:<br/>
$&#160;node&#160;hello.js<br/>Hello&#160;world<br/>
The&#160;console.log&#160;method&#160;in&#160;Node&#160;does&#160;something&#160;similar&#160;to&#160;what&#160;it&#160;does&#160;in<br/>
the&#160;browser.&#160;It&#160;prints&#160;out&#160;a&#160;piece&#160;of&#160;text.&#160;But&#160;in&#160;Node,&#160;the&#160;text&#160;will&#160;go&#160;to<br/>the&#160;process’s&#160;standard&#160;output&#160;stream,&#160;rather&#160;than&#160;to&#160;a&#160;browser’s&#160;JavaScript<br/>console.&#160;When&#160;running&#160;node&#160;from&#160;the&#160;command&#160;line,&#160;that&#160;means&#160;you&#160;see&#160;the<br/>logged&#160;values&#160;in&#160;your&#160;terminal.<br/>
If&#160;you&#160;run&#160;node&#160;without&#160;giving&#160;it&#160;a&#160;file,&#160;it&#160;provides&#160;you&#160;with&#160;a&#160;prompt&#160;at<br/>
which&#160;you&#160;can&#160;type&#160;JavaScript&#160;code&#160;and&#160;immediately&#160;see&#160;the&#160;result.<br/>
$&#160;node<br/>&gt;&#160;1&#160;+&#160;1<br/>2<br/>&gt;&#160;[-1,&#160;-2,&#160;-3].map(Math.abs)<br/>[1,&#160;2,&#160;3]<br/>&gt;&#160;process.exit(0)<br/>$<br/>
The&#160;process&#160;binding,&#160;just&#160;like&#160;the&#160;console&#160;binding,&#160;is&#160;available&#160;globally&#160;in<br/>
Node.&#160;It&#160;provides&#160;various&#160;ways&#160;to&#160;inspect&#160;and&#160;manipulate&#160;the&#160;current&#160;program.<br/>The&#160;exit&#160;method&#160;ends&#160;the&#160;process&#160;and&#160;can&#160;be&#160;given&#160;an&#160;exit&#160;status&#160;code,&#160;which<br/>tells&#160;the&#160;program&#160;that&#160;started&#160;node&#160;(in&#160;this&#160;case,&#160;the&#160;command&#160;line&#160;shell)<br/>whether&#160;the&#160;program&#160;completed&#160;successfully&#160;(code&#160;zero)&#160;or&#160;encountered&#160;an<br/>error&#160;(any&#160;other&#160;code).<br/>
To&#160;find&#160;the&#160;command&#160;line&#160;arguments&#160;given&#160;to&#160;your&#160;script,&#160;you&#160;can&#160;read<br/>
351<br/>
<hr/>
<a name=364></a>process.argv,&#160;which&#160;is&#160;an&#160;array&#160;of&#160;strings.&#160;Note&#160;that&#160;it&#160;also&#160;includes&#160;the&#160;name<br/>of&#160;the&#160;node&#160;command&#160;and&#160;your&#160;script&#160;name,&#160;so&#160;the&#160;actual&#160;arguments&#160;start&#160;at<br/>index&#160;2.&#160;If&#160;showargv.js&#160;contains&#160;the&#160;statement&#160;console.log(process.argv),<br/>you&#160;could&#160;run&#160;it&#160;like&#160;this:<br/>
$&#160;node&#160;showargv.js&#160;one&#160;--and&#160;two<br/>[&#34;node&#34;,&#160;&#34;/tmp/showargv.js&#34;,&#160;&#34;one&#34;,&#160;&#34;--and&#34;,&#160;&#34;two&#34;]<br/>
All&#160;the&#160;standard&#160;JavaScript&#160;global&#160;bindings,&#160;such&#160;as&#160;Array,&#160;Math,&#160;and&#160;JSON,<br/>
are&#160;also&#160;present&#160;in&#160;Node’s&#160;environment.&#160;Browser-related&#160;functionality,&#160;such&#160;as<br/>document&#160;or&#160;prompt,&#160;is&#160;not.<br/>
<b>Modules</b><br/>
Beyond&#160;the&#160;bindings&#160;I&#160;mentioned,&#160;such&#160;as&#160;console&#160;and&#160;process,&#160;Node&#160;puts<br/>few&#160;additional&#160;bindings&#160;in&#160;the&#160;global&#160;scope.&#160;If&#160;you&#160;want&#160;to&#160;access&#160;built-in<br/>functionality,&#160;you&#160;have&#160;to&#160;ask&#160;the&#160;module&#160;system&#160;for&#160;it.<br/>
The&#160;CommonJS&#160;module&#160;system,&#160;based&#160;on&#160;the&#160;require&#160;function,&#160;was&#160;de-<br/>
scribed&#160;in&#160;<a href="eloquent-javascripts.html#183">Chapter&#160;10</a>.&#160;This&#160;system&#160;is&#160;built&#160;into&#160;Node&#160;and&#160;is&#160;used&#160;to&#160;load<br/>anything&#160;from&#160;built-in&#160;modules&#160;to&#160;downloaded&#160;packages&#160;to&#160;files&#160;that&#160;are&#160;part<br/>of&#160;your&#160;own&#160;program.<br/>
When&#160;require&#160;is&#160;called,&#160;Node&#160;has&#160;to&#160;resolve&#160;the&#160;given&#160;string&#160;to&#160;an&#160;actual<br/>
file&#160;that&#160;it&#160;can&#160;load.&#160;Pathnames&#160;that&#160;start&#160;with&#160;/,&#160;./,&#160;or&#160;../&#160;are&#160;resolved<br/>relative&#160;to&#160;the&#160;current&#160;module’s&#160;path,&#160;where&#160;.&#160;stands&#160;for&#160;the&#160;current&#160;directory,<br/>../&#160;for&#160;one&#160;directory&#160;up,&#160;and&#160;/&#160;for&#160;the&#160;root&#160;of&#160;the&#160;file&#160;system.&#160;So&#160;if&#160;you&#160;ask<br/>for&#160;&#34;./graph&#34;&#160;from&#160;the&#160;file&#160;/tmp/robot/robot.js,&#160;Node&#160;will&#160;try&#160;to&#160;load&#160;the&#160;file<br/>/tmp/robot/graph.js.<br/>
The&#160;.js&#160;extension&#160;may&#160;be&#160;omitted,&#160;and&#160;Node&#160;will&#160;add&#160;it&#160;if&#160;such&#160;a&#160;file&#160;exists.<br/>
If&#160;the&#160;required&#160;path&#160;refers&#160;to&#160;a&#160;directory,&#160;Node&#160;will&#160;try&#160;to&#160;load&#160;the&#160;file&#160;named<br/>index.js&#160;in&#160;that&#160;directory.<br/>
When&#160;a&#160;string&#160;that&#160;does&#160;not&#160;look&#160;like&#160;a&#160;relative&#160;or&#160;absolute&#160;path&#160;is&#160;given<br/>
to&#160;require,&#160;it&#160;is&#160;assumed&#160;to&#160;refer&#160;to&#160;either&#160;a&#160;built-in&#160;module&#160;or&#160;a&#160;module<br/>installed&#160;in&#160;a&#160;node_modules&#160;directory.&#160;For&#160;example,&#160;require(&#34;fs&#34;)&#160;will&#160;give<br/>you&#160;Node’s&#160;built-in&#160;file&#160;system&#160;module.&#160;And&#160;require(&#34;robot&#34;)&#160;might&#160;try&#160;to<br/>load&#160;the&#160;library&#160;found&#160;in&#160;node_modules/robot/.&#160;A&#160;common&#160;way&#160;to&#160;install&#160;such<br/>libraries&#160;is&#160;by&#160;using&#160;NPM,&#160;which&#160;we’ll&#160;come&#160;back&#160;to&#160;in&#160;a&#160;moment.<br/>
Let’s&#160;set&#160;up&#160;a&#160;small&#160;project&#160;consisting&#160;of&#160;two&#160;files.&#160;The&#160;first&#160;one,&#160;called&#160;main<br/>
.js,&#160;defines&#160;a&#160;script&#160;that&#160;can&#160;be&#160;called&#160;from&#160;the&#160;command&#160;line&#160;to&#160;reverse&#160;a<br/>string.<br/>
352<br/>
<hr/>
<a name=365></a>const&#160;{reverse}&#160;=&#160;require(&#34;./reverse&#34;);<br/>
//&#160;Index&#160;2&#160;holds&#160;the&#160;first&#160;actual&#160;command&#160;line&#160;argument<br/>let&#160;argument&#160;=&#160;process.argv[2];<br/>
console.log(reverse(argument));<br/>
The&#160;file&#160;reverse.js&#160;defines&#160;a&#160;library&#160;for&#160;reversing&#160;strings,&#160;which&#160;can&#160;be&#160;used<br/>
both&#160;by&#160;this&#160;command&#160;line&#160;tool&#160;and&#160;by&#160;other&#160;scripts&#160;that&#160;need&#160;direct&#160;access&#160;to<br/>a&#160;string-reversing&#160;function.<br/>
exports.reverse&#160;=&#160;function(string)&#160;{<br/>
return&#160;Array.from(string).reverse().join(&#34;&#34;);<br/>
};<br/>
Remember&#160;that&#160;adding&#160;properties&#160;to&#160;exports&#160;adds&#160;them&#160;to&#160;the&#160;interface&#160;of<br/>
the&#160;module.&#160;Since&#160;Node.js&#160;treats&#160;files&#160;as&#160;CommonJS&#160;modules,&#160;main.js&#160;can&#160;take<br/>the&#160;exported&#160;reverse&#160;function&#160;from&#160;reverse.js.<br/>
We&#160;can&#160;now&#160;call&#160;our&#160;tool&#160;like&#160;this:<br/>
$&#160;node&#160;main.js&#160;JavaScript<br/>tpircSavaJ<br/>
<b>Installing&#160;with&#160;NPM</b><br/>
NPM,&#160;which&#160;was&#160;introduced&#160;in&#160;<a href="eloquent-javascripts.html#180">Chapter&#160;10</a>,&#160;is&#160;an&#160;online&#160;repository&#160;of&#160;JavaScript<br/>modules,&#160;many&#160;of&#160;which&#160;are&#160;specifically&#160;written&#160;for&#160;Node.&#160;When&#160;you&#160;install<br/>Node&#160;on&#160;your&#160;computer,&#160;you&#160;also&#160;get&#160;the&#160;npm&#160;command,&#160;which&#160;you&#160;can&#160;use&#160;to<br/>interact&#160;with&#160;this&#160;repository.<br/>
NPM’s&#160;main&#160;use&#160;is&#160;downloading&#160;packages.&#160;We&#160;saw&#160;the&#160;ini&#160;package&#160;in&#160;<a href="eloquent-javascripts.html#184">Chap-</a><br/>
<a href="eloquent-javascripts.html#184">ter&#160;10</a>.&#160;We&#160;can&#160;use&#160;NPM&#160;to&#160;fetch&#160;and&#160;install&#160;that&#160;package&#160;on&#160;our&#160;computer.<br/>
$&#160;npm&#160;install&#160;ini<br/>npm&#160;WARN&#160;enoent&#160;ENOENT:&#160;no&#160;such&#160;file&#160;or&#160;directory,<br/>
open&#160;'/tmp/package.json'<br/>
+&#160;ini@1.3.5<br/>added&#160;1&#160;package&#160;in&#160;0.552s<br/>
$&#160;node<br/>&gt;&#160;const&#160;{parse}&#160;=&#160;require(&#34;ini&#34;);<br/>
353<br/>
<hr/>
<a name=366></a>&gt;&#160;parse(&#34;x&#160;=&#160;1\ny&#160;=&#160;2&#34;);<br/>{&#160;x:&#160;'1',&#160;y:&#160;'2'&#160;}<br/>
After&#160;running&#160;npm&#160;install,&#160;NPM&#160;will&#160;have&#160;created&#160;a&#160;directory&#160;called&#160;node_modules<br/>
.&#160;Inside&#160;that&#160;directory&#160;will&#160;be&#160;an&#160;ini&#160;directory&#160;that&#160;contains&#160;the&#160;library.&#160;You<br/>can&#160;open&#160;it&#160;and&#160;look&#160;at&#160;the&#160;code.&#160;When&#160;we&#160;call&#160;require(&#34;ini&#34;),&#160;this&#160;library<br/>is&#160;loaded,&#160;and&#160;we&#160;can&#160;call&#160;its&#160;parse&#160;property&#160;to&#160;parse&#160;a&#160;configuration&#160;file.<br/>
By&#160;default&#160;NPM&#160;installs&#160;packages&#160;under&#160;the&#160;current&#160;directory,&#160;rather&#160;than<br/>
in&#160;a&#160;central&#160;place.&#160;If&#160;you&#160;are&#160;used&#160;to&#160;other&#160;package&#160;managers,&#160;this&#160;may&#160;seem<br/>unusual,&#160;but&#160;it&#160;has&#160;advantages—it&#160;puts&#160;each&#160;application&#160;in&#160;full&#160;control&#160;of&#160;the<br/>packages&#160;it&#160;installs&#160;and&#160;makes&#160;it&#160;easier&#160;to&#160;manage&#160;versions&#160;and&#160;clean&#160;up&#160;when<br/>removing&#160;an&#160;application.<br/>
<b>Package&#160;files</b><br/>
In&#160;the&#160;npm&#160;install&#160;example,&#160;you&#160;could&#160;see&#160;a&#160;warning&#160;about&#160;the&#160;fact&#160;that&#160;the<br/>package.json&#160;file&#160;did&#160;not&#160;exist.&#160;It&#160;is&#160;recommended&#160;to&#160;create&#160;such&#160;a&#160;file&#160;for&#160;each<br/>project,&#160;either&#160;manually&#160;or&#160;by&#160;running&#160;npm&#160;init.&#160;It&#160;contains&#160;some&#160;information<br/>about&#160;the&#160;project,&#160;such&#160;as&#160;its&#160;name&#160;and&#160;version,&#160;and&#160;lists&#160;its&#160;dependencies.<br/>
The&#160;robot&#160;simulation&#160;from&#160;<a href="eloquent-javascripts.html#129">Chapter&#160;7,&#160;</a>as&#160;modularized&#160;in&#160;the&#160;exercise&#160;in<br/>
<a href="eloquent-javascripts.html#190">Chapter&#160;10,&#160;</a>might&#160;have&#160;a&#160;package.json&#160;file&#160;like&#160;this:<br/>
{<br/>
&#34;author&#34;:&#160;&#34;Marijn&#160;Haverbeke&#34;,<br/>&#34;name&#34;:&#160;&#34;eloquent-javascript-robot&#34;,<br/>&#34;description&#34;:&#160;&#34;Simulation&#160;of&#160;a&#160;package-delivery&#160;robot&#34;,<br/>&#34;version&#34;:&#160;&#34;1.0.0&#34;,<br/>&#34;main&#34;:&#160;&#34;run.js&#34;,<br/>&#34;dependencies&#34;:&#160;{<br/>
&#34;dijkstrajs&#34;:&#160;&#34;^1.0.1&#34;,<br/>&#34;random-item&#34;:&#160;&#34;^1.0.0&#34;<br/>
},<br/>&#34;license&#34;:&#160;&#34;ISC&#34;<br/>
}<br/>
When&#160;you&#160;run&#160;npm&#160;install&#160;without&#160;naming&#160;a&#160;package&#160;to&#160;install,&#160;NPM&#160;will<br/>
install&#160;the&#160;dependencies&#160;listed&#160;in&#160;package.json.&#160;When&#160;you&#160;install&#160;a&#160;specific<br/>package&#160;that&#160;is&#160;not&#160;already&#160;listed&#160;as&#160;a&#160;dependency,&#160;NPM&#160;will&#160;add&#160;it&#160;to&#160;package<br/>.json.<br/>
354<br/>
<hr/>
<a name=367></a><b>Versions</b><br/>
A&#160;package.json&#160;file&#160;lists&#160;both&#160;the&#160;program’s&#160;own&#160;version&#160;and&#160;versions&#160;for&#160;its<br/>dependencies.&#160;Versions&#160;are&#160;a&#160;way&#160;to&#160;deal&#160;with&#160;the&#160;fact&#160;that&#160;packages&#160;evolve<br/>separately,&#160;and&#160;code&#160;written&#160;to&#160;work&#160;with&#160;a&#160;package&#160;as&#160;it&#160;existed&#160;at&#160;one&#160;point<br/>may&#160;not&#160;work&#160;with&#160;a&#160;later,&#160;modified&#160;version&#160;of&#160;the&#160;package.<br/>
NPM&#160;demands&#160;that&#160;its&#160;packages&#160;follow&#160;a&#160;schema&#160;called&#160;<i>semantic&#160;versioning</i>,<br/>
which&#160;encodes&#160;some&#160;information&#160;about&#160;which&#160;versions&#160;are&#160;<i>compatible&#160;</i>(don’t<br/>break&#160;the&#160;old&#160;interface)&#160;in&#160;the&#160;version&#160;number.&#160;A&#160;semantic&#160;version&#160;consists<br/>of&#160;three&#160;numbers,&#160;separated&#160;by&#160;periods,&#160;such&#160;as&#160;2.3.0.&#160;Every&#160;time&#160;new&#160;func-<br/>tionality&#160;is&#160;added,&#160;the&#160;middle&#160;number&#160;has&#160;to&#160;be&#160;incremented.&#160;Every&#160;time<br/>compatibility&#160;is&#160;broken,&#160;so&#160;that&#160;existing&#160;code&#160;that&#160;uses&#160;the&#160;package&#160;might&#160;not<br/>work&#160;with&#160;the&#160;new&#160;version,&#160;the&#160;first&#160;number&#160;has&#160;to&#160;be&#160;incremented.<br/>
A&#160;caret&#160;character&#160;(^)&#160;in&#160;front&#160;of&#160;the&#160;version&#160;number&#160;for&#160;a&#160;dependency&#160;in<br/>
package.json&#160;indicates&#160;that&#160;any&#160;version&#160;compatible&#160;with&#160;the&#160;given&#160;number<br/>may&#160;be&#160;installed.&#160;So,&#160;for&#160;example,&#160;&#34;^2.3.0&#34;&#160;would&#160;mean&#160;that&#160;any&#160;version<br/>greater&#160;than&#160;or&#160;equal&#160;to&#160;2.3.0&#160;and&#160;less&#160;than&#160;3.0.0&#160;is&#160;allowed.<br/>
The&#160;npm&#160;command&#160;is&#160;also&#160;used&#160;to&#160;publish&#160;new&#160;packages&#160;or&#160;new&#160;versions&#160;of<br/>
packages.&#160;If&#160;you&#160;run&#160;npm&#160;publish&#160;in&#160;a&#160;directory&#160;that&#160;has&#160;a&#160;package.json&#160;file,&#160;it<br/>will&#160;publish&#160;a&#160;package&#160;with&#160;the&#160;name&#160;and&#160;version&#160;listed&#160;in&#160;the&#160;JSON&#160;file&#160;to&#160;the<br/>registry.&#160;Anyone&#160;can&#160;publish&#160;packages&#160;to&#160;NPM—though&#160;only&#160;under&#160;a&#160;package<br/>name&#160;that&#160;isn’t&#160;in&#160;use&#160;yet&#160;since&#160;it&#160;would&#160;be&#160;somewhat&#160;scary&#160;if&#160;random&#160;people<br/>could&#160;update&#160;existing&#160;packages.<br/>
Since&#160;the&#160;npm&#160;program&#160;is&#160;a&#160;piece&#160;of&#160;software&#160;that&#160;talks&#160;to&#160;an&#160;open&#160;system—<br/>
the&#160;package&#160;registry—there&#160;is&#160;nothing&#160;unique&#160;about&#160;what&#160;it&#160;does.&#160;Another<br/>program,&#160;yarn,&#160;which&#160;can&#160;be&#160;installed&#160;from&#160;the&#160;NPM&#160;registry,&#160;fills&#160;the&#160;same<br/>role&#160;as&#160;npm&#160;using&#160;a&#160;somewhat&#160;different&#160;interface&#160;and&#160;installation&#160;strategy.<br/>
This&#160;book&#160;won’t&#160;delve&#160;further&#160;into&#160;the&#160;details&#160;of&#160;NPM&#160;usage.&#160;Refer&#160;to<br/>
<a href="https://npmjs.org"><i>https://npmjs.org&#160;</i></a>for&#160;further&#160;documentation&#160;and&#160;a&#160;way&#160;to&#160;search&#160;for&#160;packages.<br/>
<b>The&#160;file&#160;system&#160;module</b><br/>
One&#160;of&#160;the&#160;most&#160;commonly&#160;used&#160;built-in&#160;modules&#160;in&#160;Node&#160;is&#160;the&#160;fs&#160;module,<br/>which&#160;stands&#160;for&#160;<i>file&#160;system</i>.&#160;It&#160;exports&#160;functions&#160;for&#160;working&#160;with&#160;files&#160;and<br/>directories.<br/>
For&#160;example,&#160;the&#160;function&#160;called&#160;readFile&#160;reads&#160;a&#160;file&#160;and&#160;then&#160;calls&#160;a&#160;call-<br/>
back&#160;with&#160;the&#160;file’s&#160;contents.<br/>
let&#160;{readFile}&#160;=&#160;require(&#34;fs&#34;);<br/>readFile(&#34;file.txt&#34;,&#160;&#34;utf8&#34;,&#160;(error,&#160;text)&#160;=&gt;&#160;{<br/>
355<br/>
<hr/>
<a name=368></a>if&#160;(error)&#160;throw&#160;error;<br/>console.log(&#34;The&#160;file&#160;contains:&#34;,&#160;text);<br/>
});<br/>
The&#160;second&#160;argument&#160;to&#160;readFile&#160;indicates&#160;the&#160;<i>character&#160;encoding&#160;</i>used&#160;to<br/>
decode&#160;the&#160;file&#160;into&#160;a&#160;string.&#160;There&#160;are&#160;several&#160;ways&#160;in&#160;which&#160;text&#160;can&#160;be<br/>encoded&#160;to&#160;binary&#160;data,&#160;but&#160;most&#160;modern&#160;systems&#160;use&#160;UTF-8.&#160;So&#160;unless&#160;you<br/>have&#160;reasons&#160;to&#160;believe&#160;another&#160;encoding&#160;is&#160;used,&#160;pass&#160;&#34;utf8&#34;&#160;when&#160;reading&#160;a<br/>text&#160;file.&#160;If&#160;you&#160;do&#160;not&#160;pass&#160;an&#160;encoding,&#160;Node&#160;will&#160;assume&#160;you&#160;are&#160;interested<br/>in&#160;the&#160;binary&#160;data&#160;and&#160;will&#160;give&#160;you&#160;a&#160;Buffer&#160;object&#160;instead&#160;of&#160;a&#160;string.&#160;This&#160;is<br/>an&#160;array-like&#160;object&#160;that&#160;contains&#160;numbers&#160;representing&#160;the&#160;bytes&#160;(8-bit&#160;chunks<br/>of&#160;data)&#160;in&#160;the&#160;files.<br/>
const&#160;{readFile}&#160;=&#160;require(&#34;fs&#34;);<br/>readFile(&#34;file.txt&#34;,&#160;(error,&#160;buffer)&#160;=&gt;&#160;{<br/>
if&#160;(error)&#160;throw&#160;error;<br/>console.log(&#34;The&#160;file&#160;contained&#34;,&#160;buffer.length,&#160;&#34;bytes.&#34;,<br/>
&#34;The&#160;first&#160;byte&#160;is:&#34;,&#160;buffer[0]);<br/>
});<br/>
A&#160;similar&#160;function,&#160;writeFile,&#160;is&#160;used&#160;to&#160;write&#160;a&#160;file&#160;to&#160;disk.<br/>
const&#160;{writeFile}&#160;=&#160;require(&#34;fs&#34;);<br/>writeFile(&#34;graffiti.txt&#34;,&#160;&#34;Node&#160;was&#160;here&#34;,&#160;err&#160;=&gt;&#160;{<br/>
if&#160;(err)&#160;console.log(`Failed&#160;to&#160;write&#160;file:&#160;${err}`);<br/>else&#160;console.log(&#34;File&#160;written.&#34;);<br/>
});<br/>
Here&#160;it&#160;was&#160;not&#160;necessary&#160;to&#160;specify&#160;the&#160;encoding—writeFile&#160;will&#160;assume<br/>
that&#160;when&#160;it&#160;is&#160;given&#160;a&#160;string&#160;to&#160;write,&#160;rather&#160;than&#160;a&#160;Buffer&#160;object,&#160;it&#160;should<br/>write&#160;it&#160;out&#160;as&#160;text&#160;using&#160;its&#160;default&#160;character&#160;encoding,&#160;which&#160;is&#160;UTF-8.<br/>
The&#160;fs&#160;module&#160;contains&#160;many&#160;other&#160;useful&#160;functions:&#160;readdir&#160;will&#160;return&#160;the<br/>
files&#160;in&#160;a&#160;directory&#160;as&#160;an&#160;array&#160;of&#160;strings,&#160;stat&#160;will&#160;retrieve&#160;information&#160;about<br/>a&#160;file,&#160;rename&#160;will&#160;rename&#160;a&#160;file,&#160;unlink&#160;will&#160;remove&#160;one,&#160;and&#160;so&#160;on.&#160;See&#160;the<br/>documentation&#160;at&#160;<a href="https://nodejs.org"><i>https://nodejs.org&#160;</i></a>for&#160;specifics.<br/>
Most&#160;of&#160;these&#160;take&#160;a&#160;callback&#160;function&#160;as&#160;the&#160;last&#160;parameter,&#160;which&#160;they&#160;call<br/>
either&#160;with&#160;an&#160;error&#160;(the&#160;first&#160;argument)&#160;or&#160;with&#160;a&#160;successful&#160;result&#160;(the&#160;second).<br/>As&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#192">Chapter&#160;11,&#160;</a>there&#160;are&#160;downsides&#160;to&#160;this&#160;style&#160;of&#160;programming—the<br/>biggest&#160;one&#160;being&#160;that&#160;error&#160;handling&#160;becomes&#160;verbose&#160;and&#160;error-prone.<br/>
Though&#160;promises&#160;have&#160;been&#160;part&#160;of&#160;JavaScript&#160;for&#160;a&#160;while,&#160;at&#160;the&#160;time&#160;of&#160;writ-<br/>
356<br/>
<hr/>
<a name=369></a>ing&#160;their&#160;integration&#160;into&#160;Node.js&#160;is&#160;still&#160;a&#160;work&#160;in&#160;progress.&#160;There&#160;is&#160;an&#160;object<br/>promises&#160;exported&#160;from&#160;the&#160;fs&#160;package&#160;since&#160;version&#160;10.1&#160;that&#160;contains&#160;most<br/>of&#160;the&#160;same&#160;functions&#160;as&#160;fs&#160;but&#160;uses&#160;promises&#160;rather&#160;than&#160;callback&#160;functions.<br/>
const&#160;{readFile}&#160;=&#160;require(&#34;fs&#34;).promises;<br/>readFile(&#34;file.txt&#34;,&#160;&#34;utf8&#34;)<br/>
.then(text&#160;=&gt;&#160;console.log(&#34;The&#160;file&#160;contains:&#34;,&#160;text));<br/>
Sometimes&#160;you&#160;don’t&#160;need&#160;asynchronicity,&#160;and&#160;it&#160;just&#160;gets&#160;in&#160;the&#160;way.&#160;Many<br/>
of&#160;the&#160;functions&#160;in&#160;fs&#160;also&#160;have&#160;a&#160;synchronous&#160;variant,&#160;which&#160;has&#160;the&#160;same<br/>name&#160;with&#160;Sync&#160;added&#160;to&#160;the&#160;end.&#160;For&#160;example,&#160;the&#160;synchronous&#160;version&#160;of<br/>readFile&#160;is&#160;called&#160;readFileSync.<br/>
const&#160;{readFileSync}&#160;=&#160;require(&#34;fs&#34;);<br/>console.log(&#34;The&#160;file&#160;contains:&#34;,<br/>
readFileSync(&#34;file.txt&#34;,&#160;&#34;utf8&#34;));<br/>
Do&#160;note&#160;that&#160;while&#160;such&#160;a&#160;synchronous&#160;operation&#160;is&#160;being&#160;performed,&#160;your<br/>
program&#160;is&#160;stopped&#160;entirely.&#160;If&#160;it&#160;should&#160;be&#160;responding&#160;to&#160;the&#160;user&#160;or&#160;to&#160;other<br/>machines&#160;on&#160;the&#160;network,&#160;being&#160;stuck&#160;on&#160;a&#160;synchronous&#160;action&#160;might&#160;produce<br/>annoying&#160;delays.<br/>
<b>The&#160;HTTP&#160;module</b><br/>
Another&#160;central&#160;module&#160;is&#160;called&#160;http.&#160;It&#160;provides&#160;functionality&#160;for&#160;running<br/>HTTP&#160;servers&#160;and&#160;making&#160;HTTP&#160;requests.<br/>
This&#160;is&#160;all&#160;it&#160;takes&#160;to&#160;start&#160;an&#160;HTTP&#160;server:<br/>
const&#160;{createServer}&#160;=&#160;require(&#34;http&#34;);<br/>let&#160;server&#160;=&#160;createServer((request,&#160;response)&#160;=&gt;&#160;{<br/>
response.writeHead(200,&#160;{&#34;Content-Type&#34;:&#160;&#34;text/html&#34;});<br/>response.write(`<br/>
&lt;h1&gt;Hello!&lt;/h1&gt;<br/>&lt;p&gt;You&#160;asked&#160;for&#160;&lt;code&gt;${request.url}&lt;/code&gt;&lt;/p&gt;`);<br/>
response.end();<br/>
});<br/>server.listen(8000);<br/>console.log(&#34;Listening!&#160;(port&#160;8000)&#34;);<br/>
If&#160;you&#160;run&#160;this&#160;script&#160;on&#160;your&#160;own&#160;machine,&#160;you&#160;can&#160;point&#160;your&#160;web&#160;browser<br/>
at&#160;<a href="http://localhost:8000/hello"><i>http://localhost:8000/hello&#160;</i></a>to&#160;make&#160;a&#160;request&#160;to&#160;your&#160;server.&#160;It&#160;will&#160;respond<br/>
357<br/>
<hr/>
<a name=370></a>with&#160;a&#160;small&#160;HTML&#160;page.<br/>
The&#160;function&#160;passed&#160;as&#160;argument&#160;to&#160;createServer&#160;is&#160;called&#160;every&#160;time&#160;a<br/>
client&#160;connects&#160;to&#160;the&#160;server.&#160;The&#160;request&#160;and&#160;response&#160;bindings&#160;are&#160;objects<br/>representing&#160;the&#160;incoming&#160;and&#160;outgoing&#160;data.&#160;The&#160;first&#160;contains&#160;information<br/>about&#160;the&#160;request,&#160;such&#160;as&#160;its&#160;url&#160;property,&#160;which&#160;tells&#160;us&#160;to&#160;what&#160;URL&#160;the<br/>request&#160;was&#160;made.<br/>
So,&#160;when&#160;you&#160;open&#160;that&#160;page&#160;in&#160;your&#160;browser,&#160;it&#160;sends&#160;a&#160;request&#160;to&#160;your&#160;own<br/>
computer.&#160;This&#160;causes&#160;the&#160;server&#160;function&#160;to&#160;run&#160;and&#160;send&#160;back&#160;a&#160;response,<br/>which&#160;you&#160;can&#160;then&#160;see&#160;in&#160;the&#160;browser.<br/>
To&#160;send&#160;something&#160;back,&#160;you&#160;call&#160;methods&#160;on&#160;the&#160;response&#160;object.&#160;The&#160;first,<br/>
writeHead,&#160;will&#160;write&#160;out&#160;the&#160;response&#160;headers&#160;(see&#160;<a href="eloquent-javascripts.html#321">Chapter&#160;18</a>).&#160;You&#160;give&#160;it<br/>the&#160;status&#160;code&#160;(200&#160;for&#160;“OK”&#160;in&#160;this&#160;case)&#160;and&#160;an&#160;object&#160;that&#160;contains&#160;header<br/>values.&#160;The&#160;example&#160;sets&#160;the&#160;Content-Type&#160;header&#160;to&#160;inform&#160;the&#160;client&#160;that<br/>we’ll&#160;be&#160;sending&#160;back&#160;an&#160;HTML&#160;document.<br/>
Next,&#160;the&#160;actual&#160;response&#160;body&#160;(the&#160;document&#160;itself)&#160;is&#160;sent&#160;with&#160;response<br/>
.write.&#160;You&#160;are&#160;allowed&#160;to&#160;call&#160;this&#160;method&#160;multiple&#160;times&#160;if&#160;you&#160;want&#160;to<br/>send&#160;the&#160;response&#160;piece&#160;by&#160;piece,&#160;for&#160;example&#160;to&#160;stream&#160;data&#160;to&#160;the&#160;client&#160;as&#160;it<br/>becomes&#160;available.&#160;Finally,&#160;response.end&#160;signals&#160;the&#160;end&#160;of&#160;the&#160;response.<br/>
The&#160;call&#160;to&#160;server.listen&#160;causes&#160;the&#160;server&#160;to&#160;start&#160;waiting&#160;for&#160;connections<br/>
on&#160;port&#160;8000.&#160;This&#160;is&#160;why&#160;you&#160;have&#160;to&#160;connect&#160;to&#160;<i>localhost:8000&#160;</i>to&#160;speak&#160;to<br/>this&#160;server,&#160;rather&#160;than&#160;just&#160;<i>localhost</i>,&#160;which&#160;would&#160;use&#160;the&#160;default&#160;port&#160;80.<br/>
When&#160;you&#160;run&#160;this&#160;script,&#160;the&#160;process&#160;just&#160;sits&#160;there&#160;and&#160;waits.&#160;When&#160;a<br/>
script&#160;is&#160;listening&#160;for&#160;events—in&#160;this&#160;case,&#160;network&#160;connections—node&#160;will&#160;not<br/>automatically&#160;exit&#160;when&#160;it&#160;reaches&#160;the&#160;end&#160;of&#160;the&#160;script.&#160;To&#160;close&#160;it,&#160;press<br/>control-C.<br/>
A&#160;real&#160;web&#160;server&#160;usually&#160;does&#160;more&#160;than&#160;the&#160;one&#160;in&#160;the&#160;example—it&#160;looks<br/>
at&#160;the&#160;request’s&#160;method&#160;(the&#160;method&#160;property)&#160;to&#160;see&#160;what&#160;action&#160;the&#160;client&#160;is<br/>trying&#160;to&#160;perform&#160;and&#160;looks&#160;at&#160;the&#160;request’s&#160;URL&#160;to&#160;find&#160;out&#160;which&#160;resource<br/>this&#160;action&#160;is&#160;being&#160;performed&#160;on.&#160;We’ll&#160;see&#160;a&#160;more&#160;advanced&#160;server&#160;<a href="eloquent-javascripts.html#372">later&#160;in<br/>this&#160;chapter.</a><br/>
To&#160;act&#160;as&#160;an&#160;HTTP&#160;<i>client</i>,&#160;we&#160;can&#160;use&#160;the&#160;request&#160;function&#160;in&#160;the&#160;http<br/>
module.<br/>
const&#160;{request}&#160;=&#160;require(&#34;http&#34;);<br/>let&#160;requestStream&#160;=&#160;request({<br/>
hostname:&#160;&#34;eloquentjavascript.net&#34;,<br/>path:&#160;&#34;/20_node.html&#34;,<br/>method:&#160;&#34;GET&#34;,<br/>headers:&#160;{Accept:&#160;&#34;text/html&#34;}<br/>
},&#160;response&#160;=&gt;&#160;{<br/>
console.log(&#34;Server&#160;responded&#160;with&#160;status&#160;code&#34;,<br/>
358<br/>
<hr/>
<a name=371></a>response.statusCode);<br/>
});<br/>requestStream.end();<br/>
The&#160;first&#160;argument&#160;to&#160;request&#160;configures&#160;the&#160;request,&#160;telling&#160;Node&#160;what<br/>
server&#160;to&#160;talk&#160;to,&#160;what&#160;path&#160;to&#160;request&#160;from&#160;that&#160;server,&#160;which&#160;method&#160;to&#160;use,<br/>and&#160;so&#160;on.&#160;The&#160;second&#160;argument&#160;is&#160;the&#160;function&#160;that&#160;should&#160;be&#160;called&#160;when&#160;a<br/>response&#160;comes&#160;in.&#160;It&#160;is&#160;given&#160;an&#160;object&#160;that&#160;allows&#160;us&#160;to&#160;inspect&#160;the&#160;response,<br/>for&#160;example&#160;to&#160;find&#160;out&#160;its&#160;status&#160;code.<br/>
Just&#160;like&#160;the&#160;response&#160;object&#160;we&#160;saw&#160;in&#160;the&#160;server,&#160;the&#160;object&#160;returned&#160;by<br/>
request&#160;allows&#160;us&#160;to&#160;stream&#160;data&#160;into&#160;the&#160;request&#160;with&#160;the&#160;write&#160;method&#160;and<br/>finish&#160;the&#160;request&#160;with&#160;the&#160;end&#160;method.&#160;The&#160;example&#160;does&#160;not&#160;use&#160;write<br/>because&#160;GET&#160;requests&#160;should&#160;not&#160;contain&#160;data&#160;in&#160;their&#160;request&#160;body.<br/>
There’s&#160;a&#160;similar&#160;request&#160;function&#160;in&#160;the&#160;https&#160;module&#160;that&#160;can&#160;be&#160;used&#160;to<br/>
make&#160;requests&#160;to&#160;https:&#160;URLs.<br/>
Making&#160;requests&#160;with&#160;Node’s&#160;raw&#160;functionality&#160;is&#160;rather&#160;verbose.&#160;There<br/>
are&#160;much&#160;more&#160;convenient&#160;wrapper&#160;packages&#160;available&#160;on&#160;NPM.&#160;For&#160;example,<br/>node-fetch&#160;provides&#160;the&#160;promise-based&#160;fetch&#160;interface&#160;that&#160;we&#160;know&#160;from&#160;the<br/>browser.<br/>
<b>Streams</b><br/>
We&#160;have&#160;seen&#160;two&#160;instances&#160;of&#160;writable&#160;streams&#160;in&#160;the&#160;HTTP&#160;examples—<br/>namely,&#160;the&#160;response&#160;object&#160;that&#160;the&#160;server&#160;could&#160;write&#160;to&#160;and&#160;the&#160;request<br/>object&#160;that&#160;was&#160;returned&#160;from&#160;request.<br/>
<i>Writable&#160;streams&#160;</i>are&#160;a&#160;widely&#160;used&#160;concept&#160;in&#160;Node.&#160;Such&#160;objects&#160;have&#160;a<br/>
write&#160;method&#160;that&#160;can&#160;be&#160;passed&#160;a&#160;string&#160;or&#160;a&#160;Buffer&#160;object&#160;to&#160;write&#160;something<br/>to&#160;the&#160;stream.&#160;Their&#160;end&#160;method&#160;closes&#160;the&#160;stream&#160;and&#160;optionally&#160;takes&#160;a&#160;value<br/>to&#160;write&#160;to&#160;the&#160;stream&#160;before&#160;closing.&#160;Both&#160;of&#160;these&#160;methods&#160;can&#160;also&#160;be&#160;given<br/>a&#160;callback&#160;as&#160;an&#160;additional&#160;argument,&#160;which&#160;they&#160;will&#160;call&#160;when&#160;the&#160;writing&#160;or<br/>closing&#160;has&#160;finished.<br/>
It&#160;is&#160;possible&#160;to&#160;create&#160;a&#160;writable&#160;stream&#160;that&#160;points&#160;at&#160;a&#160;file&#160;with&#160;the<br/>
createWriteStream&#160;function&#160;from&#160;the&#160;fs&#160;module.&#160;Then&#160;you&#160;can&#160;use&#160;the&#160;write<br/>method&#160;on&#160;the&#160;resulting&#160;object&#160;to&#160;write&#160;the&#160;file&#160;one&#160;piece&#160;at&#160;a&#160;time,&#160;rather&#160;than<br/>in&#160;one&#160;shot&#160;as&#160;with&#160;writeFile.<br/>
Readable&#160;streams&#160;are&#160;a&#160;little&#160;more&#160;involved.&#160;Both&#160;the&#160;request&#160;binding&#160;that<br/>
was&#160;passed&#160;to&#160;the&#160;HTTP&#160;server’s&#160;callback&#160;and&#160;the&#160;response&#160;binding&#160;passed&#160;to<br/>the&#160;HTTP&#160;client’s&#160;callback&#160;are&#160;readable&#160;streams—a&#160;server&#160;reads&#160;requests&#160;and<br/>then&#160;writes&#160;responses,&#160;whereas&#160;a&#160;client&#160;first&#160;writes&#160;a&#160;request&#160;and&#160;then&#160;reads<br/>
359<br/>
<hr/>
<a name=372></a>a&#160;response.&#160;Reading&#160;from&#160;a&#160;stream&#160;is&#160;done&#160;using&#160;event&#160;handlers,&#160;rather&#160;than<br/>methods.<br/>
Objects&#160;that&#160;emit&#160;events&#160;in&#160;Node&#160;have&#160;a&#160;method&#160;called&#160;on&#160;that&#160;is&#160;similar&#160;to<br/>
the&#160;addEventListener&#160;method&#160;in&#160;the&#160;browser.&#160;You&#160;give&#160;it&#160;an&#160;event&#160;name&#160;and<br/>then&#160;a&#160;function,&#160;and&#160;it&#160;will&#160;register&#160;that&#160;function&#160;to&#160;be&#160;called&#160;whenever&#160;the<br/>given&#160;event&#160;occurs.<br/>
Readable&#160;streams&#160;have&#160;&#34;data&#34;&#160;and&#160;&#34;end&#34;&#160;events.&#160;The&#160;first&#160;is&#160;fired&#160;every&#160;time<br/>
data&#160;comes&#160;in,&#160;and&#160;the&#160;second&#160;is&#160;called&#160;whenever&#160;the&#160;stream&#160;is&#160;at&#160;its&#160;end.&#160;This<br/>model&#160;is&#160;most&#160;suited&#160;for&#160;<i>streaming&#160;</i>data&#160;that&#160;can&#160;be&#160;immediately&#160;processed,<br/>even&#160;when&#160;the&#160;whole&#160;document&#160;isn’t&#160;available&#160;yet.&#160;A&#160;file&#160;can&#160;be&#160;read&#160;as&#160;a<br/>readable&#160;stream&#160;by&#160;using&#160;the&#160;createReadStream&#160;function&#160;from&#160;fs.<br/>
This&#160;code&#160;creates&#160;a&#160;server&#160;that&#160;reads&#160;request&#160;bodies&#160;and&#160;streams&#160;them&#160;back<br/>
to&#160;the&#160;client&#160;as&#160;all-uppercase&#160;text:<br/>
const&#160;{createServer}&#160;=&#160;require(&#34;http&#34;);<br/>createServer((request,&#160;response)&#160;=&gt;&#160;{<br/>
response.writeHead(200,&#160;{&#34;Content-Type&#34;:&#160;&#34;text/plain&#34;});<br/>request.on(&#34;data&#34;,&#160;chunk&#160;=&gt;<br/>
response.write(chunk.toString().toUpperCase()));<br/>
request.on(&#34;end&#34;,&#160;()&#160;=&gt;&#160;response.end());<br/>
}).listen(8000);<br/>
The&#160;chunk&#160;value&#160;passed&#160;to&#160;the&#160;data&#160;handler&#160;will&#160;be&#160;a&#160;binary&#160;Buffer.&#160;We&#160;can<br/>
convert&#160;this&#160;to&#160;a&#160;string&#160;by&#160;decoding&#160;it&#160;as&#160;UTF-8&#160;encoded&#160;characters&#160;with&#160;its<br/>toString&#160;method.<br/>
The&#160;following&#160;piece&#160;of&#160;code,&#160;when&#160;run&#160;with&#160;the&#160;uppercasing&#160;server&#160;active,<br/>
will&#160;send&#160;a&#160;request&#160;to&#160;that&#160;server&#160;and&#160;write&#160;out&#160;the&#160;response&#160;it&#160;gets:<br/>
const&#160;{request}&#160;=&#160;require(&#34;http&#34;);<br/>request({<br/>
hostname:&#160;&#34;localhost&#34;,<br/>port:&#160;8000,<br/>method:&#160;&#34;POST&#34;<br/>
},&#160;response&#160;=&gt;&#160;{<br/>
response.on(&#34;data&#34;,&#160;chunk&#160;=&gt;<br/>
process.stdout.write(chunk.toString()));<br/>
}).end(&#34;Hello&#160;server&#34;);<br/>//&#160;→&#160;HELLO&#160;SERVER<br/>
The&#160;example&#160;writes&#160;to&#160;process.stdout&#160;(the&#160;process’s&#160;standard&#160;output,&#160;which<br/>
is&#160;a&#160;writable&#160;stream)&#160;instead&#160;of&#160;using&#160;console.log.&#160;We&#160;can’t&#160;use&#160;console.log<br/>
360<br/>
<hr/>
<a name=373></a>because&#160;it&#160;adds&#160;an&#160;extra&#160;newline&#160;character&#160;after&#160;each&#160;piece&#160;of&#160;text&#160;that&#160;it<br/>
writes,&#160;which&#160;isn’t&#160;appropriate&#160;here&#160;since&#160;the&#160;response&#160;may&#160;come&#160;in&#160;as&#160;multiple<br/>chunks.<br/>
<b>A&#160;file&#160;server</b><br/>
Let’s&#160;combine&#160;our&#160;newfound&#160;knowledge&#160;about&#160;HTTP&#160;servers&#160;and&#160;working&#160;with<br/>the&#160;file&#160;system&#160;to&#160;create&#160;a&#160;bridge&#160;between&#160;the&#160;two:&#160;an&#160;HTTP&#160;server&#160;that&#160;allows<br/>remote&#160;access&#160;to&#160;a&#160;file&#160;system.&#160;Such&#160;a&#160;server&#160;has&#160;all&#160;kinds&#160;of&#160;uses—it&#160;allows&#160;web<br/>applications&#160;to&#160;store&#160;and&#160;share&#160;data,&#160;or&#160;it&#160;can&#160;give&#160;a&#160;group&#160;of&#160;people&#160;shared<br/>access&#160;to&#160;a&#160;bunch&#160;of&#160;files.<br/>
When&#160;we&#160;treat&#160;files&#160;as&#160;HTTP&#160;resources,&#160;the&#160;HTTP&#160;methods&#160;GET,&#160;PUT,&#160;and<br/>
DELETE&#160;can&#160;be&#160;used&#160;to&#160;read,&#160;write,&#160;and&#160;delete&#160;the&#160;files,&#160;respectively.&#160;We&#160;will<br/>interpret&#160;the&#160;path&#160;in&#160;the&#160;request&#160;as&#160;the&#160;path&#160;of&#160;the&#160;file&#160;that&#160;the&#160;request&#160;refers<br/>to.<br/>
We&#160;probably&#160;don’t&#160;want&#160;to&#160;share&#160;our&#160;whole&#160;file&#160;system,&#160;so&#160;we’ll&#160;interpret<br/>
these&#160;paths&#160;as&#160;starting&#160;in&#160;the&#160;server’s&#160;working&#160;directory,&#160;which&#160;is&#160;the&#160;directory<br/>in&#160;which&#160;it&#160;was&#160;started.&#160;If&#160;I&#160;ran&#160;the&#160;server&#160;from&#160;/tmp/public/&#160;(or&#160;C:\tmp\public<br/>\&#160;on&#160;Windows),&#160;then&#160;a&#160;request&#160;for&#160;/file.txt&#160;should&#160;refer&#160;to&#160;/tmp/public/file<br/>.txt&#160;(or&#160;C:\tmp\public\file.txt).<br/>
We’ll&#160;build&#160;the&#160;program&#160;piece&#160;by&#160;piece,&#160;using&#160;an&#160;object&#160;called&#160;methods&#160;to&#160;store<br/>
the&#160;functions&#160;that&#160;handle&#160;the&#160;various&#160;HTTP&#160;methods.&#160;Method&#160;handlers&#160;are<br/>async&#160;functions&#160;that&#160;get&#160;the&#160;request&#160;object&#160;as&#160;argument&#160;and&#160;return&#160;a&#160;promise<br/>that&#160;resolves&#160;to&#160;an&#160;object&#160;that&#160;describes&#160;the&#160;response.<br/>
const&#160;{createServer}&#160;=&#160;require(&#34;http&#34;);<br/>
const&#160;methods&#160;=&#160;Object.create(null);<br/>
createServer((request,&#160;response)&#160;=&gt;&#160;{<br/>
let&#160;handler&#160;=&#160;methods[request.method]&#160;||&#160;notAllowed;<br/>handler(request)<br/>
.catch(error&#160;=&gt;&#160;{<br/>
if&#160;(error.status&#160;!=&#160;null)&#160;return&#160;error;<br/>return&#160;{body:&#160;String(error),&#160;status:&#160;500};<br/>
})<br/>.then(({body,&#160;status&#160;=&#160;200,&#160;type&#160;=&#160;&#34;text/plain&#34;})&#160;=&gt;&#160;{<br/>
response.writeHead(status,&#160;{&#34;Content-Type&#34;:&#160;type});<br/>if&#160;(body&#160;&amp;&amp;&#160;body.pipe)&#160;body.pipe(response);<br/>else&#160;response.end(body);<br/>
});<br/>
}).listen(8000);<br/>
361<br/>
<hr/>
<a name=374></a>async&#160;function&#160;notAllowed(request)&#160;{<br/>
return&#160;{<br/>
status:&#160;405,<br/>body:&#160;`Method&#160;${request.method}&#160;not&#160;allowed.`<br/>
};<br/>
}<br/>
This&#160;starts&#160;a&#160;server&#160;that&#160;just&#160;returns&#160;405&#160;error&#160;responses,&#160;which&#160;is&#160;the&#160;code<br/>
used&#160;to&#160;indicate&#160;that&#160;the&#160;server&#160;refuses&#160;to&#160;handle&#160;a&#160;given&#160;method.<br/>
When&#160;a&#160;request&#160;handler’s&#160;promise&#160;is&#160;rejected,&#160;the&#160;catch&#160;call&#160;translates&#160;the<br/>
error&#160;into&#160;a&#160;response&#160;object,&#160;if&#160;it&#160;isn’t&#160;one&#160;already,&#160;so&#160;that&#160;the&#160;server&#160;can&#160;send<br/>back&#160;an&#160;error&#160;response&#160;to&#160;inform&#160;the&#160;client&#160;that&#160;it&#160;failed&#160;to&#160;handle&#160;the&#160;request.<br/>
The&#160;status&#160;field&#160;of&#160;the&#160;response&#160;description&#160;may&#160;be&#160;omitted,&#160;in&#160;which&#160;case<br/>
it&#160;defaults&#160;to&#160;200&#160;(OK).&#160;The&#160;content&#160;type,&#160;in&#160;the&#160;type&#160;property,&#160;can&#160;also&#160;be<br/>left&#160;off,&#160;in&#160;which&#160;case&#160;the&#160;response&#160;is&#160;assumed&#160;to&#160;be&#160;plain&#160;text.<br/>
When&#160;the&#160;value&#160;of&#160;body&#160;is&#160;a&#160;readable&#160;stream,&#160;it&#160;will&#160;have&#160;a&#160;pipe&#160;method&#160;that<br/>
is&#160;used&#160;to&#160;forward&#160;all&#160;content&#160;from&#160;a&#160;readable&#160;stream&#160;to&#160;a&#160;writable&#160;stream.&#160;If<br/>not,&#160;it&#160;is&#160;assumed&#160;to&#160;be&#160;either&#160;null&#160;(no&#160;body),&#160;a&#160;string,&#160;or&#160;a&#160;buffer,&#160;and&#160;it&#160;is<br/>passed&#160;directly&#160;to&#160;the&#160;response’s&#160;end&#160;method.<br/>
To&#160;figure&#160;out&#160;which&#160;file&#160;path&#160;corresponds&#160;to&#160;a&#160;request&#160;URL,&#160;the&#160;urlPath<br/>
function&#160;uses&#160;Node’s&#160;built-in&#160;url&#160;module&#160;to&#160;parse&#160;the&#160;URL.&#160;It&#160;takes&#160;its&#160;path-<br/>name,&#160;which&#160;will&#160;be&#160;something&#160;like&#160;&#34;/file.txt&#34;,&#160;decodes&#160;that&#160;to&#160;get&#160;rid&#160;of<br/>the&#160;%20-style&#160;escape&#160;codes,&#160;and&#160;resolves&#160;it&#160;relative&#160;to&#160;the&#160;program’s&#160;working<br/>directory.<br/>
const&#160;{parse}&#160;=&#160;require(&#34;url&#34;);<br/>const&#160;{resolve,&#160;sep}&#160;=&#160;require(&#34;path&#34;);<br/>
const&#160;baseDirectory&#160;=&#160;process.cwd();<br/>
function&#160;urlPath(url)&#160;{<br/>
let&#160;{pathname}&#160;=&#160;parse(url);<br/>let&#160;path&#160;=&#160;resolve(decodeURIComponent(pathname).slice(1));<br/>if&#160;(path&#160;!=&#160;baseDirectory&#160;&amp;&amp;<br/>
!path.startsWith(baseDirectory&#160;+&#160;sep))&#160;{<br/>
throw&#160;{status:&#160;403,&#160;body:&#160;&#34;Forbidden&#34;};<br/>
}<br/>return&#160;path;<br/>
}<br/>
As&#160;soon&#160;as&#160;you&#160;set&#160;up&#160;a&#160;program&#160;to&#160;accept&#160;network&#160;requests,&#160;you&#160;have&#160;to<br/>
362<br/>
<hr/>
<a name=375></a>start&#160;worrying&#160;about&#160;security.&#160;In&#160;this&#160;case,&#160;if&#160;we&#160;aren’t&#160;careful,&#160;it&#160;is&#160;likely&#160;that<br/>we’ll&#160;accidentally&#160;expose&#160;our&#160;whole&#160;file&#160;system&#160;to&#160;the&#160;network.<br/>
File&#160;paths&#160;are&#160;strings&#160;in&#160;Node.&#160;To&#160;map&#160;such&#160;a&#160;string&#160;to&#160;an&#160;actual&#160;file,&#160;there<br/>
is&#160;a&#160;nontrivial&#160;amount&#160;of&#160;interpretation&#160;going&#160;on.&#160;Paths&#160;may,&#160;for&#160;example,<br/>include&#160;../&#160;to&#160;refer&#160;to&#160;a&#160;parent&#160;directory.&#160;So&#160;one&#160;obvious&#160;source&#160;of&#160;problems<br/>would&#160;be&#160;requests&#160;for&#160;paths&#160;like&#160;/../secret_file.<br/>
To&#160;avoid&#160;such&#160;problems,&#160;urlPath&#160;uses&#160;the&#160;resolve&#160;function&#160;from&#160;the&#160;path<br/>
module,&#160;which&#160;resolves&#160;relative&#160;paths.&#160;It&#160;then&#160;verifies&#160;that&#160;the&#160;result&#160;is&#160;<i>below<br/></i>the&#160;working&#160;directory.&#160;The&#160;process.cwd&#160;function&#160;(where&#160;cwd&#160;stands&#160;for&#160;“current<br/>working&#160;directory”)&#160;can&#160;be&#160;used&#160;to&#160;find&#160;this&#160;working&#160;directory.&#160;The&#160;sep&#160;binding<br/>from&#160;the&#160;path&#160;package&#160;is&#160;the&#160;system’s&#160;path&#160;separator—a&#160;backslash&#160;on&#160;Windows<br/>and&#160;a&#160;forward&#160;slash&#160;on&#160;most&#160;other&#160;systems.&#160;When&#160;the&#160;path&#160;doesn’t&#160;start&#160;with<br/>the&#160;base&#160;directory,&#160;the&#160;function&#160;throws&#160;an&#160;error&#160;response&#160;object,&#160;using&#160;the<br/>HTTP&#160;status&#160;code&#160;indicating&#160;that&#160;access&#160;to&#160;the&#160;resource&#160;is&#160;forbidden.<br/>
We’ll&#160;set&#160;up&#160;the&#160;GET&#160;method&#160;to&#160;return&#160;a&#160;list&#160;of&#160;files&#160;when&#160;reading&#160;a&#160;directory<br/>
and&#160;to&#160;return&#160;the&#160;file’s&#160;content&#160;when&#160;reading&#160;a&#160;regular&#160;file.<br/>
One&#160;tricky&#160;question&#160;is&#160;what&#160;kind&#160;of&#160;Content-Type&#160;header&#160;we&#160;should&#160;set&#160;when<br/>
returning&#160;a&#160;file’s&#160;content.&#160;Since&#160;these&#160;files&#160;could&#160;be&#160;anything,&#160;our&#160;server&#160;can’t<br/>simply&#160;return&#160;the&#160;same&#160;content&#160;type&#160;for&#160;all&#160;of&#160;them.&#160;NPM&#160;can&#160;help&#160;us&#160;again<br/>here.&#160;The&#160;mime&#160;package&#160;(content&#160;type&#160;indicators&#160;like&#160;text/plain&#160;are&#160;also&#160;called<br/><i>MIME&#160;types</i>)&#160;knows&#160;the&#160;correct&#160;type&#160;for&#160;a&#160;large&#160;number&#160;of&#160;file&#160;extensions.<br/>
The&#160;following&#160;npm&#160;command,&#160;in&#160;the&#160;directory&#160;where&#160;the&#160;server&#160;script&#160;lives,<br/>
installs&#160;a&#160;specific&#160;version&#160;of&#160;mime:<br/>
$&#160;npm&#160;install&#160;mime@2.2.0<br/>
When&#160;a&#160;requested&#160;file&#160;does&#160;not&#160;exist,&#160;the&#160;correct&#160;HTTP&#160;status&#160;code&#160;to&#160;return<br/>
is&#160;404.&#160;We’ll&#160;use&#160;the&#160;stat&#160;function,&#160;which&#160;looks&#160;up&#160;information&#160;about&#160;a&#160;file,&#160;to<br/>find&#160;out&#160;both&#160;whether&#160;the&#160;file&#160;exists&#160;and&#160;whether&#160;it&#160;is&#160;a&#160;directory.<br/>
const&#160;{createReadStream}&#160;=&#160;require(&#34;fs&#34;);<br/>const&#160;{stat,&#160;readdir}&#160;=&#160;require(&#34;fs&#34;).promises;<br/>const&#160;mime&#160;=&#160;require(&#34;mime&#34;);<br/>
methods.GET&#160;=&#160;async&#160;function(request)&#160;{<br/>
let&#160;path&#160;=&#160;urlPath(request.url);<br/>let&#160;stats;<br/>try&#160;{<br/>
stats&#160;=&#160;await&#160;stat(path);<br/>
}&#160;catch&#160;(error)&#160;{<br/>
if&#160;(error.code&#160;!=&#160;&#34;ENOENT&#34;)&#160;throw&#160;error;<br/>
363<br/>
<hr/>
<a name=376></a>else&#160;return&#160;{status:&#160;404,&#160;body:&#160;&#34;File&#160;not&#160;found&#34;};<br/>
}<br/>if&#160;(stats.isDirectory())&#160;{<br/>
return&#160;{body:&#160;(await&#160;readdir(path)).join(&#34;\n&#34;)};<br/>
}&#160;else&#160;{<br/>
return&#160;{body:&#160;createReadStream(path),<br/>
type:&#160;mime.getType(path)};<br/>
}<br/>
};<br/>
Because&#160;it&#160;has&#160;to&#160;touch&#160;the&#160;disk&#160;and&#160;thus&#160;might&#160;take&#160;a&#160;while,&#160;stat&#160;is&#160;asyn-<br/>
chronous.&#160;Since&#160;we’re&#160;using&#160;promises&#160;rather&#160;than&#160;callback&#160;style,&#160;it&#160;has&#160;to&#160;be<br/>imported&#160;from&#160;promises&#160;instead&#160;of&#160;directly&#160;from&#160;fs.<br/>
When&#160;the&#160;file&#160;does&#160;not&#160;exist,&#160;stat&#160;will&#160;throw&#160;an&#160;error&#160;object&#160;with&#160;a&#160;code<br/>
property&#160;of&#160;&#34;ENOENT&#34;.&#160;These&#160;somewhat&#160;obscure,&#160;Unix-inspired&#160;codes&#160;are&#160;how<br/>you&#160;recognize&#160;error&#160;types&#160;in&#160;Node.<br/>
The&#160;stats&#160;object&#160;returned&#160;by&#160;stat&#160;tells&#160;us&#160;a&#160;number&#160;of&#160;things&#160;about&#160;a&#160;file,<br/>
such&#160;as&#160;its&#160;size&#160;(size&#160;property)&#160;and&#160;its&#160;modification&#160;date&#160;(mtime&#160;property).<br/>Here&#160;we&#160;are&#160;interested&#160;in&#160;the&#160;question&#160;of&#160;whether&#160;it&#160;is&#160;a&#160;directory&#160;or&#160;a&#160;regular<br/>file,&#160;which&#160;the&#160;isDirectory&#160;method&#160;tells&#160;us.<br/>
We&#160;use&#160;readdir&#160;to&#160;read&#160;the&#160;array&#160;of&#160;files&#160;in&#160;a&#160;directory&#160;and&#160;return&#160;it&#160;to&#160;the<br/>
client.&#160;For&#160;normal&#160;files,&#160;we&#160;create&#160;a&#160;readable&#160;stream&#160;with&#160;createReadStream<br/>and&#160;return&#160;that&#160;as&#160;the&#160;body,&#160;along&#160;with&#160;the&#160;content&#160;type&#160;that&#160;the&#160;mime&#160;package<br/>gives&#160;us&#160;for&#160;the&#160;file’s&#160;name.<br/>
The&#160;code&#160;to&#160;handle&#160;DELETE&#160;requests&#160;is&#160;slightly&#160;simpler.<br/>
const&#160;{rmdir,&#160;unlink}&#160;=&#160;require(&#34;fs&#34;).promises;<br/>
methods.DELETE&#160;=&#160;async&#160;function(request)&#160;{<br/>
let&#160;path&#160;=&#160;urlPath(request.url);<br/>let&#160;stats;<br/>try&#160;{<br/>
stats&#160;=&#160;await&#160;stat(path);<br/>
}&#160;catch&#160;(error)&#160;{<br/>
if&#160;(error.code&#160;!=&#160;&#34;ENOENT&#34;)&#160;throw&#160;error;<br/>else&#160;return&#160;{status:&#160;204};<br/>
}<br/>if&#160;(stats.isDirectory())&#160;await&#160;rmdir(path);<br/>else&#160;await&#160;unlink(path);<br/>return&#160;{status:&#160;204};<br/>
};<br/>
364<br/>
<hr/>
<a name=377></a>When&#160;an&#160;HTTP&#160;response&#160;does&#160;not&#160;contain&#160;any&#160;data,&#160;the&#160;status&#160;code&#160;204&#160;(“no<br/>
content”)&#160;can&#160;be&#160;used&#160;to&#160;indicate&#160;this.&#160;Since&#160;the&#160;response&#160;to&#160;deletion&#160;doesn’t<br/>need&#160;to&#160;transmit&#160;any&#160;information&#160;beyond&#160;whether&#160;the&#160;operation&#160;succeeded,<br/>that&#160;is&#160;a&#160;sensible&#160;thing&#160;to&#160;return&#160;here.<br/>
You&#160;may&#160;be&#160;wondering&#160;why&#160;trying&#160;to&#160;delete&#160;a&#160;nonexistent&#160;file&#160;returns&#160;a<br/>
success&#160;status&#160;code,&#160;rather&#160;than&#160;an&#160;error.&#160;When&#160;the&#160;file&#160;that&#160;is&#160;being&#160;deleted<br/>is&#160;not&#160;there,&#160;you&#160;could&#160;say&#160;that&#160;the&#160;request’s&#160;objective&#160;is&#160;already&#160;fulfilled.&#160;The<br/>HTTP&#160;standard&#160;encourages&#160;us&#160;to&#160;make&#160;requests&#160;<i>idempotent</i>,&#160;which&#160;means&#160;that<br/>making&#160;the&#160;same&#160;request&#160;multiple&#160;times&#160;produces&#160;the&#160;same&#160;result&#160;as&#160;making&#160;it<br/>once.&#160;In&#160;a&#160;way,&#160;if&#160;you&#160;try&#160;to&#160;delete&#160;something&#160;that’s&#160;already&#160;gone,&#160;the&#160;effect<br/>you&#160;were&#160;trying&#160;to&#160;do&#160;has&#160;been&#160;achieved—the&#160;thing&#160;is&#160;no&#160;longer&#160;there.<br/>
This&#160;is&#160;the&#160;handler&#160;for&#160;PUT&#160;requests:<br/>
const&#160;{createWriteStream}&#160;=&#160;require(&#34;fs&#34;);<br/>
function&#160;pipeStream(from,&#160;to)&#160;{<br/>
return&#160;new&#160;Promise((resolve,&#160;reject)&#160;=&gt;&#160;{<br/>
from.on(&#34;error&#34;,&#160;reject);<br/>to.on(&#34;error&#34;,&#160;reject);<br/>to.on(&#34;finish&#34;,&#160;resolve);<br/>from.pipe(to);<br/>
});<br/>
}<br/>
methods.PUT&#160;=&#160;async&#160;function(request)&#160;{<br/>
let&#160;path&#160;=&#160;urlPath(request.url);<br/>await&#160;pipeStream(request,&#160;createWriteStream(path));<br/>return&#160;{status:&#160;204};<br/>
};<br/>
We&#160;don’t&#160;need&#160;to&#160;check&#160;whether&#160;the&#160;file&#160;exists&#160;this&#160;time—if&#160;it&#160;does,&#160;we’ll<br/>
just&#160;overwrite&#160;it.&#160;We&#160;again&#160;use&#160;pipe&#160;to&#160;move&#160;data&#160;from&#160;a&#160;readable&#160;stream&#160;to<br/>a&#160;writable&#160;one,&#160;in&#160;this&#160;case&#160;from&#160;the&#160;request&#160;to&#160;the&#160;file.&#160;But&#160;since&#160;pipe&#160;isn’t<br/>written&#160;to&#160;return&#160;a&#160;promise,&#160;we&#160;have&#160;to&#160;write&#160;a&#160;wrapper,&#160;pipeStream,&#160;that<br/>creates&#160;a&#160;promise&#160;around&#160;the&#160;outcome&#160;of&#160;calling&#160;pipe.<br/>
When&#160;something&#160;goes&#160;wrong&#160;when&#160;opening&#160;the&#160;file,&#160;createWriteStream&#160;will<br/>
still&#160;return&#160;a&#160;stream,&#160;but&#160;that&#160;stream&#160;will&#160;fire&#160;an&#160;&#34;error&#34;&#160;event.&#160;The&#160;output<br/>stream&#160;to&#160;the&#160;request&#160;may&#160;also&#160;fail,&#160;for&#160;example&#160;if&#160;the&#160;network&#160;goes&#160;down.&#160;So&#160;we<br/>wire&#160;up&#160;both&#160;streams’&#160;&#34;error&#34;&#160;events&#160;to&#160;reject&#160;the&#160;promise.&#160;When&#160;pipe&#160;is&#160;done,<br/>it&#160;will&#160;close&#160;the&#160;output&#160;stream,&#160;which&#160;causes&#160;it&#160;to&#160;fire&#160;a&#160;&#34;finish&#34;&#160;event.&#160;That’s<br/>the&#160;point&#160;where&#160;we&#160;can&#160;successfully&#160;resolve&#160;the&#160;promise&#160;(returning&#160;nothing).<br/>
365<br/>
<hr/>
<a name=378></a>The&#160;full&#160;script&#160;for&#160;the&#160;server&#160;is&#160;available&#160;at&#160;<a href="https://eloquentjavascript.net/code/file_server.js"><i>https://eloquentjavascript.net/</i></a><br/>
<a href="https://eloquentjavascript.net/code/file_server.js"><i>code/file_server.js</i></a>.&#160;You&#160;can&#160;download&#160;that&#160;and,&#160;after&#160;installing&#160;its&#160;dependen-<br/>cies,&#160;run&#160;it&#160;with&#160;Node&#160;to&#160;start&#160;your&#160;own&#160;file&#160;server.&#160;And,&#160;of&#160;course,&#160;you&#160;can<br/>modify&#160;and&#160;extend&#160;it&#160;to&#160;solve&#160;this&#160;chapter’s&#160;exercises&#160;or&#160;to&#160;experiment.<br/>
The&#160;command&#160;line&#160;tool&#160;curl,&#160;widely&#160;available&#160;on&#160;Unix-like&#160;systems&#160;(such&#160;as<br/>
macOS&#160;and&#160;Linux),&#160;can&#160;be&#160;used&#160;to&#160;make&#160;HTTP&#160;requests.&#160;The&#160;following&#160;session<br/>briefly&#160;tests&#160;our&#160;server.&#160;The&#160;-X&#160;option&#160;is&#160;used&#160;to&#160;set&#160;the&#160;request’s&#160;method,&#160;and<br/>-d&#160;is&#160;used&#160;to&#160;include&#160;a&#160;request&#160;body.<br/>
$&#160;curl&#160;http://localhost:8000/file.txt<br/>File&#160;not&#160;found<br/>$&#160;curl&#160;-X&#160;PUT&#160;-d&#160;hello&#160;http://localhost:8000/file.txt<br/>$&#160;curl&#160;http://localhost:8000/file.txt<br/>hello<br/>$&#160;curl&#160;-X&#160;DELETE&#160;http://localhost:8000/file.txt<br/>$&#160;curl&#160;http://localhost:8000/file.txt<br/>File&#160;not&#160;found<br/>
The&#160;first&#160;request&#160;for&#160;file.txt&#160;fails&#160;since&#160;the&#160;file&#160;does&#160;not&#160;exist&#160;yet.&#160;The&#160;PUT<br/>
request&#160;creates&#160;the&#160;file,&#160;and&#160;behold,&#160;the&#160;next&#160;request&#160;successfully&#160;retrieves&#160;it.<br/>After&#160;deleting&#160;it&#160;with&#160;a&#160;DELETE&#160;request,&#160;the&#160;file&#160;is&#160;again&#160;missing.<br/>
<b>Summary</b><br/>
Node&#160;is&#160;a&#160;nice,&#160;small&#160;system&#160;that&#160;lets&#160;us&#160;run&#160;JavaScript&#160;in&#160;a&#160;nonbrowser&#160;con-<br/>text.&#160;It&#160;was&#160;originally&#160;designed&#160;for&#160;network&#160;tasks&#160;to&#160;play&#160;the&#160;role&#160;of&#160;a&#160;<i>node<br/></i>in&#160;a&#160;network.&#160;But&#160;it&#160;lends&#160;itself&#160;to&#160;all&#160;kinds&#160;of&#160;scripting&#160;tasks,&#160;and&#160;if&#160;writing<br/>JavaScript&#160;is&#160;something&#160;you&#160;enjoy,&#160;automating&#160;tasks&#160;with&#160;Node&#160;works&#160;well.<br/>
NPM&#160;provides&#160;packages&#160;for&#160;everything&#160;you&#160;can&#160;think&#160;of&#160;(and&#160;quite&#160;a&#160;few<br/>
things&#160;you’d&#160;probably&#160;never&#160;think&#160;of),&#160;and&#160;it&#160;allows&#160;you&#160;to&#160;fetch&#160;and&#160;install<br/>those&#160;packages&#160;with&#160;the&#160;npm&#160;program.&#160;Node&#160;comes&#160;with&#160;a&#160;number&#160;of&#160;built-in<br/>modules,&#160;including&#160;the&#160;fs&#160;module&#160;for&#160;working&#160;with&#160;the&#160;file&#160;system&#160;and&#160;the&#160;http<br/>module&#160;for&#160;running&#160;HTTP&#160;servers&#160;and&#160;making&#160;HTTP&#160;requests.<br/>
All&#160;input&#160;and&#160;output&#160;in&#160;Node&#160;is&#160;done&#160;asynchronously,&#160;unless&#160;you&#160;explicitly<br/>
use&#160;a&#160;synchronous&#160;variant&#160;of&#160;a&#160;function,&#160;such&#160;as&#160;readFileSync.&#160;When&#160;calling<br/>such&#160;asynchronous&#160;functions,&#160;you&#160;provide&#160;callback&#160;functions,&#160;and&#160;Node&#160;will&#160;call<br/>them&#160;with&#160;an&#160;error&#160;value&#160;and&#160;(if&#160;available)&#160;a&#160;result&#160;when&#160;it&#160;is&#160;ready.<br/>
366<br/>
<hr/>
<a name=379></a><b>Exercises</b><br/>
<b>Search&#160;tool</b><br/>
On&#160;Unix&#160;systems,&#160;there&#160;is&#160;a&#160;command&#160;line&#160;tool&#160;called&#160;grep&#160;that&#160;can&#160;be&#160;used&#160;to<br/>quickly&#160;search&#160;files&#160;for&#160;a&#160;regular&#160;expression.<br/>
Write&#160;a&#160;Node&#160;script&#160;that&#160;can&#160;be&#160;run&#160;from&#160;the&#160;command&#160;line&#160;and&#160;acts&#160;some-<br/>
what&#160;like&#160;grep.&#160;It&#160;treats&#160;its&#160;first&#160;command&#160;line&#160;argument&#160;as&#160;a&#160;regular&#160;expression<br/>and&#160;treats&#160;any&#160;further&#160;arguments&#160;as&#160;files&#160;to&#160;search.&#160;It&#160;should&#160;output&#160;the&#160;names<br/>of&#160;any&#160;file&#160;whose&#160;content&#160;matches&#160;the&#160;regular&#160;expression.<br/>
When&#160;that&#160;works,&#160;extend&#160;it&#160;so&#160;that&#160;when&#160;one&#160;of&#160;the&#160;arguments&#160;is&#160;a&#160;directory,<br/>
it&#160;searches&#160;through&#160;all&#160;files&#160;in&#160;that&#160;directory&#160;and&#160;its&#160;subdirectories.<br/>
Use&#160;asynchronous&#160;or&#160;synchronous&#160;file&#160;system&#160;functions&#160;as&#160;you&#160;see&#160;fit.&#160;Setting<br/>
things&#160;up&#160;so&#160;that&#160;multiple&#160;asynchronous&#160;actions&#160;are&#160;requested&#160;at&#160;the&#160;same&#160;time<br/>might&#160;speed&#160;things&#160;up&#160;a&#160;little,&#160;but&#160;not&#160;a&#160;huge&#160;amount,&#160;since&#160;most&#160;file&#160;systems<br/>can&#160;read&#160;only&#160;one&#160;thing&#160;at&#160;a&#160;time.<br/>
<b>Directory&#160;creation</b><br/>
Though&#160;the&#160;DELETE&#160;method&#160;in&#160;our&#160;file&#160;server&#160;is&#160;able&#160;to&#160;delete&#160;directories&#160;(using<br/>rmdir),&#160;the&#160;server&#160;currently&#160;does&#160;not&#160;provide&#160;any&#160;way&#160;to&#160;<i>create&#160;</i>a&#160;directory.<br/>
Add&#160;support&#160;for&#160;the&#160;MKCOL&#160;method&#160;(“make&#160;collection”),&#160;which&#160;should&#160;create&#160;a<br/>
directory&#160;by&#160;calling&#160;mkdir&#160;from&#160;the&#160;fs&#160;module.&#160;MKCOL&#160;is&#160;not&#160;a&#160;widely&#160;used&#160;HTTP<br/>method,&#160;but&#160;it&#160;does&#160;exist&#160;for&#160;this&#160;same&#160;purpose&#160;in&#160;the&#160;<i>WebDAV&#160;</i>standard,&#160;which<br/>specifies&#160;a&#160;set&#160;of&#160;conventions&#160;on&#160;top&#160;of&#160;HTTP&#160;that&#160;make&#160;it&#160;suitable&#160;for&#160;creating<br/>documents.<br/>
<b>A&#160;public&#160;space&#160;on&#160;the&#160;web</b><br/>
Since&#160;the&#160;file&#160;server&#160;serves&#160;up&#160;any&#160;kind&#160;of&#160;file&#160;and&#160;even&#160;includes&#160;the&#160;right&#160;Content<br/>-Type&#160;header,&#160;you&#160;can&#160;use&#160;it&#160;to&#160;serve&#160;a&#160;website.&#160;Since&#160;it&#160;allows&#160;everybody&#160;to<br/>delete&#160;and&#160;replace&#160;files,&#160;it&#160;would&#160;be&#160;an&#160;interesting&#160;kind&#160;of&#160;website:&#160;one&#160;that<br/>can&#160;be&#160;modified,&#160;improved,&#160;and&#160;vandalized&#160;by&#160;everybody&#160;who&#160;takes&#160;the&#160;time<br/>to&#160;create&#160;the&#160;right&#160;HTTP&#160;request.<br/>
Write&#160;a&#160;basic&#160;HTML&#160;page&#160;that&#160;includes&#160;a&#160;simple&#160;JavaScript&#160;file.&#160;Put&#160;the<br/>
files&#160;in&#160;a&#160;directory&#160;served&#160;by&#160;the&#160;file&#160;server&#160;and&#160;open&#160;them&#160;in&#160;your&#160;browser.<br/>
Next,&#160;as&#160;an&#160;advanced&#160;exercise&#160;or&#160;even&#160;a&#160;weekend&#160;project,&#160;combine&#160;all&#160;the<br/>
knowledge&#160;you&#160;gained&#160;from&#160;this&#160;book&#160;to&#160;build&#160;a&#160;more&#160;user-friendly&#160;interface<br/>for&#160;modifying&#160;the&#160;website—from&#160;<i>inside&#160;</i>the&#160;website.<br/>
Use&#160;an&#160;HTML&#160;form&#160;to&#160;edit&#160;the&#160;content&#160;of&#160;the&#160;files&#160;that&#160;make&#160;up&#160;the&#160;website,<br/>
allowing&#160;the&#160;user&#160;to&#160;update&#160;them&#160;on&#160;the&#160;server&#160;by&#160;using&#160;HTTP&#160;requests,&#160;as<br/>
367<br/>
<hr/>
<a name=380></a>described&#160;in&#160;<a href="eloquent-javascripts.html#320">Chapter&#160;18</a>.<br/>
Start&#160;by&#160;making&#160;only&#160;a&#160;single&#160;file&#160;editable.&#160;Then&#160;make&#160;it&#160;so&#160;that&#160;the&#160;user<br/>
can&#160;select&#160;which&#160;file&#160;to&#160;edit.&#160;Use&#160;the&#160;fact&#160;that&#160;our&#160;file&#160;server&#160;returns&#160;lists&#160;of<br/>files&#160;when&#160;reading&#160;a&#160;directory.<br/>
Don’t&#160;work&#160;directly&#160;in&#160;the&#160;code&#160;exposed&#160;by&#160;the&#160;file&#160;server&#160;since&#160;if&#160;you&#160;make<br/>
a&#160;mistake,&#160;you&#160;are&#160;likely&#160;to&#160;damage&#160;the&#160;files&#160;there.&#160;Instead,&#160;keep&#160;your&#160;work<br/>outside&#160;of&#160;the&#160;publicly&#160;accessible&#160;directory&#160;and&#160;copy&#160;it&#160;there&#160;when&#160;testing.<br/>
368<br/>
<hr/>
<a name=381></a><i>“If&#160;you&#160;have&#160;knowledge,&#160;let&#160;others&#160;light&#160;their&#160;candles&#160;at&#160;it.”</i><br/>
—Margaret&#160;Fuller<br/>
<b>Chapter&#160;21<br/>Project:&#160;Skill-Sharing&#160;Website</b><br/>
A&#160;<i>skill-sharing&#160;</i>meeting&#160;is&#160;an&#160;event&#160;where&#160;people&#160;with&#160;a&#160;shared&#160;interest&#160;come<br/>together&#160;and&#160;give&#160;small,&#160;informal&#160;presentations&#160;about&#160;things&#160;they&#160;know.&#160;At&#160;a<br/>gardening&#160;skill-sharing&#160;meeting,&#160;someone&#160;might&#160;explain&#160;how&#160;to&#160;cultivate&#160;celery.<br/>Or&#160;in&#160;a&#160;programming&#160;skill-sharing&#160;group,&#160;you&#160;could&#160;drop&#160;by&#160;and&#160;tell&#160;people<br/>about&#160;Node.js.<br/>
Such&#160;meetups—also&#160;often&#160;called&#160;<i>users’&#160;groups&#160;</i>when&#160;they&#160;are&#160;about&#160;computers—<br/>
are&#160;a&#160;great&#160;way&#160;to&#160;broaden&#160;your&#160;horizon,&#160;learn&#160;about&#160;new&#160;developments,&#160;or<br/>simply&#160;meet&#160;people&#160;with&#160;similar&#160;interests.&#160;Many&#160;larger&#160;cities&#160;have&#160;JavaScript<br/>meetups.&#160;They&#160;are&#160;typically&#160;free&#160;to&#160;attend,&#160;and&#160;I’ve&#160;found&#160;the&#160;ones&#160;I’ve&#160;visited<br/>to&#160;be&#160;friendly&#160;and&#160;welcoming.<br/>
In&#160;this&#160;final&#160;project&#160;chapter,&#160;our&#160;goal&#160;is&#160;to&#160;set&#160;up&#160;a&#160;website&#160;for&#160;managing<br/>
talks&#160;given&#160;at&#160;a&#160;skill-sharing&#160;meeting.&#160;Imagine&#160;a&#160;small&#160;group&#160;of&#160;people&#160;meeting<br/>up&#160;regularly&#160;in&#160;the&#160;office&#160;of&#160;one&#160;of&#160;the&#160;members&#160;to&#160;talk&#160;about&#160;unicycling.&#160;The<br/>previous&#160;organizer&#160;of&#160;the&#160;meetings&#160;moved&#160;to&#160;another&#160;town,&#160;and&#160;nobody&#160;stepped<br/>forward&#160;to&#160;take&#160;over&#160;this&#160;task.&#160;We&#160;want&#160;a&#160;system&#160;that&#160;will&#160;let&#160;the&#160;participants<br/>propose&#160;and&#160;discuss&#160;talks&#160;among&#160;themselves,&#160;without&#160;a&#160;central&#160;organizer.<br/>
The&#160;full&#160;code&#160;for&#160;the&#160;project&#160;can&#160;be&#160;downloaded&#160;from&#160;<a href="https://eloquentjavascript.net/code/skillsharing.zip"><i>https://eloquentjavascript.net/</i></a><br/>
<a href="https://eloquentjavascript.net/code/skillsharing.zip"><i>code/skillsharing.zip</i>.</a><br/>
<b>Design</b><br/>
There&#160;is&#160;a&#160;<i>server&#160;</i>part&#160;to&#160;this&#160;project,&#160;written&#160;for&#160;Node.js,&#160;and&#160;a&#160;<i>client&#160;</i>part,<br/>written&#160;for&#160;the&#160;browser.&#160;The&#160;server&#160;stores&#160;the&#160;system’s&#160;data&#160;and&#160;provides&#160;it&#160;to<br/>the&#160;client.&#160;It&#160;also&#160;serves&#160;the&#160;files&#160;that&#160;implement&#160;the&#160;client-side&#160;system.<br/>
The&#160;server&#160;keeps&#160;the&#160;list&#160;of&#160;talks&#160;proposed&#160;for&#160;the&#160;next&#160;meeting,&#160;and&#160;the<br/>
client&#160;shows&#160;this&#160;list.&#160;Each&#160;talk&#160;has&#160;a&#160;presenter&#160;name,&#160;a&#160;title,&#160;a&#160;summary,&#160;and<br/>an&#160;array&#160;of&#160;comments&#160;associated&#160;with&#160;it.&#160;The&#160;client&#160;allows&#160;users&#160;to&#160;propose&#160;new<br/>talks&#160;(adding&#160;them&#160;to&#160;the&#160;list),&#160;delete&#160;talks,&#160;and&#160;comment&#160;on&#160;existing&#160;talks.<br/>Whenever&#160;the&#160;user&#160;makes&#160;such&#160;a&#160;change,&#160;the&#160;client&#160;makes&#160;an&#160;HTTP&#160;request&#160;to<br/>tell&#160;the&#160;server&#160;about&#160;it.<br/>
369<br/>
<hr/>
<a name=382></a><img src="eloquent-javascript-382_1.png"/><br/>
The&#160;application&#160;will&#160;be&#160;set&#160;up&#160;to&#160;show&#160;a&#160;<i>live&#160;</i>view&#160;of&#160;the&#160;current&#160;proposed<br/>
talks&#160;and&#160;their&#160;comments.&#160;Whenever&#160;someone,&#160;somewhere,&#160;submits&#160;a&#160;new&#160;talk<br/>or&#160;adds&#160;a&#160;comment,&#160;all&#160;people&#160;who&#160;have&#160;the&#160;page&#160;open&#160;in&#160;their&#160;browsers&#160;should<br/>immediately&#160;see&#160;the&#160;change.&#160;This&#160;poses&#160;a&#160;bit&#160;of&#160;a&#160;challenge—there&#160;is&#160;no&#160;way<br/>for&#160;a&#160;web&#160;server&#160;to&#160;open&#160;a&#160;connection&#160;to&#160;a&#160;client,&#160;nor&#160;is&#160;there&#160;a&#160;good&#160;way&#160;to<br/>know&#160;which&#160;clients&#160;are&#160;currently&#160;looking&#160;at&#160;a&#160;given&#160;website.<br/>
A&#160;common&#160;solution&#160;to&#160;this&#160;problem&#160;is&#160;called&#160;<i>long&#160;polling</i>,&#160;which&#160;happens&#160;to<br/>
be&#160;one&#160;of&#160;the&#160;motivations&#160;for&#160;Node’s&#160;design.<br/>
<b>Long&#160;polling</b><br/>
To&#160;be&#160;able&#160;to&#160;immediately&#160;notify&#160;a&#160;client&#160;that&#160;something&#160;changed,&#160;we&#160;need&#160;a<br/>connection&#160;to&#160;that&#160;client.&#160;Since&#160;web&#160;browsers&#160;do&#160;not&#160;traditionally&#160;accept&#160;con-<br/>nections&#160;and&#160;clients&#160;are&#160;often&#160;behind&#160;routers&#160;that&#160;would&#160;block&#160;such&#160;connections<br/>anyway,&#160;having&#160;the&#160;server&#160;initiate&#160;this&#160;connection&#160;is&#160;not&#160;practical.<br/>
We&#160;can&#160;arrange&#160;for&#160;the&#160;client&#160;to&#160;open&#160;the&#160;connection&#160;and&#160;keep&#160;it&#160;around&#160;so<br/>
that&#160;the&#160;server&#160;can&#160;use&#160;it&#160;to&#160;send&#160;information&#160;when&#160;it&#160;needs&#160;to&#160;do&#160;so.<br/>
But&#160;an&#160;HTTP&#160;request&#160;allows&#160;only&#160;a&#160;simple&#160;flow&#160;of&#160;information:&#160;the&#160;client<br/>
sends&#160;a&#160;request,&#160;the&#160;server&#160;comes&#160;back&#160;with&#160;a&#160;single&#160;response,&#160;and&#160;that&#160;is&#160;it.<br/>There&#160;is&#160;a&#160;technology&#160;called&#160;<i>WebSockets</i>,&#160;supported&#160;by&#160;modern&#160;browsers,&#160;that<br/>makes&#160;it&#160;possible&#160;to&#160;open&#160;connections&#160;for&#160;arbitrary&#160;data&#160;exchange.&#160;But&#160;using<br/>
370<br/>
<hr/>
<a name=383></a>them&#160;properly&#160;is&#160;somewhat&#160;tricky.<br/>
In&#160;this&#160;chapter,&#160;we&#160;use&#160;a&#160;simpler&#160;technique—long&#160;polling—where&#160;clients&#160;con-<br/>
tinuously&#160;ask&#160;the&#160;server&#160;for&#160;new&#160;information&#160;using&#160;regular&#160;HTTP&#160;requests,&#160;and<br/>the&#160;server&#160;stalls&#160;its&#160;answer&#160;when&#160;it&#160;has&#160;nothing&#160;new&#160;to&#160;report.<br/>
As&#160;long&#160;as&#160;the&#160;client&#160;makes&#160;sure&#160;it&#160;constantly&#160;has&#160;a&#160;polling&#160;request&#160;open,&#160;it<br/>
will&#160;receive&#160;information&#160;from&#160;the&#160;server&#160;quickly&#160;after&#160;it&#160;becomes&#160;available.&#160;For<br/>example,&#160;if&#160;Fatma&#160;has&#160;our&#160;skill-sharing&#160;application&#160;open&#160;in&#160;her&#160;browser,&#160;that<br/>browser&#160;will&#160;have&#160;made&#160;a&#160;request&#160;for&#160;updates&#160;and&#160;will&#160;be&#160;waiting&#160;for&#160;a&#160;response<br/>to&#160;that&#160;request.&#160;When&#160;Iman&#160;submits&#160;a&#160;talk&#160;on&#160;Extreme&#160;Downhill&#160;Unicycling,<br/>the&#160;server&#160;will&#160;notice&#160;that&#160;Fatma&#160;is&#160;waiting&#160;for&#160;updates&#160;and&#160;send&#160;a&#160;response<br/>containing&#160;the&#160;new&#160;talk&#160;to&#160;her&#160;pending&#160;request.&#160;Fatma’s&#160;browser&#160;will&#160;receive<br/>the&#160;data&#160;and&#160;update&#160;the&#160;screen&#160;to&#160;show&#160;the&#160;talk.<br/>
To&#160;prevent&#160;connections&#160;from&#160;timing&#160;out&#160;(being&#160;aborted&#160;because&#160;of&#160;a&#160;lack&#160;of<br/>
activity),&#160;long&#160;polling&#160;techniques&#160;usually&#160;set&#160;a&#160;maximum&#160;time&#160;for&#160;each&#160;request,<br/>after&#160;which&#160;the&#160;server&#160;will&#160;respond&#160;anyway,&#160;even&#160;though&#160;it&#160;has&#160;nothing&#160;to<br/>report,&#160;after&#160;which&#160;the&#160;client&#160;will&#160;start&#160;a&#160;new&#160;request.&#160;Periodically&#160;restarting<br/>the&#160;request&#160;also&#160;makes&#160;the&#160;technique&#160;more&#160;robust,&#160;allowing&#160;clients&#160;to&#160;recover<br/>from&#160;temporary&#160;connection&#160;failures&#160;or&#160;server&#160;problems.<br/>
A&#160;busy&#160;server&#160;that&#160;is&#160;using&#160;long&#160;polling&#160;may&#160;have&#160;thousands&#160;of&#160;waiting<br/>
requests,&#160;and&#160;thus&#160;TCP&#160;connections,&#160;open.&#160;Node,&#160;which&#160;makes&#160;it&#160;easy&#160;to<br/>manage&#160;many&#160;connections&#160;without&#160;creating&#160;a&#160;separate&#160;thread&#160;of&#160;control&#160;for<br/>each&#160;one,&#160;is&#160;a&#160;good&#160;fit&#160;for&#160;such&#160;a&#160;system.<br/>
<b>HTTP&#160;interface</b><br/>
Before&#160;we&#160;start&#160;designing&#160;either&#160;the&#160;server&#160;or&#160;the&#160;client,&#160;let’s&#160;think&#160;about&#160;the<br/>point&#160;where&#160;they&#160;touch:&#160;the&#160;HTTP&#160;interface&#160;over&#160;which&#160;they&#160;communicate.<br/>
We&#160;will&#160;use&#160;JSON&#160;as&#160;the&#160;format&#160;of&#160;our&#160;request&#160;and&#160;response&#160;body.&#160;Like&#160;in<br/>
the&#160;file&#160;server&#160;from&#160;<a href="eloquent-javascripts.html#372">Chapter&#160;20,&#160;</a>we’ll&#160;try&#160;to&#160;make&#160;good&#160;use&#160;of&#160;HTTP&#160;methods<br/>and&#160;headers.&#160;The&#160;interface&#160;is&#160;centered&#160;around&#160;the&#160;/talks&#160;path.&#160;Paths&#160;that<br/>do&#160;not&#160;start&#160;with&#160;/talks&#160;will&#160;be&#160;used&#160;for&#160;serving&#160;static&#160;files—the&#160;HTML&#160;and<br/>JavaScript&#160;code&#160;for&#160;the&#160;client-side&#160;system.<br/>
A&#160;GET&#160;request&#160;to&#160;/talks&#160;returns&#160;a&#160;JSON&#160;document&#160;like&#160;this:<br/>
[{&#34;title&#34;:&#160;&#34;Unituning&#34;,<br/>
&#34;presenter&#34;:&#160;&#34;Jamal&#34;,<br/>&#34;summary&#34;:&#160;&#34;Modifying&#160;your&#160;cycle&#160;for&#160;extra&#160;style&#34;,<br/>&#34;comments&#34;:&#160;[]}]<br/>
371<br/>
<hr/>
<a name=384></a>Creating&#160;a&#160;new&#160;talk&#160;is&#160;done&#160;by&#160;making&#160;a&#160;PUT&#160;request&#160;to&#160;a&#160;URL&#160;like&#160;/talks/<br/>
Unituning,&#160;where&#160;the&#160;part&#160;after&#160;the&#160;second&#160;slash&#160;is&#160;the&#160;title&#160;of&#160;the&#160;talk.&#160;The&#160;PUT<br/>request’s&#160;body&#160;should&#160;contain&#160;a&#160;JSON&#160;object&#160;that&#160;has&#160;presenter&#160;and&#160;summary<br/>properties.<br/>
Since&#160;talk&#160;titles&#160;may&#160;contain&#160;spaces&#160;and&#160;other&#160;characters&#160;that&#160;may&#160;not&#160;appear<br/>
normally&#160;in&#160;a&#160;URL,&#160;title&#160;strings&#160;must&#160;be&#160;encoded&#160;with&#160;the&#160;encodeURIComponent<br/>function&#160;when&#160;building&#160;up&#160;such&#160;a&#160;URL.<br/>
console.log(&#34;/talks/&#34;&#160;+&#160;encodeURIComponent(&#34;How&#160;to&#160;Idle&#34;));<br/>//&#160;→&#160;/talks/How%20to%20Idle<br/>
A&#160;request&#160;to&#160;create&#160;a&#160;talk&#160;about&#160;idling&#160;might&#160;look&#160;something&#160;like&#160;this:<br/>
PUT&#160;/talks/How%20to%20Idle&#160;HTTP/1.1<br/>Content-Type:&#160;application/json<br/>Content-Length:&#160;92<br/>
{&#34;presenter&#34;:&#160;&#34;Maureen&#34;,<br/>
&#34;summary&#34;:&#160;&#34;Standing&#160;still&#160;on&#160;a&#160;unicycle&#34;}<br/>
Such&#160;URLs&#160;also&#160;support&#160;GET&#160;requests&#160;to&#160;retrieve&#160;the&#160;JSON&#160;representation&#160;of<br/>
a&#160;talk&#160;and&#160;DELETE&#160;requests&#160;to&#160;delete&#160;a&#160;talk.<br/>
Adding&#160;a&#160;comment&#160;to&#160;a&#160;talk&#160;is&#160;done&#160;with&#160;a&#160;POST&#160;request&#160;to&#160;a&#160;URL&#160;like&#160;/<br/>
talks/Unituning/comments,&#160;with&#160;a&#160;JSON&#160;body&#160;that&#160;has&#160;author&#160;and&#160;message<br/>properties.<br/>
POST&#160;/talks/Unituning/comments&#160;HTTP/1.1<br/>Content-Type:&#160;application/json<br/>Content-Length:&#160;72<br/>
{&#34;author&#34;:&#160;&#34;Iman&#34;,<br/>
&#34;message&#34;:&#160;&#34;Will&#160;you&#160;talk&#160;about&#160;raising&#160;a&#160;cycle?&#34;}<br/>
To&#160;support&#160;long&#160;polling,&#160;GET&#160;requests&#160;to&#160;/talks&#160;may&#160;include&#160;extra&#160;headers<br/>
that&#160;inform&#160;the&#160;server&#160;to&#160;delay&#160;the&#160;response&#160;if&#160;no&#160;new&#160;information&#160;is&#160;available.<br/>We’ll&#160;use&#160;a&#160;pair&#160;of&#160;headers&#160;normally&#160;intended&#160;to&#160;manage&#160;caching:&#160;ETag&#160;and<br/>If-None-Match.<br/>
Servers&#160;may&#160;include&#160;an&#160;ETag&#160;(“entity&#160;tag”)&#160;header&#160;in&#160;a&#160;response.&#160;Its&#160;value&#160;is<br/>
a&#160;string&#160;that&#160;identifies&#160;the&#160;current&#160;version&#160;of&#160;the&#160;resource.&#160;Clients,&#160;when&#160;they<br/>later&#160;request&#160;that&#160;resource&#160;again,&#160;may&#160;make&#160;a&#160;<i>conditional&#160;request&#160;</i>by&#160;including<br/>an&#160;If-None-Match&#160;header&#160;whose&#160;value&#160;holds&#160;that&#160;same&#160;string.&#160;If&#160;the&#160;resource<br/>
372<br/>
<hr/>
<a name=385></a>hasn’t&#160;changed,&#160;the&#160;server&#160;will&#160;respond&#160;with&#160;status&#160;code&#160;304,&#160;which&#160;means&#160;“not<br/>modified”,&#160;telling&#160;the&#160;client&#160;that&#160;its&#160;cached&#160;version&#160;is&#160;still&#160;current.&#160;When&#160;the<br/>tag&#160;does&#160;not&#160;match,&#160;the&#160;server&#160;responds&#160;as&#160;normal.<br/>
We&#160;need&#160;something&#160;like&#160;this,&#160;where&#160;the&#160;client&#160;can&#160;tell&#160;the&#160;server&#160;which&#160;version<br/>
of&#160;the&#160;list&#160;of&#160;talks&#160;it&#160;has,&#160;and&#160;the&#160;server&#160;responds&#160;only&#160;when&#160;that&#160;list&#160;has<br/>changed.&#160;But&#160;instead&#160;of&#160;immediately&#160;returning&#160;a&#160;304&#160;response,&#160;the&#160;server<br/>should&#160;stall&#160;the&#160;response&#160;and&#160;return&#160;only&#160;when&#160;something&#160;new&#160;is&#160;available&#160;or<br/>a&#160;given&#160;amount&#160;of&#160;time&#160;has&#160;elapsed.&#160;To&#160;distinguish&#160;long&#160;polling&#160;requests&#160;from<br/>normal&#160;conditional&#160;requests,&#160;we&#160;give&#160;them&#160;another&#160;header,&#160;Prefer:&#160;wait=90,<br/>which&#160;tells&#160;the&#160;server&#160;that&#160;the&#160;client&#160;is&#160;willing&#160;to&#160;wait&#160;up&#160;to&#160;90&#160;seconds&#160;for&#160;the<br/>response.<br/>
The&#160;server&#160;will&#160;keep&#160;a&#160;version&#160;number&#160;that&#160;it&#160;updates&#160;every&#160;time&#160;the&#160;talks<br/>
change&#160;and&#160;will&#160;use&#160;that&#160;as&#160;the&#160;ETag&#160;value.&#160;Clients&#160;can&#160;make&#160;requests&#160;like&#160;this<br/>to&#160;be&#160;notified&#160;when&#160;the&#160;talks&#160;change:<br/>
GET&#160;/talks&#160;HTTP/1.1<br/>If-None-Match:&#160;&#34;4&#34;<br/>Prefer:&#160;wait=90<br/>
(time&#160;passes)<br/>
HTTP/1.1&#160;200&#160;OK<br/>Content-Type:&#160;application/json<br/>ETag:&#160;&#34;5&#34;<br/>Content-Length:&#160;295<br/>
[....]<br/>
The&#160;protocol&#160;described&#160;here&#160;does&#160;not&#160;do&#160;any&#160;access&#160;control.&#160;Everybody&#160;can<br/>
comment,&#160;modify&#160;talks,&#160;and&#160;even&#160;delete&#160;them.&#160;(Since&#160;the&#160;Internet&#160;is&#160;full&#160;of<br/>hooligans,&#160;putting&#160;such&#160;a&#160;system&#160;online&#160;without&#160;further&#160;protection&#160;probably<br/>wouldn’t&#160;end&#160;well.)<br/>
<b>The&#160;server</b><br/>
Let’s&#160;start&#160;by&#160;building&#160;the&#160;server-side&#160;part&#160;of&#160;the&#160;program.&#160;The&#160;code&#160;in&#160;this<br/>section&#160;runs&#160;on&#160;Node.js.<br/>
373<br/>
<hr/>
<a name=386></a><b>Routing</b><br/>
Our&#160;server&#160;will&#160;use&#160;createServer&#160;to&#160;start&#160;an&#160;HTTP&#160;server.&#160;In&#160;the&#160;function<br/>that&#160;handles&#160;a&#160;new&#160;request,&#160;we&#160;must&#160;distinguish&#160;between&#160;the&#160;various&#160;kinds&#160;of<br/>requests&#160;(as&#160;determined&#160;by&#160;the&#160;method&#160;and&#160;the&#160;path)&#160;that&#160;we&#160;support.&#160;This<br/>can&#160;be&#160;done&#160;with&#160;a&#160;long&#160;chain&#160;of&#160;if&#160;statements,&#160;but&#160;there&#160;is&#160;a&#160;nicer&#160;way.<br/>
A&#160;<i>router&#160;</i>is&#160;a&#160;component&#160;that&#160;helps&#160;dispatch&#160;a&#160;request&#160;to&#160;the&#160;function&#160;that<br/>
can&#160;handle&#160;it.&#160;You&#160;can&#160;tell&#160;the&#160;router,&#160;for&#160;example,&#160;that&#160;PUT&#160;requests&#160;with<br/>a&#160;path&#160;that&#160;matches&#160;the&#160;regular&#160;expression&#160;/^\/talks\/([^\/]+)$/&#160;(/talks/<br/>followed&#160;by&#160;a&#160;talk&#160;title)&#160;can&#160;be&#160;handled&#160;by&#160;a&#160;given&#160;function.&#160;In&#160;addition,&#160;it<br/>can&#160;help&#160;extract&#160;the&#160;meaningful&#160;parts&#160;of&#160;the&#160;path&#160;(in&#160;this&#160;case&#160;the&#160;talk&#160;title),<br/>wrapped&#160;in&#160;parentheses&#160;in&#160;the&#160;regular&#160;expression,&#160;and&#160;pass&#160;them&#160;to&#160;the&#160;handler<br/>function.<br/>
There&#160;are&#160;a&#160;number&#160;of&#160;good&#160;router&#160;packages&#160;on&#160;NPM,&#160;but&#160;here&#160;we’ll&#160;write<br/>
one&#160;ourselves&#160;to&#160;illustrate&#160;the&#160;principle.<br/>
This&#160;is&#160;router.js,&#160;which&#160;we&#160;will&#160;later&#160;require&#160;from&#160;our&#160;server&#160;module:<br/>
const&#160;{parse}&#160;=&#160;require(&#34;url&#34;);<br/>
module.exports&#160;=&#160;class&#160;Router&#160;{<br/>
constructor()&#160;{<br/>
this.routes&#160;=&#160;[];<br/>
}<br/>add(method,&#160;url,&#160;handler)&#160;{<br/>
this.routes.push({method,&#160;url,&#160;handler});<br/>
}<br/>resolve(context,&#160;request)&#160;{<br/>
let&#160;path&#160;=&#160;parse(request.url).pathname;<br/>
for&#160;(let&#160;{method,&#160;url,&#160;handler}&#160;of&#160;this.routes)&#160;{<br/>
let&#160;match&#160;=&#160;url.exec(path);<br/>if&#160;(!match&#160;||&#160;request.method&#160;!=&#160;method)&#160;continue;<br/>let&#160;urlParts&#160;=&#160;match.slice(1).map(decodeURIComponent);<br/>return&#160;handler(context,&#160;...urlParts,&#160;request);<br/>
}<br/>return&#160;null;<br/>
}<br/>
};<br/>
The&#160;module&#160;exports&#160;the&#160;Router&#160;class.&#160;A&#160;router&#160;object&#160;allows&#160;new&#160;handlers<br/>
to&#160;be&#160;registered&#160;with&#160;the&#160;add&#160;method&#160;and&#160;can&#160;resolve&#160;requests&#160;with&#160;its&#160;resolve<br/>method.<br/>
The&#160;latter&#160;will&#160;return&#160;a&#160;response&#160;when&#160;a&#160;handler&#160;was&#160;found,&#160;and&#160;null&#160;other-<br/>
374<br/>
<hr/>
<a name=387></a>wise.&#160;It&#160;tries&#160;the&#160;routes&#160;one&#160;at&#160;a&#160;time&#160;(in&#160;the&#160;order&#160;in&#160;which&#160;they&#160;were&#160;defined)<br/>until&#160;a&#160;matching&#160;one&#160;is&#160;found.<br/>
The&#160;handler&#160;functions&#160;are&#160;called&#160;with&#160;the&#160;context&#160;value&#160;(which&#160;will&#160;be&#160;the<br/>
server&#160;instance&#160;in&#160;our&#160;case),&#160;match&#160;strings&#160;for&#160;any&#160;groups&#160;they&#160;defined&#160;in&#160;their<br/>regular&#160;expression,&#160;and&#160;the&#160;request&#160;object.&#160;The&#160;strings&#160;have&#160;to&#160;be&#160;URL-decoded<br/>since&#160;the&#160;raw&#160;URL&#160;may&#160;contain&#160;%20-style&#160;codes.<br/>
<b>Serving&#160;files</b><br/>
When&#160;a&#160;request&#160;matches&#160;none&#160;of&#160;the&#160;request&#160;types&#160;defined&#160;in&#160;our&#160;router,&#160;the<br/>server&#160;must&#160;interpret&#160;it&#160;as&#160;a&#160;request&#160;for&#160;a&#160;file&#160;in&#160;the&#160;public&#160;directory.&#160;It&#160;would<br/>be&#160;possible&#160;to&#160;use&#160;the&#160;file&#160;server&#160;defined&#160;in&#160;<a href="eloquent-javascripts.html#372">Chapter&#160;20&#160;</a>to&#160;serve&#160;such&#160;files,&#160;but<br/>we&#160;neither&#160;need&#160;nor&#160;want&#160;to&#160;support&#160;PUT&#160;and&#160;DELETE&#160;requests&#160;on&#160;files,&#160;and&#160;we<br/>would&#160;like&#160;to&#160;have&#160;advanced&#160;features&#160;such&#160;as&#160;support&#160;for&#160;caching.&#160;So&#160;let’s&#160;use<br/>a&#160;solid,&#160;well-tested&#160;static&#160;file&#160;server&#160;from&#160;NPM&#160;instead.<br/>
I&#160;opted&#160;for&#160;ecstatic.&#160;This&#160;isn’t&#160;the&#160;only&#160;such&#160;server&#160;on&#160;NPM,&#160;but&#160;it&#160;works<br/>
well&#160;and&#160;fits&#160;our&#160;purposes.&#160;The&#160;ecstatic&#160;package&#160;exports&#160;a&#160;function&#160;that&#160;can<br/>be&#160;called&#160;with&#160;a&#160;configuration&#160;object&#160;to&#160;produce&#160;a&#160;request&#160;handler&#160;function.<br/>We&#160;use&#160;the&#160;root&#160;option&#160;to&#160;tell&#160;the&#160;server&#160;where&#160;it&#160;should&#160;look&#160;for&#160;files.&#160;The<br/>handler&#160;function&#160;accepts&#160;request&#160;and&#160;response&#160;parameters&#160;and&#160;can&#160;be&#160;passed<br/>directly&#160;to&#160;createServer&#160;to&#160;create&#160;a&#160;server&#160;that&#160;serves&#160;<i>only&#160;</i>files.&#160;We&#160;want&#160;to<br/>first&#160;check&#160;for&#160;requests&#160;that&#160;we&#160;should&#160;handle&#160;specially,&#160;though,&#160;so&#160;we&#160;wrap&#160;it<br/>in&#160;another&#160;function.<br/>
const&#160;{createServer}&#160;=&#160;require(&#34;http&#34;);<br/>const&#160;Router&#160;=&#160;require(&#34;./router&#34;);<br/>const&#160;ecstatic&#160;=&#160;require(&#34;ecstatic&#34;);<br/>
const&#160;router&#160;=&#160;new&#160;Router();<br/>const&#160;defaultHeaders&#160;=&#160;{&#34;Content-Type&#34;:&#160;&#34;text/plain&#34;};<br/>
class&#160;SkillShareServer&#160;{<br/>
constructor(talks)&#160;{<br/>
this.talks&#160;=&#160;talks;<br/>this.version&#160;=&#160;0;<br/>this.waiting&#160;=&#160;[];<br/>
let&#160;fileServer&#160;=&#160;ecstatic({root:&#160;&#34;./public&#34;});<br/>this.server&#160;=&#160;createServer((request,&#160;response)&#160;=&gt;&#160;{<br/>
let&#160;resolved&#160;=&#160;router.resolve(this,&#160;request);<br/>if&#160;(resolved)&#160;{<br/>
resolved.catch(error&#160;=&gt;&#160;{<br/>
if&#160;(error.status&#160;!=&#160;null)&#160;return&#160;error;<br/>
375<br/>
<hr/>
<a name=388></a>return&#160;{body:&#160;String(error),&#160;status:&#160;500};<br/>
}).then(({body,<br/>
status&#160;=&#160;200,<br/>headers&#160;=&#160;defaultHeaders})&#160;=&gt;&#160;{<br/>
response.writeHead(status,&#160;headers);<br/>response.end(body);<br/>
});<br/>
}&#160;else&#160;{<br/>
fileServer(request,&#160;response);<br/>
}<br/>
});<br/>
}<br/>start(port)&#160;{<br/>
this.server.listen(port);<br/>
}<br/>stop()&#160;{<br/>
this.server.close();<br/>
}<br/>
}<br/>
This&#160;uses&#160;a&#160;similar&#160;convention&#160;as&#160;the&#160;file&#160;server&#160;from&#160;the&#160;<a href="eloquent-javascripts.html#362">previous&#160;chapter</a><br/>
for&#160;responses—handlers&#160;return&#160;promises&#160;that&#160;resolve&#160;to&#160;objects&#160;describing&#160;the<br/>response.&#160;It&#160;wraps&#160;the&#160;server&#160;in&#160;an&#160;object&#160;that&#160;also&#160;holds&#160;its&#160;state.<br/>
<b>Talks&#160;as&#160;resources</b><br/>
The&#160;talks&#160;that&#160;have&#160;been&#160;proposed&#160;are&#160;stored&#160;in&#160;the&#160;talks&#160;property&#160;of&#160;the<br/>server,&#160;an&#160;object&#160;whose&#160;property&#160;names&#160;are&#160;the&#160;talk&#160;titles.&#160;These&#160;will&#160;be<br/>exposed&#160;as&#160;HTTP&#160;resources&#160;under&#160;/talks/[title],&#160;so&#160;we&#160;need&#160;to&#160;add&#160;handlers<br/>to&#160;our&#160;router&#160;that&#160;implement&#160;the&#160;various&#160;methods&#160;that&#160;clients&#160;can&#160;use&#160;to&#160;work<br/>with&#160;them.<br/>
The&#160;handler&#160;for&#160;requests&#160;that&#160;GET&#160;a&#160;single&#160;talk&#160;must&#160;look&#160;up&#160;the&#160;talk&#160;and<br/>
respond&#160;either&#160;with&#160;the&#160;talk’s&#160;JSON&#160;data&#160;or&#160;with&#160;a&#160;404&#160;error&#160;response.<br/>
const&#160;talkPath&#160;=&#160;/^\/talks\/([^\/]+)$/;<br/>
router.add(&#34;GET&#34;,&#160;talkPath,&#160;async&#160;(server,&#160;title)&#160;=&gt;&#160;{<br/>
if&#160;(title&#160;in&#160;server.talks)&#160;{<br/>
return&#160;{body:&#160;JSON.stringify(server.talks[title]),<br/>
headers:&#160;{&#34;Content-Type&#34;:&#160;&#34;application/json&#34;}};<br/>
}&#160;else&#160;{<br/>
return&#160;{status:&#160;404,&#160;body:&#160;`No&#160;talk&#160;'${title}'&#160;found`};<br/>
}<br/>
376<br/>
<hr/>
<a name=389></a>});<br/>
Deleting&#160;a&#160;talk&#160;is&#160;done&#160;by&#160;removing&#160;it&#160;from&#160;the&#160;talks&#160;object.<br/>
router.add(&#34;DELETE&#34;,&#160;talkPath,&#160;async&#160;(server,&#160;title)&#160;=&gt;&#160;{<br/>
if&#160;(title&#160;in&#160;server.talks)&#160;{<br/>
delete&#160;server.talks[title];<br/>server.updated();<br/>
}<br/>return&#160;{status:&#160;204};<br/>
});<br/>
The&#160;updated&#160;method,&#160;which&#160;we&#160;will&#160;define&#160;<a href="eloquent-javascripts.html#392">later</a>,&#160;notifies&#160;waiting&#160;long&#160;polling<br/>
requests&#160;about&#160;the&#160;change.<br/>
To&#160;retrieve&#160;the&#160;content&#160;of&#160;a&#160;request&#160;body,&#160;we&#160;define&#160;a&#160;function&#160;called&#160;readStream<br/>
,&#160;which&#160;reads&#160;all&#160;content&#160;from&#160;a&#160;readable&#160;stream&#160;and&#160;returns&#160;a&#160;promise&#160;that<br/>resolves&#160;to&#160;a&#160;string.<br/>
function&#160;readStream(stream)&#160;{<br/>
return&#160;new&#160;Promise((resolve,&#160;reject)&#160;=&gt;&#160;{<br/>
let&#160;data&#160;=&#160;&#34;&#34;;<br/>stream.on(&#34;error&#34;,&#160;reject);<br/>stream.on(&#34;data&#34;,&#160;chunk&#160;=&gt;&#160;data&#160;+=&#160;chunk.toString());<br/>stream.on(&#34;end&#34;,&#160;()&#160;=&gt;&#160;resolve(data));<br/>
});<br/>
}<br/>
One&#160;handler&#160;that&#160;needs&#160;to&#160;read&#160;request&#160;bodies&#160;is&#160;the&#160;PUT&#160;handler,&#160;which<br/>
is&#160;used&#160;to&#160;create&#160;new&#160;talks.&#160;It&#160;has&#160;to&#160;check&#160;whether&#160;the&#160;data&#160;it&#160;was&#160;given<br/>has&#160;presenter&#160;and&#160;summary&#160;properties,&#160;which&#160;are&#160;strings.&#160;Any&#160;data&#160;coming<br/>from&#160;outside&#160;the&#160;system&#160;might&#160;be&#160;nonsense,&#160;and&#160;we&#160;don’t&#160;want&#160;to&#160;corrupt&#160;our<br/>internal&#160;data&#160;model&#160;or&#160;crash&#160;when&#160;bad&#160;requests&#160;come&#160;in.<br/>
If&#160;the&#160;data&#160;looks&#160;valid,&#160;the&#160;handler&#160;stores&#160;an&#160;object&#160;that&#160;represents&#160;the&#160;new<br/>
talk&#160;in&#160;the&#160;talks&#160;object,&#160;possibly&#160;overwriting&#160;an&#160;existing&#160;talk&#160;with&#160;this&#160;title,<br/>and&#160;again&#160;calls&#160;updated.<br/>
router.add(&#34;PUT&#34;,&#160;talkPath,<br/>
async&#160;(server,&#160;title,&#160;request)&#160;=&gt;&#160;{<br/>
let&#160;requestBody&#160;=&#160;await&#160;readStream(request);<br/>let&#160;talk;<br/>try&#160;{&#160;talk&#160;=&#160;JSON.parse(requestBody);&#160;}<br/>catch&#160;(_)&#160;{&#160;return&#160;{status:&#160;400,&#160;body:&#160;&#34;Invalid&#160;JSON&#34;};&#160;}<br/>
377<br/>
<hr/>
<a name=390></a>if&#160;(!talk&#160;||<br/>
typeof&#160;talk.presenter&#160;!=&#160;&#34;string&#34;&#160;||<br/>typeof&#160;talk.summary&#160;!=&#160;&#34;string&#34;)&#160;{<br/>
return&#160;{status:&#160;400,&#160;body:&#160;&#34;Bad&#160;talk&#160;data&#34;};<br/>
}<br/>server.talks[title]&#160;=&#160;{title,<br/>
presenter:&#160;talk.presenter,<br/>summary:&#160;talk.summary,<br/>comments:&#160;[]};<br/>
server.updated();<br/>return&#160;{status:&#160;204};<br/>
});<br/>
Adding&#160;a&#160;comment&#160;to&#160;a&#160;talk&#160;works&#160;similarly.&#160;We&#160;use&#160;readStream&#160;to&#160;get&#160;the<br/>
content&#160;of&#160;the&#160;request,&#160;validate&#160;the&#160;resulting&#160;data,&#160;and&#160;store&#160;it&#160;as&#160;a&#160;comment<br/>when&#160;it&#160;looks&#160;valid.<br/>
router.add(&#34;POST&#34;,&#160;/^\/talks\/([^\/]+)\/comments$/,<br/>
async&#160;(server,&#160;title,&#160;request)&#160;=&gt;&#160;{<br/>
let&#160;requestBody&#160;=&#160;await&#160;readStream(request);<br/>let&#160;comment;<br/>try&#160;{&#160;comment&#160;=&#160;JSON.parse(requestBody);&#160;}<br/>catch&#160;(_)&#160;{&#160;return&#160;{status:&#160;400,&#160;body:&#160;&#34;Invalid&#160;JSON&#34;};&#160;}<br/>
if&#160;(!comment&#160;||<br/>
typeof&#160;comment.author&#160;!=&#160;&#34;string&#34;&#160;||<br/>typeof&#160;comment.message&#160;!=&#160;&#34;string&#34;)&#160;{<br/>
return&#160;{status:&#160;400,&#160;body:&#160;&#34;Bad&#160;comment&#160;data&#34;};<br/>
}&#160;else&#160;if&#160;(title&#160;in&#160;server.talks)&#160;{<br/>
server.talks[title].comments.push(comment);<br/>server.updated();<br/>return&#160;{status:&#160;204};<br/>
}&#160;else&#160;{<br/>
return&#160;{status:&#160;404,&#160;body:&#160;`No&#160;talk&#160;'${title}'&#160;found`};<br/>
}<br/>
});<br/>
Trying&#160;to&#160;add&#160;a&#160;comment&#160;to&#160;a&#160;nonexistent&#160;talk&#160;returns&#160;a&#160;404&#160;error.<br/>
378<br/>
<hr/>
<a name=391></a><b>Long&#160;polling&#160;support</b><br/>
The&#160;most&#160;interesting&#160;aspect&#160;of&#160;the&#160;server&#160;is&#160;the&#160;part&#160;that&#160;handles&#160;long&#160;polling.<br/>When&#160;a&#160;GET&#160;request&#160;comes&#160;in&#160;for&#160;/talks,&#160;it&#160;may&#160;be&#160;either&#160;a&#160;regular&#160;request&#160;or<br/>a&#160;long&#160;polling&#160;request.<br/>
There&#160;will&#160;be&#160;multiple&#160;places&#160;in&#160;which&#160;we&#160;have&#160;to&#160;send&#160;an&#160;array&#160;of&#160;talks&#160;to<br/>
the&#160;client,&#160;so&#160;we&#160;first&#160;define&#160;a&#160;helper&#160;method&#160;that&#160;builds&#160;up&#160;such&#160;an&#160;array&#160;and<br/>includes&#160;an&#160;ETag&#160;header&#160;in&#160;the&#160;response.<br/>
SkillShareServer.prototype.talkResponse&#160;=&#160;function()&#160;{<br/>
let&#160;talks&#160;=&#160;[];<br/>for&#160;(let&#160;title&#160;of&#160;Object.keys(this.talks))&#160;{<br/>
talks.push(this.talks[title]);<br/>
}<br/>return&#160;{<br/>
body:&#160;JSON.stringify(talks),<br/>headers:&#160;{&#34;Content-Type&#34;:&#160;&#34;application/json&#34;,<br/>
&#34;ETag&#34;:&#160;`&#34;${this.version}&#34;`}<br/>
};<br/>
};<br/>
The&#160;handler&#160;itself&#160;needs&#160;to&#160;look&#160;at&#160;the&#160;request&#160;headers&#160;to&#160;see&#160;whether&#160;If-<br/>
None-Match&#160;and&#160;Prefer&#160;headers&#160;are&#160;present.&#160;Node&#160;stores&#160;headers,&#160;whose&#160;names<br/>are&#160;specified&#160;to&#160;be&#160;case&#160;insensitive,&#160;under&#160;their&#160;lowercase&#160;names.<br/>
router.add(&#34;GET&#34;,&#160;/^\/talks$/,&#160;async&#160;(server,&#160;request)&#160;=&gt;&#160;{<br/>
let&#160;tag&#160;=&#160;/&#34;(.*)&#34;/.exec(request.headers[&#34;if-none-match&#34;]);<br/>let&#160;wait&#160;=&#160;/\bwait=(\d+)/.exec(request.headers[&#34;prefer&#34;]);<br/>if&#160;(!tag&#160;||&#160;tag[1]&#160;!=&#160;server.version)&#160;{<br/>
return&#160;server.talkResponse();<br/>
}&#160;else&#160;if&#160;(!wait)&#160;{<br/>
return&#160;{status:&#160;304};<br/>
}&#160;else&#160;{<br/>
return&#160;server.waitForChanges(Number(wait[1]));<br/>
}<br/>
});<br/>
If&#160;no&#160;tag&#160;was&#160;given&#160;or&#160;a&#160;tag&#160;was&#160;given&#160;that&#160;doesn’t&#160;match&#160;the&#160;server’s&#160;current<br/>
version,&#160;the&#160;handler&#160;responds&#160;with&#160;the&#160;list&#160;of&#160;talks.&#160;If&#160;the&#160;request&#160;is&#160;conditional<br/>and&#160;the&#160;talks&#160;did&#160;not&#160;change,&#160;we&#160;consult&#160;the&#160;Prefer&#160;header&#160;to&#160;see&#160;whether&#160;we<br/>should&#160;delay&#160;the&#160;response&#160;or&#160;respond&#160;right&#160;away.<br/>
Callback&#160;functions&#160;for&#160;delayed&#160;requests&#160;are&#160;stored&#160;in&#160;the&#160;server’s&#160;waiting&#160;ar-<br/>
ray&#160;so&#160;that&#160;they&#160;can&#160;be&#160;notified&#160;when&#160;something&#160;happens.&#160;The&#160;waitForChanges<br/>
379<br/>
<hr/>
<a name=392></a>method&#160;also&#160;immediately&#160;sets&#160;a&#160;timer&#160;to&#160;respond&#160;with&#160;a&#160;304&#160;status&#160;when&#160;the<br/>request&#160;has&#160;waited&#160;long&#160;enough.<br/>
SkillShareServer.prototype.waitForChanges&#160;=&#160;function(time)&#160;{<br/>
return&#160;new&#160;Promise(resolve&#160;=&gt;&#160;{<br/>
this.waiting.push(resolve);<br/>setTimeout(()&#160;=&gt;&#160;{<br/>
if&#160;(!this.waiting.includes(resolve))&#160;return;<br/>this.waiting&#160;=&#160;this.waiting.filter(r&#160;=&gt;&#160;r&#160;!=&#160;resolve);<br/>resolve({status:&#160;304});<br/>
},&#160;time&#160;*&#160;1000);<br/>
});<br/>
};<br/>
Registering&#160;a&#160;change&#160;with&#160;updated&#160;increases&#160;the&#160;version&#160;property&#160;and&#160;wakes<br/>
up&#160;all&#160;waiting&#160;requests.<br/>
SkillShareServer.prototype.updated&#160;=&#160;function()&#160;{<br/>
this.version++;<br/>let&#160;response&#160;=&#160;this.talkResponse();<br/>this.waiting.forEach(resolve&#160;=&gt;&#160;resolve(response));<br/>this.waiting&#160;=&#160;[];<br/>
};<br/>
That&#160;concludes&#160;the&#160;server&#160;code.&#160;If&#160;we&#160;create&#160;an&#160;instance&#160;of&#160;SkillShareServer<br/>
and&#160;start&#160;it&#160;on&#160;port&#160;8000,&#160;the&#160;resulting&#160;HTTP&#160;server&#160;serves&#160;files&#160;from&#160;the&#160;public<br/>subdirectory&#160;alongside&#160;a&#160;talk-managing&#160;interface&#160;under&#160;the&#160;/talks&#160;URL.<br/>
new&#160;SkillShareServer(Object.create(null)).start(8000);<br/>
<b>The&#160;client</b><br/>
The&#160;client-side&#160;part&#160;of&#160;the&#160;skill-sharing&#160;website&#160;consists&#160;of&#160;three&#160;files:&#160;a&#160;tiny<br/>HTML&#160;page,&#160;a&#160;style&#160;sheet,&#160;and&#160;a&#160;JavaScript&#160;file.<br/>
<b>HTML</b><br/>
It&#160;is&#160;a&#160;widely&#160;used&#160;convention&#160;for&#160;web&#160;servers&#160;to&#160;try&#160;to&#160;serve&#160;a&#160;file&#160;named<br/>index.html&#160;when&#160;a&#160;request&#160;is&#160;made&#160;directly&#160;to&#160;a&#160;path&#160;that&#160;corresponds&#160;to&#160;a<br/>directory.&#160;The&#160;file&#160;server&#160;module&#160;we&#160;use,&#160;ecstatic,&#160;supports&#160;this&#160;convention.<br/>
380<br/>
<hr/>
<a name=393></a>When&#160;a&#160;request&#160;is&#160;made&#160;to&#160;the&#160;path&#160;/,&#160;the&#160;server&#160;looks&#160;for&#160;the&#160;file&#160;./public/<br/>index.html&#160;(./public&#160;being&#160;the&#160;root&#160;we&#160;gave&#160;it)&#160;and&#160;returns&#160;that&#160;file&#160;if&#160;found.<br/>
Thus,&#160;if&#160;we&#160;want&#160;a&#160;page&#160;to&#160;show&#160;up&#160;when&#160;a&#160;browser&#160;is&#160;pointed&#160;at&#160;our&#160;server,<br/>
we&#160;should&#160;put&#160;it&#160;in&#160;public/index.html.&#160;This&#160;is&#160;our&#160;index&#160;file:<br/>
&lt;!doctype&#160;html&gt;<br/>&lt;meta&#160;charset=&#34;utf-8&#34;&gt;<br/>&lt;title&gt;Skill&#160;Sharing&lt;/title&gt;<br/>&lt;link&#160;rel=&#34;stylesheet&#34;&#160;href=&#34;skillsharing.css&#34;&gt;<br/>
&lt;h1&gt;Skill&#160;Sharing&lt;/h1&gt;<br/>
&lt;script&#160;src=&#34;skillsharing_client.js&#34;&gt;&lt;/script&gt;<br/>
It&#160;defines&#160;the&#160;document&#160;title&#160;and&#160;includes&#160;a&#160;style&#160;sheet,&#160;which&#160;defines&#160;a&#160;few<br/>
styles&#160;to,&#160;among&#160;other&#160;things,&#160;make&#160;sure&#160;there&#160;is&#160;some&#160;space&#160;between&#160;talks.<br/>
At&#160;the&#160;bottom,&#160;it&#160;adds&#160;a&#160;heading&#160;at&#160;the&#160;top&#160;of&#160;the&#160;page&#160;and&#160;loads&#160;the&#160;script<br/>
that&#160;contains&#160;the&#160;client-side&#160;application.<br/>
<b>Actions</b><br/>
The&#160;application&#160;state&#160;consists&#160;of&#160;the&#160;list&#160;of&#160;talks&#160;and&#160;the&#160;name&#160;of&#160;the&#160;user,&#160;and<br/>we’ll&#160;store&#160;it&#160;in&#160;a&#160;{talks,&#160;user}&#160;object.&#160;We&#160;don’t&#160;allow&#160;the&#160;user&#160;interface&#160;to<br/>directly&#160;manipulate&#160;the&#160;state&#160;or&#160;send&#160;off&#160;HTTP&#160;requests.&#160;Rather,&#160;it&#160;may&#160;emit<br/><i>actions&#160;</i>that&#160;describe&#160;what&#160;the&#160;user&#160;is&#160;trying&#160;to&#160;do.<br/>
The&#160;handleAction&#160;function&#160;takes&#160;such&#160;an&#160;action&#160;and&#160;makes&#160;it&#160;happen.&#160;Be-<br/>
cause&#160;our&#160;state&#160;updates&#160;are&#160;so&#160;simple,&#160;state&#160;changes&#160;are&#160;handled&#160;in&#160;the&#160;same<br/>function.<br/>
function&#160;handleAction(state,&#160;action)&#160;{<br/>
if&#160;(action.type&#160;==&#160;&#34;setUser&#34;)&#160;{<br/>
localStorage.setItem(&#34;userName&#34;,&#160;action.user);<br/>return&#160;Object.assign({},&#160;state,&#160;{user:&#160;action.user});<br/>
}&#160;else&#160;if&#160;(action.type&#160;==&#160;&#34;setTalks&#34;)&#160;{<br/>
return&#160;Object.assign({},&#160;state,&#160;{talks:&#160;action.talks});<br/>
}&#160;else&#160;if&#160;(action.type&#160;==&#160;&#34;newTalk&#34;)&#160;{<br/>
fetchOK(talkURL(action.title),&#160;{<br/>
method:&#160;&#34;PUT&#34;,<br/>headers:&#160;{&#34;Content-Type&#34;:&#160;&#34;application/json&#34;},<br/>body:&#160;JSON.stringify({<br/>
presenter:&#160;state.user,<br/>summary:&#160;action.summary<br/>
})<br/>
381<br/>
<hr/>
<a name=394></a>}).catch(reportError);<br/>
}&#160;else&#160;if&#160;(action.type&#160;==&#160;&#34;deleteTalk&#34;)&#160;{<br/>
fetchOK(talkURL(action.talk),&#160;{method:&#160;&#34;DELETE&#34;})<br/>
.catch(reportError);<br/>
}&#160;else&#160;if&#160;(action.type&#160;==&#160;&#34;newComment&#34;)&#160;{<br/>
fetchOK(talkURL(action.talk)&#160;+&#160;&#34;/comments&#34;,&#160;{<br/>
method:&#160;&#34;POST&#34;,<br/>headers:&#160;{&#34;Content-Type&#34;:&#160;&#34;application/json&#34;},<br/>body:&#160;JSON.stringify({<br/>
author:&#160;state.user,<br/>message:&#160;action.message<br/>
})<br/>
}).catch(reportError);<br/>
}<br/>return&#160;state;<br/>
}<br/>
We’ll&#160;store&#160;the&#160;user’s&#160;name&#160;in&#160;localStorage&#160;so&#160;that&#160;it&#160;can&#160;be&#160;restored&#160;when<br/>
the&#160;page&#160;is&#160;loaded.<br/>
The&#160;actions&#160;that&#160;need&#160;to&#160;involve&#160;the&#160;server&#160;make&#160;network&#160;requests,&#160;using<br/>
fetch,&#160;to&#160;the&#160;HTTP&#160;interface&#160;described&#160;earlier.&#160;We&#160;use&#160;a&#160;wrapper&#160;function,<br/>fetchOK,&#160;which&#160;makes&#160;sure&#160;the&#160;returned&#160;promise&#160;is&#160;rejected&#160;when&#160;the&#160;server<br/>returns&#160;an&#160;error&#160;code.<br/>
function&#160;fetchOK(url,&#160;options)&#160;{<br/>
return&#160;fetch(url,&#160;options).then(response&#160;=&gt;&#160;{<br/>
if&#160;(response.status&#160;&lt;&#160;400)&#160;return&#160;response;<br/>else&#160;throw&#160;new&#160;Error(response.statusText);<br/>
});<br/>
}<br/>
This&#160;helper&#160;function&#160;is&#160;used&#160;to&#160;build&#160;up&#160;a&#160;URL&#160;for&#160;a&#160;talk&#160;with&#160;a&#160;given&#160;title.<br/>
function&#160;talkURL(title)&#160;{<br/>
return&#160;&#34;talks/&#34;&#160;+&#160;encodeURIComponent(title);<br/>
}<br/>
When&#160;the&#160;request&#160;fails,&#160;we&#160;don’t&#160;want&#160;to&#160;have&#160;our&#160;page&#160;just&#160;sit&#160;there,&#160;doing<br/>
nothing&#160;without&#160;explanation.&#160;So&#160;we&#160;define&#160;a&#160;function&#160;called&#160;reportError,&#160;which<br/>at&#160;least&#160;shows&#160;the&#160;user&#160;a&#160;dialog&#160;that&#160;tells&#160;them&#160;something&#160;went&#160;wrong.<br/>
function&#160;reportError(error)&#160;{<br/>
382<br/>
<hr/>
<a name=395></a>alert(String(error));<br/>
}<br/>
<b>Rendering&#160;components</b><br/>
We’ll&#160;use&#160;an&#160;approach&#160;similar&#160;to&#160;the&#160;one&#160;we&#160;saw&#160;in&#160;<a href="eloquent-javascripts.html#342">Chapter&#160;19,&#160;</a>splitting&#160;the<br/>application&#160;into&#160;components.&#160;But&#160;since&#160;some&#160;of&#160;the&#160;components&#160;either&#160;never<br/>need&#160;to&#160;update&#160;or&#160;are&#160;always&#160;fully&#160;redrawn&#160;when&#160;updated,&#160;we’ll&#160;define&#160;those<br/>not&#160;as&#160;classes&#160;but&#160;as&#160;functions&#160;that&#160;directly&#160;return&#160;a&#160;DOM&#160;node.&#160;For&#160;example,<br/>here&#160;is&#160;a&#160;component&#160;that&#160;shows&#160;the&#160;field&#160;where&#160;the&#160;user&#160;can&#160;enter&#160;their&#160;name:<br/>
function&#160;renderUserField(name,&#160;dispatch)&#160;{<br/>
return&#160;elt(&#34;label&#34;,&#160;{},&#160;&#34;Your&#160;name:&#160;&#34;,&#160;elt(&#34;input&#34;,&#160;{<br/>
type:&#160;&#34;text&#34;,<br/>value:&#160;name,<br/>onchange(event)&#160;{<br/>
dispatch({type:&#160;&#34;setUser&#34;,&#160;user:&#160;event.target.value});<br/>
}<br/>
}));<br/>
}<br/>
The&#160;elt&#160;function&#160;used&#160;to&#160;construct&#160;DOM&#160;elements&#160;is&#160;the&#160;one&#160;we&#160;used&#160;in<br/>
<a href="eloquent-javascripts.html#342">Chapter&#160;19.</a><br/>
A&#160;similar&#160;function&#160;is&#160;used&#160;to&#160;render&#160;talks,&#160;which&#160;include&#160;a&#160;list&#160;of&#160;comments<br/>
and&#160;a&#160;form&#160;for&#160;adding&#160;a&#160;new&#160;comment.<br/>
function&#160;renderTalk(talk,&#160;dispatch)&#160;{<br/>
return&#160;elt(<br/>
&#34;section&#34;,&#160;{className:&#160;&#34;talk&#34;},<br/>elt(&#34;h2&#34;,&#160;null,&#160;talk.title,&#160;&#34;&#160;&#34;,&#160;elt(&#34;button&#34;,&#160;{<br/>
type:&#160;&#34;button&#34;,<br/>onclick()&#160;{<br/>
dispatch({type:&#160;&#34;deleteTalk&#34;,&#160;talk:&#160;talk.title});<br/>
}<br/>
},&#160;&#34;Delete&#34;)),<br/>elt(&#34;div&#34;,&#160;null,&#160;&#34;by&#160;&#34;,<br/>
elt(&#34;strong&#34;,&#160;null,&#160;talk.presenter)),<br/>
elt(&#34;p&#34;,&#160;null,&#160;talk.summary),<br/>...talk.comments.map(renderComment),<br/>elt(&#34;form&#34;,&#160;{<br/>
onsubmit(event)&#160;{<br/>
event.preventDefault();<br/>
383<br/>
<hr/>
<a name=396></a>let&#160;form&#160;=&#160;event.target;<br/>dispatch({type:&#160;&#34;newComment&#34;,<br/>
talk:&#160;talk.title,<br/>message:&#160;form.elements.comment.value});<br/>
form.reset();<br/>
}<br/>
},&#160;elt(&#34;input&#34;,&#160;{type:&#160;&#34;text&#34;,&#160;name:&#160;&#34;comment&#34;}),&#160;&#34;&#160;&#34;,<br/>
elt(&#34;button&#34;,&#160;{type:&#160;&#34;submit&#34;},&#160;&#34;Add&#160;comment&#34;)));<br/>
}<br/>
The&#160;&#34;submit&#34;&#160;event&#160;handler&#160;calls&#160;form.reset&#160;to&#160;clear&#160;the&#160;form’s&#160;content&#160;after<br/>
creating&#160;a&#160;&#34;newComment&#34;&#160;action.<br/>
When&#160;creating&#160;moderately&#160;complex&#160;pieces&#160;of&#160;DOM,&#160;this&#160;style&#160;of&#160;program-<br/>
ming&#160;starts&#160;to&#160;look&#160;rather&#160;messy.&#160;There’s&#160;a&#160;widely&#160;used&#160;(non-standard)&#160;JavaScript<br/>extension&#160;called&#160;<i>JSX&#160;</i>that&#160;lets&#160;you&#160;write&#160;HTML&#160;directly&#160;in&#160;your&#160;scripts,&#160;which<br/>can&#160;make&#160;such&#160;code&#160;prettier&#160;(depending&#160;on&#160;what&#160;you&#160;consider&#160;pretty).&#160;Before<br/>you&#160;can&#160;actually&#160;run&#160;such&#160;code,&#160;you&#160;have&#160;to&#160;run&#160;a&#160;program&#160;on&#160;your&#160;script&#160;to<br/>convert&#160;the&#160;pseudo-HTML&#160;into&#160;JavaScript&#160;function&#160;calls&#160;much&#160;like&#160;the&#160;ones&#160;we<br/>use&#160;here.<br/>
Comments&#160;are&#160;simpler&#160;to&#160;render.<br/>
function&#160;renderComment(comment)&#160;{<br/>
return&#160;elt(&#34;p&#34;,&#160;{className:&#160;&#34;comment&#34;},<br/>
elt(&#34;strong&#34;,&#160;null,&#160;comment.author),<br/>&#34;:&#160;&#34;,&#160;comment.message);<br/>
}<br/>
Finally,&#160;the&#160;form&#160;that&#160;the&#160;user&#160;can&#160;use&#160;to&#160;create&#160;a&#160;new&#160;talk&#160;is&#160;rendered&#160;like<br/>
this:<br/>
function&#160;renderTalkForm(dispatch)&#160;{<br/>
let&#160;title&#160;=&#160;elt(&#34;input&#34;,&#160;{type:&#160;&#34;text&#34;});<br/>let&#160;summary&#160;=&#160;elt(&#34;input&#34;,&#160;{type:&#160;&#34;text&#34;});<br/>return&#160;elt(&#34;form&#34;,&#160;{<br/>
onsubmit(event)&#160;{<br/>
event.preventDefault();<br/>dispatch({type:&#160;&#34;newTalk&#34;,<br/>
title:&#160;title.value,<br/>summary:&#160;summary.value});<br/>
event.target.reset();<br/>
}<br/>
},&#160;elt(&#34;h3&#34;,&#160;null,&#160;&#34;Submit&#160;a&#160;Talk&#34;),<br/>
elt(&#34;label&#34;,&#160;null,&#160;&#34;Title:&#160;&#34;,&#160;title),<br/>
384<br/>
<hr/>
<a name=397></a>elt(&#34;label&#34;,&#160;null,&#160;&#34;Summary:&#160;&#34;,&#160;summary),<br/>elt(&#34;button&#34;,&#160;{type:&#160;&#34;submit&#34;},&#160;&#34;Submit&#34;));<br/>
}<br/>
<b>Polling</b><br/>
To&#160;start&#160;the&#160;app&#160;we&#160;need&#160;the&#160;current&#160;list&#160;of&#160;talks.&#160;Since&#160;the&#160;initial&#160;load&#160;is&#160;closely<br/>related&#160;to&#160;the&#160;long&#160;polling&#160;process—the&#160;ETag&#160;from&#160;the&#160;load&#160;must&#160;be&#160;used&#160;when<br/>polling—we’ll&#160;write&#160;a&#160;function&#160;that&#160;keeps&#160;polling&#160;the&#160;server&#160;for&#160;/talks&#160;and&#160;calls<br/>a&#160;callback&#160;function&#160;when&#160;a&#160;new&#160;set&#160;of&#160;talks&#160;is&#160;available.<br/>
async&#160;function&#160;pollTalks(update)&#160;{<br/>
let&#160;tag&#160;=&#160;undefined;<br/>for&#160;(;;)&#160;{<br/>
let&#160;response;<br/>try&#160;{<br/>
response&#160;=&#160;await&#160;fetchOK(&#34;/talks&#34;,&#160;{<br/>
headers:&#160;tag&#160;&amp;&amp;&#160;{&#34;If-None-Match&#34;:&#160;tag,<br/>
&#34;Prefer&#34;:&#160;&#34;wait=90&#34;}<br/>
});<br/>
}&#160;catch&#160;(e)&#160;{<br/>
console.log(&#34;Request&#160;failed:&#160;&#34;&#160;+&#160;e);<br/>await&#160;new&#160;Promise(resolve&#160;=&gt;&#160;setTimeout(resolve,&#160;500));<br/>continue;<br/>
}<br/>if&#160;(response.status&#160;==&#160;304)&#160;continue;<br/>tag&#160;=&#160;response.headers.get(&#34;ETag&#34;);<br/>update(await&#160;response.json());<br/>
}<br/>
}<br/>
This&#160;is&#160;an&#160;async&#160;function&#160;so&#160;that&#160;looping&#160;and&#160;waiting&#160;for&#160;the&#160;request&#160;is&#160;easier.<br/>
It&#160;runs&#160;an&#160;infinite&#160;loop&#160;that,&#160;on&#160;each&#160;iteration,&#160;retrieves&#160;the&#160;list&#160;of&#160;talks—either<br/>normally&#160;or,&#160;if&#160;this&#160;isn’t&#160;the&#160;first&#160;request,&#160;with&#160;the&#160;headers&#160;included&#160;that&#160;make<br/>it&#160;a&#160;long&#160;polling&#160;request.<br/>
When&#160;a&#160;request&#160;fails,&#160;the&#160;function&#160;waits&#160;a&#160;moment&#160;and&#160;then&#160;tries&#160;again.&#160;This<br/>
way,&#160;if&#160;your&#160;network&#160;connection&#160;goes&#160;away&#160;for&#160;a&#160;while&#160;and&#160;then&#160;comes&#160;back,<br/>the&#160;application&#160;can&#160;recover&#160;and&#160;continue&#160;updating.&#160;The&#160;promise&#160;resolved&#160;via<br/>setTimeout&#160;is&#160;a&#160;way&#160;to&#160;force&#160;the&#160;async&#160;function&#160;to&#160;wait.<br/>
When&#160;the&#160;server&#160;gives&#160;back&#160;a&#160;304&#160;response,&#160;that&#160;means&#160;a&#160;long&#160;polling&#160;request<br/>
timed&#160;out,&#160;so&#160;the&#160;function&#160;should&#160;just&#160;immediately&#160;start&#160;the&#160;next&#160;request.&#160;If<br/>
385<br/>
<hr/>
<a name=398></a>the&#160;response&#160;is&#160;a&#160;normal&#160;200&#160;response,&#160;its&#160;body&#160;is&#160;read&#160;as&#160;JSON&#160;and&#160;passed&#160;to<br/>the&#160;callback,&#160;and&#160;its&#160;ETag&#160;header&#160;value&#160;is&#160;stored&#160;for&#160;the&#160;next&#160;iteration.<br/>
<b>The&#160;application</b><br/>
The&#160;following&#160;component&#160;ties&#160;the&#160;whole&#160;user&#160;interface&#160;together:<br/>
class&#160;SkillShareApp&#160;{<br/>
constructor(state,&#160;dispatch)&#160;{<br/>
this.dispatch&#160;=&#160;dispatch;<br/>this.talkDOM&#160;=&#160;elt(&#34;div&#34;,&#160;{className:&#160;&#34;talks&#34;});<br/>this.dom&#160;=&#160;elt(&#34;div&#34;,&#160;null,<br/>
renderUserField(state.user,&#160;dispatch),<br/>this.talkDOM,<br/>renderTalkForm(dispatch));<br/>
this.syncState(state);<br/>
}<br/>
syncState(state)&#160;{<br/>
if&#160;(state.talks&#160;!=&#160;this.talks)&#160;{<br/>
this.talkDOM.textContent&#160;=&#160;&#34;&#34;;<br/>for&#160;(let&#160;talk&#160;of&#160;state.talks)&#160;{<br/>
this.talkDOM.appendChild(<br/>
renderTalk(talk,&#160;this.dispatch));<br/>
}<br/>this.talks&#160;=&#160;state.talks;<br/>
}<br/>
}<br/>
}<br/>
When&#160;the&#160;talks&#160;change,&#160;this&#160;component&#160;redraws&#160;all&#160;of&#160;them.&#160;This&#160;is&#160;simple<br/>
but&#160;also&#160;wasteful.&#160;We’ll&#160;get&#160;back&#160;to&#160;that&#160;in&#160;the&#160;exercises.<br/>
We&#160;can&#160;start&#160;the&#160;application&#160;like&#160;this:<br/>
function&#160;runApp()&#160;{<br/>
let&#160;user&#160;=&#160;localStorage.getItem(&#34;userName&#34;)&#160;||&#160;&#34;Anon&#34;;<br/>let&#160;state,&#160;app;<br/>function&#160;dispatch(action)&#160;{<br/>
state&#160;=&#160;handleAction(state,&#160;action);<br/>app.syncState(state);<br/>
}<br/>
pollTalks(talks&#160;=&gt;&#160;{<br/>
if&#160;(!app)&#160;{<br/>
state&#160;=&#160;{user,&#160;talks};<br/>
386<br/>
<hr/>
<a name=399></a>app&#160;=&#160;new&#160;SkillShareApp(state,&#160;dispatch);<br/>document.body.appendChild(app.dom);<br/>
}&#160;else&#160;{<br/>
dispatch({type:&#160;&#34;setTalks&#34;,&#160;talks});<br/>
}<br/>
}).catch(reportError);<br/>
}<br/>
runApp();<br/>
If&#160;you&#160;run&#160;the&#160;server&#160;and&#160;open&#160;two&#160;browser&#160;windows&#160;for&#160;<a href="http://localhost:8000/"><i>http://localhost:8000</i></a><br/>
next&#160;to&#160;each&#160;other,&#160;you&#160;can&#160;see&#160;that&#160;the&#160;actions&#160;you&#160;perform&#160;in&#160;one&#160;window<br/>are&#160;immediately&#160;visible&#160;in&#160;the&#160;other.<br/>
<b>Exercises</b><br/>
The&#160;following&#160;exercises&#160;will&#160;involve&#160;modifying&#160;the&#160;system&#160;defined&#160;in&#160;this&#160;chap-<br/>ter.&#160;To&#160;work&#160;on&#160;them,&#160;make&#160;sure&#160;you&#160;download&#160;the&#160;code&#160;first&#160;<a href="https://eloquentjavascript.net/code/skillsharing.zip">(<i>https://eloquentjavascript.net/<br/>code/skillsharing.zip</i>),&#160;</a>have&#160;Node&#160;installed&#160;<a href="https://nodejs.org"><i>https://nodejs.org</i></a>,&#160;and&#160;have&#160;in-<br/>stalled&#160;the&#160;project’s&#160;dependency&#160;with&#160;npm&#160;install.<br/>
<b>Disk&#160;persistence</b><br/>
The&#160;skill-sharing&#160;server&#160;keeps&#160;its&#160;data&#160;purely&#160;in&#160;memory.&#160;This&#160;means&#160;that&#160;when<br/>it&#160;crashes&#160;or&#160;is&#160;restarted&#160;for&#160;any&#160;reason,&#160;all&#160;talks&#160;and&#160;comments&#160;are&#160;lost.<br/>
Extend&#160;the&#160;server&#160;so&#160;that&#160;it&#160;stores&#160;the&#160;talk&#160;data&#160;to&#160;disk&#160;and&#160;automatically<br/>
reloads&#160;the&#160;data&#160;when&#160;it&#160;is&#160;restarted.&#160;Do&#160;not&#160;worry&#160;about&#160;efficiency—do&#160;the<br/>simplest&#160;thing&#160;that&#160;works.<br/>
<b>Comment&#160;field&#160;resets</b><br/>
The&#160;wholesale&#160;redrawing&#160;of&#160;talks&#160;works&#160;pretty&#160;well&#160;because&#160;you&#160;usually&#160;can’t<br/>tell&#160;the&#160;difference&#160;between&#160;a&#160;DOM&#160;node&#160;and&#160;its&#160;identical&#160;replacement.&#160;But<br/>there&#160;are&#160;exceptions.&#160;If&#160;you&#160;start&#160;typing&#160;something&#160;in&#160;the&#160;comment&#160;field&#160;for&#160;a<br/>talk&#160;in&#160;one&#160;browser&#160;window&#160;and&#160;then,&#160;in&#160;another,&#160;add&#160;a&#160;comment&#160;to&#160;that&#160;talk,<br/>the&#160;field&#160;in&#160;the&#160;first&#160;window&#160;will&#160;be&#160;redrawn,&#160;removing&#160;both&#160;its&#160;content&#160;and&#160;its<br/>focus.<br/>
In&#160;a&#160;heated&#160;discussion,&#160;where&#160;multiple&#160;people&#160;are&#160;adding&#160;comments&#160;at&#160;the<br/>
same&#160;time,&#160;this&#160;would&#160;be&#160;annoying.&#160;Can&#160;you&#160;come&#160;up&#160;with&#160;a&#160;way&#160;to&#160;solve&#160;it?<br/>
387<br/>
<hr/>
<a name=400></a><b>Exercise&#160;Hints</b><br/>
The&#160;hints&#160;below&#160;might&#160;help&#160;when&#160;you&#160;are&#160;stuck&#160;with&#160;one&#160;of&#160;the&#160;exercises&#160;in<br/>this&#160;book.&#160;They&#160;don’t&#160;give&#160;away&#160;the&#160;entire&#160;solution,&#160;but&#160;rather&#160;try&#160;to&#160;help&#160;you<br/>find&#160;it&#160;yourself.<br/>
<b>Program&#160;Structure</b><br/>
<b>Looping&#160;a&#160;triangle</b><br/>
You&#160;can&#160;start&#160;with&#160;a&#160;program&#160;that&#160;prints&#160;out&#160;the&#160;numbers&#160;1&#160;to&#160;7,&#160;which&#160;you<br/>can&#160;derive&#160;by&#160;making&#160;a&#160;few&#160;modifications&#160;to&#160;the&#160;<a href="eloquent-javascripts.html#41">even&#160;number&#160;printing&#160;example<br/></a>given&#160;earlier&#160;in&#160;the&#160;chapter,&#160;where&#160;the&#160;for&#160;loop&#160;was&#160;introduced.<br/>
Now&#160;consider&#160;the&#160;equivalence&#160;between&#160;numbers&#160;and&#160;strings&#160;of&#160;hash&#160;charac-<br/>
ters.&#160;You&#160;can&#160;go&#160;from&#160;1&#160;to&#160;2&#160;by&#160;adding&#160;1&#160;(+=&#160;1).&#160;You&#160;can&#160;go&#160;from&#160;&#34;#&#34;&#160;to<br/>&#34;##&#34;&#160;by&#160;adding&#160;a&#160;character&#160;(+=&#160;&#34;#&#34;).&#160;Thus,&#160;your&#160;solution&#160;can&#160;closely&#160;follow<br/>the&#160;number-printing&#160;program.<br/>
<b>FizzBuzz</b><br/>
Going&#160;over&#160;the&#160;numbers&#160;is&#160;clearly&#160;a&#160;looping&#160;job,&#160;and&#160;selecting&#160;what&#160;to&#160;print&#160;is<br/>a&#160;matter&#160;of&#160;conditional&#160;execution.&#160;Remember&#160;the&#160;trick&#160;of&#160;using&#160;the&#160;remainder<br/>(%)&#160;operator&#160;for&#160;checking&#160;whether&#160;a&#160;number&#160;is&#160;divisible&#160;by&#160;another&#160;number&#160;(has<br/>a&#160;remainder&#160;of&#160;zero).<br/>
In&#160;the&#160;first&#160;version,&#160;there&#160;are&#160;three&#160;possible&#160;outcomes&#160;for&#160;every&#160;number,&#160;so<br/>
you’ll&#160;have&#160;to&#160;create&#160;an&#160;if/else&#160;if/else&#160;chain.<br/>
The&#160;second&#160;version&#160;of&#160;the&#160;program&#160;has&#160;a&#160;straightforward&#160;solution&#160;and&#160;a&#160;clever<br/>
one.&#160;The&#160;simple&#160;solution&#160;is&#160;to&#160;add&#160;another&#160;conditional&#160;“branch”&#160;to&#160;precisely<br/>test&#160;the&#160;given&#160;condition.&#160;For&#160;the&#160;clever&#160;solution,&#160;build&#160;up&#160;a&#160;string&#160;containing<br/>the&#160;word&#160;or&#160;words&#160;to&#160;output&#160;and&#160;print&#160;either&#160;this&#160;word&#160;or&#160;the&#160;number&#160;if&#160;there<br/>is&#160;no&#160;word,&#160;potentially&#160;by&#160;making&#160;good&#160;use&#160;of&#160;the&#160;||&#160;operator.<br/>
388<br/>
<hr/>
<a name=401></a><b>Chessboard</b><br/>
You&#160;can&#160;build&#160;the&#160;string&#160;by&#160;starting&#160;with&#160;an&#160;empty&#160;one&#160;(&#34;&#34;)&#160;and&#160;repeatedly<br/>adding&#160;characters.&#160;A&#160;newline&#160;character&#160;is&#160;written&#160;&#34;\n&#34;.<br/>
To&#160;work&#160;with&#160;two&#160;dimensions,&#160;you&#160;will&#160;need&#160;a&#160;loop&#160;inside&#160;of&#160;a&#160;loop.&#160;Put<br/>
braces&#160;around&#160;the&#160;bodies&#160;of&#160;both&#160;loops&#160;to&#160;make&#160;it&#160;easy&#160;to&#160;see&#160;where&#160;they&#160;start<br/>and&#160;end.&#160;Try&#160;to&#160;properly&#160;indent&#160;these&#160;bodies.&#160;The&#160;order&#160;of&#160;the&#160;loops&#160;must<br/>follow&#160;the&#160;order&#160;in&#160;which&#160;we&#160;build&#160;up&#160;the&#160;string&#160;(line&#160;by&#160;line,&#160;left&#160;to&#160;right,&#160;top<br/>to&#160;bottom).&#160;So&#160;the&#160;outer&#160;loop&#160;handles&#160;the&#160;lines,&#160;and&#160;the&#160;inner&#160;loop&#160;handles&#160;the<br/>characters&#160;on&#160;a&#160;line.<br/>
You’ll&#160;need&#160;two&#160;bindings&#160;to&#160;track&#160;your&#160;progress.&#160;To&#160;know&#160;whether&#160;to&#160;put&#160;a<br/>
space&#160;or&#160;a&#160;hash&#160;sign&#160;at&#160;a&#160;given&#160;position,&#160;you&#160;could&#160;test&#160;whether&#160;the&#160;sum&#160;of&#160;the<br/>two&#160;counters&#160;is&#160;even&#160;(%&#160;2).<br/>
Terminating&#160;a&#160;line&#160;by&#160;adding&#160;a&#160;newline&#160;character&#160;must&#160;happen&#160;after&#160;the&#160;line<br/>
has&#160;been&#160;built&#160;up,&#160;so&#160;do&#160;this&#160;after&#160;the&#160;inner&#160;loop&#160;but&#160;inside&#160;the&#160;outer&#160;loop.<br/>
<b>Functions</b><br/>
<b>Minimum</b><br/>
If&#160;you&#160;have&#160;trouble&#160;putting&#160;braces&#160;and&#160;parentheses&#160;in&#160;the&#160;right&#160;place&#160;to&#160;get&#160;a<br/>valid&#160;function&#160;definition,&#160;start&#160;by&#160;copying&#160;one&#160;of&#160;the&#160;examples&#160;in&#160;this&#160;chapter<br/>and&#160;modifying&#160;it.<br/>
A&#160;function&#160;may&#160;contain&#160;multiple&#160;return&#160;statements.<br/>
<b>Recursion</b><br/>
Your&#160;function&#160;will&#160;likely&#160;look&#160;somewhat&#160;similar&#160;to&#160;the&#160;inner&#160;find&#160;function&#160;in&#160;the<br/>recursive&#160;findSolution&#160;<a href="eloquent-javascripts.html#61">example&#160;</a>in&#160;this&#160;chapter,&#160;with&#160;an&#160;if/else&#160;if/else&#160;chain<br/>that&#160;tests&#160;which&#160;of&#160;the&#160;three&#160;cases&#160;applies.&#160;The&#160;final&#160;else,&#160;corresponding&#160;to<br/>the&#160;third&#160;case,&#160;makes&#160;the&#160;recursive&#160;call.&#160;Each&#160;of&#160;the&#160;branches&#160;should&#160;contain<br/>a&#160;return&#160;statement&#160;or&#160;in&#160;some&#160;other&#160;way&#160;arrange&#160;for&#160;a&#160;specific&#160;value&#160;to&#160;be<br/>returned.<br/>
When&#160;given&#160;a&#160;negative&#160;number,&#160;the&#160;function&#160;will&#160;recurse&#160;again&#160;and&#160;again,<br/>
passing&#160;itself&#160;an&#160;ever&#160;more&#160;negative&#160;number,&#160;thus&#160;getting&#160;further&#160;and&#160;further<br/>away&#160;from&#160;returning&#160;a&#160;result.&#160;It&#160;will&#160;eventually&#160;run&#160;out&#160;of&#160;stack&#160;space&#160;and<br/>abort.<br/>
389<br/>
<hr/>
<a name=402></a><b>Bean&#160;counting</b><br/>
Your&#160;function&#160;will&#160;need&#160;a&#160;loop&#160;that&#160;looks&#160;at&#160;every&#160;character&#160;in&#160;the&#160;string.&#160;It<br/>can&#160;run&#160;an&#160;index&#160;from&#160;zero&#160;to&#160;one&#160;below&#160;its&#160;length&#160;(&lt;&#160;string.length).&#160;If&#160;the<br/>character&#160;at&#160;the&#160;current&#160;position&#160;is&#160;the&#160;same&#160;as&#160;the&#160;one&#160;the&#160;function&#160;is&#160;looking<br/>for,&#160;it&#160;adds&#160;1&#160;to&#160;a&#160;counter&#160;variable.&#160;Once&#160;the&#160;loop&#160;has&#160;finished,&#160;the&#160;counter&#160;can<br/>be&#160;returned.<br/>
Take&#160;care&#160;to&#160;make&#160;all&#160;the&#160;bindings&#160;used&#160;in&#160;the&#160;function&#160;<i>local&#160;</i>to&#160;the&#160;function<br/>
by&#160;properly&#160;declaring&#160;them&#160;with&#160;the&#160;let&#160;or&#160;const&#160;keyword.<br/>
<b>Data&#160;Structures:&#160;Objects&#160;and&#160;Arrays</b><br/>
<b>The&#160;sum&#160;of&#160;a&#160;range</b><br/>
Building&#160;up&#160;an&#160;array&#160;is&#160;most&#160;easily&#160;done&#160;by&#160;first&#160;initializing&#160;a&#160;binding&#160;to&#160;[]<br/>(a&#160;fresh,&#160;empty&#160;array)&#160;and&#160;repeatedly&#160;calling&#160;its&#160;push&#160;method&#160;to&#160;add&#160;a&#160;value.<br/>Don’t&#160;forget&#160;to&#160;return&#160;the&#160;array&#160;at&#160;the&#160;end&#160;of&#160;the&#160;function.<br/>
Since&#160;the&#160;end&#160;boundary&#160;is&#160;inclusive,&#160;you’ll&#160;need&#160;to&#160;use&#160;the&#160;&lt;=&#160;operator&#160;rather<br/>
than&#160;&lt;&#160;to&#160;check&#160;for&#160;the&#160;end&#160;of&#160;your&#160;loop.<br/>
The&#160;step&#160;parameter&#160;can&#160;be&#160;an&#160;optional&#160;parameter&#160;that&#160;defaults&#160;(using&#160;the&#160;=<br/>
operator)&#160;to&#160;1.<br/>
Having&#160;range&#160;understand&#160;negative&#160;step&#160;values&#160;is&#160;probably&#160;best&#160;done&#160;by&#160;writ-<br/>
ing&#160;two&#160;separate&#160;loops—one&#160;for&#160;counting&#160;up&#160;and&#160;one&#160;for&#160;counting&#160;down—<br/>because&#160;the&#160;comparison&#160;that&#160;checks&#160;whether&#160;the&#160;loop&#160;is&#160;finished&#160;needs&#160;to&#160;be&#160;&gt;=<br/>rather&#160;than&#160;&lt;=&#160;when&#160;counting&#160;downward.<br/>
It&#160;might&#160;also&#160;be&#160;worthwhile&#160;to&#160;use&#160;a&#160;different&#160;default&#160;step,&#160;namely,&#160;-1,&#160;when<br/>
the&#160;end&#160;of&#160;the&#160;range&#160;is&#160;smaller&#160;than&#160;the&#160;start.&#160;That&#160;way,&#160;range(5,&#160;2)&#160;re-<br/>turns&#160;something&#160;meaningful,&#160;rather&#160;than&#160;getting&#160;stuck&#160;in&#160;an&#160;infinite&#160;loop.&#160;It&#160;is<br/>possible&#160;to&#160;refer&#160;to&#160;previous&#160;parameters&#160;in&#160;the&#160;default&#160;value&#160;of&#160;a&#160;parameter.<br/>
<b>Reversing&#160;an&#160;array</b><br/>
There&#160;are&#160;two&#160;obvious&#160;ways&#160;to&#160;implement&#160;reverseArray.&#160;The&#160;first&#160;is&#160;to&#160;simply<br/>go&#160;over&#160;the&#160;input&#160;array&#160;from&#160;front&#160;to&#160;back&#160;and&#160;use&#160;the&#160;unshift&#160;method&#160;on<br/>the&#160;new&#160;array&#160;to&#160;insert&#160;each&#160;element&#160;at&#160;its&#160;start.&#160;The&#160;second&#160;is&#160;to&#160;loop&#160;over<br/>the&#160;input&#160;array&#160;backwards&#160;and&#160;use&#160;the&#160;push&#160;method.&#160;Iterating&#160;over&#160;an&#160;array<br/>backwards&#160;requires&#160;a&#160;(somewhat&#160;awkward)&#160;for&#160;specification,&#160;like&#160;(let&#160;i&#160;=<br/>array.length&#160;-&#160;1;&#160;i&#160;&gt;=&#160;0;&#160;i--).<br/>
Reversing&#160;the&#160;array&#160;in&#160;place&#160;is&#160;harder.&#160;You&#160;have&#160;to&#160;be&#160;careful&#160;not&#160;to&#160;overwrite<br/>
elements&#160;that&#160;you&#160;will&#160;later&#160;need.&#160;Using&#160;reverseArray&#160;or&#160;otherwise&#160;copying<br/>
390<br/>
<hr/>
<a name=403></a>the&#160;whole&#160;array&#160;(array.slice(0)&#160;is&#160;a&#160;good&#160;way&#160;to&#160;copy&#160;an&#160;array)&#160;works&#160;but&#160;is<br/>cheating.<br/>
The&#160;trick&#160;is&#160;to&#160;<i>swap&#160;</i>the&#160;first&#160;and&#160;last&#160;elements,&#160;then&#160;the&#160;second&#160;and&#160;second-<br/>
to-last,&#160;and&#160;so&#160;on.&#160;You&#160;can&#160;do&#160;this&#160;by&#160;looping&#160;over&#160;half&#160;the&#160;length&#160;of&#160;the&#160;array<br/>(use&#160;Math.floor&#160;to&#160;round&#160;down—you&#160;don’t&#160;need&#160;to&#160;touch&#160;the&#160;middle&#160;element<br/>in&#160;an&#160;array&#160;with&#160;an&#160;odd&#160;number&#160;of&#160;elements)&#160;and&#160;swapping&#160;the&#160;element&#160;at<br/>position&#160;i&#160;with&#160;the&#160;one&#160;at&#160;position&#160;array.length&#160;-&#160;1&#160;-&#160;i.&#160;You&#160;can&#160;use&#160;a&#160;local<br/>binding&#160;to&#160;briefly&#160;hold&#160;on&#160;to&#160;one&#160;of&#160;the&#160;elements,&#160;overwrite&#160;that&#160;one&#160;with&#160;its<br/>mirror&#160;image,&#160;and&#160;then&#160;put&#160;the&#160;value&#160;from&#160;the&#160;local&#160;binding&#160;in&#160;the&#160;place&#160;where<br/>the&#160;mirror&#160;image&#160;used&#160;to&#160;be.<br/>
<b>A&#160;list</b><br/>
Building&#160;up&#160;a&#160;list&#160;is&#160;easier&#160;when&#160;done&#160;back&#160;to&#160;front.&#160;So&#160;arrayToList&#160;could&#160;iter-<br/>ate&#160;over&#160;the&#160;array&#160;backwards&#160;(see&#160;the&#160;previous&#160;exercise)&#160;and,&#160;for&#160;each&#160;element,<br/>add&#160;an&#160;object&#160;to&#160;the&#160;list.&#160;You&#160;can&#160;use&#160;a&#160;local&#160;binding&#160;to&#160;hold&#160;the&#160;part&#160;of&#160;the<br/>list&#160;that&#160;was&#160;built&#160;so&#160;far&#160;and&#160;use&#160;an&#160;assignment&#160;like&#160;list&#160;=&#160;{value:&#160;X,&#160;rest:<br/>
list}&#160;to&#160;add&#160;an&#160;element.<br/>
To&#160;run&#160;over&#160;a&#160;list&#160;(in&#160;listToArray&#160;and&#160;nth),&#160;a&#160;for&#160;loop&#160;specification&#160;like&#160;this<br/>
can&#160;be&#160;used:<br/>
for&#160;(let&#160;node&#160;=&#160;list;&#160;node;&#160;node&#160;=&#160;node.rest)&#160;{}<br/>
Can&#160;you&#160;see&#160;how&#160;that&#160;works?&#160;Every&#160;iteration&#160;of&#160;the&#160;loop,&#160;node&#160;points&#160;to&#160;the<br/>
current&#160;sublist,&#160;and&#160;the&#160;body&#160;can&#160;read&#160;its&#160;value&#160;property&#160;to&#160;get&#160;the&#160;current<br/>element.&#160;At&#160;the&#160;end&#160;of&#160;an&#160;iteration,&#160;node&#160;moves&#160;to&#160;the&#160;next&#160;sublist.&#160;When&#160;that<br/>is&#160;null,&#160;we&#160;have&#160;reached&#160;the&#160;end&#160;of&#160;the&#160;list,&#160;and&#160;the&#160;loop&#160;is&#160;finished.<br/>
The&#160;recursive&#160;version&#160;of&#160;nth&#160;will,&#160;similarly,&#160;look&#160;at&#160;an&#160;ever&#160;smaller&#160;part&#160;of<br/>
the&#160;“tail”&#160;of&#160;the&#160;list&#160;and&#160;at&#160;the&#160;same&#160;time&#160;count&#160;down&#160;the&#160;index&#160;until&#160;it&#160;reaches<br/>zero,&#160;at&#160;which&#160;point&#160;it&#160;can&#160;return&#160;the&#160;value&#160;property&#160;of&#160;the&#160;node&#160;it&#160;is&#160;looking<br/>at.&#160;To&#160;get&#160;the&#160;zeroth&#160;element&#160;of&#160;a&#160;list,&#160;you&#160;simply&#160;take&#160;the&#160;value&#160;property&#160;of<br/>its&#160;head&#160;node.&#160;To&#160;get&#160;element&#160;<i>N&#160;</i>+&#160;1,&#160;you&#160;take&#160;the&#160;<i>N&#160;</i>th&#160;element&#160;of&#160;the&#160;list<br/>that’s&#160;in&#160;this&#160;list’s&#160;rest&#160;property.<br/>
<b>Deep&#160;comparison</b><br/>
Your&#160;test&#160;for&#160;whether&#160;you&#160;are&#160;dealing&#160;with&#160;a&#160;real&#160;object&#160;will&#160;look&#160;something&#160;like<br/>typeof&#160;x&#160;==&#160;&#34;object&#34;&#160;&amp;&amp;&#160;x&#160;!=&#160;null.&#160;Be&#160;careful&#160;to&#160;compare&#160;properties&#160;only<br/>when&#160;<i>both&#160;</i>arguments&#160;are&#160;objects.&#160;In&#160;all&#160;other&#160;cases&#160;you&#160;can&#160;just&#160;immediately<br/>return&#160;the&#160;result&#160;of&#160;applying&#160;===.<br/>
391<br/>
<hr/>
<a name=404></a>Use&#160;Object.keys&#160;to&#160;go&#160;over&#160;the&#160;properties.&#160;You&#160;need&#160;to&#160;test&#160;whether&#160;both<br/>
objects&#160;have&#160;the&#160;same&#160;set&#160;of&#160;property&#160;names&#160;and&#160;whether&#160;those&#160;properties&#160;have<br/>identical&#160;values.&#160;One&#160;way&#160;to&#160;do&#160;that&#160;is&#160;to&#160;ensure&#160;that&#160;both&#160;objects&#160;have&#160;the<br/>same&#160;number&#160;of&#160;properties&#160;(the&#160;lengths&#160;of&#160;the&#160;property&#160;lists&#160;are&#160;the&#160;same).<br/>And&#160;then,&#160;when&#160;looping&#160;over&#160;one&#160;of&#160;the&#160;object’s&#160;properties&#160;to&#160;compare&#160;them,<br/>always&#160;first&#160;make&#160;sure&#160;the&#160;other&#160;actually&#160;has&#160;a&#160;property&#160;by&#160;that&#160;name.&#160;If&#160;they<br/>have&#160;the&#160;same&#160;number&#160;of&#160;properties&#160;and&#160;all&#160;properties&#160;in&#160;one&#160;also&#160;exist&#160;in&#160;the<br/>other,&#160;they&#160;have&#160;the&#160;same&#160;set&#160;of&#160;property&#160;names.<br/>
Returning&#160;the&#160;correct&#160;value&#160;from&#160;the&#160;function&#160;is&#160;best&#160;done&#160;by&#160;immediately<br/>
returning&#160;false&#160;when&#160;a&#160;mismatch&#160;is&#160;found&#160;and&#160;returning&#160;true&#160;at&#160;the&#160;end&#160;of&#160;the<br/>function.<br/>
<b>Higher-Order&#160;Functions</b><br/>
<b>Everything</b><br/>
Like&#160;the&#160;&amp;&amp;&#160;operator,&#160;the&#160;every&#160;method&#160;can&#160;stop&#160;evaluating&#160;further&#160;elements<br/>as&#160;soon&#160;as&#160;it&#160;has&#160;found&#160;one&#160;that&#160;doesn’t&#160;match.&#160;So&#160;the&#160;loop-based&#160;version<br/>can&#160;jump&#160;out&#160;of&#160;the&#160;loop—with&#160;break&#160;or&#160;return—as&#160;soon&#160;as&#160;it&#160;runs&#160;into&#160;an<br/>element&#160;for&#160;which&#160;the&#160;predicate&#160;function&#160;returns&#160;false.&#160;If&#160;the&#160;loop&#160;runs&#160;to&#160;its<br/>end&#160;without&#160;finding&#160;such&#160;an&#160;element,&#160;we&#160;know&#160;that&#160;all&#160;elements&#160;matched&#160;and<br/>we&#160;should&#160;return&#160;true.<br/>
To&#160;build&#160;every&#160;on&#160;top&#160;of&#160;some,&#160;we&#160;can&#160;apply&#160;<i>De&#160;Morgan’s&#160;laws</i>,&#160;which&#160;state<br/>
that&#160;a&#160;&amp;&amp;&#160;b&#160;equals&#160;!(!a&#160;||&#160;!b).&#160;This&#160;can&#160;be&#160;generalized&#160;to&#160;arrays,&#160;where&#160;all<br/>elements&#160;in&#160;the&#160;array&#160;match&#160;if&#160;there&#160;is&#160;no&#160;element&#160;in&#160;the&#160;array&#160;that&#160;does&#160;not<br/>match.<br/>
<b>Dominant&#160;writing&#160;direction</b><br/>
Your&#160;solution&#160;might&#160;look&#160;a&#160;lot&#160;like&#160;the&#160;first&#160;half&#160;of&#160;the&#160;textScripts&#160;example.<br/>You&#160;again&#160;have&#160;to&#160;count&#160;characters&#160;by&#160;a&#160;criterion&#160;based&#160;on&#160;characterScript<br/>and&#160;then&#160;filter&#160;out&#160;the&#160;part&#160;of&#160;the&#160;result&#160;that&#160;refers&#160;to&#160;uninteresting&#160;(script-less)<br/>characters.<br/>
Finding&#160;the&#160;direction&#160;with&#160;the&#160;highest&#160;character&#160;count&#160;can&#160;be&#160;done&#160;with<br/>
reduce.&#160;If&#160;it’s&#160;not&#160;clear&#160;how,&#160;refer&#160;to&#160;the&#160;example&#160;earlier&#160;in&#160;the&#160;chapter,&#160;where<br/>reduce&#160;was&#160;used&#160;to&#160;find&#160;the&#160;script&#160;with&#160;the&#160;most&#160;characters.<br/>
392<br/>
<hr/>
<a name=405></a><b>The&#160;Secret&#160;Life&#160;of&#160;Objects</b><br/>
<b>A&#160;vector&#160;type</b><br/>
Look&#160;back&#160;to&#160;the&#160;Rabbit&#160;class&#160;example&#160;if&#160;you’re&#160;unsure&#160;how&#160;class&#160;declarations<br/>look.<br/>
Adding&#160;a&#160;getter&#160;property&#160;to&#160;the&#160;constructor&#160;can&#160;be&#160;done&#160;by&#160;putting&#160;the&#160;word<br/>
get&#160;before&#160;the&#160;method&#160;name.&#160;To&#160;compute&#160;the&#160;distance&#160;from&#160;(0,&#160;0)&#160;to&#160;(x,&#160;y),&#160;you<br/>can&#160;use&#160;the&#160;Pythagorean&#160;theorem,&#160;which&#160;says&#160;that&#160;the&#160;square&#160;of&#160;the&#160;distance<br/>we&#160;are&#160;looking&#160;for&#160;is&#160;equal&#160;to&#160;the&#160;square&#160;of&#160;the&#160;x-coordinate&#160;plus&#160;the&#160;square&#160;of<br/>
√<br/>
the&#160;y-coordinate.&#160;Thus,<br/>
<i>x</i>2&#160;+&#160;<i>y</i>2&#160;is&#160;the&#160;number&#160;you&#160;want,&#160;and&#160;Math.sqrt&#160;is<br/>
the&#160;way&#160;you&#160;compute&#160;a&#160;square&#160;root&#160;in&#160;JavaScript.<br/>
<b>Groups</b><br/>
The&#160;easiest&#160;way&#160;to&#160;do&#160;this&#160;is&#160;to&#160;store&#160;an&#160;array&#160;of&#160;group&#160;members&#160;in&#160;an&#160;instance<br/>property.&#160;The&#160;includes&#160;or&#160;indexOf&#160;methods&#160;can&#160;be&#160;used&#160;to&#160;check&#160;whether&#160;a<br/>given&#160;value&#160;is&#160;in&#160;the&#160;array.<br/>
Your&#160;class’s&#160;constructor&#160;can&#160;set&#160;the&#160;member&#160;collection&#160;to&#160;an&#160;empty&#160;array.<br/>
When&#160;add&#160;is&#160;called,&#160;it&#160;must&#160;check&#160;whether&#160;the&#160;given&#160;value&#160;is&#160;in&#160;the&#160;array&#160;or<br/>add&#160;it,&#160;for&#160;example&#160;with&#160;push,&#160;otherwise.<br/>
Deleting&#160;an&#160;element&#160;from&#160;an&#160;array,&#160;in&#160;delete,&#160;is&#160;less&#160;straightforward,&#160;but<br/>
you&#160;can&#160;use&#160;filter&#160;to&#160;create&#160;a&#160;new&#160;array&#160;without&#160;the&#160;value.&#160;Don’t&#160;forget&#160;to<br/>overwrite&#160;the&#160;property&#160;holding&#160;the&#160;members&#160;with&#160;the&#160;newly&#160;filtered&#160;version&#160;of<br/>the&#160;array.<br/>
The&#160;from&#160;method&#160;can&#160;use&#160;a&#160;for/of&#160;loop&#160;to&#160;get&#160;the&#160;values&#160;out&#160;of&#160;the&#160;iterable<br/>
object&#160;and&#160;call&#160;add&#160;to&#160;put&#160;them&#160;into&#160;a&#160;newly&#160;created&#160;group.<br/>
<b>Iterable&#160;groups</b><br/>
It&#160;is&#160;probably&#160;worthwhile&#160;to&#160;define&#160;a&#160;new&#160;class&#160;GroupIterator.&#160;Iterator&#160;in-<br/>stances&#160;should&#160;have&#160;a&#160;property&#160;that&#160;tracks&#160;the&#160;current&#160;position&#160;in&#160;the&#160;group.<br/>Every&#160;time&#160;next&#160;is&#160;called,&#160;it&#160;checks&#160;whether&#160;it&#160;is&#160;done&#160;and,&#160;if&#160;not,&#160;moves&#160;past<br/>the&#160;current&#160;value&#160;and&#160;returns&#160;it.<br/>
The&#160;Group&#160;class&#160;itself&#160;gets&#160;a&#160;method&#160;named&#160;by&#160;Symbol.iterator&#160;that,&#160;when<br/>
called,&#160;returns&#160;a&#160;new&#160;instance&#160;of&#160;the&#160;iterator&#160;class&#160;for&#160;that&#160;group.<br/>
<b>Borrowing&#160;a&#160;method</b><br/>
Remember&#160;that&#160;methods&#160;that&#160;exist&#160;on&#160;plain&#160;objects&#160;come&#160;from&#160;Object.prototype<br/>.<br/>
393<br/>
<hr/>
<a name=406></a>Also&#160;remember&#160;that&#160;you&#160;can&#160;call&#160;a&#160;function&#160;with&#160;a&#160;specific&#160;this&#160;binding&#160;by<br/>
using&#160;its&#160;call&#160;method.<br/>
<b>Project:&#160;A&#160;Robot</b><br/>
<b>Measuring&#160;a&#160;robot</b><br/>
You’ll&#160;have&#160;to&#160;write&#160;a&#160;variant&#160;of&#160;the&#160;runRobot&#160;function&#160;that,&#160;instead&#160;of&#160;log-<br/>ging&#160;the&#160;events&#160;to&#160;the&#160;console,&#160;returns&#160;the&#160;number&#160;of&#160;steps&#160;the&#160;robot&#160;took&#160;to<br/>complete&#160;the&#160;task.<br/>
Your&#160;measurement&#160;function&#160;can&#160;then,&#160;in&#160;a&#160;loop,&#160;generate&#160;new&#160;states&#160;and<br/>
count&#160;the&#160;steps&#160;each&#160;of&#160;the&#160;robots&#160;takes.&#160;When&#160;it&#160;has&#160;generated&#160;enough&#160;mea-<br/>surements,&#160;it&#160;can&#160;use&#160;console.log&#160;to&#160;output&#160;the&#160;average&#160;for&#160;each&#160;robot,&#160;which<br/>is&#160;the&#160;total&#160;number&#160;of&#160;steps&#160;taken&#160;divided&#160;by&#160;the&#160;number&#160;of&#160;measurements.<br/>
<b>Robot&#160;efficiency</b><br/>
The&#160;main&#160;limitation&#160;of&#160;goalOrientedRobot&#160;is&#160;that&#160;it&#160;considers&#160;only&#160;one&#160;parcel<br/>at&#160;a&#160;time.&#160;It&#160;will&#160;often&#160;walk&#160;back&#160;and&#160;forth&#160;across&#160;the&#160;village&#160;because&#160;the&#160;parcel<br/>it&#160;happens&#160;to&#160;be&#160;looking&#160;at&#160;happens&#160;to&#160;be&#160;at&#160;the&#160;other&#160;side&#160;of&#160;the&#160;map,&#160;even&#160;if<br/>there&#160;are&#160;others&#160;much&#160;closer.<br/>
One&#160;possible&#160;solution&#160;would&#160;be&#160;to&#160;compute&#160;routes&#160;for&#160;all&#160;packages&#160;and&#160;then<br/>
take&#160;the&#160;shortest&#160;one.&#160;Even&#160;better&#160;results&#160;can&#160;be&#160;obtained,&#160;if&#160;there&#160;are&#160;multiple<br/>shortest&#160;routes,&#160;by&#160;preferring&#160;the&#160;ones&#160;that&#160;go&#160;to&#160;pick&#160;up&#160;a&#160;package&#160;instead&#160;of<br/>delivering&#160;a&#160;package.<br/>
<b>Persistent&#160;group</b><br/>
The&#160;most&#160;convenient&#160;way&#160;to&#160;represent&#160;the&#160;set&#160;of&#160;member&#160;values&#160;is&#160;still&#160;as&#160;an<br/>array&#160;since&#160;arrays&#160;are&#160;easy&#160;to&#160;copy.<br/>
When&#160;a&#160;value&#160;is&#160;added&#160;to&#160;the&#160;group,&#160;you&#160;can&#160;create&#160;a&#160;new&#160;group&#160;with&#160;a&#160;copy<br/>
of&#160;the&#160;original&#160;array&#160;that&#160;has&#160;the&#160;value&#160;added&#160;(for&#160;example,&#160;using&#160;concat).<br/>When&#160;a&#160;value&#160;is&#160;deleted,&#160;you&#160;filter&#160;it&#160;from&#160;the&#160;array.<br/>
The&#160;class’s&#160;constructor&#160;can&#160;take&#160;such&#160;an&#160;array&#160;as&#160;argument&#160;and&#160;store&#160;it&#160;as<br/>
the&#160;instance’s&#160;(only)&#160;property.&#160;This&#160;array&#160;is&#160;never&#160;updated.<br/>
To&#160;add&#160;a&#160;property&#160;(empty)&#160;to&#160;a&#160;constructor&#160;that&#160;is&#160;not&#160;a&#160;method,&#160;you&#160;have<br/>
to&#160;add&#160;it&#160;to&#160;the&#160;constructor&#160;after&#160;the&#160;class&#160;definition,&#160;as&#160;a&#160;regular&#160;property.<br/>
You&#160;need&#160;only&#160;one&#160;empty&#160;instance&#160;because&#160;all&#160;empty&#160;groups&#160;are&#160;the&#160;same<br/>
and&#160;instances&#160;of&#160;the&#160;class&#160;don’t&#160;change.&#160;You&#160;can&#160;create&#160;many&#160;different&#160;groups<br/>from&#160;that&#160;single&#160;empty&#160;group&#160;without&#160;affecting&#160;it.<br/>
394<br/>
<hr/>
<a name=407></a><b>Bugs&#160;and&#160;Errors</b><br/>
<b>Retry</b><br/>
The&#160;call&#160;to&#160;primitiveMultiply&#160;should&#160;definitely&#160;happen&#160;in&#160;a&#160;try&#160;block.&#160;The<br/>corresponding&#160;catch&#160;block&#160;should&#160;rethrow&#160;the&#160;exception&#160;when&#160;it&#160;is&#160;not&#160;an<br/>instance&#160;of&#160;MultiplicatorUnitFailure&#160;and&#160;ensure&#160;the&#160;call&#160;is&#160;retried&#160;when&#160;it&#160;is.<br/>
To&#160;do&#160;the&#160;retrying,&#160;you&#160;can&#160;either&#160;use&#160;a&#160;loop&#160;that&#160;stops&#160;only&#160;when&#160;a&#160;call<br/>
succeeds—as&#160;in&#160;the&#160;<a href="eloquent-javascripts.html#147">look&#160;example&#160;</a>earlier&#160;in&#160;this&#160;chapter—or&#160;use&#160;recursion&#160;and<br/>hope&#160;you&#160;don’t&#160;get&#160;a&#160;string&#160;of&#160;failures&#160;so&#160;long&#160;that&#160;it&#160;overflows&#160;the&#160;stack&#160;(which<br/>is&#160;a&#160;pretty&#160;safe&#160;bet).<br/>
<b>The&#160;locked&#160;box</b><br/>
This&#160;exercise&#160;calls&#160;for&#160;a&#160;finally&#160;block.&#160;Your&#160;function&#160;should&#160;first&#160;unlock&#160;the<br/>box&#160;and&#160;then&#160;call&#160;the&#160;argument&#160;function&#160;from&#160;inside&#160;a&#160;try&#160;body.&#160;The&#160;finally<br/>block&#160;after&#160;it&#160;should&#160;lock&#160;the&#160;box&#160;again.<br/>
To&#160;make&#160;sure&#160;we&#160;don’t&#160;lock&#160;the&#160;box&#160;when&#160;it&#160;wasn’t&#160;already&#160;locked,&#160;check&#160;its<br/>
lock&#160;at&#160;the&#160;start&#160;of&#160;the&#160;function&#160;and&#160;unlock&#160;and&#160;lock&#160;it&#160;only&#160;when&#160;it&#160;started<br/>out&#160;locked.<br/>
<b>Regular&#160;Expressions</b><br/>
<b>Quoting&#160;style</b><br/>
The&#160;most&#160;obvious&#160;solution&#160;is&#160;to&#160;replace&#160;only&#160;quotes&#160;with&#160;a&#160;nonword&#160;character<br/>on&#160;at&#160;least&#160;one&#160;side—something&#160;like&#160;/\W'|'\W/.&#160;But&#160;you&#160;also&#160;have&#160;to&#160;take&#160;the<br/>start&#160;and&#160;end&#160;of&#160;the&#160;line&#160;into&#160;account.<br/>
In&#160;addition,&#160;you&#160;must&#160;ensure&#160;that&#160;the&#160;replacement&#160;also&#160;includes&#160;the&#160;charac-<br/>
ters&#160;that&#160;were&#160;matched&#160;by&#160;the&#160;\W&#160;pattern&#160;so&#160;that&#160;those&#160;are&#160;not&#160;dropped.&#160;This<br/>can&#160;be&#160;done&#160;by&#160;wrapping&#160;them&#160;in&#160;parentheses&#160;and&#160;including&#160;their&#160;groups&#160;in<br/>the&#160;replacement&#160;string&#160;($1,&#160;$2).&#160;Groups&#160;that&#160;are&#160;not&#160;matched&#160;will&#160;be&#160;replaced<br/>by&#160;nothing.<br/>
<b>Numbers&#160;again</b><br/>
First,&#160;do&#160;not&#160;forget&#160;the&#160;backslash&#160;in&#160;front&#160;of&#160;the&#160;period.<br/>
Matching&#160;the&#160;optional&#160;sign&#160;in&#160;front&#160;of&#160;the&#160;number,&#160;as&#160;well&#160;as&#160;in&#160;front&#160;of&#160;the<br/>
exponent,&#160;can&#160;be&#160;done&#160;with&#160;[+\-]?&#160;or&#160;(\+|-|)&#160;(plus,&#160;minus,&#160;or&#160;nothing).<br/>
The&#160;more&#160;complicated&#160;part&#160;of&#160;the&#160;exercise&#160;is&#160;the&#160;problem&#160;of&#160;matching&#160;both<br/>
&#34;5.&#34;&#160;and&#160;&#34;.5&#34;&#160;without&#160;also&#160;matching&#160;&#34;.&#34;.&#160;For&#160;this,&#160;a&#160;good&#160;solution&#160;is&#160;to&#160;use<br/>
395<br/>
<hr/>
<a name=408></a>the&#160;|&#160;operator&#160;to&#160;separate&#160;the&#160;two&#160;cases—either&#160;one&#160;or&#160;more&#160;digits&#160;optionally<br/>followed&#160;by&#160;a&#160;dot&#160;and&#160;zero&#160;or&#160;more&#160;digits&#160;<i>or&#160;</i>a&#160;dot&#160;followed&#160;by&#160;one&#160;or&#160;more<br/>digits.<br/>
Finally,&#160;to&#160;make&#160;the&#160;<i>e&#160;</i>case&#160;insensitive,&#160;either&#160;add&#160;an&#160;i&#160;option&#160;to&#160;the&#160;regular<br/>
expression&#160;or&#160;use&#160;[eE].<br/>
<b>Modules</b><br/>
<b>A&#160;modular&#160;robot</b><br/>
Here’s&#160;what&#160;I&#160;would&#160;have&#160;done&#160;(but&#160;again,&#160;there&#160;is&#160;no&#160;single&#160;<i>right&#160;</i>way&#160;to&#160;design<br/>a&#160;given&#160;module):<br/>
The&#160;code&#160;used&#160;to&#160;build&#160;the&#160;road&#160;graph&#160;lives&#160;in&#160;the&#160;graph&#160;module.&#160;Because<br/>
I’d&#160;rather&#160;use&#160;dijkstrajs&#160;from&#160;NPM&#160;than&#160;our&#160;own&#160;pathfinding&#160;code,&#160;we’ll<br/>make&#160;this&#160;build&#160;the&#160;kind&#160;of&#160;graph&#160;data&#160;that&#160;dijkstrajs&#160;expects.&#160;This&#160;module<br/>exports&#160;a&#160;single&#160;function,&#160;buildGraph.&#160;I’d&#160;have&#160;buildGraph&#160;accept&#160;an&#160;array<br/>of&#160;two-element&#160;arrays,&#160;rather&#160;than&#160;strings&#160;containing&#160;hyphens,&#160;to&#160;make&#160;the<br/>module&#160;less&#160;dependent&#160;on&#160;the&#160;input&#160;format.<br/>
The&#160;roads&#160;module&#160;contains&#160;the&#160;raw&#160;road&#160;data&#160;(the&#160;roads&#160;array)&#160;and&#160;the<br/>
roadGraph&#160;binding.&#160;This&#160;module&#160;depends&#160;on&#160;./graph&#160;and&#160;exports&#160;the&#160;road<br/>graph.<br/>
The&#160;VillageState&#160;class&#160;lives&#160;in&#160;the&#160;state&#160;module.&#160;It&#160;depends&#160;on&#160;the&#160;./<br/>
roads&#160;module&#160;because&#160;it&#160;needs&#160;to&#160;be&#160;able&#160;to&#160;verify&#160;that&#160;a&#160;given&#160;road&#160;exists.<br/>It&#160;also&#160;needs&#160;randomPick.&#160;Since&#160;that&#160;is&#160;a&#160;three-line&#160;function,&#160;we&#160;could&#160;just<br/>put&#160;it&#160;into&#160;the&#160;state&#160;module&#160;as&#160;an&#160;internal&#160;helper&#160;function.&#160;But&#160;randomRobot<br/>needs&#160;it&#160;too.&#160;So&#160;we’d&#160;have&#160;to&#160;either&#160;duplicate&#160;it&#160;or&#160;put&#160;it&#160;into&#160;its&#160;own&#160;module.<br/>Since&#160;this&#160;function&#160;happens&#160;to&#160;exist&#160;on&#160;NPM&#160;in&#160;the&#160;random-item&#160;package,&#160;a<br/>good&#160;solution&#160;is&#160;to&#160;just&#160;make&#160;both&#160;modules&#160;depend&#160;on&#160;that.&#160;We&#160;can&#160;add&#160;the<br/>runRobot&#160;function&#160;to&#160;this&#160;module&#160;as&#160;well,&#160;since&#160;it’s&#160;small&#160;and&#160;closely&#160;related&#160;to<br/>state&#160;management.&#160;The&#160;module&#160;exports&#160;both&#160;the&#160;VillageState&#160;class&#160;and&#160;the<br/>runRobot&#160;function.<br/>
Finally,&#160;the&#160;robots,&#160;along&#160;with&#160;the&#160;values&#160;they&#160;depend&#160;on&#160;such&#160;as&#160;mailRoute<br/>
,&#160;could&#160;go&#160;into&#160;an&#160;example-robots&#160;module,&#160;which&#160;depends&#160;on&#160;./roads&#160;and<br/>exports&#160;the&#160;robot&#160;functions.&#160;To&#160;make&#160;it&#160;possible&#160;for&#160;goalOrientedRobot&#160;to&#160;do<br/>route-finding,&#160;this&#160;module&#160;also&#160;depends&#160;on&#160;dijkstrajs.<br/>
By&#160;offloading&#160;some&#160;work&#160;to&#160;NPM&#160;modules,&#160;the&#160;code&#160;became&#160;a&#160;little&#160;smaller.<br/>
Each&#160;individual&#160;module&#160;does&#160;something&#160;rather&#160;simple&#160;and&#160;can&#160;be&#160;read&#160;on&#160;its<br/>own.&#160;Dividing&#160;code&#160;into&#160;modules&#160;also&#160;often&#160;suggests&#160;further&#160;improvements&#160;to<br/>the&#160;program’s&#160;design.&#160;In&#160;this&#160;case,&#160;it&#160;seems&#160;a&#160;little&#160;odd&#160;that&#160;the&#160;VillageState<br/>and&#160;the&#160;robots&#160;depend&#160;on&#160;a&#160;specific&#160;road&#160;graph.&#160;It&#160;might&#160;be&#160;a&#160;better&#160;idea&#160;to<br/>
396<br/>
<hr/>
<a name=409></a>make&#160;the&#160;graph&#160;an&#160;argument&#160;to&#160;the&#160;state’s&#160;constructor&#160;and&#160;make&#160;the&#160;robots<br/>read&#160;it&#160;from&#160;the&#160;state&#160;object—this&#160;reduces&#160;dependencies&#160;(which&#160;is&#160;always&#160;good)<br/>and&#160;makes&#160;it&#160;possible&#160;to&#160;run&#160;simulations&#160;on&#160;different&#160;maps&#160;(which&#160;is&#160;even<br/>better).<br/>
Is&#160;it&#160;a&#160;good&#160;idea&#160;to&#160;use&#160;NPM&#160;modules&#160;for&#160;things&#160;that&#160;we&#160;could&#160;have&#160;written<br/>
ourselves?&#160;In&#160;principle,&#160;yes—for&#160;nontrivial&#160;things&#160;like&#160;the&#160;pathfinding&#160;function<br/>you&#160;are&#160;likely&#160;to&#160;make&#160;mistakes&#160;and&#160;waste&#160;time&#160;writing&#160;them&#160;yourself.&#160;For&#160;tiny<br/>functions&#160;like&#160;random-item,&#160;writing&#160;them&#160;yourself&#160;is&#160;easy&#160;enough.&#160;But&#160;adding<br/>them&#160;wherever&#160;you&#160;need&#160;them&#160;does&#160;tend&#160;to&#160;clutter&#160;your&#160;modules.<br/>
However,&#160;you&#160;should&#160;also&#160;not&#160;underestimate&#160;the&#160;work&#160;involved&#160;in&#160;<i>finding&#160;</i>an<br/>
appropriate&#160;NPM&#160;package.&#160;And&#160;even&#160;if&#160;you&#160;find&#160;one,&#160;it&#160;might&#160;not&#160;work&#160;well<br/>or&#160;may&#160;be&#160;missing&#160;some&#160;feature&#160;you&#160;need.&#160;On&#160;top&#160;of&#160;that,&#160;depending&#160;on&#160;NPM<br/>packages&#160;means&#160;you&#160;have&#160;to&#160;make&#160;sure&#160;they&#160;are&#160;installed,&#160;you&#160;have&#160;to&#160;distribute<br/>them&#160;with&#160;your&#160;program,&#160;and&#160;you&#160;might&#160;have&#160;to&#160;periodically&#160;upgrade&#160;them.<br/>
So&#160;again,&#160;this&#160;is&#160;a&#160;trade-off,&#160;and&#160;you&#160;can&#160;decide&#160;either&#160;way&#160;depending&#160;on&#160;how<br/>
much&#160;the&#160;packages&#160;help&#160;you.<br/>
<b>Roads&#160;module</b><br/>
Since&#160;this&#160;is&#160;a&#160;CommonJS&#160;module,&#160;you&#160;have&#160;to&#160;use&#160;require&#160;to&#160;import&#160;the&#160;graph<br/>module.&#160;That&#160;was&#160;described&#160;as&#160;exporting&#160;a&#160;buildGraph&#160;function,&#160;which&#160;you<br/>can&#160;pick&#160;out&#160;of&#160;its&#160;interface&#160;object&#160;with&#160;a&#160;destructuring&#160;const&#160;declaration.<br/>
To&#160;export&#160;roadGraph,&#160;you&#160;add&#160;a&#160;property&#160;to&#160;the&#160;exports&#160;object.&#160;Because<br/>
buildGraph&#160;takes&#160;a&#160;data&#160;structure&#160;that&#160;doesn’t&#160;precisely&#160;match&#160;roads,&#160;the&#160;split-<br/>ting&#160;of&#160;the&#160;road&#160;strings&#160;must&#160;happen&#160;in&#160;your&#160;module.<br/>
<b>Circular&#160;dependencies</b><br/>
The&#160;trick&#160;is&#160;that&#160;require&#160;adds&#160;modules&#160;to&#160;its&#160;cache&#160;<i>before&#160;</i>it&#160;starts&#160;loading&#160;the<br/>module.&#160;That&#160;way,&#160;if&#160;any&#160;require&#160;call&#160;made&#160;while&#160;it&#160;is&#160;running&#160;tries&#160;to&#160;load<br/>it,&#160;it&#160;is&#160;already&#160;known,&#160;and&#160;the&#160;current&#160;interface&#160;will&#160;be&#160;returned,&#160;rather&#160;than<br/>starting&#160;to&#160;load&#160;the&#160;module&#160;once&#160;more&#160;(which&#160;would&#160;eventually&#160;overflow&#160;the<br/>stack).<br/>
If&#160;a&#160;module&#160;overwrites&#160;its&#160;module.exports&#160;value,&#160;any&#160;other&#160;module&#160;that&#160;has<br/>
received&#160;its&#160;interface&#160;value&#160;before&#160;it&#160;finished&#160;loading&#160;will&#160;have&#160;gotten&#160;hold&#160;of<br/>the&#160;default&#160;interface&#160;object&#160;(which&#160;is&#160;likely&#160;empty),&#160;rather&#160;than&#160;the&#160;intended<br/>interface&#160;value.<br/>
397<br/>
<hr/>
<a name=410></a><b>Asynchronous&#160;Programming</b><br/>
<b>Tracking&#160;the&#160;scalpel</b><br/>
This&#160;can&#160;be&#160;done&#160;with&#160;a&#160;single&#160;loop&#160;that&#160;searches&#160;through&#160;the&#160;nests,&#160;moving<br/>forward&#160;to&#160;the&#160;next&#160;when&#160;it&#160;finds&#160;a&#160;value&#160;that&#160;doesn’t&#160;match&#160;the&#160;current&#160;nest’s<br/>name&#160;and&#160;returning&#160;the&#160;name&#160;when&#160;it&#160;finds&#160;a&#160;matching&#160;value.&#160;In&#160;the&#160;async<br/>function,&#160;a&#160;regular&#160;for&#160;or&#160;while&#160;loop&#160;can&#160;be&#160;used.<br/>
To&#160;do&#160;the&#160;same&#160;in&#160;a&#160;plain&#160;function,&#160;you&#160;will&#160;have&#160;to&#160;build&#160;your&#160;loop&#160;using<br/>
a&#160;recursive&#160;function.&#160;The&#160;easiest&#160;way&#160;to&#160;do&#160;this&#160;is&#160;to&#160;have&#160;that&#160;function&#160;re-<br/>turn&#160;a&#160;promise&#160;by&#160;calling&#160;then&#160;on&#160;the&#160;promise&#160;that&#160;retrieves&#160;the&#160;storage&#160;value.<br/>Depending&#160;on&#160;whether&#160;that&#160;value&#160;matches&#160;the&#160;name&#160;of&#160;the&#160;current&#160;nest,&#160;the<br/>handler&#160;returns&#160;that&#160;value&#160;or&#160;a&#160;further&#160;promise&#160;created&#160;by&#160;calling&#160;the&#160;loop<br/>function&#160;again.<br/>
Don’t&#160;forget&#160;to&#160;start&#160;the&#160;loop&#160;by&#160;calling&#160;the&#160;recursive&#160;function&#160;once&#160;from&#160;the<br/>
main&#160;function.<br/>
In&#160;the&#160;async&#160;function,&#160;rejected&#160;promises&#160;are&#160;converted&#160;to&#160;exceptions&#160;by&#160;await<br/>
.&#160;When&#160;an&#160;async&#160;function&#160;throws&#160;an&#160;exception,&#160;its&#160;promise&#160;is&#160;rejected.&#160;So&#160;that<br/>works.<br/>
If&#160;you&#160;implemented&#160;the&#160;non-async&#160;function&#160;as&#160;outlined&#160;earlier,&#160;the&#160;way&#160;then<br/>
works&#160;also&#160;automatically&#160;causes&#160;a&#160;failure&#160;to&#160;end&#160;up&#160;in&#160;the&#160;returned&#160;promise.<br/>If&#160;a&#160;request&#160;fails,&#160;the&#160;handler&#160;passed&#160;to&#160;then&#160;isn’t&#160;called,&#160;and&#160;the&#160;promise&#160;it<br/>returns&#160;is&#160;rejected&#160;with&#160;the&#160;same&#160;reason.<br/>
<b>Building&#160;Promise.all</b><br/>
The&#160;function&#160;passed&#160;to&#160;the&#160;Promise&#160;constructor&#160;will&#160;have&#160;to&#160;call&#160;then&#160;on&#160;each<br/>of&#160;the&#160;promises&#160;in&#160;the&#160;given&#160;array.&#160;When&#160;one&#160;of&#160;them&#160;succeeds,&#160;two&#160;things<br/>need&#160;to&#160;happen.&#160;The&#160;resulting&#160;value&#160;needs&#160;to&#160;be&#160;stored&#160;in&#160;the&#160;correct&#160;position<br/>of&#160;a&#160;result&#160;array,&#160;and&#160;we&#160;must&#160;check&#160;whether&#160;this&#160;was&#160;the&#160;last&#160;pending&#160;promise<br/>and&#160;finish&#160;our&#160;own&#160;promise&#160;if&#160;it&#160;was.<br/>
The&#160;latter&#160;can&#160;be&#160;done&#160;with&#160;a&#160;counter&#160;that&#160;is&#160;initialized&#160;to&#160;the&#160;length&#160;of<br/>
the&#160;input&#160;array&#160;and&#160;from&#160;which&#160;we&#160;subtract&#160;1&#160;every&#160;time&#160;a&#160;promise&#160;succeeds.<br/>When&#160;it&#160;reaches&#160;0,&#160;we&#160;are&#160;done.&#160;Make&#160;sure&#160;you&#160;take&#160;into&#160;account&#160;the&#160;situation<br/>where&#160;the&#160;input&#160;array&#160;is&#160;empty&#160;(and&#160;thus&#160;no&#160;promise&#160;will&#160;ever&#160;resolve).<br/>
Handling&#160;failure&#160;requires&#160;some&#160;thought&#160;but&#160;turns&#160;out&#160;to&#160;be&#160;extremely&#160;simple.<br/>
Just&#160;pass&#160;the&#160;reject&#160;function&#160;of&#160;the&#160;wrapping&#160;promise&#160;to&#160;each&#160;of&#160;the&#160;promises<br/>in&#160;the&#160;array&#160;as&#160;a&#160;catch&#160;handler&#160;or&#160;as&#160;a&#160;second&#160;argument&#160;to&#160;then&#160;so&#160;that&#160;a&#160;failure<br/>in&#160;one&#160;of&#160;them&#160;triggers&#160;the&#160;rejection&#160;of&#160;the&#160;whole&#160;wrapper&#160;promise.<br/>
398<br/>
<hr/>
<a name=411></a><b>Project:&#160;A&#160;Programming&#160;Language</b><br/>
<b>Arrays</b><br/>
The&#160;easiest&#160;way&#160;to&#160;do&#160;this&#160;is&#160;to&#160;represent&#160;Egg&#160;arrays&#160;with&#160;JavaScript&#160;arrays.<br/>
The&#160;values&#160;added&#160;to&#160;the&#160;top&#160;scope&#160;must&#160;be&#160;functions.&#160;By&#160;using&#160;a&#160;rest&#160;argu-<br/>
ment&#160;(with&#160;triple-dot&#160;notation),&#160;the&#160;definition&#160;of&#160;array&#160;can&#160;be&#160;<i>very&#160;</i>simple.<br/>
<b>Closure</b><br/>
Again,&#160;we&#160;are&#160;riding&#160;along&#160;on&#160;a&#160;JavaScript&#160;mechanism&#160;to&#160;get&#160;the&#160;equivalent<br/>feature&#160;in&#160;Egg.&#160;Special&#160;forms&#160;are&#160;passed&#160;the&#160;local&#160;scope&#160;in&#160;which&#160;they&#160;are<br/>evaluated&#160;so&#160;that&#160;they&#160;can&#160;evaluate&#160;their&#160;subforms&#160;in&#160;that&#160;scope.&#160;The&#160;function<br/>returned&#160;by&#160;fun&#160;has&#160;access&#160;to&#160;the&#160;scope&#160;argument&#160;given&#160;to&#160;its&#160;enclosing&#160;function<br/>and&#160;uses&#160;that&#160;to&#160;create&#160;the&#160;function’s&#160;local&#160;scope&#160;when&#160;it&#160;is&#160;called.<br/>
This&#160;means&#160;that&#160;the&#160;prototype&#160;of&#160;the&#160;local&#160;scope&#160;will&#160;be&#160;the&#160;scope&#160;in&#160;which<br/>
the&#160;function&#160;was&#160;created,&#160;which&#160;makes&#160;it&#160;possible&#160;to&#160;access&#160;bindings&#160;in&#160;that<br/>scope&#160;from&#160;the&#160;function.&#160;This&#160;is&#160;all&#160;there&#160;is&#160;to&#160;implementing&#160;closure&#160;(though<br/>to&#160;compile&#160;it&#160;in&#160;a&#160;way&#160;that&#160;is&#160;actually&#160;efficient,&#160;you’d&#160;need&#160;to&#160;do&#160;some&#160;more<br/>work).<br/>
<b>Comments</b><br/>
Make&#160;sure&#160;your&#160;solution&#160;handles&#160;multiple&#160;comments&#160;in&#160;a&#160;row,&#160;with&#160;potentially<br/>whitespace&#160;between&#160;or&#160;after&#160;them.<br/>
A&#160;regular&#160;expression&#160;is&#160;probably&#160;the&#160;easiest&#160;way&#160;to&#160;solve&#160;this.&#160;Write&#160;some-<br/>
thing&#160;that&#160;matches&#160;“whitespace&#160;or&#160;a&#160;comment,&#160;zero&#160;or&#160;more&#160;times”.&#160;Use&#160;the<br/>exec&#160;or&#160;match&#160;method&#160;and&#160;look&#160;at&#160;the&#160;length&#160;of&#160;the&#160;first&#160;element&#160;in&#160;the&#160;returned<br/>array&#160;(the&#160;whole&#160;match)&#160;to&#160;find&#160;out&#160;how&#160;many&#160;characters&#160;to&#160;slice&#160;off.<br/>
<b>Fixing&#160;scope</b><br/>
You&#160;will&#160;have&#160;to&#160;loop&#160;through&#160;one&#160;scope&#160;at&#160;a&#160;time,&#160;using&#160;Object.getPrototypeOf<br/>
to&#160;go&#160;to&#160;the&#160;next&#160;outer&#160;scope.&#160;For&#160;each&#160;scope,&#160;use&#160;hasOwnProperty&#160;to&#160;find&#160;out<br/>
whether&#160;the&#160;binding,&#160;indicated&#160;by&#160;the&#160;name&#160;property&#160;of&#160;the&#160;first&#160;argument&#160;to<br/>set,&#160;exists&#160;in&#160;that&#160;scope.&#160;If&#160;it&#160;does,&#160;set&#160;it&#160;to&#160;the&#160;result&#160;of&#160;evaluating&#160;the&#160;second<br/>argument&#160;to&#160;set&#160;and&#160;then&#160;return&#160;that&#160;value.<br/>
If&#160;the&#160;outermost&#160;scope&#160;is&#160;reached&#160;(Object.getPrototypeOf&#160;returns&#160;null)&#160;and<br/>
we&#160;haven’t&#160;found&#160;the&#160;binding&#160;yet,&#160;it&#160;doesn’t&#160;exist,&#160;and&#160;an&#160;error&#160;should&#160;be<br/>thrown.<br/>
399<br/>
<hr/>
<a name=412></a><b>The&#160;Document&#160;Object&#160;Model</b><br/>
<b>Build&#160;a&#160;table</b><br/>
You&#160;can&#160;use&#160;document.createElement&#160;to&#160;create&#160;new&#160;element&#160;nodes,&#160;document.<br/>createTextNode&#160;to&#160;create&#160;text&#160;nodes,&#160;and&#160;the&#160;appendChild&#160;method&#160;to&#160;put&#160;nodes<br/>into&#160;other&#160;nodes.<br/>
You’ll&#160;want&#160;to&#160;loop&#160;over&#160;the&#160;key&#160;names&#160;once&#160;to&#160;fill&#160;in&#160;the&#160;top&#160;row&#160;and&#160;then<br/>
again&#160;for&#160;each&#160;object&#160;in&#160;the&#160;array&#160;to&#160;construct&#160;the&#160;data&#160;rows.&#160;To&#160;get&#160;an&#160;array<br/>of&#160;key&#160;names&#160;from&#160;the&#160;first&#160;object,&#160;Object.keys&#160;will&#160;be&#160;useful.<br/>
To&#160;add&#160;the&#160;table&#160;to&#160;the&#160;correct&#160;parent&#160;node,&#160;you&#160;can&#160;use&#160;document.getElementById<br/>
or&#160;document.querySelector&#160;to&#160;find&#160;the&#160;node&#160;with&#160;the&#160;proper&#160;id&#160;attribute.<br/>
<b>Elements&#160;by&#160;tag&#160;name</b><br/>
The&#160;solution&#160;is&#160;most&#160;easily&#160;expressed&#160;with&#160;a&#160;recursive&#160;function,&#160;similar&#160;to&#160;the<br/><a href="eloquent-javascripts.html#239">talksAbout&#160;function&#160;</a>defined&#160;earlier&#160;in&#160;this&#160;chapter.<br/>
You&#160;could&#160;call&#160;byTagname&#160;itself&#160;recursively,&#160;concatenating&#160;the&#160;resulting&#160;arrays<br/>
to&#160;produce&#160;the&#160;output.&#160;Or&#160;you&#160;could&#160;create&#160;an&#160;inner&#160;function&#160;that&#160;calls&#160;itself<br/>recursively&#160;and&#160;that&#160;has&#160;access&#160;to&#160;an&#160;array&#160;binding&#160;defined&#160;in&#160;the&#160;outer&#160;function,<br/>to&#160;which&#160;it&#160;can&#160;add&#160;the&#160;matching&#160;elements&#160;it&#160;finds.&#160;Don’t&#160;forget&#160;to&#160;call&#160;the<br/>inner&#160;function&#160;once&#160;from&#160;the&#160;outer&#160;function&#160;to&#160;start&#160;the&#160;process.<br/>
The&#160;recursive&#160;function&#160;must&#160;check&#160;the&#160;node&#160;type.&#160;Here&#160;we&#160;are&#160;interested&#160;only<br/>
in&#160;node&#160;type&#160;1&#160;(Node.ELEMENT_NODE).&#160;For&#160;such&#160;nodes,&#160;we&#160;must&#160;loop&#160;over&#160;their<br/>children&#160;and,&#160;for&#160;each&#160;child,&#160;see&#160;whether&#160;the&#160;child&#160;matches&#160;the&#160;query&#160;while&#160;also<br/>doing&#160;a&#160;recursive&#160;call&#160;on&#160;it&#160;to&#160;inspect&#160;its&#160;own&#160;children.<br/>
<b>The&#160;cat's&#160;hat</b><br/>
Math.cos&#160;and&#160;Math.sin&#160;measure&#160;angles&#160;in&#160;radians,&#160;where&#160;a&#160;full&#160;circle&#160;is&#160;2<i>π</i>.&#160;For<br/>a&#160;given&#160;angle,&#160;you&#160;can&#160;get&#160;the&#160;opposite&#160;angle&#160;by&#160;adding&#160;half&#160;of&#160;this,&#160;which&#160;is<br/>Math.PI.&#160;This&#160;can&#160;be&#160;useful&#160;for&#160;putting&#160;the&#160;hat&#160;on&#160;the&#160;opposite&#160;side&#160;of&#160;the<br/>orbit.<br/>
<b>Handling&#160;Events</b><br/>
<b>Balloon</b><br/>
You’ll&#160;want&#160;to&#160;register&#160;a&#160;handler&#160;for&#160;the&#160;&#34;keydown&#34;&#160;event&#160;and&#160;look&#160;at&#160;event.key<br/>to&#160;figure&#160;out&#160;whether&#160;the&#160;up&#160;or&#160;down&#160;arrow&#160;key&#160;was&#160;pressed.<br/>
400<br/>
<hr/>
<a name=413></a>The&#160;current&#160;size&#160;can&#160;be&#160;kept&#160;in&#160;a&#160;binding&#160;so&#160;that&#160;you&#160;can&#160;base&#160;the&#160;new&#160;size&#160;on<br/>
it.&#160;It’ll&#160;be&#160;helpful&#160;to&#160;define&#160;a&#160;function&#160;that&#160;updates&#160;the&#160;size—both&#160;the&#160;binding<br/>and&#160;the&#160;style&#160;of&#160;the&#160;balloon&#160;in&#160;the&#160;DOM—so&#160;that&#160;you&#160;can&#160;call&#160;it&#160;from&#160;your<br/>event&#160;handler,&#160;and&#160;possibly&#160;also&#160;once&#160;when&#160;starting,&#160;to&#160;set&#160;the&#160;initial&#160;size.<br/>
You&#160;can&#160;change&#160;the&#160;balloon&#160;to&#160;an&#160;explosion&#160;by&#160;replacing&#160;the&#160;text&#160;node&#160;with<br/>
another&#160;one&#160;(using&#160;replaceChild)&#160;or&#160;by&#160;setting&#160;the&#160;textContent&#160;property&#160;of&#160;its<br/>parent&#160;node&#160;to&#160;a&#160;new&#160;string.<br/>
<b>Mouse&#160;trail</b><br/>
Creating&#160;the&#160;elements&#160;is&#160;best&#160;done&#160;with&#160;a&#160;loop.&#160;Append&#160;them&#160;to&#160;the&#160;document<br/>to&#160;make&#160;them&#160;show&#160;up.&#160;To&#160;be&#160;able&#160;to&#160;access&#160;them&#160;later&#160;to&#160;change&#160;their&#160;position,<br/>you’ll&#160;want&#160;to&#160;store&#160;the&#160;elements&#160;in&#160;an&#160;array.<br/>
Cycling&#160;through&#160;them&#160;can&#160;be&#160;done&#160;by&#160;keeping&#160;a&#160;counter&#160;variable&#160;and&#160;adding<br/>
1&#160;to&#160;it&#160;every&#160;time&#160;the&#160;&#34;mousemove&#34;&#160;event&#160;fires.&#160;The&#160;remainder&#160;operator&#160;(%<br/>
elements.length)&#160;can&#160;then&#160;be&#160;used&#160;to&#160;get&#160;a&#160;valid&#160;array&#160;index&#160;to&#160;pick&#160;the<br/>
element&#160;you&#160;want&#160;to&#160;position&#160;during&#160;a&#160;given&#160;event.<br/>
Another&#160;interesting&#160;effect&#160;can&#160;be&#160;achieved&#160;by&#160;modeling&#160;a&#160;simple&#160;physics<br/>
system.&#160;Use&#160;the&#160;&#34;mousemove&#34;&#160;event&#160;only&#160;to&#160;update&#160;a&#160;pair&#160;of&#160;bindings&#160;that<br/>track&#160;the&#160;mouse&#160;position.&#160;Then&#160;use&#160;requestAnimationFrame&#160;to&#160;simulate&#160;the<br/>trailing&#160;elements&#160;being&#160;attracted&#160;to&#160;the&#160;position&#160;of&#160;the&#160;mouse&#160;pointer.&#160;At<br/>every&#160;animation&#160;step,&#160;update&#160;their&#160;position&#160;based&#160;on&#160;their&#160;position&#160;relative&#160;to<br/>the&#160;pointer&#160;(and,&#160;optionally,&#160;a&#160;speed&#160;that&#160;is&#160;stored&#160;for&#160;each&#160;element).&#160;Figuring<br/>out&#160;a&#160;good&#160;way&#160;to&#160;do&#160;this&#160;is&#160;up&#160;to&#160;you.<br/>
<b>Tabs</b><br/>
One&#160;pitfall&#160;you&#160;might&#160;run&#160;into&#160;is&#160;that&#160;you&#160;can’t&#160;directly&#160;use&#160;the&#160;node’s&#160;childNodes<br/>
property&#160;as&#160;a&#160;collection&#160;of&#160;tab&#160;nodes.&#160;For&#160;one&#160;thing,&#160;when&#160;you&#160;add&#160;the&#160;buttons,<br/>
they&#160;will&#160;also&#160;become&#160;child&#160;nodes&#160;and&#160;end&#160;up&#160;in&#160;this&#160;object&#160;because&#160;it&#160;is&#160;a&#160;live<br/>data&#160;structure.&#160;For&#160;another,&#160;the&#160;text&#160;nodes&#160;created&#160;for&#160;the&#160;whitespace&#160;between<br/>the&#160;nodes&#160;are&#160;also&#160;in&#160;childNodes&#160;but&#160;should&#160;not&#160;get&#160;their&#160;own&#160;tabs.&#160;You&#160;can<br/>use&#160;children&#160;instead&#160;of&#160;childNodes&#160;to&#160;ignore&#160;text&#160;nodes.<br/>
You&#160;could&#160;start&#160;by&#160;building&#160;up&#160;an&#160;array&#160;of&#160;tabs&#160;so&#160;that&#160;you&#160;have&#160;easy&#160;access<br/>
to&#160;them.&#160;To&#160;implement&#160;the&#160;styling&#160;of&#160;the&#160;buttons,&#160;you&#160;could&#160;store&#160;objects&#160;that<br/>contain&#160;both&#160;the&#160;tab&#160;panel&#160;and&#160;its&#160;button.<br/>
I&#160;recommend&#160;writing&#160;a&#160;separate&#160;function&#160;for&#160;changing&#160;tabs.&#160;You&#160;can&#160;either<br/>
store&#160;the&#160;previously&#160;selected&#160;tab&#160;and&#160;change&#160;only&#160;the&#160;styles&#160;needed&#160;to&#160;hide&#160;that<br/>and&#160;show&#160;the&#160;new&#160;one,&#160;or&#160;you&#160;can&#160;just&#160;update&#160;the&#160;style&#160;of&#160;all&#160;tabs&#160;every&#160;time<br/>a&#160;new&#160;tab&#160;is&#160;selected.<br/>
401<br/>
<hr/>
<a name=414></a>You&#160;might&#160;want&#160;to&#160;call&#160;this&#160;function&#160;immediately&#160;to&#160;make&#160;the&#160;interface&#160;start<br/>
with&#160;the&#160;first&#160;tab&#160;visible.<br/>
<b>Project:&#160;A&#160;Platform&#160;Game</b><br/>
<b>Pausing&#160;the&#160;game</b><br/>
An&#160;animation&#160;can&#160;be&#160;interrupted&#160;by&#160;returning&#160;false&#160;from&#160;the&#160;function&#160;given<br/>to&#160;runAnimation.&#160;It&#160;can&#160;be&#160;continued&#160;by&#160;calling&#160;runAnimation&#160;again.<br/>
So&#160;we&#160;need&#160;to&#160;communicate&#160;the&#160;fact&#160;that&#160;we&#160;are&#160;pausing&#160;the&#160;game&#160;to&#160;the<br/>
function&#160;given&#160;to&#160;runAnimation.&#160;For&#160;that,&#160;you&#160;can&#160;use&#160;a&#160;binding&#160;that&#160;both&#160;the<br/>event&#160;handler&#160;and&#160;that&#160;function&#160;have&#160;access&#160;to.<br/>
When&#160;finding&#160;a&#160;way&#160;to&#160;unregister&#160;the&#160;handlers&#160;registered&#160;by&#160;trackKeys,&#160;re-<br/>
member&#160;that&#160;the&#160;<i>exact&#160;</i>same&#160;function&#160;value&#160;that&#160;was&#160;passed&#160;to&#160;addEventListener<br/>
must&#160;be&#160;passed&#160;to&#160;removeEventListener&#160;to&#160;successfully&#160;remove&#160;a&#160;handler.<br/>
Thus,&#160;the&#160;handler&#160;function&#160;value&#160;created&#160;in&#160;trackKeys&#160;must&#160;be&#160;available&#160;to&#160;the<br/>code&#160;that&#160;unregisters&#160;the&#160;handlers.<br/>
You&#160;can&#160;add&#160;a&#160;property&#160;to&#160;the&#160;object&#160;returned&#160;by&#160;trackKeys,&#160;containing<br/>
either&#160;that&#160;function&#160;value&#160;or&#160;a&#160;method&#160;that&#160;handles&#160;the&#160;unregistering&#160;directly.<br/>
<b>A&#160;monster</b><br/>
If&#160;you&#160;want&#160;to&#160;implement&#160;a&#160;type&#160;of&#160;motion&#160;that&#160;is&#160;stateful,&#160;such&#160;as&#160;bounc-<br/>ing,&#160;make&#160;sure&#160;you&#160;store&#160;the&#160;necessary&#160;state&#160;in&#160;the&#160;actor&#160;object—include&#160;it&#160;as<br/>constructor&#160;argument&#160;and&#160;add&#160;it&#160;as&#160;a&#160;property.<br/>
Remember&#160;that&#160;update&#160;returns&#160;a&#160;<i>new&#160;</i>object,&#160;rather&#160;than&#160;changing&#160;the&#160;old<br/>
one.<br/>
When&#160;handling&#160;collision,&#160;find&#160;the&#160;player&#160;in&#160;state.actors&#160;and&#160;compare&#160;its<br/>
position&#160;to&#160;the&#160;monster’s&#160;position.&#160;To&#160;get&#160;the&#160;<i>bottom&#160;</i>of&#160;the&#160;player,&#160;you&#160;have<br/>to&#160;add&#160;its&#160;vertical&#160;size&#160;to&#160;its&#160;vertical&#160;position.&#160;The&#160;creation&#160;of&#160;an&#160;updated<br/>state&#160;will&#160;resemble&#160;either&#160;Coin’s&#160;collide&#160;method&#160;(removing&#160;the&#160;actor)&#160;or&#160;Lava<br/>’s&#160;(changing&#160;the&#160;status&#160;to&#160;&#34;lost&#34;),&#160;depending&#160;on&#160;the&#160;player&#160;position.<br/>
<b>Drawing&#160;on&#160;Canvas</b><br/>
<b>Shapes</b><br/>
The&#160;trapezoid&#160;(1)&#160;is&#160;easiest&#160;to&#160;draw&#160;using&#160;a&#160;path.&#160;Pick&#160;suitable&#160;center&#160;coordi-<br/>nates&#160;and&#160;add&#160;each&#160;of&#160;the&#160;four&#160;corners&#160;around&#160;the&#160;center.<br/>
402<br/>
<hr/>
<a name=415></a>The&#160;diamond&#160;(2)&#160;can&#160;be&#160;drawn&#160;the&#160;straightforward&#160;way,&#160;with&#160;a&#160;path,&#160;or&#160;the<br/>
interesting&#160;way,&#160;with&#160;a&#160;rotate&#160;transformation.&#160;To&#160;use&#160;rotation,&#160;you&#160;will&#160;have&#160;to<br/>apply&#160;a&#160;trick&#160;similar&#160;to&#160;what&#160;we&#160;did&#160;in&#160;the&#160;flipHorizontally&#160;function.&#160;Because<br/>you&#160;want&#160;to&#160;rotate&#160;around&#160;the&#160;center&#160;of&#160;your&#160;rectangle&#160;and&#160;not&#160;around&#160;the&#160;point<br/>(0,0),&#160;you&#160;must&#160;first&#160;translate&#160;to&#160;there,&#160;then&#160;rotate,&#160;and&#160;then&#160;translate&#160;back.<br/>
Make&#160;sure&#160;you&#160;reset&#160;the&#160;transformation&#160;after&#160;drawing&#160;any&#160;shape&#160;that&#160;creates<br/>
one.<br/>
For&#160;the&#160;zigzag&#160;(3)&#160;it&#160;becomes&#160;impractical&#160;to&#160;write&#160;a&#160;new&#160;call&#160;to&#160;lineTo&#160;for<br/>
each&#160;line&#160;segment.&#160;Instead,&#160;you&#160;should&#160;use&#160;a&#160;loop.&#160;You&#160;can&#160;have&#160;each&#160;iteration<br/>draw&#160;either&#160;two&#160;line&#160;segments&#160;(right&#160;and&#160;then&#160;left&#160;again)&#160;or&#160;one,&#160;in&#160;which&#160;case<br/>you&#160;must&#160;use&#160;the&#160;evenness&#160;(%&#160;2)&#160;of&#160;the&#160;loop&#160;index&#160;to&#160;determine&#160;whether&#160;to&#160;go<br/>left&#160;or&#160;right.<br/>
You’ll&#160;also&#160;need&#160;a&#160;loop&#160;for&#160;the&#160;spiral&#160;(4).&#160;If&#160;you&#160;draw&#160;a&#160;series&#160;of&#160;points,&#160;with<br/>
each&#160;point&#160;moving&#160;further&#160;along&#160;a&#160;circle&#160;around&#160;the&#160;spiral’s&#160;center,&#160;you&#160;get&#160;a<br/>circle.&#160;If,&#160;during&#160;the&#160;loop,&#160;you&#160;vary&#160;the&#160;radius&#160;of&#160;the&#160;circle&#160;on&#160;which&#160;you&#160;are<br/>putting&#160;the&#160;current&#160;point&#160;and&#160;go&#160;around&#160;more&#160;than&#160;once,&#160;the&#160;result&#160;is&#160;a&#160;spiral.<br/>
The&#160;star&#160;(5)&#160;depicted&#160;is&#160;built&#160;out&#160;of&#160;quadraticCurveTo&#160;lines.&#160;You&#160;could<br/>
also&#160;draw&#160;one&#160;with&#160;straight&#160;lines.<br/>
Divide&#160;a&#160;circle&#160;into&#160;eight&#160;pieces&#160;for&#160;a<br/>
star&#160;with&#160;eight&#160;points,&#160;or&#160;however&#160;many&#160;pieces&#160;you&#160;want.&#160;Draw&#160;lines&#160;be-<br/>tween&#160;these&#160;points,&#160;making&#160;them&#160;curve&#160;toward&#160;the&#160;center&#160;of&#160;the&#160;star.&#160;With<br/>quadraticCurveTo,&#160;you&#160;can&#160;use&#160;the&#160;center&#160;as&#160;the&#160;control&#160;point.<br/>
<b>The&#160;pie&#160;chart</b><br/>
You&#160;will&#160;need&#160;to&#160;call&#160;fillText&#160;and&#160;set&#160;the&#160;context’s&#160;textAlign&#160;and&#160;textBaseline<br/>
properties&#160;in&#160;such&#160;a&#160;way&#160;that&#160;the&#160;text&#160;ends&#160;up&#160;where&#160;you&#160;want&#160;it.<br/>
A&#160;sensible&#160;way&#160;to&#160;position&#160;the&#160;labels&#160;would&#160;be&#160;to&#160;put&#160;the&#160;text&#160;on&#160;the&#160;line<br/>
going&#160;from&#160;the&#160;center&#160;of&#160;the&#160;pie&#160;through&#160;the&#160;middle&#160;of&#160;the&#160;slice.&#160;You&#160;don’t<br/>want&#160;to&#160;put&#160;the&#160;text&#160;directly&#160;against&#160;the&#160;side&#160;of&#160;the&#160;pie&#160;but&#160;rather&#160;move&#160;the<br/>text&#160;out&#160;to&#160;the&#160;side&#160;of&#160;the&#160;pie&#160;by&#160;a&#160;given&#160;number&#160;of&#160;pixels.<br/>
The&#160;angle&#160;of&#160;this&#160;line&#160;is&#160;currentAngle&#160;+&#160;0.5&#160;*&#160;sliceAngle.&#160;The&#160;following<br/>
code&#160;finds&#160;a&#160;position&#160;on&#160;this&#160;line&#160;120&#160;pixels&#160;from&#160;the&#160;center:<br/>
let&#160;middleAngle&#160;=&#160;currentAngle&#160;+&#160;0.5&#160;*&#160;sliceAngle;<br/>let&#160;textX&#160;=&#160;Math.cos(middleAngle)&#160;*&#160;120&#160;+&#160;centerX;<br/>let&#160;textY&#160;=&#160;Math.sin(middleAngle)&#160;*&#160;120&#160;+&#160;centerY;<br/>
For&#160;textBaseline,&#160;the&#160;value&#160;&#34;middle&#34;&#160;is&#160;probably&#160;appropriate&#160;when&#160;using<br/>
this&#160;approach.&#160;What&#160;to&#160;use&#160;for&#160;textAlign&#160;depends&#160;on&#160;which&#160;side&#160;of&#160;the&#160;circle<br/>we&#160;are&#160;on.&#160;On&#160;the&#160;left,&#160;it&#160;should&#160;be&#160;&#34;right&#34;,&#160;and&#160;on&#160;the&#160;right,&#160;it&#160;should&#160;be<br/>
403<br/>
<hr/>
<a name=416></a>&#34;left&#34;,&#160;so&#160;that&#160;the&#160;text&#160;is&#160;positioned&#160;away&#160;from&#160;the&#160;pie.<br/>
If&#160;you&#160;are&#160;not&#160;sure&#160;how&#160;to&#160;find&#160;out&#160;which&#160;side&#160;of&#160;the&#160;circle&#160;a&#160;given&#160;angle&#160;is&#160;on,<br/>
look&#160;to&#160;the&#160;explanation&#160;of&#160;Math.cos&#160;in&#160;<a href="eloquent-javascripts.html#251">Chapter&#160;14</a>.&#160;The&#160;cosine&#160;of&#160;an&#160;angle&#160;tells<br/>us&#160;which&#160;x-coordinate&#160;it&#160;corresponds&#160;to,&#160;which&#160;in&#160;turn&#160;tells&#160;us&#160;exactly&#160;which<br/>side&#160;of&#160;the&#160;circle&#160;we&#160;are&#160;on.<br/>
<b>A&#160;bouncing&#160;ball</b><br/>
A&#160;box&#160;is&#160;easy&#160;to&#160;draw&#160;with&#160;strokeRect.&#160;Define&#160;a&#160;binding&#160;that&#160;holds&#160;its&#160;size&#160;or<br/>define&#160;two&#160;bindings&#160;if&#160;your&#160;box’s&#160;width&#160;and&#160;height&#160;differ.&#160;To&#160;create&#160;a&#160;round<br/>ball,&#160;start&#160;a&#160;path&#160;and&#160;call&#160;arc(x,&#160;y,&#160;radius,&#160;0,&#160;7),&#160;which&#160;creates&#160;an&#160;arc&#160;going<br/>from&#160;zero&#160;to&#160;more&#160;than&#160;a&#160;whole&#160;circle.&#160;Then&#160;fill&#160;the&#160;path.<br/>
To&#160;model&#160;the&#160;ball’s&#160;position&#160;and&#160;speed,&#160;you&#160;can&#160;use&#160;the&#160;Vec&#160;class&#160;from<br/>
<a href="eloquent-javascripts.html#277">Chapter&#160;16.&#160;</a>Give&#160;it&#160;a&#160;starting&#160;speed,&#160;preferably&#160;one&#160;that&#160;is&#160;not&#160;purely&#160;vertical&#160;or<br/>horizontal,&#160;and&#160;for&#160;every&#160;frame&#160;multiply&#160;that&#160;speed&#160;by&#160;the&#160;amount&#160;of&#160;time&#160;that<br/>elapsed.&#160;When&#160;the&#160;ball&#160;gets&#160;too&#160;close&#160;to&#160;a&#160;vertical&#160;wall,&#160;invert&#160;the&#160;x&#160;component<br/>in&#160;its&#160;speed.&#160;Likewise,&#160;invert&#160;the&#160;y&#160;component&#160;when&#160;it&#160;hits&#160;a&#160;horizontal&#160;wall.<br/>
After&#160;finding&#160;the&#160;ball’s&#160;new&#160;position&#160;and&#160;speed,&#160;use&#160;clearRect&#160;to&#160;delete&#160;the<br/>
scene&#160;and&#160;redraw&#160;it&#160;using&#160;the&#160;new&#160;position.<br/>
<b>Precomputed&#160;mirroring</b><br/>
The&#160;key&#160;to&#160;the&#160;solution&#160;is&#160;the&#160;fact&#160;that&#160;we&#160;can&#160;use&#160;a&#160;canvas&#160;element&#160;as&#160;a&#160;source<br/>image&#160;when&#160;using&#160;drawImage.&#160;It&#160;is&#160;possible&#160;to&#160;create&#160;an&#160;extra&#160;&lt;canvas&gt;&#160;element,<br/>without&#160;adding&#160;it&#160;to&#160;the&#160;document,&#160;and&#160;draw&#160;our&#160;inverted&#160;sprites&#160;to&#160;it,&#160;once.<br/>When&#160;drawing&#160;an&#160;actual&#160;frame,&#160;we&#160;just&#160;copy&#160;the&#160;already&#160;inverted&#160;sprites&#160;to<br/>the&#160;main&#160;canvas.<br/>
Some&#160;care&#160;would&#160;be&#160;required&#160;because&#160;images&#160;do&#160;not&#160;load&#160;instantly.&#160;We&#160;do<br/>
the&#160;inverted&#160;drawing&#160;only&#160;once,&#160;and&#160;if&#160;we&#160;do&#160;it&#160;before&#160;the&#160;image&#160;loads,&#160;it<br/>won’t&#160;draw&#160;anything.&#160;A&#160;&#34;load&#34;&#160;handler&#160;on&#160;the&#160;image&#160;can&#160;be&#160;used&#160;to&#160;draw&#160;the<br/>inverted&#160;images&#160;to&#160;the&#160;extra&#160;canvas.&#160;This&#160;canvas&#160;can&#160;be&#160;used&#160;as&#160;a&#160;drawing<br/>source&#160;immediately&#160;(it’ll&#160;simply&#160;be&#160;blank&#160;until&#160;we&#160;draw&#160;the&#160;character&#160;onto&#160;it).<br/>
<b>HTTP&#160;and&#160;Forms</b><br/>
<b>Content&#160;negotiation</b><br/>
Base&#160;your&#160;code&#160;on&#160;the&#160;fetch&#160;examples&#160;<a href="eloquent-javascripts.html#323">earlier&#160;in&#160;the&#160;chapter</a>.<br/>
Asking&#160;for&#160;a&#160;bogus&#160;media&#160;type&#160;will&#160;return&#160;a&#160;response&#160;with&#160;code&#160;406,&#160;“Not<br/>
acceptable”,&#160;which&#160;is&#160;the&#160;code&#160;a&#160;server&#160;should&#160;return&#160;when&#160;it&#160;can’t&#160;fulfill&#160;the<br/>
404<br/>
<hr/>
<a name=417></a>Accept&#160;header.<br/>
<b>A&#160;JavaScript&#160;workbench</b><br/>
Use&#160;document.querySelector&#160;or&#160;document.getElementById&#160;to&#160;get&#160;access&#160;to&#160;the<br/>elements&#160;defined&#160;in&#160;your&#160;HTML.&#160;An&#160;event&#160;handler&#160;for&#160;&#34;click&#34;&#160;or&#160;&#34;mousedown<br/>&#34;&#160;events&#160;on&#160;the&#160;button&#160;can&#160;get&#160;the&#160;value&#160;property&#160;of&#160;the&#160;text&#160;field&#160;and&#160;call<br/>Function&#160;on&#160;it.<br/>
Make&#160;sure&#160;you&#160;wrap&#160;both&#160;the&#160;call&#160;to&#160;Function&#160;and&#160;the&#160;call&#160;to&#160;its&#160;result&#160;in&#160;a<br/>
try&#160;block&#160;so&#160;you&#160;can&#160;catch&#160;the&#160;exceptions&#160;it&#160;produces.&#160;In&#160;this&#160;case,&#160;we&#160;really<br/>don’t&#160;know&#160;what&#160;type&#160;of&#160;exception&#160;we&#160;are&#160;looking&#160;for,&#160;so&#160;catch&#160;everything.<br/>
The&#160;textContent&#160;property&#160;of&#160;the&#160;output&#160;element&#160;can&#160;be&#160;used&#160;to&#160;fill&#160;it&#160;with<br/>
a&#160;string&#160;message.&#160;Or,&#160;if&#160;you&#160;want&#160;to&#160;keep&#160;the&#160;old&#160;content&#160;around,&#160;create&#160;a<br/>new&#160;text&#160;node&#160;using&#160;document.createTextNode&#160;and&#160;append&#160;it&#160;to&#160;the&#160;element.<br/>Remember&#160;to&#160;add&#160;a&#160;newline&#160;character&#160;to&#160;the&#160;end&#160;so&#160;that&#160;not&#160;all&#160;output&#160;appears<br/>on&#160;a&#160;single&#160;line.<br/>
<b>Conway's&#160;Game&#160;of&#160;Life</b><br/>
To&#160;solve&#160;the&#160;problem&#160;of&#160;having&#160;the&#160;changes&#160;conceptually&#160;happen&#160;at&#160;the&#160;same<br/>time,&#160;try&#160;to&#160;see&#160;the&#160;computation&#160;of&#160;a&#160;generation&#160;as&#160;a&#160;pure&#160;function,&#160;which&#160;takes<br/>one&#160;grid&#160;and&#160;produces&#160;a&#160;new&#160;grid&#160;that&#160;represents&#160;the&#160;next&#160;turn.<br/>
Representing&#160;the&#160;matrix&#160;can&#160;be&#160;done&#160;in&#160;the&#160;way&#160;shown&#160;in&#160;<a href="eloquent-javascripts.html#120">Chapter&#160;6</a>.&#160;You&#160;can<br/>
count&#160;live&#160;neighbors&#160;with&#160;two&#160;nested&#160;loops,&#160;looping&#160;over&#160;adjacent&#160;coordinates<br/>in&#160;both&#160;dimensions.&#160;Take&#160;care&#160;not&#160;to&#160;count&#160;cells&#160;outside&#160;of&#160;the&#160;field&#160;and&#160;to<br/>ignore&#160;the&#160;cell&#160;in&#160;the&#160;center,&#160;whose&#160;neighbors&#160;we&#160;are&#160;counting.<br/>
Ensuring&#160;that&#160;changes&#160;to&#160;checkboxes&#160;take&#160;effect&#160;on&#160;the&#160;next&#160;generation&#160;can<br/>
be&#160;done&#160;in&#160;two&#160;ways.&#160;An&#160;event&#160;handler&#160;could&#160;notice&#160;these&#160;changes&#160;and&#160;update<br/>the&#160;current&#160;grid&#160;to&#160;reflect&#160;them,&#160;or&#160;you&#160;could&#160;generate&#160;a&#160;fresh&#160;grid&#160;from&#160;the<br/>values&#160;in&#160;the&#160;checkboxes&#160;before&#160;computing&#160;the&#160;next&#160;turn.<br/>
If&#160;you&#160;choose&#160;to&#160;go&#160;with&#160;event&#160;handlers,&#160;you&#160;might&#160;want&#160;to&#160;attach&#160;attributes<br/>
that&#160;identify&#160;the&#160;position&#160;that&#160;each&#160;checkbox&#160;corresponds&#160;to&#160;so&#160;that&#160;it&#160;is&#160;easy<br/>to&#160;find&#160;out&#160;which&#160;cell&#160;to&#160;change.<br/>
To&#160;draw&#160;the&#160;grid&#160;of&#160;checkboxes,&#160;you&#160;can&#160;either&#160;use&#160;a&#160;&lt;table&gt;&#160;element&#160;(see<br/>
<a href="eloquent-javascripts.html#253">Chapter&#160;14</a>)&#160;or&#160;simply&#160;put&#160;them&#160;all&#160;in&#160;the&#160;same&#160;element&#160;and&#160;put&#160;&lt;br&gt;&#160;(line<br/>break)&#160;elements&#160;between&#160;the&#160;rows.<br/>
405<br/>
<hr/>
<a name=418></a><b>Project:&#160;A&#160;Pixel&#160;Art&#160;Editor</b><br/>
<b>Keyboard&#160;bindings</b><br/>
The&#160;key&#160;property&#160;of&#160;events&#160;for&#160;letter&#160;keys&#160;will&#160;be&#160;the&#160;lowercase&#160;letter&#160;itself,&#160;if<br/>shift&#160;isn’t&#160;being&#160;held.&#160;We’re&#160;not&#160;interested&#160;in&#160;key&#160;events&#160;with&#160;shift&#160;here.<br/>
A&#160;&#34;keydown&#34;&#160;handler&#160;can&#160;inspect&#160;its&#160;event&#160;object&#160;to&#160;see&#160;whether&#160;it&#160;matches<br/>
any&#160;of&#160;the&#160;shortcuts.&#160;You&#160;can&#160;automatically&#160;get&#160;the&#160;list&#160;of&#160;first&#160;letters&#160;from&#160;the<br/>tools&#160;object&#160;so&#160;that&#160;you&#160;don’t&#160;have&#160;to&#160;write&#160;them&#160;out.<br/>
When&#160;the&#160;key&#160;event&#160;matches&#160;a&#160;shortcut,&#160;call&#160;preventDefault&#160;on&#160;it&#160;and&#160;dis-<br/>
patch&#160;the&#160;appropriate&#160;action.<br/>
<b>Efficient&#160;drawing</b><br/>
This&#160;exercise&#160;is&#160;a&#160;good&#160;example&#160;of&#160;how&#160;immutable&#160;data&#160;structures&#160;can&#160;make<br/>code&#160;<i>faster</i>.&#160;Because&#160;we&#160;have&#160;both&#160;the&#160;old&#160;and&#160;the&#160;new&#160;picture,&#160;we&#160;can&#160;compare<br/>them&#160;and&#160;redraw&#160;only&#160;the&#160;pixels&#160;that&#160;changed&#160;color,&#160;saving&#160;more&#160;than&#160;99<br/>percent&#160;of&#160;the&#160;drawing&#160;work&#160;in&#160;most&#160;cases.<br/>
You&#160;can&#160;either&#160;write&#160;a&#160;new&#160;function&#160;updatePicture&#160;or&#160;have&#160;drawPicture&#160;take<br/>
an&#160;extra&#160;argument,&#160;which&#160;may&#160;be&#160;undefined&#160;or&#160;the&#160;previous&#160;picture.&#160;For&#160;each<br/>pixel,&#160;the&#160;function&#160;checks&#160;whether&#160;a&#160;previous&#160;picture&#160;was&#160;passed&#160;with&#160;the&#160;same<br/>color&#160;at&#160;this&#160;position&#160;and&#160;skips&#160;the&#160;pixel&#160;when&#160;that&#160;is&#160;the&#160;case.<br/>
Because&#160;the&#160;canvas&#160;gets&#160;cleared&#160;when&#160;we&#160;change&#160;its&#160;size,&#160;you&#160;should&#160;also<br/>
avoid&#160;touching&#160;its&#160;width&#160;and&#160;height&#160;properties&#160;when&#160;the&#160;old&#160;picture&#160;and&#160;the<br/>new&#160;picture&#160;have&#160;the&#160;same&#160;size.&#160;If&#160;they&#160;are&#160;different,&#160;which&#160;will&#160;happen&#160;when&#160;a<br/>new&#160;picture&#160;has&#160;been&#160;loaded,&#160;you&#160;can&#160;set&#160;the&#160;binding&#160;holding&#160;the&#160;old&#160;picture&#160;to<br/>null&#160;after&#160;changing&#160;the&#160;canvas&#160;size&#160;because&#160;you&#160;shouldn’t&#160;skip&#160;any&#160;pixels&#160;after<br/>you’ve&#160;changed&#160;the&#160;canvas&#160;size.<br/>
<b>Circles</b><br/>
You&#160;can&#160;take&#160;some&#160;inspiration&#160;from&#160;the&#160;rectangle&#160;tool.&#160;Like&#160;that&#160;tool,&#160;you’ll<br/>want&#160;to&#160;keep&#160;drawing&#160;on&#160;the&#160;<i>starting&#160;</i>picture,&#160;rather&#160;than&#160;the&#160;current&#160;picture,<br/>when&#160;the&#160;pointer&#160;moves.<br/>
To&#160;figure&#160;out&#160;which&#160;pixels&#160;to&#160;color,&#160;you&#160;can&#160;use&#160;the&#160;Pythagorean&#160;theorem.<br/>
First&#160;figure&#160;out&#160;the&#160;distance&#160;between&#160;the&#160;current&#160;pointer&#160;position&#160;and&#160;the&#160;start<br/>position&#160;by&#160;taking&#160;the&#160;square&#160;root&#160;(Math.sqrt)&#160;of&#160;the&#160;sum&#160;of&#160;the&#160;square&#160;(Math<br/>.pow(x,&#160;2))&#160;of&#160;the&#160;difference&#160;in&#160;x-coordinates&#160;and&#160;the&#160;square&#160;of&#160;the&#160;difference<br/>in&#160;y-coordinates.&#160;Then&#160;loop&#160;over&#160;a&#160;square&#160;of&#160;pixels&#160;around&#160;the&#160;start&#160;position,<br/>whose&#160;sides&#160;are&#160;at&#160;least&#160;twice&#160;the&#160;radius,&#160;and&#160;color&#160;those&#160;that&#160;are&#160;within&#160;the<br/>
406<br/>
<hr/>
<a name=419></a>circle’s&#160;radius,&#160;again&#160;using&#160;the&#160;Pythagorean&#160;formula&#160;to&#160;figure&#160;out&#160;their&#160;distance<br/>from&#160;the&#160;center.<br/>
Make&#160;sure&#160;you&#160;don’t&#160;try&#160;to&#160;color&#160;pixels&#160;that&#160;are&#160;outside&#160;of&#160;the&#160;picture’s<br/>
boundaries.<br/>
<b>Proper&#160;lines</b><br/>
The&#160;thing&#160;about&#160;the&#160;problem&#160;of&#160;drawing&#160;a&#160;pixelated&#160;line&#160;is&#160;that&#160;it&#160;is&#160;really&#160;four<br/>similar&#160;but&#160;slightly&#160;different&#160;problems.&#160;Drawing&#160;a&#160;horizontal&#160;line&#160;from&#160;the&#160;left<br/>to&#160;the&#160;right&#160;is&#160;easy—you&#160;loop&#160;over&#160;the&#160;x-coordinates&#160;and&#160;color&#160;a&#160;pixel&#160;at&#160;every<br/>step.&#160;If&#160;the&#160;line&#160;has&#160;a&#160;slight&#160;slope&#160;(less&#160;than&#160;45&#160;degrees&#160;or&#160;¼<i>π&#160;</i>radians),&#160;you<br/>can&#160;interpolate&#160;the&#160;y-coordinate&#160;along&#160;the&#160;slope.&#160;You&#160;still&#160;need&#160;one&#160;pixel&#160;per<br/><i>x&#160;</i>position,&#160;with&#160;the&#160;<i>y&#160;</i>position&#160;of&#160;those&#160;pixels&#160;determined&#160;by&#160;the&#160;slope.<br/>
But&#160;as&#160;soon&#160;as&#160;your&#160;slope&#160;goes&#160;across&#160;45&#160;degrees,&#160;you&#160;need&#160;to&#160;switch&#160;the&#160;way<br/>
you&#160;treat&#160;the&#160;coordinates.&#160;You&#160;now&#160;need&#160;one&#160;pixel&#160;per&#160;<i>y&#160;</i>position&#160;since&#160;the&#160;line<br/>goes&#160;up&#160;more&#160;than&#160;it&#160;goes&#160;left.&#160;And&#160;then,&#160;when&#160;you&#160;cross&#160;135&#160;degrees,&#160;you<br/>have&#160;to&#160;go&#160;back&#160;to&#160;looping&#160;over&#160;the&#160;x-coordinates,&#160;but&#160;from&#160;right&#160;to&#160;left.<br/>
You&#160;don’t&#160;actually&#160;have&#160;to&#160;write&#160;four&#160;loops.&#160;Since&#160;drawing&#160;a&#160;line&#160;from&#160;<i>A&#160;</i>to<br/>
<i>B&#160;</i>is&#160;the&#160;same&#160;as&#160;drawing&#160;a&#160;line&#160;from&#160;<i>B&#160;</i>to&#160;<i>A</i>,&#160;you&#160;can&#160;swap&#160;the&#160;start&#160;and&#160;end<br/>positions&#160;for&#160;lines&#160;going&#160;from&#160;right&#160;to&#160;left&#160;and&#160;treat&#160;them&#160;as&#160;going&#160;left&#160;to&#160;right.<br/>
So&#160;you&#160;need&#160;two&#160;different&#160;loops.&#160;The&#160;first&#160;thing&#160;your&#160;line&#160;drawing&#160;function<br/>
should&#160;do&#160;is&#160;check&#160;whether&#160;the&#160;difference&#160;between&#160;the&#160;x-coordinates&#160;is&#160;larger<br/>than&#160;the&#160;difference&#160;between&#160;the&#160;y-coordinates.&#160;If&#160;it&#160;is,&#160;this&#160;is&#160;a&#160;horizontal-ish<br/>line,&#160;and&#160;if&#160;not,&#160;a&#160;vertical-ish&#160;one.<br/>
Make&#160;sure&#160;you&#160;compare&#160;the&#160;<i>absolute&#160;</i>values&#160;of&#160;the&#160;<i>x&#160;</i>and&#160;<i>y&#160;</i>difference,&#160;which<br/>
you&#160;can&#160;get&#160;with&#160;Math.abs.<br/>
Once&#160;you&#160;know&#160;along&#160;which&#160;axis&#160;you&#160;will&#160;be&#160;looping,&#160;you&#160;can&#160;check&#160;whether<br/>
the&#160;start&#160;point&#160;has&#160;a&#160;higher&#160;coordinate&#160;along&#160;that&#160;axis&#160;than&#160;the&#160;endpoint&#160;and<br/>swap&#160;them&#160;if&#160;necessary.&#160;A&#160;succinct&#160;way&#160;to&#160;swap&#160;the&#160;values&#160;of&#160;two&#160;bindings&#160;in<br/>JavaScript&#160;uses&#160;destructuring&#160;assignment&#160;like&#160;this:<br/>
[start,&#160;end]&#160;=&#160;[end,&#160;start];<br/>
Then&#160;you&#160;can&#160;compute&#160;the&#160;slope&#160;of&#160;the&#160;line,&#160;which&#160;determines&#160;the&#160;amount<br/>
the&#160;coordinate&#160;on&#160;the&#160;other&#160;axis&#160;changes&#160;for&#160;each&#160;step&#160;you&#160;take&#160;along&#160;your&#160;main<br/>axis.&#160;With&#160;that,&#160;you&#160;can&#160;run&#160;a&#160;loop&#160;along&#160;the&#160;main&#160;axis&#160;while&#160;also&#160;tracking<br/>the&#160;corresponding&#160;position&#160;on&#160;the&#160;other&#160;axis,&#160;and&#160;you&#160;can&#160;draw&#160;pixels&#160;on&#160;every<br/>iteration.&#160;Make&#160;sure&#160;you&#160;round&#160;the&#160;non-main&#160;axis&#160;coordinates&#160;since&#160;they&#160;are<br/>likely&#160;to&#160;be&#160;fractional&#160;and&#160;the&#160;draw&#160;method&#160;doesn’t&#160;respond&#160;well&#160;to&#160;fractional<br/>coordinates.<br/>
407<br/>
<hr/>
<a name=420></a><b>Node.js</b><br/>
<b>Search&#160;tool</b><br/>
Your&#160;first&#160;command&#160;line&#160;argument,&#160;the&#160;regular&#160;expression,&#160;can&#160;be&#160;found&#160;in<br/>process.argv[2].&#160;The&#160;input&#160;files&#160;come&#160;after&#160;that.&#160;You&#160;can&#160;use&#160;the&#160;RegExp<br/>constructor&#160;to&#160;go&#160;from&#160;a&#160;string&#160;to&#160;a&#160;regular&#160;expression&#160;object.<br/>
Doing&#160;this&#160;synchronously,&#160;with&#160;readFileSync,&#160;is&#160;more&#160;straightforward,&#160;but<br/>
if&#160;you&#160;use&#160;fs.promises&#160;again&#160;to&#160;get&#160;promise-returning&#160;functions&#160;and&#160;write&#160;an<br/>async&#160;function,&#160;the&#160;code&#160;looks&#160;similar.<br/>
To&#160;figure&#160;out&#160;whether&#160;something&#160;is&#160;a&#160;directory,&#160;you&#160;can&#160;again&#160;use&#160;stat&#160;(or<br/>
statSync)&#160;and&#160;the&#160;stats&#160;object’s&#160;isDirectory&#160;method.<br/>
Exploring&#160;a&#160;directory&#160;is&#160;a&#160;branching&#160;process.&#160;You&#160;can&#160;do&#160;it&#160;either&#160;by&#160;using<br/>
a&#160;recursive&#160;function&#160;or&#160;by&#160;keeping&#160;an&#160;array&#160;of&#160;work&#160;(files&#160;that&#160;still&#160;need&#160;to&#160;be<br/>explored).&#160;To&#160;find&#160;the&#160;files&#160;in&#160;a&#160;directory,&#160;you&#160;can&#160;call&#160;readdir&#160;or&#160;readdirSync.<br/>The&#160;strange&#160;capitalization—Node’s&#160;file&#160;system&#160;function&#160;naming&#160;is&#160;loosely&#160;based<br/>on&#160;standard&#160;Unix&#160;functions,&#160;such&#160;as&#160;readdir,&#160;that&#160;are&#160;all&#160;lowercase,&#160;but&#160;then<br/>it&#160;adds&#160;Sync&#160;with&#160;a&#160;capital&#160;letter.<br/>
To&#160;go&#160;from&#160;a&#160;filename&#160;read&#160;with&#160;readdir&#160;to&#160;a&#160;full&#160;path&#160;name,&#160;you&#160;have&#160;to<br/>
combine&#160;it&#160;with&#160;the&#160;name&#160;of&#160;the&#160;directory,&#160;putting&#160;a&#160;slash&#160;character&#160;(/)&#160;between<br/>them.<br/>
<b>Directory&#160;creation</b><br/>
You&#160;can&#160;use&#160;the&#160;function&#160;that&#160;implements&#160;the&#160;DELETE&#160;method&#160;as&#160;a&#160;blueprint<br/>for&#160;the&#160;MKCOL&#160;method.&#160;When&#160;no&#160;file&#160;is&#160;found,&#160;try&#160;to&#160;create&#160;a&#160;directory&#160;with<br/>mkdir.&#160;When&#160;a&#160;directory&#160;exists&#160;at&#160;that&#160;path,&#160;you&#160;can&#160;return&#160;a&#160;204&#160;response<br/>so&#160;that&#160;directory&#160;creation&#160;requests&#160;are&#160;idempotent.&#160;If&#160;a&#160;nondirectory&#160;file&#160;exists<br/>here,&#160;return&#160;an&#160;error&#160;code.&#160;Code&#160;400&#160;(“bad&#160;request”)&#160;would&#160;be&#160;appropriate.<br/>
<b>A&#160;public&#160;space&#160;on&#160;the&#160;web</b><br/>
You&#160;can&#160;create&#160;a&#160;&lt;textarea&gt;&#160;element&#160;to&#160;hold&#160;the&#160;content&#160;of&#160;the&#160;file&#160;that&#160;is&#160;being<br/>edited.&#160;A&#160;GET&#160;request,&#160;using&#160;fetch,&#160;can&#160;retrieve&#160;the&#160;current&#160;content&#160;of&#160;the&#160;file.<br/>You&#160;can&#160;use&#160;relative&#160;URLs&#160;like&#160;<i>index.html</i>,&#160;instead&#160;of&#160;<a href="http://localhost:8000/index.html"><i>http://localhost:8000/<br/>index.html</i></a>,&#160;to&#160;refer&#160;to&#160;files&#160;on&#160;the&#160;same&#160;server&#160;as&#160;the&#160;running&#160;script.<br/>
Then,&#160;when&#160;the&#160;user&#160;clicks&#160;a&#160;button&#160;(you&#160;can&#160;use&#160;a&#160;&lt;form&gt;&#160;element&#160;and&#160;&#34;<br/>
submit&#34;&#160;event),&#160;make&#160;a&#160;PUT&#160;request&#160;to&#160;the&#160;same&#160;URL,&#160;with&#160;the&#160;content&#160;of&#160;the<br/>&lt;textarea&gt;&#160;as&#160;request&#160;body,&#160;to&#160;save&#160;the&#160;file.<br/>
You&#160;can&#160;then&#160;add&#160;a&#160;&lt;select&gt;&#160;element&#160;that&#160;contains&#160;all&#160;the&#160;files&#160;in&#160;the&#160;server’s<br/>
top&#160;directory&#160;by&#160;adding&#160;&lt;option&gt;&#160;elements&#160;containing&#160;the&#160;lines&#160;returned&#160;by&#160;a<br/>
408<br/>
<hr/>
<a name=421></a>GET&#160;request&#160;to&#160;the&#160;URL&#160;/.&#160;When&#160;the&#160;user&#160;selects&#160;another&#160;file&#160;(a&#160;&#34;change&#34;&#160;event<br/>on&#160;the&#160;field),&#160;the&#160;script&#160;must&#160;fetch&#160;and&#160;display&#160;that&#160;file.&#160;When&#160;saving&#160;a&#160;file,<br/>use&#160;the&#160;currently&#160;selected&#160;filename.<br/>
<b>Project:&#160;Skill-Sharing&#160;Website</b><br/>
<b>Disk&#160;persistence</b><br/>
The&#160;simplest&#160;solution&#160;I&#160;can&#160;come&#160;up&#160;with&#160;is&#160;to&#160;encode&#160;the&#160;whole&#160;talks&#160;object&#160;as<br/>JSON&#160;and&#160;dump&#160;it&#160;to&#160;a&#160;file&#160;with&#160;writeFile.&#160;There&#160;is&#160;already&#160;a&#160;method&#160;(updated<br/>)&#160;that&#160;is&#160;called&#160;every&#160;time&#160;the&#160;server’s&#160;data&#160;changes.&#160;It&#160;can&#160;be&#160;extended&#160;to&#160;write<br/>the&#160;new&#160;data&#160;to&#160;disk.<br/>
Pick&#160;a&#160;filename,&#160;for&#160;example&#160;./talks.json.&#160;When&#160;the&#160;server&#160;starts,&#160;it&#160;can<br/>
try&#160;to&#160;read&#160;that&#160;file&#160;with&#160;readFile,&#160;and&#160;if&#160;that&#160;succeeds,&#160;the&#160;server&#160;can&#160;use&#160;the<br/>file’s&#160;contents&#160;as&#160;its&#160;starting&#160;data.<br/>
Beware,&#160;though.&#160;The&#160;talks&#160;object&#160;started&#160;as&#160;a&#160;prototype-less&#160;object&#160;so&#160;that<br/>
the&#160;in&#160;operator&#160;could&#160;reliably&#160;be&#160;used.&#160;JSON.parse&#160;will&#160;return&#160;regular&#160;objects<br/>with&#160;Object.prototype&#160;as&#160;their&#160;prototype.&#160;If&#160;you&#160;use&#160;JSON&#160;as&#160;your&#160;file&#160;format,<br/>you’ll&#160;have&#160;to&#160;copy&#160;the&#160;properties&#160;of&#160;the&#160;object&#160;returned&#160;by&#160;JSON.parse&#160;into&#160;a<br/>new,&#160;prototype-less&#160;object.<br/>
<b>Comment&#160;field&#160;resets</b><br/>
The&#160;best&#160;way&#160;to&#160;do&#160;this&#160;is&#160;probably&#160;to&#160;make&#160;talks&#160;component&#160;objects,&#160;with&#160;a<br/>syncState&#160;method,&#160;so&#160;that&#160;they&#160;can&#160;be&#160;updated&#160;to&#160;show&#160;a&#160;modified&#160;version&#160;of<br/>the&#160;talk.&#160;During&#160;normal&#160;operation,&#160;the&#160;only&#160;way&#160;a&#160;talk&#160;can&#160;be&#160;changed&#160;is&#160;by<br/>adding&#160;more&#160;comments,&#160;so&#160;the&#160;syncState&#160;method&#160;can&#160;be&#160;relatively&#160;simple.<br/>
The&#160;difficult&#160;part&#160;is&#160;that,&#160;when&#160;a&#160;changed&#160;list&#160;of&#160;talks&#160;comes&#160;in,&#160;we&#160;have<br/>
to&#160;reconcile&#160;the&#160;existing&#160;list&#160;of&#160;DOM&#160;components&#160;with&#160;the&#160;talks&#160;on&#160;the&#160;new<br/>list—deleting&#160;components&#160;whose&#160;talk&#160;was&#160;deleted&#160;and&#160;updating&#160;components<br/>whose&#160;talk&#160;changed.<br/>
To&#160;do&#160;this,&#160;it&#160;might&#160;be&#160;helpful&#160;to&#160;keep&#160;a&#160;data&#160;structure&#160;that&#160;stores&#160;the&#160;talk<br/>
components&#160;under&#160;the&#160;talk&#160;titles&#160;so&#160;that&#160;you&#160;can&#160;easily&#160;figure&#160;out&#160;whether&#160;a<br/>component&#160;exists&#160;for&#160;a&#160;given&#160;talk.&#160;You&#160;can&#160;then&#160;loop&#160;over&#160;the&#160;new&#160;array&#160;of<br/>talks,&#160;and&#160;for&#160;each&#160;of&#160;them,&#160;either&#160;synchronize&#160;an&#160;existing&#160;component&#160;or&#160;create<br/>a&#160;new&#160;one.&#160;To&#160;delete&#160;components&#160;for&#160;deleted&#160;talks,&#160;you’ll&#160;have&#160;to&#160;also&#160;loop&#160;over<br/>the&#160;components&#160;and&#160;check&#160;whether&#160;the&#160;corresponding&#160;talks&#160;still&#160;exist.<br/>
409<br/>
<hr/>
<a name=422></a><b>Index</b><br/>
!&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17</a>,&#160;<a href="eloquent-javascripts.html#43">31</a><br/>
|&#160;|&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17</a>,&#160;<a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#62">50</a>,&#160;<a href="eloquent-javascripts.html#107">95</a>,&#160;<a href="eloquent-javascripts.html#339">327</a>,&#160;<a href="eloquent-javascripts.html#400">388</a><br/>
!=&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
{}&#160;(block),&#160;<a href="eloquent-javascripts.html#40">28</a><br/>
!==&#160;operator,&#160;<a href="eloquent-javascripts.html#31">19</a><br/>
{}&#160;(object),&#160;<a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#77">65</a><br/>
*&#160;operator,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
200&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#370">358,</a><br/>
*=&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
<a href="eloquent-javascripts.html#374">362</a><br/>
+&#160;operator,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
204&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#377">365</a><br/>
++&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
2d&#160;(canvas&#160;context),&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
+=&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34,&#160;</a><a href="eloquent-javascripts.html#211">199</a><br/>
304&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#391">379,</a><br/>
−&#160;operator,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#31">19</a><br/>
<a href="eloquent-javascripts.html#397">385</a><br/>
−−&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
400&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
−=&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
403&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
/&#160;operator,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
404&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#375">363,</a><br/>
/=&#160;operator,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
<a href="eloquent-javascripts.html#388">376,&#160;</a><a href="eloquent-javascripts.html#390">378</a><br/>
&lt;&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
405&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#325">313</a>,&#160;<a href="eloquent-javascripts.html#374">362</a><br/>
&lt;=&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
406&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
=&#160;operator,&#160;<a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#359">347</a><br/>
500&#160;(HTTP&#160;status&#160;code),&#160;<a href="eloquent-javascripts.html#374">362</a><br/>
as&#160;expression,&#160;<a href="eloquent-javascripts.html#172">160</a>,&#160;<a href="eloquent-javascripts.html#174">162<br/></a>for&#160;default&#160;value,&#160;<a href="eloquent-javascripts.html#58">46</a><br/>
a&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#245">233</a>,&#160;<a href="eloquent-javascripts.html#247">235,&#160;</a><a href="eloquent-javascripts.html#330">318,</a><br/>
in&#160;Egg,&#160;<a href="eloquent-javascripts.html#221">209</a><br/>
<a href="eloquent-javascripts.html#354">342</a><br/>
==&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#76">64,&#160;</a><a href="eloquent-javascripts.html#92">80,&#160;</a><a href="eloquent-javascripts.html#205">193</a><br/>
Abelson,&#160;Hal,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
===&#160;operator,&#160;<a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#93">81</a>,&#160;<a href="eloquent-javascripts.html#127">115</a>,&#160;<a href="eloquent-javascripts.html#403">391</a><br/>
absolute&#160;positioning,&#160;<a href="eloquent-javascripts.html#250">238</a>,&#160;<a href="eloquent-javascripts.html#254">242</a>,&#160;<a href="eloquent-javascripts.html#262">250,</a><br/>
&gt;&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
<a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#272">260</a><br/>
&gt;=&#160;operator,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
absolute&#160;value,&#160;<a href="eloquent-javascripts.html#88">76</a>,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
?:&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17</a>,&#160;<a href="eloquent-javascripts.html#32">20</a>,&#160;<a href="eloquent-javascripts.html#220">208</a><br/>
abstract&#160;data&#160;type,&#160;<a href="eloquent-javascripts.html#109">97</a><br/>
[]&#160;(array),&#160;<a href="eloquent-javascripts.html#70">58</a><br/>
abstract&#160;syntax&#160;tree,&#160;<i>see&#160;</i>syntax&#160;tree<br/>
[]&#160;(subscript),&#160;<a href="eloquent-javascripts.html#70">58</a>,&#160;<a href="eloquent-javascripts.html#71">59</a><br/>
abstraction,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#95">83,&#160;</a><a href="eloquent-javascripts.html#97">85</a>,&#160;<a href="eloquent-javascripts.html#214">202,&#160;</a><a href="eloquent-javascripts.html#239">227,</a><br/>
%&#160;operator,&#160;<a href="eloquent-javascripts.html#25">13,&#160;</a><a href="eloquent-javascripts.html#45">33,&#160;</a><a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#400">388,&#160;</a><a href="eloquent-javascripts.html#401">389</a>,<br/>
<a href="eloquent-javascripts.html#326">314,&#160;</a><a href="eloquent-javascripts.html#359">347</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
<a href="eloquent-javascripts.html#413">401</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
in&#160;Egg,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
&amp;&amp;&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#32">20</a>,&#160;<a href="eloquent-javascripts.html#107">95</a><br/>
with&#160;higher-order&#160;functions,&#160;<a href="eloquent-javascripts.html#94">82</a><br/>
abtraction<br/>
410<br/>
<hr/>
<a name=423></a>of&#160;the&#160;network,&#160;<a href="eloquent-javascripts.html#229">217</a><br/>
Apple,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
acceleration,&#160;<a href="eloquent-javascripts.html#291">279</a><br/>
application,&#160;<a href="eloquent-javascripts.html#1">1,&#160;</a><a href="eloquent-javascripts.html#342">330,&#160;</a><a href="eloquent-javascripts.html#382">370</a><br/>
Accept&#160;header,&#160;<a href="eloquent-javascripts.html#340">328</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
arc,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#303">291</a><br/>
access&#160;control,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#154">142</a>,&#160;<a href="eloquent-javascripts.html#385">373</a><br/>
arc&#160;method,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#303">291,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
Access-Control-Allow-Origin&#160;header,<br/>
argument,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#58">46,&#160;</a><a href="eloquent-javascripts.html#62">50</a>,&#160;<a href="eloquent-javascripts.html#86">74,&#160;</a><a href="eloquent-javascripts.html#166">154</a>,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
<a href="eloquent-javascripts.html#326">314</a><br/>
arguments&#160;object,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
action,&#160;<a href="eloquent-javascripts.html#343">331,&#160;</a><a href="eloquent-javascripts.html#345">333,&#160;</a><a href="eloquent-javascripts.html#346">334</a><br/>
argv&#160;property,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
activeElement&#160;property,&#160;<a href="eloquent-javascripts.html#329">317</a><br/>
arithmetic,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#31">19,&#160;</a><a href="eloquent-javascripts.html#222">210</a><br/>
actor,&#160;<a href="eloquent-javascripts.html#277">265</a>,&#160;<a href="eloquent-javascripts.html#283">271</a>,&#160;<a href="eloquent-javascripts.html#289">277</a><br/>
array,&#160;<a href="eloquent-javascripts.html#71">59</a>–<a href="eloquent-javascripts.html#74">62,&#160;</a><a href="eloquent-javascripts.html#92">80</a><br/>
add&#160;method,&#160;<a href="eloquent-javascripts.html#127">115</a><br/>
as&#160;matrix,&#160;<a href="eloquent-javascripts.html#120">108,&#160;</a><a href="eloquent-javascripts.html#276">264</a><br/>
addEntry&#160;function,&#160;<a href="eloquent-javascripts.html#76">64</a><br/>
as&#160;table,&#160;<a href="eloquent-javascripts.html#78">66</a><br/>
addEventListener&#160;method,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#256">244</a>,<br/>
counting,&#160;<a href="eloquent-javascripts.html#105">93</a><br/>
<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
creation,&#160;<a href="eloquent-javascripts.html#70">58,&#160;</a><a href="eloquent-javascripts.html#103">91</a>,&#160;<a href="eloquent-javascripts.html#345">333,&#160;</a><a href="eloquent-javascripts.html#402">390,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
addition,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#127">115</a><br/>
filtering,&#160;<a href="eloquent-javascripts.html#99">87</a><br/>
address,&#160;<a href="eloquent-javascripts.html#89">77,&#160;</a><a href="eloquent-javascripts.html#320">308</a><br/>
flattening,&#160;<a href="eloquent-javascripts.html#107">95</a><br/>
address&#160;bar,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#320">308</a>,&#160;<a href="eloquent-javascripts.html#322">310</a><br/>
in&#160;Egg,&#160;<a href="eloquent-javascripts.html#226">214</a><br/>
adoption,&#160;<a href="eloquent-javascripts.html#155">143</a><br/>
indexing,&#160;<a href="eloquent-javascripts.html#70">58</a>,&#160;<a href="eloquent-javascripts.html#80">68</a>,&#160;<a href="eloquent-javascripts.html#83">71,&#160;</a><a href="eloquent-javascripts.html#402">390,&#160;</a><a href="eloquent-javascripts.html#413">401</a><br/>
ages&#160;example,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
iteration,&#160;<a href="eloquent-javascripts.html#80">68,&#160;</a><a href="eloquent-javascripts.html#95">83,&#160;</a><a href="eloquent-javascripts.html#98">86</a><br/>
alert&#160;function,&#160;<a href="eloquent-javascripts.html#233">221</a><br/>
length&#160;of,&#160;<a href="eloquent-javascripts.html#71">59</a><br/>
alpha,&#160;<a href="eloquent-javascripts.html#356">344</a><br/>
methods,&#160;<a href="eloquent-javascripts.html#82">70,&#160;</a><a href="eloquent-javascripts.html#91">79,&#160;</a><a href="eloquent-javascripts.html#98">86–</a><a href="eloquent-javascripts.html#100">88</a>,&#160;<a href="eloquent-javascripts.html#103">91,&#160;</a><a href="eloquent-javascripts.html#106">94,</a><br/>
alphanumeric&#160;character,&#160;<a href="eloquent-javascripts.html#157">145</a><br/>
<a href="eloquent-javascripts.html#107">95</a><br/>
alt&#160;attribute,&#160;<a href="eloquent-javascripts.html#242">230</a><br/>
notation,&#160;<a href="eloquent-javascripts.html#89">77</a><br/>
alt&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
of&#160;rest&#160;arguments,&#160;<a href="eloquent-javascripts.html#86">74</a><br/>
altKey&#160;property,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
random&#160;element,&#160;<a href="eloquent-javascripts.html#135">123</a><br/>
ambiguity,&#160;<a href="eloquent-javascripts.html#227">215</a><br/>
RegExp&#160;match,&#160;<a href="eloquent-javascripts.html#159">147</a><br/>
American&#160;English,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
representation,&#160;<a href="eloquent-javascripts.html#89">77</a><br/>
ampersand&#160;character,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#323">311</a><br/>
searching,&#160;<a href="eloquent-javascripts.html#79">67,&#160;</a><a href="eloquent-javascripts.html#83">71</a><br/>
analysis,&#160;<a href="eloquent-javascripts.html#140">128</a>,&#160;<a href="eloquent-javascripts.html#145">133</a><br/>
Array&#160;constructor,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
ancestor&#160;element,&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
Array&#160;prototype,&#160;<a href="eloquent-javascripts.html#112">100</a>,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
Android,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
array-like&#160;object,&#160;<a href="eloquent-javascripts.html#239">227–</a><a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#264">252,&#160;</a><a href="eloquent-javascripts.html#330">318,</a><br/>
angle,&#160;<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#303">291,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
<a href="eloquent-javascripts.html#336">324,&#160;</a><a href="eloquent-javascripts.html#368">356</a><br/>
angle&#160;brackets,&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#232">220</a><br/>
Array.from&#160;function,&#160;<a href="eloquent-javascripts.html#207">195,&#160;</a><a href="eloquent-javascripts.html#240">228,&#160;</a><a href="eloquent-javascripts.html#365">353</a><br/>
animation,&#160;<a href="eloquent-javascripts.html#251">239</a>,&#160;<a href="eloquent-javascripts.html#265">253</a>,&#160;<a href="eloquent-javascripts.html#272">260</a>,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#279">267</a>,<br/>
arrays&#160;in&#160;egg&#160;(exercise),&#160;<a href="eloquent-javascripts.html#226">214,&#160;</a><a href="eloquent-javascripts.html#411">399</a><br/>
<a href="eloquent-javascripts.html#316">304</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
arrow&#160;function,&#160;<a href="eloquent-javascripts.html#56">44,&#160;</a><a href="eloquent-javascripts.html#111">99</a>,&#160;<a href="eloquent-javascripts.html#211">199</a><br/>
bouncing&#160;ball,&#160;<a href="eloquent-javascripts.html#318">306</a><br/>
arrow&#160;key,&#160;<a href="eloquent-javascripts.html#271">259</a><br/>
platform&#160;game,&#160;<a href="eloquent-javascripts.html#286">274</a>,&#160;<a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#291">279–</a><br/>
artificial&#160;intelligence,&#160;<a href="eloquent-javascripts.html#129">117</a>,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
<a href="eloquent-javascripts.html#293">281</a>,&#160;<a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#314">302</a>,&#160;<a href="eloquent-javascripts.html#414">402</a><br/>
artificial&#160;life,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#341">329</a><br/>
spinning&#160;cat,&#160;<a href="eloquent-javascripts.html#250">238</a>,&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
assert&#160;function,&#160;<a href="eloquent-javascripts.html#152">140</a><br/>
anyStorage&#160;function,&#160;<a href="eloquent-javascripts.html#211">199</a>,&#160;<a href="eloquent-javascripts.html#213">201</a><br/>
assertion,&#160;<a href="eloquent-javascripts.html#152">140</a><br/>
appendChild&#160;method,&#160;<a href="eloquent-javascripts.html#241">229</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
411<br/>
<hr/>
<a name=424></a>assignment,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#46">34,&#160;</a><a href="eloquent-javascripts.html#172">160,&#160;</a><a href="eloquent-javascripts.html#174">162,&#160;</a><a href="eloquent-javascripts.html#227">215</a>,<br/>
bean&#160;counting&#160;(exercise),&#160;<a href="eloquent-javascripts.html#68">56,&#160;</a><a href="eloquent-javascripts.html#402">390</a><br/>
<a href="eloquent-javascripts.html#411">399</a><br/>
beforeunload&#160;event,&#160;<a href="eloquent-javascripts.html#267">255</a><br/>
assumption,&#160;<a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#153">141</a><br/>
behavior,&#160;<a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
asterisk,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#158">146</a><br/>
benchmark,&#160;<a href="eloquent-javascripts.html#246">234</a><br/>
async&#160;function,&#160;<a href="eloquent-javascripts.html#207">195</a>,&#160;<a href="eloquent-javascripts.html#208">196,&#160;</a><a href="eloquent-javascripts.html#211">199</a>,&#160;<a href="eloquent-javascripts.html#213">201</a>,<br/>
Berners-Lee,&#160;Tim,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
<a href="eloquent-javascripts.html#397">385</a><br/>
best&#160;practices,&#160;<a href="eloquent-javascripts.html#15">3</a><br/>
asynchronous&#160;programming,&#160;<a href="eloquent-javascripts.html#192">180,&#160;</a><a href="eloquent-javascripts.html#193">181</a>,<br/>
bezierCurveTo&#160;method,&#160;<a href="eloquent-javascripts.html#301">289</a><br/>
<a href="eloquent-javascripts.html#195">183</a>–<a href="eloquent-javascripts.html#197">185</a>,&#160;<a href="eloquent-javascripts.html#207">195</a>,&#160;<a href="eloquent-javascripts.html#209">197,&#160;</a><a href="eloquent-javascripts.html#211">199,&#160;</a><a href="eloquent-javascripts.html#294">282</a><br/>
big&#160;ball&#160;of&#160;mud,&#160;<a href="eloquent-javascripts.html#179">167</a><br/>
in&#160;Node.js,&#160;<a href="eloquent-javascripts.html#362">350,&#160;</a><a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#376">364</a>,<br/>
binary&#160;data,&#160;<a href="eloquent-javascripts.html#15">3</a>,&#160;<a href="eloquent-javascripts.html#22">10</a>,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
<a href="eloquent-javascripts.html#379">367</a><br/>
binary&#160;number,&#160;<a href="eloquent-javascripts.html#22">10</a>,&#160;<a href="eloquent-javascripts.html#23">11,&#160;</a><a href="eloquent-javascripts.html#78">66</a>,&#160;<a href="eloquent-javascripts.html#144">132,&#160;</a><a href="eloquent-javascripts.html#164">152,</a><br/>
reading&#160;files,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
<a href="eloquent-javascripts.html#335">323</a><br/>
at&#160;sign,&#160;<a href="eloquent-javascripts.html#275">263</a><br/>
binary&#160;operator,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#34">22</a><br/>
attribute,&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#244">232</a>,&#160;<a href="eloquent-javascripts.html#330">318</a>,&#160;<a href="eloquent-javascripts.html#346">334</a>,<br/>
binding,&#160;<a href="eloquent-javascripts.html#16">4</a>,&#160;<a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#74">62</a><br/>
<a href="eloquent-javascripts.html#417">405</a><br/>
as<br/>
autofocus&#160;attribute,&#160;<a href="eloquent-javascripts.html#329">317</a><br/>
state,&#160;<a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#44">32</a><br/>
automatic&#160;semicolon&#160;insertion,&#160;<a href="eloquent-javascripts.html#35">23</a><br/>
as&#160;state,&#160;<a href="eloquent-javascripts.html#76">64,&#160;</a><a href="eloquent-javascripts.html#172">160,&#160;</a><a href="eloquent-javascripts.html#337">325</a><br/>
automation,&#160;<a href="eloquent-javascripts.html#138">126</a>,&#160;<a href="eloquent-javascripts.html#143">131</a><br/>
assignment,&#160;<a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#54">42</a><br/>
automaton,&#160;<a href="eloquent-javascripts.html#129">117</a><br/>
compilation&#160;of,&#160;<a href="eloquent-javascripts.html#411">399</a><br/>
avatar,&#160;<a href="eloquent-javascripts.html#274">262</a><br/>
definition,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#54">42,&#160;</a><a href="eloquent-javascripts.html#224">212,&#160;</a><a href="eloquent-javascripts.html#227">215</a><br/>
average&#160;function,&#160;<a href="eloquent-javascripts.html#102">90</a><br/>
destructuring,&#160;<a href="eloquent-javascripts.html#89">77</a><br/>
await&#160;keyword,&#160;<a href="eloquent-javascripts.html#207">195</a>–<a href="eloquent-javascripts.html#209">197</a>,&#160;<a href="eloquent-javascripts.html#212">200</a><br/>
exported,&#160;<a href="eloquent-javascripts.html#186">174</a><br/>
axis,&#160;<a href="eloquent-javascripts.html#290">278</a>,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#307">295,&#160;</a><a href="eloquent-javascripts.html#308">296,&#160;</a><a href="eloquent-javascripts.html#419">407</a><br/>
from&#160;parameter,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#60">48<br/></a>global,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#141">129</a>,&#160;<a href="eloquent-javascripts.html#295">283</a>,&#160;<a href="eloquent-javascripts.html#363">351</a>,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
Babbage,&#160;Charles,&#160;<a href="eloquent-javascripts.html#69">57</a><br/>
in&#160;Egg,&#160;<a href="eloquent-javascripts.html#221">209,&#160;</a><a href="eloquent-javascripts.html#222">210</a><br/>
background,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#282">270</a>,&#160;<a href="eloquent-javascripts.html#287">275</a><br/>
local,&#160;<a href="eloquent-javascripts.html#52">40</a><br/>
background&#160;(CSS),&#160;<a href="eloquent-javascripts.html#272">260</a>,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#283">271</a><br/>
model&#160;of,&#160;<a href="eloquent-javascripts.html#36">24</a>,&#160;<a href="eloquent-javascripts.html#74">62,&#160;</a><a href="eloquent-javascripts.html#76">64</a><br/>
backslash&#160;character<br/>
naming,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#47">35</a>,&#160;<a href="eloquent-javascripts.html#64">52,&#160;</a><a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#142">130</a><br/>
as&#160;path&#160;separator,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
scope&#160;of,&#160;<a href="eloquent-javascripts.html#52">40</a><br/>
in&#160;regular&#160;expressions,&#160;<a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#157">145</a>,<br/>
undefined,&#160;<a href="eloquent-javascripts.html#150">138</a><br/>
<a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
visibility,&#160;<a href="eloquent-javascripts.html#53">41</a><br/>
in&#160;strings,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#232">220</a><br/>
bit,&#160;<a href="eloquent-javascripts.html#15">3,&#160;</a><a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#78">66</a><br/>
backtick,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#27">15</a><br/>
bitfield,&#160;<a href="eloquent-javascripts.html#263">251</a><br/>
backtracking,&#160;<a href="eloquent-javascripts.html#164">152,&#160;</a><a href="eloquent-javascripts.html#168">156</a><br/>
bitmap&#160;graphics,&#160;<a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#319">307</a><br/>
ball,&#160;<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
black,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
balloon,&#160;<a href="eloquent-javascripts.html#271">259</a><br/>
block,&#160;<a href="eloquent-javascripts.html#40">28,&#160;</a><a href="eloquent-javascripts.html#44">32</a>,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#53">41,&#160;</a><a href="eloquent-javascripts.html#56">44,&#160;</a><a href="eloquent-javascripts.html#73">61</a>,&#160;<a href="eloquent-javascripts.html#148">136,</a><br/>
balloon&#160;(exercise),&#160;<a href="eloquent-javascripts.html#271">259,&#160;</a><a href="eloquent-javascripts.html#412">400</a><br/>
<a href="eloquent-javascripts.html#149">137,&#160;</a><a href="eloquent-javascripts.html#215">203</a><br/>
banking&#160;example,&#160;<a href="eloquent-javascripts.html#148">136</a><br/>
block&#160;comment,&#160;<a href="eloquent-javascripts.html#48">36</a>,&#160;<a href="eloquent-javascripts.html#168">156</a><br/>
Banks,&#160;Ian,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
block&#160;element,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#247">235</a><br/>
baseControls&#160;constant,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
blocking,&#160;<a href="eloquent-javascripts.html#193">181</a>,&#160;<a href="eloquent-javascripts.html#251">239</a>,&#160;<a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#369">357</a><br/>
baseTools&#160;constant,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
blue,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
412<br/>
<hr/>
<a name=425></a>blur&#160;event,&#160;<a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#267">255</a><br/>
window,&#160;<a href="eloquent-javascripts.html#255">243</a><br/>
blur&#160;method,&#160;<a href="eloquent-javascripts.html#329">317</a><br/>
browser&#160;wars,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
body&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
browsers,&#160;<a href="eloquent-javascripts.html#20">8</a>,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
body&#160;(HTTP),&#160;<a href="eloquent-javascripts.html#322">310</a>–<a href="eloquent-javascripts.html#325">313</a>,&#160;<a href="eloquent-javascripts.html#370">358</a>,&#160;<a href="eloquent-javascripts.html#376">364</a>,<br/>
bubbling,&#160;<i>see&#160;</i>event&#160;propagation<br/>
<a href="eloquent-javascripts.html#378">366</a>,&#160;<a href="eloquent-javascripts.html#389">377</a><br/>
Buffer&#160;class,&#160;<a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#372">360</a><br/>
body&#160;property,&#160;<a href="eloquent-javascripts.html#237">225,&#160;</a><a href="eloquent-javascripts.html#238">226,&#160;</a><a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#325">313</a><br/>
bug,&#160;<a href="eloquent-javascripts.html#94">82,&#160;</a><a href="eloquent-javascripts.html#140">128</a>,&#160;<a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#168">156</a>,&#160;<a href="eloquent-javascripts.html#171">159</a>,&#160;<a href="eloquent-javascripts.html#177">165,&#160;</a><a href="eloquent-javascripts.html#180">168,</a><br/>
bold,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
<a href="eloquent-javascripts.html#235">223</a><br/>
Book&#160;of&#160;Programming,&#160;<a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#179">167</a>,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
building&#160;Promise.all&#160;(exercise),&#160;<a href="eloquent-javascripts.html#213">201,</a><br/>
Boolean,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#40">28,&#160;</a><a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#75">63,&#160;</a><a href="eloquent-javascripts.html#156">144</a>,&#160;<a href="eloquent-javascripts.html#220">208,&#160;</a><a href="eloquent-javascripts.html#222">210</a><br/>
<a href="eloquent-javascripts.html#410">398</a><br/>
conversion&#160;to,&#160;<a href="eloquent-javascripts.html#31">19,&#160;</a><a href="eloquent-javascripts.html#32">20</a>,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#43">31</a><br/>
bundler,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
Boolean&#160;function,&#160;<a href="eloquent-javascripts.html#39">27</a><br/>
button,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#330">318</a>,&#160;<a href="eloquent-javascripts.html#341">329</a><br/>
border&#160;(CSS),&#160;<a href="eloquent-javascripts.html#245">233</a>,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
button&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#233">221</a>,&#160;<a href="eloquent-javascripts.html#256">244,&#160;</a><a href="eloquent-javascripts.html#260">248,</a><br/>
border-radius&#160;(CSS),&#160;<a href="eloquent-javascripts.html#262">250</a><br/>
<a href="eloquent-javascripts.html#272">260,&#160;</a><a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#338">326</a>,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#346">334</a><br/>
bouncing,&#160;<a href="eloquent-javascripts.html#275">263,&#160;</a><a href="eloquent-javascripts.html#278">266,&#160;</a><a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#290">278</a>,&#160;<a href="eloquent-javascripts.html#318">306</a><br/>
button&#160;property,&#160;<a href="eloquent-javascripts.html#257">245,&#160;</a><a href="eloquent-javascripts.html#263">251</a>,&#160;<a href="eloquent-javascripts.html#347">335</a><br/>
bound,&#160;<a href="eloquent-javascripts.html#99">87</a><br/>
buttons&#160;property,&#160;<a href="eloquent-javascripts.html#263">251</a>,&#160;<a href="eloquent-javascripts.html#347">335</a><br/>
boundary,&#160;<a href="eloquent-javascripts.html#162">150–</a><a href="eloquent-javascripts.html#164">152,&#160;</a><a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#173">161,&#160;</a><a href="eloquent-javascripts.html#177">165</a>,<br/>
<a href="eloquent-javascripts.html#312">300</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
cache,&#160;<a href="eloquent-javascripts.html#184">172,&#160;</a><a href="eloquent-javascripts.html#195">183</a><br/>
box,&#160;<a href="eloquent-javascripts.html#154">142</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#273">261</a>,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
call&#160;method,&#160;<a href="eloquent-javascripts.html#110">98</a>,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
box&#160;shadow&#160;(CSS),&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
call&#160;stack,&#160;<a href="eloquent-javascripts.html#57">45,&#160;</a><a href="eloquent-javascripts.html#59">47,&#160;</a><a href="eloquent-javascripts.html#63">51</a>,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#148">136,</a><br/>
br&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#349">337</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
<a href="eloquent-javascripts.html#150">138,&#160;</a><a href="eloquent-javascripts.html#210">198</a><br/>
braces<br/>
callback&#160;function,&#160;<a href="eloquent-javascripts.html#193">181</a>,&#160;<a href="eloquent-javascripts.html#195">183,&#160;</a><a href="eloquent-javascripts.html#197">185</a>,&#160;<a href="eloquent-javascripts.html#198">186,</a><br/>
block,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#401">389</a><br/>
<a href="eloquent-javascripts.html#200">188,&#160;</a><a href="eloquent-javascripts.html#202">190,&#160;</a><a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#292">280,&#160;</a><a href="eloquent-javascripts.html#293">281,&#160;</a><a href="eloquent-javascripts.html#346">334,</a><br/>
body,&#160;<a href="eloquent-javascripts.html#96">84</a><br/>
<a href="eloquent-javascripts.html#367">355,&#160;</a><a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#391">379</a>,&#160;<a href="eloquent-javascripts.html#397">385</a><br/>
class,&#160;<a href="eloquent-javascripts.html#114">102</a><br/>
camel&#160;case,&#160;<a href="eloquent-javascripts.html#47">35</a>,&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
function&#160;body,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#56">44</a><br/>
cancelAnimationFrame&#160;function,&#160;<a href="eloquent-javascripts.html#269">257</a><br/>
in&#160;regular&#160;expression,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
canvas,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#296">284</a>,&#160;<a href="eloquent-javascripts.html#298">286–</a><a href="eloquent-javascripts.html#301">289</a>,&#160;<a href="eloquent-javascripts.html#304">292–</a><a href="eloquent-javascripts.html#311">299,</a><br/>
object,&#160;<a href="eloquent-javascripts.html#73">61</a>,&#160;<a href="eloquent-javascripts.html#77">65,&#160;</a><a href="eloquent-javascripts.html#89">77</a><br/>
<a href="eloquent-javascripts.html#315">303–</a><a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
branching,&#160;<a href="eloquent-javascripts.html#162">150,&#160;</a><a href="eloquent-javascripts.html#164">152</a><br/>
context,&#160;<a href="eloquent-javascripts.html#297">285,&#160;</a><a href="eloquent-javascripts.html#298">286</a><br/>
branching&#160;recursion,&#160;<a href="eloquent-javascripts.html#61">49,&#160;</a><a href="eloquent-javascripts.html#309">297</a><br/>
path,&#160;<a href="eloquent-javascripts.html#299">287</a><br/>
break&#160;keyword,&#160;<a href="eloquent-javascripts.html#45">33</a>,&#160;<a href="eloquent-javascripts.html#47">35</a><br/>
size,&#160;<a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#299">287</a><br/>
breakpoint,&#160;<a href="eloquent-javascripts.html#145">133</a><br/>
canvas&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#346">334,</a><br/>
British&#160;English,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
<a href="eloquent-javascripts.html#354">342,&#160;</a><a href="eloquent-javascripts.html#356">344</a>,&#160;<a href="eloquent-javascripts.html#360">348</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
broadcastConnections&#160;function,&#160;<a href="eloquent-javascripts.html#204">192</a><br/>
CanvasDisplay&#160;class,&#160;<a href="eloquent-javascripts.html#311">299,&#160;</a><a href="eloquent-javascripts.html#312">300</a>,&#160;<a href="eloquent-javascripts.html#314">302</a><br/>
browser,&#160;<a href="eloquent-javascripts.html#1">1</a>,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#193">181</a>,&#160;<a href="eloquent-javascripts.html#228">216,&#160;</a><a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#232">220</a>,<br/>
capitalization,&#160;<a href="eloquent-javascripts.html#47">35,&#160;</a><a href="eloquent-javascripts.html#114">102</a>,&#160;<a href="eloquent-javascripts.html#159">147,&#160;</a><a href="eloquent-javascripts.html#248">236</a>,&#160;<a href="eloquent-javascripts.html#254">242,</a><br/>
<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#235">223</a>,&#160;<a href="eloquent-javascripts.html#256">244</a>,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#319">307</a>,&#160;<a href="eloquent-javascripts.html#320">308</a>,<br/>
<a href="eloquent-javascripts.html#372">360</a><br/>
<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#337">325</a>,&#160;<a href="eloquent-javascripts.html#355">343</a>,&#160;<a href="eloquent-javascripts.html#359">347</a>,<br/>
capture&#160;group,&#160;<a href="eloquent-javascripts.html#160">148</a>,&#160;<a href="eloquent-javascripts.html#161">149</a>,&#160;<a href="eloquent-javascripts.html#166">154</a>,&#160;<a href="eloquent-javascripts.html#387">375</a><br/>
<a href="eloquent-javascripts.html#381">369</a><br/>
career,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
environment,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#320">308</a><br/>
caret&#160;character,&#160;<a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#162">150</a>,&#160;<a href="eloquent-javascripts.html#173">161</a>,&#160;<a href="eloquent-javascripts.html#367">355</a><br/>
security,&#160;<a href="eloquent-javascripts.html#325">313,&#160;</a><a href="eloquent-javascripts.html#382">370</a><br/>
carriage&#160;return,&#160;<a href="eloquent-javascripts.html#173">161</a><br/>
storage,&#160;<a href="eloquent-javascripts.html#337">325</a>,&#160;<a href="eloquent-javascripts.html#339">327</a><br/>
cascading,&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
413<br/>
<hr/>
<a name=426></a>Cascading&#160;Style&#160;Sheets,&#160;<i>see&#160;</i>CSS<br/>
class,&#160;<a href="eloquent-javascripts.html#113">101</a>,&#160;<a href="eloquent-javascripts.html#114">102</a>,&#160;<a href="eloquent-javascripts.html#127">115</a>,&#160;<a href="eloquent-javascripts.html#131">119,&#160;</a><a href="eloquent-javascripts.html#275">263,&#160;</a><a href="eloquent-javascripts.html#343">331</a><br/>
case&#160;conversion,&#160;<a href="eloquent-javascripts.html#72">60</a><br/>
class&#160;attribute,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#244">232,&#160;</a><a href="eloquent-javascripts.html#249">237,&#160;</a><a href="eloquent-javascripts.html#281">269,</a><br/>
case&#160;keyword,&#160;<a href="eloquent-javascripts.html#47">35</a><br/>
<a href="eloquent-javascripts.html#283">271,&#160;</a><a href="eloquent-javascripts.html#284">272</a><br/>
case&#160;sensitivity,&#160;<a href="eloquent-javascripts.html#159">147,&#160;</a><a href="eloquent-javascripts.html#408">396</a><br/>
class&#160;declaration,&#160;<a href="eloquent-javascripts.html#114">102</a><br/>
casual&#160;computing,&#160;<a href="eloquent-javascripts.html#1">1</a><br/>
properties,&#160;<a href="eloquent-javascripts.html#115">103</a><br/>
cat’s&#160;hat&#160;(exercise),&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
class&#160;hierarchy,&#160;<a href="eloquent-javascripts.html#125">113</a><br/>
catch&#160;keyword,&#160;<a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#148">136,&#160;</a><a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#154">142</a>,<br/>
className&#160;property,&#160;<a href="eloquent-javascripts.html#244">232</a><br/>
<a href="eloquent-javascripts.html#210">198</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
cleaning&#160;up,&#160;<a href="eloquent-javascripts.html#148">136</a><br/>
catch&#160;method,&#160;<a href="eloquent-javascripts.html#199">187</a><br/>
clearing,&#160;<a href="eloquent-javascripts.html#296">284</a>,&#160;<a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#312">300,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
CD,&#160;<a href="eloquent-javascripts.html#22">10</a><br/>
clearInterval&#160;function,&#160;<a href="eloquent-javascripts.html#269">257</a><br/>
celery,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
clearRect&#160;method,&#160;<a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
cell,&#160;<a href="eloquent-javascripts.html#341">329</a><br/>
clearTimeout&#160;function,&#160;<a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#270">258</a><br/>
Celsius,&#160;<a href="eloquent-javascripts.html#124">112</a><br/>
click&#160;event,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#256">244,&#160;</a><a href="eloquent-javascripts.html#258">246,&#160;</a><a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#264">252,</a><br/>
center,&#160;<a href="eloquent-javascripts.html#285">273</a><br/>
<a href="eloquent-javascripts.html#346">334,&#160;</a><a href="eloquent-javascripts.html#417">405</a><br/>
centering,&#160;<a href="eloquent-javascripts.html#251">239</a><br/>
client,&#160;<a href="eloquent-javascripts.html#229">217,&#160;</a><a href="eloquent-javascripts.html#326">314,&#160;</a><a href="eloquent-javascripts.html#370">358</a>,&#160;<a href="eloquent-javascripts.html#381">369</a>,&#160;<a href="eloquent-javascripts.html#392">380</a>,&#160;<a href="eloquent-javascripts.html#393">381</a><br/>
certificate,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
clientHeight&#160;property,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
change&#160;event,&#160;<a href="eloquent-javascripts.html#329">317</a>,&#160;<a href="eloquent-javascripts.html#333">321</a>,&#160;<a href="eloquent-javascripts.html#350">338,&#160;</a><a href="eloquent-javascripts.html#417">405,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
clientWidth&#160;property,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
character,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#104">92</a>,&#160;<a href="eloquent-javascripts.html#105">93</a>,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
clientX&#160;property,&#160;<a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#264">252</a>,&#160;<a href="eloquent-javascripts.html#348">336</a>,&#160;<a href="eloquent-javascripts.html#349">337</a><br/>
character&#160;category,&#160;<a href="eloquent-javascripts.html#175">163</a><br/>
clientY&#160;property,&#160;<a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#264">252</a>,&#160;<a href="eloquent-javascripts.html#348">336</a>,&#160;<a href="eloquent-javascripts.html#349">337</a><br/>
character&#160;encoding,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
clipboard,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
characterCount&#160;function,&#160;<a href="eloquent-javascripts.html#101">89</a><br/>
clipping,&#160;<a href="eloquent-javascripts.html#312">300</a><br/>
characterScript&#160;function,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#108">96</a>,&#160;<a href="eloquent-javascripts.html#404">392</a><br/>
closePath&#160;method,&#160;<a href="eloquent-javascripts.html#300">288</a><br/>
charCodeAt&#160;method,&#160;<a href="eloquent-javascripts.html#104">92</a><br/>
closing&#160;tag,&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#233">221</a><br/>
checkbox,&#160;<a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#333">321</a>,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
closure,&#160;<a href="eloquent-javascripts.html#60">48</a>,&#160;<a href="eloquent-javascripts.html#226">214,&#160;</a><a href="eloquent-javascripts.html#411">399,&#160;</a><a href="eloquent-javascripts.html#412">400,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
checked&#160;attribute,&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#333">321</a><br/>
closure&#160;in&#160;egg&#160;(exercise),&#160;<a href="eloquent-javascripts.html#226">214</a>,&#160;<a href="eloquent-javascripts.html#411">399</a><br/>
chess&#160;board&#160;(exercise),&#160;<a href="eloquent-javascripts.html#401">389</a><br/>
code,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#167">155</a>,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
chessboard&#160;(exercise),&#160;<a href="eloquent-javascripts.html#50">38</a><br/>
structure&#160;of,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#43">31</a>,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#179">167</a>,&#160;<a href="eloquent-javascripts.html#188">176</a><br/>
chicks&#160;function,&#160;<a href="eloquent-javascripts.html#211">199,&#160;</a><a href="eloquent-javascripts.html#212">200</a><br/>
code&#160;golf,&#160;<a href="eloquent-javascripts.html#177">165</a><br/>
child&#160;node,&#160;<a href="eloquent-javascripts.html#238">226,&#160;</a><a href="eloquent-javascripts.html#239">227,&#160;</a><a href="eloquent-javascripts.html#241">229</a><br/>
code&#160;unit,&#160;<a href="eloquent-javascripts.html#104">92</a><br/>
childNodes&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#243">231</a>,<br/>
codePointAt&#160;method,&#160;<a href="eloquent-javascripts.html#104">92</a><br/>
<a href="eloquent-javascripts.html#413">401</a><br/>
coin,&#160;<a href="eloquent-javascripts.html#273">261,&#160;</a><a href="eloquent-javascripts.html#275">263,&#160;</a><a href="eloquent-javascripts.html#290">278,&#160;</a><a href="eloquent-javascripts.html#315">303</a><br/>
children&#160;property,&#160;<a href="eloquent-javascripts.html#240">228</a><br/>
Coin&#160;class,&#160;<a href="eloquent-javascripts.html#279">267</a>,&#160;<a href="eloquent-javascripts.html#290">278</a><br/>
Chinese&#160;characters,&#160;<a href="eloquent-javascripts.html#104">92</a>,&#160;<a href="eloquent-javascripts.html#106">94</a><br/>
collaboration,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
choice,&#160;<a href="eloquent-javascripts.html#162">150</a><br/>
collection,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#70">58,&#160;</a><a href="eloquent-javascripts.html#72">60</a>,&#160;<a href="eloquent-javascripts.html#74">62,&#160;</a><a href="eloquent-javascripts.html#92">80</a><br/>
Chrome,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
collision&#160;detection,&#160;<a href="eloquent-javascripts.html#286">274</a>,&#160;<a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#290">278</a>,&#160;<a href="eloquent-javascripts.html#291">279,</a><br/>
circle,&#160;<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#303">291</a><br/>
<a href="eloquent-javascripts.html#414">402,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
circle&#160;(SVG&#160;tag),&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
colon&#160;character,&#160;<a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#46">34</a>,&#160;<a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#247">235</a><br/>
circles&#160;(exercise),&#160;<a href="eloquent-javascripts.html#361">349,&#160;</a><a href="eloquent-javascripts.html#418">406</a><br/>
color,&#160;<a href="eloquent-javascripts.html#297">285,&#160;</a><a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#312">300</a>,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#356">344</a><br/>
circular&#160;dependency,&#160;<a href="eloquent-javascripts.html#191">179</a>,&#160;<a href="eloquent-javascripts.html#409">397</a><br/>
color&#160;(CSS),&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
circus,&#160;<a href="eloquent-javascripts.html#82">70</a><br/>
color&#160;code,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
414<br/>
<hr/>
<a name=427></a>color&#160;component,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
conditional&#160;request,&#160;<a href="eloquent-javascripts.html#384">372</a><br/>
color&#160;field,&#160;<a href="eloquent-javascripts.html#343">331</a>,&#160;<a href="eloquent-javascripts.html#345">333</a>,&#160;<a href="eloquent-javascripts.html#350">338</a><br/>
configuration,&#160;<a href="eloquent-javascripts.html#172">160</a><br/>
color&#160;picker,&#160;<a href="eloquent-javascripts.html#343">331,&#160;</a><a href="eloquent-javascripts.html#350">338,&#160;</a><a href="eloquent-javascripts.html#353">341</a><br/>
connected&#160;graph,&#160;<a href="eloquent-javascripts.html#138">126</a><br/>
color&#160;property,&#160;<a href="eloquent-javascripts.html#344">332</a><br/>
connection,&#160;<a href="eloquent-javascripts.html#229">217,&#160;</a><a href="eloquent-javascripts.html#320">308,&#160;</a><a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#382">370</a>,&#160;<a href="eloquent-javascripts.html#383">371</a><br/>
ColorSelect&#160;class,&#160;<a href="eloquent-javascripts.html#351">339</a><br/>
connections&#160;binding,&#160;<a href="eloquent-javascripts.html#204">192</a><br/>
comma&#160;character,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
consistency,&#160;<a href="eloquent-javascripts.html#48">36</a>,&#160;<a href="eloquent-javascripts.html#228">216,&#160;</a><a href="eloquent-javascripts.html#238">226</a><br/>
command&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
console.log,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#21">9</a>,&#160;<a href="eloquent-javascripts.html#27">15</a>,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#57">45</a>,&#160;<a href="eloquent-javascripts.html#59">47,&#160;</a><a href="eloquent-javascripts.html#66">54,</a><br/>
command&#160;line,&#160;<a href="eloquent-javascripts.html#181">169</a>,&#160;<a href="eloquent-javascripts.html#362">350</a>–<a href="eloquent-javascripts.html#364">352</a>,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
<a href="eloquent-javascripts.html#145">133,&#160;</a><a href="eloquent-javascripts.html#363">351</a>,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
comment,&#160;<a href="eloquent-javascripts.html#48">36</a>,&#160;<a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#167">155,&#160;</a><a href="eloquent-javascripts.html#172">160</a>,&#160;<a href="eloquent-javascripts.html#227">215,&#160;</a><a href="eloquent-javascripts.html#238">226</a>,<br/>
const&#160;keyword,&#160;<a href="eloquent-javascripts.html#37">25,&#160;</a><a href="eloquent-javascripts.html#53">41</a>,&#160;<a href="eloquent-javascripts.html#76">64</a>,&#160;<a href="eloquent-javascripts.html#87">75,&#160;</a><a href="eloquent-javascripts.html#89">77</a><br/>
<a href="eloquent-javascripts.html#381">369</a>,&#160;<a href="eloquent-javascripts.html#384">372</a>,&#160;<a href="eloquent-javascripts.html#390">378</a>,&#160;<a href="eloquent-javascripts.html#395">383</a><br/>
constant,&#160;<a href="eloquent-javascripts.html#37">25,&#160;</a><a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#291">279</a><br/>
comment&#160;field&#160;reset&#160;(exercise),&#160;<a href="eloquent-javascripts.html#399">387</a>,<br/>
constructor,&#160;<a href="eloquent-javascripts.html#47">35,&#160;</a><a href="eloquent-javascripts.html#113">101,&#160;</a><a href="eloquent-javascripts.html#114">102</a>,&#160;<a href="eloquent-javascripts.html#125">113</a>,&#160;<a href="eloquent-javascripts.html#139">127,</a><br/>
<a href="eloquent-javascripts.html#421">409</a><br/>
<a href="eloquent-javascripts.html#141">129,&#160;</a><a href="eloquent-javascripts.html#148">136</a>,&#160;<a href="eloquent-javascripts.html#160">148</a>,&#160;<a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#405">393,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
COMMENT_NODE&#160;code,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
content&#160;negotiation&#160;(exercise),&#160;<a href="eloquent-javascripts.html#340">328,</a><br/>
comments&#160;in&#160;egg&#160;(exercise),&#160;<a href="eloquent-javascripts.html#227">215</a>,&#160;<a href="eloquent-javascripts.html#411">399</a><br/>
<a href="eloquent-javascripts.html#416">404</a><br/>
CommonJS,&#160;<a href="eloquent-javascripts.html#364">352</a>,&#160;<a href="eloquent-javascripts.html#365">353</a><br/>
Content-Length&#160;header,&#160;<a href="eloquent-javascripts.html#322">310</a><br/>
CommonJS&#160;module,&#160;<a href="eloquent-javascripts.html#191">179</a>,&#160;<a href="eloquent-javascripts.html#409">397</a><br/>
Content-Type&#160;header,&#160;<a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#374">362,</a><br/>
CommonJS&#160;modules,&#160;<a href="eloquent-javascripts.html#183">171–</a><a href="eloquent-javascripts.html#185">173</a>,&#160;<a href="eloquent-javascripts.html#191">179</a><br/>
<a href="eloquent-javascripts.html#375">363,&#160;</a><a href="eloquent-javascripts.html#379">367</a><br/>
communication,&#160;<a href="eloquent-javascripts.html#228">216</a>,&#160;<a href="eloquent-javascripts.html#326">314</a><br/>
context,&#160;<a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#298">286</a><br/>
community,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
context&#160;menu,&#160;<a href="eloquent-javascripts.html#259">247</a><br/>
compareRobots&#160;function,&#160;<a href="eloquent-javascripts.html#138">126</a><br/>
continuation,&#160;<a href="eloquent-javascripts.html#195">183</a><br/>
comparison,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#222">210</a>,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
continue&#160;keyword,&#160;<a href="eloquent-javascripts.html#45">33</a><br/>
deep,&#160;<a href="eloquent-javascripts.html#92">80</a>,&#160;<a href="eloquent-javascripts.html#403">391</a><br/>
control,&#160;<a href="eloquent-javascripts.html#349">337</a>,&#160;<a href="eloquent-javascripts.html#351">339,&#160;</a><a href="eloquent-javascripts.html#354">342,&#160;</a><a href="eloquent-javascripts.html#355">343,&#160;</a><a href="eloquent-javascripts.html#358">346</a><br/>
of&#160;NaN,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
control&#160;flow,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#97">85</a><br/>
of&#160;numbers,&#160;<a href="eloquent-javascripts.html#28">16</a>,&#160;<a href="eloquent-javascripts.html#39">27</a><br/>
asynchronous,&#160;<a href="eloquent-javascripts.html#193">181,&#160;</a><a href="eloquent-javascripts.html#208">196</a><br/>
of&#160;objects,&#160;<a href="eloquent-javascripts.html#76">64</a><br/>
conditional,&#160;<a href="eloquent-javascripts.html#40">28</a><br/>
of&#160;strings,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
exceptions,&#160;<a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#148">136</a><br/>
of&#160;undefined&#160;values,&#160;<a href="eloquent-javascripts.html#31">19</a><br/>
functions,&#160;<a href="eloquent-javascripts.html#57">45</a><br/>
compatibility,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#228">216</a>,&#160;<a href="eloquent-javascripts.html#235">223,&#160;</a><a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#367">355</a><br/>
loop,&#160;<a href="eloquent-javascripts.html#42">30–</a><a href="eloquent-javascripts.html#44">32</a><br/>
compilation,&#160;<a href="eloquent-javascripts.html#187">175</a>,&#160;<a href="eloquent-javascripts.html#224">212</a>,&#160;<a href="eloquent-javascripts.html#225">213,&#160;</a><a href="eloquent-javascripts.html#411">399</a><br/>
control&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
complexity,&#160;<a href="eloquent-javascripts.html#14">2,&#160;</a><a href="eloquent-javascripts.html#15">3</a>,&#160;<a href="eloquent-javascripts.html#94">82,&#160;</a><a href="eloquent-javascripts.html#125">113,&#160;</a><a href="eloquent-javascripts.html#165">153</a>,&#160;<a href="eloquent-javascripts.html#249">237</a>,<br/>
control&#160;point,&#160;<a href="eloquent-javascripts.html#301">289</a>,&#160;<a href="eloquent-javascripts.html#302">290</a><br/>
<a href="eloquent-javascripts.html#280">268</a>,&#160;<a href="eloquent-javascripts.html#359">347</a><br/>
convention,&#160;<a href="eloquent-javascripts.html#47">35</a><br/>
component,&#160;<a href="eloquent-javascripts.html#342">330,&#160;</a><a href="eloquent-javascripts.html#343">331</a>,&#160;<a href="eloquent-javascripts.html#349">337</a>,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
convergent&#160;evolution,&#160;<a href="eloquent-javascripts.html#194">182</a><br/>
composability,&#160;<a href="eloquent-javascripts.html#17">5</a>,&#160;<a href="eloquent-javascripts.html#102">90,&#160;</a><a href="eloquent-javascripts.html#188">176</a><br/>
Conway’s&#160;Game&#160;of&#160;Life,&#160;<a href="eloquent-javascripts.html#341">329</a><br/>
computed&#160;property,&#160;<a href="eloquent-javascripts.html#71">59,&#160;</a><a href="eloquent-javascripts.html#339">327</a><br/>
coordinates,&#160;<a href="eloquent-javascripts.html#127">115</a>,&#160;<a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#282">270</a>,&#160;<a href="eloquent-javascripts.html#285">273,</a><br/>
computer,&#160;<a href="eloquent-javascripts.html#1">1</a>,&#160;<a href="eloquent-javascripts.html#14">2</a><br/>
<a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#288">276</a>,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#307">295,&#160;</a><a href="eloquent-javascripts.html#308">296</a><br/>
concat&#160;method,&#160;<a href="eloquent-javascripts.html#83">71,&#160;</a><a href="eloquent-javascripts.html#107">95</a>,&#160;<a href="eloquent-javascripts.html#406">394</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
copy-paste&#160;programming,&#160;<a href="eloquent-javascripts.html#64">52</a>,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
concatenation,&#160;<a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#83">71</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
copyright,&#160;<a href="eloquent-javascripts.html#181">169</a><br/>
conditional&#160;execution,&#160;<a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#46">34,&#160;</a><a href="eloquent-javascripts.html#50">38</a>,<br/>
correlation,&#160;<a href="eloquent-javascripts.html#77">65</a>,&#160;<a href="eloquent-javascripts.html#78">66,&#160;</a><a href="eloquent-javascripts.html#80">68</a>–<a href="eloquent-javascripts.html#82">70</a><br/>
<a href="eloquent-javascripts.html#220">208</a><br/>
corvid,&#160;<a href="eloquent-javascripts.html#194">182</a><br/>
conditional&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17</a>,&#160;<a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#220">208</a><br/>
cosine,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#252">240</a><br/>
415<br/>
<hr/>
<a name=428></a>countBy&#160;function,&#160;<a href="eloquent-javascripts.html#105">93</a>,&#160;<a href="eloquent-javascripts.html#108">96</a><br/>
list,&#160;<a href="eloquent-javascripts.html#92">80</a><br/>
counter&#160;variable,&#160;<a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#44">32</a>,&#160;<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#401">389</a>,<br/>
map,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
<a href="eloquent-javascripts.html#402">390</a>,&#160;<a href="eloquent-javascripts.html#410">398</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
stack,&#160;<a href="eloquent-javascripts.html#72">60</a><br/>
CPU,&#160;<a href="eloquent-javascripts.html#193">181</a><br/>
tree,&#160;<a href="eloquent-javascripts.html#215">203</a>,&#160;<a href="eloquent-javascripts.html#237">225,&#160;</a><a href="eloquent-javascripts.html#316">304</a><br/>
crash,&#160;<a href="eloquent-javascripts.html#150">138</a>,&#160;<a href="eloquent-javascripts.html#153">141,&#160;</a><a href="eloquent-javascripts.html#389">377,&#160;</a><a href="eloquent-javascripts.html#399">387</a><br/>
data&#160;URL,&#160;<a href="eloquent-javascripts.html#354">342</a>,&#160;<a href="eloquent-javascripts.html#355">343</a><br/>
createElement&#160;method,&#160;<a href="eloquent-javascripts.html#243">231</a>,&#160;<a href="eloquent-javascripts.html#345">333,&#160;</a><a href="eloquent-javascripts.html#412">400</a><br/>
date,&#160;<a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#158">146,&#160;</a><a href="eloquent-javascripts.html#160">148</a><br/>
createReadStream&#160;function,&#160;<a href="eloquent-javascripts.html#372">360</a>,&#160;<a href="eloquent-javascripts.html#376">364</a><br/>
Date&#160;class,&#160;<a href="eloquent-javascripts.html#160">148</a>,&#160;<a href="eloquent-javascripts.html#161">149</a>,&#160;<a href="eloquent-javascripts.html#181">169,&#160;</a><a href="eloquent-javascripts.html#183">171</a><br/>
createServer&#160;function,&#160;<a href="eloquent-javascripts.html#369">357</a>–<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#386">374</a>,<br/>
date-names&#160;package,&#160;<a href="eloquent-javascripts.html#183">171</a><br/>
<a href="eloquent-javascripts.html#387">375</a><br/>
Date.now&#160;function,&#160;<a href="eloquent-javascripts.html#161">149,&#160;</a><a href="eloquent-javascripts.html#357">345</a><br/>
createTextNode&#160;method,&#160;<a href="eloquent-javascripts.html#242">230</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
dblclick&#160;event,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
createWriteStream&#160;function,&#160;<a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#377">365</a><br/>
De&#160;Morgan’s&#160;laws,&#160;<a href="eloquent-javascripts.html#404">392</a><br/>
crisp,&#160;<a href="eloquent-javascripts.html#316">304</a><br/>
debouncing,&#160;<a href="eloquent-javascripts.html#270">258</a><br/>
cross-domain&#160;request,&#160;<a href="eloquent-javascripts.html#326">314</a><br/>
debugger&#160;statement,&#160;<a href="eloquent-javascripts.html#145">133</a><br/>
crow,&#160;<a href="eloquent-javascripts.html#194">182,&#160;</a><a href="eloquent-javascripts.html#195">183,&#160;</a><a href="eloquent-javascripts.html#200">188,&#160;</a><a href="eloquent-javascripts.html#206">194</a><br/>
debugging,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#140">128</a>,&#160;<a href="eloquent-javascripts.html#142">130,&#160;</a><a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#145">133,&#160;</a><a href="eloquent-javascripts.html#148">136</a>,<br/>
crow-tech&#160;module,&#160;<a href="eloquent-javascripts.html#196">184</a><br/>
<a href="eloquent-javascripts.html#151">139,&#160;</a><a href="eloquent-javascripts.html#152">140</a>,&#160;<a href="eloquent-javascripts.html#177">165</a><br/>
crying,&#160;<a href="eloquent-javascripts.html#159">147</a><br/>
decentralization,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
cryptography,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
decimal&#160;number,&#160;<a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#164">152</a><br/>
CSS,&#160;<a href="eloquent-javascripts.html#247">235–</a><a href="eloquent-javascripts.html#249">237,&#160;</a><a href="eloquent-javascripts.html#281">269</a>–<a href="eloquent-javascripts.html#284">272</a>,&#160;<a href="eloquent-javascripts.html#286">274,&#160;</a><a href="eloquent-javascripts.html#296">284</a>,&#160;<a href="eloquent-javascripts.html#298">286,</a><br/>
declaration,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
<a href="eloquent-javascripts.html#345">333</a>,&#160;<a href="eloquent-javascripts.html#393">381</a><br/>
decodeURIComponent&#160;function,&#160;<a href="eloquent-javascripts.html#323">311</a>,<br/>
ctrlKey&#160;property,&#160;<a href="eloquent-javascripts.html#260">248,&#160;</a><a href="eloquent-javascripts.html#360">348</a><br/>
<a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#387">375</a><br/>
curl&#160;program,&#160;<a href="eloquent-javascripts.html#378">366</a><br/>
deep&#160;comparison,&#160;<a href="eloquent-javascripts.html#76">64,&#160;</a><a href="eloquent-javascripts.html#92">80</a><br/>
curly&#160;braces,&#160;<i>see&#160;</i>braces<br/>
deep&#160;comparison&#160;(exercise),&#160;<a href="eloquent-javascripts.html#92">80,&#160;</a><a href="eloquent-javascripts.html#403">391</a><br/>
cursor,&#160;<a href="eloquent-javascripts.html#332">320,&#160;</a><a href="eloquent-javascripts.html#333">321</a><br/>
default&#160;behavior,&#160;<a href="eloquent-javascripts.html#247">235</a>,&#160;<a href="eloquent-javascripts.html#259">247</a><br/>
curve,&#160;<a href="eloquent-javascripts.html#301">289</a>,&#160;<a href="eloquent-javascripts.html#302">290</a><br/>
default&#160;export,&#160;<a href="eloquent-javascripts.html#186">174</a><br/>
cutting&#160;point,&#160;<a href="eloquent-javascripts.html#281">269</a><br/>
default&#160;keyword,&#160;<a href="eloquent-javascripts.html#47">35</a><br/>
cwd&#160;function,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
default&#160;value,&#160;<a href="eloquent-javascripts.html#32">20</a>,&#160;<a href="eloquent-javascripts.html#58">46,&#160;</a><a href="eloquent-javascripts.html#299">287,&#160;</a><a href="eloquent-javascripts.html#339">327</a>,&#160;<a href="eloquent-javascripts.html#359">347</a><br/>
cycle,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
defineProperty&#160;function,&#160;<a href="eloquent-javascripts.html#405">393<br/></a>defineRequestType&#160;function,&#160;<a href="eloquent-javascripts.html#196">184</a>,&#160;<a href="eloquent-javascripts.html#201">189</a><br/>
Dark&#160;Blue&#160;(game),&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
degree,&#160;<a href="eloquent-javascripts.html#302">290,&#160;</a><a href="eloquent-javascripts.html#308">296</a><br/>
data,&#160;<a href="eloquent-javascripts.html#14">2,&#160;</a><a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#69">57</a><br/>
DELETE&#160;method,&#160;<a href="eloquent-javascripts.html#321">309</a>,&#160;<a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#325">313</a>,&#160;<a href="eloquent-javascripts.html#373">361,</a><br/>
data&#160;attribute,&#160;<a href="eloquent-javascripts.html#244">232</a>,&#160;<a href="eloquent-javascripts.html#272">260</a><br/>
<a href="eloquent-javascripts.html#376">364,&#160;</a><a href="eloquent-javascripts.html#389">377</a><br/>
data&#160;event,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
delete&#160;method,&#160;<a href="eloquent-javascripts.html#127">115</a><br/>
data&#160;flow,&#160;<a href="eloquent-javascripts.html#343">331,&#160;</a><a href="eloquent-javascripts.html#360">348</a><br/>
delete&#160;operator,&#160;<a href="eloquent-javascripts.html#74">62</a><br/>
data&#160;format,&#160;<a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
dependence,&#160;<a href="eloquent-javascripts.html#77">65</a><br/>
data&#160;loss,&#160;<a href="eloquent-javascripts.html#399">387</a><br/>
dependency,&#160;<a href="eloquent-javascripts.html#179">167,&#160;</a><a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#182">170,&#160;</a><a href="eloquent-javascripts.html#185">173</a>,&#160;<a href="eloquent-javascripts.html#191">179,</a><br/>
data&#160;set,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#98">86</a><br/>
<a href="eloquent-javascripts.html#233">221,&#160;</a><a href="eloquent-javascripts.html#366">354</a>,&#160;<a href="eloquent-javascripts.html#367">355</a><br/>
data&#160;structure,&#160;<a href="eloquent-javascripts.html#69">57,&#160;</a><a href="eloquent-javascripts.html#188">176,&#160;</a><a href="eloquent-javascripts.html#189">177,&#160;</a><a href="eloquent-javascripts.html#236">224</a>,<br/>
deserialization,&#160;<a href="eloquent-javascripts.html#90">78</a><br/>
<a href="eloquent-javascripts.html#341">329</a><br/>
design,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
collection,&#160;<a href="eloquent-javascripts.html#70">58</a><br/>
destructuring,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
immutable,&#160;<a href="eloquent-javascripts.html#133">121</a><br/>
destructuring&#160;assignment,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
416<br/>
<hr/>
<a name=429></a>destructuring&#160;binding,&#160;<a href="eloquent-javascripts.html#88">76</a>,&#160;<a href="eloquent-javascripts.html#184">172</a>,&#160;<a href="eloquent-javascripts.html#359">347</a>,<br/>
fields,&#160;<a href="eloquent-javascripts.html#327">315</a>,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
<a href="eloquent-javascripts.html#409">397</a><br/>
graphics,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#281">269</a>,&#160;<a href="eloquent-javascripts.html#283">271</a>,&#160;<a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#296">284,</a><br/>
developer&#160;tools,&#160;<a href="eloquent-javascripts.html#19">7,&#160;</a><a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#145">133,&#160;</a><a href="eloquent-javascripts.html#150">138</a><br/>
<a href="eloquent-javascripts.html#297">285,&#160;</a><a href="eloquent-javascripts.html#316">304</a><br/>
dialect,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
interface,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
dialog&#160;box,&#160;<a href="eloquent-javascripts.html#38">26</a><br/>
modification,&#160;<a href="eloquent-javascripts.html#241">229</a><br/>
diamond,&#160;<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
querying,&#160;<a href="eloquent-javascripts.html#240">228,&#160;</a><a href="eloquent-javascripts.html#249">237</a><br/>
digit,&#160;<a href="eloquent-javascripts.html#22">10</a>,&#160;<a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#156">144</a><a href="eloquent-javascripts.html#159">–147,&#160;</a><a href="eloquent-javascripts.html#345">333</a><br/>
tree,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
Dijkstra’s&#160;algorithm,&#160;<a href="eloquent-javascripts.html#189">177</a><br/>
dom&#160;property,&#160;<a href="eloquent-javascripts.html#343">331</a><br/>
Dijkstra,&#160;Edsger,&#160;<a href="eloquent-javascripts.html#129">117</a>,&#160;<a href="eloquent-javascripts.html#189">177</a><br/>
domain,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#338">326</a><br/>
dijkstrajs&#160;package,&#160;<a href="eloquent-javascripts.html#189">177</a>,&#160;<a href="eloquent-javascripts.html#408">396</a><br/>
domain-specific&#160;language,&#160;<a href="eloquent-javascripts.html#94">82</a>,&#160;<a href="eloquent-javascripts.html#144">132,&#160;</a><a href="eloquent-javascripts.html#155">143</a>,<br/>
dimensions,&#160;<a href="eloquent-javascripts.html#127">115</a>,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#273">261</a>,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,<br/>
<a href="eloquent-javascripts.html#226">214,&#160;</a><a href="eloquent-javascripts.html#249">237</a><br/>
<a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#401">389</a><br/>
DOMDisplay&#160;class,&#160;<a href="eloquent-javascripts.html#281">269</a>,&#160;<a href="eloquent-javascripts.html#282">270,&#160;</a><a href="eloquent-javascripts.html#311">299</a><br/>
dinosaur,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
dominant&#160;direction&#160;(exercise),&#160;<a href="eloquent-javascripts.html#108">96,&#160;</a><a href="eloquent-javascripts.html#404">392</a><br/>
direct&#160;child&#160;node,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
done&#160;property,&#160;<a href="eloquent-javascripts.html#357">345</a><br/>
direction&#160;(writing),&#160;<a href="eloquent-javascripts.html#108">96</a><br/>
doneAt&#160;property,&#160;<a href="eloquent-javascripts.html#357">345</a><br/>
directory,&#160;<a href="eloquent-javascripts.html#364">352,&#160;</a><a href="eloquent-javascripts.html#367">355,&#160;</a><a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#375">363</a>,<br/>
dot&#160;character,&#160;<i>see&#160;</i>period&#160;character<br/>
<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#379">367</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
double&#160;click,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
directory&#160;creation&#160;(exercise),&#160;<a href="eloquent-javascripts.html#379">367,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
double-quote&#160;character,&#160;<a href="eloquent-javascripts.html#25">13,&#160;</a><a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#214">202,</a><br/>
disabled&#160;attribute,&#160;<a href="eloquent-javascripts.html#330">318</a><br/>
<a href="eloquent-javascripts.html#232">220</a><br/>
discretization,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#293">281</a><br/>
download,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#354">342</a>,&#160;<a href="eloquent-javascripts.html#365">353</a>,&#160;<a href="eloquent-javascripts.html#377">365,&#160;</a><a href="eloquent-javascripts.html#381">369,</a><br/>
dispatch,&#160;<a href="eloquent-javascripts.html#46">34,&#160;</a><a href="eloquent-javascripts.html#343">331–</a><a href="eloquent-javascripts.html#345">333,&#160;</a><a href="eloquent-javascripts.html#349">337,&#160;</a><a href="eloquent-javascripts.html#358">346,&#160;</a><a href="eloquent-javascripts.html#386">374</a>,<br/>
<a href="eloquent-javascripts.html#399">387</a><br/>
<a href="eloquent-javascripts.html#418">406</a><br/>
download&#160;attribute,&#160;<a href="eloquent-javascripts.html#354">342</a><br/>
display,&#160;<a href="eloquent-javascripts.html#281">269,&#160;</a><a href="eloquent-javascripts.html#293">281,&#160;</a><a href="eloquent-javascripts.html#294">282,&#160;</a><a href="eloquent-javascripts.html#311">299</a>,&#160;<a href="eloquent-javascripts.html#315">303</a>,&#160;<a href="eloquent-javascripts.html#317">305</a><br/>
draggable&#160;bar&#160;example,&#160;<a href="eloquent-javascripts.html#262">250</a><br/>
display&#160;(CSS),&#160;<a href="eloquent-javascripts.html#247">235</a>,&#160;<a href="eloquent-javascripts.html#272">260</a><br/>
dragging,&#160;<a href="eloquent-javascripts.html#262">250,&#160;</a><a href="eloquent-javascripts.html#342">330,&#160;</a><a href="eloquent-javascripts.html#352">340</a>,&#160;<a href="eloquent-javascripts.html#361">349</a><br/>
distance,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
draw&#160;function,&#160;<a href="eloquent-javascripts.html#351">339,&#160;</a><a href="eloquent-javascripts.html#361">349</a><br/>
division,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
drawImage&#160;method,&#160;<a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#307">295</a>,&#160;<a href="eloquent-javascripts.html#311">299,</a><br/>
division&#160;by&#160;zero,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
<a href="eloquent-javascripts.html#313">301,&#160;</a><a href="eloquent-javascripts.html#314">302</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
do&#160;loop,&#160;<a href="eloquent-javascripts.html#43">31</a>,&#160;<a href="eloquent-javascripts.html#135">123</a><br/>
drawing,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#251">239</a>,&#160;<a href="eloquent-javascripts.html#281">269</a>,&#160;<a href="eloquent-javascripts.html#296">284–</a><br/>
doctype,&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#232">220</a><br/>
<a href="eloquent-javascripts.html#298">286,&#160;</a><a href="eloquent-javascripts.html#301">289,&#160;</a><a href="eloquent-javascripts.html#309">297,&#160;</a><a href="eloquent-javascripts.html#314">302,&#160;</a><a href="eloquent-javascripts.html#315">303,&#160;</a><a href="eloquent-javascripts.html#342">330,</a><br/>
document,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#267">255,&#160;</a><a href="eloquent-javascripts.html#296">284</a><br/>
<a href="eloquent-javascripts.html#417">405</a><br/>
document&#160;format,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#340">328</a><br/>
drawing&#160;program&#160;example,&#160;<a href="eloquent-javascripts.html#262">250</a>,&#160;<a href="eloquent-javascripts.html#342">330</a><br/>
Document&#160;Object&#160;Model,&#160;<i>see&#160;</i>DOM<br/>
drawPicture&#160;function,&#160;<a href="eloquent-javascripts.html#347">335,&#160;</a><a href="eloquent-javascripts.html#354">342</a>,&#160;<a href="eloquent-javascripts.html#360">348,</a><br/>
documentation,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
<a href="eloquent-javascripts.html#418">406</a><br/>
documentElement&#160;property,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
drop-down&#160;menu,&#160;<a href="eloquent-javascripts.html#328">316</a>,&#160;<a href="eloquent-javascripts.html#334">322</a><br/>
dollar&#160;sign,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#162">150</a>,&#160;<a href="eloquent-javascripts.html#166">154,&#160;</a><a href="eloquent-javascripts.html#173">161</a><br/>
duplication,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
DOM,&#160;<a href="eloquent-javascripts.html#237">225,&#160;</a><a href="eloquent-javascripts.html#244">232</a><br/>
attributes,&#160;<a href="eloquent-javascripts.html#244">232</a><br/>
ECMAScript,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#185">173</a><br/>
components,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#343">331</a><br/>
ECMAScript&#160;6,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
construction,&#160;<a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#243">231,&#160;</a><a href="eloquent-javascripts.html#345">333</a><br/>
economic&#160;factors,&#160;<a href="eloquent-javascripts.html#359">347</a><br/>
events,&#160;<a href="eloquent-javascripts.html#256">244</a>,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
ecstatic&#160;package,&#160;<a href="eloquent-javascripts.html#387">375</a><br/>
417<br/>
<hr/>
<a name=430></a>editor,&#160;<a href="eloquent-javascripts.html#44">32</a><br/>
error&#160;response,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#377">365</a><br/>
efficiency,&#160;<a href="eloquent-javascripts.html#61">49,&#160;</a><a href="eloquent-javascripts.html#91">79</a>,&#160;<a href="eloquent-javascripts.html#103">91</a>,&#160;<a href="eloquent-javascripts.html#204">192</a>,&#160;<a href="eloquent-javascripts.html#224">212,&#160;</a><a href="eloquent-javascripts.html#245">233</a>,<br/>
error&#160;tolerance,&#160;<a href="eloquent-javascripts.html#232">220</a><br/>
<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#284">272</a>,&#160;<a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#347">335,&#160;</a><a href="eloquent-javascripts.html#360">348</a><br/>
Error&#160;type,&#160;<a href="eloquent-javascripts.html#148">136</a>,&#160;<a href="eloquent-javascripts.html#150">138</a>,&#160;<a href="eloquent-javascripts.html#152">140,&#160;</a><a href="eloquent-javascripts.html#376">364</a><br/>
efficient&#160;drawing&#160;(exercise),&#160;<a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#418">406</a><br/>
ES&#160;modules,&#160;<a href="eloquent-javascripts.html#185">173,&#160;</a><a href="eloquent-javascripts.html#233">221</a><br/>
Egg&#160;language,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#215">203,&#160;</a><a href="eloquent-javascripts.html#218">206</a>–<a href="eloquent-javascripts.html#220">208</a>,&#160;<a href="eloquent-javascripts.html#222">210,</a><br/>
escape&#160;key,&#160;<a href="eloquent-javascripts.html#295">283</a><br/>
<a href="eloquent-javascripts.html#223">211</a>,&#160;<a href="eloquent-javascripts.html#225">213</a>–<a href="eloquent-javascripts.html#227">215</a>,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
escaping<br/>
electronic&#160;life,&#160;<a href="eloquent-javascripts.html#274">262</a><br/>
in&#160;HTML,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#233">221</a><br/>
elegance,&#160;<a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#216">204</a><br/>
in&#160;regexps,&#160;<a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#169">157</a><br/>
element,&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#243">231</a><br/>
in&#160;strings,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#214">202</a><br/>
ELEMENT_NODE&#160;code,&#160;<a href="eloquent-javascripts.html#238">226,&#160;</a><a href="eloquent-javascripts.html#412">400</a><br/>
in&#160;URLs,&#160;<a href="eloquent-javascripts.html#323">311,&#160;</a><a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#387">375</a><br/>
elements&#160;property,&#160;<a href="eloquent-javascripts.html#330">318</a>,&#160;<a href="eloquent-javascripts.html#331">319</a><br/>
Escher,&#160;M.C.,&#160;<a href="eloquent-javascripts.html#296">284</a><br/>
ellipse,&#160;<a href="eloquent-javascripts.html#251">239,&#160;</a><a href="eloquent-javascripts.html#252">240</a><br/>
ETag&#160;header,&#160;<a href="eloquent-javascripts.html#384">372</a>,&#160;<a href="eloquent-javascripts.html#391">379</a>,&#160;<a href="eloquent-javascripts.html#397">385</a><br/>
else&#160;keyword,&#160;<a href="eloquent-javascripts.html#41">29</a><br/>
eval,&#160;<a href="eloquent-javascripts.html#182">170</a><br/>
elt&#160;function,&#160;<a href="eloquent-javascripts.html#243">231,&#160;</a><a href="eloquent-javascripts.html#345">333,&#160;</a><a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#395">383</a><br/>
evaluate&#160;function,&#160;<a href="eloquent-javascripts.html#219">207</a>,&#160;<a href="eloquent-javascripts.html#220">208,&#160;</a><a href="eloquent-javascripts.html#222">210</a><br/>
email,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
evaluation,&#160;<a href="eloquent-javascripts.html#182">170,&#160;</a><a href="eloquent-javascripts.html#219">207</a>,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
emoji,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#104">92,&#160;</a><a href="eloquent-javascripts.html#175">163,&#160;</a><a href="eloquent-javascripts.html#271">259</a><br/>
even&#160;number,&#160;<a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#67">55</a><br/>
empty&#160;set,&#160;<a href="eloquent-javascripts.html#168">156</a><br/>
event&#160;handling,&#160;<a href="eloquent-javascripts.html#255">243–</a><a href="eloquent-javascripts.html#257">245,&#160;</a><a href="eloquent-javascripts.html#259">247</a>,&#160;<a href="eloquent-javascripts.html#265">253–</a><br/>
encapsulation,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#110">98,&#160;</a><a href="eloquent-javascripts.html#118">106</a>,&#160;<a href="eloquent-javascripts.html#125">113</a>,&#160;<a href="eloquent-javascripts.html#256">244</a>,<br/>
<a href="eloquent-javascripts.html#267">255,&#160;</a><a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#291">279,&#160;</a><a href="eloquent-javascripts.html#294">282,&#160;</a><a href="eloquent-javascripts.html#295">283,&#160;</a><a href="eloquent-javascripts.html#305">293,</a><br/>
<a href="eloquent-javascripts.html#280">268</a>,&#160;<a href="eloquent-javascripts.html#281">269</a><br/>
<a href="eloquent-javascripts.html#316">304,&#160;</a><a href="eloquent-javascripts.html#331">319,&#160;</a><a href="eloquent-javascripts.html#332">320,&#160;</a><a href="eloquent-javascripts.html#346">334,&#160;</a><a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#414">402,</a><br/>
encodeURIComponent&#160;function,&#160;<a href="eloquent-javascripts.html#323">311</a>,<br/>
<a href="eloquent-javascripts.html#417">405</a><br/>
<a href="eloquent-javascripts.html#384">372</a>,&#160;<a href="eloquent-javascripts.html#394">382</a><br/>
event&#160;loop,&#160;<a href="eloquent-javascripts.html#209">197</a><br/>
encoding,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
event&#160;object,&#160;<a href="eloquent-javascripts.html#257">245,&#160;</a><a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#264">252</a><br/>
encryption,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
event&#160;propagation,&#160;<a href="eloquent-javascripts.html#257">245,&#160;</a><a href="eloquent-javascripts.html#258">246</a>,&#160;<a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#267">255</a><br/>
end&#160;event,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
event&#160;type,&#160;<a href="eloquent-javascripts.html#257">245</a><br/>
end&#160;method,&#160;<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#374">362</a><br/>
every&#160;method,&#160;<a href="eloquent-javascripts.html#107">95</a><br/>
enemies&#160;example,&#160;<a href="eloquent-javascripts.html#172">160</a><br/>
everything&#160;(exercise),&#160;<a href="eloquent-javascripts.html#107">95,&#160;</a><a href="eloquent-javascripts.html#404">392</a><br/>
engineering,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
everywhere&#160;function,&#160;<a href="eloquent-javascripts.html#203">191</a><br/>
ENOENT&#160;(status&#160;code),&#160;<a href="eloquent-javascripts.html#376">364</a><br/>
evolution,&#160;<a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#359">347</a>,&#160;<a href="eloquent-javascripts.html#367">355</a><br/>
enter&#160;key,&#160;<a href="eloquent-javascripts.html#331">319</a><br/>
exception&#160;handling,&#160;<a href="eloquent-javascripts.html#147">135</a>,&#160;<a href="eloquent-javascripts.html#148">136</a>,&#160;<a href="eloquent-javascripts.html#150">138–</a><br/>
entity,&#160;<a href="eloquent-javascripts.html#232">220</a><br/>
<a href="eloquent-javascripts.html#152">140,&#160;</a><a href="eloquent-javascripts.html#154">142,&#160;</a><a href="eloquent-javascripts.html#198">186,&#160;</a><a href="eloquent-javascripts.html#199">187,&#160;</a><a href="eloquent-javascripts.html#208">196,&#160;</a><a href="eloquent-javascripts.html#210">198,</a><br/>
enum&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
<a href="eloquent-javascripts.html#213">201,&#160;</a><a href="eloquent-javascripts.html#410">398</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
environment,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#220">208</a><br/>
exception&#160;safety,&#160;<a href="eloquent-javascripts.html#150">138</a><br/>
equality,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
exec&#160;method,&#160;<a href="eloquent-javascripts.html#159">147</a>,&#160;<a href="eloquent-javascripts.html#160">148,&#160;</a><a href="eloquent-javascripts.html#170">158,&#160;</a><a href="eloquent-javascripts.html#171">159</a><br/>
error,&#160;<a href="eloquent-javascripts.html#104">92</a>,&#160;<a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#141">129,&#160;</a><a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#146">134</a>,&#160;<a href="eloquent-javascripts.html#150">138</a>,<br/>
execution&#160;order,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#55">43</a>,&#160;<a href="eloquent-javascripts.html#57">45</a><br/>
<a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#198">186</a>,&#160;<a href="eloquent-javascripts.html#200">188</a>,&#160;<a href="eloquent-javascripts.html#206">194</a><br/>
exercises,&#160;<a href="eloquent-javascripts.html#14">2</a>,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#49">37</a>,&#160;<a href="eloquent-javascripts.html#144">132</a><br/>
error&#160;event,&#160;<a href="eloquent-javascripts.html#337">325</a>,&#160;<a href="eloquent-javascripts.html#377">365</a><br/>
exit&#160;method,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
error&#160;handling,&#160;<a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#146">134,&#160;</a><a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#150">138</a>,<br/>
expectation,&#160;<a href="eloquent-javascripts.html#259">247</a><br/>
<a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#374">362</a>,&#160;<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#394">382,&#160;</a><a href="eloquent-javascripts.html#397">385</a><br/>
experiment,&#160;<a href="eloquent-javascripts.html#15">3</a>,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#177">165</a><br/>
error&#160;message,&#160;<a href="eloquent-javascripts.html#218">206</a>,&#160;<a href="eloquent-javascripts.html#341">329</a><br/>
exploit,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
error&#160;recovery,&#160;<a href="eloquent-javascripts.html#146">134</a><br/>
exponent,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#178">166</a>,&#160;<a href="eloquent-javascripts.html#407">395</a>,&#160;<a href="eloquent-javascripts.html#408">396</a><br/>
418<br/>
<hr/>
<a name=431></a>exponentiation,&#160;<a href="eloquent-javascripts.html#43">31,&#160;</a><a href="eloquent-javascripts.html#45">33</a><br/>
filling,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#300">288</a>,&#160;<a href="eloquent-javascripts.html#304">292,&#160;</a><a href="eloquent-javascripts.html#317">305</a><br/>
export&#160;keyword,&#160;<a href="eloquent-javascripts.html#186">174</a><br/>
fillRect&#160;method,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#306">294</a><br/>
exports&#160;object,&#160;<a href="eloquent-javascripts.html#183">171</a>,&#160;<a href="eloquent-javascripts.html#185">173,&#160;</a><a href="eloquent-javascripts.html#365">353,&#160;</a><a href="eloquent-javascripts.html#409">397</a><br/>
fillStyle&#160;property,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#304">292</a><br/>
expression,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#45">33</a>,&#160;<a href="eloquent-javascripts.html#54">42</a>,<br/>
fillText&#160;method,&#160;<a href="eloquent-javascripts.html#304">292</a>,&#160;<a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#215">203</a>,&#160;<a href="eloquent-javascripts.html#219">207</a><br/>
filter&#160;method,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#102">90</a>,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#132">120,&#160;</a><a href="eloquent-javascripts.html#202">190,</a><br/>
expressivity,&#160;<a href="eloquent-javascripts.html#226">214</a><br/>
<a href="eloquent-javascripts.html#404">392–</a><a href="eloquent-javascripts.html#406">394</a><br/>
extension,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
finally&#160;keyword,&#160;<a href="eloquent-javascripts.html#149">137</a>,&#160;<a href="eloquent-javascripts.html#154">142</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
extraction,&#160;<a href="eloquent-javascripts.html#160">148</a><br/>
findIndex&#160;method,&#160;<a href="eloquent-javascripts.html#106">94<br/></a>findInStorage&#160;function,&#160;<a href="eloquent-javascripts.html#206">194,&#160;</a><a href="eloquent-javascripts.html#207">195</a><br/>
factorial&#160;function,&#160;<a href="eloquent-javascripts.html#20">8</a><br/>
findRoute&#160;function,&#160;<a href="eloquent-javascripts.html#137">125,&#160;</a><a href="eloquent-javascripts.html#205">193</a><br/>
Fahrenheit,&#160;<a href="eloquent-javascripts.html#124">112</a><br/>
finish&#160;event,&#160;<a href="eloquent-javascripts.html#377">365</a><br/>
fallthrough,&#160;<a href="eloquent-javascripts.html#47">35</a><br/>
Firefox,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
false,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
firewall,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
farm&#160;example,&#160;<a href="eloquent-javascripts.html#64">52,&#160;</a><a href="eloquent-javascripts.html#66">54</a>,&#160;<a href="eloquent-javascripts.html#162">150</a><br/>
firstChild&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
fetch&#160;function,&#160;<a href="eloquent-javascripts.html#324">312</a>,&#160;<a href="eloquent-javascripts.html#340">328</a>,&#160;<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#394">382</a>,<br/>
fixed&#160;positioning,&#160;<a href="eloquent-javascripts.html#266">254</a><br/>
<a href="eloquent-javascripts.html#397">385</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
fixing&#160;scope&#160;(exercise),&#160;<a href="eloquent-javascripts.html#227">215</a>,&#160;<a href="eloquent-javascripts.html#411">399</a><br/>
field,&#160;<a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#330">318,&#160;</a><a href="eloquent-javascripts.html#333">321,&#160;</a><a href="eloquent-javascripts.html#337">325</a>,<br/>
FizzBuzz&#160;(exercise),&#160;<a href="eloquent-javascripts.html#50">38,&#160;</a><a href="eloquent-javascripts.html#400">388</a><br/>
<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#399">387</a><br/>
flattening&#160;(exercise),&#160;<a href="eloquent-javascripts.html#107">95</a><br/>
Fielding,&#160;Roy,&#160;<a href="eloquent-javascripts.html#320">308</a><br/>
flexibility,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
file,&#160;<a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#335">323</a>,&#160;<a href="eloquent-javascripts.html#364">352,&#160;</a><a href="eloquent-javascripts.html#376">364,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
flipHorizontally&#160;function,&#160;<a href="eloquent-javascripts.html#314">302,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
access,&#160;<a href="eloquent-javascripts.html#184">172,&#160;</a><a href="eloquent-javascripts.html#187">175,&#160;</a><a href="eloquent-javascripts.html#355">343</a>,&#160;<a href="eloquent-javascripts.html#367">355</a>,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
flipHorizontally&#160;method,&#160;<a href="eloquent-javascripts.html#308">296</a><br/>
image,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#354">342,&#160;</a><a href="eloquent-javascripts.html#355">343</a><br/>
flipping,&#160;<i>see&#160;</i>mirroring<br/>
resource,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#375">363</a><br/>
floating-point&#160;number,&#160;<a href="eloquent-javascripts.html#23">11,&#160;</a><a href="eloquent-javascripts.html#24">12</a><br/>
stream,&#160;<a href="eloquent-javascripts.html#371">359</a><br/>
flood&#160;fill,&#160;<a href="eloquent-javascripts.html#349">337</a>,&#160;<a href="eloquent-javascripts.html#352">340</a><br/>
file&#160;extension,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
flooding,&#160;<a href="eloquent-javascripts.html#204">192</a><br/>
file&#160;field,&#160;<a href="eloquent-javascripts.html#327">315</a>,&#160;<a href="eloquent-javascripts.html#335">323,&#160;</a><a href="eloquent-javascripts.html#336">324</a><br/>
flow&#160;diagram,&#160;<a href="eloquent-javascripts.html#163">151</a>,&#160;<a href="eloquent-javascripts.html#164">152</a><br/>
file&#160;format,&#160;<a href="eloquent-javascripts.html#172">160</a><br/>
focus,&#160;<a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#329">317</a>,&#160;<a href="eloquent-javascripts.html#330">318</a>,&#160;<a href="eloquent-javascripts.html#333">321</a>,&#160;<a href="eloquent-javascripts.html#360">348,</a><br/>
file&#160;reading,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
<a href="eloquent-javascripts.html#399">387</a><br/>
file&#160;server,&#160;<a href="eloquent-javascripts.html#392">380</a><br/>
focus&#160;event,&#160;<a href="eloquent-javascripts.html#266">254</a>,&#160;<a href="eloquent-javascripts.html#267">255</a><br/>
file&#160;server&#160;example,&#160;<a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#375">363</a>–<a href="eloquent-javascripts.html#377">365</a>,&#160;<a href="eloquent-javascripts.html#379">367,</a><br/>
focus&#160;method,&#160;<a href="eloquent-javascripts.html#329">317</a><br/>
<a href="eloquent-javascripts.html#420">408</a><br/>
fold,&#160;<i>see&#160;</i>reduce&#160;method<br/>
file&#160;size,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
font,&#160;<a href="eloquent-javascripts.html#305">293</a><br/>
file&#160;system,&#160;<a href="eloquent-javascripts.html#335">323,&#160;</a><a href="eloquent-javascripts.html#367">355,&#160;</a><a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#375">363</a>,<br/>
font-family&#160;(CSS),&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
<a href="eloquent-javascripts.html#421">409</a><br/>
font-size&#160;(CSS),&#160;<a href="eloquent-javascripts.html#271">259</a><br/>
File&#160;type,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
font-weight&#160;(CSS),&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
FileReader&#160;class,&#160;<a href="eloquent-javascripts.html#336">324</a>,&#160;<a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#355">343</a><br/>
for&#160;attribute,&#160;<a href="eloquent-javascripts.html#333">321</a><br/>
files&#160;property,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
for&#160;loop,&#160;<a href="eloquent-javascripts.html#44">32</a>,&#160;<a href="eloquent-javascripts.html#45">33</a>,&#160;<a href="eloquent-javascripts.html#80">68,&#160;</a><a href="eloquent-javascripts.html#95">83,&#160;</a><a href="eloquent-javascripts.html#107">95,&#160;</a><a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#402">390,</a><br/>
fill&#160;function,&#160;<a href="eloquent-javascripts.html#353">341</a><br/>
<a href="eloquent-javascripts.html#403">391</a><br/>
fill&#160;method,&#160;<a href="eloquent-javascripts.html#300">288</a>,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
for/of&#160;loop,&#160;<a href="eloquent-javascripts.html#80">68</a>,&#160;<a href="eloquent-javascripts.html#105">93,&#160;</a><a href="eloquent-javascripts.html#118">106,&#160;</a><a href="eloquent-javascripts.html#120">108,&#160;</a><a href="eloquent-javascripts.html#122">110,</a><br/>
fillColor&#160;property,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
<a href="eloquent-javascripts.html#405">393</a><br/>
419<br/>
<hr/>
<a name=432></a>forEach&#160;method,&#160;<a href="eloquent-javascripts.html#98">86</a><br/>
garbage&#160;collection,&#160;<a href="eloquent-javascripts.html#23">11</a><br/>
form,&#160;<a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#323">311,&#160;</a><a href="eloquent-javascripts.html#330">318,&#160;</a><a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
garble&#160;example,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
form&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#330">318</a>,<br/>
gardening,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
<a href="eloquent-javascripts.html#396">384</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
gaudy&#160;home&#160;pages,&#160;<a href="eloquent-javascripts.html#272">260</a><br/>
form&#160;property,&#160;<a href="eloquent-javascripts.html#330">318</a><br/>
generation,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
formatDate&#160;module,&#160;<a href="eloquent-javascripts.html#183">171</a>,&#160;<a href="eloquent-javascripts.html#186">174</a><br/>
generator,&#160;<a href="eloquent-javascripts.html#208">196</a><br/>
fractal&#160;example,&#160;<a href="eloquent-javascripts.html#309">297</a><br/>
GET&#160;method,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#325">313</a>,&#160;<a href="eloquent-javascripts.html#331">319,</a><br/>
fractional&#160;number,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#178">166,&#160;</a><a href="eloquent-javascripts.html#274">262</a><br/>
<a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#373">361</a>,&#160;<a href="eloquent-javascripts.html#375">363</a>,&#160;<a href="eloquent-javascripts.html#383">371</a>,&#160;<a href="eloquent-javascripts.html#388">376</a><br/>
frame,&#160;<a href="eloquent-javascripts.html#306">294,&#160;</a><a href="eloquent-javascripts.html#314">302</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
get&#160;method,&#160;<a href="eloquent-javascripts.html#118">106</a><br/>
framework,&#160;<a href="eloquent-javascripts.html#66">54,&#160;</a><a href="eloquent-javascripts.html#343">331</a><br/>
getAttribute&#160;method,&#160;<a href="eloquent-javascripts.html#244">232</a><br/>
frequency&#160;table,&#160;<a href="eloquent-javascripts.html#77">65</a><br/>
getBoundingClientRect&#160;method,&#160;<a href="eloquent-javascripts.html#245">233</a>,<br/>
fs&#160;package,&#160;<a href="eloquent-javascripts.html#367">355</a>–<a href="eloquent-javascripts.html#369">357</a><br/>
<a href="eloquent-javascripts.html#348">336</a><br/>
function,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#56">44</a>,&#160;<a href="eloquent-javascripts.html#141">129</a>,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#215">203</a>,<br/>
getContext&#160;method,&#160;<a href="eloquent-javascripts.html#298">286</a><br/>
<a href="eloquent-javascripts.html#223">211</a><br/>
getDate&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
application,&#160;<a href="eloquent-javascripts.html#38">26,&#160;</a><a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#52">40</a>,&#160;<a href="eloquent-javascripts.html#57">45,&#160;</a><a href="eloquent-javascripts.html#58">46</a>,<br/>
getElementById&#160;method,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#412">400</a><br/>
<a href="eloquent-javascripts.html#61">49,&#160;</a><a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#150">138</a>,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#219">207</a><br/>
getElementsByClassName&#160;method,&#160;<a href="eloquent-javascripts.html#241">229</a><br/>
as&#160;property,&#160;<a href="eloquent-javascripts.html#72">60</a><br/>
getElementsByTagName&#160;method,&#160;<a href="eloquent-javascripts.html#241">229</a>,<br/>
as&#160;value,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#54">42,&#160;</a><a href="eloquent-javascripts.html#59">47</a>,&#160;<a href="eloquent-javascripts.html#96">84,&#160;</a><a href="eloquent-javascripts.html#97">85</a>,&#160;<a href="eloquent-javascripts.html#99">87</a>,<br/>
<a href="eloquent-javascripts.html#243">231,&#160;</a><a href="eloquent-javascripts.html#254">242</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
<a href="eloquent-javascripts.html#257">245</a>,&#160;<a href="eloquent-javascripts.html#292">280</a>,&#160;<a href="eloquent-javascripts.html#414">402</a><br/>
getFullYear&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
body,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#56">44</a><br/>
getHours&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
callback,&#160;<i>see&#160;</i>callback&#160;function<br/>
getImageData&#160;method,&#160;<a href="eloquent-javascripts.html#356">344</a><br/>
declaration,&#160;<a href="eloquent-javascripts.html#55">43</a><br/>
getItem&#160;method,&#160;<a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#339">327</a><br/>
definition,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#55">43</a>,&#160;<a href="eloquent-javascripts.html#63">51</a><br/>
getMinutes&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
higher-order,&#160;<a href="eloquent-javascripts.html#55">43</a>,&#160;<a href="eloquent-javascripts.html#96">84,&#160;</a><a href="eloquent-javascripts.html#97">85</a>,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#100">88</a>,<br/>
getMonth&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
<a href="eloquent-javascripts.html#102">90,&#160;</a><a href="eloquent-javascripts.html#166">154,&#160;</a><a href="eloquent-javascripts.html#292">280</a><br/>
getPrototypeOf&#160;function,&#160;<a href="eloquent-javascripts.html#112">100</a>,&#160;<a href="eloquent-javascripts.html#114">102,</a><br/>
model&#160;of,&#160;<a href="eloquent-javascripts.html#60">48</a><br/>
<a href="eloquent-javascripts.html#227">215,&#160;</a><a href="eloquent-javascripts.html#411">399</a><br/>
naming,&#160;<a href="eloquent-javascripts.html#64">52,&#160;</a><a href="eloquent-javascripts.html#65">53</a><br/>
getSeconds&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
purity,&#160;<a href="eloquent-javascripts.html#66">54</a><br/>
getter,&#160;<a href="eloquent-javascripts.html#123">111</a>,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#278">266</a><br/>
scope,&#160;<a href="eloquent-javascripts.html#54">42</a>,&#160;<a href="eloquent-javascripts.html#181">169</a>,&#160;<a href="eloquent-javascripts.html#226">214</a><br/>
getTime&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
Function&#160;constructor,&#160;<a href="eloquent-javascripts.html#183">171</a>,&#160;<a href="eloquent-javascripts.html#184">172</a>,&#160;<a href="eloquent-javascripts.html#222">210</a>,<br/>
getYear&#160;method,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
<a href="eloquent-javascripts.html#225">213</a>,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
GitHub,&#160;<a href="eloquent-javascripts.html#321">309</a><br/>
function&#160;keyword,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#55">43</a><br/>
global&#160;object,&#160;<a href="eloquent-javascripts.html#141">129</a><br/>
Function&#160;prototype,&#160;<a href="eloquent-javascripts.html#112">100</a>,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
global&#160;scope,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#182">170,&#160;</a><a href="eloquent-javascripts.html#222">210</a>,&#160;<a href="eloquent-javascripts.html#268">256,&#160;</a><a href="eloquent-javascripts.html#363">351,</a><br/>
future,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#37">25,&#160;</a><a href="eloquent-javascripts.html#55">43</a>,&#160;<a href="eloquent-javascripts.html#319">307</a><br/>
<a href="eloquent-javascripts.html#364">352,&#160;</a><a href="eloquent-javascripts.html#411">399</a><br/>
goalOrientedRobot&#160;function,&#160;<a href="eloquent-javascripts.html#138">126</a><br/>
game,&#160;<a href="eloquent-javascripts.html#273">261</a>–<a href="eloquent-javascripts.html#275">263</a>,&#160;<a href="eloquent-javascripts.html#291">279,&#160;</a><a href="eloquent-javascripts.html#294">282,&#160;</a><a href="eloquent-javascripts.html#311">299</a><br/>
Google,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
screenshot,&#160;<a href="eloquent-javascripts.html#286">274,&#160;</a><a href="eloquent-javascripts.html#315">303</a><br/>
gossip&#160;property,&#160;<a href="eloquent-javascripts.html#203">191</a><br/>
with&#160;canvas,&#160;<a href="eloquent-javascripts.html#315">303</a><br/>
grammar,&#160;<a href="eloquent-javascripts.html#34">22</a>,&#160;<a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#172">160</a><br/>
game&#160;of&#160;life&#160;(exercise),&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
graph,&#160;<a href="eloquent-javascripts.html#130">118</a>,&#160;<a href="eloquent-javascripts.html#136">124,&#160;</a><a href="eloquent-javascripts.html#189">177,&#160;</a><a href="eloquent-javascripts.html#205">193,&#160;</a><a href="eloquent-javascripts.html#317">305</a><br/>
GAME_LEVELS&#160;data&#160;set,&#160;<a href="eloquent-javascripts.html#294">282</a><br/>
graphics,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#281">269</a>,&#160;<a href="eloquent-javascripts.html#284">272</a>,&#160;<a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#297">285,</a><br/>
420<br/>
<hr/>
<a name=433></a><a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#316">304</a>,&#160;<a href="eloquent-javascripts.html#317">305</a><br/>
href&#160;attribute,&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#244">232</a><br/>
grave&#160;accent,&#160;<i>see&#160;</i>backtick<br/>
HTML,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#320">308</a>,&#160;<a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#379">367</a><br/>
gravity,&#160;<a href="eloquent-javascripts.html#291">279</a><br/>
notation,&#160;<a href="eloquent-javascripts.html#231">219</a><br/>
greater&#160;than,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
structure,&#160;<a href="eloquent-javascripts.html#236">224,&#160;</a><a href="eloquent-javascripts.html#238">226</a><br/>
greed,&#160;<a href="eloquent-javascripts.html#167">155</a>,&#160;<a href="eloquent-javascripts.html#168">156</a><br/>
html&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#232">220,&#160;</a><a href="eloquent-javascripts.html#237">225</a><br/>
green,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
HTTP,&#160;<a href="eloquent-javascripts.html#228">216</a>–<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#320">308–</a><a href="eloquent-javascripts.html#323">311,&#160;</a><a href="eloquent-javascripts.html#325">313–</a><a href="eloquent-javascripts.html#327">315,</a><br/>
grep,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#377">365</a>,&#160;<a href="eloquent-javascripts.html#379">367</a>,&#160;<a href="eloquent-javascripts.html#382">370</a>,&#160;<a href="eloquent-javascripts.html#383">371</a><br/>
grid,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#282">270,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#288">276</a>,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
client,&#160;<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#378">366,&#160;</a><a href="eloquent-javascripts.html#381">369</a><br/>
Group&#160;class,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#139">127,&#160;</a><a href="eloquent-javascripts.html#209">197,&#160;</a><a href="eloquent-javascripts.html#405">393</a><br/>
server,&#160;<a href="eloquent-javascripts.html#369">357</a>,&#160;<a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#392">380</a><br/>
groupBy&#160;function,&#160;<a href="eloquent-javascripts.html#108">96</a><br/>
http&#160;package,&#160;<a href="eloquent-javascripts.html#369">357</a>,&#160;<a href="eloquent-javascripts.html#370">358</a><br/>
grouping,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#159">147</a>,&#160;<a href="eloquent-javascripts.html#160">148</a>,&#160;<a href="eloquent-javascripts.html#166">154,&#160;</a><a href="eloquent-javascripts.html#407">395</a><br/>
HTTPS,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#327">315</a>,&#160;<a href="eloquent-javascripts.html#371">359</a><br/>
groups&#160;(exercise),&#160;<a href="eloquent-javascripts.html#127">115</a>,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
https&#160;package,&#160;<a href="eloquent-javascripts.html#371">359<br/></a>human&#160;language,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
h1&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
Hypertext&#160;Markup&#160;Language,&#160;<i>see&#160;</i>HTML<br/>
hack,&#160;<a href="eloquent-javascripts.html#185">173</a><br/>
Hypertext&#160;Transfer&#160;Protocol,&#160;<i>see&#160;</i>HTTP<br/>
handleAction&#160;function,&#160;<a href="eloquent-javascripts.html#393">381</a><br/>
hyphen&#160;character,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#156">144,&#160;</a><a href="eloquent-javascripts.html#248">236</a><br/>
hard&#160;disk,&#160;<a href="eloquent-javascripts.html#188">176,&#160;</a><a href="eloquent-javascripts.html#192">180,&#160;</a><a href="eloquent-javascripts.html#195">183<br/></a>hard&#160;drive,&#160;<a href="eloquent-javascripts.html#22">10</a>,&#160;<a href="eloquent-javascripts.html#335">323</a>,&#160;<a href="eloquent-javascripts.html#338">326</a>,&#160;<a href="eloquent-javascripts.html#362">350,&#160;</a><a href="eloquent-javascripts.html#399">387</a><br/>
id&#160;attribute,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#249">237</a>,&#160;<a href="eloquent-javascripts.html#333">321</a><br/>
hard-coding,&#160;<a href="eloquent-javascripts.html#240">228,&#160;</a><a href="eloquent-javascripts.html#318">306</a><br/>
idempotence,&#160;<a href="eloquent-javascripts.html#201">189,&#160;</a><a href="eloquent-javascripts.html#377">365</a><br/>
has&#160;method,&#160;<a href="eloquent-javascripts.html#118">106,&#160;</a><a href="eloquent-javascripts.html#127">115</a><br/>
idempotency,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
hash&#160;character,&#160;<a href="eloquent-javascripts.html#227">215</a><br/>
identifier,&#160;<a href="eloquent-javascripts.html#215">203</a><br/>
hash&#160;sign,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
identity,&#160;<a href="eloquent-javascripts.html#75">63</a><br/>
hasOwnProperty&#160;method,&#160;<a href="eloquent-javascripts.html#118">106,&#160;</a><a href="eloquent-javascripts.html#227">215</a>,<br/>
if&#160;keyword,&#160;<a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#174">162</a><br/>
<a href="eloquent-javascripts.html#411">399</a><br/>
chaining,&#160;<a href="eloquent-javascripts.html#41">29</a>,&#160;<a href="eloquent-javascripts.html#46">34</a>,&#160;<a href="eloquent-javascripts.html#400">388</a>,&#160;<a href="eloquent-javascripts.html#401">389</a><br/>
head&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
If-None-Match&#160;header,&#160;<a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#391">379,&#160;</a><a href="eloquent-javascripts.html#397">385</a><br/>
head&#160;property,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
image,&#160;<a href="eloquent-javascripts.html#242">230</a>,&#160;<a href="eloquent-javascripts.html#267">255,&#160;</a><a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#322">310</a><br/>
header,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#325">313</a>,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#383">371</a><br/>
imagination,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
headers&#160;property,&#160;<a href="eloquent-javascripts.html#324">312</a>,&#160;<a href="eloquent-javascripts.html#325">313,&#160;</a><a href="eloquent-javascripts.html#340">328</a><br/>
IME,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
height&#160;property,&#160;<a href="eloquent-javascripts.html#360">348</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
img&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#232">220,&#160;</a><a href="eloquent-javascripts.html#242">230</a>,&#160;<a href="eloquent-javascripts.html#247">235</a>,&#160;<a href="eloquent-javascripts.html#267">255,</a><br/>
help&#160;text&#160;example,&#160;<a href="eloquent-javascripts.html#266">254</a><br/>
<a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#355">343</a><br/>
hexadecimal&#160;number,&#160;<a href="eloquent-javascripts.html#164">152,&#160;</a><a href="eloquent-javascripts.html#323">311</a>,&#160;<a href="eloquent-javascripts.html#345">333</a>,<br/>
immutable,&#160;<a href="eloquent-javascripts.html#75">63</a>,&#160;<a href="eloquent-javascripts.html#133">121</a>,&#160;<a href="eloquent-javascripts.html#278">266</a>,&#160;<a href="eloquent-javascripts.html#344">332,&#160;</a><a href="eloquent-javascripts.html#345">333,</a><br/>
<a href="eloquent-javascripts.html#356">344</a><br/>
<a href="eloquent-javascripts.html#352">340,&#160;</a><a href="eloquent-javascripts.html#357">345</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
hidden&#160;element,&#160;<a href="eloquent-javascripts.html#247">235</a>,&#160;<a href="eloquent-javascripts.html#272">260</a><br/>
implements&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
higher-order&#160;function,&#160;<i>see&#160;</i>function,<br/>
import&#160;keyword,&#160;<a href="eloquent-javascripts.html#185">173</a><br/>
higher-order<br/>
in&#160;operator,&#160;<a href="eloquent-javascripts.html#74">62,&#160;</a><a href="eloquent-javascripts.html#118">106</a><br/>
history,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#359">347</a><br/>
includes&#160;method,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#80">68,&#160;</a><a href="eloquent-javascripts.html#405">393</a><br/>
historyUpdateState&#160;function,&#160;<a href="eloquent-javascripts.html#357">345</a><br/>
indentation,&#160;<a href="eloquent-javascripts.html#44">32</a><br/>
Hières-sur-Amby,&#160;<a href="eloquent-javascripts.html#194">182</a><br/>
index,&#160;<a href="eloquent-javascripts.html#70">58</a><br/>
hooligan,&#160;<a href="eloquent-javascripts.html#385">373</a><br/>
index&#160;property,&#160;<a href="eloquent-javascripts.html#159">147</a><br/>
Host&#160;header,&#160;<a href="eloquent-javascripts.html#322">310</a><br/>
index.html,&#160;<a href="eloquent-javascripts.html#392">380</a><br/>
421<br/>
<hr/>
<a name=434></a>index.js,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
interpretation,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#182">170,&#160;</a><a href="eloquent-javascripts.html#219">207,&#160;</a><a href="eloquent-javascripts.html#220">208,&#160;</a><a href="eloquent-javascripts.html#224">212</a><br/>
indexOf&#160;method,&#160;<a href="eloquent-javascripts.html#83">71</a>,&#160;<a href="eloquent-javascripts.html#84">72</a>,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#156">144</a>,<br/>
interview&#160;question,&#160;<a href="eloquent-javascripts.html#50">38</a><br/>
<a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
inversion,&#160;<a href="eloquent-javascripts.html#157">145</a><br/>
infinite&#160;loop,&#160;<a href="eloquent-javascripts.html#45">33</a>,&#160;<a href="eloquent-javascripts.html#57">45,&#160;</a><a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
IP&#160;address,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#320">308,&#160;</a><a href="eloquent-javascripts.html#322">310</a><br/>
infinity,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
isDirectory&#160;method,&#160;<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
infrastructure,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
isEven&#160;(exercise),&#160;<a href="eloquent-javascripts.html#67">55,&#160;</a><a href="eloquent-javascripts.html#401">389</a><br/>
inheritance,&#160;<a href="eloquent-javascripts.html#112">100,&#160;</a><a href="eloquent-javascripts.html#124">112</a>–<a href="eloquent-javascripts.html#126">114</a>,&#160;<a href="eloquent-javascripts.html#152">140</a>,&#160;<a href="eloquent-javascripts.html#376">364</a><br/>
isolation,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#179">167</a>,&#160;<a href="eloquent-javascripts.html#182">170</a>,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
INI&#160;file,&#160;<a href="eloquent-javascripts.html#172">160</a><br/>
iterable&#160;interface,&#160;<a href="eloquent-javascripts.html#120">108</a>,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
ini&#160;package,&#160;<a href="eloquent-javascripts.html#181">169,&#160;</a><a href="eloquent-javascripts.html#185">173</a>,&#160;<a href="eloquent-javascripts.html#188">176</a>,&#160;<a href="eloquent-javascripts.html#365">353</a><br/>
iterator,&#160;<a href="eloquent-javascripts.html#208">196</a><br/>
initialization,&#160;<a href="eloquent-javascripts.html#267">255</a><br/>
iterator&#160;interface,&#160;<a href="eloquent-javascripts.html#118">106</a>,&#160;<a href="eloquent-javascripts.html#120">108</a>,&#160;<a href="eloquent-javascripts.html#127">115</a><br/>
inline&#160;element,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#247">235</a><br/>
Jacques,&#160;<a href="eloquent-javascripts.html#69">57</a><br/>
inner&#160;function,&#160;<a href="eloquent-javascripts.html#54">42</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
Java,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
inner&#160;loop,&#160;<a href="eloquent-javascripts.html#165">153</a><br/>
JavaScript,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
innerHeight&#160;property,&#160;<a href="eloquent-javascripts.html#266">254</a><br/>
availability&#160;of,&#160;<a href="eloquent-javascripts.html#1">1</a><br/>
innerWidth&#160;property,&#160;<a href="eloquent-javascripts.html#266">254</a><br/>
flexibility&#160;of,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
input,&#160;<a href="eloquent-javascripts.html#146">134</a>,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#329">317,&#160;</a><a href="eloquent-javascripts.html#362">350</a>,&#160;<a href="eloquent-javascripts.html#389">377</a><br/>
history&#160;of,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
input&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#332">320–</a><br/>
in&#160;HTML,&#160;<a href="eloquent-javascripts.html#233">221</a><br/>
<a href="eloquent-javascripts.html#335">323</a>,&#160;<a href="eloquent-javascripts.html#350">338</a>,&#160;<a href="eloquent-javascripts.html#355">343</a><br/>
syntax,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
input&#160;event,&#160;<a href="eloquent-javascripts.html#333">321</a><br/>
uses&#160;of,&#160;<a href="eloquent-javascripts.html#19">7</a><br/>
insertBefore&#160;method,&#160;<a href="eloquent-javascripts.html#241">229,&#160;</a><a href="eloquent-javascripts.html#242">230</a><br/>
versions&#160;of,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
installation,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
weaknesses&#160;of,&#160;<a href="eloquent-javascripts.html#18">6</a><br/>
instance,&#160;<a href="eloquent-javascripts.html#113">101</a><br/>
JavaScript&#160;console,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#38">26,&#160;</a><a href="eloquent-javascripts.html#145">133,</a><br/>
instanceof&#160;operator,&#160;<a href="eloquent-javascripts.html#125">113,&#160;</a><a href="eloquent-javascripts.html#152">140</a><br/>
<a href="eloquent-javascripts.html#150">138,&#160;</a><a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
instruction,&#160;<a href="eloquent-javascripts.html#15">3</a><br/>
JavaScript&#160;Object&#160;Notation,&#160;<i>see&#160;</i>JSON<br/>
integer,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
job,&#160;<a href="eloquent-javascripts.html#303">291</a><br/>
integration,&#160;<a href="eloquent-javascripts.html#155">143</a>,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
join&#160;method,&#160;<a href="eloquent-javascripts.html#106">94,&#160;</a><a href="eloquent-javascripts.html#116">104,&#160;</a><a href="eloquent-javascripts.html#365">353</a><br/>
interface<br/>
journal,&#160;<a href="eloquent-javascripts.html#70">58,&#160;</a><a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#75">63</a>,&#160;<a href="eloquent-javascripts.html#76">64,&#160;</a><a href="eloquent-javascripts.html#80">68</a><br/>
canvas,&#160;<a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#297">285</a><br/>
JOURNAL&#160;data&#160;set,&#160;<a href="eloquent-javascripts.html#79">67</a><br/>
design,&#160;<a href="eloquent-javascripts.html#66">54</a>,&#160;<a href="eloquent-javascripts.html#155">143</a>,&#160;<a href="eloquent-javascripts.html#161">149,&#160;</a><a href="eloquent-javascripts.html#166">154,&#160;</a><a href="eloquent-javascripts.html#170">158</a>,<br/>
journalEvents&#160;function,&#160;<a href="eloquent-javascripts.html#80">68</a><br/>
<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#281">269</a>,&#160;<a href="eloquent-javascripts.html#299">287</a><br/>
JSON,&#160;<a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#188">176,&#160;</a><a href="eloquent-javascripts.html#195">183,&#160;</a><a href="eloquent-javascripts.html#205">193</a>,&#160;<a href="eloquent-javascripts.html#325">313,&#160;</a><a href="eloquent-javascripts.html#339">327,</a><br/>
HTTP,&#160;<a href="eloquent-javascripts.html#326">314,&#160;</a><a href="eloquent-javascripts.html#383">371</a><br/>
<a href="eloquent-javascripts.html#383">371,&#160;</a><a href="eloquent-javascripts.html#384">372</a>,&#160;<a href="eloquent-javascripts.html#398">386</a>,&#160;<a href="eloquent-javascripts.html#421">409</a><br/>
module,&#160;<a href="eloquent-javascripts.html#179">167,&#160;</a><a href="eloquent-javascripts.html#181">169–</a><a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#185">173,&#160;</a><a href="eloquent-javascripts.html#188">176</a>,<br/>
json&#160;method,&#160;<a href="eloquent-javascripts.html#325">313</a><br/>
<a href="eloquent-javascripts.html#324">312</a>,&#160;<a href="eloquent-javascripts.html#365">353</a><br/>
JSON.parse&#160;function,&#160;<a href="eloquent-javascripts.html#90">78,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
object,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#118">106,&#160;</a><a href="eloquent-javascripts.html#122">110</a>,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#139">127</a>,<br/>
JSON.stringify&#160;function,&#160;<a href="eloquent-javascripts.html#90">78</a><br/>
<a href="eloquent-javascripts.html#200">188</a>,&#160;<a href="eloquent-javascripts.html#277">265</a>,&#160;<a href="eloquent-javascripts.html#311">299</a>,&#160;<a href="eloquent-javascripts.html#332">320,&#160;</a><a href="eloquent-javascripts.html#343">331</a><br/>
JSX,&#160;<a href="eloquent-javascripts.html#396">384</a><br/>
interface&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
jump,&#160;<a href="eloquent-javascripts.html#16">4</a><br/>
internationalization,&#160;<a href="eloquent-javascripts.html#174">162</a><br/>
jump-and-run&#160;game,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
Internet,&#160;<a href="eloquent-javascripts.html#172">160,&#160;</a><a href="eloquent-javascripts.html#228">216–</a><a href="eloquent-javascripts.html#230">218,&#160;</a><a href="eloquent-javascripts.html#234">222</a><br/>
jumping,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#291">279</a><br/>
Internet&#160;Explorer,&#160;<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#235">223<br/></a>interpolation,&#160;<a href="eloquent-javascripts.html#27">15</a><br/>
Kernighan,&#160;Brian,&#160;<a href="eloquent-javascripts.html#140">128</a><br/>
422<br/>
<hr/>
<a name=435></a>key&#160;code,&#160;<a href="eloquent-javascripts.html#291">279</a><br/>
let&#160;keyword,&#160;<a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#36">24,&#160;</a><a href="eloquent-javascripts.html#53">41</a>,&#160;<a href="eloquent-javascripts.html#76">64,&#160;</a><a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#89">77,</a><br/>
key&#160;property,&#160;<a href="eloquent-javascripts.html#260">248</a>,&#160;<a href="eloquent-javascripts.html#412">400</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
<a href="eloquent-javascripts.html#141">129</a><br/>
keyboard,&#160;<a href="eloquent-javascripts.html#37">25,&#160;</a><a href="eloquent-javascripts.html#255">243</a>,&#160;<a href="eloquent-javascripts.html#259">247,&#160;</a><a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#291">279,&#160;</a><a href="eloquent-javascripts.html#295">283</a>,<br/>
level,&#160;<a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#275">263</a>,&#160;<a href="eloquent-javascripts.html#281">269,&#160;</a><a href="eloquent-javascripts.html#282">270</a>,&#160;<a href="eloquent-javascripts.html#284">272</a>,&#160;<a href="eloquent-javascripts.html#293">281,</a><br/>
<a href="eloquent-javascripts.html#329">317</a>,&#160;<a href="eloquent-javascripts.html#330">318</a>,&#160;<a href="eloquent-javascripts.html#332">320</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
<a href="eloquent-javascripts.html#294">282</a><br/>
keyboard&#160;bindings&#160;(exercise),&#160;<a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#418">406</a><br/>
Level&#160;class,&#160;<a href="eloquent-javascripts.html#275">263</a><br/>
keyboard&#160;focus,&#160;<i>see&#160;</i>focus<br/>
lexical&#160;scoping,&#160;<a href="eloquent-javascripts.html#54">42</a><br/>
keydown&#160;event,&#160;<a href="eloquent-javascripts.html#259">247,&#160;</a><a href="eloquent-javascripts.html#270">258</a>,&#160;<a href="eloquent-javascripts.html#292">280,&#160;</a><a href="eloquent-javascripts.html#360">348</a>,<br/>
library,&#160;<a href="eloquent-javascripts.html#239">227,&#160;</a><a href="eloquent-javascripts.html#343">331,&#160;</a><a href="eloquent-javascripts.html#365">353</a>,&#160;<a href="eloquent-javascripts.html#366">354</a><br/>
<a href="eloquent-javascripts.html#412">400</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
license,&#160;<a href="eloquent-javascripts.html#181">169</a><br/>
keyup&#160;event,&#160;<a href="eloquent-javascripts.html#259">247</a>,&#160;<a href="eloquent-javascripts.html#292">280</a><br/>
line,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#43">31,&#160;</a><a href="eloquent-javascripts.html#173">161</a>,&#160;<a href="eloquent-javascripts.html#296">284</a>,&#160;<a href="eloquent-javascripts.html#298">286</a>–<a href="eloquent-javascripts.html#301">289</a>,&#160;<a href="eloquent-javascripts.html#303">291,</a><br/>
keyword,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#37">25,&#160;</a><a href="eloquent-javascripts.html#244">232</a><br/>
<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
Khasekhemwy,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
line&#160;break,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#173">161</a><br/>
kill&#160;process,&#160;<a href="eloquent-javascripts.html#370">358</a><br/>
line&#160;comment,&#160;<a href="eloquent-javascripts.html#48">36,&#160;</a><a href="eloquent-javascripts.html#168">156</a><br/>
Knuth,&#160;Donald,&#160;<a href="eloquent-javascripts.html#51">39</a><br/>
line&#160;drawing,&#160;<a href="eloquent-javascripts.html#361">349,&#160;</a><a href="eloquent-javascripts.html#419">407<br/></a>line&#160;width,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#307">295</a><br/>
label,&#160;<a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#318">306</a><br/>
lines&#160;of&#160;code,&#160;<a href="eloquent-javascripts.html#223">211</a><br/>
label&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#333">321,&#160;</a><a href="eloquent-javascripts.html#350">338</a><br/>
lineTo&#160;method,&#160;<a href="eloquent-javascripts.html#299">287</a><br/>
labeling,&#160;<a href="eloquent-javascripts.html#333">321</a><br/>
lineWidth&#160;property,&#160;<a href="eloquent-javascripts.html#298">286</a><br/>
landscape&#160;example,&#160;<a href="eloquent-javascripts.html#54">42</a><br/>
link,&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#259">247</a>,&#160;<a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#354">342</a><br/>
Laozi,&#160;<a href="eloquent-javascripts.html#192">180</a><br/>
link&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#286">274</a><br/>
Last-Modified&#160;header,&#160;<a href="eloquent-javascripts.html#322">310</a><br/>
linked&#160;list,&#160;<a href="eloquent-javascripts.html#92">80,&#160;</a><a href="eloquent-javascripts.html#403">391</a><br/>
lastChild&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
linter,&#160;<a href="eloquent-javascripts.html#185">173</a><br/>
lastIndex&#160;property,&#160;<a href="eloquent-javascripts.html#170">158</a>,&#160;<a href="eloquent-javascripts.html#171">159</a><br/>
Liskov,&#160;Barbara,&#160;<a href="eloquent-javascripts.html#109">97</a><br/>
lastIndexOf&#160;method,&#160;<a href="eloquent-javascripts.html#83">71</a><br/>
list&#160;(exercise),&#160;<a href="eloquent-javascripts.html#92">80,&#160;</a><a href="eloquent-javascripts.html#403">391</a><br/>
latency,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
listen&#160;method,&#160;<a href="eloquent-javascripts.html#369">357</a>,&#160;<a href="eloquent-javascripts.html#370">358</a><br/>
lava,&#160;<a href="eloquent-javascripts.html#273">261</a>–<a href="eloquent-javascripts.html#275">263</a>,&#160;<a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#289">277,&#160;</a><a href="eloquent-javascripts.html#290">278</a>,<br/>
listening&#160;(TCP),&#160;<a href="eloquent-javascripts.html#229">217</a>,&#160;<a href="eloquent-javascripts.html#369">357</a><br/>
<a href="eloquent-javascripts.html#315">303</a><br/>
literal&#160;expression,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#217">205,&#160;</a><a href="eloquent-javascripts.html#219">207</a><br/>
Lava&#160;class,&#160;<a href="eloquent-javascripts.html#278">266,&#160;</a><a href="eloquent-javascripts.html#289">277</a><br/>
live&#160;data&#160;structure,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#243">231</a>,&#160;<a href="eloquent-javascripts.html#250">238,</a><br/>
layering,&#160;<a href="eloquent-javascripts.html#206">194,&#160;</a><a href="eloquent-javascripts.html#229">217</a><br/>
<a href="eloquent-javascripts.html#413">401</a><br/>
layout,&#160;<a href="eloquent-javascripts.html#245">233</a>–<a href="eloquent-javascripts.html#247">235</a><br/>
live&#160;view,&#160;<a href="eloquent-javascripts.html#382">370</a>,&#160;<a href="eloquent-javascripts.html#383">371</a>,&#160;<a href="eloquent-javascripts.html#398">386,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
laziness,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
lives&#160;(exercise),&#160;<a href="eloquent-javascripts.html#294">282</a><br/>
Le&#160;Guin,&#160;Ursula&#160;K.,&#160;<a href="eloquent-javascripts.html#14">2</a><br/>
load&#160;event,&#160;<a href="eloquent-javascripts.html#267">255,&#160;</a><a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#314">302</a>,&#160;<a href="eloquent-javascripts.html#336">324</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
leaf&#160;node,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
LoadButton&#160;class,&#160;<a href="eloquent-javascripts.html#355">343</a><br/>
leak,&#160;<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#295">283</a><br/>
local&#160;binding,&#160;<a href="eloquent-javascripts.html#59">47,&#160;</a><a href="eloquent-javascripts.html#227">215,&#160;</a><a href="eloquent-javascripts.html#402">390</a><br/>
learning,&#160;<a href="eloquent-javascripts.html#14">2</a>,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#19">7,&#160;</a><a href="eloquent-javascripts.html#381">369</a><br/>
local&#160;scope,&#160;<a href="eloquent-javascripts.html#52">40</a>,&#160;<a href="eloquent-javascripts.html#224">212</a><br/>
left&#160;(CSS),&#160;<a href="eloquent-javascripts.html#250">238–</a><a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#254">242</a><br/>
localhost,&#160;<a href="eloquent-javascripts.html#369">357</a><br/>
LEGO,&#160;<a href="eloquent-javascripts.html#179">167</a><br/>
localStorage&#160;object,&#160;<a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#338">326,&#160;</a><a href="eloquent-javascripts.html#394">382</a><br/>
length&#160;property<br/>
locked&#160;box&#160;(exercise),&#160;<a href="eloquent-javascripts.html#154">142</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
for&#160;array,&#160;<a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
logging,&#160;<a href="eloquent-javascripts.html#145">133</a><br/>
for&#160;string,&#160;<a href="eloquent-javascripts.html#64">52</a>,&#160;<a href="eloquent-javascripts.html#68">56,&#160;</a><a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#85">73</a>,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
logical&#160;and,&#160;<a href="eloquent-javascripts.html#29">17</a><br/>
less&#160;than,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
logical&#160;operators,&#160;<a href="eloquent-javascripts.html#29">17</a><br/>
423<br/>
<hr/>
<a name=436></a>logical&#160;or,&#160;<a href="eloquent-javascripts.html#29">17</a><br/>
Math.sin&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#280">268</a>,&#160;<a href="eloquent-javascripts.html#290">278</a><br/>
long&#160;polling,&#160;<a href="eloquent-javascripts.html#382">370–</a><a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#389">377,&#160;</a><a href="eloquent-javascripts.html#391">379</a>,&#160;<a href="eloquent-javascripts.html#397">385</a><br/>
Math.sqrt&#160;function,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#87">75,&#160;</a><a href="eloquent-javascripts.html#405">393</a><br/>
loop,&#160;<a href="eloquent-javascripts.html#16">4</a>,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#44">32</a>,&#160;<a href="eloquent-javascripts.html#49">37,&#160;</a><a href="eloquent-javascripts.html#50">38,&#160;</a><a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#80">68</a>,&#160;<a href="eloquent-javascripts.html#95">83</a>,<br/>
Math.tan&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
<a href="eloquent-javascripts.html#96">84,&#160;</a><a href="eloquent-javascripts.html#102">90,&#160;</a><a href="eloquent-javascripts.html#103">91</a>,&#160;<a href="eloquent-javascripts.html#171">159</a>,&#160;<a href="eloquent-javascripts.html#201">189</a>,&#160;<a href="eloquent-javascripts.html#401">389</a>,&#160;<a href="eloquent-javascripts.html#402">390</a>,<br/>
mathematics,&#160;<a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#97">85</a><br/>
<a href="eloquent-javascripts.html#415">403</a><br/>
Matrix&#160;class,&#160;<a href="eloquent-javascripts.html#120">108</a>,&#160;<a href="eloquent-javascripts.html#344">332</a><br/>
termination&#160;of,&#160;<a href="eloquent-javascripts.html#45">33</a><br/>
matrix&#160;example,&#160;<a href="eloquent-javascripts.html#120">108,&#160;</a><a href="eloquent-javascripts.html#124">112</a><br/>
loop&#160;body,&#160;<a href="eloquent-javascripts.html#43">31</a>,&#160;<a href="eloquent-javascripts.html#96">84</a><br/>
MatrixIterator&#160;class,&#160;<a href="eloquent-javascripts.html#121">109</a><br/>
lycanthropy,&#160;<a href="eloquent-javascripts.html#69">57</a>,&#160;<a href="eloquent-javascripts.html#76">64</a><br/>
max&#160;example,&#160;<a href="eloquent-javascripts.html#86">74<br/></a>max-height&#160;(CSS),&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
machine&#160;code,&#160;<a href="eloquent-javascripts.html#15">3,&#160;</a><a href="eloquent-javascripts.html#225">213</a><br/>
max-width&#160;(CSS),&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
mafia,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
maximum,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#101">89</a>,&#160;<a href="eloquent-javascripts.html#102">90</a><br/>
magic,&#160;<a href="eloquent-javascripts.html#111">99</a>,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
Meadowfield,&#160;<a href="eloquent-javascripts.html#129">117</a><br/>
mailRoute&#160;array,&#160;<a href="eloquent-javascripts.html#136">124</a><br/>
measuring&#160;a&#160;robot&#160;(exercise),&#160;<a href="eloquent-javascripts.html#138">126,</a><br/>
maintenance,&#160;<a href="eloquent-javascripts.html#181">169</a><br/>
<a href="eloquent-javascripts.html#406">394</a><br/>
malicious&#160;script,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
media&#160;type,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#340">328</a>,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
man-in-the-middle,&#160;<a href="eloquent-javascripts.html#326">314</a><br/>
meetup,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
map,&#160;<a href="eloquent-javascripts.html#280">268,&#160;</a><a href="eloquent-javascripts.html#331">319</a><br/>
memory,&#160;<a href="eloquent-javascripts.html#15">3</a>,&#160;<a href="eloquent-javascripts.html#22">10</a><br/>
map&#160;(data&#160;structure),&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
call<br/>
Map&#160;class,&#160;<a href="eloquent-javascripts.html#117">105</a>,&#160;<a href="eloquent-javascripts.html#122">110</a>,&#160;<a href="eloquent-javascripts.html#207">195</a><br/>
stack,&#160;<a href="eloquent-javascripts.html#57">45</a><br/>
map&#160;method,&#160;<a href="eloquent-javascripts.html#100">88</a>,&#160;<a href="eloquent-javascripts.html#102">90</a>,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#111">99</a>,&#160;<a href="eloquent-javascripts.html#116">104</a>,<br/>
organization,&#160;<a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#70">58</a>,&#160;<a href="eloquent-javascripts.html#75">63,&#160;</a><a href="eloquent-javascripts.html#89">77</a><br/>
<a href="eloquent-javascripts.html#132">120</a>,&#160;<a href="eloquent-javascripts.html#202">190</a>,&#160;<a href="eloquent-javascripts.html#276">264</a>,&#160;<a href="eloquent-javascripts.html#350">338</a><br/>
persistence,&#160;<a href="eloquent-javascripts.html#399">387</a><br/>
Marcus&#160;Aurelius,&#160;<a href="eloquent-javascripts.html#255">243</a><br/>
speed,&#160;<a href="eloquent-javascripts.html#192">180,&#160;</a><a href="eloquent-javascripts.html#224">212</a><br/>
match&#160;method,&#160;<a href="eloquent-javascripts.html#159">147</a>,&#160;<a href="eloquent-javascripts.html#171">159</a><br/>
structure<br/>
matching,&#160;<a href="eloquent-javascripts.html#156">144,&#160;</a><a href="eloquent-javascripts.html#162">150,&#160;</a><a href="eloquent-javascripts.html#170">158,&#160;</a><a href="eloquent-javascripts.html#177">165</a><br/>
sharing,&#160;<a href="eloquent-javascripts.html#92">80</a><br/>
algorithm,&#160;<a href="eloquent-javascripts.html#163">151</a>–<a href="eloquent-javascripts.html#165">153</a><br/>
mesh,&#160;<a href="eloquent-javascripts.html#230">218</a><br/>
Math&#160;object,&#160;<a href="eloquent-javascripts.html#67">55</a>,&#160;<a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
message&#160;event,&#160;<a href="eloquent-javascripts.html#268">256</a><br/>
Math.abs&#160;function,&#160;<a href="eloquent-javascripts.html#88">76,&#160;</a><a href="eloquent-javascripts.html#419">407</a><br/>
meta&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
Math.acos&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
metaKey&#160;property,&#160;<a href="eloquent-javascripts.html#260">248</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
Math.asin&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
method,&#160;<a href="eloquent-javascripts.html#72">60</a>,&#160;<a href="eloquent-javascripts.html#110">98,&#160;</a><a href="eloquent-javascripts.html#113">101,&#160;</a><a href="eloquent-javascripts.html#141">129</a>,&#160;<a href="eloquent-javascripts.html#370">358</a><br/>
Math.atan&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
array,&#160;<a href="eloquent-javascripts.html#82">70</a><br/>
Math.ceil&#160;function,&#160;<a href="eloquent-javascripts.html#88">76,&#160;</a><a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#313">301</a><br/>
HTTP,&#160;<a href="eloquent-javascripts.html#321">309</a>,&#160;<a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#378">366,&#160;</a><a href="eloquent-javascripts.html#383">371,</a><br/>
Math.cos&#160;function,&#160;<a href="eloquent-javascripts.html#87">75,&#160;</a><a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
<a href="eloquent-javascripts.html#386">374</a><br/>
Math.floor&#160;function,&#160;<a href="eloquent-javascripts.html#88">76,&#160;</a><a href="eloquent-javascripts.html#135">123</a>,&#160;<a href="eloquent-javascripts.html#287">275,&#160;</a><a href="eloquent-javascripts.html#313">301</a><br/>
interface,&#160;<a href="eloquent-javascripts.html#109">97</a><br/>
Math.max&#160;function,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#87">75</a>,<br/>
method&#160;attribute,&#160;<a href="eloquent-javascripts.html#322">310</a><br/>
<a href="eloquent-javascripts.html#312">300</a><br/>
method&#160;call,&#160;<a href="eloquent-javascripts.html#110">98</a><br/>
Math.min&#160;function,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#67">55</a>,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#312">300</a><br/>
method&#160;property,&#160;<a href="eloquent-javascripts.html#325">313</a><br/>
Math.PI&#160;constant,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#302">290</a><br/>
methods&#160;object,&#160;<a href="eloquent-javascripts.html#373">361</a><br/>
Math.random&#160;function,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#135">123</a>,&#160;<a href="eloquent-javascripts.html#280">268</a>,<br/>
Microsoft,&#160;<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
<a href="eloquent-javascripts.html#341">329</a><br/>
mime&#160;package,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
Math.round&#160;function,&#160;<a href="eloquent-javascripts.html#88">76</a><br/>
MIME&#160;type,&#160;<a href="eloquent-javascripts.html#340">328</a>,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
424<br/>
<hr/>
<a name=437></a>mini&#160;application,&#160;<a href="eloquent-javascripts.html#337">325</a><br/>
multiplication,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#278">266</a>,&#160;<a href="eloquent-javascripts.html#290">278</a><br/>
minifier,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
multiplier&#160;function,&#160;<a href="eloquent-javascripts.html#60">48</a><br/>
minimalism,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
music,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
minimum,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#67">55,&#160;</a><a href="eloquent-javascripts.html#87">75</a><br/>
mutability,&#160;<a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#75">63</a>,&#160;<a href="eloquent-javascripts.html#133">121</a><br/>
minimum&#160;(exercise),&#160;<a href="eloquent-javascripts.html#67">55</a>,&#160;<a href="eloquent-javascripts.html#401">389<br/></a>minus,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#178">166</a><br/>
name&#160;attribute,&#160;<a href="eloquent-javascripts.html#331">319,&#160;</a><a href="eloquent-javascripts.html#334">322</a><br/>
Miro,&#160;Joan,&#160;<a href="eloquent-javascripts.html#342">330</a><br/>
namespace,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
mirror,&#160;<a href="eloquent-javascripts.html#308">296,&#160;</a><a href="eloquent-javascripts.html#319">307,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
naming,&#160;<a href="eloquent-javascripts.html#16">4</a>,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
mirroring,&#160;<a href="eloquent-javascripts.html#307">295</a>,&#160;<a href="eloquent-javascripts.html#308">296</a><br/>
NaN,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#30">18,&#160;</a><a href="eloquent-javascripts.html#140">128</a><br/>
MKCOL&#160;method,&#160;<a href="eloquent-javascripts.html#379">367</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
negation,&#160;<a href="eloquent-javascripts.html#27">15</a>,&#160;<a href="eloquent-javascripts.html#29">17</a><br/>
mkdir&#160;function,&#160;<a href="eloquent-javascripts.html#379">367,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
neighbor,&#160;<a href="eloquent-javascripts.html#341">329,&#160;</a><a href="eloquent-javascripts.html#417">405</a><br/>
modification&#160;date,&#160;<a href="eloquent-javascripts.html#376">364</a><br/>
neighbors&#160;property,&#160;<a href="eloquent-javascripts.html#202">190</a><br/>
modifier&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
nerd,&#160;<a href="eloquent-javascripts.html#169">157</a><br/>
modular&#160;robot&#160;(exercise),&#160;<a href="eloquent-javascripts.html#190">178,&#160;</a><a href="eloquent-javascripts.html#408">396</a><br/>
nesting<br/>
modularity,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#343">331</a><br/>
in&#160;regexps,&#160;<a href="eloquent-javascripts.html#165">153</a><br/>
module,&#160;<a href="eloquent-javascripts.html#179">167</a>,&#160;<a href="eloquent-javascripts.html#181">169</a>,&#160;<a href="eloquent-javascripts.html#190">178,&#160;</a><a href="eloquent-javascripts.html#281">269,&#160;</a><a href="eloquent-javascripts.html#364">352</a>,&#160;<a href="eloquent-javascripts.html#365">353</a>,<br/>
of&#160;arrays,&#160;<a href="eloquent-javascripts.html#78">66</a><br/>
<a href="eloquent-javascripts.html#386">374</a><br/>
of&#160;expressions,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#216">204</a><br/>
design,&#160;<a href="eloquent-javascripts.html#188">176</a><br/>
of&#160;functions,&#160;<a href="eloquent-javascripts.html#54">42</a><br/>
module&#160;loader,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
of&#160;loops,&#160;<a href="eloquent-javascripts.html#50">38,&#160;</a><a href="eloquent-javascripts.html#401">389</a><br/>
module&#160;object,&#160;<a href="eloquent-javascripts.html#185">173</a><br/>
of&#160;objects,&#160;<a href="eloquent-javascripts.html#237">225,&#160;</a><a href="eloquent-javascripts.html#240">228</a><br/>
module&#160;system,&#160;<a href="eloquent-javascripts.html#181">169</a><br/>
of&#160;scope,&#160;<a href="eloquent-javascripts.html#54">42</a><br/>
modulo&#160;operator,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
Netscape,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
Mongolian&#160;vowel&#160;separator,&#160;<a href="eloquent-javascripts.html#174">162</a><br/>
network,&#160;<a href="eloquent-javascripts.html#192">180,&#160;</a><a href="eloquent-javascripts.html#228">216</a>,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
monster&#160;(exercise),&#160;<a href="eloquent-javascripts.html#295">283,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
abstraction,&#160;<a href="eloquent-javascripts.html#206">194,&#160;</a><a href="eloquent-javascripts.html#326">314</a><br/>
Mosaic,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
protocol,&#160;<a href="eloquent-javascripts.html#228">216</a><br/>
motion,&#160;<a href="eloquent-javascripts.html#274">262</a><br/>
reliability,&#160;<a href="eloquent-javascripts.html#200">188</a><br/>
mouse,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
security,&#160;<a href="eloquent-javascripts.html#326">314</a><br/>
mouse&#160;button,&#160;<a href="eloquent-javascripts.html#257">245</a>,&#160;<a href="eloquent-javascripts.html#258">246</a>,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
speed,&#160;<a href="eloquent-javascripts.html#187">175,&#160;</a><a href="eloquent-javascripts.html#192">180,&#160;</a><a href="eloquent-javascripts.html#362">350</a><br/>
mouse&#160;cursor,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
network&#160;function,&#160;<a href="eloquent-javascripts.html#206">194</a><br/>
mouse&#160;trail&#160;(exercise),&#160;<a href="eloquent-javascripts.html#272">260</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
new&#160;operator,&#160;<a href="eloquent-javascripts.html#113">101</a><br/>
mousedown&#160;event,&#160;<a href="eloquent-javascripts.html#258">246</a>,&#160;<a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#264">252</a>,&#160;<a href="eloquent-javascripts.html#346">334,</a><br/>
newline&#160;character,&#160;<a href="eloquent-javascripts.html#25">13,&#160;</a><a href="eloquent-javascripts.html#50">38,&#160;</a><a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#168">156,</a><br/>
<a href="eloquent-javascripts.html#347">335</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
<a href="eloquent-javascripts.html#173">161,&#160;</a><a href="eloquent-javascripts.html#276">264</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
mousemove&#160;event,&#160;<a href="eloquent-javascripts.html#262">250</a>,&#160;<a href="eloquent-javascripts.html#263">251,&#160;</a><a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#270">258,</a><br/>
next&#160;method,&#160;<a href="eloquent-javascripts.html#120">108</a>,&#160;<a href="eloquent-javascripts.html#209">197,&#160;</a><a href="eloquent-javascripts.html#405">393</a><br/>
<a href="eloquent-javascripts.html#272">260</a>,&#160;<a href="eloquent-javascripts.html#347">335</a>,&#160;<a href="eloquent-javascripts.html#361">349</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
nextSibling&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
mouseup&#160;event,&#160;<a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#263">251</a>,&#160;<a href="eloquent-javascripts.html#264">252</a><br/>
node,&#160;<a href="eloquent-javascripts.html#237">225</a>,&#160;<a href="eloquent-javascripts.html#238">226</a><br/>
moveTo&#160;method,&#160;<a href="eloquent-javascripts.html#299">287,&#160;</a><a href="eloquent-javascripts.html#303">291</a><br/>
node&#160;program,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
Mozilla,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
node-fetch&#160;package,&#160;<a href="eloquent-javascripts.html#371">359</a><br/>
multiple&#160;attribute,&#160;<a href="eloquent-javascripts.html#334">322</a>–<a href="eloquent-javascripts.html#336">324</a><br/>
Node.js,&#160;<a href="eloquent-javascripts.html#19">7,&#160;</a><a href="eloquent-javascripts.html#20">8,&#160;</a><a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#193">181,&#160;</a><a href="eloquent-javascripts.html#362">350–</a><a href="eloquent-javascripts.html#365">353,</a><br/>
multiple&#160;choice,&#160;<a href="eloquent-javascripts.html#328">316</a><br/>
<a href="eloquent-javascripts.html#367">355–</a><a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#375">363</a>–<a href="eloquent-javascripts.html#378">366</a>,&#160;<a href="eloquent-javascripts.html#381">369–</a><br/>
multiple-choice,&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#334">322</a><br/>
<a href="eloquent-javascripts.html#383">371,&#160;</a><a href="eloquent-javascripts.html#385">373</a>,&#160;<a href="eloquent-javascripts.html#399">387</a><br/>
425<br/>
<hr/>
<a name=438></a>node_modules&#160;directory,&#160;<a href="eloquent-javascripts.html#364">352</a>,&#160;<a href="eloquent-javascripts.html#366">354</a><br/>
Object.keys&#160;function,&#160;<a href="eloquent-javascripts.html#74">62,&#160;</a><a href="eloquent-javascripts.html#93">81,&#160;</a><a href="eloquent-javascripts.html#207">195</a>,&#160;<a href="eloquent-javascripts.html#403">391,</a><br/>
NodeList&#160;type,&#160;<a href="eloquent-javascripts.html#239">227</a>,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
<a href="eloquent-javascripts.html#412">400</a><br/>
nodeName&#160;property,&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
Object.prototype,&#160;<a href="eloquent-javascripts.html#117">105</a><br/>
nodeType&#160;property,&#160;<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#412">400,&#160;</a><a href="eloquent-javascripts.html#413">401</a><br/>
obstacle,&#160;<a href="eloquent-javascripts.html#286">274</a>,&#160;<a href="eloquent-javascripts.html#287">275</a><br/>
nodeValue&#160;property,&#160;<a href="eloquent-javascripts.html#240">228</a><br/>
offsetHeight&#160;property,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
nonbreaking&#160;space,&#160;<a href="eloquent-javascripts.html#174">162</a><br/>
offsetWidth&#160;property,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
not&#160;a&#160;number,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
on&#160;method,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
notation,&#160;<a href="eloquent-javascripts.html#185">173</a><br/>
onclick&#160;attribute,&#160;<a href="eloquent-javascripts.html#233">221</a>,&#160;<a href="eloquent-javascripts.html#256">244</a><br/>
note-taking&#160;example,&#160;<a href="eloquent-javascripts.html#338">326</a><br/>
onclick&#160;property,&#160;<a href="eloquent-javascripts.html#346">334</a><br/>
notification,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
OpenGL,&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
NPM,&#160;<a href="eloquent-javascripts.html#180">168,&#160;</a><a href="eloquent-javascripts.html#181">169</a>,&#160;<a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#185">173</a>,&#160;<a href="eloquent-javascripts.html#187">175,&#160;</a><a href="eloquent-javascripts.html#189">177</a>,<br/>
opening&#160;tag,&#160;<a href="eloquent-javascripts.html#231">219</a><br/>
<a href="eloquent-javascripts.html#190">178</a>,&#160;<a href="eloquent-javascripts.html#364">352–</a><a href="eloquent-javascripts.html#367">355,&#160;</a><a href="eloquent-javascripts.html#375">363,&#160;</a><a href="eloquent-javascripts.html#386">374</a>,&#160;<a href="eloquent-javascripts.html#387">375</a>,<br/>
operator,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#27">15</a>,&#160;<a href="eloquent-javascripts.html#28">16,&#160;</a><a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#215">203,&#160;</a><a href="eloquent-javascripts.html#222">210</a><br/>
<a href="eloquent-javascripts.html#399">387</a>,&#160;<a href="eloquent-javascripts.html#408">396</a><br/>
application,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
npm&#160;program,&#160;<a href="eloquent-javascripts.html#365">353</a>,&#160;<a href="eloquent-javascripts.html#366">354</a>,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
optimization,&#160;<a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#66">54</a>,&#160;<a href="eloquent-javascripts.html#246">234,&#160;</a><a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#274">262,</a><br/>
null,&#160;<a href="eloquent-javascripts.html#30">18,&#160;</a><a href="eloquent-javascripts.html#31">19</a>,&#160;<a href="eloquent-javascripts.html#62">50,&#160;</a><a href="eloquent-javascripts.html#71">59,&#160;</a><a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#93">81,&#160;</a><a href="eloquent-javascripts.html#146">134</a><br/>
<a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#316">304</a>,&#160;<a href="eloquent-javascripts.html#319">307</a>,&#160;<a href="eloquent-javascripts.html#369">357</a><br/>
number,&#160;<a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#75">63,&#160;</a><a href="eloquent-javascripts.html#156">144</a>,&#160;<a href="eloquent-javascripts.html#178">166</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
option&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#329">317,&#160;</a><a href="eloquent-javascripts.html#334">322,</a><br/>
conversion&#160;to,&#160;<a href="eloquent-javascripts.html#31">19,&#160;</a><a href="eloquent-javascripts.html#39">27</a><br/>
<a href="eloquent-javascripts.html#420">408</a><br/>
notation,&#160;<a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
optional,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
precision&#160;of,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
optional&#160;argument,&#160;<a href="eloquent-javascripts.html#58">46</a>,&#160;<a href="eloquent-javascripts.html#91">79</a><br/>
representation,&#160;<a href="eloquent-javascripts.html#23">11</a><br/>
options&#160;property,&#160;<a href="eloquent-javascripts.html#335">323</a><br/>
special&#160;values,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
ordering,&#160;<a href="eloquent-javascripts.html#229">217</a><br/>
Number&#160;function,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#40">28,&#160;</a><a href="eloquent-javascripts.html#47">35</a><br/>
ordinal&#160;package,&#160;<a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#185">173</a><br/>
number&#160;puzzle&#160;example,&#160;<a href="eloquent-javascripts.html#62">50</a><br/>
organic&#160;growth,&#160;<a href="eloquent-javascripts.html#179">167</a><br/>
Number.isNaN&#160;function,&#160;<a href="eloquent-javascripts.html#40">28</a><br/>
organization,&#160;<a href="eloquent-javascripts.html#179">167<br/></a>outline,&#160;<a href="eloquent-javascripts.html#298">286</a><br/>
object,&#160;<a href="eloquent-javascripts.html#69">57</a>,&#160;<a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#74">62</a>,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#125">113</a><br/>
output,&#160;<a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#145">133,&#160;</a><a href="eloquent-javascripts.html#146">134</a>,&#160;<a href="eloquent-javascripts.html#222">210</a>,&#160;<a href="eloquent-javascripts.html#362">350,</a><br/>
as<br/>
<a href="eloquent-javascripts.html#417">405</a><br/>
module,&#160;<a href="eloquent-javascripts.html#181">169</a><br/>
overflow,&#160;<a href="eloquent-javascripts.html#23">11</a><br/>
as&#160;map,&#160;<a href="eloquent-javascripts.html#280">268</a><br/>
overflow&#160;(CSS),&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
creation,&#160;<a href="eloquent-javascripts.html#89">77,&#160;</a><a href="eloquent-javascripts.html#113">101</a>,&#160;<a href="eloquent-javascripts.html#339">327</a><br/>
overlap,&#160;<a href="eloquent-javascripts.html#287">275</a><br/>
identity,&#160;<a href="eloquent-javascripts.html#75">63</a><br/>
overlay,&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
mutability,&#160;<a href="eloquent-javascripts.html#75">63</a><br/>
overriding,&#160;<a href="eloquent-javascripts.html#115">103,&#160;</a><a href="eloquent-javascripts.html#118">106,&#160;</a><a href="eloquent-javascripts.html#124">112</a>,&#160;<a href="eloquent-javascripts.html#409">397</a><br/>
property,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#71">59,&#160;</a><a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#111">99</a><br/>
overwriting,&#160;<a href="eloquent-javascripts.html#377">365</a>,&#160;<a href="eloquent-javascripts.html#380">368,&#160;</a><a href="eloquent-javascripts.html#389">377</a><br/>
representation,&#160;<a href="eloquent-javascripts.html#89">77</a><br/>
Object&#160;prototype,&#160;<a href="eloquent-javascripts.html#111">99,&#160;</a><a href="eloquent-javascripts.html#112">100</a><br/>
p&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#245">233</a><br/>
object-oriented&#160;programming,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#113">101,</a><br/>
package,&#160;<a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#364">352,&#160;</a><a href="eloquent-javascripts.html#367">355</a><br/>
<a href="eloquent-javascripts.html#118">106</a>,&#160;<a href="eloquent-javascripts.html#124">112</a>,&#160;<a href="eloquent-javascripts.html#131">119</a>,&#160;<a href="eloquent-javascripts.html#188">176</a><br/>
package&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
Object.assign&#160;function,&#160;<a href="eloquent-javascripts.html#339">327,&#160;</a><a href="eloquent-javascripts.html#345">333</a><br/>
package&#160;manager,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
Object.create&#160;function,&#160;<a href="eloquent-javascripts.html#112">100,&#160;</a><a href="eloquent-javascripts.html#117">105</a>,&#160;<a href="eloquent-javascripts.html#223">211</a><br/>
package.json,&#160;<a href="eloquent-javascripts.html#366">354</a>,&#160;<a href="eloquent-javascripts.html#367">355<br/></a>padding&#160;(CSS),&#160;<a href="eloquent-javascripts.html#283">271</a><br/>
426<br/>
<hr/>
<a name=439></a>page&#160;reload,&#160;<a href="eloquent-javascripts.html#267">255</a>,&#160;<a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#337">325</a><br/>
peanuts,&#160;<a href="eloquent-javascripts.html#82">70</a><br/>
pageX&#160;property,&#160;<a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#264">252</a><br/>
percent&#160;sign,&#160;<a href="eloquent-javascripts.html#323">311</a><br/>
pageXOffset&#160;property,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
percentage,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#266">254</a><br/>
pageY&#160;property,&#160;<a href="eloquent-javascripts.html#261">249</a>,&#160;<a href="eloquent-javascripts.html#264">252</a><br/>
performance,&#160;<a href="eloquent-javascripts.html#165">153,&#160;</a><a href="eloquent-javascripts.html#187">175</a>,&#160;<a href="eloquent-javascripts.html#224">212,&#160;</a><a href="eloquent-javascripts.html#245">233</a>,&#160;<a href="eloquent-javascripts.html#274">262,</a><br/>
pageYOffset&#160;property,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#266">254</a><br/>
<a href="eloquent-javascripts.html#316">304,&#160;</a><a href="eloquent-javascripts.html#369">357</a><br/>
Palef,&#160;Thomas,&#160;<a href="eloquent-javascripts.html#273">261</a><br/>
period&#160;character,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#168">156</a>,<br/>
panning,&#160;<a href="eloquent-javascripts.html#348">336</a><br/>
<a href="eloquent-javascripts.html#178">166,&#160;</a><a href="eloquent-javascripts.html#345">333</a><br/>
paragraph,&#160;<a href="eloquent-javascripts.html#231">219</a><br/>
persistence,&#160;<a href="eloquent-javascripts.html#337">325</a>,&#160;<a href="eloquent-javascripts.html#381">369,&#160;</a><a href="eloquent-javascripts.html#399">387,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
parallelism,&#160;<a href="eloquent-javascripts.html#193">181,&#160;</a><a href="eloquent-javascripts.html#322">310</a><br/>
persistent&#160;data&#160;structure,&#160;<a href="eloquent-javascripts.html#131">119,&#160;</a><a href="eloquent-javascripts.html#133">121,</a><br/>
parameter,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#56">44,&#160;</a><a href="eloquent-javascripts.html#58">46</a>,&#160;<a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#88">76</a>,<br/>
<a href="eloquent-javascripts.html#139">127,&#160;</a><a href="eloquent-javascripts.html#144">132</a>,&#160;<a href="eloquent-javascripts.html#344">332</a>,&#160;<a href="eloquent-javascripts.html#352">340</a>,&#160;<a href="eloquent-javascripts.html#357">345,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
<a href="eloquent-javascripts.html#110">98,&#160;</a><a href="eloquent-javascripts.html#142">130,&#160;</a><a href="eloquent-javascripts.html#185">173</a><br/>
persistent&#160;group&#160;(exercise),&#160;<a href="eloquent-javascripts.html#139">127</a><br/>
parent&#160;node,&#160;<a href="eloquent-javascripts.html#257">245</a><br/>
persistent&#160;map&#160;(exercise),&#160;<a href="eloquent-javascripts.html#406">394</a><br/>
parentheses,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
PGroup&#160;class,&#160;<a href="eloquent-javascripts.html#139">127</a>,&#160;<a href="eloquent-javascripts.html#406">394</a><br/>
arguments,&#160;<a href="eloquent-javascripts.html#38">26,&#160;</a><a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#56">44,&#160;</a><a href="eloquent-javascripts.html#96">84,&#160;</a><a href="eloquent-javascripts.html#214">202</a><br/>
phase,&#160;<a href="eloquent-javascripts.html#279">267</a>,&#160;<a href="eloquent-javascripts.html#280">268,&#160;</a><a href="eloquent-javascripts.html#290">278</a><br/>
expression,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
phi&#160;coefficient,&#160;<a href="eloquent-javascripts.html#77">65</a>–<a href="eloquent-javascripts.html#79">67</a><br/>
in&#160;regular&#160;expressions,&#160;<a href="eloquent-javascripts.html#159">147,&#160;</a><a href="eloquent-javascripts.html#161">149</a>,<br/>
phi&#160;function,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#88">76</a><br/>
<a href="eloquent-javascripts.html#163">151</a>,&#160;<a href="eloquent-javascripts.html#174">162</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
phone,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
statement,&#160;<a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#44">32</a><br/>
physics,&#160;<a href="eloquent-javascripts.html#286">274</a>,&#160;<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
parentNode&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
physics&#160;engine,&#160;<a href="eloquent-javascripts.html#287">275</a><br/>
parse&#160;function,&#160;<a href="eloquent-javascripts.html#218">206</a><br/>
pi,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#87">75,&#160;</a><a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#280">268</a>,&#160;<a href="eloquent-javascripts.html#302">290</a><br/>
parseApply&#160;function,&#160;<a href="eloquent-javascripts.html#217">205</a><br/>
PI&#160;constant,&#160;<a href="eloquent-javascripts.html#87">75,&#160;</a><a href="eloquent-javascripts.html#252">240</a><br/>
parseExpression&#160;function,&#160;<a href="eloquent-javascripts.html#216">204</a><br/>
pick&#160;function,&#160;<a href="eloquent-javascripts.html#353">341</a><br/>
parseINI&#160;function,&#160;<a href="eloquent-javascripts.html#173">161,&#160;</a><a href="eloquent-javascripts.html#180">168</a><br/>
picture,&#160;<a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#316">304</a>,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#357">345</a><br/>
parsing,&#160;<a href="eloquent-javascripts.html#90">78</a>,&#160;<a href="eloquent-javascripts.html#140">128</a>,&#160;<a href="eloquent-javascripts.html#173">161</a>,&#160;<a href="eloquent-javascripts.html#214">202</a>–<a href="eloquent-javascripts.html#216">204</a>,&#160;<a href="eloquent-javascripts.html#218">206</a>,<br/>
Picture&#160;class,&#160;<a href="eloquent-javascripts.html#344">332,&#160;</a><a href="eloquent-javascripts.html#355">343</a><br/>
<a href="eloquent-javascripts.html#220">208</a>,&#160;<a href="eloquent-javascripts.html#222">210</a>,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#236">224,&#160;</a><a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#391">379</a><br/>
picture&#160;property,&#160;<a href="eloquent-javascripts.html#344">332</a><br/>
password,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
PictureCanvas&#160;class,&#160;<a href="eloquent-javascripts.html#346">334</a>,&#160;<a href="eloquent-javascripts.html#360">348</a><br/>
password&#160;field,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
pictureFromImage&#160;function,&#160;<a href="eloquent-javascripts.html#356">344</a><br/>
path<br/>
pie&#160;chart&#160;example,&#160;<a href="eloquent-javascripts.html#303">291</a>,&#160;<a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
canvas,&#160;<a href="eloquent-javascripts.html#303">291</a><br/>
ping&#160;request,&#160;<a href="eloquent-javascripts.html#202">190</a><br/>
canvas,&#160;<a href="eloquent-javascripts.html#299">287–</a><a href="eloquent-javascripts.html#301">289,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
pink,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
closing,&#160;<a href="eloquent-javascripts.html#300">288</a><br/>
pipe,&#160;<a href="eloquent-javascripts.html#229">217</a><br/>
file&#160;system,&#160;<a href="eloquent-javascripts.html#364">352</a>,&#160;<a href="eloquent-javascripts.html#373">361</a><br/>
pipe&#160;character,&#160;<a href="eloquent-javascripts.html#162">150</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
URL,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#324">312,&#160;</a><a href="eloquent-javascripts.html#373">361</a>,&#160;<a href="eloquent-javascripts.html#374">362</a>,&#160;<a href="eloquent-javascripts.html#383">371</a>,<br/>
pipe&#160;method,&#160;<a href="eloquent-javascripts.html#374">362</a>,&#160;<a href="eloquent-javascripts.html#377">365</a><br/>
<a href="eloquent-javascripts.html#386">374</a><br/>
pipeline,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
path&#160;package,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
pixel,&#160;<a href="eloquent-javascripts.html#245">233,&#160;</a><a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#261">249,&#160;</a><a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#282">270</a>,&#160;<a href="eloquent-javascripts.html#296">284–</a><br/>
pathfinding,&#160;<a href="eloquent-javascripts.html#136">124</a>,&#160;<a href="eloquent-javascripts.html#189">177</a>,&#160;<a href="eloquent-javascripts.html#205">193</a>,&#160;<a href="eloquent-javascripts.html#353">341</a><br/>
<a href="eloquent-javascripts.html#298">286,&#160;</a><a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#306">294,&#160;</a><a href="eloquent-javascripts.html#312">300,&#160;</a><a href="eloquent-javascripts.html#316">304,&#160;</a><a href="eloquent-javascripts.html#319">307,</a><br/>
patience,&#160;<a href="eloquent-javascripts.html#361">349</a><br/>
<a href="eloquent-javascripts.html#342">330,&#160;</a><a href="eloquent-javascripts.html#344">332,&#160;</a><a href="eloquent-javascripts.html#348">336,&#160;</a><a href="eloquent-javascripts.html#351">339,&#160;</a><a href="eloquent-javascripts.html#352">340,&#160;</a><a href="eloquent-javascripts.html#356">344,</a><br/>
pattern,&#160;<a href="eloquent-javascripts.html#155">143</a>–<a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#169">157</a><br/>
<a href="eloquent-javascripts.html#361">349,&#160;</a><a href="eloquent-javascripts.html#418">406</a><br/>
pausing&#160;(exercise),&#160;<a href="eloquent-javascripts.html#295">283,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
pixel&#160;art,&#160;<a href="eloquent-javascripts.html#306">294</a><br/>
pea&#160;soup,&#160;<a href="eloquent-javascripts.html#95">83</a><br/>
PixelEditor&#160;class,&#160;<a href="eloquent-javascripts.html#349">337</a>,&#160;<a href="eloquent-javascripts.html#358">346,&#160;</a><a href="eloquent-javascripts.html#360">348</a><br/>
427<br/>
<hr/>
<a name=440></a>pizza,&#160;<a href="eloquent-javascripts.html#77">65,&#160;</a><a href="eloquent-javascripts.html#78">66</a><br/>
nature&#160;of,&#160;<a href="eloquent-javascripts.html#14">2</a><br/>
platform&#160;game,&#160;<a href="eloquent-javascripts.html#273">261,&#160;</a><a href="eloquent-javascripts.html#294">282</a><br/>
program&#160;size,&#160;<a href="eloquent-javascripts.html#94">82</a>,&#160;<a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#280">268</a><br/>
Plauger,&#160;P.J.,&#160;<a href="eloquent-javascripts.html#140">128</a><br/>
programming,&#160;<a href="eloquent-javascripts.html#1">1</a><br/>
player,&#160;<a href="eloquent-javascripts.html#273">261</a>,&#160;<a href="eloquent-javascripts.html#275">263,&#160;</a><a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#290">278,&#160;</a><a href="eloquent-javascripts.html#293">281</a>,<br/>
difficulty&#160;of,&#160;<a href="eloquent-javascripts.html#14">2</a><br/>
<a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#314">302</a>,&#160;<a href="eloquent-javascripts.html#315">303</a><br/>
history&#160;of,&#160;<a href="eloquent-javascripts.html#15">3</a><br/>
Player&#160;class,&#160;<a href="eloquent-javascripts.html#278">266</a>,&#160;<a href="eloquent-javascripts.html#290">278</a><br/>
joy&#160;of,&#160;<a href="eloquent-javascripts.html#1">1</a>,&#160;<a href="eloquent-javascripts.html#14">2</a><br/>
plus&#160;character,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#158">146</a>,&#160;<a href="eloquent-javascripts.html#178">166</a><br/>
programming&#160;language,&#160;<a href="eloquent-javascripts.html#1">1</a>,&#160;<a href="eloquent-javascripts.html#15">3,&#160;</a><a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#225">213,</a><br/>
Poignant&#160;Guide,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
<a href="eloquent-javascripts.html#238">226,&#160;</a><a href="eloquent-javascripts.html#362">350</a><br/>
pointer,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
power&#160;of,&#160;<a href="eloquent-javascripts.html#17">5</a><br/>
pointer&#160;event,&#160;<a href="eloquent-javascripts.html#258">246</a>,&#160;<a href="eloquent-javascripts.html#346">334</a><br/>
programming&#160;style,&#160;<a href="eloquent-javascripts.html#15">3,&#160;</a><a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#43">31,&#160;</a><a href="eloquent-javascripts.html#47">35,&#160;</a><a href="eloquent-javascripts.html#280">268</a><br/>
pointerPosition&#160;function,&#160;<a href="eloquent-javascripts.html#347">335</a><br/>
progress&#160;bar,&#160;<a href="eloquent-javascripts.html#265">253</a><br/>
polling,&#160;<a href="eloquent-javascripts.html#255">243</a><br/>
project&#160;chapter,&#160;<a href="eloquent-javascripts.html#129">117</a>,&#160;<a href="eloquent-javascripts.html#214">202,&#160;</a><a href="eloquent-javascripts.html#273">261</a>,&#160;<a href="eloquent-javascripts.html#342">330,</a><br/>
pollTalks&#160;function,&#160;<a href="eloquent-javascripts.html#397">385</a><br/>
<a href="eloquent-javascripts.html#381">369</a><br/>
polymorphism,&#160;<a href="eloquent-javascripts.html#118">106</a><br/>
promise,&#160;<a href="eloquent-javascripts.html#213">201</a>,&#160;<a href="eloquent-javascripts.html#410">398</a><br/>
pop&#160;method,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#82">70</a><br/>
Promise&#160;class,&#160;<a href="eloquent-javascripts.html#197">185,&#160;</a><a href="eloquent-javascripts.html#199">187</a>–<a href="eloquent-javascripts.html#201">189</a>,&#160;<a href="eloquent-javascripts.html#207">195,&#160;</a><a href="eloquent-javascripts.html#210">198</a>,<br/>
Popper,&#160;Karl,&#160;<a href="eloquent-javascripts.html#243">231</a><br/>
<a href="eloquent-javascripts.html#213">201,&#160;</a><a href="eloquent-javascripts.html#324">312,&#160;</a><a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#371">359,&#160;</a><a href="eloquent-javascripts.html#373">361,</a><br/>
port,&#160;<a href="eloquent-javascripts.html#229">217</a>,&#160;<a href="eloquent-javascripts.html#320">308,&#160;</a><a href="eloquent-javascripts.html#369">357,&#160;</a><a href="eloquent-javascripts.html#370">358</a><br/>
<a href="eloquent-javascripts.html#397">385,&#160;</a><a href="eloquent-javascripts.html#410">398</a><br/>
pose,&#160;<a href="eloquent-javascripts.html#306">294</a><br/>
Promise.all&#160;function,&#160;<a href="eloquent-javascripts.html#202">190</a>,&#160;<a href="eloquent-javascripts.html#211">199</a>,&#160;<a href="eloquent-javascripts.html#213">201,</a><br/>
position,&#160;<a href="eloquent-javascripts.html#245">233</a><br/>
<a href="eloquent-javascripts.html#410">398</a><br/>
position&#160;(CSS),&#160;<a href="eloquent-javascripts.html#250">238,&#160;</a><a href="eloquent-javascripts.html#254">242</a>,&#160;<a href="eloquent-javascripts.html#266">254,&#160;</a><a href="eloquent-javascripts.html#274">262</a>,<br/>
Promise.reject&#160;function,&#160;<a href="eloquent-javascripts.html#199">187</a><br/>
<a href="eloquent-javascripts.html#283">271</a>,&#160;<a href="eloquent-javascripts.html#284">272</a><br/>
Promise.resolve&#160;function,&#160;<a href="eloquent-javascripts.html#197">185,&#160;</a><a href="eloquent-javascripts.html#201">189</a><br/>
POST&#160;method,&#160;<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#323">311</a>,&#160;<a href="eloquent-javascripts.html#331">319,&#160;</a><a href="eloquent-javascripts.html#384">372</a><br/>
promises&#160;package,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
postMessage&#160;method,&#160;<a href="eloquent-javascripts.html#268">256</a><br/>
promptDirection&#160;function,&#160;<a href="eloquent-javascripts.html#151">139</a>,&#160;<a href="eloquent-javascripts.html#152">140</a><br/>
power&#160;example,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#59">47,&#160;</a><a href="eloquent-javascripts.html#61">49</a><br/>
promptNumber&#160;function,&#160;<a href="eloquent-javascripts.html#146">134</a><br/>
precedence,&#160;<a href="eloquent-javascripts.html#24">12</a>,&#160;<a href="eloquent-javascripts.html#25">13,&#160;</a><a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#248">236,&#160;</a><a href="eloquent-javascripts.html#249">237</a><br/>
propagation,&#160;<i>see&#160;</i>event&#160;propagation<br/>
predicate&#160;function,&#160;<a href="eloquent-javascripts.html#99">87</a>,&#160;<a href="eloquent-javascripts.html#103">91,&#160;</a><a href="eloquent-javascripts.html#107">95</a><br/>
proper&#160;lines&#160;(exercise),&#160;<a href="eloquent-javascripts.html#361">349,&#160;</a><a href="eloquent-javascripts.html#419">407</a><br/>
Prefer&#160;header,&#160;<a href="eloquent-javascripts.html#385">373,&#160;</a><a href="eloquent-javascripts.html#391">379,&#160;</a><a href="eloquent-javascripts.html#397">385</a><br/>
property,&#160;<a href="eloquent-javascripts.html#339">327</a><br/>
premature&#160;optimization,&#160;<a href="eloquent-javascripts.html#61">49</a><br/>
access,&#160;<a href="eloquent-javascripts.html#38">26</a>,&#160;<a href="eloquent-javascripts.html#71">59,&#160;</a><a href="eloquent-javascripts.html#110">98</a>,&#160;<a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#359">347</a><br/>
preventDefault&#160;method,&#160;<a href="eloquent-javascripts.html#259">247,&#160;</a><a href="eloquent-javascripts.html#265">253</a>–<a href="eloquent-javascripts.html#267">255</a>,<br/>
assignment,&#160;<a href="eloquent-javascripts.html#73">61</a><br/>
<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#348">336</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
definition,&#160;<a href="eloquent-javascripts.html#73">61</a>,&#160;<a href="eloquent-javascripts.html#77">65</a>,&#160;<a href="eloquent-javascripts.html#122">110</a><br/>
previousSibling&#160;property,&#160;<a href="eloquent-javascripts.html#239">227</a><br/>
deletion,&#160;<a href="eloquent-javascripts.html#74">62</a><br/>
primitiveMultiply&#160;(exercise),&#160;<a href="eloquent-javascripts.html#154">142</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
inheritance,&#160;<a href="eloquent-javascripts.html#111">99</a>,&#160;<a href="eloquent-javascripts.html#113">101</a>,&#160;<a href="eloquent-javascripts.html#115">103</a><br/>
privacy,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
model&#160;of,&#160;<a href="eloquent-javascripts.html#74">62</a><br/>
private&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
naming,&#160;<a href="eloquent-javascripts.html#117">105,&#160;</a><a href="eloquent-javascripts.html#119">107</a>,&#160;<a href="eloquent-javascripts.html#120">108</a><br/>
private&#160;properties,&#160;<a href="eloquent-javascripts.html#109">97</a><br/>
testing&#160;for,&#160;<a href="eloquent-javascripts.html#74">62</a><br/>
private&#160;property,&#160;<a href="eloquent-javascripts.html#154">142</a><br/>
protected&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
process&#160;object,&#160;<a href="eloquent-javascripts.html#363">351,&#160;</a><a href="eloquent-javascripts.html#375">363</a><br/>
protocol,&#160;<a href="eloquent-javascripts.html#228">216–</a><a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#320">308</a>,&#160;<a href="eloquent-javascripts.html#321">309</a><br/>
processor,&#160;<a href="eloquent-javascripts.html#192">180</a><br/>
prototype,&#160;<a href="eloquent-javascripts.html#111">99</a>–<a href="eloquent-javascripts.html#115">103,&#160;</a><a href="eloquent-javascripts.html#117">105</a>,&#160;<a href="eloquent-javascripts.html#124">112,&#160;</a><a href="eloquent-javascripts.html#223">211,&#160;</a><a href="eloquent-javascripts.html#227">215</a>,<br/>
profiling,&#160;<a href="eloquent-javascripts.html#61">49</a><br/>
<a href="eloquent-javascripts.html#411">399,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
program,&#160;<a href="eloquent-javascripts.html#34">22</a>,&#160;<a href="eloquent-javascripts.html#39">27</a><br/>
diagram,&#160;<a href="eloquent-javascripts.html#115">103</a><br/>
428<br/>
<hr/>
<a name=441></a>prototype&#160;property,&#160;<a href="eloquent-javascripts.html#113">101,&#160;</a><a href="eloquent-javascripts.html#114">102</a><br/>
range&#160;function,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#91">79</a>,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
pseudorandom&#160;number,&#160;<a href="eloquent-javascripts.html#88">76</a><br/>
Range&#160;header,&#160;<a href="eloquent-javascripts.html#325">313</a><br/>
public&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
ray&#160;tracer,&#160;<a href="eloquent-javascripts.html#316">304</a><br/>
public&#160;properties,&#160;<a href="eloquent-javascripts.html#109">97</a><br/>
read-eval-print&#160;loop,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
public&#160;space&#160;(exercise),&#160;<a href="eloquent-javascripts.html#379">367,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
readability,&#160;<a href="eloquent-javascripts.html#16">4,&#160;</a><a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#48">36</a>,&#160;<a href="eloquent-javascripts.html#61">49,&#160;</a><a href="eloquent-javascripts.html#65">53,&#160;</a><a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#179">167,</a><br/>
publishing,&#160;<a href="eloquent-javascripts.html#367">355</a><br/>
<a href="eloquent-javascripts.html#220">208,&#160;</a><a href="eloquent-javascripts.html#285">273</a>,&#160;<a href="eloquent-javascripts.html#318">306</a><br/>
punch&#160;card,&#160;<a href="eloquent-javascripts.html#15">3</a><br/>
readable&#160;stream,&#160;<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#372">360</a>,&#160;<a href="eloquent-javascripts.html#374">362</a>,&#160;<a href="eloquent-javascripts.html#389">377</a><br/>
pure&#160;function,&#160;<a href="eloquent-javascripts.html#65">53,&#160;</a><a href="eloquent-javascripts.html#66">54,&#160;</a><a href="eloquent-javascripts.html#91">79,&#160;</a><a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#188">176</a>,<br/>
readAsDataURL&#160;method,&#160;<a href="eloquent-javascripts.html#355">343</a><br/>
<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
readAsText&#160;method,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
push&#160;method,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#80">68</a>,&#160;<a href="eloquent-javascripts.html#82">70</a>,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
readdir&#160;function,&#160;<a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#376">364,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
pushing&#160;data,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
readdirSync&#160;function,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
PUT&#160;method,&#160;<a href="eloquent-javascripts.html#321">309</a>,&#160;<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#373">361</a>,&#160;<a href="eloquent-javascripts.html#377">365</a>,<br/>
readFile&#160;function,&#160;<a href="eloquent-javascripts.html#184">172,&#160;</a><a href="eloquent-javascripts.html#367">355,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
<a href="eloquent-javascripts.html#383">371</a>,&#160;<a href="eloquent-javascripts.html#389">377</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
readFileSync&#160;function,&#160;<a href="eloquent-javascripts.html#369">357</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
Pythagoras,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
reading&#160;code,&#160;<a href="eloquent-javascripts.html#19">7,&#160;</a><a href="eloquent-javascripts.html#129">117</a><br/>
Pythagorean&#160;theorem,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
readStorage&#160;function,&#160;<a href="eloquent-javascripts.html#195">183<br/></a>readStream&#160;function,&#160;<a href="eloquent-javascripts.html#389">377</a>,&#160;<a href="eloquent-javascripts.html#390">378</a><br/>
quadratic&#160;curve,&#160;<a href="eloquent-javascripts.html#301">289</a><br/>
real-time,&#160;<a href="eloquent-javascripts.html#255">243</a><br/>
quadraticCurveTo&#160;method,&#160;<a href="eloquent-javascripts.html#301">289</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
reasoning,&#160;<a href="eloquent-javascripts.html#29">17</a><br/>
query&#160;string,&#160;<a href="eloquent-javascripts.html#323">311</a>,&#160;<a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#391">379</a><br/>
recipe&#160;analogy,&#160;<a href="eloquent-javascripts.html#95">83</a><br/>
querySelector&#160;method,&#160;<a href="eloquent-javascripts.html#250">238</a>,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
record,&#160;<a href="eloquent-javascripts.html#73">61</a><br/>
querySelectorAll&#160;method,&#160;<a href="eloquent-javascripts.html#249">237</a>,&#160;<a href="eloquent-javascripts.html#334">322</a><br/>
rect&#160;(SVG&#160;tag),&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
question&#160;mark,&#160;<a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#158">146</a>,&#160;<a href="eloquent-javascripts.html#168">156</a>,&#160;<a href="eloquent-javascripts.html#323">311</a><br/>
rectangle,&#160;<a href="eloquent-javascripts.html#274">262,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#352">340</a><br/>
queue,&#160;<a href="eloquent-javascripts.html#210">198</a><br/>
rectangle&#160;function,&#160;<a href="eloquent-javascripts.html#352">340</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
quotation&#160;mark,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#177">165</a><br/>
recursion,&#160;<a href="eloquent-javascripts.html#57">45,&#160;</a><a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#62">50</a>,&#160;<a href="eloquent-javascripts.html#67">55,&#160;</a><a href="eloquent-javascripts.html#92">80,&#160;</a><a href="eloquent-javascripts.html#201">189,</a><br/>
quoting<br/>
<a href="eloquent-javascripts.html#207">195,&#160;</a><a href="eloquent-javascripts.html#216">204,&#160;</a><a href="eloquent-javascripts.html#218">206,&#160;</a><a href="eloquent-javascripts.html#220">208,&#160;</a><a href="eloquent-javascripts.html#240">228,&#160;</a><a href="eloquent-javascripts.html#254">242,</a><br/>
in&#160;JSON,&#160;<a href="eloquent-javascripts.html#89">77</a><br/>
<a href="eloquent-javascripts.html#309">297,&#160;</a><a href="eloquent-javascripts.html#401">389</a>,&#160;<a href="eloquent-javascripts.html#403">391</a>,&#160;<a href="eloquent-javascripts.html#407">395</a>,&#160;<a href="eloquent-javascripts.html#410">398,&#160;</a><a href="eloquent-javascripts.html#412">400</a><br/>
of&#160;object&#160;properties,&#160;<a href="eloquent-javascripts.html#73">61</a><br/>
red,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
quoting&#160;style&#160;(exercise),&#160;<a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
reduce&#160;method,&#160;<a href="eloquent-javascripts.html#100">88–</a><a href="eloquent-javascripts.html#102">90</a>,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#107">95,&#160;</a><a href="eloquent-javascripts.html#350">338,</a><br/>
rabbit&#160;example,&#160;<a href="eloquent-javascripts.html#110">98,&#160;</a><a href="eloquent-javascripts.html#112">100–</a><a href="eloquent-javascripts.html#114">102</a><br/>
<a href="eloquent-javascripts.html#404">392</a><br/>
radian,&#160;<a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#302">290,&#160;</a><a href="eloquent-javascripts.html#308">296</a><br/>
ReferenceError&#160;type,&#160;<a href="eloquent-javascripts.html#227">215</a><br/>
radio&#160;button,&#160;<a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#334">322</a><br/>
RegExp&#160;class,&#160;<a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
radius,&#160;<a href="eloquent-javascripts.html#361">349,&#160;</a><a href="eloquent-javascripts.html#418">406</a><br/>
regexp&#160;golf&#160;(exercise),&#160;<a href="eloquent-javascripts.html#177">165</a><br/>
radix,&#160;<a href="eloquent-javascripts.html#22">10</a><br/>
regular&#160;expression,&#160;<a href="eloquent-javascripts.html#155">143–</a><a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#166">154</a>–<a href="eloquent-javascripts.html#168">156</a>,<br/>
raising&#160;(exception),&#160;<a href="eloquent-javascripts.html#147">135</a><br/>
<a href="eloquent-javascripts.html#170">158,&#160;</a><a href="eloquent-javascripts.html#172">160,&#160;</a><a href="eloquent-javascripts.html#177">165,&#160;</a><a href="eloquent-javascripts.html#217">205,&#160;</a><a href="eloquent-javascripts.html#379">367,&#160;</a><a href="eloquent-javascripts.html#386">374,</a><br/>
random&#160;number,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#88">76,&#160;</a><a href="eloquent-javascripts.html#280">268</a><br/>
<a href="eloquent-javascripts.html#387">375,&#160;</a><a href="eloquent-javascripts.html#411">399</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
random-item&#160;package,&#160;<a href="eloquent-javascripts.html#408">396</a><br/>
alternatives,&#160;<a href="eloquent-javascripts.html#162">150</a><br/>
randomPick&#160;function,&#160;<a href="eloquent-javascripts.html#134">122</a><br/>
backtracking,&#160;<a href="eloquent-javascripts.html#164">152</a><br/>
randomRobot&#160;function,&#160;<a href="eloquent-javascripts.html#134">122</a><br/>
boundary,&#160;<a href="eloquent-javascripts.html#162">150</a><br/>
range,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#157">145</a>–<a href="eloquent-javascripts.html#159">147</a><br/>
creation,&#160;<a href="eloquent-javascripts.html#155">143</a>,&#160;<a href="eloquent-javascripts.html#169">157<br/></a>escaping,&#160;<a href="eloquent-javascripts.html#155">143,&#160;</a><a href="eloquent-javascripts.html#169">157,&#160;</a><a href="eloquent-javascripts.html#407">395</a><br/>
429<br/>
<hr/>
<a name=442></a>flags,&#160;<a href="eloquent-javascripts.html#159">147,&#160;</a><a href="eloquent-javascripts.html#166">154</a>,&#160;<a href="eloquent-javascripts.html#169">157</a>,&#160;<a href="eloquent-javascripts.html#408">396</a><br/>
resolution,&#160;<a href="eloquent-javascripts.html#185">173</a>,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
global,&#160;<a href="eloquent-javascripts.html#166">154,&#160;</a><a href="eloquent-javascripts.html#170">158,&#160;</a><a href="eloquent-javascripts.html#171">159</a><br/>
resolve&#160;function,&#160;<a href="eloquent-javascripts.html#375">363</a><br/>
grouping,&#160;<a href="eloquent-javascripts.html#159">147,&#160;</a><a href="eloquent-javascripts.html#166">154</a><br/>
resolving&#160;(a&#160;promise),&#160;<a href="eloquent-javascripts.html#197">185</a>,&#160;<a href="eloquent-javascripts.html#198">186</a>,&#160;<a href="eloquent-javascripts.html#201">189,</a><br/>
internationalization,&#160;<a href="eloquent-javascripts.html#174">162</a><br/>
<a href="eloquent-javascripts.html#210">198</a><br/>
matching,&#160;<a href="eloquent-javascripts.html#163">151</a>,&#160;<a href="eloquent-javascripts.html#170">158</a><br/>
resource,&#160;<a href="eloquent-javascripts.html#229">217</a>,&#160;<a href="eloquent-javascripts.html#230">218,&#160;</a><a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#326">314,</a><br/>
methods,&#160;<a href="eloquent-javascripts.html#156">144</a>,&#160;<a href="eloquent-javascripts.html#160">148</a>,&#160;<a href="eloquent-javascripts.html#169">157</a><br/>
<a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#388">376</a><br/>
repetition,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
response,&#160;<a href="eloquent-javascripts.html#196">184,&#160;</a><a href="eloquent-javascripts.html#200">188</a>,&#160;<a href="eloquent-javascripts.html#320">308–</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#370">358,</a><br/>
rejecting&#160;(a&#160;promise),&#160;<a href="eloquent-javascripts.html#198">186,&#160;</a><a href="eloquent-javascripts.html#201">189</a>,&#160;<a href="eloquent-javascripts.html#210">198</a><br/>
<a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#377">365</a><br/>
relative&#160;path,&#160;<a href="eloquent-javascripts.html#185">173,&#160;</a><a href="eloquent-javascripts.html#233">221,&#160;</a><a href="eloquent-javascripts.html#364">352,&#160;</a><a href="eloquent-javascripts.html#373">361</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
Response&#160;class,&#160;<a href="eloquent-javascripts.html#324">312</a><br/>
relative&#160;positioning,&#160;<a href="eloquent-javascripts.html#250">238</a>,&#160;<a href="eloquent-javascripts.html#251">239</a><br/>
responsiveness,&#160;<a href="eloquent-javascripts.html#255">243</a>,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
relative&#160;URL,&#160;<a href="eloquent-javascripts.html#324">312</a><br/>
rest&#160;parameter,&#160;<a href="eloquent-javascripts.html#86">74</a><br/>
remainder&#160;operator,&#160;<a href="eloquent-javascripts.html#25">13,&#160;</a><a href="eloquent-javascripts.html#45">33,&#160;</a><a href="eloquent-javascripts.html#306">294</a>,&#160;<a href="eloquent-javascripts.html#400">388</a>,<br/>
restore&#160;method,&#160;<a href="eloquent-javascripts.html#309">297</a>,&#160;<a href="eloquent-javascripts.html#310">298</a><br/>
<a href="eloquent-javascripts.html#401">389</a>,&#160;<a href="eloquent-javascripts.html#413">401</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
result&#160;property,&#160;<a href="eloquent-javascripts.html#336">324</a><br/>
remote&#160;access,&#160;<a href="eloquent-javascripts.html#373">361</a><br/>
retry,&#160;<a href="eloquent-javascripts.html#200">188</a><br/>
remote&#160;procedure&#160;call,&#160;<a href="eloquent-javascripts.html#326">314</a><br/>
return&#160;keyword,&#160;<a href="eloquent-javascripts.html#52">40</a>,&#160;<a href="eloquent-javascripts.html#57">45</a>,&#160;<a href="eloquent-javascripts.html#113">101,&#160;</a><a href="eloquent-javascripts.html#208">196</a>,&#160;<a href="eloquent-javascripts.html#401">389,</a><br/>
removeChild&#160;method,&#160;<a href="eloquent-javascripts.html#241">229</a><br/>
<a href="eloquent-javascripts.html#404">392</a><br/>
removeEventListener&#160;method,&#160;<a href="eloquent-javascripts.html#256">244</a>,&#160;<a href="eloquent-javascripts.html#414">402</a><br/>
return&#160;value,&#160;<a href="eloquent-javascripts.html#39">27</a>,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#146">134</a>,&#160;<a href="eloquent-javascripts.html#196">184</a>,&#160;<a href="eloquent-javascripts.html#404">392</a><br/>
removeItem&#160;method,&#160;<a href="eloquent-javascripts.html#337">325</a><br/>
reuse,&#160;<a href="eloquent-javascripts.html#66">54,&#160;</a><a href="eloquent-javascripts.html#125">113,&#160;</a><a href="eloquent-javascripts.html#179">167,&#160;</a><a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#365">353</a><br/>
rename&#160;function,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
reverse&#160;method,&#160;<a href="eloquent-javascripts.html#91">79</a><br/>
rendering,&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
reversing&#160;(exercise),&#160;<a href="eloquent-javascripts.html#91">79,&#160;</a><a href="eloquent-javascripts.html#402">390</a><br/>
renderTalk&#160;function,&#160;<a href="eloquent-javascripts.html#395">383</a><br/>
rgb&#160;(CSS),&#160;<a href="eloquent-javascripts.html#283">271</a><br/>
renderTalkForm&#160;function,&#160;<a href="eloquent-javascripts.html#396">384</a><br/>
right-aligning,&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
renderUserField&#160;function,&#160;<a href="eloquent-javascripts.html#395">383</a><br/>
rmdir&#160;function,&#160;<a href="eloquent-javascripts.html#376">364,&#160;</a><a href="eloquent-javascripts.html#379">367</a><br/>
repeat&#160;method,&#160;<a href="eloquent-javascripts.html#85">73,&#160;</a><a href="eloquent-javascripts.html#266">254</a><br/>
roadGraph&#160;object,&#160;<a href="eloquent-javascripts.html#130">118</a><br/>
repeating&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
roads&#160;array,&#160;<a href="eloquent-javascripts.html#129">117</a><br/>
repetition,&#160;<a href="eloquent-javascripts.html#63">51</a>,&#160;<a href="eloquent-javascripts.html#158">146</a>,&#160;<a href="eloquent-javascripts.html#165">153,&#160;</a><a href="eloquent-javascripts.html#168">156,&#160;</a><a href="eloquent-javascripts.html#269">257</a><br/>
roads&#160;module&#160;(exercise),&#160;<a href="eloquent-javascripts.html#191">179,&#160;</a><a href="eloquent-javascripts.html#409">397</a><br/>
replace&#160;method,&#160;<a href="eloquent-javascripts.html#166">154</a>,&#160;<a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
robot,&#160;<a href="eloquent-javascripts.html#129">117,&#160;</a><a href="eloquent-javascripts.html#131">119,&#160;</a><a href="eloquent-javascripts.html#134">122</a>,&#160;<a href="eloquent-javascripts.html#136">124</a>,&#160;<a href="eloquent-javascripts.html#138">126</a>,&#160;<a href="eloquent-javascripts.html#190">178</a><br/>
replaceChild&#160;method,&#160;<a href="eloquent-javascripts.html#242">230,&#160;</a><a href="eloquent-javascripts.html#413">401</a><br/>
robot&#160;efficiency&#160;(exercise),&#160;<a href="eloquent-javascripts.html#139">127,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
replaceSelection&#160;function,&#160;<a href="eloquent-javascripts.html#333">321</a><br/>
robustness,&#160;<a href="eloquent-javascripts.html#383">371</a><br/>
reportError&#160;function,&#160;<a href="eloquent-javascripts.html#394">382</a><br/>
root,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
request,&#160;<a href="eloquent-javascripts.html#196">184,&#160;</a><a href="eloquent-javascripts.html#200">188,&#160;</a><a href="eloquent-javascripts.html#229">217,&#160;</a><a href="eloquent-javascripts.html#320">308–</a><a href="eloquent-javascripts.html#322">310,&#160;</a><a href="eloquent-javascripts.html#331">319</a>,<br/>
rotate&#160;method,&#160;<a href="eloquent-javascripts.html#307">295,&#160;</a><a href="eloquent-javascripts.html#308">296,&#160;</a><a href="eloquent-javascripts.html#310">298</a><br/>
<a href="eloquent-javascripts.html#369">357</a>–<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#378">366</a>,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
rotation,&#160;<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#414">402</a><br/>
request&#160;function,&#160;<a href="eloquent-javascripts.html#200">188</a>,&#160;<a href="eloquent-javascripts.html#370">358</a>,&#160;<a href="eloquent-javascripts.html#371">359</a><br/>
rounding,&#160;<a href="eloquent-javascripts.html#88">76</a>,&#160;<a href="eloquent-javascripts.html#145">133</a>,&#160;<a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#288">276</a>,&#160;<a href="eloquent-javascripts.html#313">301</a>,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
request&#160;type,&#160;<a href="eloquent-javascripts.html#196">184</a><br/>
router,&#160;<a href="eloquent-javascripts.html#382">370,&#160;</a><a href="eloquent-javascripts.html#386">374</a><br/>
requestAnimationFrame&#160;function,&#160;<a href="eloquent-javascripts.html#251">239,</a><br/>
Router&#160;class,&#160;<a href="eloquent-javascripts.html#386">374</a><br/>
<a href="eloquent-javascripts.html#267">255</a>,&#160;<a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#292">280</a>,&#160;<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#413">401</a><br/>
routeRequest&#160;function,&#160;<a href="eloquent-javascripts.html#206">194</a><br/>
requestType&#160;function,&#160;<a href="eloquent-javascripts.html#201">189</a><br/>
routeRobot&#160;function,&#160;<a href="eloquent-javascripts.html#136">124</a><br/>
require&#160;function,&#160;<a href="eloquent-javascripts.html#183">171</a>,&#160;<a href="eloquent-javascripts.html#184">172</a>,&#160;<a href="eloquent-javascripts.html#191">179,&#160;</a><a href="eloquent-javascripts.html#364">352</a>,<br/>
routing,&#160;<a href="eloquent-javascripts.html#204">192</a><br/>
<a href="eloquent-javascripts.html#366">354</a>,&#160;<a href="eloquent-javascripts.html#375">363</a>,&#160;<a href="eloquent-javascripts.html#386">374</a><br/>
row,&#160;<a href="eloquent-javascripts.html#253">241</a><br/>
reserved&#160;word,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
rule&#160;(CSS),&#160;<a href="eloquent-javascripts.html#248">236</a>,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
430<br/>
<hr/>
<a name=443></a>run&#160;function,&#160;<a href="eloquent-javascripts.html#222">210</a><br/>
selectionStart&#160;property,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
run-time&#160;error,&#160;<a href="eloquent-javascripts.html#143">131,&#160;</a><a href="eloquent-javascripts.html#144">132,&#160;</a><a href="eloquent-javascripts.html#146">134,&#160;</a><a href="eloquent-javascripts.html#153">141</a>,<br/>
selector,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
<a href="eloquent-javascripts.html#411">399</a><br/>
self-closing&#160;tag,&#160;<a href="eloquent-javascripts.html#232">220</a><br/>
runAnimation&#160;function,&#160;<a href="eloquent-javascripts.html#292">280</a>,&#160;<a href="eloquent-javascripts.html#295">283</a><br/>
semantic&#160;versioning,&#160;<a href="eloquent-javascripts.html#367">355</a><br/>
runGame&#160;function,&#160;<a href="eloquent-javascripts.html#293">281,&#160;</a><a href="eloquent-javascripts.html#294">282</a><br/>
semicolon,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#45">33</a>,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
runLevel&#160;function,&#160;<a href="eloquent-javascripts.html#293">281,&#160;</a><a href="eloquent-javascripts.html#295">283</a><br/>
send&#160;method,&#160;<a href="eloquent-javascripts.html#196">184</a>,&#160;<a href="eloquent-javascripts.html#200">188</a><br/>
running&#160;code,&#160;<a href="eloquent-javascripts.html#19">7</a><br/>
sendGossip&#160;function,&#160;<a href="eloquent-javascripts.html#203">191</a><br/>
runRobot&#160;function,&#160;<a href="eloquent-javascripts.html#134">122,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
sep&#160;binding,&#160;<a href="eloquent-javascripts.html#375">363<br/></a>sequence,&#160;<a href="eloquent-javascripts.html#158">146</a><br/>
Safari,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
serialization,&#160;<a href="eloquent-javascripts.html#89">77,&#160;</a><a href="eloquent-javascripts.html#90">78</a><br/>
sandbox,&#160;<a href="eloquent-javascripts.html#19">7</a>,&#160;<a href="eloquent-javascripts.html#69">57,&#160;</a><a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#325">313</a><br/>
server,&#160;<a href="eloquent-javascripts.html#229">217,&#160;</a><a href="eloquent-javascripts.html#230">218,&#160;</a><a href="eloquent-javascripts.html#320">308</a>–<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#324">312,&#160;</a><a href="eloquent-javascripts.html#326">314,</a><br/>
save&#160;method,&#160;<a href="eloquent-javascripts.html#309">297,&#160;</a><a href="eloquent-javascripts.html#310">298</a><br/>
<a href="eloquent-javascripts.html#362">350,&#160;</a><a href="eloquent-javascripts.html#369">357,&#160;</a><a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#372">360,&#160;</a><a href="eloquent-javascripts.html#373">361,&#160;</a><a href="eloquent-javascripts.html#381">369,</a><br/>
SaveButton&#160;class,&#160;<a href="eloquent-javascripts.html#354">342</a><br/>
<a href="eloquent-javascripts.html#385">373</a><br/>
scale&#160;constant,&#160;<a href="eloquent-javascripts.html#346">334</a><br/>
session,&#160;<a href="eloquent-javascripts.html#339">327</a><br/>
scale&#160;method,&#160;<a href="eloquent-javascripts.html#307">295</a>,&#160;<a href="eloquent-javascripts.html#308">296</a><br/>
sessionStorage&#160;object,&#160;<a href="eloquent-javascripts.html#339">327</a><br/>
scaling,&#160;<a href="eloquent-javascripts.html#282">270</a>,&#160;<a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#307">295</a>,&#160;<a href="eloquent-javascripts.html#313">301,&#160;</a><a href="eloquent-javascripts.html#416">404</a><br/>
set,&#160;<a href="eloquent-javascripts.html#156">144</a>,&#160;<a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
scalpel&#160;(exercise),&#160;<a href="eloquent-javascripts.html#213">201,&#160;</a><a href="eloquent-javascripts.html#410">398</a><br/>
set&#160;(data&#160;structure),&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#139">127</a><br/>
scheduling,&#160;<a href="eloquent-javascripts.html#209">197</a>,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
Set&#160;class,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#139">127,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
scientific&#160;notation,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#178">166</a><br/>
set&#160;method,&#160;<a href="eloquent-javascripts.html#118">106</a><br/>
scope,&#160;<a href="eloquent-javascripts.html#52">40</a>–<a href="eloquent-javascripts.html#54">42,&#160;</a><a href="eloquent-javascripts.html#59">47,&#160;</a><a href="eloquent-javascripts.html#180">168,&#160;</a><a href="eloquent-javascripts.html#182">170</a>,&#160;<a href="eloquent-javascripts.html#183">171</a>,&#160;<a href="eloquent-javascripts.html#185">173</a>,<br/>
setAttribute&#160;method,&#160;<a href="eloquent-javascripts.html#244">232,&#160;</a><a href="eloquent-javascripts.html#346">334</a><br/>
<a href="eloquent-javascripts.html#219">207</a>,&#160;<a href="eloquent-javascripts.html#222">210</a>,&#160;<a href="eloquent-javascripts.html#226">214</a>,&#160;<a href="eloquent-javascripts.html#227">215,&#160;</a><a href="eloquent-javascripts.html#411">399</a><br/>
setInterval&#160;function,&#160;<a href="eloquent-javascripts.html#269">257,&#160;</a><a href="eloquent-javascripts.html#306">294</a><br/>
script&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#233">221,&#160;</a><a href="eloquent-javascripts.html#267">255</a><br/>
setItem&#160;method,&#160;<a href="eloquent-javascripts.html#337">325</a><br/>
SCRIPTS&#160;data&#160;set,&#160;<a href="eloquent-javascripts.html#98">86,&#160;</a><a href="eloquent-javascripts.html#101">89</a>,&#160;<a href="eloquent-javascripts.html#103">91,&#160;</a><a href="eloquent-javascripts.html#105">93</a>,<br/>
setter,&#160;<a href="eloquent-javascripts.html#123">111</a><br/>
<a href="eloquent-javascripts.html#108">96</a><br/>
setTimeout&#160;function,&#160;<a href="eloquent-javascripts.html#195">183</a>,&#160;<a href="eloquent-javascripts.html#209">197,&#160;</a><a href="eloquent-javascripts.html#269">257,</a><br/>
scroll&#160;event,&#160;<a href="eloquent-javascripts.html#265">253,&#160;</a><a href="eloquent-javascripts.html#269">257</a><br/>
<a href="eloquent-javascripts.html#391">379,&#160;</a><a href="eloquent-javascripts.html#397">385</a><br/>
scrolling,&#160;<a href="eloquent-javascripts.html#259">247</a>,&#160;<a href="eloquent-javascripts.html#265">253</a>,&#160;<a href="eloquent-javascripts.html#266">254</a>,&#160;<a href="eloquent-javascripts.html#284">272</a>,&#160;<a href="eloquent-javascripts.html#285">273</a>,<br/>
shape,&#160;<a href="eloquent-javascripts.html#296">284,&#160;</a><a href="eloquent-javascripts.html#299">287</a>,&#160;<a href="eloquent-javascripts.html#300">288</a>,&#160;<a href="eloquent-javascripts.html#302">290</a>,&#160;<a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#318">306</a><br/>
<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#312">300</a><br/>
shapes&#160;(exercise),&#160;<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#414">402</a><br/>
search&#160;method,&#160;<a href="eloquent-javascripts.html#169">157</a><br/>
shared&#160;property,&#160;<a href="eloquent-javascripts.html#112">100,&#160;</a><a href="eloquent-javascripts.html#115">103</a>,&#160;<a href="eloquent-javascripts.html#116">104</a><br/>
search&#160;problem,&#160;<a href="eloquent-javascripts.html#136">124,&#160;</a><a href="eloquent-javascripts.html#163">151,&#160;</a><a href="eloquent-javascripts.html#164">152</a>,&#160;<a href="eloquent-javascripts.html#241">229</a>,<br/>
shift&#160;key,&#160;<a href="eloquent-javascripts.html#260">248</a>,&#160;<a href="eloquent-javascripts.html#418">406</a><br/>
<a href="eloquent-javascripts.html#379">367</a><br/>
shift&#160;method,&#160;<a href="eloquent-javascripts.html#82">70</a><br/>
search&#160;tool&#160;(exercise),&#160;<a href="eloquent-javascripts.html#379">367</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
shiftKey&#160;property,&#160;<a href="eloquent-javascripts.html#260">248</a><br/>
section,&#160;<a href="eloquent-javascripts.html#172">160</a><br/>
short-circuit&#160;evaluation,&#160;<a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#62">50,&#160;</a><a href="eloquent-javascripts.html#220">208,</a><br/>
Secure&#160;HTTP,&#160;<i>see&#160;</i>HTTPS<br/>
<a href="eloquent-javascripts.html#404">392</a><br/>
security,&#160;<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#325">313,&#160;</a><a href="eloquent-javascripts.html#326">314</a>,&#160;<a href="eloquent-javascripts.html#335">323,&#160;</a><a href="eloquent-javascripts.html#337">325</a>,&#160;<a href="eloquent-javascripts.html#375">363,</a><br/>
SICP,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
<a href="eloquent-javascripts.html#385">373</a><br/>
side&#160;effect,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#46">34,&#160;</a><a href="eloquent-javascripts.html#52">40</a>,&#160;<a href="eloquent-javascripts.html#66">54</a>,&#160;<a href="eloquent-javascripts.html#75">63,&#160;</a><a href="eloquent-javascripts.html#91">79,</a><br/>
select&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#329">317</a>,&#160;<a href="eloquent-javascripts.html#334">322</a>,<br/>
<a href="eloquent-javascripts.html#99">87</a>,&#160;<a href="eloquent-javascripts.html#170">158</a>,&#160;<a href="eloquent-javascripts.html#188">176</a>,&#160;<a href="eloquent-javascripts.html#212">200</a>,&#160;<a href="eloquent-javascripts.html#239">227,&#160;</a><a href="eloquent-javascripts.html#241">229,</a><br/>
<a href="eloquent-javascripts.html#335">323</a>,&#160;<a href="eloquent-javascripts.html#338">326</a>,&#160;<a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#349">337,&#160;</a><a href="eloquent-javascripts.html#350">338,&#160;</a><a href="eloquent-javascripts.html#420">408</a><br/>
<a href="eloquent-javascripts.html#242">230,&#160;</a><a href="eloquent-javascripts.html#246">234,&#160;</a><a href="eloquent-javascripts.html#299">287,&#160;</a><a href="eloquent-javascripts.html#309">297,&#160;</a><a href="eloquent-javascripts.html#323">311,&#160;</a><a href="eloquent-javascripts.html#343">331,</a><br/>
selected&#160;attribute,&#160;<a href="eloquent-javascripts.html#335">323</a><br/>
<a href="eloquent-javascripts.html#344">332</a><br/>
selection,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
sign,&#160;<a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#178">166</a>,&#160;<a href="eloquent-javascripts.html#407">395</a><br/>
selectionEnd&#160;property,&#160;<a href="eloquent-javascripts.html#332">320</a><br/>
sign&#160;bit,&#160;<a href="eloquent-javascripts.html#23">11</a><br/>
431<br/>
<hr/>
<a name=444></a>signal,&#160;<a href="eloquent-javascripts.html#22">10</a><br/>
<a href="eloquent-javascripts.html#334">322,&#160;</a><a href="eloquent-javascripts.html#339">327</a>,&#160;<a href="eloquent-javascripts.html#402">390</a><br/>
simplicity,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
square&#160;example,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#55">43,&#160;</a><a href="eloquent-javascripts.html#56">44</a><br/>
simulation,&#160;<a href="eloquent-javascripts.html#131">119</a>,&#160;<a href="eloquent-javascripts.html#134">122,&#160;</a><a href="eloquent-javascripts.html#273">261</a>,&#160;<a href="eloquent-javascripts.html#278">266,&#160;</a><a href="eloquent-javascripts.html#341">329</a>,<br/>
square&#160;root,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#405">393</a><br/>
<a href="eloquent-javascripts.html#413">401</a><br/>
src&#160;attribute,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#233">221</a><br/>
sine,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#280">268,&#160;</a><a href="eloquent-javascripts.html#290">278</a><br/>
stack,&#160;<i>see&#160;</i>call&#160;stack,&#160;<a href="eloquent-javascripts.html#72">60</a><br/>
single-quote&#160;character,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#177">165</a>,&#160;<a href="eloquent-javascripts.html#233">221</a><br/>
stack&#160;overflow,&#160;<a href="eloquent-javascripts.html#57">45,&#160;</a><a href="eloquent-javascripts.html#61">49</a>,&#160;<a href="eloquent-javascripts.html#68">56,&#160;</a><a href="eloquent-javascripts.html#401">389</a><br/>
singleton,&#160;<a href="eloquent-javascripts.html#139">127</a><br/>
stack&#160;trace,&#160;<a href="eloquent-javascripts.html#148">136</a><br/>
skill,&#160;<a href="eloquent-javascripts.html#342">330</a><br/>
standard,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#47">35</a>,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#148">136</a>,&#160;<a href="eloquent-javascripts.html#174">162,</a><br/>
skill-sharing,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
<a href="eloquent-javascripts.html#359">347,&#160;</a><a href="eloquent-javascripts.html#362">350</a>,&#160;<a href="eloquent-javascripts.html#364">352</a><br/>
skill-sharing&#160;project,&#160;<a href="eloquent-javascripts.html#381">369</a>,&#160;<a href="eloquent-javascripts.html#383">371,&#160;</a><a href="eloquent-javascripts.html#385">373</a>,<br/>
standard&#160;environment,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
<a href="eloquent-javascripts.html#392">380</a><br/>
standard&#160;output,&#160;<a href="eloquent-javascripts.html#363">351</a>,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
SkillShareApp&#160;class,&#160;<a href="eloquent-javascripts.html#398">386</a><br/>
standards,&#160;<a href="eloquent-javascripts.html#228">216</a>,&#160;<a href="eloquent-javascripts.html#235">223</a><br/>
skipSpace&#160;function,&#160;<a href="eloquent-javascripts.html#217">205</a>,&#160;<a href="eloquent-javascripts.html#227">215</a><br/>
star,&#160;<a href="eloquent-javascripts.html#318">306,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
slash&#160;character,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#48">36,&#160;</a><a href="eloquent-javascripts.html#155">143</a>,&#160;<a href="eloquent-javascripts.html#168">156,&#160;</a><a href="eloquent-javascripts.html#324">312</a>,<br/>
Star&#160;Trek,&#160;<a href="eloquent-javascripts.html#301">289</a><br/>
<a href="eloquent-javascripts.html#375">363</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
startPixelEditor&#160;function,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
slice&#160;method,&#160;<a href="eloquent-javascripts.html#83">71,&#160;</a><a href="eloquent-javascripts.html#84">72</a>,&#160;<a href="eloquent-javascripts.html#99">87,&#160;</a><a href="eloquent-javascripts.html#243">231,&#160;</a><a href="eloquent-javascripts.html#402">390</a>,<br/>
startState&#160;constant,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
<a href="eloquent-javascripts.html#411">399</a><br/>
startsWith&#160;method,&#160;<a href="eloquent-javascripts.html#374">362</a><br/>
slope,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
stat&#160;function,&#160;<a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#375">363</a>,&#160;<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
sloppy&#160;programming,&#160;<a href="eloquent-javascripts.html#270">258</a><br/>
state,&#160;<a href="eloquent-javascripts.html#44">32,&#160;</a><a href="eloquent-javascripts.html#131">119</a><br/>
smooth&#160;animation,&#160;<a href="eloquent-javascripts.html#251">239</a><br/>
in<br/>
SMTP,&#160;<a href="eloquent-javascripts.html#229">217</a><br/>
binding,&#160;<a href="eloquent-javascripts.html#35">23</a>,&#160;<a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
social&#160;factors,&#160;<a href="eloquent-javascripts.html#359">347</a><br/>
iterator,&#160;<a href="eloquent-javascripts.html#209">197</a><br/>
socket,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
objects,&#160;<a href="eloquent-javascripts.html#131">119,&#160;</a><a href="eloquent-javascripts.html#276">264</a><br/>
some&#160;method,&#160;<a href="eloquent-javascripts.html#103">91,&#160;</a><a href="eloquent-javascripts.html#107">95,&#160;</a><a href="eloquent-javascripts.html#202">190,&#160;</a><a href="eloquent-javascripts.html#386">374</a><br/>
in&#160;objects,&#160;<a href="eloquent-javascripts.html#311">299</a><br/>
sorting,&#160;<a href="eloquent-javascripts.html#237">225</a><br/>
of&#160;application,&#160;<a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#342">330,&#160;</a><a href="eloquent-javascripts.html#346">334</a>,&#160;<a href="eloquent-javascripts.html#357">345,</a><br/>
source&#160;property,&#160;<a href="eloquent-javascripts.html#170">158</a><br/>
<a href="eloquent-javascripts.html#399">387</a><br/>
special&#160;form,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#219">207,&#160;</a><a href="eloquent-javascripts.html#220">208</a><br/>
of&#160;canvas,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#309">297</a><br/>
special&#160;return&#160;value,&#160;<a href="eloquent-javascripts.html#146">134,&#160;</a><a href="eloquent-javascripts.html#147">135</a><br/>
persistence,&#160;<a href="eloquent-javascripts.html#352">340</a><br/>
specialForms&#160;object,&#160;<a href="eloquent-javascripts.html#220">208</a><br/>
transitions,&#160;<a href="eloquent-javascripts.html#211">199,&#160;</a><a href="eloquent-javascripts.html#343">331,&#160;</a><a href="eloquent-javascripts.html#345">333</a><br/>
specificity,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
statement,&#160;<a href="eloquent-javascripts.html#34">22</a>,&#160;<a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#44">32,&#160;</a><a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#73">61</a><br/>
speed,&#160;<a href="eloquent-javascripts.html#1">1,&#160;</a><a href="eloquent-javascripts.html#14">2</a>,&#160;<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
static&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
spiral,&#160;<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
static&#160;file,&#160;<a href="eloquent-javascripts.html#383">371,&#160;</a><a href="eloquent-javascripts.html#387">375</a><br/>
split&#160;method,&#160;<a href="eloquent-javascripts.html#131">119</a>,&#160;<a href="eloquent-javascripts.html#276">264</a><br/>
static&#160;method,&#160;<a href="eloquent-javascripts.html#124">112,&#160;</a><a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#276">264,&#160;</a><a href="eloquent-javascripts.html#406">394</a><br/>
spread,&#160;<a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
Stats&#160;type,&#160;<a href="eloquent-javascripts.html#376">364</a><br/>
spread&#160;operator,&#160;<a href="eloquent-javascripts.html#282">270</a><br/>
statSync&#160;function,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
sprite,&#160;<a href="eloquent-javascripts.html#306">294,&#160;</a><a href="eloquent-javascripts.html#313">301,&#160;</a><a href="eloquent-javascripts.html#314">302</a><br/>
status&#160;code,&#160;<a href="eloquent-javascripts.html#321">309,&#160;</a><a href="eloquent-javascripts.html#363">351</a><br/>
spy,&#160;<a href="eloquent-javascripts.html#265">253</a><br/>
status&#160;property,&#160;<a href="eloquent-javascripts.html#324">312,&#160;</a><a href="eloquent-javascripts.html#394">382</a><br/>
square,&#160;<a href="eloquent-javascripts.html#39">27</a><br/>
stdout&#160;property,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
square&#160;bracket,&#160;<a href="eloquent-javascripts.html#120">108</a><br/>
stoicism,&#160;<a href="eloquent-javascripts.html#255">243</a><br/>
square&#160;brackets,&#160;<a href="eloquent-javascripts.html#70">58</a>,&#160;<a href="eloquent-javascripts.html#71">59</a>,&#160;<a href="eloquent-javascripts.html#86">74</a>,&#160;<a href="eloquent-javascripts.html#89">77</a>,&#160;<a href="eloquent-javascripts.html#157">145</a>,<br/>
stopPropagation&#160;method,&#160;<a href="eloquent-javascripts.html#258">246</a><br/>
432<br/>
<hr/>
<a name=445></a>storage&#160;function,&#160;<a href="eloquent-javascripts.html#198">186</a><br/>
symbol,&#160;<a href="eloquent-javascripts.html#119">107</a><br/>
stream,&#160;<a href="eloquent-javascripts.html#229">217</a>,&#160;<a href="eloquent-javascripts.html#370">358</a>–<a href="eloquent-javascripts.html#372">360</a>,&#160;<a href="eloquent-javascripts.html#374">362</a>,&#160;<a href="eloquent-javascripts.html#377">365,&#160;</a><a href="eloquent-javascripts.html#389">377</a><br/>
Symbol&#160;function,&#160;<a href="eloquent-javascripts.html#119">107</a><br/>
strict&#160;mode,&#160;<a href="eloquent-javascripts.html#141">129</a><br/>
Symbol.iterator&#160;symbol,&#160;<a href="eloquent-javascripts.html#120">108</a><br/>
string,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#70">58,&#160;</a><a href="eloquent-javascripts.html#72">60</a>,&#160;<a href="eloquent-javascripts.html#75">63</a>,&#160;<a href="eloquent-javascripts.html#104">92</a><br/>
SymmetricMatrix&#160;class,&#160;<a href="eloquent-javascripts.html#124">112</a><br/>
indexing,&#160;<a href="eloquent-javascripts.html#68">56,&#160;</a><a href="eloquent-javascripts.html#83">71</a>,&#160;<a href="eloquent-javascripts.html#85">73,&#160;</a><a href="eloquent-javascripts.html#104">92,&#160;</a><a href="eloquent-javascripts.html#159">147</a><br/>
synchronization,&#160;<a href="eloquent-javascripts.html#398">386,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
length,&#160;<a href="eloquent-javascripts.html#50">38</a>,&#160;<a href="eloquent-javascripts.html#104">92</a><br/>
synchronous&#160;programming,&#160;<a href="eloquent-javascripts.html#192">180</a>,&#160;<a href="eloquent-javascripts.html#207">195</a>,<br/>
methods,&#160;<a href="eloquent-javascripts.html#84">72,&#160;</a><a href="eloquent-javascripts.html#159">147</a><br/>
<a href="eloquent-javascripts.html#369">357,&#160;</a><a href="eloquent-javascripts.html#379">367</a><br/>
notation,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
syncState&#160;method,&#160;<a href="eloquent-javascripts.html#344">332</a>,&#160;<a href="eloquent-javascripts.html#347">335,&#160;</a><a href="eloquent-javascripts.html#350">338</a>,&#160;<a href="eloquent-javascripts.html#351">339,</a><br/>
properties,&#160;<a href="eloquent-javascripts.html#84">72</a><br/>
<a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#421">409</a><br/>
representation,&#160;<a href="eloquent-javascripts.html#26">14</a><br/>
syntax<br/>
searching,&#160;<a href="eloquent-javascripts.html#84">72</a><br/>
error,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#141">129</a><br/>
String&#160;function,&#160;<a href="eloquent-javascripts.html#39">27,&#160;</a><a href="eloquent-javascripts.html#118">106</a><br/>
expression,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
stroke&#160;method,&#160;<a href="eloquent-javascripts.html#299">287–</a><a href="eloquent-javascripts.html#301">289</a><br/>
function,&#160;<a href="eloquent-javascripts.html#51">39</a>,&#160;<a href="eloquent-javascripts.html#55">43</a><br/>
strokeRect&#160;method,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
identifier,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
strokeStyle&#160;property,&#160;<a href="eloquent-javascripts.html#298">286</a><br/>
number,&#160;<a href="eloquent-javascripts.html#23">11</a>,&#160;<a href="eloquent-javascripts.html#178">166</a><br/>
strokeText&#160;method,&#160;<a href="eloquent-javascripts.html#304">292,&#160;</a><a href="eloquent-javascripts.html#305">293</a><br/>
object,&#160;<a href="eloquent-javascripts.html#73">61</a><br/>
stroking,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#304">292</a>,&#160;<a href="eloquent-javascripts.html#317">305</a><br/>
of&#160;Egg,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#215">203</a><br/>
strong&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#245">233</a>,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
operator,&#160;<a href="eloquent-javascripts.html#24">12</a><br/>
structure,&#160;<a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#343">331</a><br/>
statement,&#160;<a href="eloquent-javascripts.html#34">22,&#160;</a><a href="eloquent-javascripts.html#35">23,&#160;</a><a href="eloquent-javascripts.html#40">28</a>,&#160;<a href="eloquent-javascripts.html#42">30</a>,&#160;<a href="eloquent-javascripts.html#44">32,&#160;</a><a href="eloquent-javascripts.html#46">34,</a><br/>
structure&#160;sharing,&#160;<a href="eloquent-javascripts.html#92">80</a><br/>
<a href="eloquent-javascripts.html#147">135</a><br/>
style,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
string,&#160;<a href="eloquent-javascripts.html#25">13</a><br/>
style&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#248">236</a><br/>
syntax&#160;tree,&#160;<a href="eloquent-javascripts.html#215">203</a>,&#160;<a href="eloquent-javascripts.html#216">204,&#160;</a><a href="eloquent-javascripts.html#218">206,&#160;</a><a href="eloquent-javascripts.html#219">207,&#160;</a><a href="eloquent-javascripts.html#237">225</a><br/>
style&#160;attribute,&#160;<a href="eloquent-javascripts.html#247">235</a>,&#160;<a href="eloquent-javascripts.html#248">236,&#160;</a><a href="eloquent-javascripts.html#281">269</a><br/>
SyntaxError&#160;type,&#160;<a href="eloquent-javascripts.html#217">205</a><br/>
style&#160;sheet,&#160;<i>see&#160;</i>CSS<br/>subclass,&#160;<a href="eloquent-javascripts.html#125">113</a><br/>
tab&#160;character,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#44">32</a><br/>
submit,&#160;<a href="eloquent-javascripts.html#328">316</a>,&#160;<a href="eloquent-javascripts.html#331">319</a><br/>
tab&#160;key,&#160;<a href="eloquent-javascripts.html#330">318</a><br/>
submit&#160;event,&#160;<a href="eloquent-javascripts.html#331">319</a>,&#160;<a href="eloquent-javascripts.html#396">384</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
tabbed&#160;interface&#160;(exercise),&#160;<a href="eloquent-javascripts.html#272">260</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
substitution,&#160;<a href="eloquent-javascripts.html#66">54</a><br/>
tabindex&#160;attribute,&#160;<a href="eloquent-javascripts.html#260">248,&#160;</a><a href="eloquent-javascripts.html#330">318,&#160;</a><a href="eloquent-javascripts.html#360">348</a><br/>
subtraction,&#160;<a href="eloquent-javascripts.html#24">12,&#160;</a><a href="eloquent-javascripts.html#127">115</a><br/>
table,&#160;<a href="eloquent-javascripts.html#78">66</a>,&#160;<a href="eloquent-javascripts.html#79">67</a>,&#160;<a href="eloquent-javascripts.html#283">271</a><br/>
sum&#160;function,&#160;<a href="eloquent-javascripts.html#17">5</a>,&#160;<a href="eloquent-javascripts.html#91">79</a><br/>
table&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#253">241,&#160;</a><a href="eloquent-javascripts.html#274">262</a>,&#160;<a href="eloquent-javascripts.html#282">270,</a><br/>
summing&#160;(exercise),&#160;<a href="eloquent-javascripts.html#91">79,&#160;</a><a href="eloquent-javascripts.html#402">390</a><br/>
<a href="eloquent-javascripts.html#417">405</a><br/>
summing&#160;example,&#160;<a href="eloquent-javascripts.html#16">4,&#160;</a><a href="eloquent-javascripts.html#94">82</a>,&#160;<a href="eloquent-javascripts.html#100">88,&#160;</a><a href="eloquent-javascripts.html#223">211</a><br/>
table&#160;example,&#160;<a href="eloquent-javascripts.html#412">400</a><br/>
superclass,&#160;<a href="eloquent-javascripts.html#125">113</a><br/>
tableFor&#160;function,&#160;<a href="eloquent-javascripts.html#79">67</a><br/>
survey,&#160;<a href="eloquent-javascripts.html#303">291</a><br/>
tag,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#232">220</a>,&#160;<a href="eloquent-javascripts.html#236">224,&#160;</a><a href="eloquent-javascripts.html#249">237</a><br/>
Sussman,&#160;Gerald,&#160;<a href="eloquent-javascripts.html#214">202</a><br/>
talk,&#160;<a href="eloquent-javascripts.html#381">369</a>,&#160;<a href="eloquent-javascripts.html#388">376</a>–<a href="eloquent-javascripts.html#390">378</a><br/>
SVG,&#160;<a href="eloquent-javascripts.html#296">284</a>,&#160;<a href="eloquent-javascripts.html#298">286</a>,&#160;<a href="eloquent-javascripts.html#316">304,&#160;</a><a href="eloquent-javascripts.html#317">305</a><br/>
talkResponse&#160;method,&#160;<a href="eloquent-javascripts.html#391">379</a><br/>
swapping&#160;bindings,&#160;<a href="eloquent-javascripts.html#419">407</a><br/>
talksAbout&#160;function,&#160;<a href="eloquent-javascripts.html#240">228</a><br/>
swipe,&#160;<a href="eloquent-javascripts.html#352">340</a><br/>
talkURL&#160;function,&#160;<a href="eloquent-javascripts.html#394">382</a><br/>
switch&#160;keyword,&#160;<a href="eloquent-javascripts.html#46">34</a><br/>
Tamil,&#160;<a href="eloquent-javascripts.html#98">86</a><br/>
symbiotic&#160;relationship,&#160;<a href="eloquent-javascripts.html#194">182</a><br/>
tampering,&#160;<a href="eloquent-javascripts.html#327">315</a><br/>
433<br/>
<hr/>
<a name=446></a>tangent,&#160;<a href="eloquent-javascripts.html#87">75</a><br/>
<a href="eloquent-javascripts.html#286">274,&#160;</a><a href="eloquent-javascripts.html#287">275</a>,&#160;<a href="eloquent-javascripts.html#290">278</a>,&#160;<a href="eloquent-javascripts.html#293">281</a>,&#160;<a href="eloquent-javascripts.html#314">302,&#160;</a><a href="eloquent-javascripts.html#357">345</a><br/>
target&#160;property,&#160;<a href="eloquent-javascripts.html#258">246</a><br/>
time&#160;zone,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
task&#160;management&#160;example,&#160;<a href="eloquent-javascripts.html#83">71</a><br/>
timeline,&#160;<a href="eloquent-javascripts.html#193">181,&#160;</a><a href="eloquent-javascripts.html#209">197,&#160;</a><a href="eloquent-javascripts.html#233">221</a>,&#160;<a href="eloquent-javascripts.html#251">239,&#160;</a><a href="eloquent-javascripts.html#255">243</a>,&#160;<a href="eloquent-javascripts.html#267">255</a><br/>
TCP,&#160;<a href="eloquent-javascripts.html#229">217,&#160;</a><a href="eloquent-javascripts.html#320">308,&#160;</a><a href="eloquent-javascripts.html#383">371</a><br/>
timeout,&#160;<a href="eloquent-javascripts.html#200">188</a>,&#160;<a href="eloquent-javascripts.html#269">257</a>,&#160;<a href="eloquent-javascripts.html#383">371,&#160;</a><a href="eloquent-javascripts.html#384">372,&#160;</a><a href="eloquent-javascripts.html#391">379</a><br/>
td&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#253">241</a>,&#160;<a href="eloquent-javascripts.html#282">270</a><br/>
Timeout&#160;class,&#160;<a href="eloquent-javascripts.html#200">188</a><br/>
temperature&#160;example,&#160;<a href="eloquent-javascripts.html#123">111</a><br/>
times&#160;method,&#160;<a href="eloquent-javascripts.html#278">266</a><br/>
template,&#160;<a href="eloquent-javascripts.html#183">171,&#160;</a><a href="eloquent-javascripts.html#399">387</a>,&#160;<a href="eloquent-javascripts.html#421">409</a><br/>
title,&#160;<a href="eloquent-javascripts.html#393">381</a><br/>
template&#160;literals,&#160;<a href="eloquent-javascripts.html#27">15</a><br/>
title&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#231">219,&#160;</a><a href="eloquent-javascripts.html#232">220</a><br/>
tentacle&#160;(analogy),&#160;<a href="eloquent-javascripts.html#36">24,&#160;</a><a href="eloquent-javascripts.html#74">62</a>,&#160;<a href="eloquent-javascripts.html#76">64</a><br/>
toDataURL&#160;method,&#160;<a href="eloquent-javascripts.html#354">342</a><br/>
terminal,&#160;<a href="eloquent-javascripts.html#363">351</a><br/>
toLowerCase&#160;method,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#254">242</a><br/>
termite,&#160;<a href="eloquent-javascripts.html#194">182</a><br/>
tool,&#160;<a href="eloquent-javascripts.html#155">143</a>,&#160;<a href="eloquent-javascripts.html#176">164</a>,&#160;<a href="eloquent-javascripts.html#187">175,&#160;</a><a href="eloquent-javascripts.html#342">330</a>,&#160;<a href="eloquent-javascripts.html#349">337–</a><a href="eloquent-javascripts.html#353">341,</a><br/>
ternary&#160;operator,&#160;<a href="eloquent-javascripts.html#29">17,&#160;</a><a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#220">208</a><br/>
<a href="eloquent-javascripts.html#358">346,&#160;</a><a href="eloquent-javascripts.html#361">349</a>,&#160;<a href="eloquent-javascripts.html#366">354</a><br/>
test&#160;method,&#160;<a href="eloquent-javascripts.html#156">144</a><br/>
tool&#160;property,&#160;<a href="eloquent-javascripts.html#344">332</a><br/>
test&#160;runners,&#160;<a href="eloquent-javascripts.html#144">132</a><br/>
ToolSelect&#160;class,&#160;<a href="eloquent-javascripts.html#350">338</a><br/>
test&#160;suite,&#160;<a href="eloquent-javascripts.html#143">131</a><br/>
top&#160;(CSS),&#160;<a href="eloquent-javascripts.html#250">238</a>–<a href="eloquent-javascripts.html#252">240</a>,&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
test&#160;suites,&#160;<a href="eloquent-javascripts.html#144">132</a><br/>
top-level&#160;scope,&#160;<i>see&#160;</i>global&#160;scope<br/>
testing,&#160;<a href="eloquent-javascripts.html#138">126</a>,&#160;<a href="eloquent-javascripts.html#143">131</a><br/>
toString&#160;method,&#160;<a href="eloquent-javascripts.html#111">99,&#160;</a><a href="eloquent-javascripts.html#112">100,&#160;</a><a href="eloquent-javascripts.html#116">104–</a><a href="eloquent-javascripts.html#118">106,</a><br/>
text,&#160;<a href="eloquent-javascripts.html#25">13</a>,&#160;<a href="eloquent-javascripts.html#230">218</a>,&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#236">224</a>,&#160;<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#304">292</a>,<br/>
<a href="eloquent-javascripts.html#356">344,&#160;</a><a href="eloquent-javascripts.html#372">360</a><br/>
<a href="eloquent-javascripts.html#316">304</a>–<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#332">320</a>,&#160;<a href="eloquent-javascripts.html#334">322,&#160;</a><a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#417">405</a><br/>
touch,&#160;<a href="eloquent-javascripts.html#264">252,&#160;</a><a href="eloquent-javascripts.html#342">330</a><br/>
text&#160;field,&#160;<a href="eloquent-javascripts.html#266">254</a>,&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#329">317,&#160;</a><a href="eloquent-javascripts.html#332">320,&#160;</a><a href="eloquent-javascripts.html#333">321</a><br/>
touchend&#160;event,&#160;<a href="eloquent-javascripts.html#264">252</a><br/>
text&#160;method,&#160;<a href="eloquent-javascripts.html#324">312</a><br/>
touches&#160;method,&#160;<a href="eloquent-javascripts.html#287">275</a><br/>
text&#160;node,&#160;<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#243">231,&#160;</a><a href="eloquent-javascripts.html#413">401</a><br/>
touches&#160;property,&#160;<a href="eloquent-javascripts.html#264">252,&#160;</a><a href="eloquent-javascripts.html#349">337</a><br/>
text&#160;wrapping,&#160;<a href="eloquent-javascripts.html#316">304</a><br/>
touchmove&#160;event,&#160;<a href="eloquent-javascripts.html#264">252,&#160;</a><a href="eloquent-javascripts.html#348">336,&#160;</a><a href="eloquent-javascripts.html#361">349</a><br/>
text-align&#160;(CSS),&#160;<a href="eloquent-javascripts.html#254">242</a><br/>
touchstart&#160;event,&#160;<a href="eloquent-javascripts.html#264">252</a>,&#160;<a href="eloquent-javascripts.html#346">334</a>,&#160;<a href="eloquent-javascripts.html#348">336</a><br/>
TEXT_NODE&#160;code,&#160;<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#413">401</a><br/>
toUpperCase&#160;method,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#143">131</a>,&#160;<a href="eloquent-javascripts.html#254">242,</a><br/>
textAlign&#160;property,&#160;<a href="eloquent-javascripts.html#305">293</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
<a href="eloquent-javascripts.html#372">360</a><br/>
textarea&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#270">258</a>,&#160;<a href="eloquent-javascripts.html#328">316</a>,&#160;<a href="eloquent-javascripts.html#332">320</a>,<br/>
tr&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#253">241,&#160;</a><a href="eloquent-javascripts.html#282">270</a><br/>
<a href="eloquent-javascripts.html#338">326</a>,&#160;<a href="eloquent-javascripts.html#341">329</a>,&#160;<a href="eloquent-javascripts.html#420">408</a><br/>
trackKeys&#160;function,&#160;<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#295">283</a><br/>
textBaseline&#160;property,&#160;<a href="eloquent-javascripts.html#305">293,&#160;</a><a href="eloquent-javascripts.html#415">403</a><br/>
transform&#160;(CSS),&#160;<a href="eloquent-javascripts.html#296">284</a><br/>
textContent&#160;property,&#160;<a href="eloquent-javascripts.html#413">401,&#160;</a><a href="eloquent-javascripts.html#417">405</a><br/>
transformation,&#160;<a href="eloquent-javascripts.html#307">295</a>–<a href="eloquent-javascripts.html#309">297</a>,&#160;<a href="eloquent-javascripts.html#319">307</a>,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
textScripts&#160;function,&#160;<a href="eloquent-javascripts.html#106">94</a>,&#160;<a href="eloquent-javascripts.html#404">392</a><br/>
translate&#160;method,&#160;<a href="eloquent-javascripts.html#307">295</a>,&#160;<a href="eloquent-javascripts.html#308">296</a><br/>
th&#160;(HTML&#160;tag),&#160;<a href="eloquent-javascripts.html#253">241</a><br/>
Transmission&#160;Control&#160;Protocol,&#160;<i>see</i><br/>
then&#160;method,&#160;<a href="eloquent-javascripts.html#197">185</a>–<a href="eloquent-javascripts.html#199">187</a>,&#160;<a href="eloquent-javascripts.html#202">190</a>,&#160;<a href="eloquent-javascripts.html#410">398</a><br/>
TCP<br/>
theory,&#160;<a href="eloquent-javascripts.html#145">133</a><br/>
transparency,&#160;<a href="eloquent-javascripts.html#356">344</a><br/>
this&#160;binding,&#160;<a href="eloquent-javascripts.html#72">60,&#160;</a><a href="eloquent-javascripts.html#110">98,&#160;</a><a href="eloquent-javascripts.html#111">99</a>,&#160;<a href="eloquent-javascripts.html#113">101</a>,&#160;<a href="eloquent-javascripts.html#141">129</a><br/>
transparent,&#160;<a href="eloquent-javascripts.html#297">285,&#160;</a><a href="eloquent-javascripts.html#306">294</a><br/>
thread,&#160;<a href="eloquent-javascripts.html#193">181,&#160;</a><a href="eloquent-javascripts.html#210">198</a>,&#160;<a href="eloquent-javascripts.html#268">256</a><br/>
transpilation,&#160;<a href="eloquent-javascripts.html#225">213</a><br/>
throw&#160;keyword,&#160;<a href="eloquent-javascripts.html#147">135,&#160;</a><a href="eloquent-javascripts.html#148">136,&#160;</a><a href="eloquent-javascripts.html#152">140,&#160;</a><a href="eloquent-javascripts.html#154">142</a>,<br/>
trapezoid,&#160;<a href="eloquent-javascripts.html#318">306</a>,&#160;<a href="eloquent-javascripts.html#414">402</a><br/>
<a href="eloquent-javascripts.html#407">395</a><br/>
traversal,&#160;<a href="eloquent-javascripts.html#163">151</a><br/>
tile,&#160;<a href="eloquent-javascripts.html#313">301</a><br/>
tree,&#160;<a href="eloquent-javascripts.html#112">100</a>,&#160;<a href="eloquent-javascripts.html#215">203,&#160;</a><a href="eloquent-javascripts.html#237">225,&#160;</a><a href="eloquent-javascripts.html#238">226</a><br/>
time,&#160;<a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#158">146</a>,&#160;<a href="eloquent-javascripts.html#160">148,&#160;</a><a href="eloquent-javascripts.html#195">183,&#160;</a><a href="eloquent-javascripts.html#251">239</a>,&#160;<a href="eloquent-javascripts.html#270">258</a>,<br/>
trial&#160;and&#160;error,&#160;<a href="eloquent-javascripts.html#145">133</a>,&#160;<a href="eloquent-javascripts.html#291">279</a>,&#160;<a href="eloquent-javascripts.html#302">290</a><br/>
434<br/>
<hr/>
<a name=447></a>triangle&#160;(exercise),&#160;<a href="eloquent-javascripts.html#49">37</a>,&#160;<a href="eloquent-javascripts.html#400">388</a><br/>
updated&#160;method,&#160;<a href="eloquent-javascripts.html#389">377</a>,&#160;<a href="eloquent-javascripts.html#392">380</a>,&#160;<a href="eloquent-javascripts.html#421">409</a><br/>
trigonometry,&#160;<a href="eloquent-javascripts.html#87">75</a>,&#160;<a href="eloquent-javascripts.html#252">240</a><br/>
updateState&#160;function,&#160;<a href="eloquent-javascripts.html#345">333</a><br/>
trim&#160;method,&#160;<a href="eloquent-javascripts.html#85">73,&#160;</a><a href="eloquent-javascripts.html#276">264</a><br/>
upgrading,&#160;<a href="eloquent-javascripts.html#180">168</a><br/>
true,&#160;<a href="eloquent-javascripts.html#28">16</a><br/>
upload,&#160;<a href="eloquent-javascripts.html#335">323</a><br/>
trust,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
URL,&#160;<a href="eloquent-javascripts.html#230">218,&#160;</a><a href="eloquent-javascripts.html#233">221,&#160;</a><a href="eloquent-javascripts.html#297">285</a>,&#160;<a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#324">312,&#160;</a><a href="eloquent-javascripts.html#327">315,</a><br/>
try&#160;keyword,&#160;<a href="eloquent-javascripts.html#148">136</a>,&#160;<a href="eloquent-javascripts.html#149">137,&#160;</a><a href="eloquent-javascripts.html#202">190,&#160;</a><a href="eloquent-javascripts.html#407">395</a>,&#160;<a href="eloquent-javascripts.html#417">405</a><br/>
<a href="eloquent-javascripts.html#370">358,&#160;</a><a href="eloquent-javascripts.html#383">371</a>,&#160;<a href="eloquent-javascripts.html#394">382</a><br/>
type,&#160;<a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#125">113</a><br/>
URL&#160;encoding,&#160;<a href="eloquent-javascripts.html#323">311</a><br/>
type&#160;attribute,&#160;<a href="eloquent-javascripts.html#327">315,&#160;</a><a href="eloquent-javascripts.html#331">319</a><br/>
url&#160;package,&#160;<a href="eloquent-javascripts.html#374">362,&#160;</a><a href="eloquent-javascripts.html#391">379</a><br/>
type&#160;checking,&#160;<a href="eloquent-javascripts.html#143">131</a>,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
urlToPath&#160;function,&#160;<a href="eloquent-javascripts.html#374">362</a><br/>
type&#160;coercion,&#160;<a href="eloquent-javascripts.html#30">18</a>–<a href="eloquent-javascripts.html#32">20,&#160;</a><a href="eloquent-javascripts.html#39">27</a><br/>
usability,&#160;<a href="eloquent-javascripts.html#259">247</a><br/>
type&#160;property,&#160;<a href="eloquent-javascripts.html#215">203</a>,&#160;<a href="eloquent-javascripts.html#257">245</a><br/>
use&#160;strict,&#160;<i>see&#160;</i>strict&#160;mode<br/>
type&#160;variable,&#160;<a href="eloquent-javascripts.html#143">131</a><br/>
user&#160;experience,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#330">318,&#160;</a><a href="eloquent-javascripts.html#382">370</a>,&#160;<a href="eloquent-javascripts.html#394">382</a><br/>
typeof&#160;operator,&#160;<a href="eloquent-javascripts.html#27">15,&#160;</a><a href="eloquent-javascripts.html#93">81,&#160;</a><a href="eloquent-javascripts.html#403">391</a><br/>
user&#160;interface,&#160;<a href="eloquent-javascripts.html#150">138,&#160;</a><a href="eloquent-javascripts.html#343">331</a><br/>
TypeScript,&#160;<a href="eloquent-javascripts.html#143">131</a><br/>
users’&#160;group,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
typing,&#160;<a href="eloquent-javascripts.html#270">258</a><br/>
UTF16,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#104">92</a><br/>
typo,&#160;<a href="eloquent-javascripts.html#140">128</a><br/>
UTF8,&#160;<a href="eloquent-javascripts.html#368">356</a><br/>
unary&#160;operator,&#160;<a href="eloquent-javascripts.html#27">15</a>,&#160;<a href="eloquent-javascripts.html#34">22</a><br/>
validation,&#160;<a href="eloquent-javascripts.html#146">134,&#160;</a><a href="eloquent-javascripts.html#153">141</a>,&#160;<a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#285">273,&#160;</a><a href="eloquent-javascripts.html#331">319,</a><br/>
uncaught&#160;exception,&#160;<a href="eloquent-javascripts.html#150">138,&#160;</a><a href="eloquent-javascripts.html#199">187</a><br/>
<a href="eloquent-javascripts.html#389">377,&#160;</a><a href="eloquent-javascripts.html#390">378</a><br/>
undefined,&#160;<a href="eloquent-javascripts.html#30">18</a>,&#160;<a href="eloquent-javascripts.html#31">19,&#160;</a><a href="eloquent-javascripts.html#36">24</a>,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#58">46</a>,&#160;<a href="eloquent-javascripts.html#71">59,&#160;</a><a href="eloquent-javascripts.html#73">61</a>,<br/>
value,&#160;<a href="eloquent-javascripts.html#22">10</a>,&#160;<a href="eloquent-javascripts.html#197">185</a><br/>
<a href="eloquent-javascripts.html#89">77,&#160;</a><a href="eloquent-javascripts.html#140">128,&#160;</a><a href="eloquent-javascripts.html#141">129,&#160;</a><a href="eloquent-javascripts.html#146">134</a><br/>
value&#160;attribute,&#160;<a href="eloquent-javascripts.html#328">316,&#160;</a><a href="eloquent-javascripts.html#332">320</a>,&#160;<a href="eloquent-javascripts.html#334">322</a><br/>
underline,&#160;<a href="eloquent-javascripts.html#247">235</a><br/>
var&#160;keyword,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#52">40,&#160;</a><a href="eloquent-javascripts.html#53">41,&#160;</a><a href="eloquent-javascripts.html#89">77</a><br/>
underscore&#160;character,&#160;<a href="eloquent-javascripts.html#37">25</a>,&#160;<a href="eloquent-javascripts.html#47">35</a>,&#160;<a href="eloquent-javascripts.html#109">97</a>,&#160;<a href="eloquent-javascripts.html#161">149,</a><br/>
variable,&#160;<i>see&#160;</i>binding<br/>
<a href="eloquent-javascripts.html#169">157</a><br/>
Vec&#160;class,&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#276">264</a>,&#160;<a href="eloquent-javascripts.html#277">265</a>,&#160;<a href="eloquent-javascripts.html#290">278</a>,&#160;<a href="eloquent-javascripts.html#416">404</a><br/>
undo&#160;history,&#160;<a href="eloquent-javascripts.html#357">345</a><br/>
vector&#160;(exercise),&#160;<a href="eloquent-javascripts.html#127">115,&#160;</a><a href="eloquent-javascripts.html#405">393</a><br/>
UndoButton&#160;class,&#160;<a href="eloquent-javascripts.html#358">346</a><br/>
vector&#160;graphics,&#160;<a href="eloquent-javascripts.html#305">293</a><br/>
Unicode,&#160;<a href="eloquent-javascripts.html#26">14,&#160;</a><a href="eloquent-javascripts.html#28">16</a>,&#160;<a href="eloquent-javascripts.html#98">86,&#160;</a><a href="eloquent-javascripts.html#104">92</a>,&#160;<a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#174">162</a>,<br/>
verbosity,&#160;<a href="eloquent-javascripts.html#56">44</a>,&#160;<a href="eloquent-javascripts.html#193">181</a><br/>
<a href="eloquent-javascripts.html#175">163</a><br/>
version,&#160;<a href="eloquent-javascripts.html#180">168</a>,&#160;<a href="eloquent-javascripts.html#231">219</a>,&#160;<a href="eloquent-javascripts.html#321">309</a>,&#160;<a href="eloquent-javascripts.html#366">354,&#160;</a><a href="eloquent-javascripts.html#367">355</a><br/>
property,&#160;<a href="eloquent-javascripts.html#175">163</a><br/>
viewport,&#160;<a href="eloquent-javascripts.html#284">272,&#160;</a><a href="eloquent-javascripts.html#286">274,&#160;</a><a href="eloquent-javascripts.html#311">299</a>,&#160;<a href="eloquent-javascripts.html#312">300</a>,&#160;<a href="eloquent-javascripts.html#315">303</a><br/>
unicycling,&#160;<a href="eloquent-javascripts.html#381">369</a><br/>
VillageState&#160;class,&#160;<a href="eloquent-javascripts.html#131">119</a><br/>
Uniform&#160;Resource&#160;Locator,&#160;<i>see&#160;</i>URL<br/>
virtual&#160;keyboard,&#160;<a href="eloquent-javascripts.html#261">249</a><br/>
uniformity,&#160;<a href="eloquent-javascripts.html#215">203</a><br/>
virtual&#160;world,&#160;<a href="eloquent-javascripts.html#129">117,&#160;</a><a href="eloquent-javascripts.html#131">119,&#160;</a><a href="eloquent-javascripts.html#134">122</a><br/>
uniqueness,&#160;<a href="eloquent-javascripts.html#249">237</a><br/>
virus,&#160;<a href="eloquent-javascripts.html#234">222</a><br/>
unit&#160;(CSS),&#160;<a href="eloquent-javascripts.html#252">240,&#160;</a><a href="eloquent-javascripts.html#266">254</a><br/>
vocabulary,&#160;<a href="eloquent-javascripts.html#51">39,&#160;</a><a href="eloquent-javascripts.html#94">82</a>,&#160;<a href="eloquent-javascripts.html#95">83</a><br/>
Unix,&#160;<a href="eloquent-javascripts.html#376">364</a>,&#160;<a href="eloquent-javascripts.html#378">366</a>,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
void&#160;operator,&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
Unix&#160;time,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
volatile&#160;data&#160;storage,&#160;<a href="eloquent-javascripts.html#22">10</a><br/>
unlink&#160;function,&#160;<a href="eloquent-javascripts.html#368">356,&#160;</a><a href="eloquent-javascripts.html#376">364<br/></a>unshift&#160;method,&#160;<a href="eloquent-javascripts.html#82">70</a><br/>
waitForChanges&#160;method,&#160;<a href="eloquent-javascripts.html#391">379</a><br/>
unwinding&#160;the&#160;stack,&#160;<a href="eloquent-javascripts.html#147">135</a><br/>
waiting,&#160;<a href="eloquent-javascripts.html#195">183</a><br/>
upcasing&#160;server&#160;example,&#160;<a href="eloquent-javascripts.html#372">360</a><br/>
walking,&#160;<a href="eloquent-javascripts.html#314">302</a><br/>
435<br/>
<hr/>
<a name=448></a>warning,&#160;<a href="eloquent-javascripts.html#366">354</a><br/>
writing&#160;code,&#160;<a href="eloquent-javascripts.html#19">7,&#160;</a><a href="eloquent-javascripts.html#129">117</a><br/>
wave,&#160;<a href="eloquent-javascripts.html#280">268</a>,&#160;<a href="eloquent-javascripts.html#290">278</a><br/>
writing&#160;system,&#160;<a href="eloquent-javascripts.html#98">86</a><br/>
Web,&#160;<i>see&#160;</i>World&#160;Wide&#160;Web<br/>
WWW,&#160;<i>see&#160;</i>World&#160;Wide&#160;Web<br/>
web&#160;application,&#160;<a href="eloquent-javascripts.html#18">6</a>,&#160;<a href="eloquent-javascripts.html#337">325,&#160;</a><a href="eloquent-javascripts.html#342">330<br/></a>web&#160;browser,&#160;<i>see&#160;</i>browser<br/>
XML,&#160;<a href="eloquent-javascripts.html#238">226</a>,&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
web&#160;page,&#160;<a href="eloquent-javascripts.html#187">175</a><br/>
XML&#160;namespace,&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
web&#160;worker,&#160;<a href="eloquent-javascripts.html#268">256</a><br/>
xmlns&#160;attribute,&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
WebDAV,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
yield&#160;(reserved&#160;word),&#160;<a href="eloquent-javascripts.html#37">25</a><br/>
webgl&#160;(canvas&#160;context),&#160;<a href="eloquent-javascripts.html#297">285</a><br/>
yield&#160;keyword,&#160;<a href="eloquent-javascripts.html#209">197</a><br/>
website,&#160;<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#235">223,&#160;</a><a href="eloquent-javascripts.html#322">310</a>,&#160;<a href="eloquent-javascripts.html#362">350</a>,&#160;<a href="eloquent-javascripts.html#379">367,&#160;</a><a href="eloquent-javascripts.html#381">369</a><br/>
your&#160;own&#160;loop&#160;(example),&#160;<a href="eloquent-javascripts.html#107">95</a><br/>
WebSockets,&#160;<a href="eloquent-javascripts.html#382">370</a><br/>
Yuan-Ma,&#160;<a href="eloquent-javascripts.html#22">10,&#160;</a><a href="eloquent-javascripts.html#179">167</a>,&#160;<a href="eloquent-javascripts.html#362">350</a><br/>
weekDay&#160;module,&#160;<a href="eloquent-javascripts.html#181">169<br/></a>weekend&#160;project,&#160;<a href="eloquent-javascripts.html#379">367</a><br/>
Zawinski,&#160;Jamie,&#160;<a href="eloquent-javascripts.html#155">143</a><br/>
weresquirrel&#160;example,&#160;<a href="eloquent-javascripts.html#69">57,&#160;</a><a href="eloquent-javascripts.html#73">61,&#160;</a><a href="eloquent-javascripts.html#75">63,&#160;</a><a href="eloquent-javascripts.html#76">64</a>,<br/>
zero-based&#160;counting,&#160;<a href="eloquent-javascripts.html#68">56,&#160;</a><a href="eloquent-javascripts.html#70">58</a>,&#160;<a href="eloquent-javascripts.html#161">149</a><br/>
<a href="eloquent-javascripts.html#80">68,&#160;</a><a href="eloquent-javascripts.html#82">70</a><br/>
zeroPad&#160;function,&#160;<a href="eloquent-javascripts.html#65">53</a><br/>
while&#160;loop,&#160;<a href="eloquent-javascripts.html#17">5,&#160;</a><a href="eloquent-javascripts.html#42">30,&#160;</a><a href="eloquent-javascripts.html#44">32</a>,&#160;<a href="eloquent-javascripts.html#64">52,&#160;</a><a href="eloquent-javascripts.html#172">160</a><br/>
zigzag,&#160;<a href="eloquent-javascripts.html#415">403</a><br/>
whitespace,&#160;<a href="eloquent-javascripts.html#227">215</a><br/>
zooming,&#160;<a href="eloquent-javascripts.html#316">304</a><br/>
in&#160;HTML,&#160;<a href="eloquent-javascripts.html#240">228</a>,&#160;<a href="eloquent-javascripts.html#350">338</a>,&#160;<a href="eloquent-javascripts.html#413">401<br/></a>in&#160;URLs,&#160;<a href="eloquent-javascripts.html#384">372<br/></a>indentation,&#160;<a href="eloquent-javascripts.html#43">31<br/></a>matching,&#160;<a href="eloquent-javascripts.html#157">145</a>,&#160;<a href="eloquent-javascripts.html#174">162<br/></a>syntax,&#160;<a href="eloquent-javascripts.html#47">35,&#160;</a><a href="eloquent-javascripts.html#214">202</a>,&#160;<a href="eloquent-javascripts.html#217">205</a>,&#160;<a href="eloquent-javascripts.html#411">399<br/></a>trimming,&#160;<a href="eloquent-javascripts.html#85">73</a>,&#160;<a href="eloquent-javascripts.html#276">264</a><br/>
why,&#160;<a href="eloquent-javascripts.html#34">22<br/></a>width&#160;property,&#160;<a href="eloquent-javascripts.html#360">348,&#160;</a><a href="eloquent-javascripts.html#418">406<br/></a>window,&#160;<a href="eloquent-javascripts.html#258">246,&#160;</a><a href="eloquent-javascripts.html#263">251,&#160;</a><a href="eloquent-javascripts.html#267">255<br/></a>window&#160;object,&#160;<a href="eloquent-javascripts.html#255">243,&#160;</a><a href="eloquent-javascripts.html#256">244<br/></a>with&#160;statement,&#160;<a href="eloquent-javascripts.html#142">130<br/></a>wizard&#160;(mighty),&#160;<a href="eloquent-javascripts.html#15">3<br/></a>word&#160;boundary,&#160;<a href="eloquent-javascripts.html#162">150<br/></a>word&#160;character,&#160;<a href="eloquent-javascripts.html#157">145,&#160;</a><a href="eloquent-javascripts.html#162">150,&#160;</a><a href="eloquent-javascripts.html#174">162<br/></a>work&#160;list,&#160;<a href="eloquent-javascripts.html#137">125,&#160;</a><a href="eloquent-javascripts.html#353">341<br/></a>workbench&#160;(exercise),&#160;<a href="eloquent-javascripts.html#341">329,&#160;</a><a href="eloquent-javascripts.html#417">405<br/></a>world,&#160;<a href="eloquent-javascripts.html#273">261<br/></a>World&#160;Wide&#160;Web,&#160;<a href="eloquent-javascripts.html#18">6,&#160;</a><a href="eloquent-javascripts.html#89">77,&#160;</a><a href="eloquent-javascripts.html#228">216,&#160;</a><a href="eloquent-javascripts.html#230">218</a>,<br/>
<a href="eloquent-javascripts.html#234">222</a>,&#160;<a href="eloquent-javascripts.html#320">308</a><br/>
writable&#160;stream,&#160;<a href="eloquent-javascripts.html#370">358</a>–<a href="eloquent-javascripts.html#372">360</a>,&#160;<a href="eloquent-javascripts.html#374">362<br/></a>write&#160;method,&#160;<a href="eloquent-javascripts.html#370">358</a>,&#160;<a href="eloquent-javascripts.html#371">359<br/></a>writeFile&#160;function,&#160;<a href="eloquent-javascripts.html#368">356</a>,&#160;<a href="eloquent-javascripts.html#371">359</a>,&#160;<a href="eloquent-javascripts.html#421">409<br/></a>writeHead&#160;method,&#160;<a href="eloquent-javascripts.html#370">358</a><br/>
436<br/>
<hr/>
<a name="outline"></a><h1>Document Outline</h1>
<ul>
<li><a href="eloquent-javascripts.html#13">Introduction</a>
<ul>
<li><a href="eloquent-javascripts.html#14">On programming</a></li>
<li><a href="eloquent-javascripts.html#15">Why language matters</a></li>
<li><a href="eloquent-javascripts.html#18">What is JavaScript?</a></li>
<li><a href="eloquent-javascripts.html#19">Code, and what to do with it</a></li>
<li><a href="eloquent-javascripts.html#20">Overview of this book</a></li>
<li><a href="eloquent-javascripts.html#20">Typographic conventions</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#22">Values, Types, and Operators</a>
<ul>
<li><a href="eloquent-javascripts.html#22">Values</a></li>
<li><a href="eloquent-javascripts.html#23">Numbers</a></li>
<li><a href="eloquent-javascripts.html#25">Strings</a></li>
<li><a href="eloquent-javascripts.html#27">Unary operators</a></li>
<li><a href="eloquent-javascripts.html#28">Boolean values</a></li>
<li><a href="eloquent-javascripts.html#30">Empty values</a></li>
<li><a href="eloquent-javascripts.html#30">Automatic type conversion</a></li>
<li><a href="eloquent-javascripts.html#32">Summary</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#34">Program Structure</a>
<ul>
<li><a href="eloquent-javascripts.html#34">Expressions and statements</a></li>
<li><a href="eloquent-javascripts.html#35">Bindings</a></li>
<li><a href="eloquent-javascripts.html#37">Binding names</a></li>
<li><a href="eloquent-javascripts.html#37">The environment</a></li>
<li><a href="eloquent-javascripts.html#38">Functions</a></li>
<li><a href="eloquent-javascripts.html#38">The console.log function</a></li>
<li><a href="eloquent-javascripts.html#39">Return values</a></li>
<li><a href="eloquent-javascripts.html#39">Control flow</a></li>
<li><a href="eloquent-javascripts.html#40">Conditional execution</a></li>
<li><a href="eloquent-javascripts.html#42">while and do loops</a></li>
<li><a href="eloquent-javascripts.html#43">Indenting Code</a></li>
<li><a href="eloquent-javascripts.html#44">for loops</a></li>
<li><a href="eloquent-javascripts.html#45">Breaking Out of a Loop</a></li>
<li><a href="eloquent-javascripts.html#46">Updating bindings succinctly</a></li>
<li><a href="eloquent-javascripts.html#46">Dispatching on a value with switch</a></li>
<li><a href="eloquent-javascripts.html#47">Capitalization</a></li>
<li><a href="eloquent-javascripts.html#48">Comments</a></li>
<li><a href="eloquent-javascripts.html#49">Summary</a></li>
<li><a href="eloquent-javascripts.html#49">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#51">Functions</a>
<ul>
<li><a href="eloquent-javascripts.html#51">Defining a function</a></li>
<li><a href="eloquent-javascripts.html#52">Bindings and scopes</a></li>
<li><a href="eloquent-javascripts.html#54">Functions as values</a></li>
<li><a href="eloquent-javascripts.html#55">Declaration notation</a></li>
<li><a href="eloquent-javascripts.html#56">Arrow functions</a></li>
<li><a href="eloquent-javascripts.html#57">The call stack</a></li>
<li><a href="eloquent-javascripts.html#58">Optional Arguments</a></li>
<li><a href="eloquent-javascripts.html#59">Closure</a></li>
<li><a href="eloquent-javascripts.html#61">Recursion</a></li>
<li><a href="eloquent-javascripts.html#63">Growing functions</a></li>
<li><a href="eloquent-javascripts.html#66">Functions and side effects</a></li>
<li><a href="eloquent-javascripts.html#67">Summary</a></li>
<li><a href="eloquent-javascripts.html#67">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#69">Data Structures: Objects and Arrays</a>
<ul>
<li><a href="eloquent-javascripts.html#69">The weresquirrel</a></li>
<li><a href="eloquent-javascripts.html#70">Data sets</a></li>
<li><a href="eloquent-javascripts.html#71">Properties</a></li>
<li><a href="eloquent-javascripts.html#72">Methods</a></li>
<li><a href="eloquent-javascripts.html#73">Objects</a></li>
<li><a href="eloquent-javascripts.html#75">Mutability</a></li>
<li><a href="eloquent-javascripts.html#76">The lycanthrope's log</a></li>
<li><a href="eloquent-javascripts.html#78">Computing correlation</a></li>
<li><a href="eloquent-javascripts.html#80">Array loops</a></li>
<li><a href="eloquent-javascripts.html#80">The final analysis</a></li>
<li><a href="eloquent-javascripts.html#82">Further arrayology</a></li>
<li><a href="eloquent-javascripts.html#84">Strings and their properties</a></li>
<li><a href="eloquent-javascripts.html#86">Rest parameters</a></li>
<li><a href="eloquent-javascripts.html#87">The Math object</a></li>
<li><a href="eloquent-javascripts.html#88">Destructuring</a></li>
<li><a href="eloquent-javascripts.html#89">JSON</a></li>
<li><a href="eloquent-javascripts.html#90">Summary</a></li>
<li><a href="eloquent-javascripts.html#91">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#94">Higher-Order Functions</a>
<ul>
<li><a href="eloquent-javascripts.html#95">Abstraction</a></li>
<li><a href="eloquent-javascripts.html#95">Abstracting repetition</a></li>
<li><a href="eloquent-javascripts.html#97">Higher-order functions</a></li>
<li><a href="eloquent-javascripts.html#98">Script data set</a></li>
<li><a href="eloquent-javascripts.html#99">Filtering arrays</a></li>
<li><a href="eloquent-javascripts.html#100">Transforming with map</a></li>
<li><a href="eloquent-javascripts.html#100">Summarizing with reduce</a></li>
<li><a href="eloquent-javascripts.html#102">Composability</a></li>
<li><a href="eloquent-javascripts.html#103">Strings and character codes</a></li>
<li><a href="eloquent-javascripts.html#105">Recognizing text</a></li>
<li><a href="eloquent-javascripts.html#107">Summary</a></li>
<li><a href="eloquent-javascripts.html#107">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#109">The Secret Life of Objects</a>
<ul>
<li><a href="eloquent-javascripts.html#109">Encapsulation</a></li>
<li><a href="eloquent-javascripts.html#110">Methods</a></li>
<li><a href="eloquent-javascripts.html#111">Prototypes</a></li>
<li><a href="eloquent-javascripts.html#113">Classes</a></li>
<li><a href="eloquent-javascripts.html#114">Class notation</a></li>
<li><a href="eloquent-javascripts.html#115">Overriding derived properties</a></li>
<li><a href="eloquent-javascripts.html#116">Maps</a></li>
<li><a href="eloquent-javascripts.html#118">Polymorphism</a></li>
<li><a href="eloquent-javascripts.html#119">Symbols</a></li>
<li><a href="eloquent-javascripts.html#120">The iterator interface</a></li>
<li><a href="eloquent-javascripts.html#122">Getters, setters, and statics</a></li>
<li><a href="eloquent-javascripts.html#124">Inheritance</a></li>
<li><a href="eloquent-javascripts.html#125">The instanceof operator</a></li>
<li><a href="eloquent-javascripts.html#126">Summary</a></li>
<li><a href="eloquent-javascripts.html#127">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#129">Project: A Robot</a>
<ul>
<li><a href="eloquent-javascripts.html#129">Meadowfield</a></li>
<li><a href="eloquent-javascripts.html#131">The task</a></li>
<li><a href="eloquent-javascripts.html#133">Persistent data</a></li>
<li><a href="eloquent-javascripts.html#134">Simulation</a></li>
<li><a href="eloquent-javascripts.html#136">The mail truck's route</a></li>
<li><a href="eloquent-javascripts.html#136">Pathfinding</a></li>
<li><a href="eloquent-javascripts.html#138">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#140">Bugs and Errors</a>
<ul>
<li><a href="eloquent-javascripts.html#140">Language</a></li>
<li><a href="eloquent-javascripts.html#141">Strict mode</a></li>
<li><a href="eloquent-javascripts.html#142">Types</a></li>
<li><a href="eloquent-javascripts.html#143">Testing</a></li>
<li><a href="eloquent-javascripts.html#144">Debugging</a></li>
<li><a href="eloquent-javascripts.html#146">Error propagation</a></li>
<li><a href="eloquent-javascripts.html#147">Exceptions</a></li>
<li><a href="eloquent-javascripts.html#148">Cleaning up after exceptions</a></li>
<li><a href="eloquent-javascripts.html#150">Selective catching</a></li>
<li><a href="eloquent-javascripts.html#152">Assertions</a></li>
<li><a href="eloquent-javascripts.html#153">Summary</a></li>
<li><a href="eloquent-javascripts.html#154">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#155">Regular Expressions</a>
<ul>
<li><a href="eloquent-javascripts.html#155">Creating a regular expression</a></li>
<li><a href="eloquent-javascripts.html#156">Testing for matches</a></li>
<li><a href="eloquent-javascripts.html#156">Sets of characters</a></li>
<li><a href="eloquent-javascripts.html#158">Repeating parts of a pattern</a></li>
<li><a href="eloquent-javascripts.html#159">Grouping subexpressions</a></li>
<li><a href="eloquent-javascripts.html#159">Matches and groups</a></li>
<li><a href="eloquent-javascripts.html#160">The Date class</a></li>
<li><a href="eloquent-javascripts.html#162">Word and string boundaries</a></li>
<li><a href="eloquent-javascripts.html#162">Choice patterns</a></li>
<li><a href="eloquent-javascripts.html#163">The mechanics of matching</a></li>
<li><a href="eloquent-javascripts.html#164">Backtracking</a></li>
<li><a href="eloquent-javascripts.html#166">The replace method</a></li>
<li><a href="eloquent-javascripts.html#167">Greed</a></li>
<li><a href="eloquent-javascripts.html#169">Dynamically creating RegExp objects</a></li>
<li><a href="eloquent-javascripts.html#169">The search method</a></li>
<li><a href="eloquent-javascripts.html#170">The lastIndex property</a></li>
<li><a href="eloquent-javascripts.html#172">Parsing an INI file</a></li>
<li><a href="eloquent-javascripts.html#174">International characters</a></li>
<li><a href="eloquent-javascripts.html#175">Summary</a></li>
<li><a href="eloquent-javascripts.html#177">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#179">Modules</a>
<ul>
<li><a href="eloquent-javascripts.html#179">Modules</a></li>
<li><a href="eloquent-javascripts.html#180">Packages</a></li>
<li><a href="eloquent-javascripts.html#181">Improvised modules</a></li>
<li><a href="eloquent-javascripts.html#182">Evaluating data as code</a></li>
<li><a href="eloquent-javascripts.html#183">CommonJS</a></li>
<li><a href="eloquent-javascripts.html#185">ECMAScript modules</a></li>
<li><a href="eloquent-javascripts.html#187">Building and bundling</a></li>
<li><a href="eloquent-javascripts.html#188">Module design</a></li>
<li><a href="eloquent-javascripts.html#190">Summary</a></li>
<li><a href="eloquent-javascripts.html#190">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#192">Asynchronous Programming</a>
<ul>
<li><a href="eloquent-javascripts.html#192">Asynchronicity</a></li>
<li><a href="eloquent-javascripts.html#194">Crow tech</a></li>
<li><a href="eloquent-javascripts.html#195">Callbacks</a></li>
<li><a href="eloquent-javascripts.html#197">Promises</a></li>
<li><a href="eloquent-javascripts.html#198">Failure</a></li>
<li><a href="eloquent-javascripts.html#200">Networks are hard</a></li>
<li><a href="eloquent-javascripts.html#202">Collections of promises</a></li>
<li><a href="eloquent-javascripts.html#203">Network flooding</a></li>
<li><a href="eloquent-javascripts.html#204">Message routing</a></li>
<li><a href="eloquent-javascripts.html#206">Async functions</a></li>
<li><a href="eloquent-javascripts.html#208">Generators</a></li>
<li><a href="eloquent-javascripts.html#209">The event loop</a></li>
<li><a href="eloquent-javascripts.html#211">Asynchronous bugs</a></li>
<li><a href="eloquent-javascripts.html#212">Summary</a></li>
<li><a href="eloquent-javascripts.html#213">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#214">Project: A Programming Language</a>
<ul>
<li><a href="eloquent-javascripts.html#214">Parsing</a></li>
<li><a href="eloquent-javascripts.html#219">The evaluator</a></li>
<li><a href="eloquent-javascripts.html#220">Special forms</a></li>
<li><a href="eloquent-javascripts.html#222">The environment</a></li>
<li><a href="eloquent-javascripts.html#223">Functions</a></li>
<li><a href="eloquent-javascripts.html#224">Compilation</a></li>
<li><a href="eloquent-javascripts.html#225">Cheating</a></li>
<li><a href="eloquent-javascripts.html#226">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#228">JavaScript and the Browser</a>
<ul>
<li><a href="eloquent-javascripts.html#228">Networks and the Internet</a></li>
<li><a href="eloquent-javascripts.html#230">The Web</a></li>
<li><a href="eloquent-javascripts.html#230">HTML</a></li>
<li><a href="eloquent-javascripts.html#233">HTML and JavaScript</a></li>
<li><a href="eloquent-javascripts.html#234">In the sandbox</a></li>
<li><a href="eloquent-javascripts.html#234">Compatibility and the browser wars</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#236">The Document Object Model</a>
<ul>
<li><a href="eloquent-javascripts.html#236">Document structure</a></li>
<li><a href="eloquent-javascripts.html#237">Trees</a></li>
<li><a href="eloquent-javascripts.html#238">The standard</a></li>
<li><a href="eloquent-javascripts.html#239">Moving through the tree</a></li>
<li><a href="eloquent-javascripts.html#240">Finding elements</a></li>
<li><a href="eloquent-javascripts.html#241">Changing the document</a></li>
<li><a href="eloquent-javascripts.html#242">Creating nodes</a></li>
<li><a href="eloquent-javascripts.html#244">Attributes</a></li>
<li><a href="eloquent-javascripts.html#245">Layout</a></li>
<li><a href="eloquent-javascripts.html#247">Styling</a></li>
<li><a href="eloquent-javascripts.html#248">Cascading styles</a></li>
<li><a href="eloquent-javascripts.html#249">Query selectors</a></li>
<li><a href="eloquent-javascripts.html#250">Positioning and animating</a></li>
<li><a href="eloquent-javascripts.html#253">Summary</a></li>
<li><a href="eloquent-javascripts.html#253">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#255">Handling Events</a>
<ul>
<li><a href="eloquent-javascripts.html#255">Event handlers</a></li>
<li><a href="eloquent-javascripts.html#256">Events and DOM nodes</a></li>
<li><a href="eloquent-javascripts.html#257">Event objects</a></li>
<li><a href="eloquent-javascripts.html#257">Propagation</a></li>
<li><a href="eloquent-javascripts.html#259">Default actions</a></li>
<li><a href="eloquent-javascripts.html#259">Key events</a></li>
<li><a href="eloquent-javascripts.html#261">Pointer events</a></li>
<li><a href="eloquent-javascripts.html#265">Scroll events</a></li>
<li><a href="eloquent-javascripts.html#266">Focus events</a></li>
<li><a href="eloquent-javascripts.html#267">Load event</a></li>
<li><a href="eloquent-javascripts.html#267">Events and the event loop</a></li>
<li><a href="eloquent-javascripts.html#269">Timers</a></li>
<li><a href="eloquent-javascripts.html#269">Debouncing</a></li>
<li><a href="eloquent-javascripts.html#271">Summary</a></li>
<li><a href="eloquent-javascripts.html#271">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#273">Project: A Platform Game</a>
<ul>
<li><a href="eloquent-javascripts.html#273">The game</a></li>
<li><a href="eloquent-javascripts.html#274">The technology</a></li>
<li><a href="eloquent-javascripts.html#274">Levels</a></li>
<li><a href="eloquent-javascripts.html#275">Reading a level</a></li>
<li><a href="eloquent-javascripts.html#277">Actors</a></li>
<li><a href="eloquent-javascripts.html#280">Encapsulation as a burden</a></li>
<li><a href="eloquent-javascripts.html#281">Drawing</a></li>
<li><a href="eloquent-javascripts.html#286">Motion and collision</a></li>
<li><a href="eloquent-javascripts.html#289">Actor updates</a></li>
<li><a href="eloquent-javascripts.html#291">Tracking keys</a></li>
<li><a href="eloquent-javascripts.html#292">Running the game</a></li>
<li><a href="eloquent-javascripts.html#294">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#296">Drawing on Canvas</a>
<ul>
<li><a href="eloquent-javascripts.html#296">SVG</a></li>
<li><a href="eloquent-javascripts.html#297">The canvas element</a></li>
<li><a href="eloquent-javascripts.html#298">Lines and surfaces</a></li>
<li><a href="eloquent-javascripts.html#299">Paths</a></li>
<li><a href="eloquent-javascripts.html#301">Curves</a></li>
<li><a href="eloquent-javascripts.html#303">Drawing a pie chart</a></li>
<li><a href="eloquent-javascripts.html#304">Text</a></li>
<li><a href="eloquent-javascripts.html#305">Images</a></li>
<li><a href="eloquent-javascripts.html#307">Transformation</a></li>
<li><a href="eloquent-javascripts.html#309">Storing and clearing transformations</a></li>
<li><a href="eloquent-javascripts.html#311">Back to the game</a></li>
<li><a href="eloquent-javascripts.html#316">Choosing a graphics interface</a></li>
<li><a href="eloquent-javascripts.html#317">Summary</a></li>
<li><a href="eloquent-javascripts.html#318">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#320">HTTP and Forms</a>
<ul>
<li><a href="eloquent-javascripts.html#320">The protocol</a></li>
<li><a href="eloquent-javascripts.html#322">Browsers and HTTP</a></li>
<li><a href="eloquent-javascripts.html#324">Fetch</a></li>
<li><a href="eloquent-javascripts.html#325">HTTP sandboxing</a></li>
<li><a href="eloquent-javascripts.html#326">Appreciating HTTP</a></li>
<li><a href="eloquent-javascripts.html#326">Security and HTTPS</a></li>
<li><a href="eloquent-javascripts.html#327">Form fields</a></li>
<li><a href="eloquent-javascripts.html#329">Focus</a></li>
<li><a href="eloquent-javascripts.html#330">Disabled fields</a></li>
<li><a href="eloquent-javascripts.html#330">The form as a whole</a></li>
<li><a href="eloquent-javascripts.html#332">Text fields</a></li>
<li><a href="eloquent-javascripts.html#333">Checkboxes and radio buttons</a></li>
<li><a href="eloquent-javascripts.html#334">Select fields</a></li>
<li><a href="eloquent-javascripts.html#335">File fields</a></li>
<li><a href="eloquent-javascripts.html#337">Storing data client-side</a></li>
<li><a href="eloquent-javascripts.html#339">Summary</a></li>
<li><a href="eloquent-javascripts.html#340">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#342">Project: A Pixel Art Editor</a>
<ul>
<li><a href="eloquent-javascripts.html#342">Components</a></li>
<li><a href="eloquent-javascripts.html#344">The state</a></li>
<li><a href="eloquent-javascripts.html#345">DOM building</a></li>
<li><a href="eloquent-javascripts.html#346">The canvas</a></li>
<li><a href="eloquent-javascripts.html#349">The application</a></li>
<li><a href="eloquent-javascripts.html#351">Drawing tools</a></li>
<li><a href="eloquent-javascripts.html#354">Saving and loading</a></li>
<li><a href="eloquent-javascripts.html#357">Undo history</a></li>
<li><a href="eloquent-javascripts.html#358">Let's draw</a></li>
<li><a href="eloquent-javascripts.html#359">Why is this so hard?</a></li>
<li><a href="eloquent-javascripts.html#360">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#362">Node.js</a>
<ul>
<li><a href="eloquent-javascripts.html#362">Background</a></li>
<li><a href="eloquent-javascripts.html#363">The node command</a></li>
<li><a href="eloquent-javascripts.html#364">Modules</a></li>
<li><a href="eloquent-javascripts.html#365">Installing with NPM</a></li>
<li><a href="eloquent-javascripts.html#367">The file system module</a></li>
<li><a href="eloquent-javascripts.html#369">The HTTP module</a></li>
<li><a href="eloquent-javascripts.html#371">Streams</a></li>
<li><a href="eloquent-javascripts.html#373">A file server</a></li>
<li><a href="eloquent-javascripts.html#378">Summary</a></li>
<li><a href="eloquent-javascripts.html#379">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#381">Project: Skill-Sharing Website</a>
<ul>
<li><a href="eloquent-javascripts.html#381">Design</a></li>
<li><a href="eloquent-javascripts.html#382">Long polling</a></li>
<li><a href="eloquent-javascripts.html#383">HTTP interface</a></li>
<li><a href="eloquent-javascripts.html#385">The server</a></li>
<li><a href="eloquent-javascripts.html#392">The client</a></li>
<li><a href="eloquent-javascripts.html#399">Exercises</a></li>
</ul>
</li>
<li><a href="eloquent-javascripts.html#400">Exercise Hints</a>
<ul>
<li><a href="eloquent-javascripts.html#400">Program Structure</a></li>
<li><a href="eloquent-javascripts.html#401">Functions</a></li>
<li><a href="eloquent-javascripts.html#402">Data Structures: Objects and Arrays</a></li>
<li><a href="eloquent-javascripts.html#404">Higher-Order Functions</a></li>
<li><a href="eloquent-javascripts.html#405">The Secret Life of Objects</a></li>
<li><a href="eloquent-javascripts.html#406">Project: A Robot</a></li>
<li><a href="eloquent-javascripts.html#407">Bugs and Errors</a></li>
<li><a href="eloquent-javascripts.html#407">Regular Expressions</a></li>
<li><a href="eloquent-javascripts.html#408">Modules</a></li>
<li><a href="eloquent-javascripts.html#410">Asynchronous Programming</a></li>
<li><a href="eloquent-javascripts.html#411">Project: A Programming Language</a></li>
<li><a href="eloquent-javascripts.html#412">The Document Object Model</a></li>
<li><a href="eloquent-javascripts.html#412">Handling Events</a></li>
<li><a href="eloquent-javascripts.html#414">Project: A Platform Game</a></li>
<li><a href="eloquent-javascripts.html#414">Drawing on Canvas</a></li>
<li><a href="eloquent-javascripts.html#416">HTTP and Forms</a></li>
<li><a href="eloquent-javascripts.html#418">Project: A Pixel Art Editor</a></li>
<li><a href="eloquent-javascripts.html#420">Node.js</a></li>
<li><a href="eloquent-javascripts.html#421">Project: Skill-Sharing Website</a></li>
</ul>
</li>
</ul>
<hr/>
</body>
</html>
